!function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/",i(i.s=0)}({"+Nns":function(t,e,i){"use strict";e.a=function(t){return new this((function(e,i){if(!t||void 0===t.length)return i(new TypeError(typeof t+" "+t+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var r=Array.prototype.slice.call(t);if(0===r.length)return e([]);var n=r.length;function o(t,i){if(i&&("object"==typeof i||"function"==typeof i)){var s=i.then;if("function"==typeof s)return void s.call(i,(function(e){o(t,e)}),(function(i){r[t]={status:"rejected",reason:i},0==--n&&e(r)}))}r[t]={status:"fulfilled",value:i},0==--n&&e(r)}for(var s=0;s<r.length;s++)o(s,r[s])}))}},"/pFH":function(t,e,i){"use strict";e.a=function(t){var e=this.constructor;return this.then((function(i){return e.resolve(t()).then((function(){return i}))}),(function(i){return e.resolve(t()).then((function(){return e.reject(i)}))}))}},0:function(t,e,i){i("ng4s"),i("NlKh"),i("dlst"),t.exports=i("mPeE")},"0Ake":function(t,e,i){"use strict";var r=i("AM7I"),n=i("eZIG"),o=i("ZLCw")(),s=i("Kqna"),a=r("%TypeError%"),l=r("%Math.floor%");t.exports=function(t,e){if("function"!=typeof t)throw new a("`fn` is not a function");if("number"!=typeof e||e<0||e>4294967295||l(e)!==e)throw new a("`length` must be a positive 32-bit integer");var i=arguments.length>2&&!!arguments[2],r=!0,c=!0;if("length"in t&&s){var u=s(t,"length");u&&!u.configurable&&(r=!1),u&&!u.writable&&(c=!1)}return(r||c||!i)&&(o?n(t,"length",e,!0,!0):n(t,"length",e)),t}},"0jNN":function(t,e,i){"use strict";var r=i("sxOR"),n=Object.prototype.hasOwnProperty,o=Array.isArray,s=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),a=function(t,e){for(var i=e&&e.plainObjects?Object.create(null):{},r=0;r<t.length;++r)void 0!==t[r]&&(i[r]=t[r]);return i};t.exports={arrayToObject:a,assign:function(t,e){return Object.keys(e).reduce((function(t,i){return t[i]=e[i],t}),t)},combine:function(t,e){return[].concat(t,e)},compact:function(t){for(var e=[{obj:{o:t},prop:"o"}],i=[],r=0;r<e.length;++r)for(var n=e[r],s=n.obj[n.prop],a=Object.keys(s),l=0;l<a.length;++l){var c=a[l],u=s[c];"object"==typeof u&&null!==u&&-1===i.indexOf(u)&&(e.push({obj:s,prop:c}),i.push(u))}return function(t){for(;t.length>1;){var e=t.pop(),i=e.obj[e.prop];if(o(i)){for(var r=[],n=0;n<i.length;++n)void 0!==i[n]&&r.push(i[n]);e.obj[e.prop]=r}}}(e),t},decode:function(t,e,i){var r=t.replace(/\+/g," ");if("iso-8859-1"===i)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(t){return r}},encode:function(t,e,i,n,o){if(0===t.length)return t;var a=t;if("symbol"==typeof t?a=Symbol.prototype.toString.call(t):"string"!=typeof t&&(a=String(t)),"iso-8859-1"===i)return escape(a).replace(/%u[0-9a-f]{4}/gi,(function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"}));for(var l="",c=0;c<a.length;++c){var u=a.charCodeAt(c);45===u||46===u||95===u||126===u||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||o===r.RFC1738&&(40===u||41===u)?l+=a.charAt(c):u<128?l+=s[u]:u<2048?l+=s[192|u>>6]+s[128|63&u]:u<55296||u>=57344?l+=s[224|u>>12]+s[128|u>>6&63]+s[128|63&u]:(c+=1,u=65536+((1023&u)<<10|1023&a.charCodeAt(c)),l+=s[240|u>>18]+s[128|u>>12&63]+s[128|u>>6&63]+s[128|63&u])}return l},isBuffer:function(t){return!(!t||"object"!=typeof t)&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},isRegExp:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},maybeMap:function(t,e){if(o(t)){for(var i=[],r=0;r<t.length;r+=1)i.push(e(t[r]));return i}return e(t)},merge:function t(e,i,r){if(!i)return e;if("object"!=typeof i){if(o(e))e.push(i);else{if(!e||"object"!=typeof e)return[e,i];(r&&(r.plainObjects||r.allowPrototypes)||!n.call(Object.prototype,i))&&(e[i]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(i);var s=e;return o(e)&&!o(i)&&(s=a(e,r)),o(e)&&o(i)?(i.forEach((function(i,o){if(n.call(e,o)){var s=e[o];s&&"object"==typeof s&&i&&"object"==typeof i?e[o]=t(s,i,r):e.push(i)}else e[o]=i})),e):Object.keys(i).reduce((function(e,o){var s=i[o];return n.call(e,o)?e[o]=t(e[o],s,r):e[o]=s,e}),s)}}},1:function(t,e){},"2SVd":function(t,e,i){"use strict";t.exports=function(t){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(t)}},"4ZJM":function(t,e,i){(function(e){t.exports=function(){"use strict";var t,i,r;function n(e,n){if(t)if(i){var o="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+t+")(sharedChunk); ("+i+")(sharedChunk); self.onerror = null;",s={};t(s),r=n(s),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(r.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else i=n;else t=n}return n(0,(function(t){var i="undefined"!=typeof self?self:{},r="3.1.2";let n;const o={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==n){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{n=null!=e.env.API_URL_REGEX?new RegExp(e.env.API_URL_REGEX):t}catch(e){n=t}}return n},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!o.API_URL)return null;try{const t=new URL(o.API_URL);return"api.mapbox.cn"===t.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===t.hostname?"https://events.mapbox.com/events/v2":null}catch(t){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},s={supported:!1,testSupport:function(t){!c&&l&&(u?h(t):a=t)}};let a,l,c=!1,u=!1;function h(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,l),t.isContextLost())return;s.supported=!0}catch(t){}t.deleteTexture(e),c=!0}i.document&&(l=i.document.createElement("img"),l.onload=function(){a&&h(a),a=null,u=!0},l.onerror=function(){c=!0,a=null},l.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const d="01";function p(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var f=m;function m(t,e,i,r){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=r}m.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,r=0;r<8;r++){var n=this.sampleCurveX(i)-t;if(Math.abs(n)<e)return i;var o=this.sampleCurveDerivativeX(i);if(Math.abs(o)<1e-6)break;i-=n/o}var s=0,a=1;for(i=t,r=0;r<20&&(n=this.sampleCurveX(i),!(Math.abs(n-t)<e));r++)t>n?s=i:a=i,i=.5*(a-s)+s;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var g=p(f),_=y;function y(t,e){this.x=t,this.y=e}y.prototype={clone:function(){return new y(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=r,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),n=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-r*(this.y-e.y),this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},y.convert=function(t){return t instanceof y?t:Array.isArray(t)?new y(t[0],t[1]):t};var v=p(_);function x(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!x(t[i],e[i]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const i in t)if(!x(t[i],e[i]))return!1;return!0}return t===e}const b=Math.PI/180,w=180/Math.PI;function T(t){return t*b}function E(t){return t*w}const S=[[0,0],[1,0],[1,1],[0,1]];function A(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function M(t){let e=1/0,i=1/0,r=-1/0,n=-1/0;for(const o of t)e=Math.min(e,o.x),i=Math.min(i,o.y),r=Math.max(r,o.x),n=Math.max(n,o.y);return{min:new v(e,i),max:new v(r,n)}}function I(t,e,i=0,r=!0){const n=new v(i,i),o=t.sub(n),s=e.add(n),a=[o,new v(s.x,o.y),s,new v(o.x,s.y)];return r&&a.push(o.clone()),a}function C(t,e,i,r){const n=new g(t,e,i,r);return function(t){return n.solve(t)}}const P=C(.25,.1,.25,1);function R(t,e,i){return Math.min(i,Math.max(e,t))}function O(t,e,i){return(i=R((i-t)/(e-t),0,1))*i*(3-2*i)}function D(t,e,i){const r=i-e,n=((t-e)%r+r)%r+e;return n===e?i:n}function L(t,e,i){if(!t.length)return i(null,[]);let r=t.length;const n=new Array(t.length);let o=null;t.forEach((t,s)=>{e(t,(t,e)=>{t&&(o=t),n[s]=e,0==--r&&i(o,n)})})}function k(t){const e=[];for(const i in t)e.push(t[i]);return e}function B(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}function F(t,e){const i={};for(let r=0;r<e.length;r++){const n=e[r];n in t&&(i[n]=t[n])}return i}let z=1;function N(){return z++}function U(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function G(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function j(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function V(t,e){t.forEach(t=>{e[t]&&(e[t]=e[t].bind(e))})}function X(t,e){return-1!==t.indexOf(e,t.length-e.length)}function H(t,e,i){const r={};for(const n in t)r[n]=e.call(i||this,t[n],n,t);return r}function q(t,e,i){const r={};for(const n in t)e.call(i||this,t[n],n,t)&&(r[n]=t[n]);return r}function W(t){return Array.isArray(t)?t.map(W):"object"==typeof t&&t?H(t,W):t}const $={};function Y(t){$[t]||("undefined"!=typeof console&&console.warn(t),$[t]=!0)}function Z(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function K(t){let e=0;for(let i,r,n=0,o=t.length,s=o-1;n<o;s=n++)i=t[n],r=t[s],e+=(r.x-i.x)*(i.y+r.y);return e}function J([t,e,i]){const r=T(e+90),n=T(i);return{x:t*Math.cos(r)*Math.sin(n),y:t*Math.sin(r)*Math.sin(n),z:t*Math.cos(n),azimuthal:e,polar:i}}function Q(t,e,i){const r=Math.sqrt(t*t+e*e+i*i),n=r>0?Math.acos(i/r)*w:0;let o=0!==t||0!==e?Math.atan2(-e,-t)*w+90:0;return o<0&&(o+=360),[r,o,n]}function tt(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function et(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(t,i,r,n)=>{const o=r||n;return e[i]=!o||o.toLowerCase(),""}),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e}let it=null;function rt(){return!!i.document.fullscreenElement||!!i.document.webkitFullscreenElement}function nt(t){try{const e=i[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}function ot(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function st(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]}function at(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]}function lt(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]}const ct="mapbox-tiles";let ut,ht,dt=500,pt=50;function ft(){try{return i.caches}catch(t){}}function mt(){ft()&&!ut&&(ut=i.caches.open(ct))}function gt(t){const e=t.indexOf("?");if(e<0)return t;const i=function(t){const e=t.indexOf("?");return e>0?t.slice(e+1).split("&"):[]}(t).filter(t=>{const e=t.split("=");return"language"===e[0]||"worldview"===e[0]});return i.length?`${t.slice(0,e)}?${i.join("&")}`:t.slice(0,e)}let _t=1/0;function yt(t){_t++,_t>pt&&(t.getActor().send("enforceCacheSizeLimit",dt),_t=0)}const vt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(vt);class xt extends Error{constructor(t,e,i){401===e&&Dt(i)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=e,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const bt=tt()?()=>self.worker&&self.worker.referrer:()=>("blob:"===i.location.protocol?i.parent:i).location.href,wt=function(t,e){if(!(/^file:/.test(r=t.url)||/^file:/.test(bt())&&!/^\w+:/.test(r))){if(i.fetch&&i.Request&&i.AbortController&&i.Request.prototype.hasOwnProperty("signal"))return function(t,e){const r=new i.AbortController,n=new i.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:bt(),referrerPolicy:t.referrerPolicy,signal:r.signal});let o=!1,s=!1;const a=(l=n.url).indexOf("sku=")>0&&Dt(l);var l;"json"===t.type&&n.headers.set("Accept","application/json");const c=(r,o,l)=>{if(s)return;if(r&&"SecurityError"!==r.message&&Y(r.toString()),o&&l)return u(o);const c=Date.now();i.fetch(n).then(i=>{if(i.ok){const t=a?i.clone():null;return u(i,t,c)}return e(new xt(i.statusText,i.status,t.url))}).catch(i=>{"AbortError"!==i.name&&e(new Error(`${i.message} ${t.url}`))})},u=(r,a,l)=>{("arrayBuffer"===t.type?r.arrayBuffer():"json"===t.type?r.json():r.text()).then(t=>{s||(a&&l&&function(t,e,r){if(mt(),!ut)return;const n={status:e.status,statusText:e.statusText,headers:new i.Headers};e.headers.forEach((t,e)=>n.headers.set(e,t));const o=et(e.headers.get("Cache-Control")||"");if(o["no-store"])return;o["max-age"]&&n.headers.set("Expires",new Date(r+1e3*o["max-age"]).toUTCString());const s=n.headers.get("Expires");s&&(new Date(s).getTime()-r<42e4||function(t,e){if(void 0===ht)try{new Response(new ReadableStream),ht=!0}catch(t){ht=!1}ht?e(t.body):t.blob().then(e)}(e,e=>{const r=new i.Response(e,n);mt(),ut&&ut.then(e=>e.put(gt(t.url),r)).catch(t=>Y(t.message))}))}(n,a,l),o=!0,e(null,t,r.headers.get("Cache-Control"),r.headers.get("Expires")))}).catch(t=>{s||e(new Error(t.message))})};return a?function(t,e){if(mt(),!ut)return e(null);const i=gt(t.url);ut.then(t=>{t.match(i).then(r=>{const n=function(t){if(!t)return!1;const e=new Date(t.headers.get("Expires")||0),i=et(t.headers.get("Cache-Control")||"");return e>Date.now()&&!i["no-cache"]}(r);t.delete(i),n&&t.put(i,r.clone()),e(null,r,n)}).catch(e)}).catch(e)}(n,c):c(null,null),{cancel:()=>{s=!0,o||r.abort()}}}(t,e);if(tt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var r;return function(t,e){const r=new i.XMLHttpRequest;r.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(r.responseType="arraybuffer");for(const e in t.headers)r.setRequestHeader(e,t.headers[e]);return"json"===t.type&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials="include"===t.credentials,r.onerror=()=>{e(new Error(r.statusText))},r.onload=()=>{if((r.status>=200&&r.status<300||0===r.status)&&null!==r.response){let i=r.response;if("json"===t.type)try{i=JSON.parse(r.response)}catch(t){return e(t)}e(null,i,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"))}else e(new xt(r.statusText,r.status,t.url))},r.send(t.body),{cancel:()=>r.abort()}}(t,e)},Tt=function(t,e){return wt(B(t,{type:"json"}),e)},Et=function(t,e){return wt(B(t,{type:"arrayBuffer"}),e)};function St(t){const e=i.document.createElement("a");return e.href=t,e.protocol===i.document.location.protocol&&e.host===i.document.location.host}const At="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Mt,It;Mt=[],It=0;const Ct=function(t,e){if(s.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),It>=o.MAX_PARALLEL_IMAGE_REQUESTS){const i={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Mt.push(i),i}It++;let r=!1;const n=()=>{if(!r)for(r=!0,It--;Mt.length&&It<o.MAX_PARALLEL_IMAGE_REQUESTS;){const t=Mt.shift(),{requestParameters:e,callback:i,cancelled:r}=t;r||(t.cancel=Ct(e,i).cancel)}},a=Et(t,(t,r,o,s)=>{n(),t?e(t):r&&(i.createImageBitmap?function(t,e){const r=new i.Blob([new Uint8Array(t)],{type:"image/png"});i.createImageBitmap(r).then(t=>{e(null,t)}).catch(t=>{e(new Error(`Could not load image because of ${t.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(r,(t,i)=>e(t,i,o,s)):function(t,e){const r=new i.Image,n=i.URL;r.onload=()=>{e(null,r),n.revokeObjectURL(r.src),r.onload=null,i.requestAnimationFrame(()=>{r.src=At})},r.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const o=new i.Blob([new Uint8Array(t)],{type:"image/png"});r.src=t.byteLength?n.createObjectURL(o):At}(r,(t,i)=>e(t,i,o,s)))});return{cancel:()=>{a.cancel(),n()}}},Pt="NO_ACCESS_TOKEN";class Rt{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let t="";for(let e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",d,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!Ot(t))return t;const i=zt(t);return i.params.push("sdk=js-3.1.2"),i.path="/styles/v1"+i.path,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!Ot(t))return t;const i=zt(t);return i.path="/fonts/v1"+i.path,this._makeAPIURL(i,this._customAccessToken||e)}normalizeModelURL(t,e){if(!Ot(t))return t;const i=zt(t);return i.path="/models/v1"+i.path,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,r){if(!Ot(t))return t;const n=zt(t);return n.path=`/v4/${n.authority}.json`,n.params.push("secure"),i&&n.params.push("language="+i),r&&n.params.push("worldview="+r),this._makeAPIURL(n,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,r){const n=zt(t);return Ot(t)?(n.path=`/styles/v1${n.path}/sprite${e}${i}`,this._makeAPIURL(n,this._customAccessToken||r)):(n.path+=`${e}${i}`,Nt(n))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Ot(t))return t;const r=zt(t);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&"raster"!==r.authority&&512===i?"@2x":""}${s.supported?".webp":"$1"}`),"raster"===r.authority?r.path=`/${o.RASTER_URL_PREFIX}${r.path}`:(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path=`/${o.TILE_URL_VERSION}${r.path}`);const n=this._customAccessToken||function(t){for(const e of t){const t=e.match(/^access_token=(.*)$/);if(t)return t[1]}return null}(r.params)||o.ACCESS_TOKEN;return o.REQUIRE_ACCESS_TOKEN&&n&&this._skuToken&&r.params.push("sku="+this._skuToken),this._makeAPIURL(r,n)}canonicalizeTileURL(t,e){const i=zt(t);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let r="mapbox://";i.path.match(/^\/raster\/v1\//)?r+="raster/"+i.path.replace(`/${o.RASTER_URL_PREFIX}/`,""):r+="tiles/"+i.path.replace(`/${o.TILE_URL_VERSION}/`,"");let n=i.params;return e&&(n=n.filter(t=>!t.match(/^access_token=/))),n.length&&(r+="?"+n.join("&")),r}canonicalizeTileset(t,e){const i=!!e&&Ot(e),r=[];for(const e of t.tiles||[])Dt(e)?r.push(this.canonicalizeTileURL(e,i)):r.push(e);return r}_makeAPIURL(t,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",r=zt(o.API_URL);if(t.protocol=r.protocol,t.authority=r.authority,"http"===t.protocol){const e=t.params.indexOf("secure");e>=0&&t.params.splice(e,1)}if("/"!==r.path&&(t.path=`${r.path}${t.path}`),!o.REQUIRE_ACCESS_TOKEN)return Nt(t);if(e=e||o.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error("An API access token is required to use Mapbox GL. "+i);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+i)}return t.params=t.params.filter(t=>-1===t.indexOf("access_token")),t.params.push("access_token="+(e||"")),Nt(t)}}function Ot(t){return 0===t.indexOf("mapbox:")}function Dt(t){return o.API_URL_REGEX.test(t)}function Lt(t){return o.API_CDN_URL_REGEX.test(t)}function kt(t){return o.API_STYLE_REGEX.test(t)&&!Bt(t)}function Bt(t){return o.API_SPRITE_REGEX.test(t)}const Ft=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function zt(t){const e=t.match(Ft);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Nt(t){const e=t.params.length?"?"+t.params.join("&"):"";return`${t.protocol}://${t.authority}${t.path}${e}`}const Ut="mapbox.eventData";function Gt(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(i.atob(e[1]).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(t){return null}}class jt{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const e=Gt(o.ACCESS_TOKEN);let r="";return r=e&&e.u?i.btoa(encodeURIComponent(e.u).replace(/%([0-9A-F]{2})/g,(t,e)=>String.fromCharCode(Number("0x"+e)))):o.ACCESS_TOKEN||"",t?`${Ut}.${t}:${r}`:`${Ut}:${r}`}fetchEventData(){const t=nt("localStorage"),e=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{const t=i.localStorage.getItem(e);t&&(this.eventData=JSON.parse(t));const n=i.localStorage.getItem(r);n&&(this.anonId=n)}catch(t){Y("Unable to read from LocalStorage")}}saveEventData(){const t=nt("localStorage"),e=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{i.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&i.localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){Y("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,e,i,r){if(!o.EVENTS_URL)return;const n=zt(o.EVENTS_URL);n.params.push("access_token="+(r||o.ACCESS_TOKEN||""));const s={event:this.type,created:new Date(t).toISOString()},a=e?B(s,e):s,l={url:Nt(n),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=function(t,e){return wt(B(t,{method:"POST"}),e)}(l,t=>{this.pendingRequest=null,i(t),this.saveEventData(),this.processRequests(r)})}queueRequest(t,e){this.queue.push(t),this.processRequests(e)}}const Vt=new class extends jt{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){o.EVENTS_URL&&o.ACCESS_TOKEN&&Array.isArray(t)&&t.some(t=>Ot(t)||Dt(t))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Gt(o.ACCESS_TOKEN),i=e?e.u:o.ACCESS_TOKEN;let n=i!==this.eventData.tokenU;j(this.anonId)||(this.anonId=U(),n=!0);const s=this.queue.shift();if(this.eventData.lastSuccess){const t=new Date(this.eventData.lastSuccess),e=new Date(s),i=(s-this.eventData.lastSuccess)/864e5;n=n||i>=1||i<-1||t.getDate()!==e.getDate()}else n=!0;n?this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:r,skuId:d,"enabled.telemetry":!1,userId:this.anonId},t=>{t||(this.eventData.lastSuccess=s,this.eventData.tokenU=i)},t):this.processRequests()}},Xt=Vt.postTurnstileEvent.bind(Vt),Ht=new class extends jt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,r){this.skuToken=e,this.errorCb=r,o.EVENTS_URL&&(i||o.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(Pt)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),j(this.anonId)||(this.anonId=U()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:r,skuId:d,skuToken:this.skuToken,userId:this.anonId},t=>{t?this.errorCb(t):e&&(this.success[e]=!0)},t))}},qt=Ht.postMapLoadEvent.bind(Ht),Wt=new class extends jt{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){o.EVENTS_URL&&(t||o.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,performanceData:n}=this.queue.shift(),o=function(t){const e=i.performance.getEntriesByType("resource"),n=i.performance.getEntriesByType("mark"),o=function(t){const e={};if(t)for(const i in t)if("other"!==i)for(const r of t[i]){const t=i+"ResolveRangeMin",n=i+"ResolveRangeMax",o=i+"RequestCount",s=i+"RequestCachedCount";e[t]=Math.min(e[t]||1/0,r.startTime),e[n]=Math.max(e[n]||-1/0,r.responseEnd);const a=t=>{void 0===e[t]&&(e[t]=0),++e[t]};void 0!==r.transferSize&&0===r.transferSize&&a(s),a(o)}return e}(function(t,e){const i={};if(t)for(const r of t){const t=e(r);void 0===i[t]&&(i[t]=[]),i[t].push(r)}return i}(e,ee)),s=i.devicePixelRatio,a=i.navigator.connection||i.navigator.mozConnection||i.navigator.webkitConnection,l={counters:[],metadata:[],attributes:[]},c=(t,e,i)=>{null!=i&&t.push({name:e,value:i.toString()})};for(const t in o)c(l.counters,t,o[t]);if(t.interactionRange[0]!==1/0&&t.interactionRange[1]!==-1/0&&(c(l.counters,"interactionRangeMin",t.interactionRange[0]),c(l.counters,"interactionRangeMax",t.interactionRange[1])),n)for(const t of Object.keys(Qt)){const e=Qt[t],i=n.find(t=>t.name===e);i&&c(l.counters,e,i.startTime)}return c(l.counters,"visibilityHidden",t.visibilityHidden),c(l.attributes,"style",function(t){if(t)for(const e of t){const t=e.name.split("?")[0];if(kt(t)){const e=t.split("/").slice(-2);if(2===e.length)return`mapbox://styles/${e[0]}/${e[1]}`}}}(e)),c(l.attributes,"terrainEnabled",t.terrainEnabled?"true":"false"),c(l.attributes,"fogEnabled",t.fogEnabled?"true":"false"),c(l.attributes,"projection",t.projection),c(l.attributes,"zoom",t.zoom),c(l.metadata,"devicePixelRatio",s),c(l.metadata,"connectionEffectiveType",a?a.effectiveType:void 0),c(l.metadata,"navigatorUserAgent",i.navigator.userAgent),c(l.metadata,"screenWidth",i.screen.width),c(l.metadata,"screenHeight",i.screen.height),c(l.metadata,"windowWidth",i.innerWidth),c(l.metadata,"windowHeight",i.innerHeight),c(l.metadata,"mapWidth",t.width/s),c(l.metadata,"mapHeight",t.height/s),c(l.metadata,"webglRenderer",t.renderer),c(l.metadata,"webglVendor",t.vendor),c(l.metadata,"sdkVersion",r),c(l.metadata,"sdkIdentifier","mapbox-gl-js"),l}(n);for(const t of o.metadata);for(const t of o.counters);for(const t of o.attributes);this.postEvent(e,o,()=>{},t)}},$t=Wt.postPerformanceEvent.bind(Wt),Yt=new class extends jt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,r){if(!o.API_URL||!o.SESSION_PATH)return;const n=zt(o.API_URL+o.SESSION_PATH);n.params.push("sku="+(e||"")),n.params.push("access_token="+(r||o.ACCESS_TOKEN||""));const s={url:Nt(n),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(t,e){return wt(B(t,{method:"GET"}),e)}(s,t=>{this.pendingRequest=null,i(t),this.saveEventData(),this.processRequests(r)})}getSessionAPI(t,e,i,r){this.skuToken=e,this.errorCb=r,o.SESSION_PATH&&o.API_URL&&(i||o.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(Pt)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,t=>{t?this.errorCb(t):e&&(this.success[e]=!0)},t)}},Zt=Yt.getSessionAPI.bind(Yt),Kt=new Set;function Jt(t,e){e?Kt.add(t):Kt.delete(t)}const Qt={create:"create",load:"load",fullLoad:"fullLoad"},te={mark(t){i.performance.mark(t)},measure(t,e,r){i.performance.measure(t,e,r)}};function ee(t){const e=t.name.split("?")[0];return Lt(e)&&e.includes("mapbox-gl.js")?"javascript":Lt(e)&&e.includes("mapbox-gl.css")?"css":function(t){return o.API_FONTS_REGEX.test(t)}(e)?"fontRange":Bt(e)?"sprite":kt(e)?"style":function(t){return o.API_TILEJSON_REGEX.test(t)}(e)?"tilejson":"other"}const ie=i.performance;function re(t){const e=t?t.url.toString():void 0;return ie.getEntriesByName(e)}var ne=oe;function oe(t){return!function(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,i=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(i);try{e=new Worker(r),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(r),t}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var i=e.getImageData(0,0,1,1);return i&&i.width===t.width}()?(void 0===se[e=t&&t.failIfMajorPerformanceCaveat]&&(se[e]=function(t){var e,i=function(t){var e=document.createElement("canvas"),i=Object.create(oe.webGLContextAttributes);return i.failIfMajorPerformanceCaveat=t,e.getContext("webgl",i)||e.getContext("experimental-webgl",i)}(t);if(!i)return!1;try{e=i.createShader(i.VERTEX_SHADER)}catch(t){return!1}return!(!e||i.isContextLost())&&(i.shaderSource(e,"void main() {}"),i.compileShader(e),!0===i.getShaderParameter(e,i.COMPILE_STATUS))}(e)),se[e]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var e}(t)}var se={};let ae,le,ce,ue,he;function de(){return null==ae&&(ae=i.OffscreenCanvas&&new i.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof i.createImageBitmap),ae}oe.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const pe={now:()=>void 0!==ue?ue:i.performance.now(),setNow(t){ue=t},restoreNow(){ue=void 0},frame(t){const e=i.requestAnimationFrame(t);return{cancel:()=>i.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:r,height:n}=t;he||(he=i.document.createElement("canvas"));const o=he.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return(r>he.width||n>he.height)&&(he.width=r,he.height=n),o.clearRect(-e,-e,r+2*e,n+2*e),o.drawImage(t,0,0,r,n),o.getImageData(-e,-e,r+2*e,n+2*e)},resolveURL:t=>(le||(le=i.document.createElement("a")),le.href=t,le.href),get devicePixelRatio(){return i.devicePixelRatio},get prefersReducedMotion(){return!!i.matchMedia&&(null==ce&&(ce=i.matchMedia("(prefers-reduced-motion: reduce)")),ce.matches)},hasCanvasFingerprintNoise(){if(!de())return!1;const t=new i.OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0});let r=0;for(let i=0;i<t.width;++i)e.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,e.fillRect(i,0,1,1);const n=e.getImageData(0,0,t.width,t.height);r=0;for(let t=0;t<n.data.length;++t)if(t%4!=3&&r++!==n.data[t])return!0;return!1}};function fe(t,e,r){const n=i.document.createElement(t);return void 0!==e&&(n.className=e),r&&r.appendChild(n),n}function me(t,e,r){const n=i.document.createElementNS("http://www.w3.org/2000/svg",t);for(const t of Object.keys(e))n.setAttributeNS(null,t,e[t]);return r&&r.appendChild(n),n}const ge=i.document&&i.document.documentElement.style,_e=ge&&void 0!==ge.userSelect?"userSelect":"WebkitUserSelect";let ye;function ve(){ge&&_e&&(ye=ge[_e],ge[_e]="none")}function xe(){ge&&_e&&(ge[_e]=ye)}function be(t){t.preventDefault(),t.stopPropagation(),i.removeEventListener("click",be,!0)}function we(){i.addEventListener("click",be,!0),i.setTimeout(()=>{i.removeEventListener("click",be,!0)},0)}function Te(t,e){const i=t.getBoundingClientRect();return Ae(t,i,e)}function Ee(t,e){const i=t.getBoundingClientRect(),r=[];for(let n=0;n<e.length;n++)r.push(Ae(t,i,e[n]));return r}function Se(t){return void 0!==i.InstallTrigger&&2===t.button&&t.ctrlKey&&i.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button}function Ae(t,e,i){const r=t.offsetWidth===e.width?1:t.offsetWidth/e.width;return new v((i.clientX-e.left)*r,(i.clientY-e.top)*r)}function Me(t,e,i){i[t]&&-1!==i[t].indexOf(e)||(i[t]=i[t]||[],i[t].push(e))}function Ie(t,e,i){if(i&&i[t]){const r=i[t].indexOf(e);-1!==r&&i[t].splice(r,1)}}class Ce{constructor(t,e={}){B(this,e),this.type=t}}class Pe extends Ce{constructor(t,e={}){super("error",B({error:t},e))}}class Re{on(t,e){return this._listeners=this._listeners||{},Me(t,e,this._listeners),this}off(t,e){return Ie(t,e,this._listeners),Ie(t,e,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},Me(t,e,this._oneTimeListeners),this):new Promise(e=>this.once(t,e))}fire(t,e){"string"==typeof t&&(t=new Ce(t,e||{}));const i=t.type;if(this.listens(i)){t.target=this;const e=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const i of e)i.call(this,t);const r=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const e of r)Ie(i,e,this._oneTimeListeners),e.call(this,t);const n=this._eventedParent;n&&(B(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),n.fire(t))}else t instanceof Pe&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,e){return this._eventedParent=t,this._eventedParentData=e,this}}var Oe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class De{constructor(t,e,i,r){this.message=(t?t+": ":"")+i,r&&(this.identifier=r),null!=e&&e.__line__&&(this.line=e.__line__)}}class Le extends De{}function ke(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}function Be(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Fe(t){if(Array.isArray(t))return t.map(Fe);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=Fe(t[i]);return e}return Be(t)}class ze extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}var Ne=ze;class Ue{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[t,i]of e)this.bindings[t]=i}concat(t){return new Ue(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var Ge=Ue;const je={kind:"null"},Ve={kind:"number"},Xe={kind:"string"},He={kind:"boolean"},qe={kind:"color"},We={kind:"object"},$e={kind:"value"},Ye={kind:"collator"},Ze={kind:"formatted"},Ke={kind:"resolvedImage"};function Je(t,e){return{kind:"array",itemType:t,N:e}}function Qe(t){if("array"===t.kind){const e=Qe(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const ti=[je,Ve,Xe,He,qe,Ze,We,Je($e),Ke];function ei(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!ei(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of ti)if(!ei(t,e))return null}return`Expected ${Qe(t)} but found ${Qe(e)} instead.`}function ii(t,e){return e.some(e=>e.kind===t.kind)}function ri(t,e){return e.some(e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t)}var ni,oi={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function si(t){return(t=Math.round(t))<0?0:t>255?255:t}function ai(t){return si("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function li(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function ci(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{ni={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in oi)return oi[i].slice();if("#"===i[0])return 4===i.length?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===i.length&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var r=i.indexOf("("),n=i.indexOf(")");if(-1!==r&&n+1===i.length){var o=i.substr(0,r),s=i.substr(r+1,n-(r+1)).split(","),a=1;switch(o){case"rgba":if(4!==s.length)return null;a=li(s.pop());case"rgb":return 3!==s.length?null:[ai(s[0]),ai(s[1]),ai(s[2]),a];case"hsla":if(4!==s.length)return null;a=li(s.pop());case"hsl":if(3!==s.length)return null;var l=(parseFloat(s[0])%360+360)%360/360,c=li(s[1]),u=li(s[2]),h=u<=.5?u*(c+1):u+c-u*c,d=2*u-h;return[si(255*ci(d,h,l+1/3)),si(255*ci(d,h,l)),si(255*ci(d,h,l-1/3)),a];default:return null}}return null}}catch(t){}class ui{constructor(t,e,i,r=1){this.r=t,this.g=e,this.b=i,this.a=r}static parse(t){if(!t)return;if(t instanceof ui)return t;if("string"!=typeof t)return;const e=ni(t);return e?new ui(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3]):void 0}toString(){const[t,e,i,r]=this.toArray();return`rgba(${Math.round(t)},${Math.round(e)},${Math.round(i)},${r})`}toArray(){const{r:t,g:e,b:i,a:r}=this;return 0===r?[0,0,0,0]:[255*t/r,255*e/r,255*i/r,r]}toArray01(){const{r:t,g:e,b:i,a:r}=this;return 0===r?[0,0,0,0]:[t/r,e/r,i/r,r]}toArray01Scaled(t){const{r:e,g:i,b:r,a:n}=this;return 0===n?[0,0,0]:[e/n*t,i/n*t,r/n*t]}toArray01PremultipliedAlpha(){const{r:t,g:e,b:i,a:r}=this;return[t,e,i,r]}toArray01Linear(){const{r:t,g:e,b:i,a:r}=this;return 0===r?[0,0,0,0]:[Math.pow(t/r,2.2),Math.pow(e/r,2.2),Math.pow(i/r,2.2),r]}}ui.black=new ui(0,0,0,1),ui.white=new ui(1,1,1,1),ui.transparent=new ui(0,0,0,0),ui.red=new ui(1,0,0,1),ui.blue=new ui(0,0,1,1);var hi=ui;class di{constructor(t,e,i){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class pi{constructor(t,e,i,r,n){this.text=t.normalize?t.normalize():t,this.image=e,this.scale=i,this.fontStack=r,this.textColor=n}}class fi{constructor(t){this.sections=t}static fromString(t){return new fi([new pi(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.namePrimary.length)}static factory(t){return t instanceof fi?t:fi.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const e of this.sections){if(e.image){t.push(["image",e.image.namePrimary]);continue}t.push(e.text);const i={};e.fontStack&&(i["text-font"]=["literal",e.fontStack.split(",")]),e.scale&&(i["font-scale"]=e.scale),e.textColor&&(i["text-color"]=["rgba"].concat(e.textColor.toArray())),t.push(i)}return t}}class mi{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),this.available=t.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(t,e){return t?new mi({namePrimary:t,nameSecondary:e,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function gi(t,e,i,r){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[t,e,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[t,e,i,r]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function _i(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof hi)return!0;if(t instanceof di)return!0;if(t instanceof fi)return!0;if(t instanceof mi)return!0;if(Array.isArray(t)){for(const e of t)if(!_i(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!_i(t[e]))return!1;return!0}return!1}function yi(t){if(null===t)return je;if("string"==typeof t)return Xe;if("boolean"==typeof t)return He;if("number"==typeof t)return Ve;if(t instanceof hi)return qe;if(t instanceof di)return Ye;if(t instanceof fi)return Ze;if(t instanceof mi)return Ke;if(Array.isArray(t)){const e=t.length;let i;for(const e of t){const t=yi(e);if(i){if(i===t)continue;i=$e;break}i=t}return Je(i||$e,e)}return We}function vi(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof hi||t instanceof fi||t instanceof mi?t.toString():JSON.stringify(t)}class xi{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!_i(t[1]))return e.error("invalid value");const i=t[1];let r=yi(i);const n=e.expectedType;return"array"!==r.kind||0!==r.N||!n||"array"!==n.kind||"number"==typeof n.N&&0!==n.N||(r=n),new xi(r,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof hi?["rgba"].concat(this.value.toArray()):this.value instanceof fi?this.value.serialize():this.value}}var bi=xi,wi=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const Ti={string:Xe,number:Ve,boolean:He,object:We};class Ei{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let i,r=1;const n=t[0];if("array"===n){let n,o;if(t.length>2){const i=t[1];if("string"!=typeof i||!(i in Ti)||"object"===i)return e.error('The item type argument of "array" must be one of string, number, boolean',1);n=Ti[i],r++}else n=$e;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);o=t[2],r++}i=Je(n,o)}else i=Ti[n];const o=[];for(;r<t.length;r++){const i=e.parse(t[r],r,$e);if(!i)return null;o.push(i)}return new Ei(i,o)}evaluate(t){for(let e=0;e<this.args.length;e++){const i=this.args[e].evaluate(t);if(!ei(this.type,yi(i)))return i;if(e===this.args.length-1)throw new wi(`Expected value to be of type ${Qe(this.type)}, but found ${Qe(yi(i))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,e=[t.kind];if("array"===t.kind){const i=t.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){e.push(i.kind);const r=t.N;("number"==typeof r||this.args.length>1)&&e.push(r)}}return e.concat(this.args.map(t=>t.serialize()))}}var Si=Ei;class Ai{constructor(t){this.type=Ze,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[1];if(!Array.isArray(i)&&"object"==typeof i)return e.error("First argument must be an image or text section.");const r=[];let n=!1;for(let i=1;i<=t.length-1;++i){const o=t[i];if(n&&"object"==typeof o&&!Array.isArray(o)){n=!1;let t=null;if(o["font-scale"]&&(t=e.parse(o["font-scale"],1,Ve),!t))return null;let i=null;if(o["text-font"]&&(i=e.parse(o["text-font"],1,Je(Xe)),!i))return null;let s=null;if(o["text-color"]&&(s=e.parse(o["text-color"],1,qe),!s))return null;const a=r[r.length-1];a.scale=t,a.font=i,a.textColor=s}else{const o=e.parse(t[i],1,$e);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");n=!0,r.push({content:o,scale:null,font:null,textColor:null})}}return new Ai(r)}evaluate(t){return new fi(this.sections.map(e=>{const i=e.content.evaluate(t);return yi(i)===Ke?new pi("",i,null,null,null):new pi(vi(i),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)}))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const e of this.sections){t.push(e.content.serialize());const i={};e.scale&&(i["font-scale"]=e.scale.serialize()),e.font&&(i["text-font"]=e.font.serialize()),e.textColor&&(i["text-color"]=e.textColor.serialize()),t.push(i)}return t}}class Mi{constructor(t,e){this.type=Ke,this.inputPrimary=t,this.inputSecondary=e}static parse(t,e){if(t.length<2)return e.error("Expected two or more arguments.");const i=e.parse(t[1],1,Xe);if(!i)return e.error("No image name provided.");if(2===t.length)return new Mi(i);const r=e.parse(t[2],1,Xe);return r?new Mi(i,r):e.error("Secondary image variant is not a string.")}evaluate(t){const e=mi.fromString(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0);return e&&t.availableImages&&(e.available=t.availableImages.indexOf(e.namePrimary)>-1,e.nameSecondary&&e.available&&t.availableImages&&(e.available=t.availableImages.indexOf(e.nameSecondary)>-1)),e}eachChild(t){t(this.inputPrimary),this.inputSecondary&&t(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Ii(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}const Ci={"to-boolean":He,"to-color":qe,"to-number":Ve,"to-string":Xe};class Pi{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[0],r=[];let n=je;if("to-array"===i){if(!Array.isArray(t[1]))return null;const i=t[1].length;if(e.expectedType){if("array"!==e.expectedType.kind)return e.error(`Expected ${e.expectedType.kind} but found array.`);n=Je(e.expectedType.itemType,i)}else{if(!(i>0&&_i(t[1][0])))return null;n=Je(yi(t[1][0]),i)}for(let o=0;o<i;o++){const i=t[1][o];let s;if("array"===Ii(i))s=e.parse(i,void 0,n.itemType);else{const t=Ii(i);if(t!==n.itemType.kind)return e.error(`Expected ${n.itemType.kind} but found ${t}.`);s=e.registry.literal.parse(["literal",void 0===i?null:i],e)}if(!s)return null;r.push(s)}}else{if(("to-boolean"===i||"to-string"===i)&&2!==t.length)return e.error("Expected one argument.");n=Ci[i];for(let i=1;i<t.length;i++){const n=e.parse(t[i],i,$e);if(!n)return null;r.push(n)}}return new Pi(n,r)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let e,i;for(const r of this.args){if(e=r.evaluate(t),i=null,e instanceof hi)return e;if("string"==typeof e){const i=t.parseColor(e);if(i)return i}else if(Array.isArray(e)&&(i=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:gi(e[0],e[1],e[2],e[3]),!i))return new hi(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new wi(i||`Could not parse color from value '${"string"==typeof e?e:String(JSON.stringify(e))}'`)}if("number"===this.type.kind){let e=null;for(const i of this.args){if(e=i.evaluate(t),null===e)return 0;const r=Number(e);if(!isNaN(r))return r}throw new wi(`Could not convert ${JSON.stringify(e)} to number.`)}return"formatted"===this.type.kind?fi.fromString(vi(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?mi.fromString(vi(this.args[0].evaluate(t))):"array"===this.type.kind?this.args.map(e=>e.evaluate(t)):vi(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Ai([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Mi(this.args[0]).serialize();const t="array"===this.type.kind?[]:["to-"+this.type.kind];return this.eachChild(e=>{t.push(e.serialize())}),t}}var Ri=Pi;const Oi=["Unknown","Point","LineString","Polygon"];var Di=class{constructor(t){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.options=t}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Oi[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(r*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=hi.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}};class Li{constructor(t,e,i,r,n){this.name=t,this.type=e,this._evaluate=i,this.args=r,this._overloadIndex=n}evaluate(t){if(!this._evaluate){const t=Li.definitions[this.name];this._evaluate=Array.isArray(t)?t[2]:t.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,e){const i=t[0],r=Li.definitions[i];if(!r)return e.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const n=Array.isArray(r)?r[0]:r.type,o=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,s=[];let a=null,l=-1;for(const[r,c]of o){if(Array.isArray(r)&&r.length!==t.length-1)continue;s.push(r),l++,a=new Hr(e.registry,e.path,null,e.scope,void 0,e.options);const o=[];let u=!1;for(let e=1;e<t.length;e++){const i=t[e],n=Array.isArray(r)?r[e-1]:r.type,s=a.parse(i,1+o.length,n);if(!s){u=!0;break}o.push(s)}if(!u)if(Array.isArray(r)&&r.length!==o.length)a.error(`Expected ${r.length} arguments, but found ${o.length} instead.`);else{for(let t=0;t<o.length;t++){const e=Array.isArray(r)?r[t]:r.type,i=o[t];a.concat(t+1).checkSubtype(e,i.type)}if(0===a.errors.length)return new Li(i,n,c,o,l)}}if(1===s.length)e.errors.push(...a.errors);else{const i=(s.length?s:o.map(([t])=>t)).map(ki).join(" | "),r=[];for(let i=1;i<t.length;i++){const n=e.parse(t[i],1+r.length);if(!n)return null;r.push(Qe(n.type))}e.error(`Expected arguments of type ${i}, but found (${r.join(", ")}) instead.`)}return null}static register(t,e){Li.definitions=e;for(const i in e)t[i]=Li}}function ki(t){return Array.isArray(t)?`(${t.map(Qe).join(", ")})`:`(${Qe(t.type)}...)`}var Bi=Li;class Fi{constructor(t,e,i){this.type=Ye,this.locale=i,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const i=t[1];if("object"!=typeof i||Array.isArray(i))return e.error("Collator options argument must be an object.");const r=e.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,He);if(!r)return null;const n=e.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,He);if(!n)return null;let o=null;return i.locale&&(o=e.parse(i.locale,1,Xe),!o)?null:new Fi(r,n,o)}evaluate(t){return new di(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}var zi={exports:{}};zi.exports=function(){function t(i,r,n,o,s){for(;o>n;){if(o-n>600){var a=o-n+1,l=r-n+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);t(i,r,Math.max(n,Math.floor(r-l*u/a+h)),Math.min(o,Math.floor(r+(a-l)*u/a+h)),s)}var d=i[r],p=n,f=o;for(e(i,n,r),s(i[o],d)>0&&e(i,n,o);p<f;){for(e(i,p,f),p++,f--;s(i[p],d)<0;)p++;for(;s(i[f],d)>0;)f--}0===s(i[n],d)?e(i,n,f):e(i,++f,o),f<=r&&(n=f+1),r<=f&&(o=f-1)}}function e(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function i(t,e){return t<e?-1:t>e?1:0}return function(e,r,n,o,s){t(e,r,n||0,o||e.length-1,s||i)}}();var Ni=p(zi.exports);function Ui(t){let e=0;for(let i,r,n=0,o=t.length,s=o-1;n<o;s=n++)i=t[n],r=t[s],e+=(r.x-i.x)*(i.y+r.y);return e}function Gi(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function ji(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Vi(t,e,i){const r=t[0]-e[0],n=t[1]-e[1],o=t[0]-i[0],s=t[1]-i[1];return r*s-o*n==0&&r*o<=0&&n*s<=0}function Xi(t,e,i=!1){let r=!1;for(let a=0,l=e.length;a<l;a++){const l=e[a];for(let e=0,a=l.length,c=a-1;e<a;c=e++){const a=l[c],u=l[e];if(Vi(t,a,u))return i;(o=a)[1]>(n=t)[1]!=(s=u)[1]>n[1]&&n[0]<(s[0]-o[0])*(n[1]-o[1])/(s[1]-o[1])+o[0]&&(r=!r)}}var n,o,s;return r}function Hi(t,e,i,r){const n=r[0]-i[0],o=r[1]-i[1],s=(t[0]-i[0])*o-n*(t[1]-i[1]),a=(e[0]-i[0])*o-n*(e[1]-i[1]);return s>0&&a<0||s<0&&a>0}function qi(t,e,i,r){return 0!=(n=[r[0]-i[0],r[1]-i[1]])[0]*(o=[e[0]-t[0],e[1]-t[1]])[1]-n[1]*o[0]&&!(!Hi(t,e,i,r)||!Hi(i,r,t,e));var n,o}const Wi=8192;function $i(t,e){const i=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,n=Math.pow(2,e.z);return[Math.round(i*n*Wi),Math.round(r*n*Wi)]}function Yi(t,e){for(let i=0;i<e.length;i++)if(Xi(t,e[i]))return!0;return!1}function Zi(t,e,i){for(const r of i)for(let i=0,n=r.length,o=n-1;i<n;o=i++)if(qi(t,e,r[o],r[i]))return!0;return!1}function Ki(t,e){for(let i=0;i<t.length;++i)if(!Xi(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(Zi(t[i],t[i+1],e))return!1;return!0}function Ji(t,e){for(let i=0;i<e.length;i++)if(Ki(t,e[i]))return!0;return!1}function Qi(t,e,i){const r=[];for(let n=0;n<t.length;n++){const o=[];for(let r=0;r<t[n].length;r++){const s=$i(t[n][r],i);Gi(e,s),o.push(s)}r.push(o)}return r}function tr(t,e,i){const r=[];for(let n=0;n<t.length;n++){const o=Qi(t[n],e,i);r.push(o)}return r}function er(t,e,i,r){if(t[0]<i[0]||t[0]>i[2]){const e=.5*r;let n=t[0]-i[0]>e?-r:i[0]-t[0]>e?r:0;0===n&&(n=t[0]-i[2]>e?-r:i[2]-t[0]>e?r:0),t[0]+=n}Gi(e,t)}function ir(t,e,i,r){const n=Math.pow(2,r.z)*Wi,o=[r.x*Wi,r.y*Wi],s=[];if(!t)return s;for(const r of t)for(const t of r){const r=[t.x+o[0],t.y+o[1]];er(r,e,i,n),s.push(r)}return s}function rr(t,e,i,r){const n=Math.pow(2,r.z)*Wi,o=[r.x*Wi,r.y*Wi],s=[];if(!t)return s;for(const i of t){const t=[];for(const r of i){const i=[r.x+o[0],r.y+o[1]];Gi(e,i),t.push(i)}s.push(t)}if(e[2]-e[0]<=n/2){(a=e)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const t of s)for(const r of t)er(r,e,i,n)}var a;return s}class nr{constructor(t,e){this.type=He,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(_i(t[1])){const e=t[1];if("FeatureCollection"===e.type)for(let t=0;t<e.features.length;++t){const i=e.features[t].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new nr(e,e.features[t].geometry)}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new nr(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new nr(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=t.canonicalID();if(!n)return!1;if("Polygon"===e.type){const o=Qi(e.coordinates,r,n),s=ir(t.geometry(),i,r,n);if(!ji(i,r))return!1;for(const t of s)if(!Xi(t,o))return!1}if("MultiPolygon"===e.type){const o=tr(e.coordinates,r,n),s=ir(t.geometry(),i,r,n);if(!ji(i,r))return!1;for(const t of s)if(!Yi(t,o))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=t.canonicalID();if(!n)return!1;if("Polygon"===e.type){const o=Qi(e.coordinates,r,n),s=rr(t.geometry(),i,r,n);if(!ji(i,r))return!1;for(const t of s)if(!Ki(t,o))return!1}if("MultiPolygon"===e.type){const o=tr(e.coordinates,r,n),s=rr(t.geometry(),i,r,n);if(!ji(i,r))return!1;for(const t of s)if(!Ji(t,o))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var or=nr,sr={exports:{}};sr.exports=function(){var t={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},e=1/298.257223563,i=e*(2-e),r=Math.PI/180,n=function(e,n){if(void 0===e)throw new Error("No latitude given.");if(n&&!t[n])throw new Error("Unknown unit "+n+". Use one of: "+Object.keys(t).join(", "));var o=6378.137*r*(n?t[n]:1),s=Math.cos(e*r),a=1/(1-i*(1-s*s)),l=Math.sqrt(a);this.kx=o*l*s,this.ky=o*l*a*(1-i)},o={units:{configurable:!0}};function s(t,e){return t[0]===e[0]&&t[1]===e[1]}function a(t,e,i){var r=l(e[0]-t[0]);return[t[0]+r*i,t[1]+(e[1]-t[1])*i]}function l(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}return n.fromTile=function(t,e,i){var o=Math.PI*(1-2*(t+.5)/Math.pow(2,e)),s=Math.atan(.5*(Math.exp(o)-Math.exp(-o)))/r;return new n(s,i)},o.units.get=function(){return t},n.prototype.distance=function(t,e){var i=l(t[0]-e[0])*this.kx,r=(t[1]-e[1])*this.ky;return Math.sqrt(i*i+r*r)},n.prototype.bearing=function(t,e){var i=l(e[0]-t[0])*this.kx;return Math.atan2(i,(e[1]-t[1])*this.ky)/r},n.prototype.destination=function(t,e,i){var n=i*r;return this.offset(t,Math.sin(n)*e,Math.cos(n)*e)},n.prototype.offset=function(t,e,i){return[t[0]+e/this.kx,t[1]+i/this.ky]},n.prototype.lineDistance=function(t){for(var e=0,i=0;i<t.length-1;i++)e+=this.distance(t[i],t[i+1]);return e},n.prototype.area=function(t){for(var e=0,i=0;i<t.length;i++)for(var r=t[i],n=0,o=r.length,s=o-1;n<o;s=n++)e+=l(r[n][0]-r[s][0])*(r[n][1]+r[s][1])*(i?-1:1);return Math.abs(e)/2*this.kx*this.ky},n.prototype.along=function(t,e){var i=0;if(e<=0)return t[0];for(var r=0;r<t.length-1;r++){var n=t[r],o=t[r+1],s=this.distance(n,o);if((i+=s)>e)return a(n,o,(e-(i-s))/s)}return t[t.length-1]},n.prototype.pointToSegmentDistance=function(t,e,i){var r=e[0],n=e[1],o=l(i[0]-r)*this.kx,s=(i[1]-n)*this.ky,a=0;return 0===o&&0===s||((a=(l(t[0]-r)*this.kx*o+(t[1]-n)*this.ky*s)/(o*o+s*s))>1?(r=i[0],n=i[1]):a>0&&(r+=o/this.kx*a,n+=s/this.ky*a)),o=l(t[0]-r)*this.kx,s=(t[1]-n)*this.ky,Math.sqrt(o*o+s*s)},n.prototype.pointOnLine=function(t,e){for(var i,r,n,o,s=1/0,a=0;a<t.length-1;a++){var c=t[a][0],u=t[a][1],h=l(t[a+1][0]-c)*this.kx,d=(t[a+1][1]-u)*this.ky,p=0;0===h&&0===d||((p=(l(e[0]-c)*this.kx*h+(e[1]-u)*this.ky*d)/(h*h+d*d))>1?(c=t[a+1][0],u=t[a+1][1]):p>0&&(c+=h/this.kx*p,u+=d/this.ky*p));var f=(h=l(e[0]-c)*this.kx)*h+(d=(e[1]-u)*this.ky)*d;f<s&&(s=f,i=c,r=u,n=a,o=p)}return{point:[i,r],index:n,t:Math.max(0,Math.min(1,o))}},n.prototype.lineSlice=function(t,e,i){var r=this.pointOnLine(i,t),n=this.pointOnLine(i,e);if(r.index>n.index||r.index===n.index&&r.t>n.t){var o=r;r=n,n=o}var a=[r.point],l=r.index+1,c=n.index;!s(i[l],a[0])&&l<=c&&a.push(i[l]);for(var u=l+1;u<=c;u++)a.push(i[u]);return s(i[c],n.point)||a.push(n.point),a},n.prototype.lineSliceAlong=function(t,e,i){for(var r=0,n=[],o=0;o<i.length-1;o++){var s=i[o],l=i[o+1],c=this.distance(s,l);if((r+=c)>t&&0===n.length&&n.push(a(s,l,(t-(r-c))/c)),r>=e)return n.push(a(s,l,(e-(r-c))/c)),n;r>t&&n.push(l)}return n},n.prototype.bufferPoint=function(t,e){var i=e/this.ky,r=e/this.kx;return[t[0]-r,t[1]-i,t[0]+r,t[1]+i]},n.prototype.bufferBBox=function(t,e){var i=e/this.ky,r=e/this.kx;return[t[0]-r,t[1]-i,t[2]+r,t[3]+i]},n.prototype.insideBBox=function(t,e){return l(t[0]-e[0])>=0&&l(t[0]-e[2])<=0&&t[1]>=e[1]&&t[1]<=e[3]},Object.defineProperties(n,o),n}();var ar=p(sr.exports),lr={exports:{}};lr.exports=function(){var t=function(t,i){if(void 0===t&&(t=[]),void 0===i&&(i=e),this.data=t,this.length=this.data.length,this.compare=i,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function e(t,e){return t<e?-1:t>e?1:0}return t.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(0!==this.length){var t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(t){for(var e=this.data,i=this.compare,r=e[t];t>0;){var n=t-1>>1,o=e[n];if(i(r,o)>=0)break;e[t]=o,t=n}e[t]=r},t.prototype._down=function(t){for(var e=this.data,i=this.compare,r=this.length>>1,n=e[t];t<r;){var o=1+(t<<1),s=e[o],a=o+1;if(a<this.length&&i(e[a],s)<0&&(o=a,s=e[a]),i(s,n)>=0)break;e[t]=s,t=o}e[t]=n},t}();var cr=p(lr.exports),ur=8192;function hr(t,e){return e.dist-t.dist}function dr(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function pr(t){return t[1]-t[0]+1}function fr(t,e){const i=t[1]>=t[0]&&t[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function mr(t,e){if(t[0]>t[1])return[null,null];const i=pr(t);if(e){if(2===i)return[t,null];const e=Math.floor(i/2);return[[t[0],t[0]+e],[t[0]+e,t[1]]]}{if(1===i)return[t,null];const e=Math.floor(i/2)-1;return[[t[0],t[0]+e],[t[0]+e+1,t[1]]]}}function gr(t,e){const i=[1/0,1/0,-1/0,-1/0];if(!fr(e,t.length))return i;for(let r=e[0];r<=e[1];++r)Gi(i,t[r]);return i}function _r(t){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<t.length;++i)for(let r=0;r<t[i].length;++r)Gi(e,t[i][r]);return e}function yr(t,e,i){if(dr(t)||dr(e))return NaN;let r=0,n=0;return t[2]<e[0]&&(r=e[0]-t[2]),t[0]>e[2]&&(r=t[0]-e[2]),t[1]>e[3]&&(n=t[1]-e[3]),t[3]<e[1]&&(n=e[1]-t[3]),i.distance([0,0],[r,n])}function vr(t,e){const i=Math.pow(2,e.z);return[(n=(t.x/ur+e.x)/i,360*n-180),(r=(t.y/ur+e.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90)];var r,n}function xr(t,e){const i=[];for(let r=0;r<t.length;++r)i.push(vr(t[r],e));return i}function br(t,e,i){const r=i.pointOnLine(e,t).point;return i.distance(t,r)}function wr(t,e,i,r,n){const o=i.slice(r[0],r[1]+1);let s=1/0;for(let i=e[0];i<=e[1];++i)if(0===(s=Math.min(s,br(t[i],o,n))))return 0;return s}function Tr(t,e,i,r,n){const o=Math.min(n.pointToSegmentDistance(t,i,r),n.pointToSegmentDistance(e,i,r)),s=Math.min(n.pointToSegmentDistance(i,t,e),n.pointToSegmentDistance(r,t,e));return Math.min(o,s)}function Er(t,e,i,r,n){if(!fr(e,t.length)||!fr(r,i.length))return NaN;let o=1/0;for(let s=e[0];s<e[1];++s)for(let e=r[0];e<r[1];++e){if(qi(t[s],t[s+1],i[e],i[e+1]))return 0;o=Math.min(o,Tr(t[s],t[s+1],i[e],i[e+1],n))}return o}function Sr(t,e,i,r,n){if(!fr(e,t.length)||!fr(r,i.length))return NaN;let o=1/0;for(let s=e[0];s<=e[1];++s)for(let e=r[0];e<=r[1];++e)if(0===(o=Math.min(o,n.distance(t[s],i[e]))))return o;return o}function Ar(t,e,i){if(Xi(t,e,!0))return 0;let r=1/0;for(const n of e){const e=n.length;if(e<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(n[0]!==n[e-1]&&0===(r=Math.min(r,i.pointToSegmentDistance(t,n[e-1],n[0]))))return r;if(0===(r=Math.min(r,br(t,n,i))))return r}return r}function Mr(t,e,i,r){if(!fr(e,t.length))return NaN;for(let r=e[0];r<=e[1];++r)if(Xi(t[r],i,!0))return 0;let n=1/0;for(let o=e[0];o<e[1];++o)for(const e of i)for(let i=0,s=e.length,a=s-1;i<s;a=i++){if(qi(t[o],t[o+1],e[a],e[i]))return 0;n=Math.min(n,Tr(t[o],t[o+1],e[a],e[i],r))}return n}function Ir(t,e){for(const i of t)for(let t=0;t<=i.length-1;++t)if(Xi(i[t],e,!0))return!0;return!1}function Cr(t,e,i,r=1/0){const n=_r(t),o=_r(e);if(r!==1/0&&yr(n,o,i)>=r)return r;if(ji(n,o)){if(Ir(t,e))return 0}else if(Ir(e,t))return 0;let s=r;for(const r of t)for(let t=0,n=r.length,o=n-1;t<n;o=t++)for(const n of e)for(let e=0,a=n.length,l=a-1;e<a;l=e++){if(qi(r[o],r[t],n[l],n[e]))return 0;s=Math.min(s,Tr(r[o],r[t],n[l],n[e],i))}return s}function Pr(t,e,i,r,n,o,s){if(null===o||null===s)return;const a=yr(gr(r,o),gr(n,s),i);a<e&&t.push({dist:a,range1:o,range2:s})}function Rr(t,e,i,r,n=1/0){let o=Math.min(r.distance(t[0],i[0][0]),n);if(0===o)return o;const s=new cr([{dist:0,range1:[0,t.length-1],range2:[0,0]}],hr),a=e?50:100,l=_r(i);for(;s.length;){const n=s.pop();if(n.dist>=o)continue;const c=n.range1;if(pr(c)<=a){if(!fr(c,t.length))return NaN;if(e){const e=Mr(t,c,i,r);if(0===(o=Math.min(o,e)))return o}else for(let e=c[0];e<=c[1];++e){const n=Ar(t[e],i,r);if(0===(o=Math.min(o,n)))return o}}else{const i=mr(c,e);if(null!==i[0]){const e=yr(gr(t,i[0]),l,r);e<o&&s.push({dist:e,range1:i[0],range2:[0,0]})}if(null!==i[1]){const e=yr(gr(t,i[1]),l,r);e<o&&s.push({dist:e,range1:i[1],range2:[0,0]})}}}return o}function Or(t,e,i,r,n,o=1/0){let s=Math.min(o,n.distance(t[0],i[0]));if(0===s)return s;const a=new cr([{dist:0,range1:[0,t.length-1],range2:[0,i.length-1]}],hr),l=e?50:100,c=r?50:100;for(;a.length;){const o=a.pop();if(o.dist>=s)continue;const u=o.range1,h=o.range2;if(pr(u)<=l&&pr(h)<=c){if(!fr(u,t.length)||!fr(h,i.length))return NaN;if(e&&r?s=Math.min(s,Er(t,u,i,h,n)):e||r?e&&!r?s=Math.min(s,wr(i,h,t,u,n)):!e&&r&&(s=Math.min(s,wr(t,u,i,h,n))):s=Math.min(s,Sr(t,u,i,h,n)),0===s)return s}else{const o=mr(u,e),l=mr(h,r);Pr(a,s,n,t,i,o[0],l[0]),Pr(a,s,n,t,i,o[0],l[1]),Pr(a,s,n,t,i,o[1],l[0]),Pr(a,s,n,t,i,o[1],l[1])}}return s}function Dr(t,e,i,r,n=1/0){let o=n;const s=gr(t,[0,t.length-1]);for(const n of i)if(!(o!==1/0&&yr(s,gr(n,[0,n.length-1]),r)>=o)&&(o=Math.min(o,Or(t,e,n,!0,r,o)),0===o))return o;return o}function Lr(t,e,i,r,n=1/0){let o=n;const s=gr(t,[0,t.length-1]);for(const n of i){if(o!==1/0&&yr(s,_r(n),r)>=o)continue;const i=Rr(t,e,n,r,o);if(isNaN(i))return i;if(0===(o=Math.min(o,i)))return o}return o}function kr(t){return"Point"===t||"MultiPoint"===t||"LineString"===t||"MultiLineString"===t||"Polygon"===t||"MultiPolygon"===t}class Br{constructor(t,e){this.type=Ve,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(_i(t[1])){const e=t[1];if("FeatureCollection"===e.type){for(let t=0;t<e.features.length;++t)if(kr(e.features[t].geometry.type))return new Br(e,e.features[t].geometry)}else if("Feature"===e.type){if(kr(e.geometry.type))return new Br(e,e.geometry)}else if(kr(e.type))return new Br(e,e)}return e.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const e=t.geometry(),i=t.canonicalID();if(null!=e&&null!=i){if("Point"===t.geometryType())return function(t,e,i){const r=[];for(const i of t)for(const t of i)r.push(vr(t,e));const n=new ar(r[0][1],"meters");return"Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type?Or(r,!1,"Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,n):"MultiLineString"===i.type?Dr(r,!1,i.coordinates,n):"Polygon"===i.type||"MultiPolygon"===i.type?Lr(r,!1,"Polygon"===i.type?[i.coordinates]:i.coordinates,n):null}(e,i,this.geometries);if("LineString"===t.geometryType())return function(t,e,i){const r=[];for(const i of t){const t=[];for(const r of i)t.push(vr(r,e));r.push(t)}const n=new ar(r[0][0][1],"meters");if("Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type)return Dr("Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,r,n);if("MultiLineString"===i.type){let t=1/0;for(let e=0;e<i.coordinates.length;e++){const o=Dr(i.coordinates[e],!0,r,n,t);if(isNaN(o))return o;if(0===(t=Math.min(t,o)))return t}return t}if("Polygon"===i.type||"MultiPolygon"===i.type){let t=1/0;for(let e=0;e<r.length;e++){const o=Lr(r[e],!0,"Polygon"===i.type?[i.coordinates]:i.coordinates,n,t);if(isNaN(o))return o;if(0===(t=Math.min(t,o)))return t}return t}return null}(e,i,this.geometries);if("Polygon"===t.geometryType())return function(t,e,i){const r=[];for(const i of function(t,e){const i=t.length;if(i<=1)return[t];const r=[];let n,o;for(let e=0;e<i;e++){const i=Ui(t[e]);0!==i&&(t[e].area=Math.abs(i),void 0===o&&(o=i<0),o===i<0?(n&&r.push(n),n=[t[e]]):n.push(t[e]))}return n&&r.push(n),r}(t)){const t=[];for(let r=0;r<i.length;++r)t.push(xr(i[r],e));r.push(t)}const n=new ar(r[0][0][0][1],"meters");if("Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type)return Lr("Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,r,n);if("MultiLineString"===i.type){let t=1/0;for(let e=0;e<i.coordinates.length;e++){const o=Lr(i.coordinates[e],!0,r,n,t);if(isNaN(o))return o;if(0===(t=Math.min(t,o)))return t}return t}return"Polygon"===i.type||"MultiPolygon"===i.type?function(t,e,i){let r=1/0;for(const n of t)for(const t of e){const e=Cr(n,t,i,r);if(isNaN(e))return e;if(0===(r=Math.min(r,e)))return r}return r}("Polygon"===i.type?[i.coordinates]:i.coordinates,r,n):null}(e,i,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var Fr=Br;function zr(t){if(t instanceof Bi){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof or)return!1;if(t instanceof Fr)return!1;let e=!0;return t.eachChild(t=>{e&&!zr(t)&&(e=!1)}),e}function Nr(t){if(t instanceof Bi&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(t=>{e&&!Nr(t)&&(e=!1)}),e}function Ur(t){if(t instanceof Bi&&"config"===t.name)return!1;let e=!0;return t.eachChild(t=>{e&&!Ur(t)&&(e=!1)}),e}function Gr(t,e){if(t instanceof Bi&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(t=>{i&&!Gr(t,e)&&(i=!1)}),i}class jr{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const i=t[1];return e.scope.has(i)?new jr(i,e.scope.get(i)):e.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Vr=jr;class Xr{constructor(t,e=[],i,r=new Ge,n=[],o){this.registry=t,this.path=e,this.key=e.map(t=>`[${t}]`).join(""),this.scope=r,this.errors=n,this.expectedType=i,this.options=o}parse(t,e,i,r,n={}){return e||i?this.concat(e,i,r)._parse(t,n):this._parse(t,n)}_parse(t,e){function i(t,e,i){return"assert"===i?new Si(e,[t]):"coerce"===i?new Ri(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r="string"==typeof t[0]?this.registry[t[0]]:void 0;if(r){let n=r.parse(t,this);if(!n)return null;if(this.expectedType){const t=this.expectedType,r=n.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==r.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==r.kind&&"string"!==r.kind){if(this.checkSubtype(t,r))return null}else n=i(n,t,e.typeAnnotation||"coerce");else n=i(n,t,e.typeAnnotation||"assert")}if(!(n instanceof bi)&&"resolvedImage"!==n.type.kind&&function t(e){if(e instanceof Vr)return t(e.boundExpression);if(e instanceof Bi&&"error"===e.name)return!1;if(e instanceof Bi&&"config"===e.name)return!1;if(e instanceof Fi)return!1;if(e instanceof or)return!1;if(e instanceof Fr)return!1;const i=e instanceof Ri||e instanceof Si;let r=!0;return e.eachChild(e=>{r=i?r&&t(e):r&&e instanceof bi}),!!r&&zr(e)&&Gr(e,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}(n)){const e=new Di(this.options);try{n=new bi(n.type,n.evaluate(e))}catch(t){return this.error(t.message),null}}return n}return Ri.parse(["to-array",t],this)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,e,i){const r="number"==typeof t?this.path.concat(t):this.path,n=i?this.scope.concat(i):this.scope;return new Xr(this.registry,r,e||null,n,this.errors,this.options)}error(t,...e){const i=`${this.key}${e.map(t=>`[${t}]`).join("")}`;this.errors.push(new Ne(i,t))}checkSubtype(t,e){const i=ei(t,e);return i&&this.error(i),i}}var Hr=Xr;function qr(t,e){const i=t.length-1;let r,n,o=0,s=i,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),r=t[a],n=t[a+1],r<=e){if(a===i||e<n)return a;o=a+1}else{if(!(r>e))throw new wi("Input is not a number.");s=a-1}return 0}class Wr{constructor(t,e,i){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[t,e]of i)this.labels.push(t),this.outputs.push(e)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const i=e.parse(t[1],1,Ve);if(!i)return null;const r=[];let n=null;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(let i=1;i<t.length;i+=2){const o=1===i?-1/0:t[i],s=t[i+1],a=i,l=i+1;if("number"!=typeof o)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(r.length&&r[r.length-1][0]>=o)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=e.parse(s,l,n);if(!c)return null;n=n||c.type,r.push([o,c])}return new Wr(n,i,r)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const r=this.input.evaluate(t);if(r<=e[0])return i[0].evaluate(t);const n=e.length;return r>=e[n-1]?i[n-1].evaluate(t):i[qr(e,r)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t}}var $r=Wr;function Yr(t,e,i){return t*(1-i)+e*i}function Zr(t,e,i){return t.map((t,r)=>Yr(t,e[r],i))}var Kr=Object.freeze({__proto__:null,array:Zr,color:function(t,e,i){return new hi(Yr(t.r,e.r,i),Yr(t.g,e.g,i),Yr(t.b,e.b,i),Yr(t.a,e.a,i))},number:Yr});const Jr=6/29,Qr=3*Jr*Jr,tn=Math.PI/180,en=180/Math.PI;function rn(t){return t>.008856451679035631?Math.pow(t,1/3):t/Qr+4/29}function nn(t){return t>Jr?t*t*t:Qr*(t-4/29)}function on(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function sn(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function an(t){const e=sn(t.r),i=sn(t.g),r=sn(t.b),n=rn((.4124564*e+.3575761*i+.1804375*r)/.95047),o=rn((.2126729*e+.7151522*i+.072175*r)/1);return{l:116*o-16,a:500*(n-o),b:200*(o-rn((.0193339*e+.119192*i+.9503041*r)/1.08883)),alpha:t.a}}function ln(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,r=isNaN(t.b)?e:e-t.b/200;return e=1*nn(e),i=.95047*nn(i),r=1.08883*nn(r),new hi(on(3.2404542*i-1.5371385*e-.4985314*r),on(-.969266*i+1.8760108*e+.041556*r),on(.0556434*i-.2040259*e+1.0572252*r),t.alpha)}function cn(t,e,i){const r=e-t;return t+i*(r>180||r<-180?r-360*Math.round(r/360):r)}const un={forward:an,reverse:ln,interpolate:function(t,e,i){return{l:Yr(t.l,e.l,i),a:Yr(t.a,e.a,i),b:Yr(t.b,e.b,i),alpha:Yr(t.alpha,e.alpha,i)}}},hn={forward:function(t){const{l:e,a:i,b:r}=an(t),n=Math.atan2(r,i)*en;return{h:n<0?n+360:n,c:Math.sqrt(i*i+r*r),l:e,alpha:t.a}},reverse:function(t){const e=t.h*tn,i=t.c;return ln({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:cn(t.h,e.h,i),c:Yr(t.c,e.c,i),l:Yr(t.l,e.l,i),alpha:Yr(t.alpha,e.alpha,i)}}};var dn=Object.freeze({__proto__:null,hcl:hn,lab:un});class pn{constructor(t,e,i,r,n){this.type=t,this.operator=e,this.interpolation=i,this.input=r,this.labels=[],this.outputs=[];for(const[t,e]of n)this.labels.push(t),this.outputs.push(e)}static interpolationFactor(t,e,i,r){let n=0;if("exponential"===t.name)n=fn(e,t.base,i,r);else if("linear"===t.name)n=fn(e,1,i,r);else if("cubic-bezier"===t.name){const o=t.controlPoints;n=new g(o[0],o[1],o[2],o[3]).solve(fn(e,1,i,r))}return n}static parse(t,e){let[i,r,n,...o]=t;if(!Array.isArray(r)||0===r.length)return e.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const t=r[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:t}}else{if("cubic-bezier"!==r[0])return e.error("Unknown interpolation type "+String(r[0]),1,0);{const t=r.slice(1);if(4!==t.length||t.some(t=>"number"!=typeof t||t<0||t>1))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(n=e.parse(n,2,Ve),!n)return null;const s=[];let a=null;"interpolate-hcl"===i||"interpolate-lab"===i?a=qe:e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType);for(let t=0;t<o.length;t+=2){const i=o[t],r=o[t+1],n=t+3,l=t+4;if("number"!=typeof i)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',n);if(s.length&&s[s.length-1][0]>=i)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',n);const c=e.parse(r,l,a);if(!c)return null;a=a||c.type,s.push([i,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new pn(a,i,r,n,s):e.error(`Type ${Qe(a)} is not interpolatable.`)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const r=this.input.evaluate(t);if(r<=e[0])return i[0].evaluate(t);const n=e.length;if(r>=e[n-1])return i[n-1].evaluate(t);const o=qr(e,r),s=pn.interpolationFactor(this.interpolation,r,e[o],e[o+1]),a=i[o].evaluate(t),l=i[o+1].evaluate(t);return"interpolate"===this.operator?Kr[this.type.kind.toLowerCase()](a,l,s):"interpolate-hcl"===this.operator?hn.reverse(hn.interpolate(hn.forward(a),hn.forward(l),s)):un.reverse(un.interpolate(un.forward(a),un.forward(l),s))}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const e=[this.operator,t,this.input.serialize()];for(let t=0;t<this.labels.length;t++)e.push(this.labels[t],this.outputs[t].serialize());return e}}function fn(t,e,i,r){const n=r-i,o=t-i;return 0===n?0:1===e?o/n:(Math.pow(e,o)-1)/(Math.pow(e,n)-1)}var mn=pn;class gn{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let i=null;const r=e.expectedType;r&&"value"!==r.kind&&(i=r);const n=[];for(const r of t.slice(1)){const t=e.parse(r,1+n.length,i,void 0,{typeAnnotation:"omit"});if(!t)return null;i=i||t.type,n.push(t)}const o=r&&n.some(t=>ei(r,t.type));return new gn(o?$e:i,n)}evaluate(t){let e,i=null,r=0;for(const n of this.args){if(r++,i=n.evaluate(t),i&&i instanceof mi&&!i.available&&(e||(e=i),i=null,r===this.args.length))return e;if(null!==i)break}return i}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(e=>{t.push(e.serialize())}),t}}var _n=gn;class yn{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const i=[];for(let r=1;r<t.length-1;r+=2){const n=t[r];if("string"!=typeof n)return e.error(`Expected string, but found ${typeof n} instead.`,r);if(/[^a-zA-Z0-9_]/.test(n))return e.error("Variable names must contain only alphanumeric characters or '_'.",r);const o=e.parse(t[r+1],r+1);if(!o)return null;i.push([n,o])}const r=e.parse(t[t.length-1],t.length-1,e.expectedType,i);return r?new yn(i,r):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[e,i]of this.bindings)t.push(e,i.serialize());return t.push(this.result.serialize()),t}}var vn=yn;class xn{constructor(t,e,i){this.type=t,this.index=e,this.input=i}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Ve),r=e.parse(t[2],2,Je(e.expectedType||$e));return i&&r?new xn(r.type.itemType,i,r):null}evaluate(t){const e=this.index.evaluate(t),i=this.input.evaluate(t);if(e<0)throw new wi(`Array index out of bounds: ${e} < 0.`);if(e>=i.length)throw new wi(`Array index out of bounds: ${e} > ${i.length-1}.`);if(e!==Math.floor(e))throw new wi(`Array index must be an integer, but found ${e} instead.`);return i[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var bn=xn;class wn{constructor(t,e){this.type=He,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,$e),r=e.parse(t[2],2,$e);return i&&r?ii(i.type,[He,Xe,Ve,je,$e])?new wn(i,r):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qe(i.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(null==i)return!1;if(!ri(e,["boolean","string","number","null"]))throw new wi(`Expected first argument to be of type boolean, string, number or null, but found ${Qe(yi(e))} instead.`);if(!ri(i,["string","array"]))throw new wi(`Expected second argument to be of type array or string, but found ${Qe(yi(i))} instead.`);return i.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Tn=wn;class En{constructor(t,e,i){this.type=Ve,this.needle=t,this.haystack=e,this.fromIndex=i}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,$e),r=e.parse(t[2],2,$e);if(!i||!r)return null;if(!ii(i.type,[He,Xe,Ve,je,$e]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qe(i.type)} instead`);if(4===t.length){const n=e.parse(t[3],3,Ve);return n?new En(i,r,n):null}return new En(i,r)}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!ri(e,["boolean","string","number","null"]))throw new wi(`Expected first argument to be of type boolean, string, number or null, but found ${Qe(yi(e))} instead.`);if(!ri(i,["string","array"]))throw new wi(`Expected second argument to be of type array or string, but found ${Qe(yi(i))} instead.`);if(this.fromIndex){const r=this.fromIndex.evaluate(t);return i.indexOf(e,r)}return i.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Sn=En;class An{constructor(t,e,i,r,n,o){this.inputType=t,this.type=e,this.input=i,this.cases=r,this.outputs=n,this.otherwise=o}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let i,r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);const n={},o=[];for(let s=2;s<t.length-1;s+=2){let a=t[s];const l=t[s+1];Array.isArray(a)||(a=[a]);const c=e.concat(s);if(0===a.length)return c.error("Expected at least one branch label.");for(const t of a){if("number"!=typeof t&&"string"!=typeof t)return c.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,yi(t)))return null}else i=yi(t);if(void 0!==n[String(t)])return c.error("Branch labels must be unique.");n[String(t)]=o.length}const u=e.parse(l,s,r);if(!u)return null;r=r||u.type,o.push(u)}const s=e.parse(t[1],1,$e);if(!s)return null;const a=e.parse(t[t.length-1],t.length-1,r);return a?"value"!==s.type.kind&&e.concat(1).checkSubtype(i,s.type)?null:new An(i,r,s,n,o,a):null}evaluate(t){const e=this.input.evaluate(t);return(yi(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],e=Object.keys(this.cases).sort(),i=[],r={};for(const t of e){const e=r[this.cases[t]];void 0===e?(r[this.cases[t]]=i.length,i.push([this.cases[t],[t]])):i[e][1].push(t)}const n=t=>"number"===this.inputType.kind?Number(t):t;for(const[e,r]of i)t.push(1===r.length?n(r[0]):r.map(n)),t.push(this.outputs[e].serialize());return t.push(this.otherwise.serialize()),t}}var Mn=An;class In{constructor(t,e,i){this.type=t,this.branches=e,this.otherwise=i}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);const r=[];for(let n=1;n<t.length-1;n+=2){const o=e.parse(t[n],n,He);if(!o)return null;const s=e.parse(t[n+1],n+1,i);if(!s)return null;r.push([o,s]),i=i||s.type}const n=e.parse(t[t.length-1],t.length-1,i);return n?new In(i,r,n):null}evaluate(t){for(const[e,i]of this.branches)if(e.evaluate(t))return i.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,i]of this.branches)t(e),t(i);t(this.otherwise)}outputDefined(){return this.branches.every(([t,e])=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(e=>{t.push(e.serialize())}),t}}var Cn=In;class Pn{constructor(t,e,i,r){this.type=t,this.input=e,this.beginIndex=i,this.endIndex=r}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,$e),r=e.parse(t[2],2,Ve);if(!i||!r)return null;if(!ii(i.type,[Je($e),Xe,$e]))return e.error(`Expected first argument to be of type array or string, but found ${Qe(i.type)} instead`);if(4===t.length){const n=e.parse(t[3],3,Ve);return n?new Pn(i.type,i,r,n):null}return new Pn(i.type,i,r)}evaluate(t){const e=this.input.evaluate(t),i=this.beginIndex.evaluate(t);if(!ri(e,["string","array"]))throw new wi(`Expected first argument to be of type array or string, but found ${Qe(yi(e))} instead.`);if(this.endIndex){const r=this.endIndex.evaluate(t);return e.slice(i,r)}return e.slice(i)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Rn=Pn;function On(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Dn(t,e,i,r){return 0===r.compare(e,i)}function Ln(t,e,i){const r="=="!==t&&"!="!==t;return class n{constructor(t,e,i){this.type=He,this.lhs=t,this.rhs=e,this.collator=i,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const i=t[0];let o=e.parse(t[1],1,$e);if(!o)return null;if(!On(i,o.type))return e.concat(1).error(`"${i}" comparisons are not supported for type '${Qe(o.type)}'.`);let s=e.parse(t[2],2,$e);if(!s)return null;if(!On(i,s.type))return e.concat(2).error(`"${i}" comparisons are not supported for type '${Qe(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error(`Cannot compare types '${Qe(o.type)}' and '${Qe(s.type)}'.`);r&&("value"===o.type.kind&&"value"!==s.type.kind?o=new Si(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new Si(o.type,[s])));let a=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error("Cannot use collator to compare non-string types.");if(a=e.parse(t[3],3,Ye),!a)return null}return new n(o,s,a)}evaluate(n){const o=this.lhs.evaluate(n),s=this.rhs.evaluate(n);if(r&&this.hasUntypedArgument){const e=yi(o),i=yi(s);if(e.kind!==i.kind||"string"!==e.kind&&"number"!==e.kind)throw new wi(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${i.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const t=yi(o),i=yi(s);if("string"!==t.kind||"string"!==i.kind)return e(n,o,s)}return this.collator?i(n,o,s,this.collator.evaluate(n)):e(n,o,s)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}serialize(){const e=[t];return this.eachChild(t=>{e.push(t.serialize())}),e}}}const kn=Ln("==",(function(t,e,i){return e===i}),Dn),Bn=Ln("!=",(function(t,e,i){return e!==i}),(function(t,e,i,r){return!Dn(0,e,i,r)})),Fn=Ln("<",(function(t,e,i){return e<i}),(function(t,e,i,r){return r.compare(e,i)<0})),zn=Ln(">",(function(t,e,i){return e>i}),(function(t,e,i,r){return r.compare(e,i)>0})),Nn=Ln("<=",(function(t,e,i){return e<=i}),(function(t,e,i,r){return r.compare(e,i)<=0})),Un=Ln(">=",(function(t,e,i){return e>=i}),(function(t,e,i,r){return r.compare(e,i)>=0}));class Gn{constructor(t,e,i,r,n,o){this.type=Xe,this.number=t,this.locale=e,this.currency=i,this.unit=r,this.minFractionDigits=n,this.maxFractionDigits=o}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,Ve);if(!i)return null;const r=t[2];if("object"!=typeof r||Array.isArray(r))return e.error("NumberFormat options argument must be an object.");let n=null;if(r.locale&&(n=e.parse(r.locale,1,Xe),!n))return null;let o=null;if(r.currency&&(o=e.parse(r.currency,1,Xe),!o))return null;let s=null;if(r.unit&&(s=e.parse(r.unit,1,Xe),!s))return null;let a=null;if(r["min-fraction-digits"]&&(a=e.parse(r["min-fraction-digits"],1,Ve),!a))return null;let l=null;return r["max-fraction-digits"]&&(l=e.parse(r["max-fraction-digits"],1,Ve),!l)?null:new Gn(i,n,o,s,a,l)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class jn{constructor(t){this.type=Ve,this.input=t}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const i=e.parse(t[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?e.error(`Expected argument of type string or array, but found ${Qe(i.type)} instead.`):new jn(i):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new wi(`Expected value to be of type string or array, but found ${Qe(yi(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(e=>{t.push(e.serialize())}),t}}function Vn(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Xn={"==":kn,"!=":Bn,">":zn,"<":Fn,">=":Un,"<=":Nn,array:Si,at:bn,boolean:Si,case:Cn,coalesce:_n,collator:Fi,format:Ai,image:Mi,in:Tn,"index-of":Sn,interpolate:mn,"interpolate-hcl":mn,"interpolate-lab":mn,length:jn,let:vn,literal:bi,match:Mn,number:Si,"number-format":Gn,object:Si,slice:Rn,step:$r,string:Si,"to-boolean":Ri,"to-color":Ri,"to-number":Ri,"to-string":Ri,var:Vr,within:or,distance:Fr};function Hn(t,[e,i,r,n]){e=e.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);const o=n?n.evaluate(t):1,s=gi(e,i,r,o);if(s)throw new wi(s);return new hi(e/255*o,i/255*o,r/255*o,o)}function qn(t,[e,i,r,n]){e=e.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);const o=n?n.evaluate(t):1,s=function(t,e,i,r){return"number"==typeof t&&t>=0&&t<=360?"number"==typeof e&&e>=0&&e<=100&&"number"==typeof i&&i>=0&&i<=100?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid hsla value [${[t,e,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof r?[t,e,i,r]:[t,e,i]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof r?[t,e,i,r]:[t,e,i]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,r,o);if(s)throw new wi(s);const a=`hsla(${e}, ${i}%, ${r}%, ${o})`,l=hi.parse(a);if(!l)throw new wi("Failed to parse HSLA color: "+a);return l}function Wn(t,e){return t in e}function $n(t,e){const i=e[t];return void 0===i?null:i}function Yn(t,e){switch(t){case"string":return String(e);case"number":return+e;case"boolean":return!!e;case"color":return hi.parse(e)}return e}function Zn(t,e,i,r){return void 0!==r&&(t=r*Math.round(t/r)),void 0!==e&&t<e&&(t=e),void 0!==i&&t>i&&(t=i),t}function Kn(t,e,i){i.length&&(e+=""+i);const r=t.getConfig(e);if(!r)return null;const{type:n,value:o,values:s,minValue:a,maxValue:l,stepValue:c}=r,u=r.default.evaluate(t);let h=o?o.evaluate(t):u;return n&&(h=Yn(n,h)),void 0!==o&&void 0!==h&&s&&!s.includes(h)&&(h=u,n&&(h=Yn(n,h))),void 0===h||void 0===a&&void 0===l&&void 0===c||("number"==typeof h?h=Zn(h,a,l,c):Array.isArray(h)&&(h=h.map(t=>"number"==typeof t?Zn(t,a,l,c):t))),h}function Jn(t){return{type:t}}Bi.register(Xn,{error:[{kind:"error"},[Xe],(t,[e])=>{throw new wi(e.evaluate(t))}],typeof:[Xe,[$e],(t,[e])=>Qe(yi(e.evaluate(t)))],"to-rgba":[Je(Ve,4),[qe],(t,[e])=>e.evaluate(t).toArray()],rgb:[qe,[Ve,Ve,Ve],Hn],rgba:[qe,[Ve,Ve,Ve,Ve],Hn],hsl:[qe,[Ve,Ve,Ve],qn],hsla:[qe,[Ve,Ve,Ve,Ve],qn],has:{type:He,overloads:[[[Xe],(t,[e])=>Wn(e.evaluate(t),t.properties())],[[Xe,We],(t,[e,i])=>Wn(e.evaluate(t),i.evaluate(t))]]},get:{type:$e,overloads:[[[Xe],(t,[e])=>$n(e.evaluate(t),t.properties())],[[Xe,We],(t,[e,i])=>$n(e.evaluate(t),i.evaluate(t))]]},config:{type:$e,overloads:[[[Xe],(t,[e])=>Kn(t,e.evaluate(t),"")],[[Xe,Xe],(t,[e,i])=>Kn(t,e.evaluate(t),i.evaluate(t))]]},"feature-state":[$e,[Xe],(t,[e])=>$n(e.evaluate(t),t.featureState||{})],properties:[We,[],t=>t.properties()],"geometry-type":[Xe,[],t=>t.geometryType()],id:[$e,[],t=>t.id()],zoom:[Ve,[],t=>t.globals.zoom],pitch:[Ve,[],t=>t.globals.pitch||0],"distance-from-center":[Ve,[],t=>t.distanceFromCenter()],"measure-light":[Ve,[Xe],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[Ve,[],t=>t.globals.heatmapDensity||0],"line-progress":[Ve,[],t=>t.globals.lineProgress||0],"raster-value":[Ve,[],t=>t.globals.rasterValue||0],"sky-radial-progress":[Ve,[],t=>t.globals.skyRadialProgress||0],accumulated:[$e,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Ve,Jn(Ve),(t,e)=>{let i=0;for(const r of e)i+=r.evaluate(t);return i}],"*":[Ve,Jn(Ve),(t,e)=>{let i=1;for(const r of e)i*=r.evaluate(t);return i}],"-":{type:Ve,overloads:[[[Ve,Ve],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[Ve],(t,[e])=>-e.evaluate(t)]]},"/":[Ve,[Ve,Ve],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[Ve,[Ve,Ve],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[Ve,[],()=>Math.LN2],pi:[Ve,[],()=>Math.PI],e:[Ve,[],()=>Math.E],"^":[Ve,[Ve,Ve],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[Ve,[Ve],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Ve,[Ve],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Ve,[Ve],(t,[e])=>Math.log(e.evaluate(t))],log2:[Ve,[Ve],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Ve,[Ve],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Ve,[Ve],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Ve,[Ve],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Ve,[Ve],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Ve,[Ve],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Ve,[Ve],(t,[e])=>Math.atan(e.evaluate(t))],min:[Ve,Jn(Ve),(t,e)=>Math.min(...e.map(e=>e.evaluate(t)))],max:[Ve,Jn(Ve),(t,e)=>Math.max(...e.map(e=>e.evaluate(t)))],abs:[Ve,[Ve],(t,[e])=>Math.abs(e.evaluate(t))],round:[Ve,[Ve],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[Ve,[Ve],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Ve,[Ve],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[He,[Xe,$e],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[He,[$e],(t,[e])=>t.id()===e.value],"filter-type-==":[He,[Xe],(t,[e])=>t.geometryType()===e.value],"filter-<":[He,[Xe,$e],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r<n}],"filter-id-<":[He,[$e],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<r}],"filter->":[He,[Xe,$e],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r>n}],"filter-id->":[He,[$e],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>r}],"filter-<=":[He,[Xe,$e],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r<=n}],"filter-id-<=":[He,[$e],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<=r}],"filter->=":[He,[Xe,$e],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r>=n}],"filter-id->=":[He,[$e],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>=r}],"filter-has":[He,[$e],(t,[e])=>e.value in t.properties()],"filter-has-id":[He,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[He,[Je(Xe)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[He,[Je($e)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[He,[Xe,Je($e)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[He,[Xe,Je($e)],(t,[e,i])=>function(t,e,i,r){for(;i<=r;){const n=i+r>>1;if(e[n]===t)return!0;e[n]>t?r=n-1:i=n+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:He,overloads:[[[He,He],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[Jn(He),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:He,overloads:[[[He,He],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[Jn(He),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[He,[He],(t,[e])=>!e.evaluate(t)],"is-supported-script":[He,[Xe],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[Xe,[Xe],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Xe,[Xe],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Xe,Jn($e),(t,e)=>e.map(e=>vi(e.evaluate(t))).join("")],"resolved-locale":[Xe,[Ye],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[Ve,[Ve,Ve,$e],(t,e)=>{const[i,r,n]=e.map(e=>e.evaluate(t));if(i>r)return i;if(i===r)return i;let o;if("string"==typeof n)o=function(t){let e=0;if(0===t.length)return e;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e&=e;return e}(n);else{if("number"!=typeof n)throw new wi("Invalid seed input: "+n);o=n}return i+Vn(o)()*(r-i)}]});var Qn=Xn;function to(t){return{result:"success",value:t}}function eo(t){return{result:"error",value:t}}function io(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function ro(t){return"data-driven"===t["property-type"]}function no(t){return io(t.expression,"measure-light")}function oo(t){return io(t.expression,"zoom")}function so(t){return!!t.expression&&t.expression.interpolated}function ao(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function lo(t){return t}function co(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function uo(t,e,i,r,n){return co(typeof i===n?r[i]:void 0,t.default,e.default)}function ho(t,e,i){if("number"!==Ii(i))return co(t.default,e.default);const r=t.stops.length;if(1===r)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];const n=qr(t.stops.map(t=>t[0]),i);return t.stops[n][1]}function po(t,e,i){const r=void 0!==t.base?t.base:1;if("number"!==Ii(i))return co(t.default,e.default);const n=t.stops.length;if(1===n)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[n-1][0])return t.stops[n-1][1];const o=qr(t.stops.map(t=>t[0]),i),s=function(t,e,i,r){const n=r-i,o=t-i;return 0===n?0:1===e?o/n:(Math.pow(e,o)-1)/(Math.pow(e,n)-1)}(i,r,t.stops[o][0],t.stops[o+1][0]),a=t.stops[o][1],l=t.stops[o+1][1];let c=Kr[e.type]||lo;if(t.colorSpace&&"rgb"!==t.colorSpace){const e=dn[t.colorSpace];c=(t,i)=>e.reverse(e.interpolate(e.forward(t),e.forward(i),s))}return"function"==typeof a.evaluate?{evaluate(...t){const e=a.evaluate.apply(void 0,t),i=l.evaluate.apply(void 0,t);if(void 0!==e&&void 0!==i)return c(e,i,s)}}:c(a,l,s)}function fo(t,e,i){return"color"===e.type?i=hi.parse(i):"formatted"===e.type?i=fi.fromString(i.toString()):"resolvedImage"===e.type?i=mi.fromString(i.toString()):Ii(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),co(i,t.default,e.default)}class mo{constructor(t,e,i){this.expression=t,this._warningHistory={},this._evaluator=new Di(i),this._defaultValue=e?function(t){return"color"===t.type&&(ao(t.default)||Array.isArray(t.default))?new hi(0,0,0,0):"color"===t.type?hi.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,i,r,n,o,s,a){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=i,this._evaluator.canonical=r||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(t,e,i,r,n,o,s,a){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=i||null,this._evaluator.canonical=r||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!=t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new wi(`Expected value to be one of ${Object.keys(this._enumValues).map(t=>JSON.stringify(t)).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}}}function go(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Qn}function _o(t,e,i){const r=new Hr(Qn,[],e?function(t){const e={color:qe,string:Xe,number:Ve,enum:Xe,boolean:He,formatted:Ze,resolvedImage:Ke};return"array"===t.type?Je(e[t.value]||$e,t.length):e[t.type]}(e):void 0,void 0,void 0,i),n=r.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return n?to(new mo(n,e,i)):eo(r.errors)}class yo{constructor(t,e,i){this.kind=t,this._styleExpression=e,this.isLightConstant=i,this.isStateDependent="constant"!==t&&!Nr(e.expression),this.isConfigDependent=!Ur(e.expression)}evaluateWithoutErrorHandling(t,e,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,r,n,o)}evaluate(t,e,i,r,n,o){return this._styleExpression.evaluate(t,e,i,r,n,o)}}class vo{constructor(t,e,i,r,n){this.kind=t,this.zoomStops=i,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Nr(e.expression),this.isLightConstant=n,this.isConfigDependent=!Ur(e.expression),this.interpolationType=r}evaluateWithoutErrorHandling(t,e,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,r,n,o)}evaluate(t,e,i,r,n,o){return this._styleExpression.evaluate(t,e,i,r,n,o)}interpolationFactor(t,e,i){return this.interpolationType?mn.interpolationFactor(this.interpolationType,t,e,i):0}}function xo(t,e,i){if("error"===(t=_o(t,e,i)).result)return t;const r=t.value.expression,n=zr(r);if(!n&&!ro(e))return eo([new Ne("","data expressions not supported")]);const o=Gr(r,["zoom","pitch","distance-from-center"]);if(!o&&!oo(e))return eo([new Ne("","zoom expressions not supported")]);const s=Gr(r,["measure-light"]);if(!s&&!no(e))return eo([new Ne("","measure-light expression not supported")]);const a=e.expression&&e.expression.relaxZoomRestriction,l=function t(e){let i=null;if(e instanceof vn)i=t(e.result);else if(e instanceof _n){for(const r of e.args)if(i=t(r),i)break}else(e instanceof $r||e instanceof mn)&&e.input instanceof Bi&&"zoom"===e.input.name&&(i=e);return i instanceof Ne||e.eachChild(e=>{const r=t(e);r instanceof Ne?i=r:i&&r&&i!==r&&(i=new Ne("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}(r);return l||o||a?l instanceof Ne?eo([l]):l instanceof mn&&!so(e)?eo([new Ne("",'"interpolate" expressions cannot be used with this property')]):to(l?new vo(n?"camera":"composite",t.value,l.labels,l instanceof mn?l.interpolation:void 0,s):new yo(n?"constant":"source",t.value,s)):eo([new Ne("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class bo{constructor(t,e){this._parameters=t,this._specification=e,ke(this,function t(e,i){const r="color"===i.type,n=e.stops&&"object"==typeof e.stops[0][0],o=n||!(n||void 0!==e.property),s=e.type||(so(i)?"exponential":"interval");if(r&&((e=ke({},e)).stops&&(e.stops=e.stops.map(t=>[t[0],hi.parse(t[1])])),e.default=hi.parse(e.default?e.default:i.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!dn[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);let a,l,c;if("exponential"===s)a=po;else if("interval"===s)a=ho;else if("categorical"===s){a=uo,l=Object.create(null);for(const t of e.stops)l[t[0]]=t[1];c=typeof e.stops[0][0]}else{if("identity"!==s)throw new Error(`Unknown function type "${s}"`);a=fo}if(n){const r={},n=[];for(let t=0;t<e.stops.length;t++){const i=e.stops[t],o=i[0].zoom;void 0===r[o]&&(r[o]={zoom:o,type:e.type,property:e.property,default:e.default,stops:[]},n.push(o)),r[o].stops.push([i[0].value,i[1]])}const o=[];for(const e of n)o.push([r[e].zoom,t(r[e],i)]);const s={name:"linear"};return{kind:"composite",interpolationType:s,interpolationFactor:mn.interpolationFactor.bind(void 0,s),zoomStops:o.map(t=>t[0]),evaluate:({zoom:t},r)=>po({stops:o,base:e.base},i,t).evaluate(t,r)}}if(o){const t="exponential"===s?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:t,interpolationFactor:mn.interpolationFactor.bind(void 0,t),zoomStops:e.stops.map(t=>t[0]),evaluate:({zoom:t})=>a(e,i,t,l,c)}}return{kind:"source",evaluate(t,r){const n=r&&r.properties?r.properties[e.property]:void 0;return void 0===n?co(e.default,i.default):a(e,i,n,l,c)}}}(this._parameters,this._specification))}static deserialize(t){return new bo(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function wo(t){const e=t.key,i=t.value,r=t.valueSpec||{},n=t.objectElementValidators||{},o=t.style,s=t.styleSpec;let a=[];const l=Ii(i);if("object"!==l)return[new De(e,i,`object expected, ${l} found`)];for(const t in i){const l=t.split(".")[0];let c;n[l]?c=n[l]:r[l]?c=ts:n["*"]?c=n["*"]:r["*"]&&(c=ts),c?a=a.concat(c({key:(e?e+".":e)+t,value:i[t],valueSpec:r[l]||r["*"],style:o,styleSpec:s,object:i,objectKey:t},i)):a.push(new Le(e,i[t],`unknown property "${t}"`))}for(const t in r)n[t]||r[t].required&&void 0===r[t].default&&void 0===i[t]&&a.push(new De(e,i,`missing required property "${t}"`));return a}function To(t){const e=t.value,i=t.valueSpec,r=t.style,n=t.styleSpec,o=t.key,s=t.arrayElementValidator||ts;if("array"!==Ii(e))return[new De(o,e,`array expected, ${Ii(e)} found`)];if(i.length&&e.length!==i.length)return[new De(o,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new De(o,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let a={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};n.$version<7&&(a.function=i.function),"object"===Ii(i.value)&&(a=i.value);let l=[];for(let t=0;t<e.length;t++)l=l.concat(s({array:e,arrayIndex:t,value:e[t],valueSpec:a,style:r,styleSpec:n,key:`${o}[${t}]`},!0));return l}function Eo(t){const e=t.key,i=t.value,r=t.valueSpec;let n=Ii(i);if("number"===n&&i!=i&&(n="NaN"),"number"!==n)return[new De(e,i,`number expected, ${n} found`)];if("minimum"in r){let n=r.minimum;if("array"===Ii(r.minimum)&&(n=r.minimum[t.arrayIndex]),i<n)return[new De(e,i,`${i} is less than the minimum value ${n}`)]}if("maximum"in r){let n=r.maximum;if("array"===Ii(r.maximum)&&(n=r.maximum[t.arrayIndex]),i>n)return[new De(e,i,`${i} is greater than the maximum value ${n}`)]}return[]}function So(t){const e=t.valueSpec,i=Be(t.value.type);let r,n,o,s={};const a="categorical"!==i&&void 0===t.value.property,l=!a,c="array"===Ii(t.value.stops)&&"array"===Ii(t.value.stops[0])&&"object"===Ii(t.value.stops[0][0]),u=wo({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===i)return[new De(t.key,t.value,'identity function may not have a "stops" property')];let e=[];const r=t.value;return e=e.concat(To({key:t.key,value:r,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===Ii(r)&&0===r.length&&e.push(new De(t.key,r,"array must have at least one stop")),e},default:function(t){return ts({key:t.key,value:t.value,valueSpec:e,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===i&&a&&u.push(new De(t.key,t.value,'missing required property "property"')),"identity"===i||t.value.stops||u.push(new De(t.key,t.value,'missing required property "stops"')),"exponential"===i&&t.valueSpec.expression&&!so(t.valueSpec)&&u.push(new De(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(l&&!ro(t.valueSpec)?u.push(new De(t.key,t.value,"property functions not supported")):a&&!oo(t.valueSpec)&&u.push(new De(t.key,t.value,"zoom functions not supported"))),"categorical"!==i&&!c||void 0!==t.value.property||u.push(new De(t.key,t.value,'"property" property is required')),u;function h(t){let i=[];const r=t.value,a=t.key;if("array"!==Ii(r))return[new De(a,r,`array expected, ${Ii(r)} found`)];if(2!==r.length)return[new De(a,r,`array length 2 expected, length ${r.length} found`)];if(c){if("object"!==Ii(r[0]))return[new De(a,r,`object expected, ${Ii(r[0])} found`)];if(void 0===r[0].zoom)return[new De(a,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new De(a,r,"object stop key must have value")];const e=Be(r[0].zoom);if("number"!=typeof e)return[new De(a,r[0].zoom,"stop zoom values must be numbers")];if(o&&o>e)return[new De(a,r[0].zoom,"stop zoom values must appear in ascending order")];e!==o&&(o=e,n=void 0,s={}),i=i.concat(wo({key:a+"[0]",value:r[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:Eo,value:d}}))}else i=i.concat(d({key:a+"[0]",value:r[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},r));return go(Fe(r[1]))?i.concat([new De(a+"[1]",r[1],"expressions are not allowed in function stops.")]):i.concat(ts({key:a+"[1]",value:r[1],valueSpec:e,style:t.style,styleSpec:t.styleSpec}))}function d(t,o){const a=Ii(t.value),l=Be(t.value),c=null!==t.value?t.value:o;if(r){if(a!==r)return[new De(t.key,c,`${a} stop domain type must match previous stop domain type ${r}`)]}else r=a;if("number"!==a&&"string"!==a&&"boolean"!==a&&"number"!=typeof l&&"string"!=typeof l&&"boolean"!=typeof l)return[new De(t.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==i){let r=`number expected, ${a} found`;return ro(e)&&void 0===i&&(r+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new De(t.key,c,r)]}return"categorical"!==i||"number"!==a||"number"==typeof l&&isFinite(l)&&Math.floor(l)===l?"categorical"!==i&&"number"===a&&"number"==typeof l&&"number"==typeof n&&void 0!==n&&l<n?[new De(t.key,c,"stop domain values must appear in ascending order")]:(n=l,"categorical"===i&&l in s?[new De(t.key,c,"stop domain values must be unique")]:(s[l]=!0,[])):[new De(t.key,c,"integer expected, found "+String(l))]}}function Ao(t){const e=("property"===t.expressionContext?xo:_o)(Fe(t.value),t.valueSpec);if("error"===e.result)return e.value.map(e=>new De(`${t.key}${e.key}`,t.value,e.message));const i=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!i.outputDefined())return[new De(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Nr(i))return[new De(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return function t(e,i){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const t of i.valueSpec.expression.parameters)r.delete(t);if(0===r.size)return[];const n=[];return e instanceof Bi&&r.has(e.name)?[new De(i.key,i.value,`["${e.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(e.eachChild(e=>{n.push(...t(e,i))}),n)}(i,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Gr(i,["zoom","feature-state"]))return[new De(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!zr(i))return[new De(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Mo(t){const e=t.key,i=t.value,r=t.valueSpec,n=[];return Array.isArray(r.values)?-1===r.values.indexOf(Be(i))&&n.push(new De(e,i,`expected one of [${r.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(r.values).indexOf(Be(i))&&n.push(new De(e,i,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(i)} found`)),n}function Io(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Io(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Co(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Io(t)||(t=Lo(t));const i=t;let r=!0;try{r=function(t){if(!Po(t))return t;let e=Fe(t);return function t(e){let i=!1;const r=[];if("case"===e[0]){for(let t=1;t<e.length-1;t+=2)i=i||Po(e[t]),r.push(e[t+1]);r.push(e[e.length-1])}else if("match"===e[0]){i=i||Po(e[1]);for(let t=2;t<e.length-1;t+=2)r.push(e[t+1]);r.push(e[e.length-1])}else if("step"===e[0]){i=i||Po(e[1]);for(let t=1;t<e.length-1;t+=2)r.push(e[t+1])}i&&(e.length=0,e.push("any",...r));for(let i=1;i<e.length;i++)t(e[i])}(e),e=function t(e){if(!Array.isArray(e))return e;const i=function(t){if(Ro.has(t[0]))for(let e=1;e<t.length;e++)if(Po(t[e]))return!0;return t}(e);return!0===i?i:i.map(e=>t(e))}(e),e}(i)}catch(t){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const n=Oe["filter_"+e],o=_o(r,n);let s=null;if("error"===o.result)throw new Error(o.value.map(t=>`${t.key}: ${t.message}`).join(", "));s=(t,e,i)=>o.value.evaluate(t,e,{},i);let a=null,l=null;if(r!==i){const t=_o(i,n);if("error"===t.result)throw new Error(t.value.map(t=>`${t.key}: ${t.message}`).join(", "));a=(e,i,r,n,o)=>t.value.evaluate(e,i,{},r,void 0,void 0,n,o),l=!zr(t.value.expression)}return{filter:s,dynamicFilter:a||void 0,needGeometry:Do(r),needFeature:!!l}}function Po(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let e=1;e<t.length;e++)if(Po(t[e]))return!0;return!1}const Ro=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Oo(t,e){return t<e?-1:t>e?1:0}function Do(t){if(!Array.isArray(t))return!1;if("within"===t[0]||"distance"===t[0])return!0;for(let e=1;e<t.length;e++)if(Do(t[e]))return!0;return!1}function Lo(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?ko(t[1],t[2],"=="):"!="===e?zo(ko(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?ko(t[1],t[2],e):"any"===e?(i=t.slice(1),["any"].concat(i.map(Lo))):"all"===e?["all"].concat(t.slice(1).map(Lo)):"none"===e?["all"].concat(t.slice(1).map(Lo).map(zo)):"in"===e?Bo(t[1],t.slice(2)):"!in"===e?zo(Bo(t[1],t.slice(2))):"has"===e?Fo(t[1]):"!has"!==e||zo(Fo(t[1]));var i}function ko(t,e,i){switch(t){case"$type":return["filter-type-"+i,e];case"$id":return["filter-id-"+i,e];default:return["filter-"+i,t,e]}}function Bo(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Oo)]]:["filter-in-small",t,["literal",e]]}}function Fo(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function zo(t){return["!",t]}function No(t){return Io(Fe(t.value))?Ao(ke({},t,{expressionContext:"filter",valueSpec:t.styleSpec["filter_"+(t.layerType||"fill")]})):function t(e){const i=e.value,r=e.key;if("array"!==Ii(i))return[new De(r,i,`array expected, ${Ii(i)} found`)];const n=e.styleSpec;let o,s=[];if(i.length<1)return[new De(r,i,"filter array must have at least 1 element")];switch(s=s.concat(Mo({key:r+"[0]",value:i[0],valueSpec:n.filter_operator,style:e.style,styleSpec:e.styleSpec})),Be(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===Be(i[1])&&s.push(new De(r,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&s.push(new De(r,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(o=Ii(i[1]),"string"!==o&&s.push(new De(r+"[1]",i[1],`string expected, ${o} found`)));for(let t=2;t<i.length;t++)o=Ii(i[t]),"$type"===Be(i[1])?s=s.concat(Mo({key:`${r}[${t}]`,value:i[t],valueSpec:n.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==o&&"number"!==o&&"boolean"!==o&&s.push(new De(`${r}[${t}]`,i[t],`string, number, or boolean expected, ${o} found`));break;case"any":case"all":case"none":for(let n=1;n<i.length;n++)s=s.concat(t({key:`${r}[${n}]`,value:i[n],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":o=Ii(i[1]),2!==i.length?s.push(new De(r,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==o&&s.push(new De(r+"[1]",i[1],`string expected, ${o} found`))}return s}(t)}function Uo(t,e){const i=t.key,r=t.style,n=t.layer,o=t.styleSpec,s=t.value,a=t.objectKey,l=o[`${e}_${t.layerType}`];if(!l)return[];const c=a.match(/^(.*)-transition$/);if("paint"===e&&c&&l[c[1]]&&l[c[1]].transition)return ts({key:i,value:s,valueSpec:o.transition,style:r,styleSpec:o});const u=t.valueSpec||l[a];if(!u)return[new Le(i,s,`unknown property "${a}"`)];let h;if("string"===Ii(s)&&ro(u)&&!u.tokens&&(h=/^{([^}]+)}$/.exec(s))){const t=`\`{ "type": "identity", "property": ${h?JSON.stringify(h[1]):'"_"'} }\``;return[new De(i,s,`"${a}" does not support interpolation syntax\nUse an identity property function instead: ${t}.`)]}const d=[];if("symbol"===t.layerType)"text-field"!==a||!r||r.glyphs||r.imports||d.push(new De(i,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&ao(Fe(s))&&"identity"===Be(s.type)&&d.push(new De(i,s,'"text-font" does not support identity functions'));else if("model"===t.layerType&&"paint"===e&&n&&n.layout&&n.layout.hasOwnProperty("model-id")&&ro(u)&&(no(u)||oo(u))){const t=xo(Fe(s),u),e=t.value.expression||t.value._styleExpression.expression;e&&!Gr(e,["measure-light"])&&("model-emissive-strength"===a&&zr(e)&&Nr(e)||d.push(new De(i,s,a+" does not support measure-light expressions when the model layer source is vector tile or GeoJSON.")))}return d.concat(ts({key:t.key,value:s,valueSpec:u,style:r,styleSpec:o,expressionContext:"property",propertyType:e,propertyKey:a}))}function Go(t){return Uo(t,"paint")}function jo(t){return Uo(t,"layout")}function Vo(t){let e=[];const i=t.value,r=t.key,n=t.style,o=t.styleSpec;i.type||i.ref||e.push(new De(r,i,'either "type" or "ref" is required'));let s=Be(i.type);const a=Be(i.ref);if(i.id){const o=Be(i.id);for(let s=0;s<t.arrayIndex;s++){const t=n.layers[s];Be(t.id)===o&&e.push(new De(r,i.id,`duplicate layer id "${i.id}", previously used at line ${t.id.__line__}`))}}if("ref"in i){let t;["type","source","source-layer","filter","layout"].forEach(t=>{t in i&&e.push(new De(r,i[t],`"${t}" is prohibited for ref layers`))}),n.layers.forEach(e=>{Be(e.id)===a&&(t=e)}),t?t.ref?e.push(new De(r,i.ref,"ref cannot reference another ref layer")):s=Be(t.type):"string"==typeof a&&e.push(new De(r,i.ref,`ref layer "${a}" not found`))}else if("background"!==s&&"sky"!==s&&"slot"!==s)if(i.source){const t=n.sources&&n.sources[i.source],o=t&&Be(t.type);t?"vector"===o&&"raster"===s?e.push(new De(r,i.source,`layer "${i.id}" requires a raster source`)):"raster"===o&&"raster"!==s?e.push(new De(r,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==o||i["source-layer"]?"raster-dem"===o&&"hillshade"!==s?e.push(new De(r,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||"geojson"===o&&t.lineMetrics||e.push(new De(r,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new De(r,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new De(r,i.source,`source "${i.source}" not found`))}else e.push(new De(r,i,'missing required property "source"'));return e=e.concat(wo({key:r,value:i,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ts({key:r+".type",value:i.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"}),filter:t=>No(ke({layerType:s},t)),layout:t=>wo({layer:i,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>jo(ke({layerType:s},t))}}),paint:t=>wo({layer:i,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>Go(ke({layerType:s,layer:i},t))}})}})),e}function Xo(t){const e=t.value,i=t.key,r=Ii(e);return"string"!==r?[new De(i,e,`string expected, ${r} found`)]:[]}const Ho={promoteId:function({key:t,value:e}){if("string"===Ii(e))return Xo({key:t,value:e});{const i=[];for(const r in e)i.push(...Xo({key:`${t}.${r}`,value:e[r]}));return i}}};function qo(t){const e=t.value,i=t.key,r=t.styleSpec,n=t.style;if(!e.type)return[new De(i,e,'"type" is required')];const o=Be(e.type);let s=[];switch(["vector","raster","raster-dem"].includes(o)&&(e.url||e.tiles||s.push(new De(i,e,'Either "url" or "tiles" is required.'))),o){case"vector":case"raster":case"raster-dem":return s=s.concat(wo({key:i,value:e,valueSpec:r["source_"+o.replace("-","_")],style:t.style,styleSpec:r,objectElementValidators:Ho})),s;case"geojson":if(s=wo({key:i,value:e,valueSpec:r.source_geojson,style:n,styleSpec:r,objectElementValidators:Ho}),e.cluster)for(const t in e.clusterProperties){const[r,n]=e.clusterProperties[t],o="string"==typeof r?[r,["accumulated"],["get",t]]:r;s.push(...Ao({key:`${i}.${t}.map`,value:n,expressionContext:"cluster-map"})),s.push(...Ao({key:`${i}.${t}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return s;case"video":return wo({key:i,value:e,valueSpec:r.source_video,style:n,styleSpec:r});case"image":return wo({key:i,value:e,valueSpec:r.source_image,style:n,styleSpec:r});case"canvas":return[new De(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Mo({key:i+".type",value:e.type,valueSpec:{values:Wo(r)},style:n,styleSpec:r})}}function Wo(t){return t.source.reduce((e,i)=>{const r=t[i];return"enum"===r.type.type&&(e=e.concat(Object.keys(r.type.values))),e},[])}function $o(t){const e=t.value;let i=[];if(!e)return i;const r=Ii(e);return"string"!==r?(i=i.concat([new De(t.key,e,`string expected, "${r}" found`)]),i):(function(t){const e=-1===t.indexOf("://");try{return new URL(t,e?"http://example.com":void 0),!0}catch(t){return!1}}(e)||(i=i.concat([new De(t.key,e,`invalid url "${e}"`)])),i)}function Yo(t){const e=t.value,i=t.styleSpec,r=i.light,n=t.style;let o=[];const s=Ii(e);if(void 0===e)return o;if("object"!==s)return o=o.concat([new De("light",e,`object expected, ${s} found`)]),o;for(const t in e){const s=t.match(/^(.*)-transition$/);o=o.concat(s&&r[s[1]]&&r[s[1]].transition?ts({key:t,value:e[t],valueSpec:i.transition,style:n,styleSpec:i}):r[t]?ts({key:t,value:e[t],valueSpec:r[t],style:n,styleSpec:i}):[new De(t,e[t],`unknown property "${t}"`)])}return o}function Zo(t){const e=t.value;let i=[];if(!e)return i;const r=Ii(e);if("object"!==r)return i=i.concat([new De("light-3d",e,`object expected, ${r} found`)]),i;const n=t.styleSpec,o=n["light-3d"],s=t.key,a=t.style,l=t.style.lights;for(const t of["type","id"])if(!(t in e))return i=i.concat([new De("light-3d",e,`missing property ${t} on light`)]),i;if(e.type&&l)for(let r=0;r<t.arrayIndex;r++){const t=Be(e.type),n=l[r];Be(n.type)===t&&i.push(new De(s,e.id,`duplicate light type "${e.type}", previously defined at line ${n.id.__line__}`))}const c="properties_light_"+e.type;if(!(c in n))return i=i.concat([new De("light-3d",e,"Invalid light type "+e.type)]),i;const u=n[c];for(const r in e)if("properties"===r){const o=e[r],s=Ii(o);if("object"!==s)return i=i.concat([new De("properties",o,`object expected, ${s} found`)]),i;for(const e in o)i=i.concat(u[e]?ts({key:e,value:o[e],valueSpec:u[e],style:a,styleSpec:n}):[new Le(t.key,o[e],`unknown property "${e}"`)])}else{const t=r.match(/^(.*)-transition$/);i=i.concat(t&&o[t[1]]&&o[t[1]].transition?ts({key:r,value:e[r],valueSpec:n.transition,style:a,styleSpec:n}):o[r]?ts({key:r,value:e[r],valueSpec:o[r],style:a,styleSpec:n}):[new Le(r,e[r],`unknown property "${r}"`)])}return i}function Ko(t){const e=t.value,i=t.key,r=t.style,n=t.styleSpec,o=n.terrain;let s=[];const a=Ii(e);if(void 0===e)return s;if("null"===a)return s;if("object"!==a)return s=s.concat([new De("terrain",e,`object expected, ${a} found`)]),s;for(const t in e){const i=t.match(/^(.*)-transition$/);s=s.concat(i&&o[i[1]]&&o[i[1]].transition?ts({key:t,value:e[t],valueSpec:n.transition,style:r,styleSpec:n}):o[t]?ts({key:t,value:e[t],valueSpec:o[t],style:r,styleSpec:n}):[new Le(t,e[t],`unknown property "${t}"`)])}if(e.source){const t=r.sources&&r.sources[e.source],n=t&&Be(t.type);t?"raster-dem"!==n&&s.push(new De(i,e.source,`terrain cannot be used with a source of type ${String(n)}, it only be used with a "raster-dem" source type`)):s.push(new De(i,e.source,`source "${e.source}" not found`))}else s.push(new De(i,e,'terrain is missing required property "source"'));return s}function Jo(t){const e=t.value,i=t.style,r=t.styleSpec,n=r.fog;let o=[];const s=Ii(e);if(void 0===e)return o;if("object"!==s)return o=o.concat([new De("fog",e,`object expected, ${s} found`)]),o;for(const t in e){const s=t.match(/^(.*)-transition$/);o=o.concat(s&&n[s[1]]&&n[s[1]].transition?ts({key:t,value:e[t],valueSpec:r.transition,style:i,styleSpec:r}):n[t]?ts({key:t,value:e[t],valueSpec:n[t],style:i,styleSpec:r}):[new Le(t,e[t],`unknown property "${t}"`)])}return o}const Qo={"*":()=>[],array:To,boolean:function(t){const e=t.value,i=t.key,r=Ii(e);return"boolean"!==r?[new De(i,e,`boolean expected, ${r} found`)]:[]},number:Eo,color:function(t){const e=t.key,i=t.value,r=Ii(i);return"string"!==r?[new De(e,i,`color expected, ${r} found`)]:null===ni(i)?[new De(e,i,`color expected, "${i}" found`)]:[]},enum:Mo,filter:No,function:So,layer:Vo,object:wo,source:qo,model:$o,light:Yo,"light-3d":Zo,terrain:Ko,fog:Jo,string:Xo,formatted:function(t){return 0===Xo(t).length?[]:Ao(t)},resolvedImage:function(t){return 0===Xo(t).length?[]:Ao(t)},projection:function(t){const e=t.value,i=t.styleSpec,r=i.projection,n=t.style;let o=[];const s=Ii(e);if("object"===s)for(const t in e)o=o.concat(ts({key:t,value:e[t],valueSpec:r[t],style:n,styleSpec:i}));else"string"!==s&&(o=o.concat([new De("projection",e,`object or string expected, ${s} found`)]));return o},import:function(t){const{value:e,styleSpec:i}=t,{data:r,...n}=e;Object.defineProperty(n,"__line__",{value:e.__line__,enumerable:!1});let o=wo(ke({},t,{value:n,valueSpec:i.import}));return""===Be(n.id)&&o.push(new De(t.key+".id",n,"import id can't be an empty string")),r&&(o=o.concat(is(r,i,{key:t.key+".data"}))),o}};function ts(t,e=!1){const i=t.value,r=t.valueSpec,n=t.styleSpec;if(r.expression&&ao(Be(i)))return So(t);if(r.expression&&go(Fe(i)))return Ao(t);if(r.type&&Qo[r.type]){const i=Qo[r.type](t);return!0===e&&i.length>0&&"array"===Ii(t.value)?Ao(t):i}return wo(ke({},t,{valueSpec:r.type?n[r.type]:r}))}function es(t){const e=t.value,i=t.key,r=Xo(t);return r.length||(-1===e.indexOf("{fontstack}")&&r.push(new De(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&r.push(new De(i,e,'"glyphs" url must include a "{range}" token'))),r}function is(t,e=Oe,i={}){return ts({key:i.key||"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:es,"*":()=>[]}})}function rs(t,e=Oe){return fs(is(t,e))}const ns=t=>fs(qo(t)),os=t=>fs(Yo(t)),ss=t=>fs(Zo(t)),as=t=>fs(Ko(t)),ls=t=>fs(Jo(t)),cs=t=>fs(Vo(t)),us=t=>fs(No(t)),hs=t=>fs(Go(t)),ds=t=>fs(jo(t)),ps=t=>fs($o(t));function fs(t){return t.slice().sort((t,e)=>t.line&&e.line?t.line-e.line:0)}function ms(t,e){let i=!1;if(e&&e.length)for(const r of e)r instanceof Le?Y(r.message):(t.fire(new Pe(new Error(r.message))),i=!0);return i}var gs=_s;function _s(t,e,i){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var n=new Int32Array(this.arrayBuffer);t=n[0],this.d=(e=n[1])+2*(i=n[2]);for(var o=0;o<this.d*this.d;o++){var s=n[3+o],a=n[3+o+1];r.push(s===a?null:n.subarray(s,a))}var l=n[3+r.length+1];this.keys=n.subarray(n[3+r.length],l),this.bboxes=n.subarray(l),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var c=0;c<this.d*this.d;c++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var u=i/e*t;this.min=-u,this.max=t+u}_s.prototype.insert=function(t,e,i,r,n){this._forEachCell(e,i,r,n,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)},_s.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},_s.prototype._insertCell=function(t,e,i,r,n,o){this.cells[n].push(o)},_s.prototype.query=function(t,e,i,r,n){var o=this.min,s=this.max;if(t<=o&&e<=o&&s<=i&&s<=r&&!n)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(t,e,i,r,this._queryCell,a,{},n),a},_s.prototype._queryCell=function(t,e,i,r,n,o,s,a){var l=this.cells[n];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var d=l[h];if(void 0===s[d]){var p=4*d;(a?a(u[p+0],u[p+1],u[p+2],u[p+3]):t<=u[p+2]&&e<=u[p+3]&&i>=u[p+0]&&r>=u[p+1])?(s[d]=!0,o.push(c[d])):s[d]=!1}}},_s.prototype._forEachCell=function(t,e,i,r,n,o,s,a){for(var l=this._convertToCellCoord(t),c=this._convertToCellCoord(e),u=this._convertToCellCoord(i),h=this._convertToCellCoord(r),d=l;d<=u;d++)for(var p=c;p<=h;p++){var f=this.d*p+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(p),this._convertFromCellCoord(d+1),this._convertFromCellCoord(p+1)))&&n.call(this,t,e,i,r,f,o,s,a))return}},_s.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},_s.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},_s.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,i=0,r=0;r<this.cells.length;r++)i+=this.cells[r].length;var n=new Int32Array(e+i+this.keys.length+this.bboxes.length);n[0]=this.extent,n[1]=this.n,n[2]=this.padding;for(var o=e,s=0;s<t.length;s++){var a=t[s];n[3+s]=o,n.set(a,o),o+=a.length}return n[3+t.length]=o,n.set(this.keys,o),n[3+t.length+1]=o+=this.keys.length,n.set(this.bboxes,o),o+=this.bboxes.length,n.buffer};var ys=p(gs);const vs={};function xs(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),vs[e]={klass:t,omit:i.omit||[]}}xs(Object,"Object"),ys.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.add(i),{buffer:i}},ys.deserialize=function(t){return new ys(t.buffer)},Object.defineProperty(ys,"name",{value:"Grid"}),xs(ys,"Grid"),xs(hi,"Color"),xs(Error,"Error"),xs(xt,"AJAXError"),xs(mi,"ResolvedImage"),xs(bo,"StylePropertyFunction"),xs(mo,"StyleExpression",{omit:["_evaluator"]}),xs(vo,"ZoomDependentExpression"),xs(yo,"ZoomConstantExpression"),xs(Bi,"CompoundExpression",{omit:["_evaluate"]});for(const t in Qn)vs[Qn[t]._classRegistryKey]||xs(Qn[t],"Expression"+t);function bs(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function ws(t){return i.ImageBitmap&&t instanceof i.ImageBitmap}function Ts(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(bs(t)||ws(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.add(i.buffer),i}if(t instanceof i.ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const r of t)i.push(Ts(r,e));return i}if(t instanceof Map){const e={$name:"Map"};for(const[i,r]of t.entries())e[i]=Ts(r);return e}if("object"==typeof t){const i=t.constructor,r=i._classRegistryKey;if(!r)throw new Error("can't serialize object of unregistered class "+r);const n=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const i in t)t.hasOwnProperty(i)&&(vs[r].omit.indexOf(i)>=0||(n[i]=Ts(t[i],e)));t instanceof Error&&(n.message=t.message)}if(n.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==r&&(n.$name=r),n}throw new Error("can't serialize object of type "+typeof t)}function Es(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||bs(t)||ws(t)||ArrayBuffer.isView(t)||t instanceof i.ImageData)return t;if(Array.isArray(t))return t.map(Es);if("object"==typeof t){const e=t.$name||"Object";if("Map"===e){const e=new Map;for(const i of Object.keys(t))"$name"!==i&&e.set(i,Es(t[i]));return e}const{klass:i}=vs[e];if(!i)throw new Error("can't deserialize unregistered class "+e);if(i.deserialize)return i.deserialize(t);const r=Object.create(i.prototype);for(const e of Object.keys(t))"$name"!==e&&(r[e]=Es(t[e]));return r}throw new Error("can't deserialize object of type "+typeof t)}const Ss=t=>t>=128&&t<=255,As=t=>t>=1536&&t<=1791,Ms=t=>t>=1872&&t<=1919,Is=t=>t>=2208&&t<=2303,Cs=t=>t>=4352&&t<=4607,Ps=t=>t>=5120&&t<=5759,Rs=t=>t>=6016&&t<=6143,Os=t=>t>=6320&&t<=6399,Ds=t=>t>=8192&&t<=8303,Ls=t=>t>=8448&&t<=8527,ks=t=>t>=8528&&t<=8591,Bs=t=>t>=8960&&t<=9215,Fs=t=>t>=9216&&t<=9279,zs=t=>t>=9280&&t<=9311,Ns=t=>t>=9312&&t<=9471,Us=t=>t>=9632&&t<=9727,Gs=t=>t>=9728&&t<=9983,js=t=>t>=11008&&t<=11263,Vs=t=>t>=11904&&t<=12031,Xs=t=>t>=12032&&t<=12255,Hs=t=>t>=12272&&t<=12287,qs=t=>t>=12288&&t<=12351,Ws=t=>t>=12352&&t<=12447,$s=t=>t>=12448&&t<=12543,Ys=t=>t>=12544&&t<=12591,Zs=t=>t>=12592&&t<=12687,Ks=t=>t>=12688&&t<=12703,Js=t=>t>=12704&&t<=12735,Qs=t=>t>=12736&&t<=12783,ta=t=>t>=12784&&t<=12799,ea=t=>t>=12800&&t<=13055,ia=t=>t>=13056&&t<=13311,ra=t=>t>=13312&&t<=19903,na=t=>t>=19904&&t<=19967,oa=t=>t>=19968&&t<=40959,sa=t=>t>=40960&&t<=42127,aa=t=>t>=42128&&t<=42191,la=t=>t>=43360&&t<=43391,ca=t=>t>=44032&&t<=55215,ua=t=>t>=55216&&t<=55295,ha=t=>t>=57344&&t<=63743,da=t=>t>=63744&&t<=64255,pa=t=>t>=64336&&t<=65023,fa=t=>t>=65040&&t<=65055,ma=t=>t>=65072&&t<=65103,ga=t=>t>=65104&&t<=65135,_a=t=>t>=65136&&t<=65279,ya=t=>t>=65280&&t<=65519,va=t=>t>=131072&&t<=173791;function xa(t){for(const e of t)if(Ta(e.charCodeAt(0)))return!0;return!1}function ba(t){for(const e of t)if(!wa(e.charCodeAt(0)))return!1;return!0}function wa(t){return!(As(t)||Ms(t)||Is(t)||pa(t)||_a(t))}function Ta(t){return!(746!==t&&747!==t&&(t<4352||!(Js(t)||Ys(t)||ma(t)&&!(t>=65097&&t<=65103)||da(t)||ia(t)||Vs(t)||Qs(t)||!(!qs(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||ra(t)||oa(t)||ea(t)||Zs(t)||la(t)||ua(t)||Cs(t)||ca(t)||Ws(t)||Hs(t)||Ks(t)||Xs(t)||ta(t)||$s(t)&&12540!==t||!(!ya(t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!ga(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Ps(t)||Os(t)||fa(t)||na(t)||sa(t)||aa(t))))}function Ea(t){return!(Ta(t)||function(t){return!!(Ss(t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||Ds(t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||Ls(t)||ks(t)||Bs(t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||Fs(t)&&9251!==t||zs(t)||Ns(t)||Us(t)||Gs(t)&&!(t>=9754&&t<=9759)||js(t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||qs(t)||$s(t)||ha(t)||ma(t)||ga(t)||ya(t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function Sa(t){return t>=1424&&t<=2303||pa(t)||_a(t)}function Aa(t,e){return!(!e&&Sa(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Rs(t))}function Ma(t){for(const e of t)if(Sa(e.charCodeAt(0)))return!0;return!1}const Ia="deferred",Ca="loading",Pa="loaded";let Ra=null,Oa="unavailable",Da=null;const La=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(Oa="error"),Ra&&Ra(t)};function ka(){Ba.fire(new Ce("pluginStateChange",{pluginStatus:Oa,pluginURL:Da}))}const Ba=new Re,Fa=function(){return Oa},za=function(){if(Oa!==Ia||!Da)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Oa=Ca,ka(),Da&&Et({url:Da},t=>{t?La(t):(Oa=Pa,ka())})},Na={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Oa===Pa||null!=Na.applyArabicShaping,isLoading:()=>Oa===Ca,setState(t){Oa=t.pluginStatus,Da=t.pluginURL},isParsed:()=>null!=Na.applyArabicShaping&&null!=Na.processBidirectionalText&&null!=Na.processStyledBidirectionalText,getPluginURL:()=>Da};class Ua{constructor(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.transition=e.transition,this.pitch=e.pitch,this.brightness=e.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(t,e){for(const i of t)if(!Aa(i.charCodeAt(0),e))return!1;return!0}(t,Na.isLoaded())}}class Ga{constructor(t,e,i){this.property=t,this.value=e,this.expression=function(t,e,i){if(ao(t))return new bo(t,e);if(go(t)||Array.isArray(t)&&t.length>0){const r=xo(t,e,i);if("error"===r.result)throw new Error(r.value.map(t=>`${t.key}: ${t.message}`).join(", "));return r.value}{let i=t;return"string"==typeof t&&"color"===e.type&&(i=hi.parse(t)),{kind:"constant",isConfigDependent:!1,evaluate:()=>i}}}(void 0===e?t.specification.default:e,t.specification,i)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,e,i){return this.property.possiblyEvaluate(this,t,e,i)}}class ja{constructor(t,e){this.property=t,this.value=new Ga(t,void 0,e)}transitioned(t,e){return new Xa(this.property,this.value,e,B({},t.transition,this.transition),t.now)}untransitioned(){return new Xa(this.property,this.value,null,{},0)}}class Va{constructor(t,e){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._options=e,this.isConfigDependent=!1}getValue(t){return W(this._values[t].value.value)}setValue(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new ja(this._values[t].property,this._options)),this._values[t].value=new Ga(this._values[t].property,null===e?void 0:W(e),this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].value.expression.isConfigDependent}setTransitionOrValue(t,e){e&&(this._options=e);const i=this._properties.properties;if(t)for(const e in t){const r=t[e];if(X(e,"-transition")){const t=e.slice(0,-11);i[t]&&this.setTransition(t,r)}else i[e]&&this.setValue(e,r)}}getTransition(t){return W(this._values[t].transition)}setTransition(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new ja(this._values[t].property)),this._values[t].transition=W(e)||void 0}serialize(){const t={};for(const e of Object.keys(this._values)){const i=this.getValue(e);void 0!==i&&(t[e]=i);const r=this.getTransition(e);void 0!==r&&(t[e+"-transition"]=r)}return t}transitioned(t,e){const i=new Ha(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].transitioned(t,e._values[r]);return i}untransitioned(){const t=new Ha(this._properties);for(const e of Object.keys(this._values))t._values[e]=this._values[e].untransitioned();return t}}class Xa{constructor(t,e,i,r,n){const o=r.delay||0,s=r.duration||0;n=n||0,this.property=t,this.value=e,this.begin=n+o,this.end=this.begin+s,t.specification.transition&&(r.delay||r.duration)&&(this.prior=i)}possiblyEvaluate(t,e,i){const r=t.now||0,n=this.value.possiblyEvaluate(t,e,i),o=this.prior;if(o){if(r>this.end)return this.prior=null,n;if(this.value.isDataDriven())return this.prior=null,n;if(r<this.begin)return o.possiblyEvaluate(t,e,i);{const s=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(t,e,i),n,A(s))}}return n}}class Ha{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,e,i){const r=new $a(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(t,e,i);return r}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class qa{constructor(t,e){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._options=e,this.isConfigDependent=!1}getValue(t){return W(this._values[t].value)}setValue(t,e){this._values[t]=new Ga(this._values[t].property,null===e?void 0:W(e),this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].expression.isConfigDependent}serialize(){const t={};for(const e of Object.keys(this._values)){const i=this.getValue(e);void 0!==i&&(t[e]=i)}return t}possiblyEvaluate(t,e,i){const r=new $a(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(t,e,i);return r}}class Wa{constructor(t,e,i){this.property=t,this.value=e,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,e,i,r){return this.property.evaluate(this.value,this.parameters,t,e,i,r)}}class $a{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Ya{constructor(t){this.specification=t}possiblyEvaluate(t,e){return t.expression.evaluate(e)}interpolate(t,e,i){const r=Kr[this.specification.type];return r?r(t,e,i):t}}class Za{constructor(t,e){this.specification=t,this.overrides=e}possiblyEvaluate(t,e,i,r){return new Wa(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},i,r)}:t.expression,e)}interpolate(t,e,i){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new Wa(this,{kind:"constant",value:void 0},t.parameters);const r=Kr[this.specification.type];return r?new Wa(this,{kind:"constant",value:r(t.value.value,e.value.value,i)},t.parameters):t}evaluate(t,e,i,r,n,o){return"constant"===t.kind?t.value:t.evaluate(e,i,r,n,o)}}class Ka{constructor(t){this.specification=t}possiblyEvaluate(t,e,i,r){return!!t.expression.evaluate(e,null,{},i,r)}interpolate(){return!1}}class Ja{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const e=new Ua(0,{});for(const i in t){const r=t[i];r.specification.overridable&&this.overridableProperties.push(i);const n=this.defaultPropertyValues[i]=new Ga(r,void 0),o=this.defaultTransitionablePropertyValues[i]=new ja(r);this.defaultTransitioningPropertyValues[i]=o.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=n.possiblyEvaluate(e)}}}function Qa(t){return t.indexOf("")>=0}function tl(t,e){return e?`${t}${e}`:t}function el(t){const e=t.indexOf("");return e>=0?t.slice(0,e):t}xs(Za,"DataDrivenProperty"),xs(Ya,"DataConstantProperty"),xs(Ka,"ColorRampProperty");const il="-transition";class rl extends Re{constructor(t,e,i){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&"slot"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),this.options=i,t.slot&&(this.slot=t.slot),e.layout&&(this._unevaluatedLayout=new qa(e.layout,i),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),e.paint)){this._transitionablePaint=new Va(e.paint,i);for(const e in t.paint)this.setPaintProperty(e,t.paint[e],{validate:!1});for(const e in t.layout)this.setLayoutProperty(e,t.layout[e],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new $a(e.paint)}}setScope(t){this.scope=t,this.fqid=tl(this.id,t)}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,e,i={}){if(null!=e&&this._validate(ds,`layers.${this.id}.layout.${t}`,t,e,i))return;if("custom"===this.type&&"visibility"===t)return void(this.visibility=e);const r=this._unevaluatedLayout;r._properties.properties[t]&&(r.setValue(t,e),this.isConfigDependent=this.isConfigDependent||r.isConfigDependent,"visibility"===t&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(t){return X(t,il)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,e,i={}){if(null!=e&&this._validate(hs,`layers.${this.id}.paint.${t}`,t,e,i))return!1;const r=this._transitionablePaint,n=r._properties.properties;if(X(t,il)){const i=t.slice(0,-11);return n[i]&&r.setTransition(i,e||void 0),!1}if(!n[t])return!1;const o=r._values[t],s=o.value.isDataDriven(),a=o.value;r.setValue(t,e),this.isConfigDependent=this.isConfigDependent||r.isConfigDependent,this._handleSpecialPaintPropertyUpdate(t);const l=r._values[t].value,c=l.isDataDriven(),u=X(t,"pattern")||"line-dasharray"===t;return c||s||u||this._handleOverridablePaintPropertyUpdate(t,a,l)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,e){return null}_handleOverridablePaintPropertyUpdate(t,e,i){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,e){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)}serialize(){return q({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(t,e)=>!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length))}_validate(t,e,i,r,n={}){return(!n||!1!==n.validate)&&ms(this,t.call(rs,{key:e,layerType:this.type,objectKey:i,value:r,styleSpec:Oe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(const t in this.paint._values){const e=this.paint.get(t);if(e instanceof Wa&&ro(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Co(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(){this._stats&&(this._stats.numRenderedVerticesInShadowPass=0,this._stats.numRenderedVerticesInTransparentPass=0)}}class nl{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,e){this._updatedSourceCaches[t]=e,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const e=t.scope;this._updatedLayers[e]=this._updatedLayers[e]||new Set,this._updatedLayers[e].add(t.id),this.setDirty()}removeLayer(t){const e=t.scope;this._removedLayers[e]=this._removedLayers[e]||{},this._updatedLayers[e]=this._updatedLayers[e]||new Set,this._removedLayers[e][t.id]=t,this._updatedLayers[e].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const e in this._updatedLayers)t[e]=t[e]||{},t[e].updatedIds=Array.from(this._updatedLayers[e].values());for(const e in this._removedLayers)t[e]=t[e]||{},t[e].removedIds=Object.keys(this._removedLayers[e]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const ol={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class sl{constructor(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class al{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,e){return t._trim(),e&&(t.isTransferred=!0,e.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ll(t,e=1){let i=0,r=0;return{members:t.map(t=>{const n=ol[t.type].BYTES_PER_ELEMENT,o=i=cl(i,Math.max(e,n)),s=t.components||1;return r=Math.max(r,n),i+=n*s,{name:t.name,type:t.type,components:s,offset:o}}),size:cl(i,Math.max(r,e)),alignment:e}}function cl(t,e){return Math.ceil(t/e)*e}class ul extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const r=2*t;return this.int16[r+0]=e,this.int16[r+1]=i,t}}ul.prototype.bytesPerElement=4,xs(ul,"StructArrayLayout2i4");class hl extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)}emplace(t,e,i,r){const n=3*t;return this.int16[n+0]=e,this.int16[n+1]=i,this.int16[n+2]=r,t}}hl.prototype.bytesPerElement=6,xs(hl,"StructArrayLayout3i6");class dl extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,r)}emplace(t,e,i,r,n){const o=4*t;return this.int16[o+0]=e,this.int16[o+1]=i,this.int16[o+2]=r,this.int16[o+3]=n,t}}dl.prototype.bytesPerElement=8,xs(dl,"StructArrayLayout4i8");class pl extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,r,n)}emplace(t,e,i,r,n,o){const s=5*t;return this.int16[s+0]=e,this.int16[s+1]=i,this.int16[s+2]=r,this.int16[s+3]=n,this.int16[s+4]=o,t}}pl.prototype.bytesPerElement=10,xs(pl,"StructArrayLayout5i10");class fl extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,r,n,o,s)}emplace(t,e,i,r,n,o,s,a){const l=6*t,c=12*t,u=3*t;return this.int16[l+0]=e,this.int16[l+1]=i,this.uint8[c+4]=r,this.uint8[c+5]=n,this.uint8[c+6]=o,this.uint8[c+7]=s,this.float32[u+2]=a,t}}fl.prototype.bytesPerElement=12,xs(fl,"StructArrayLayout2i4ub1f12");class ml extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,r)}emplace(t,e,i,r,n){const o=4*t;return this.float32[o+0]=e,this.float32[o+1]=i,this.float32[o+2]=r,this.float32[o+3]=n,t}}ml.prototype.bytesPerElement=16,xs(ml,"StructArrayLayout4f16");class gl extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,r,n)}emplace(t,e,i,r,n,o){const s=6*t,a=3*t;return this.uint16[s+0]=e,this.uint16[s+1]=i,this.uint16[s+2]=r,this.uint16[s+3]=n,this.float32[a+2]=o,t}}gl.prototype.bytesPerElement=12,xs(gl,"StructArrayLayout4ui1f12");class _l extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,r)}emplace(t,e,i,r,n){const o=4*t;return this.uint16[o+0]=e,this.uint16[o+1]=i,this.uint16[o+2]=r,this.uint16[o+3]=n,t}}_l.prototype.bytesPerElement=8,xs(_l,"StructArrayLayout4ui8");class yl extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,r,n,o)}emplace(t,e,i,r,n,o,s){const a=6*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=r,this.int16[a+3]=n,this.int16[a+4]=o,this.int16[a+5]=s,t}}yl.prototype.bytesPerElement=12,xs(yl,"StructArrayLayout6i12");class vl extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,e,i,r,n,o,s,a,l,c,u,h)}emplace(t,e,i,r,n,o,s,a,l,c,u,h,d){const p=12*t;return this.int16[p+0]=e,this.int16[p+1]=i,this.int16[p+2]=r,this.int16[p+3]=n,this.uint16[p+4]=o,this.uint16[p+5]=s,this.uint16[p+6]=a,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,t}}vl.prototype.bytesPerElement=24,xs(vl,"StructArrayLayout4i4ui4i24");class xl extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,r,n,o)}emplace(t,e,i,r,n,o,s){const a=10*t,l=5*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=r,this.float32[l+2]=n,this.float32[l+3]=o,this.float32[l+4]=s,t}}xl.prototype.bytesPerElement=20,xs(xl,"StructArrayLayout3i3f20");class bl extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint32[1*t+0]=e,t}}bl.prototype.bytesPerElement=4,xs(bl,"StructArrayLayout1ul4");class wl extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const r=2*t;return this.uint16[r+0]=e,this.uint16[r+1]=i,t}}wl.prototype.bytesPerElement=4,xs(wl,"StructArrayLayout2ui4");class Tl extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l,c,u,h,d){const p=this.length;return this.resize(p+1),this.emplace(p,t,e,i,r,n,o,s,a,l,c,u,h,d)}emplace(t,e,i,r,n,o,s,a,l,c,u,h,d,p){const f=20*t,m=10*t;return this.int16[f+0]=e,this.int16[f+1]=i,this.int16[f+2]=r,this.int16[f+3]=n,this.int16[f+4]=o,this.float32[m+3]=s,this.float32[m+4]=a,this.float32[m+5]=l,this.float32[m+6]=c,this.int16[f+14]=u,this.uint32[m+8]=h,this.uint16[f+18]=d,this.uint16[f+19]=p,t}}Tl.prototype.bytesPerElement=40,xs(Tl,"StructArrayLayout5i4f1i1ul2ui40");class El extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,r,n,o,s)}emplace(t,e,i,r,n,o,s,a){const l=8*t;return this.int16[l+0]=e,this.int16[l+1]=i,this.int16[l+2]=r,this.int16[l+4]=n,this.int16[l+5]=o,this.int16[l+6]=s,this.int16[l+7]=a,t}}El.prototype.bytesPerElement=16,xs(El,"StructArrayLayout3i2i2i16");class Sl extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,r,n)}emplace(t,e,i,r,n,o){const s=4*t,a=8*t;return this.float32[s+0]=e,this.float32[s+1]=i,this.float32[s+2]=r,this.int16[a+6]=n,this.int16[a+7]=o,t}}Sl.prototype.bytesPerElement=16,xs(Sl,"StructArrayLayout2f1f2i16");class Al extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,r)}emplace(t,e,i,r,n){const o=12*t,s=3*t;return this.uint8[o+0]=e,this.uint8[o+1]=i,this.float32[s+1]=r,this.float32[s+2]=n,t}}Al.prototype.bytesPerElement=12,xs(Al,"StructArrayLayout2ub2f12");class Ml extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)}emplace(t,e,i,r){const n=3*t;return this.uint16[n+0]=e,this.uint16[n+1]=i,this.uint16[n+2]=r,t}}Ml.prototype.bytesPerElement=6,xs(Ml,"StructArrayLayout3ui6");class Il extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,x)}emplace(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,x,b){const w=30*t,T=15*t,E=60*t;return this.int16[w+0]=e,this.int16[w+1]=i,this.int16[w+2]=r,this.float32[T+2]=n,this.float32[T+3]=o,this.uint16[w+8]=s,this.uint16[w+9]=a,this.uint32[T+5]=l,this.uint32[T+6]=c,this.uint32[T+7]=u,this.uint16[w+16]=h,this.uint16[w+17]=d,this.uint16[w+18]=p,this.float32[T+10]=f,this.float32[T+11]=m,this.uint8[E+48]=g,this.uint8[E+49]=_,this.uint8[E+50]=y,this.uint32[T+13]=v,this.int16[w+28]=x,this.uint8[E+58]=b,t}}Il.prototype.bytesPerElement=60,xs(Il,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Cl extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,x,b,w,T,E,S,A,M,I,C,P,R){const O=this.length;return this.resize(O+1),this.emplace(O,t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,x,b,w,T,E,S,A,M,I,C,P,R)}emplace(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,x,b,w,T,E,S,A,M,I,C,P,R,O){const D=20*t,L=40*t,k=80*t;return this.float32[D+0]=e,this.float32[D+1]=i,this.int16[L+4]=r,this.int16[L+5]=n,this.int16[L+6]=o,this.int16[L+7]=s,this.int16[L+8]=a,this.int16[L+9]=l,this.int16[L+10]=c,this.int16[L+11]=u,this.int16[L+12]=h,this.uint16[L+13]=d,this.uint16[L+14]=p,this.uint16[L+15]=f,this.uint16[L+16]=m,this.uint16[L+17]=g,this.uint16[L+18]=_,this.uint16[L+19]=y,this.uint16[L+20]=v,this.uint16[L+21]=x,this.uint16[L+22]=b,this.uint16[L+23]=w,this.uint16[L+24]=T,this.uint16[L+25]=E,this.uint16[L+26]=S,this.uint16[L+27]=A,this.uint32[D+14]=M,this.float32[D+15]=I,this.float32[D+16]=C,this.float32[D+17]=P,this.float32[D+18]=R,this.uint8[k+76]=O,t}}Cl.prototype.bytesPerElement=80,xs(Cl,"StructArrayLayout2f9i15ui1ul4f1ub80");class Pl extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.float32[1*t+0]=e,t}}Pl.prototype.bytesPerElement=4,xs(Pl,"StructArrayLayout1f4");class Rl extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,r,n)}emplace(t,e,i,r,n,o){const s=5*t;return this.float32[s+0]=e,this.float32[s+1]=i,this.float32[s+2]=r,this.float32[s+3]=n,this.float32[s+4]=o,t}}Rl.prototype.bytesPerElement=20,xs(Rl,"StructArrayLayout5f20");class Ol extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,r,n,o,s)}emplace(t,e,i,r,n,o,s,a){const l=7*t;return this.float32[l+0]=e,this.float32[l+1]=i,this.float32[l+2]=r,this.float32[l+3]=n,this.float32[l+4]=o,this.float32[l+5]=s,this.float32[l+6]=a,t}}Ol.prototype.bytesPerElement=28,xs(Ol,"StructArrayLayout7f28");class Dl extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,r)}emplace(t,e,i,r,n){const o=6*t;return this.uint32[3*t+0]=e,this.uint16[o+2]=i,this.uint16[o+3]=r,this.uint16[o+4]=n,t}}Dl.prototype.bytesPerElement=12,xs(Dl,"StructArrayLayout1ul3ui12");class Ll extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint16[1*t+0]=e,t}}Ll.prototype.bytesPerElement=2,xs(Ll,"StructArrayLayout1ui2");class kl extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)}emplace(t,e,i,r){const n=3*t;return this.float32[n+0]=e,this.float32[n+1]=i,this.float32[n+2]=r,t}}kl.prototype.bytesPerElement=12,xs(kl,"StructArrayLayout3f12");class Bl extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const r=2*t;return this.float32[r+0]=e,this.float32[r+1]=i,t}}Bl.prototype.bytesPerElement=8,xs(Bl,"StructArrayLayout2f8");class Fl extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,m){const g=this.length;return this.resize(g+1),this.emplace(g,t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,m)}emplace(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g){const _=16*t;return this.float32[_+0]=e,this.float32[_+1]=i,this.float32[_+2]=r,this.float32[_+3]=n,this.float32[_+4]=o,this.float32[_+5]=s,this.float32[_+6]=a,this.float32[_+7]=l,this.float32[_+8]=c,this.float32[_+9]=u,this.float32[_+10]=h,this.float32[_+11]=d,this.float32[_+12]=p,this.float32[_+13]=f,this.float32[_+14]=m,this.float32[_+15]=g,t}}Fl.prototype.bytesPerElement=64,xs(Fl,"StructArrayLayout16f64");class zl extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,r,n,o,s)}emplace(t,e,i,r,n,o,s,a){const l=10*t,c=5*t;return this.uint16[l+0]=e,this.uint16[l+1]=i,this.uint16[l+2]=r,this.uint16[l+3]=n,this.float32[c+2]=o,this.float32[c+3]=s,this.float32[c+4]=a,t}}zl.prototype.bytesPerElement=20,xs(zl,"StructArrayLayout4ui3f20");class Nl extends al{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint8[1*t+0]=e,t}}Nl.prototype.bytesPerElement=1,xs(Nl,"StructArrayLayout1ub1");class Ul extends sl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ul.prototype.size=40;class Gl extends Tl{get(t){return new Ul(this,t)}}xs(Gl,"CollisionBoxArray");class jl extends sl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}jl.prototype.size=60;class Vl extends Il{get(t){return new jl(this,t)}}xs(Vl,"PlacedSymbolArray");class Xl extends sl{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Xl.prototype.size=80;class Hl extends Cl{get(t){return new Xl(this,t)}}xs(Hl,"SymbolInstanceArray");class ql extends Pl{getoffsetX(t){return this.float32[1*t+0]}}xs(ql,"GlyphOffsetArray");class Wl extends ul{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}xs(Wl,"SymbolLineVertexArray");class $l extends sl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}$l.prototype.size=12;class Yl extends Dl{get(t){return new $l(this,t)}}xs(Yl,"FeatureIndexArray");class Zl extends wl{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}xs(Zl,"FillExtrusionCentroidArray");const Kl=ll([{name:"a_pos",components:2,type:"Int16"}],4),Jl=ll([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ql{constructor(t=[]){this.segments=t}_prepareSegment(t,e,i,r){let n=this.segments[this.segments.length-1];return t>Ql.MAX_VERTEX_ARRAY_LENGTH&&Y(`Max vertices per segment is ${Ql.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!n||n.vertexLength+t>Ql.MAX_VERTEX_ARRAY_LENGTH||n.sortKey!==r)&&(n={vertexOffset:e,primitiveOffset:i,vertexLength:0,primitiveLength:0},void 0!==r&&(n.sortKey=r),this.segments.push(n)),n}prepareSegment(t,e,i,r){return this._prepareSegment(t,e.length,i.length,r)}get(){return this.segments}destroy(){for(const t of this.segments)for(const e in t.vaos)t.vaos[e].destroy()}static simpleSegment(t,e,i,r){return new Ql([{vertexOffset:t,primitiveOffset:e,vertexLength:i,primitiveLength:r,vaos:{},sortKey:0}])}}function tc(t,e){return 256*(t=R(Math.floor(t),0,255))+R(Math.floor(e),0,255)}Ql.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,xs(Ql,"SegmentVector");const ec=ll([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ic=ll([{name:"a_dash",components:4,type:"Uint16"}]);var rc={exports:{}},nc={exports:{}};!function(t){t.exports=function(t,e){var i,r,n,o,s,a,l,c;for(r=t.length-(i=3&t.length),n=e,s=3432918353,a=461845907,c=0;c<r;)l=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,n=27492+(65535&(o=5*(65535&(n=(n^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|n>>>19))+((5*(n>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&t.charCodeAt(c+2))<<16;case 2:l^=(255&t.charCodeAt(c+1))<<8;case 1:n^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return n^=t.length,n=2246822507*(65535&(n^=n>>>16))+((2246822507*(n>>>16)&65535)<<16)&4294967295,n=3266489909*(65535&(n^=n>>>13))+((3266489909*(n>>>16)&65535)<<16)&4294967295,(n^=n>>>16)>>>0}}(nc);var oc=nc.exports,sc={exports:{}};!function(t){t.exports=function(t,e){for(var i,r=t.length,n=e^r,o=0;r>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(i>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),r-=4,++o;switch(r){case 3:n^=(255&t.charCodeAt(o+2))<<16;case 2:n^=(255&t.charCodeAt(o+1))<<8;case 1:n=1540483477*(65535&(n^=255&t.charCodeAt(o)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0}}(sc);var ac=oc,lc=sc.exports;rc.exports=ac,rc.exports.murmur3=ac,rc.exports.murmur2=lc;var cc=p(rc.exports);class uc{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,e,i,r){this.ids.push(hc(t)),this.positions.push(e,i,r)}eachPosition(t,e){const i=hc(t);let r=0,n=this.ids.length-1;for(;r<n;){const t=r+n>>1;this.ids[t]>=i?n=t:r=t+1}for(;this.ids[r]===i;)e(this.positions[3*r],this.positions[3*r+1],this.positions[3*r+2]),r++}static serialize(t,e){const i=new Float64Array(t.ids),r=new Uint32Array(t.positions);return function t(e,i,r,n){for(;r<n;){const o=e[r+n>>1];let s=r-1,a=n+1;for(;;){do{s++}while(e[s]<o);do{a--}while(e[a]>o);if(s>=a)break;dc(e,s,a),dc(i,3*s,3*a),dc(i,3*s+1,3*a+1),dc(i,3*s+2,3*a+2)}a-r<n-a?(t(e,i,r,a),r=a+1):(t(e,i,a+1,n),n=a)}}(i,r,0,i.length-1),e&&(e.add(i.buffer),e.add(r.buffer)),{ids:i,positions:r}}static deserialize(t){const e=new uc;let i;e.ids=t.ids,e.positions=t.positions;for(const t of e.ids)t!==i&&e.uniqueIds.push(t),i=t;return e.indexed=!0,e}}function hc(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:cc(String(t))}function dc(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}xs(uc,"FeaturePositionMap");class pc{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,e){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,e),this.initialized=!0),!!this.location}}class fc extends pc{constructor(t){super(t),this.current=0}set(t,e,i){this.fetchUniformLocation(t,e)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}}class mc extends pc{constructor(t){super(t),this.current=0}set(t,e,i){this.fetchUniformLocation(t,e)&&this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class gc extends pc{constructor(t){super(t),this.current=[0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}}class _c extends pc{constructor(t){super(t),this.current=[0,0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}}class yc extends pc{constructor(t){super(t),this.current=[0,0,0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3])))}}class vc extends pc{constructor(t){super(t),this.current=hi.transparent}set(t,e,i){this.fetchUniformLocation(t,e)&&(i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a)))}}const xc=new Float32Array(16);class bc extends pc{constructor(t){super(t),this.current=xc}set(t,e,i){if(this.fetchUniformLocation(t,e)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}}const wc=new Float32Array(9);class Tc extends pc{constructor(t){super(t),this.current=wc}set(t,e,i){if(this.fetchUniformLocation(t,e))for(let t=0;t<9;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}const Ec=new Float32Array(4);class Sc extends pc{constructor(t){super(t),this.current=Ec}set(t,e,i){if(this.fetchUniformLocation(t,e))for(let t=0;t<4;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}function Ac(t){return[tc(255*t.r,255*t.g),tc(255*t.b,255*t.a)]}class Mc{constructor(t,e,i){this.value=t,this.uniformNames=e.map(t=>"u_"+t),this.type=i}setUniform(t,e,i,r,n){e.set(t,n,r.constantOr(this.value))}getBinding(t,e){return"color"===this.type?new vc(t):new mc(t)}}class Ic{constructor(t,e){this.uniformNames=e.map(t=>"u_"+t),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,e,i,r,n){const o="u_pattern"===n||"u_dash"===n?this.pattern:"u_pixel_ratio"===n?this.pixelRatio:null;o&&e.set(t,n,o)}getBinding(t,e){return"u_pattern"===e||"u_dash"===e?new yc(t):new mc(t)}}class Cc{constructor(t,e,i,r){this.expression=t,this.type=i,this.maxValue=0,this.paintVertexAttributes=e.map(t=>({name:"a_"+t,type:"Float32",components:"color"===i?2:1,offset:0})),this.paintVertexArray=new r}populatePaintArray(t,e,i,r,n,o,s){const a=this.paintVertexArray.length,l=this.expression.evaluate(new Ua(0,{brightness:o}),e,{},n,r,s);this.paintVertexArray.resize(t),this._setPaintValue(a,t,l)}updatePaintArray(t,e,i,r,n,o,s){const a=this.expression.evaluate({zoom:0,brightness:s},i,r,void 0,n);this._setPaintValue(t,e,a)}_setPaintValue(t,e,i){if("color"===this.type){const r=Ac(i);for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,r[0],r[1])}else{for(let r=t;r<e;r++)this.paintVertexArray.emplace(r,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Pc{constructor(t,e,i,r,n,o){this.expression=t,this.uniformNames=e.map(t=>`u_${t}_t`),this.type=i,this.useIntegerZoom=r,this.zoom=n,this.maxValue=0,this.paintVertexAttributes=e.map(t=>({name:"a_"+t,type:"Float32",components:"color"===i?4:2,offset:0})),this.paintVertexArray=new o}populatePaintArray(t,e,i,r,n,o,s){const a=this.expression.evaluate(new Ua(this.zoom,{brightness:o}),e,{},n,r,s),l=this.expression.evaluate(new Ua(this.zoom+1,{brightness:o}),e,{},n,r,s),c=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(c,t,a,l)}updatePaintArray(t,e,i,r,n,o,s){const a=this.expression.evaluate({zoom:this.zoom,brightness:s},i,r,void 0,n),l=this.expression.evaluate({zoom:this.zoom+1,brightness:s},i,r,void 0,n);this._setPaintValue(t,e,a,l)}_setPaintValue(t,e,i,r){if("color"===this.type){const n=Ac(i),o=Ac(r);for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,n[0],n[1],o[0],o[1])}else{for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,i,r);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(r))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,e,i,r,n){const o=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,s=R(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(t,n,s)}getBinding(t,e){return new mc(t)}}class Rc{constructor(t,e,i,r,n){this.expression=t,this.layerId=n,this.paintVertexAttributes=("array"===i?ic:ec).members;for(let t=0;t<e.length;++t);this.paintVertexArray=new r}populatePaintArray(t,e,i){const r=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(r,t,e.patterns&&e.patterns[this.layerId],i)}updatePaintArray(t,e,i,r,n,o,s){this._setPaintValues(t,e,i.patterns&&i.patterns[this.layerId],o)}_setPaintValues(t,e,i,r){if(!r||!i)return;const n=r[i];if(!n)return;const{tl:o,br:s,pixelRatio:a}=n;for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,o[0],o[1],s[0],s[1],a)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Oc{constructor(t,e,i=(()=>!0)){this.binders={},this._buffers=[];const r=[];for(const n in t.paint._values){const o=t.paint.get(n);if(!i(n))continue;if(!(o instanceof Wa&&ro(o.property.specification)))continue;const s=kc(n,t.type),a=o.value,l=o.property.specification.type,c=!!o.property.useIntegerZoom,u="line-dasharray"===n||n.endsWith("pattern"),h="line-dasharray"===n&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==a.kind||h)if("source"===a.kind||h||u){const e=zc(n,l,"source");this.binders[n]=u?new Rc(a,s,l,e,t.id):new Cc(a,s,l,e),r.push("/a_"+n)}else{const t=zc(n,l,"composite");this.binders[n]=new Pc(a,s,l,c,e,t),r.push("/z_"+n)}else this.binders[n]=u?new Ic(a.value,s):new Mc(a.value,s,l),r.push("/u_"+n)}this.cacheKey=r.sort().join("")}getMaxValue(t){const e=this.binders[t];return e instanceof Cc||e instanceof Pc?e.maxValue:0}populatePaintArrays(t,e,i,r,n,o,s){for(const a in this.binders){const l=this.binders[a];(l instanceof Cc||l instanceof Pc||l instanceof Rc)&&l.populatePaintArray(t,e,i,r,n,o,s)}}setConstantPatternPositions(t){for(const e in this.binders){const i=this.binders[e];i instanceof Ic&&i.setConstantPatternPositions(t)}}updatePaintArrays(t,e,i,r,n,o,s,a){let l=!1;const c=Object.keys(t),u=0!==c.length,h=u?c:e.uniqueIds;for(const c in this.binders){const d=this.binders[c];if((d instanceof Cc||d instanceof Pc||d instanceof Rc)&&(!0===d.expression.isStateDependent||!1===d.expression.isLightConstant)){const p=n.paint.get(c);d.expression=p.value;for(const i of h){const n=t[i.toString()];e.eachPosition(i,(t,e,i)=>{const l=r.feature(t);d.updatePaintArray(e,i,l,n,o,s,a)})}if(!u)for(const e of i.uniqueIds){const n=t[e.toString()];i.eachPosition(e,(t,e,i)=>{const l=r.feature(t);d.updatePaintArray(e,i,l,n,o,s,a)})}l=!0}}return l}defines(){const t=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Mc||i instanceof Ic)&&t.push(...i.uniformNames.map(t=>"#define HAS_UNIFORM_"+t))}return t}getBinderAttributes(){const t=[];for(const e in this.binders){const i=this.binders[e];if(i instanceof Cc||i instanceof Pc||i instanceof Rc)for(let e=0;e<i.paintVertexAttributes.length;e++)t.push(i.paintVertexAttributes[e].name)}return t}getBinderUniforms(){const t=[];for(const e in this.binders){const i=this.binders[e];if(i instanceof Mc||i instanceof Ic||i instanceof Pc)for(const e of i.uniformNames)t.push(e)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const e=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof Mc||r instanceof Ic||r instanceof Pc)for(const n of r.uniformNames)e.push({name:n,property:i,binding:r.getBinding(t,n)})}return e}setUniforms(t,e,i,r,n){for(const{name:e,property:o,binding:s}of i)this.binders[o].setUniform(t,s,n,r.get(o),e)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const e=this.binders[t];(e instanceof Cc||e instanceof Pc||e instanceof Rc)&&e.paintVertexBuffer&&this._buffers.push(e.paintVertexBuffer)}}upload(t){for(const e in this.binders){const i=this.binders[e];(i instanceof Cc||i instanceof Pc||i instanceof Rc)&&i.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const e=this.binders[t];(e instanceof Cc||e instanceof Pc||e instanceof Rc)&&e.destroy()}}}class Dc{constructor(t,e,i=(()=>!0)){this.programConfigurations={};for(const r of t)this.programConfigurations[r.id]=new Oc(r,e,i);this.needsUpload=!1,this._featureMap=new uc,this._featureMapWithoutIds=new uc,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,e,i,r,n,o,s,a){for(const i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(t,e,r,n,o,s,a);void 0!==e.id?this._featureMap.add(e.id,i,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,i,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,e,i,r,n,o){for(const s of i)this.needsUpload=this.programConfigurations[s.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,e,s,r,n,o||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const Lc={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function kc(t,e){return Lc[t]||[t.replace(e+"-","").replace(/-/g,"_")]}const Bc={"line-pattern":{source:gl,composite:gl},"fill-pattern":{source:gl,composite:gl},"fill-extrusion-pattern":{source:gl,composite:gl},"line-dasharray":{source:_l,composite:_l}},Fc={color:{source:Bl,composite:ml},number:{source:Pl,composite:Bl}};function zc(t,e,i){const r=Bc[t];return r&&r[i]||Fc[e][i]}xs(Mc,"ConstantBinder"),xs(Ic,"PatternConstantBinder"),xs(Cc,"SourceExpressionBinder"),xs(Rc,"PatternCompositeBinder"),xs(Pc,"CompositeExpressionBinder"),xs(Oc,"ProgramConfiguration",{omit:["_buffers"]}),xs(Dc,"ProgramConfigurationSet");class Nc{constructor(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof mp?new mp(t.lng,t.lat):mp.convert(t),this}setSouthWest(t){return this._sw=t instanceof mp?new mp(t.lng,t.lat):mp.convert(t),this}extend(t){const e=this._sw,i=this._ne;let r,n;if(t instanceof mp)r=t,n=t;else{if(!(t instanceof Nc))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Nc.convert(t)):this.extend(mp.convert(t)):"object"==typeof t&&null!==t&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(mp.convert(t)):this;if(r=t._sw,n=t._ne,!r||!n)return this}return e||i?(e.lng=Math.min(r.lng,e.lng),e.lat=Math.min(r.lat,e.lat),i.lng=Math.max(n.lng,i.lng),i.lat=Math.max(n.lat,i.lat)):(this._sw=new mp(r.lng,r.lat),this._ne=new mp(n.lng,n.lat)),this}getCenter(){return new mp((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new mp(this.getWest(),this.getNorth())}getSouthEast(){return new mp(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:e,lat:i}=mp.convert(t);let r=this._sw.lng<=e&&e<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=e&&e>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&r}static convert(t){return!t||t instanceof Nc?t:new Nc(t)}}var Uc={},Gc={};Object.defineProperty(Gc,"__esModule",{value:!0}),Gc.setMatrixArrayType=function(t){Gc.ARRAY_TYPE=Vc=t},Gc.toRadian=function(t){return t*Hc},Gc.equals=function(t,e){return Math.abs(t-e)<=jc*Math.max(1,Math.abs(t),Math.abs(e))},Gc.RANDOM=Gc.ARRAY_TYPE=Gc.EPSILON=void 0;var jc=1e-6;Gc.EPSILON=jc;var Vc="undefined"!=typeof Float32Array?Float32Array:Array;Gc.ARRAY_TYPE=Vc;var Xc=Math.random;Gc.RANDOM=Xc;var Hc=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var qc={};function Wc(t){return(Wc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(qc,"__esModule",{value:!0}),qc.create=function(){var t=new $c.ARRAY_TYPE(4);return $c.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},qc.clone=function(t){var e=new $c.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},qc.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},qc.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},qc.fromValues=function(t,e,i,r){var n=new $c.ARRAY_TYPE(4);return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n},qc.set=function(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t},qc.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},qc.invert=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=i*o-n*r;return s?(t[0]=o*(s=1/s),t[1]=-r*s,t[2]=-n*s,t[3]=i*s,t):null},qc.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},qc.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},qc.multiply=Yc,qc.rotate=function(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+o*a,t[1]=n*l+s*a,t[2]=r*-a+o*l,t[3]=n*-a+s*l,t},qc.scale=function(t,e,i){var r=e[1],n=e[2],o=e[3],s=i[0],a=i[1];return t[0]=e[0]*s,t[1]=r*s,t[2]=n*a,t[3]=o*a,t},qc.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t},qc.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},qc.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},qc.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},qc.LDU=function(t,e,i,r){return t[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-t[2]*i[1],[t,e,i]},qc.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},qc.subtract=Zc,qc.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},qc.equals=function(t,e){var i=t[0],r=t[1],n=t[2],o=t[3],s=e[0],a=e[1],l=e[2],c=e[3];return Math.abs(i-s)<=$c.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-a)<=$c.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-l)<=$c.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(o-c)<=$c.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},qc.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},qc.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t},qc.sub=qc.mul=void 0;var $c=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==Wc(t)&&"function"!=typeof t)return{default:t};var i=function(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return function(t){return t?i:e}(t)}(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=n?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=t[o]}return r.default=t,i&&i.set(t,r),r}(Gc);function Yc(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=i[0],l=i[1],c=i[2],u=i[3];return t[0]=r*a+o*l,t[1]=n*a+s*l,t[2]=r*c+o*u,t[3]=n*c+s*u,t}function Zc(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}qc.mul=Yc,qc.sub=Zc;var Kc={};function Jc(t){return(Jc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(Kc,"__esModule",{value:!0}),Kc.create=function(){var t=new Qc.ARRAY_TYPE(6);return Qc.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},Kc.clone=function(t){var e=new Qc.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},Kc.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},Kc.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},Kc.fromValues=function(t,e,i,r,n,o){var s=new Qc.ARRAY_TYPE(6);return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s[4]=n,s[5]=o,s},Kc.set=function(t,e,i,r,n,o,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=o,t[5]=s,t},Kc.invert=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=i*o-r*n;return l?(t[0]=o*(l=1/l),t[1]=-r*l,t[2]=-n*l,t[3]=i*l,t[4]=(n*a-o*s)*l,t[5]=(r*s-i*a)*l,t):null},Kc.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},Kc.multiply=tu,Kc.rotate=function(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=Math.sin(i),u=Math.cos(i);return t[0]=r*u+o*c,t[1]=n*u+s*c,t[2]=r*-c+o*u,t[3]=n*-c+s*u,t[4]=a,t[5]=l,t},Kc.scale=function(t,e,i){var r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=i[0],c=i[1];return t[0]=e[0]*l,t[1]=r*l,t[2]=n*c,t[3]=o*c,t[4]=s,t[5]=a,t},Kc.translate=function(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=i[0],u=i[1];return t[0]=r,t[1]=n,t[2]=o,t[3]=s,t[4]=r*c+o*u+a,t[5]=n*c+s*u+l,t},Kc.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t[4]=0,t[5]=0,t},Kc.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},Kc.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},Kc.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},Kc.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},Kc.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t},Kc.subtract=eu,Kc.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t},Kc.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t},Kc.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},Kc.equals=function(t,e){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=e[0],c=e[1],u=e[2],h=e[3],d=e[4],p=e[5];return Math.abs(i-l)<=Qc.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=Qc.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-u)<=Qc.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(o-h)<=Qc.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(s-d)<=Qc.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(a-p)<=Qc.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))},Kc.sub=Kc.mul=void 0;var Qc=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==Jc(t)&&"function"!=typeof t)return{default:t};var i=function(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return function(t){return t?i:e}(t)}(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=n?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=t[o]}return r.default=t,i&&i.set(t,r),r}(Gc);function tu(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=i[0],u=i[1],h=i[2],d=i[3],p=i[4],f=i[5];return t[0]=r*c+o*u,t[1]=n*c+s*u,t[2]=r*h+o*d,t[3]=n*h+s*d,t[4]=r*p+o*f+a,t[5]=n*p+s*f+l,t}function eu(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}Kc.mul=tu,Kc.sub=eu;var iu={};function ru(t){return(ru="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(iu,"__esModule",{value:!0}),iu.create=function(){var t=new nu.ARRAY_TYPE(9);return nu.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},iu.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},iu.clone=function(t){var e=new nu.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},iu.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},iu.fromValues=function(t,e,i,r,n,o,s,a,l){var c=new nu.ARRAY_TYPE(9);return c[0]=t,c[1]=e,c[2]=i,c[3]=r,c[4]=n,c[5]=o,c[6]=s,c[7]=a,c[8]=l,c},iu.set=function(t,e,i,r,n,o,s,a,l,c){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=o,t[5]=s,t[6]=a,t[7]=l,t[8]=c,t},iu.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},iu.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},iu.invert=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*s-a*c,d=-u*o+a*l,p=c*o-s*l,f=i*h+r*d+n*p;return f?(t[0]=h*(f=1/f),t[1]=(-u*r+n*c)*f,t[2]=(a*r-n*s)*f,t[3]=d*f,t[4]=(u*i-n*l)*f,t[5]=(-a*i+n*o)*f,t[6]=p*f,t[7]=(-c*i+r*l)*f,t[8]=(s*i-r*o)*f,t):null},iu.adjoint=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t[0]=s*u-a*c,t[1]=n*c-r*u,t[2]=r*a-n*s,t[3]=a*l-o*u,t[4]=i*u-n*l,t[5]=n*o-i*a,t[6]=o*c-s*l,t[7]=r*l-i*c,t[8]=i*s-r*o,t},iu.determinant=function(t){var e=t[3],i=t[4],r=t[5],n=t[6],o=t[7],s=t[8];return t[0]*(s*i-r*o)+t[1]*(-s*e+r*n)+t[2]*(o*e-i*n)},iu.multiply=ou,iu.translate=function(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=i[0],p=i[1];return t[0]=r,t[1]=n,t[2]=o,t[3]=s,t[4]=a,t[5]=l,t[6]=d*r+p*s+c,t[7]=d*n+p*a+u,t[8]=d*o+p*l+h,t},iu.rotate=function(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=Math.sin(i),p=Math.cos(i);return t[0]=p*r+d*s,t[1]=p*n+d*a,t[2]=p*o+d*l,t[3]=p*s-d*r,t[4]=p*a-d*n,t[5]=p*l-d*o,t[6]=c,t[7]=u,t[8]=h,t},iu.scale=function(t,e,i){var r=i[0],n=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},iu.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},iu.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},iu.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},iu.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},iu.fromQuat=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=i+i,a=r+r,l=n+n,c=i*s,u=r*s,h=r*a,d=n*s,p=n*a,f=n*l,m=o*s,g=o*a,_=o*l;return t[0]=1-h-f,t[3]=u-_,t[6]=d+g,t[1]=u+_,t[4]=1-c-f,t[7]=p-m,t[2]=d-g,t[5]=p+m,t[8]=1-c-h,t},iu.normalFromMat4=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],_=e[15],y=i*a-r*s,v=i*l-n*s,x=i*c-o*s,b=r*l-n*a,w=r*c-o*a,T=n*c-o*l,E=u*m-h*f,S=u*g-d*f,A=u*_-p*f,M=h*g-d*m,I=h*_-p*m,C=d*_-p*g,P=y*C-v*I+x*M+b*A-w*S+T*E;return P?(t[0]=(a*C-l*I+c*M)*(P=1/P),t[1]=(l*A-s*C-c*S)*P,t[2]=(s*I-a*A+c*E)*P,t[3]=(n*I-r*C-o*M)*P,t[4]=(i*C-n*A+o*S)*P,t[5]=(r*A-i*I-o*E)*P,t[6]=(m*T-g*w+_*b)*P,t[7]=(g*x-f*T-_*v)*P,t[8]=(f*w-m*x+_*y)*P,t):null},iu.projection=function(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},iu.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},iu.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},iu.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t},iu.subtract=su,iu.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t},iu.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t},iu.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},iu.equals=function(t,e){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=e[0],d=e[1],p=e[2],f=e[3],m=e[4],g=e[5],_=e[6],y=e[7],v=e[8];return Math.abs(i-h)<=nu.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(r-d)<=nu.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(n-p)<=nu.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-f)<=nu.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(s-m)<=nu.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(a-g)<=nu.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(l-_)<=nu.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(c-y)<=nu.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(u-v)<=nu.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))},iu.sub=iu.mul=void 0;var nu=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==ru(t)&&"function"!=typeof t)return{default:t};var i=function(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return function(t){return t?i:e}(t)}(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=n?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=t[o]}return r.default=t,i&&i.set(t,r),r}(Gc);function ou(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=i[0],p=i[1],f=i[2],m=i[3],g=i[4],_=i[5],y=i[6],v=i[7],x=i[8];return t[0]=d*r+p*s+f*c,t[1]=d*n+p*a+f*u,t[2]=d*o+p*l+f*h,t[3]=m*r+g*s+_*c,t[4]=m*n+g*a+_*u,t[5]=m*o+g*l+_*h,t[6]=y*r+v*s+x*c,t[7]=y*n+v*a+x*u,t[8]=y*o+v*l+x*h,t}function su(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}iu.mul=ou,iu.sub=su;var au={};function lu(t){return(lu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(au,"__esModule",{value:!0}),au.create=function(){var t=new cu.ARRAY_TYPE(16);return cu.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},au.clone=function(t){var e=new cu.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},au.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},au.fromValues=function(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,m){var g=new cu.ARRAY_TYPE(16);return g[0]=t,g[1]=e,g[2]=i,g[3]=r,g[4]=n,g[5]=o,g[6]=s,g[7]=a,g[8]=l,g[9]=c,g[10]=u,g[11]=h,g[12]=d,g[13]=p,g[14]=f,g[15]=m,g},au.set=function(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=o,t[5]=s,t[6]=a,t[7]=l,t[8]=c,t[9]=u,t[10]=h,t[11]=d,t[12]=p,t[13]=f,t[14]=m,t[15]=g,t},au.identity=uu,au.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],n=e[3],o=e[6],s=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=n,t[13]=s,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},au.invert=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],_=e[15],y=i*a-r*s,v=i*l-n*s,x=i*c-o*s,b=r*l-n*a,w=r*c-o*a,T=n*c-o*l,E=u*m-h*f,S=u*g-d*f,A=u*_-p*f,M=h*g-d*m,I=h*_-p*m,C=d*_-p*g,P=y*C-v*I+x*M+b*A-w*S+T*E;return P?(t[0]=(a*C-l*I+c*M)*(P=1/P),t[1]=(n*I-r*C-o*M)*P,t[2]=(m*T-g*w+_*b)*P,t[3]=(d*w-h*T-p*b)*P,t[4]=(l*A-s*C-c*S)*P,t[5]=(i*C-n*A+o*S)*P,t[6]=(g*x-f*T-_*v)*P,t[7]=(u*T-d*x+p*v)*P,t[8]=(s*I-a*A+c*E)*P,t[9]=(r*A-i*I-o*E)*P,t[10]=(f*w-m*x+_*y)*P,t[11]=(h*x-u*w-p*y)*P,t[12]=(a*S-s*M-l*E)*P,t[13]=(i*M-r*S+n*E)*P,t[14]=(m*v-f*b-g*y)*P,t[15]=(u*b-h*v+d*y)*P,t):null},au.adjoint=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],_=e[15];return t[0]=a*(d*_-p*g)-h*(l*_-c*g)+m*(l*p-c*d),t[1]=-(r*(d*_-p*g)-h*(n*_-o*g)+m*(n*p-o*d)),t[2]=r*(l*_-c*g)-a*(n*_-o*g)+m*(n*c-o*l),t[3]=-(r*(l*p-c*d)-a*(n*p-o*d)+h*(n*c-o*l)),t[4]=-(s*(d*_-p*g)-u*(l*_-c*g)+f*(l*p-c*d)),t[5]=i*(d*_-p*g)-u*(n*_-o*g)+f*(n*p-o*d),t[6]=-(i*(l*_-c*g)-s*(n*_-o*g)+f*(n*c-o*l)),t[7]=i*(l*p-c*d)-s*(n*p-o*d)+u*(n*c-o*l),t[8]=s*(h*_-p*m)-u*(a*_-c*m)+f*(a*p-c*h),t[9]=-(i*(h*_-p*m)-u*(r*_-o*m)+f*(r*p-o*h)),t[10]=i*(a*_-c*m)-s*(r*_-o*m)+f*(r*c-o*a),t[11]=-(i*(a*p-c*h)-s*(r*p-o*h)+u*(r*c-o*a)),t[12]=-(s*(h*g-d*m)-u*(a*g-l*m)+f*(a*d-l*h)),t[13]=i*(h*g-d*m)-u*(r*g-n*m)+f*(r*d-n*h),t[14]=-(i*(a*g-l*m)-s*(r*g-n*m)+f*(r*l-n*a)),t[15]=i*(a*d-l*h)-s*(r*d-n*h)+u*(r*l-n*a),t},au.determinant=function(t){var e=t[0],i=t[1],r=t[2],n=t[3],o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15];return(e*s-i*o)*(h*g-d*m)-(e*a-r*o)*(u*g-d*f)+(e*l-n*o)*(u*m-h*f)+(i*a-r*s)*(c*g-d*p)-(i*l-n*s)*(c*m-h*p)+(r*l-n*a)*(c*f-u*p)},au.multiply=hu,au.translate=function(t,e,i){var r,n,o,s,a,l,c,u,h,d,p,f,m=i[0],g=i[1],_=i[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*_+e[12],t[13]=e[1]*m+e[5]*g+e[9]*_+e[13],t[14]=e[2]*m+e[6]*g+e[10]*_+e[14],t[15]=e[3]*m+e[7]*g+e[11]*_+e[15]):(n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],t[0]=r=e[0],t[1]=n,t[2]=o,t[3]=s,t[4]=a,t[5]=l,t[6]=c,t[7]=u,t[8]=h,t[9]=d,t[10]=p,t[11]=f,t[12]=r*m+a*g+h*_+e[12],t[13]=n*m+l*g+d*_+e[13],t[14]=o*m+c*g+p*_+e[14],t[15]=s*m+u*g+f*_+e[15]),t},au.scale=function(t,e,i){var r=i[0],n=i[1],o=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},au.rotate=function(t,e,i,r){var n,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,x,b,w,T,E,S,A,M,I=r[0],C=r[1],P=r[2],R=Math.hypot(I,C,P);return R<cu.EPSILON?null:(I*=R=1/R,C*=R,P*=R,n=Math.sin(i),o=Math.cos(i),l=e[1],c=e[2],u=e[3],d=e[5],p=e[6],f=e[7],g=e[9],_=e[10],y=e[11],w=I*C*(s=1-o)-P*n,T=C*C*s+o,E=P*C*s+I*n,S=I*P*s+C*n,A=C*P*s-I*n,M=P*P*s+o,t[0]=(a=e[0])*(v=I*I*s+o)+(h=e[4])*(x=C*I*s+P*n)+(m=e[8])*(b=P*I*s-C*n),t[1]=l*v+d*x+g*b,t[2]=c*v+p*x+_*b,t[3]=u*v+f*x+y*b,t[4]=a*w+h*T+m*E,t[5]=l*w+d*T+g*E,t[6]=c*w+p*T+_*E,t[7]=u*w+f*T+y*E,t[8]=a*S+h*A+m*M,t[9]=l*S+d*A+g*M,t[10]=c*S+p*A+_*M,t[11]=u*S+f*A+y*M,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},au.rotateX=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*n+c*r,t[5]=s*n+u*r,t[6]=a*n+h*r,t[7]=l*n+d*r,t[8]=c*n-o*r,t[9]=u*n-s*r,t[10]=h*n-a*r,t[11]=d*n-l*r,t},au.rotateY=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),o=e[0],s=e[1],a=e[2],l=e[3],c=e[8],u=e[9],h=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n-c*r,t[1]=s*n-u*r,t[2]=a*n-h*r,t[3]=l*n-d*r,t[8]=o*r+c*n,t[9]=s*r+u*n,t[10]=a*r+h*n,t[11]=l*r+d*n,t},au.rotateZ=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),o=e[0],s=e[1],a=e[2],l=e[3],c=e[4],u=e[5],h=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n+c*r,t[1]=s*n+u*r,t[2]=a*n+h*r,t[3]=l*n+d*r,t[4]=c*n-o*r,t[5]=u*n-s*r,t[6]=h*n-a*r,t[7]=d*n-l*r,t},au.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},au.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},au.fromRotation=function(t,e,i){var r,n,o,s=i[0],a=i[1],l=i[2],c=Math.hypot(s,a,l);return c<cu.EPSILON?null:(s*=c=1/c,a*=c,l*=c,r=Math.sin(e),n=Math.cos(e),t[0]=s*s*(o=1-n)+n,t[1]=a*s*o+l*r,t[2]=l*s*o-a*r,t[3]=0,t[4]=s*a*o-l*r,t[5]=a*a*o+n,t[6]=l*a*o+s*r,t[7]=0,t[8]=s*l*o+a*r,t[9]=a*l*o-s*r,t[10]=l*l*o+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},au.fromXRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},au.fromYRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},au.fromZRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},au.fromRotationTranslation=du,au.fromQuat2=function(t,e){var i=new cu.ARRAY_TYPE(3),r=-e[0],n=-e[1],o=-e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=r*r+n*n+o*o+s*s;return h>0?(i[0]=2*(a*s+u*r+l*o-c*n)/h,i[1]=2*(l*s+u*n+c*r-a*o)/h,i[2]=2*(c*s+u*o+a*n-l*r)/h):(i[0]=2*(a*s+u*r+l*o-c*n),i[1]=2*(l*s+u*n+c*r-a*o),i[2]=2*(c*s+u*o+a*n-l*r)),du(t,e,i),t},au.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},au.getScaling=pu,au.getRotation=function(t,e){var i=new cu.ARRAY_TYPE(3);pu(i,e);var r=1/i[0],n=1/i[1],o=1/i[2],s=e[0]*r,a=e[1]*n,l=e[2]*o,c=e[4]*r,u=e[5]*n,h=e[6]*o,d=e[8]*r,p=e[9]*n,f=e[10]*o,m=s+u+f,g=0;return m>0?(g=2*Math.sqrt(m+1),t[3]=.25*g,t[0]=(h-p)/g,t[1]=(d-l)/g,t[2]=(a-c)/g):s>u&&s>f?(g=2*Math.sqrt(1+s-u-f),t[3]=(h-p)/g,t[0]=.25*g,t[1]=(a+c)/g,t[2]=(d+l)/g):u>f?(g=2*Math.sqrt(1+u-s-f),t[3]=(d-l)/g,t[0]=(a+c)/g,t[1]=.25*g,t[2]=(h+p)/g):(g=2*Math.sqrt(1+f-s-u),t[3]=(a-c)/g,t[0]=(d+l)/g,t[1]=(h+p)/g,t[2]=.25*g),t},au.fromRotationTranslationScale=function(t,e,i,r){var n=e[0],o=e[1],s=e[2],a=e[3],l=n+n,c=o+o,u=s+s,h=n*l,d=n*c,p=n*u,f=o*c,m=o*u,g=s*u,_=a*l,y=a*c,v=a*u,x=r[0],b=r[1],w=r[2];return t[0]=(1-(f+g))*x,t[1]=(d+v)*x,t[2]=(p-y)*x,t[3]=0,t[4]=(d-v)*b,t[5]=(1-(h+g))*b,t[6]=(m+_)*b,t[7]=0,t[8]=(p+y)*w,t[9]=(m-_)*w,t[10]=(1-(h+f))*w,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},au.fromRotationTranslationScaleOrigin=function(t,e,i,r,n){var o=e[0],s=e[1],a=e[2],l=e[3],c=o+o,u=s+s,h=a+a,d=o*c,p=o*u,f=o*h,m=s*u,g=s*h,_=a*h,y=l*c,v=l*u,x=l*h,b=r[0],w=r[1],T=r[2],E=n[0],S=n[1],A=n[2],M=(1-(m+_))*b,I=(p+x)*b,C=(f-v)*b,P=(p-x)*w,R=(1-(d+_))*w,O=(g+y)*w,D=(f+v)*T,L=(g-y)*T,k=(1-(d+m))*T;return t[0]=M,t[1]=I,t[2]=C,t[3]=0,t[4]=P,t[5]=R,t[6]=O,t[7]=0,t[8]=D,t[9]=L,t[10]=k,t[11]=0,t[12]=i[0]+E-(M*E+P*S+D*A),t[13]=i[1]+S-(I*E+R*S+L*A),t[14]=i[2]+A-(C*E+O*S+k*A),t[15]=1,t},au.fromQuat=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=i+i,a=r+r,l=n+n,c=i*s,u=r*s,h=r*a,d=n*s,p=n*a,f=n*l,m=o*s,g=o*a,_=o*l;return t[0]=1-h-f,t[1]=u+_,t[2]=d-g,t[3]=0,t[4]=u-_,t[5]=1-c-f,t[6]=p+m,t[7]=0,t[8]=d+g,t[9]=p-m,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},au.frustum=function(t,e,i,r,n,o,s){var a=1/(i-e),l=1/(n-r),c=1/(o-s);return t[0]=2*o*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*l,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(n+r)*l,t[10]=(s+o)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*o*2*c,t[15]=0,t},au.perspectiveNO=fu,au.perspectiveZO=function(t,e,i,r,n){var o,s=1/Math.tan(e/2);return t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(t[10]=n*(o=1/(r-n)),t[14]=n*r*o):(t[10]=-1,t[14]=-r),t},au.perspectiveFromFieldOfView=function(t,e,i,r){var n=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(s+a),c=2/(n+o);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(s-a)*l*.5,t[9]=(n-o)*c*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t},au.orthoNO=mu,au.orthoZO=function(t,e,i,r,n,o,s){var a=1/(e-i),l=1/(r-n),c=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=c,t[11]=0,t[12]=(e+i)*a,t[13]=(n+r)*l,t[14]=o*c,t[15]=1,t},au.lookAt=function(t,e,i,r){var n,o,s,a,l,c,u,h,d,p,f=e[0],m=e[1],g=e[2],_=r[0],y=r[1],v=r[2],x=i[0],b=i[1],w=i[2];return Math.abs(f-x)<cu.EPSILON&&Math.abs(m-b)<cu.EPSILON&&Math.abs(g-w)<cu.EPSILON?uu(t):(u=f-x,h=m-b,d=g-w,n=y*(d*=p=1/Math.hypot(u,h,d))-v*(h*=p),o=v*(u*=p)-_*d,s=_*h-y*u,(p=Math.hypot(n,o,s))?(n*=p=1/p,o*=p,s*=p):(n=0,o=0,s=0),a=h*s-d*o,l=d*n-u*s,c=u*o-h*n,(p=Math.hypot(a,l,c))?(a*=p=1/p,l*=p,c*=p):(a=0,l=0,c=0),t[0]=n,t[1]=a,t[2]=u,t[3]=0,t[4]=o,t[5]=l,t[6]=h,t[7]=0,t[8]=s,t[9]=c,t[10]=d,t[11]=0,t[12]=-(n*f+o*m+s*g),t[13]=-(a*f+l*m+c*g),t[14]=-(u*f+h*m+d*g),t[15]=1,t)},au.targetTo=function(t,e,i,r){var n=e[0],o=e[1],s=e[2],a=r[0],l=r[1],c=r[2],u=n-i[0],h=o-i[1],d=s-i[2],p=u*u+h*h+d*d;p>0&&(u*=p=1/Math.sqrt(p),h*=p,d*=p);var f=l*d-c*h,m=c*u-a*d,g=a*h-l*u;return(p=f*f+m*m+g*g)>0&&(f*=p=1/Math.sqrt(p),m*=p,g*=p),t[0]=f,t[1]=m,t[2]=g,t[3]=0,t[4]=h*g-d*m,t[5]=d*f-u*g,t[6]=u*m-h*f,t[7]=0,t[8]=u,t[9]=h,t[10]=d,t[11]=0,t[12]=n,t[13]=o,t[14]=s,t[15]=1,t},au.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},au.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},au.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t},au.subtract=gu,au.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t},au.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t[9]=e[9]+i[9]*r,t[10]=e[10]+i[10]*r,t[11]=e[11]+i[11]*r,t[12]=e[12]+i[12]*r,t[13]=e[13]+i[13]*r,t[14]=e[14]+i[14]*r,t[15]=e[15]+i[15]*r,t},au.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},au.equals=function(t,e){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15],y=e[0],v=e[1],x=e[2],b=e[3],w=e[4],T=e[5],E=e[6],S=e[7],A=e[8],M=e[9],I=e[10],C=e[11],P=e[12],R=e[13],O=e[14],D=e[15];return Math.abs(i-y)<=cu.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(r-v)<=cu.EPSILON*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(n-x)<=cu.EPSILON*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(o-b)<=cu.EPSILON*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(s-w)<=cu.EPSILON*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(a-T)<=cu.EPSILON*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(l-E)<=cu.EPSILON*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(c-S)<=cu.EPSILON*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(u-A)<=cu.EPSILON*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(h-M)<=cu.EPSILON*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(d-I)<=cu.EPSILON*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(p-C)<=cu.EPSILON*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(f-P)<=cu.EPSILON*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(m-R)<=cu.EPSILON*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(g-O)<=cu.EPSILON*Math.max(1,Math.abs(g),Math.abs(O))&&Math.abs(_-D)<=cu.EPSILON*Math.max(1,Math.abs(_),Math.abs(D))},au.sub=au.mul=au.ortho=au.perspective=void 0;var cu=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==lu(t)&&"function"!=typeof t)return{default:t};var i=function(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return function(t){return t?i:e}(t)}(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=n?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=t[o]}return r.default=t,i&&i.set(t,r),r}(Gc);function uu(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function hu(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],m=e[12],g=e[13],_=e[14],y=e[15],v=i[0],x=i[1],b=i[2],w=i[3];return t[0]=v*r+x*a+b*h+w*m,t[1]=v*n+x*l+b*d+w*g,t[2]=v*o+x*c+b*p+w*_,t[3]=v*s+x*u+b*f+w*y,t[4]=(v=i[4])*r+(x=i[5])*a+(b=i[6])*h+(w=i[7])*m,t[5]=v*n+x*l+b*d+w*g,t[6]=v*o+x*c+b*p+w*_,t[7]=v*s+x*u+b*f+w*y,t[8]=(v=i[8])*r+(x=i[9])*a+(b=i[10])*h+(w=i[11])*m,t[9]=v*n+x*l+b*d+w*g,t[10]=v*o+x*c+b*p+w*_,t[11]=v*s+x*u+b*f+w*y,t[12]=(v=i[12])*r+(x=i[13])*a+(b=i[14])*h+(w=i[15])*m,t[13]=v*n+x*l+b*d+w*g,t[14]=v*o+x*c+b*p+w*_,t[15]=v*s+x*u+b*f+w*y,t}function du(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=r+r,l=n+n,c=o+o,u=r*a,h=r*l,d=r*c,p=n*l,f=n*c,m=o*c,g=s*a,_=s*l,y=s*c;return t[0]=1-(p+m),t[1]=h+y,t[2]=d-_,t[3]=0,t[4]=h-y,t[5]=1-(u+m),t[6]=f+g,t[7]=0,t[8]=d+_,t[9]=f-g,t[10]=1-(u+p),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function pu(t,e){var i=e[4],r=e[5],n=e[6],o=e[8],s=e[9],a=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(i,r,n),t[2]=Math.hypot(o,s,a),t}function fu(t,e,i,r,n){var o,s=1/Math.tan(e/2);return t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(t[10]=(n+r)*(o=1/(r-n)),t[14]=2*n*r*o):(t[10]=-1,t[14]=-2*r),t}function mu(t,e,i,r,n,o,s){var a=1/(e-i),l=1/(r-n),c=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(n+r)*l,t[14]=(s+o)*c,t[15]=1,t}function gu(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}au.perspective=fu,au.ortho=mu,au.mul=hu,au.sub=gu;var _u={},yu={};function vu(t){return(vu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(yu,"__esModule",{value:!0}),yu.create=bu,yu.clone=function(t){var e=new xu.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},yu.length=wu,yu.fromValues=function(t,e,i){var r=new xu.ARRAY_TYPE(3);return r[0]=t,r[1]=e,r[2]=i,r},yu.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},yu.set=function(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t},yu.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},yu.subtract=Tu,yu.multiply=Eu,yu.divide=Su,yu.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},yu.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},yu.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},yu.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},yu.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},yu.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},yu.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t},yu.distance=Au,yu.squaredDistance=Mu,yu.squaredLength=Iu,yu.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},yu.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},yu.normalize=function(t,e){var i=e[0],r=e[1],n=e[2],o=i*i+r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t},yu.dot=Cu,yu.cross=function(t,e,i){var r=e[0],n=e[1],o=e[2],s=i[0],a=i[1],l=i[2];return t[0]=n*l-o*a,t[1]=o*s-r*l,t[2]=r*a-n*s,t},yu.lerp=function(t,e,i,r){var n=e[0],o=e[1],s=e[2];return t[0]=n+r*(i[0]-n),t[1]=o+r*(i[1]-o),t[2]=s+r*(i[2]-s),t},yu.hermite=function(t,e,i,r,n,o){var s=o*o,a=s*(2*o-3)+1,l=s*(o-2)+o,c=s*(o-1),u=s*(3-2*o);return t[0]=e[0]*a+i[0]*l+r[0]*c+n[0]*u,t[1]=e[1]*a+i[1]*l+r[1]*c+n[1]*u,t[2]=e[2]*a+i[2]*l+r[2]*c+n[2]*u,t},yu.bezier=function(t,e,i,r,n,o){var s=1-o,a=s*s,l=o*o,c=a*s,u=3*o*a,h=3*l*s,d=l*o;return t[0]=e[0]*c+i[0]*u+r[0]*h+n[0]*d,t[1]=e[1]*c+i[1]*u+r[1]*h+n[1]*d,t[2]=e[2]*c+i[2]*u+r[2]*h+n[2]*d,t},yu.random=function(t,e){e=e||1;var i=2*xu.RANDOM()*Math.PI,r=2*xu.RANDOM()-1,n=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(i)*n,t[1]=Math.sin(i)*n,t[2]=r*e,t},yu.transformMat4=function(t,e,i){var r=e[0],n=e[1],o=e[2],s=i[3]*r+i[7]*n+i[11]*o+i[15];return t[0]=(i[0]*r+i[4]*n+i[8]*o+i[12])/(s=s||1),t[1]=(i[1]*r+i[5]*n+i[9]*o+i[13])/s,t[2]=(i[2]*r+i[6]*n+i[10]*o+i[14])/s,t},yu.transformMat3=function(t,e,i){var r=e[0],n=e[1],o=e[2];return t[0]=r*i[0]+n*i[3]+o*i[6],t[1]=r*i[1]+n*i[4]+o*i[7],t[2]=r*i[2]+n*i[5]+o*i[8],t},yu.transformQuat=function(t,e,i){var r=i[0],n=i[1],o=i[2],s=e[0],a=e[1],l=e[2],c=n*l-o*a,u=o*s-r*l,h=r*a-n*s,d=n*h-o*u,p=o*c-r*h,f=r*u-n*c,m=2*i[3];return u*=m,h*=m,p*=2,f*=2,t[0]=s+(c*=m)+(d*=2),t[1]=a+u+p,t[2]=l+h+f,t},yu.rotateX=function(t,e,i,r){var n=[],o=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],o[0]=n[0],o[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),o[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t},yu.rotateY=function(t,e,i,r){var n=[],o=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],o[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),o[1]=n[1],o[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t},yu.rotateZ=function(t,e,i,r){var n=[],o=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],o[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),o[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),o[2]=n[2],t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t},yu.angle=function(t,e){var i=t[0],r=t[1],n=t[2],o=e[0],s=e[1],a=e[2],l=Math.sqrt(i*i+r*r+n*n)*Math.sqrt(o*o+s*s+a*a),c=l&&Cu(t,e)/l;return Math.acos(Math.min(Math.max(c,-1),1))},yu.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},yu.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},yu.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},yu.equals=function(t,e){var i=t[0],r=t[1],n=t[2],o=e[0],s=e[1],a=e[2];return Math.abs(i-o)<=xu.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-s)<=xu.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-a)<=xu.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))},yu.forEach=yu.sqrLen=yu.len=yu.sqrDist=yu.dist=yu.div=yu.mul=yu.sub=void 0;var xu=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==vu(t)&&"function"!=typeof t)return{default:t};var i=function(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return function(t){return t?i:e}(t)}(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=n?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=t[o]}return r.default=t,i&&i.set(t,r),r}(Gc);function bu(){var t=new xu.ARRAY_TYPE(3);return xu.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function wu(t){return Math.hypot(t[0],t[1],t[2])}function Tu(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Eu(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function Su(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function Au(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function Mu(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return i*i+r*r+n*n}function Iu(t){var e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function Cu(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}yu.sub=Tu,yu.mul=Eu,yu.div=Su,yu.dist=Au,yu.sqrDist=Mu,yu.len=wu,yu.sqrLen=Iu;var Pu,Ru=(Pu=bu(),function(t,e,i,r,n,o){var s,a;for(e||(e=3),i||(i=0),a=r?Math.min(r*e+i,t.length):t.length,s=i;s<a;s+=e)Pu[0]=t[s],Pu[1]=t[s+1],Pu[2]=t[s+2],n(Pu,Pu,o),t[s]=Pu[0],t[s+1]=Pu[1],t[s+2]=Pu[2];return t});yu.forEach=Ru;var Ou={};function Du(t){return(Du="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(Ou,"__esModule",{value:!0}),Ou.create=ku,Ou.clone=function(t){var e=new Lu.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Ou.fromValues=function(t,e,i,r){var n=new Lu.ARRAY_TYPE(4);return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n},Ou.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Ou.set=function(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t},Ou.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},Ou.subtract=Bu,Ou.multiply=Fu,Ou.divide=zu,Ou.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Ou.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Ou.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},Ou.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},Ou.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Ou.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},Ou.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t},Ou.distance=Nu,Ou.squaredDistance=Uu,Ou.length=Gu,Ou.squaredLength=ju,Ou.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Ou.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Ou.normalize=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=i*i+r*r+n*n+o*o;return s>0&&(s=1/Math.sqrt(s)),t[0]=i*s,t[1]=r*s,t[2]=n*s,t[3]=o*s,t},Ou.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Ou.cross=function(t,e,i,r){var n=i[0]*r[1]-i[1]*r[0],o=i[0]*r[2]-i[2]*r[0],s=i[0]*r[3]-i[3]*r[0],a=i[1]*r[2]-i[2]*r[1],l=i[1]*r[3]-i[3]*r[1],c=i[2]*r[3]-i[3]*r[2],u=e[0],h=e[1],d=e[2],p=e[3];return t[0]=h*c-d*l+p*a,t[1]=-u*c+d*s-p*o,t[2]=u*l-h*s+p*n,t[3]=-u*a+h*o-d*n,t},Ou.lerp=function(t,e,i,r){var n=e[0],o=e[1],s=e[2],a=e[3];return t[0]=n+r*(i[0]-n),t[1]=o+r*(i[1]-o),t[2]=s+r*(i[2]-s),t[3]=a+r*(i[3]-a),t},Ou.random=function(t,e){var i,r,n,o,s,a;e=e||1;do{s=(i=2*Lu.RANDOM()-1)*i+(r=2*Lu.RANDOM()-1)*r}while(s>=1);do{a=(n=2*Lu.RANDOM()-1)*n+(o=2*Lu.RANDOM()-1)*o}while(a>=1);var l=Math.sqrt((1-s)/a);return t[0]=e*i,t[1]=e*r,t[2]=e*n*l,t[3]=e*o*l,t},Ou.transformMat4=function(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3];return t[0]=i[0]*r+i[4]*n+i[8]*o+i[12]*s,t[1]=i[1]*r+i[5]*n+i[9]*o+i[13]*s,t[2]=i[2]*r+i[6]*n+i[10]*o+i[14]*s,t[3]=i[3]*r+i[7]*n+i[11]*o+i[15]*s,t},Ou.transformQuat=function(t,e,i){var r=e[0],n=e[1],o=e[2],s=i[0],a=i[1],l=i[2],c=i[3],u=c*r+a*o-l*n,h=c*n+l*r-s*o,d=c*o+s*n-a*r,p=-s*r-a*n-l*o;return t[0]=u*c+p*-s+h*-l-d*-a,t[1]=h*c+p*-a+d*-s-u*-l,t[2]=d*c+p*-l+u*-a-h*-s,t[3]=e[3],t},Ou.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Ou.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Ou.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Ou.equals=function(t,e){var i=t[0],r=t[1],n=t[2],o=t[3],s=e[0],a=e[1],l=e[2],c=e[3];return Math.abs(i-s)<=Lu.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-a)<=Lu.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-l)<=Lu.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(o-c)<=Lu.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},Ou.forEach=Ou.sqrLen=Ou.len=Ou.sqrDist=Ou.dist=Ou.div=Ou.mul=Ou.sub=void 0;var Lu=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==Du(t)&&"function"!=typeof t)return{default:t};var i=function(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return function(t){return t?i:e}(t)}(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=n?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=t[o]}return r.default=t,i&&i.set(t,r),r}(Gc);function ku(){var t=new Lu.ARRAY_TYPE(4);return Lu.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Bu(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function Fu(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function zu(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function Nu(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function Uu(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],o=e[3]-t[3];return i*i+r*r+n*n+o*o}function Gu(t){return Math.hypot(t[0],t[1],t[2],t[3])}function ju(t){var e=t[0],i=t[1],r=t[2],n=t[3];return e*e+i*i+r*r+n*n}Ou.sub=Bu,Ou.mul=Fu,Ou.div=zu,Ou.dist=Nu,Ou.sqrDist=Uu,Ou.len=Gu,Ou.sqrLen=ju;var Vu=function(){var t=ku();return function(e,i,r,n,o,s){var a,l;for(i||(i=4),r||(r=0),l=n?Math.min(n*i+r,e.length):e.length,a=r;a<l;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],o(t,t,s),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}}();function Xu(t){return(Xu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Ou.forEach=Vu,Object.defineProperty(_u,"__esModule",{value:!0}),_u.create=Ku,_u.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},_u.setAxisAngle=Ju,_u.getAxisAngle=function(t,e){var i=2*Math.acos(e[3]),r=Math.sin(i/2);return r>Hu.EPSILON?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),i},_u.getAngle=function(t,e){var i=oh(t,e);return Math.acos(2*i*i-1)},_u.multiply=Qu,_u.rotateX=function(t,e,i){i*=.5;var r=e[0],n=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+s*a,t[1]=n*l+o*a,t[2]=o*l-n*a,t[3]=s*l-r*a,t},_u.rotateY=function(t,e,i){i*=.5;var r=e[0],n=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l-o*a,t[1]=n*l+s*a,t[2]=o*l+r*a,t[3]=s*l-n*a,t},_u.rotateZ=function(t,e,i){i*=.5;var r=e[0],n=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+n*a,t[1]=n*l-r*a,t[2]=o*l+s*a,t[3]=s*l-o*a,t},_u.calculateW=function(t,e){var i=e[0],r=e[1],n=e[2];return t[0]=i,t[1]=r,t[2]=n,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n)),t},_u.exp=th,_u.ln=eh,_u.pow=function(t,e,i){return eh(t,e),nh(t,t,i),th(t,t),t},_u.slerp=ih,_u.random=function(t){var e=Hu.RANDOM(),i=Hu.RANDOM(),r=Hu.RANDOM(),n=Math.sqrt(1-e),o=Math.sqrt(e);return t[0]=n*Math.sin(2*Math.PI*i),t[1]=n*Math.cos(2*Math.PI*i),t[2]=o*Math.sin(2*Math.PI*r),t[3]=o*Math.cos(2*Math.PI*r),t},_u.invert=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=i*i+r*r+n*n+o*o,a=s?1/s:0;return t[0]=-i*a,t[1]=-r*a,t[2]=-n*a,t[3]=o*a,t},_u.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},_u.fromMat3=rh,_u.fromEuler=function(t,e,i,r){var n=.5*Math.PI/180;e*=n,i*=n,r*=n;var o=Math.sin(e),s=Math.cos(e),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),u=Math.cos(r);return t[0]=o*l*u-s*a*c,t[1]=s*a*u+o*l*c,t[2]=s*l*c-o*a*u,t[3]=s*l*u+o*a*c,t},_u.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},_u.setAxes=_u.sqlerp=_u.rotationTo=_u.equals=_u.exactEquals=_u.normalize=_u.sqrLen=_u.squaredLength=_u.len=_u.length=_u.lerp=_u.dot=_u.scale=_u.mul=_u.add=_u.set=_u.copy=_u.fromValues=_u.clone=void 0;var Hu=Zu(Gc),qu=Zu(iu),Wu=Zu(yu),$u=Zu(Ou);function Yu(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(Yu=function(t){return t?i:e})(t)}function Zu(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==Xu(t)&&"function"!=typeof t)return{default:t};var i=Yu(e);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=n?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=t[o]}return r.default=t,i&&i.set(t,r),r}function Ku(){var t=new Hu.ARRAY_TYPE(4);return Hu.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ju(t,e,i){i*=.5;var r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function Qu(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=i[0],l=i[1],c=i[2],u=i[3];return t[0]=r*u+s*a+n*c-o*l,t[1]=n*u+s*l+o*a-r*c,t[2]=o*u+s*c+r*l-n*a,t[3]=s*u-r*a-n*l-o*c,t}function th(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=Math.sqrt(i*i+r*r+n*n),a=Math.exp(o),l=s>0?a*Math.sin(s)/s:0;return t[0]=i*l,t[1]=r*l,t[2]=n*l,t[3]=a*Math.cos(s),t}function eh(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=Math.sqrt(i*i+r*r+n*n),a=s>0?Math.atan2(s,o)/s:0;return t[0]=i*a,t[1]=r*a,t[2]=n*a,t[3]=.5*Math.log(i*i+r*r+n*n+o*o),t}function ih(t,e,i,r){var n,o,s,a,l,c=e[0],u=e[1],h=e[2],d=e[3],p=i[0],f=i[1],m=i[2],g=i[3];return(o=c*p+u*f+h*m+d*g)<0&&(o=-o,p=-p,f=-f,m=-m,g=-g),1-o>Hu.EPSILON?(n=Math.acos(o),s=Math.sin(n),a=Math.sin((1-r)*n)/s,l=Math.sin(r*n)/s):(a=1-r,l=r),t[0]=a*c+l*p,t[1]=a*u+l*f,t[2]=a*h+l*m,t[3]=a*d+l*g,t}function rh(t,e){var i,r=e[0]+e[4]+e[8];if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,t[0]=(e[5]-e[7])*(i=.5/i),t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var o=(n+1)%3,s=(n+2)%3;i=Math.sqrt(e[3*n+n]-e[3*o+o]-e[3*s+s]+1),t[n]=.5*i,t[3]=(e[3*o+s]-e[3*s+o])*(i=.5/i),t[o]=(e[3*o+n]+e[3*n+o])*i,t[s]=(e[3*s+n]+e[3*n+s])*i}return t}_u.clone=$u.clone,_u.fromValues=$u.fromValues,_u.copy=$u.copy,_u.set=$u.set,_u.add=$u.add,_u.mul=Qu;var nh=$u.scale;_u.scale=nh;var oh=$u.dot;_u.dot=oh,_u.lerp=$u.lerp;var sh=$u.length;_u.length=sh,_u.len=sh;var ah=$u.squaredLength;_u.squaredLength=ah,_u.sqrLen=ah;var lh=$u.normalize;_u.normalize=lh,_u.exactEquals=$u.exactEquals,_u.equals=$u.equals;var ch,uh,hh,dh=(ch=Wu.create(),uh=Wu.fromValues(1,0,0),hh=Wu.fromValues(0,1,0),function(t,e,i){var r=Wu.dot(e,i);return r<-.999999?(Wu.cross(ch,uh,e),Wu.len(ch)<1e-6&&Wu.cross(ch,hh,e),Wu.normalize(ch,ch),Ju(t,ch,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Wu.cross(ch,e,i),t[0]=ch[0],t[1]=ch[1],t[2]=ch[2],t[3]=1+r,lh(t,t))});_u.rotationTo=dh;var ph,fh,mh=(ph=Ku(),fh=Ku(),function(t,e,i,r,n,o){return ih(ph,e,n,o),ih(fh,i,r,o),ih(t,ph,fh,2*o*(1-o)),t});_u.sqlerp=mh;var gh,_h=(gh=qu.create(),function(t,e,i,r){return gh[0]=i[0],gh[3]=i[1],gh[6]=i[2],gh[1]=r[0],gh[4]=r[1],gh[7]=r[2],gh[2]=-e[0],gh[5]=-e[1],gh[8]=-e[2],lh(t,rh(t,gh))});_u.setAxes=_h;var yh={};function vh(t){return(vh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(yh,"__esModule",{value:!0}),yh.create=function(){var t=new xh.ARRAY_TYPE(8);return xh.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},yh.clone=function(t){var e=new xh.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},yh.fromValues=function(t,e,i,r,n,o,s,a){var l=new xh.ARRAY_TYPE(8);return l[0]=t,l[1]=e,l[2]=i,l[3]=r,l[4]=n,l[5]=o,l[6]=s,l[7]=a,l},yh.fromRotationTranslationValues=function(t,e,i,r,n,o,s){var a=new xh.ARRAY_TYPE(8);a[0]=t,a[1]=e,a[2]=i,a[3]=r;var l=.5*n,c=.5*o,u=.5*s;return a[4]=l*r+c*i-u*e,a[5]=c*r+u*t-l*i,a[6]=u*r+l*e-c*t,a[7]=-l*t-c*e-u*i,a},yh.fromRotationTranslation=Sh,yh.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},yh.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},yh.fromMat4=function(t,e){var i=bh.create();wh.getRotation(i,e);var r=new xh.ARRAY_TYPE(3);return wh.getTranslation(r,e),Sh(t,i,r),t},yh.copy=Ah,yh.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},yh.set=function(t,e,i,r,n,o,s,a,l){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=o,t[5]=s,t[6]=a,t[7]=l,t},yh.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},yh.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},yh.getTranslation=function(t,e){var i=e[4],r=e[5],n=e[6],o=e[7],s=-e[0],a=-e[1],l=-e[2],c=e[3];return t[0]=2*(i*c+o*s+r*l-n*a),t[1]=2*(r*c+o*a+n*s-i*l),t[2]=2*(n*c+o*l+i*a-r*s),t},yh.translate=function(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=.5*i[0],l=.5*i[1],c=.5*i[2],u=e[4],h=e[5],d=e[6],p=e[7];return t[0]=r,t[1]=n,t[2]=o,t[3]=s,t[4]=s*a+n*c-o*l+u,t[5]=s*l+o*a-r*c+h,t[6]=s*c+r*l-n*a+d,t[7]=-r*a-n*l-o*c+p,t},yh.rotateX=function(t,e,i){var r=-e[0],n=-e[1],o=-e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=a*s+u*r+l*o-c*n,d=l*s+u*n+c*r-a*o,p=c*s+u*o+a*n-l*r,f=u*s-a*r-l*n-c*o;return bh.rotateX(t,e,i),t[4]=h*(s=t[3])+f*(r=t[0])+d*(o=t[2])-p*(n=t[1]),t[5]=d*s+f*n+p*r-h*o,t[6]=p*s+f*o+h*n-d*r,t[7]=f*s-h*r-d*n-p*o,t},yh.rotateY=function(t,e,i){var r=-e[0],n=-e[1],o=-e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=a*s+u*r+l*o-c*n,d=l*s+u*n+c*r-a*o,p=c*s+u*o+a*n-l*r,f=u*s-a*r-l*n-c*o;return bh.rotateY(t,e,i),t[4]=h*(s=t[3])+f*(r=t[0])+d*(o=t[2])-p*(n=t[1]),t[5]=d*s+f*n+p*r-h*o,t[6]=p*s+f*o+h*n-d*r,t[7]=f*s-h*r-d*n-p*o,t},yh.rotateZ=function(t,e,i){var r=-e[0],n=-e[1],o=-e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=a*s+u*r+l*o-c*n,d=l*s+u*n+c*r-a*o,p=c*s+u*o+a*n-l*r,f=u*s-a*r-l*n-c*o;return bh.rotateZ(t,e,i),t[4]=h*(s=t[3])+f*(r=t[0])+d*(o=t[2])-p*(n=t[1]),t[5]=d*s+f*n+p*r-h*o,t[6]=p*s+f*o+h*n-d*r,t[7]=f*s-h*r-d*n-p*o,t},yh.rotateByQuatAppend=function(t,e,i){var r=i[0],n=i[1],o=i[2],s=i[3],a=e[0],l=e[1],c=e[2],u=e[3];return t[0]=a*s+u*r+l*o-c*n,t[1]=l*s+u*n+c*r-a*o,t[2]=c*s+u*o+a*n-l*r,t[3]=u*s-a*r-l*n-c*o,t[4]=(a=e[4])*s+(u=e[7])*r+(l=e[5])*o-(c=e[6])*n,t[5]=l*s+u*n+c*r-a*o,t[6]=c*s+u*o+a*n-l*r,t[7]=u*s-a*r-l*n-c*o,t},yh.rotateByQuatPrepend=function(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=i[0],l=i[1],c=i[2],u=i[3];return t[0]=r*u+s*a+n*c-o*l,t[1]=n*u+s*l+o*a-r*c,t[2]=o*u+s*c+r*l-n*a,t[3]=s*u-r*a-n*l-o*c,t[4]=r*(u=i[7])+s*(a=i[4])+n*(c=i[6])-o*(l=i[5]),t[5]=n*u+s*l+o*a-r*c,t[6]=o*u+s*c+r*l-n*a,t[7]=s*u-r*a-n*l-o*c,t},yh.rotateAroundAxis=function(t,e,i,r){if(Math.abs(r)<xh.EPSILON)return Ah(t,e);var n=Math.hypot(i[0],i[1],i[2]);r*=.5;var o=Math.sin(r),s=o*i[0]/n,a=o*i[1]/n,l=o*i[2]/n,c=Math.cos(r),u=e[0],h=e[1],d=e[2],p=e[3];t[0]=u*c+p*s+h*l-d*a,t[1]=h*c+p*a+d*s-u*l,t[2]=d*c+p*l+u*a-h*s,t[3]=p*c-u*s-h*a-d*l;var f=e[4],m=e[5],g=e[6],_=e[7];return t[4]=f*c+_*s+m*l-g*a,t[5]=m*c+_*a+g*s-f*l,t[6]=g*c+_*l+f*a-m*s,t[7]=_*c-f*s-m*a-g*l,t},yh.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t},yh.multiply=Mh,yh.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t},yh.lerp=function(t,e,i,r){var n=1-r;return Ih(e,i)<0&&(r=-r),t[0]=e[0]*n+i[0]*r,t[1]=e[1]*n+i[1]*r,t[2]=e[2]*n+i[2]*r,t[3]=e[3]*n+i[3]*r,t[4]=e[4]*n+i[4]*r,t[5]=e[5]*n+i[5]*r,t[6]=e[6]*n+i[6]*r,t[7]=e[7]*n+i[7]*r,t},yh.invert=function(t,e){var i=Ph(e);return t[0]=-e[0]/i,t[1]=-e[1]/i,t[2]=-e[2]/i,t[3]=e[3]/i,t[4]=-e[4]/i,t[5]=-e[5]/i,t[6]=-e[6]/i,t[7]=e[7]/i,t},yh.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},yh.normalize=function(t,e){var i=Ph(e);if(i>0){i=Math.sqrt(i);var r=e[0]/i,n=e[1]/i,o=e[2]/i,s=e[3]/i,a=e[4],l=e[5],c=e[6],u=e[7],h=r*a+n*l+o*c+s*u;t[0]=r,t[1]=n,t[2]=o,t[3]=s,t[4]=(a-r*h)/i,t[5]=(l-n*h)/i,t[6]=(c-o*h)/i,t[7]=(u-s*h)/i}return t},yh.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},yh.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},yh.equals=function(t,e){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=e[0],h=e[1],d=e[2],p=e[3],f=e[4],m=e[5],g=e[6],_=e[7];return Math.abs(i-u)<=xh.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(r-h)<=xh.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(n-d)<=xh.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(o-p)<=xh.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(s-f)<=xh.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(a-m)<=xh.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(l-g)<=xh.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(c-_)<=xh.EPSILON*Math.max(1,Math.abs(c),Math.abs(_))},yh.sqrLen=yh.squaredLength=yh.len=yh.length=yh.dot=yh.mul=yh.setReal=yh.getReal=void 0;var xh=Eh(Gc),bh=Eh(_u),wh=Eh(au);function Th(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(Th=function(t){return t?i:e})(t)}function Eh(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==vh(t)&&"function"!=typeof t)return{default:t};var i=Th(e);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=n?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=t[o]}return r.default=t,i&&i.set(t,r),r}function Sh(t,e,i){var r=.5*i[0],n=.5*i[1],o=.5*i[2],s=e[0],a=e[1],l=e[2],c=e[3];return t[0]=s,t[1]=a,t[2]=l,t[3]=c,t[4]=r*c+n*l-o*a,t[5]=n*c+o*s-r*l,t[6]=o*c+r*a-n*s,t[7]=-r*s-n*a-o*l,t}function Ah(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Mh(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=i[4],l=i[5],c=i[6],u=i[7],h=e[4],d=e[5],p=e[6],f=e[7],m=i[0],g=i[1],_=i[2],y=i[3];return t[0]=r*y+s*m+n*_-o*g,t[1]=n*y+s*g+o*m-r*_,t[2]=o*y+s*_+r*g-n*m,t[3]=s*y-r*m-n*g-o*_,t[4]=r*u+s*a+n*c-o*l+h*y+f*m+d*_-p*g,t[5]=n*u+s*l+o*a-r*c+d*y+f*g+p*m-h*_,t[6]=o*u+s*c+r*l-n*a+p*y+f*_+h*g-d*m,t[7]=s*u-r*a-n*l-o*c+f*y-h*m-d*g-p*_,t}yh.getReal=bh.copy,yh.setReal=bh.copy,yh.mul=Mh;var Ih=bh.dot;yh.dot=Ih;var Ch=bh.length;yh.length=Ch,yh.len=Ch;var Ph=bh.squaredLength;yh.squaredLength=Ph,yh.sqrLen=Ph;var Rh={};function Oh(t){return(Oh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(Rh,"__esModule",{value:!0}),Rh.create=Lh,Rh.clone=function(t){var e=new Dh.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},Rh.fromValues=function(t,e){var i=new Dh.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},Rh.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},Rh.set=function(t,e,i){return t[0]=e,t[1]=i,t},Rh.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},Rh.subtract=kh,Rh.multiply=Bh,Rh.divide=Fh,Rh.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},Rh.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},Rh.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},Rh.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},Rh.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},Rh.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},Rh.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t},Rh.distance=zh,Rh.squaredDistance=Nh,Rh.length=Uh,Rh.squaredLength=Gh,Rh.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},Rh.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},Rh.normalize=function(t,e){var i=e[0],r=e[1],n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t},Rh.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},Rh.cross=function(t,e,i){var r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t},Rh.lerp=function(t,e,i,r){var n=e[0],o=e[1];return t[0]=n+r*(i[0]-n),t[1]=o+r*(i[1]-o),t},Rh.random=function(t,e){e=e||1;var i=2*Dh.RANDOM()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},Rh.transformMat2=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n,t[1]=i[1]*r+i[3]*n,t},Rh.transformMat2d=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n+i[4],t[1]=i[1]*r+i[3]*n+i[5],t},Rh.transformMat3=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[3]*n+i[6],t[1]=i[1]*r+i[4]*n+i[7],t},Rh.transformMat4=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t},Rh.rotate=function(t,e,i,r){var n=e[0]-i[0],o=e[1]-i[1],s=Math.sin(r),a=Math.cos(r);return t[0]=n*a-o*s+i[0],t[1]=n*s+o*a+i[1],t},Rh.angle=function(t,e){var i=t[0],r=t[1],n=e[0],o=e[1],s=Math.sqrt(i*i+r*r)*Math.sqrt(n*n+o*o);return Math.acos(Math.min(Math.max(s&&(i*n+r*o)/s,-1),1))},Rh.zero=function(t){return t[0]=0,t[1]=0,t},Rh.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},Rh.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Rh.equals=function(t,e){var i=t[0],r=t[1],n=e[0],o=e[1];return Math.abs(i-n)<=Dh.EPSILON*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-o)<=Dh.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))},Rh.forEach=Rh.sqrLen=Rh.sqrDist=Rh.dist=Rh.div=Rh.mul=Rh.sub=Rh.len=void 0;var Dh=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==Oh(t)&&"function"!=typeof t)return{default:t};var i=function(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return function(t){return t?i:e}(t)}(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=n?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=t[o]}return r.default=t,i&&i.set(t,r),r}(Gc);function Lh(){var t=new Dh.ARRAY_TYPE(2);return Dh.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function kh(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function Bh(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function Fh(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function zh(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function Nh(t,e){var i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}function Uh(t){return Math.hypot(t[0],t[1])}function Gh(t){var e=t[0],i=t[1];return e*e+i*i}Rh.len=Uh,Rh.sub=kh,Rh.mul=Bh,Rh.div=Fh,Rh.dist=zh,Rh.sqrDist=Nh,Rh.sqrLen=Gh;var jh=function(){var t=Lh();return function(e,i,r,n,o,s){var a,l;for(i||(i=2),r||(r=0),l=n?Math.min(n*i+r,e.length):e.length,a=r;a<l;a+=i)t[0]=e[a],t[1]=e[a+1],o(t,t,s),e[a]=t[0],e[a+1]=t[1];return e}}();function Vh(t){return(Vh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Rh.forEach=jh,Object.defineProperty(Uc,"__esModule",{value:!0});var Xh=Uc.vec4=nd=Uc.vec3=Uc.vec2=Uc.quat2=td=Uc.quat=Jh=Uc.mat4=Zh=Uc.mat3=Uc.mat2d=Wh=Uc.mat2=Uc.glMatrix=void 0,Hh=ad(Gc);Uc.glMatrix=Hh;var qh=ad(qc),Wh=Uc.mat2=qh,$h=ad(Kc);Uc.mat2d=$h;var Yh=ad(iu),Zh=Uc.mat3=Yh,Kh=ad(au),Jh=Uc.mat4=Kh,Qh=ad(_u),td=Uc.quat=Qh,ed=ad(yh);Uc.quat2=ed;var id=ad(Rh);Uc.vec2=id;var rd=ad(yu),nd=Uc.vec3=rd,od=ad(Ou);function sd(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(sd=function(t){return t?i:e})(t)}function ad(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==Vh(t)&&"function"!=typeof t)return{default:t};var i=sd(e);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=n?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=t[o]}return r.default=t,i&&i.set(t,r),r}Xh=Uc.vec4=od;const ld=ll([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:cd}=ld,ud=ll([{name:"a_pos_3",components:3,type:"Int16"}]);var hd=ll([{name:"a_pos",type:"Int16",components:2}]),dd={};!function(t,e){!function(t){function e(t,e,r){var n=i(256*t,256*(e=Math.pow(2,r)-e-1),r),o=i(256*(t+1),256*(e+1),r);return n[0]+","+n[1]+","+o[0]+","+o[1]}function i(t,e,i){var r=2*Math.PI*6378137/256/Math.pow(2,i);return[t*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}t.getURL=function(t,i,r,n,o,s){return s=s||{},t+"?"+["bbox="+e(r,n,o),"format="+(s.format||"image/png"),"service="+(s.service||"WMS"),"version="+(s.version||"1.1.1"),"request="+(s.request||"GetMap"),"srs="+(s.srs||"EPSG:3857"),"width="+(s.width||256),"height="+(s.height||256),"layers="+i].join("&")},t.getTileBBox=e,t.getMercCoords=i,Object.defineProperty(t,"__esModule",{value:!0})}(e)}(0,dd);var pd=dd;class fd{constructor(t,e,i){this.z=t,this.x=e,this.y=i,this.key=_d(0,t,t,e,i)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,e){const i=pd.getTileBBox(this.x,this.y,this.z),r=function(t,e,i){let r,n="";for(let o=t;o>0;o--)r=1<<o-1,n+=(e&r?1:0)+(i&r?2:0);return n}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",r).replace("{bbox-epsg-3857}",i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class md{constructor(t,e){this.wrap=t,this.canonical=e,this.key=_d(t,e.z,e.z,e.x,e.y)}}class gd{constructor(t,e,i,r,n){this.overscaledZ=t,this.wrap=e,this.canonical=new fd(i,+r,+n),this.key=0===e&&t===i?this.canonical.key:_d(e,t,i,r,n)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const e=this.canonical.z-t;return t>this.canonical.z?new gd(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new gd(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)}calculateScaledKey(t,e=!0){if(this.overscaledZ===t&&e)return this.key;if(t>this.canonical.z)return _d(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y);{const i=this.canonical.z-t;return _d(this.wrap*+e,t,t,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e}children(t){if(this.overscaledZ>=t)return[new gd(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const e=this.canonical.z+1,i=2*this.canonical.x,r=2*this.canonical.y;return[new gd(e,this.wrap,e,i,r),new gd(e,this.wrap,e,i+1,r),new gd(e,this.wrap,e,i,r+1),new gd(e,this.wrap,e,i+1,r+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new gd(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new gd(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new md(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function _d(t,e,i,r,n){const o=1<<Math.min(i,22);let s=o*(n%o)+r%o;return t&&i<22&&(s+=o*o*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*s+i)+(e-i)}const yd=[t=>{let e=t.canonical.x-1,i=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,i--),new gd(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,i=t.wrap;return e===1<<t.canonical.z&&(e=0,i++),new gd(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>new gd(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(0===t.canonical.y?1<<t.canonical.z:t.canonical.y)-1),t=>new gd(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];xs(fd,"CanonicalTileID"),xs(gd,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});class vd{constructor(t,e){this.pos=t,this.dir=e}intersectsPlane(t,e,i){const r=nd.dot(e,this.dir);if(Math.abs(r)<1e-6)return!1;const n=((t[0]-this.pos[0])*e[0]+(t[1]-this.pos[1])*e[1]+(t[2]-this.pos[2])*e[2])/r;return i[0]=this.pos[0]+this.dir[0]*n,i[1]=this.pos[1]+this.dir[1]*n,i[2]=this.pos[2]+this.dir[2]*n,!0}closestPointOnSphere(t,e,i){if(nd.equals(this.pos,t)||0===e)return i[0]=i[1]=i[2]=0,!1;const[r,n,o]=this.dir,s=this.pos[0]-t[0],a=this.pos[1]-t[1],l=this.pos[2]-t[2],c=r*r+n*n+o*o,u=2*(s*r+a*n+l*o),h=u*u-4*c*(s*s+a*a+l*l-e*e);if(h<0){const t=Math.max(-u/2,0),c=s+r*t,h=a+n*t,d=l+o*t,p=Math.hypot(c,h,d);return i[0]=c*e/p,i[1]=h*e/p,i[2]=d*e/p,!1}{const t=(-u-Math.sqrt(h))/(2*c);if(t<0){const t=Math.hypot(s,a,l);return i[0]=s*e/t,i[1]=a*e/t,i[2]=l*e/t,!1}return i[0]=s+r*t,i[1]=a+n*t,i[2]=l+o*t,!0}}}class xd{constructor(t,e,i,r,n){this.TL=t,this.TR=e,this.BR=i,this.BL=r,this.horizon=n}static fromInvProjectionMatrix(t,e,i){const r=[-1,1,1],n=[1,1,1],o=[1,-1,1],s=[-1,-1,1],a=nd.transformMat4(r,r,t),l=nd.transformMat4(n,n,t),c=nd.transformMat4(o,o,t),u=nd.transformMat4(s,s,t);return new xd(a,l,c,u,e/i)}}function bd(t,e,i){let r=1/0,n=-1/0;const o=[];for(const s of t){nd.sub(o,s,e);const t=nd.dot(o,i);r=Math.min(r,t),n=Math.max(n,t)}return[r,n]}function wd(t,e){let i=!0;for(let r=0;r<t.planes.length;r++){const n=t.planes[r];let o=0;for(let t=0;t<e.length;t++)o+=nd.dot(n,e[t])+n[3]>=0;if(0===o)return 0;o!==e.length&&(i=!1)}return i?2:1}function Td(t,e){for(const i of t.projections){const r=bd(e,t.points[0],i.axis);if(i.projection[1]<r[0]||i.projection[0]>r[1])return 0}return 1}function Ed(t,e){let i=0;const r=[0,0,0,0];for(let n=0;n<t.length;n++)r[0]=t[n][0],r[1]=t[n][1],r[2]=t[n][2],r[3]=1,Xh.dot(r,e)>=0&&i++;return i}class Sd{constructor(t,e){this.points=t||new Array(8).fill([0,0,0]),this.planes=e||new Array(6).fill([0,0,0,0]),this.bounds=Ad.fromPoints(this.points),this.projections=[],this.frustumEdges=[nd.sub([],this.points[2],this.points[3]),nd.sub([],this.points[0],this.points[3]),nd.sub([],this.points[4],this.points[0]),nd.sub([],this.points[5],this.points[1]),nd.sub([],this.points[6],this.points[2]),nd.sub([],this.points[7],this.points[3])];for(const t of this.frustumEdges){const e=[0,-t[2],t[1]],i=[t[2],0,-t[0]];this.projections.push({axis:e,projection:bd(this.points,this.points[0],e)}),this.projections.push({axis:i,projection:bd(this.points,this.points[0],i)})}}static fromInvProjectionMatrix(t,e,i,r){const n=Math.pow(2,i),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(i=>{const o=Xh.transformMat4([],i,t),s=1/o[3]/e*n;return Xh.mul(o,o,[s,s,r?1/o[3]:s,s])}),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(t=>{const e=nd.sub([],o[t[0]],o[t[1]]),i=nd.sub([],o[t[2]],o[t[1]]),r=nd.normalize([],nd.cross([],e,i)),n=-nd.dot(r,o[t[1]]);return r.concat(n)}),a=[];for(let t=0;t<o.length;t++)a.push([o[t][0],o[t][1],o[t][2]]);return new Sd(a,s)}intersectsPrecise(t,e,i){for(let i=0;i<e.length;i++)if(!Ed(t,e[i]))return 0;for(let e=0;e<this.planes.length;e++)if(!Ed(t,this.planes[e]))return 0;for(const e of i)for(const i of this.frustumEdges){const r=nd.cross([],e,i),n=nd.length(r);if(0===n)continue;nd.scale(r,r,1/n);const o=bd(this.points,this.points[0],r),s=bd(t,this.points[0],r);if(o[0]>s[1]||s[0]>o[1])return 0}return 1}}class Ad{static fromPoints(t){const e=[1/0,1/0,1/0],i=[-1/0,-1/0,-1/0];for(const r of t)nd.min(e,e,r),nd.max(i,i,r);return new Ad(e,i)}static fromTileIdAndHeight(t,e,i){const r=1<<t.canonical.z,n=t.canonical.x,o=t.canonical.y;return new Ad([n/r,o/r,e],[(n+1)/r,(o+1)/r,i])}static applyTransform(t,e){const i=t.getCorners();for(let t=0;t<i.length;++t)nd.transformMat4(i[t],i[t],e);return Ad.fromPoints(i)}static projectAabbCorners(t,e){const i=t.getCorners();for(let t=0;t<i.length;++t)nd.transformMat4(i[t],i[t],e);return i}constructor(t,e){this.min=t,this.max=e,this.center=nd.scale([],nd.add([],this.min,this.max),.5)}quadrant(t){const e=[t%2==0,t<2],i=nd.clone(this.min),r=nd.clone(this.max);for(let t=0;t<e.length;t++)i[t]=e[t]?this.min[t]:this.center[t],r[t]=e[t]?this.center[t]:this.max[t];return r[2]=this.max[2],new Ad(i,r)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,e=this.max;return[[t[0],t[1],t[2]],[e[0],t[1],t[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],e[2]],[t[0],e[1],e[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?wd(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?wd(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,e){return e||this.intersects(t)?Td(t,this.getCorners()):0}intersectsPreciseFlat(t,e){return e||this.intersectsFlat(t)?Td(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let e=0;e<3;++e)if(this.min[e]>t.max[e]||t.min[e]>this.max[e])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let e=0;e<3;e++)this.min[e]=Math.min(this.min[e],t.min[e]),this.max[e]=Math.max(this.max[e],t.max[e])}encapsulatePoint(t){for(let e=0;e<3;e++)this.min[e]=Math.min(this.min[e],t[e]),this.max[e]=Math.max(this.max[e],t[e])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}xs(Ad,"Aabb");const Md=ur/Math.PI/2,Id=[64,32,16],Cd=-Md,Pd=Md,Rd=[new Ad([Cd,Cd,Cd],[Pd,Pd,Pd]),new Ad([Cd,Cd,Cd],[0,0,Pd]),new Ad([0,Cd,Cd],[Pd,0,Pd]),new Ad([Cd,0,Cd],[0,Pd,Pd]),new Ad([0,0,Cd],[Pd,Pd,Pd])];function Od(t){return t*Md/dp}function Dd(t,e,i,r=!0){const n=nd.scale([],t._camera.position,t.worldSize),o=[e,i,1,1];Xh.transformMat4(o,o,t.pixelMatrixInverse),Xh.scale(o,o,1/o[3]);const s=nd.sub([],o,n),a=nd.normalize([],s),l=t.globeMatrix,c=[l[12],l[13],l[14]],u=nd.sub([],c,n),h=nd.length(u),d=nd.normalize([],u),p=t.worldSize/(2*Math.PI),f=nd.dot(d,a),m=Math.asin(p/h);if(m<Math.acos(f)){if(!r)return null;const t=[],e=[];nd.scale(t,a,h/f),nd.normalize(e,nd.sub(e,t,u)),nd.normalize(a,nd.add(a,u,nd.scale(a,e,Math.tan(m)*h)))}const g=[];new vd(n,a).closestPointOnSphere(c,p,g);const _=nd.normalize([],ot(l,0)),y=nd.normalize([],ot(l,1)),v=nd.normalize([],ot(l,2)),x=nd.dot(_,g),b=nd.dot(y,g),w=nd.dot(v,g),T=E(Math.asin(-b/p));let S=E(Math.atan2(x,w));S=t.center.lng+function(t,e){const i=(e-t+180)%360-180;return i<-180?i+360:i}(t.center.lng,S);const A=_p(S),M=R(yp(T),0,1);return new Ip(A,M)}class Ld{constructor(t,e,i){this.a=nd.sub([],t,i),this.b=nd.sub([],e,i),this.center=i;const r=nd.normalize([],this.a),n=nd.normalize([],this.b);this.angle=Math.acos(nd.dot(r,n))}}function kd(t,e){if(0===t.angle)return null;let i;return i=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(t,e,i,r){const n=Math.sin(i);return t*(Math.sin((1-r)*i)/n)+e*(Math.sin(r*i)/n)}(t.a[e],t.b[e],t.angle,R(i,0,1))+t.center[e]}function Bd(t){if(t.z<=1)return Rd[t.z+2*t.y+t.x];const e=jd(Gd(t));return Ad.fromPoints(e)}function Fd(t,e,i){return nd.scale(t,t,1-i),nd.scaleAndAdd(t,t,e,i)}function zd(t,e){const i=tp(e.zoom);if(0===i)return Bd(t);const r=Gd(t),n=jd(r),o=_p(r.getWest())*e.worldSize,s=_p(r.getEast())*e.worldSize,a=yp(r.getNorth())*e.worldSize,l=yp(r.getSouth())*e.worldSize,c=[o,a,0],u=[s,a,0],h=[o,l,0],d=[s,l,0],p=Jh.invert([],e.globeMatrix);return nd.transformMat4(c,c,p),nd.transformMat4(u,u,p),nd.transformMat4(h,h,p),nd.transformMat4(d,d,p),n[0]=Fd(n[0],h,i),n[1]=Fd(n[1],d,i),n[2]=Fd(n[2],u,i),n[3]=Fd(n[3],c,i),Ad.fromPoints(n)}function Nd(t,e,i){for(const r of t)nd.transformMat4(r,r,e),nd.scale(r,r,i)}function Ud(t,e,i,r){const n=e/t.worldSize,o=t.globeMatrix;if(i.z<=1){const t=Bd(i).getCorners();return Nd(t,o,n),Ad.fromPoints(t)}const s=Gd(i,r),a=jd(s);Nd(a,o,n);const l=Number.MAX_VALUE,c=[-l,-l,-l],u=[l,l,l];if(s.contains(t.center)){for(const t of a)nd.min(u,u,t),nd.max(c,c,t);c[2]=0;const e=t.point,i=[e.x*n,e.y*n,0];return nd.min(u,u,i),nd.max(c,c,i),new Ad(u,c)}const h=[o[12]*n,o[13]*n,o[14]*n],d=s.getCenter(),p=R(t.center.lat,-Tp,Tp),f=R(d.lat,-Tp,Tp),m=_p(t.center.lng),g=yp(p);let _=m-_p(d.lng);const y=g-yp(f);_>.5?_-=1:_<-.5&&(_+=1);let v=0;if(Math.abs(_)>Math.abs(y))v=_>=0?1:3;else{v=y>=0?0:2;const t=[o[4]*n,o[5]*n,o[6]*n],e=-Math.sin(T(y>=0?s.getSouth():s.getNorth()))*Md;nd.scaleAndAdd(h,h,t,e)}const x=a[v],b=a[(v+1)%4],w=new Ld(x,b,h),E=[kd(w,0)||x[0],kd(w,1)||x[1],kd(w,2)||x[2]],S=tp(t.zoom);if(S>0){const r=function({x:t,y:e,z:i},r,n,o,s){const a=1/(1<<i);let l=t*a,c=l+a,u=e*a,h=u+a,d=0;const p=(l+c)/2-o;return p>.5?d=-1:p<-.5&&(d=1),l=((l+d)*r-(o*=r))*n+o,c=((c+d)*r-o)*n+o,u=(u*r-(s*=r))*n+s,h=(h*r-s)*n+s,[[l,h,0],[c,h,0],[c,u,0],[l,u,0]]}(i,e,t._pixelsPerMercatorPixel,m,g);for(let t=0;t<a.length;t++)Fd(a[t],r[t],S);const n=nd.add([],r[v],r[(v+1)%4]);nd.scale(n,n,.5),Fd(E,n,S)}for(const t of a)nd.min(u,u,t),nd.max(c,c,t);return u[2]=Math.min(x[2],b[2]),nd.min(u,u,E),nd.max(c,c,E),new Ad(u,c)}function Gd({x:t,y:e,z:i},r=!1){const n=1/(1<<i),o=new mp(xp(t*n),e===(1<<i)-1&&r?-90:bp((e+1)*n)),s=new mp(xp((t+1)*n),0===e&&r?90:bp(e*n));return new Nc(o,s)}function jd(t){const e=T(t.getNorth()),i=T(t.getSouth()),r=Math.cos(e),n=Math.cos(i),o=Math.sin(e),s=Math.sin(i),a=t.getWest(),l=t.getEast();return[Vd(n,s,a),Vd(n,s,l),Vd(r,o,l),Vd(r,o,a)]}function Vd(t,e,i,r=Md){return i=T(i),[t*Math.sin(i)*r,-e*r,t*Math.cos(i)*r]}function Xd(t,e,i){return Vd(Math.cos(T(t)),Math.sin(T(t)),e,i)}function Hd(t,e,i,r){const n=1<<i.z,o=(t/ur+i.x)/n;return Xd(bp((e/ur+i.y)/n),xp(o),r)}function qd({min:t,max:e}){return 16383/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Wd=new Float64Array(16);function $d(t){const e=qd(t),i=Jh.fromScaling(Wd,[e,e,e]);return Jh.translate(i,i,nd.negate([],t.min))}function Yd(t){const e=Jh.fromTranslation(Wd,t.min),i=1/qd(t);return Jh.scale(e,e,[i,i,i])}function Zd(t){const e=ur/(2*Math.PI);return t/(2*Math.PI)/e}function Kd(t,e){return ur/(512*Math.pow(2,t))*qd(Bd(e))}function Jd(t,e,i,r,n){const o=Zd(i),s=[t,e,-i/(2*Math.PI)],a=Jh.identity(new Float64Array(16));return Jh.translate(a,a,s),Jh.scale(a,a,[o,o,o]),Jh.rotateX(a,a,T(-n)),Jh.rotateY(a,a,T(-r)),a}function Qd(t){const e=t.pixelsPerMeter,i=e/vp(1,t.center.lat),r=Jh.identity(new Float64Array(16));return Jh.translate(r,r,[t.point.x,t.point.y,0]),Jh.scale(r,r,[i,i,e]),Float32Array.from(r)}function tp(t){return O(5,6,t)}function ep(t,e,i){const r=Jh.identity(new Float64Array(16)),n=(e/(1<<t)-.5)*Math.PI*2;return Jh.rotateY(r,i.globeMatrix,n),Float32Array.from(r)}function ip(t,e,i){const r=tp(i.zoom),n=t.style.map._antialias,o=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return 0===r&&!n&&!o}function rp(t,e,i,r){const n=e.getNorth(),o=e.getSouth(),s=e.getWest(),a=e.getEast(),l=1<<t.z,c=a-s,u=n-o,h=c/64,d=-u/Id[i],p=[0,h,0,d,0,0,n,s,0];if(t.z>0){const t=180/r;Zh.multiply(p,p,[t/c+1,0,0,0,t/u+1,0,-.5*t/h,.5*t/d,1])}return p[2]=l,p[5]=t.x,p[8]=t.y,p}function np(t){const e=Tp-5;t=R(t,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(T(t))),3);return Math.round(i*(Id.length-1))}function op(t){const e=[0,0,0],i=Jh.identity(new Float64Array(16));return Jh.multiply(i,t.pixelMatrix,t.globeMatrix),nd.transformMat4(e,e,i),new v(e[0],e[1])}function sp(t,e){const i=Xd(e.lat,e.lng),r=function(t){const e=Xd(t._center.lat,t._center.lng),i=nd.fromValues(0,1,0);let r=nd.cross([],i,e);const n=Jh.fromRotation([],-t.angle,e);r=nd.transformMat4(r,r,n),Jh.fromRotation(n,-t._pitch,r);const o=nd.normalize([],e);return nd.scale(o,o,Od(t.cameraToCenterDistance/t.pixelsPerMeter)),nd.transformMat4(o,o,n),nd.add([],e,o)}(t),n=nd.subtract([],r,i);return nd.angle(n,i)}function ap(t,e){return sp(t,e)>Math.PI/2*1.01}const lp=T(85),cp=Math.cos(lp),up=Math.sin(lp);class hp{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){const i=new ul,r=new Ml,n=[],o=t+1+2,s=e[0]+1,a=e[0]+1+(1+e.length),l=(t,e,i)=>{let r=t===o-1?t-2:0===t?t:t-1;return r+=i?24575:0,[r,e]};for(let t=0;t<o;++t)i.emplaceBack(...l(t,0,!0));for(let t=0;t<s;++t)for(let e=0;e<o;++e)i.emplaceBack(...l(e,t,(0===e||e===o-1)&&!0));for(let t=0;t<e.length;++t){const r=e[t];for(let t=0;t<o;++t)i.emplaceBack(...l(t,r,!0))}for(let t=0;t<e.length;++t){const s=r.length,l=e[t]+1+2,c=new Ml;for(let i=0;i<l-1;i++){const n=i===l-2,s=n?o*(a-e.length+t-i):o;for(let t=0;t<o-1;t++){const e=i*o+t;0===i||n||0===t||t===o-2?(c.emplaceBack(e+1,e,e+s),c.emplaceBack(e+s,e+s+1,e+1)):(r.emplaceBack(e+1,e,e+s),r.emplaceBack(e+s,e+s+1,e+1))}}const u=Ql.simpleSegment(0,s,i.length,r.length-s);for(let t=0;t<c.uint16.length;t+=3)r.emplaceBack(c.uint16[t],c.uint16[t+1],c.uint16[t+2]);const h=Ql.simpleSegment(0,s,i.length,r.length-s);n.push({withoutSkirts:u,withSkirts:h})}return{vertices:i,indices:r,segments:n}}_createGrid(t){const e=this._fillGridMeshWithLods(64,Id);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,hd.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new Ml;for(let t=0;t<=64;t++)e.emplaceBack(0,t+1,t+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const i=new Rl,r=new Rl,n=new Rl,o=new Rl;this._poleSegments=[];for(let t=0,e=0;t<5;t++){const s=360/(1<<t);i.emplaceBack(0,-Md,0,.5,0),r.emplaceBack(0,-Md,0,.5,1),n.emplaceBack(0,-Md,0,.5,.5),o.emplaceBack(0,-Md,0,.5,.5);for(let t=0;t<=64;t++){let e=t/64,a=0;const l=Yr(0,s,e),[c,u,h]=Vd(cp,up,l,Md);i.emplaceBack(c,u,h,e,a),r.emplaceBack(c,u,h,e,1-a);const d=T(l);e=.5+.5*Math.sin(d),a=.5+.5*Math.cos(d),n.emplaceBack(c,u,h,e,a),o.emplaceBack(c,u,h,e,1-a)}this._poleSegments.push(Ql.simpleSegment(e,0,66,64)),e+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,cd,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(r,cd,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(n,cd,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(o,cd,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}}const dp=6371008.8,pp=2*Math.PI*dp;class fp{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new fp(D(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const e=Math.PI/180,i=this.lat*e,r=t.lat*e,n=Math.sin(i)*Math.sin(r)+Math.cos(i)*Math.cos(r)*Math.cos((t.lng-this.lng)*e);return dp*Math.acos(Math.min(n,1))}toBounds(t=0){const e=360*t/40075017,i=e/Math.cos(Math.PI/180*this.lat);return new Nc(new fp(this.lng-i,this.lat-e),new fp(this.lng+i,this.lat+e))}toEcef(t){const e=Od(t);return Xd(this.lat,this.lng,Md+e)}static convert(t){if(t instanceof fp)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new fp(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new fp(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var mp=fp;function gp(t){return pp*Math.cos(t*Math.PI/180)}function _p(t){return(180+t)/360}function yp(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function vp(t,e){return t/gp(e)}function xp(t){return 360*t-180}function bp(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function wp(t,e){return t*gp(bp(e))}const Tp=85.051129;function Ep(t){return Math.cos(T(R(t,-Tp,Tp)))}function Sp(t,e){const i=R(e,0,25.5),r=Math.pow(2,i);return Ep(t)*pp/(512*r)}function Ap(t){return 1/Math.cos(t*Math.PI/180)}function Mp(t,e=0){const i=Math.exp(Math.PI*(1-(t.y+e/ur)/(1<<t.z)*2));return 80150034*i/(i*i+1)/ur/(1<<t.z)}class Ip{constructor(t,e,i=0){this.x=+t,this.y=+e,this.z=+i}static fromLngLat(t,e=0){const i=mp.convert(t);return new Ip(_p(i.lng),yp(i.lat),vp(e,i.lat))}toLngLat(){return new mp(xp(this.x),bp(this.y))}toAltitude(){return wp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/pp*Ap(bp(this.y))}}function Cp(t,e,i,r,n,o,s,a,l){const c=(e+r)/2,u=(i+n)/2,h=new v(c,u);a(h),function(t,e,i,r,n,o){const s=i-n,a=r-o;return Math.abs((r-e)*s-(i-t)*a)/Math.hypot(s,a)}(h.x,h.y,o.x,o.y,s.x,s.y)>=l?(Cp(t,e,i,c,u,o,h,a,l),Cp(t,c,u,r,n,h,s,a,l)):t.push(s)}function Pp(t,e,i){let r=t[0],n=r.x,o=r.y;e(r);const s=[r];for(let a=1;a<t.length;a++){const l=t[a],{x:c,y:u}=l;e(l),Cp(s,n,o,c,u,r,l,e,i),n=c,o=u,r=l}return s}function Rp(t,e,i,r){if(r(e,i)){const n=e.add(i)._mult(.5);Rp(t,e,n,r),Rp(t,n,i,r)}else t.push(i)}function Op(t,e){let i=t[0];const r=[i];for(let n=1;n<t.length;n++){const o=t[n];Rp(r,i,o,e),i=o}return r}const Dp=Math.pow(2,14)-1,Lp=-Dp-1;function kp(t,e){const i=Math.round(t.x*e),r=Math.round(t.y*e);return t.x=R(i,Lp,Dp),t.y=R(r,Lp,Dp),(i<t.x||i>t.x+1||r<t.y||r>t.y+1)&&Y("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Bp(t,e,i){const r=t.loadGeometry(),n=t.extent,o=ur/n;if(e&&i&&i.projection.isReprojectedInTileSpace){const o=1<<e.z,{scale:s,x:a,y:l,projection:c}=i,u=t=>{const i=xp((e.x+t.x/n)/o),r=bp((e.y+t.y/n)/o),u=c.project(i,r);t.x=(u.x*s-a)*n,t.y=(u.y*s-l)*n};for(let e=0;e<r.length;e++)if(1!==t.type)r[e]=Pp(r[e],u,1);else{const t=[];for(const i of r[e])i.x<0||i.x>=n||i.y<0||i.y>=n||(u(i),t.push(i));r[e]=t}}for(const t of r)for(const e of t)kp(e,o);return r}function Fp(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Bp(t):[]}}function zp(t,e,i,r,n){t.emplaceBack(2*e+(r+1)/2,2*i+(n+1)/2)}function Np(t,e,i){const r=16384;t.emplaceBack(e.x,e.y,e.z,i[0]*r,i[1]*r,i[2]*r)}class Up{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new ul,this.indexArray=new Ml,this.segments=new Ql,this.programConfigurations=new Dc(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,i,r){const n=this.layers[0],o=[];let s=null;"circle"===n.type&&(s=n.layout.get("circle-sort-key"));for(const{feature:e,id:n,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,c=Fp(e,t);if(!this.layers[0]._featureFilter.filter(new Ua(this.zoom),c,i))continue;const u=s?s.evaluate(c,{},i):void 0,h={id:n,properties:e.properties,type:e.type,sourceLayerIndex:l,index:a,geometry:t?c.geometry:Bp(e,i,r),patterns:{},sortKey:u};o.push(h)}s&&o.sort((t,e)=>t.sortKey-e.sortKey);let a=null;"globe"===r.projection.name&&(this.globeExtVertexArray=new yl,a=r.projection);for(const r of o){const{geometry:n,index:o,sourceLayerIndex:s}=r,l=t[o].feature;this.addFeature(r,n,o,e.availableImages,i,a,e.brightness),e.featureIndex.insert(l,n,o,s,this.index)}}update(t,e,i,r,n){const o=0!==Object.keys(t).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,e,o?this.stateDependentLayers:this.layers,i,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Kl.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Jl.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,e,i,r,n,o,s){for(const i of e)for(const e of i){const i=e.x,r=e.y;if(i<0||i>=ur||r<0||r>=ur)continue;if(o){const t=o.projectTilePoint(i,r,n),e=o.upVector(n,i,r),s=this.globeExtVertexArray;Np(s,t,e),Np(s,t,e),Np(s,t,e),Np(s,t,e)}const s=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),a=s.vertexLength;zp(this.layoutVertexArray,i,r,-1,-1),zp(this.layoutVertexArray,i,r,1,-1),zp(this.layoutVertexArray,i,r,1,1),zp(this.layoutVertexArray,i,r,-1,1),this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+2,a+3),s.vertexLength+=4,s.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,{},r,n,s)}}function Gp(t,e){for(let i=0;i<t.length;i++)if(Zp(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Zp(t,e[i]))return!0;return!!Hp(t,e)}function jp(t,e,i){return!!Zp(t,e)||!!Wp(e,t,i)}function Vp(t,e){if(1===t.length)return Yp(e,t[0]);for(let i=0;i<e.length;i++){const r=e[i];for(let e=0;e<r.length;e++)if(Zp(t,r[e]))return!0}for(let i=0;i<t.length;i++)if(Yp(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Hp(t,e[i]))return!0;return!1}function Xp(t,e,i){if(t.length>1){if(Hp(t,e))return!0;for(let r=0;r<e.length;r++)if(Wp(e[r],t,i))return!0}for(let r=0;r<t.length;r++)if(Wp(t[r],e,i))return!0;return!1}function Hp(t,e){if(0===t.length||0===e.length)return!1;for(let i=0;i<t.length-1;i++){const r=t[i],n=t[i+1];for(let t=0;t<e.length-1;t++)if(qp(r,n,e[t],e[t+1]))return!0}return!1}function qp(t,e,i,r){return Z(t,i,r)!==Z(e,i,r)&&Z(t,e,i)!==Z(t,e,r)}function Wp(t,e,i){const r=i*i;if(1===e.length)return t.distSqr(e[0])<r;for(let i=1;i<e.length;i++)if($p(t,e[i-1],e[i])<r)return!0;return!1}function $p(t,e,i){const r=e.distSqr(i);if(0===r)return t.distSqr(e);const n=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/r;return t.distSqr(n<0?e:n>1?i:i.sub(e)._mult(n)._add(e))}function Yp(t,e){let i,r,n,o=!1;for(let s=0;s<t.length;s++){i=t[s];for(let t=0,s=i.length-1;t<i.length;s=t++)r=i[t],n=i[s],r.y>e.y!=n.y>e.y&&e.x<(n.x-r.x)*(e.y-r.y)/(n.y-r.y)+r.x&&(o=!o)}return o}function Zp(t,e){let i=!1;for(let r=0,n=t.length-1;r<t.length;n=r++){const o=t[r],s=t[n];o.y>e.y!=s.y>e.y&&e.x<(s.x-o.x)*(e.y-o.y)/(s.y-o.y)+o.x&&(i=!i)}return i}function Kp(t,e,i,r,n){for(const o of t)if(e<=o.x&&i<=o.y&&r>=o.x&&n>=o.y)return!0;const o=[new v(e,i),new v(e,n),new v(r,n),new v(r,i)];if(t.length>2)for(const e of o)if(Zp(t,e))return!0;for(let e=0;e<t.length-1;e++)if(Jp(t[e],t[e+1],o))return!0;return!1}function Jp(t,e,i){const r=i[0],n=i[2];if(t.x<r.x&&e.x<r.x||t.x>n.x&&e.x>n.x||t.y<r.y&&e.y<r.y||t.y>n.y&&e.y>n.y)return!1;const o=Z(t,e,i[0]);return o!==Z(t,e,i[1])||o!==Z(t,e,i[2])||o!==Z(t,e,i[3])}function Qp(t,e,i,r,n,o){let s=e.y-t.y,a=t.x-e.x;if(o=o||0){const t=s*s+a*a;if(0===t)return!0;const e=Math.sqrt(t);s/=e,a/=e}return!((i.x-t.x)*s+(i.y-t.y)*a-o<0||(r.x-t.x)*s+(r.y-t.y)*a-o<0||(n.x-t.x)*s+(n.y-t.y)*a-o<0)}function tf(t,e,i,r,n,o,s){return!(Qp(t,e,r,n,o,s)||Qp(e,i,r,n,o,s)||Qp(i,t,r,n,o,s)||Qp(r,n,t,e,i,s)||Qp(n,o,t,e,i,s)||Qp(o,r,t,e,i,s))}function ef(t,e,i){const r=e.paint.get(t).value;return"constant"===r.kind?r.value:i.programConfigurations.get(e.id).getMaxValue(t)}function rf(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function nf(t,e,i,r,n){if(!e[0]&&!e[1])return t;const o=v.convert(e)._mult(n);"viewport"===i&&o._rotate(-r);const s=[];for(let e=0;e<t.length;e++)s.push(t[e].sub(o));return s}function of(t,e,i,r){const n=v.convert(t)._mult(r);return"viewport"===e&&n._rotate(-i),n}xs(Up,"CircleBucket",{omit:["layers"]});const sf=new Ja({"circle-sort-key":new Za(Oe.layout_circle["circle-sort-key"]),visibility:new Ya(Oe.layout_circle.visibility)});var af={paint:new Ja({"circle-radius":new Za(Oe.paint_circle["circle-radius"]),"circle-color":new Za(Oe.paint_circle["circle-color"]),"circle-blur":new Za(Oe.paint_circle["circle-blur"]),"circle-opacity":new Za(Oe.paint_circle["circle-opacity"]),"circle-translate":new Ya(Oe.paint_circle["circle-translate"]),"circle-translate-anchor":new Ya(Oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ya(Oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ya(Oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Za(Oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Za(Oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Za(Oe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Ya(Oe.paint_circle["circle-emissive-strength"])}),layout:sf};const lf=Jh.create(),cf=(t,e,i,r,n,o)=>{const s=t.transform,a="globe"===s.projection.name;let l;if("map"===o.paint.get("circle-pitch-alignment"))if(a){const t=Kd(s.zoom,e.canonical)*s._pixelsPerMercatorPixel;l=Float32Array.from([t,0,0,t])}else l=s.calculatePixelsToTileUnitsMatrix(i);else l=new Float32Array([s.pixelsToGLUnits[0],0,0,s.pixelsToGLUnits[1]]);const c={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(s.projection),u_matrix:t.translatePosMatrix(e.projMatrix,i,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_device_pixel_ratio:pe.devicePixelRatio,u_extrude_scale:l,u_inv_rot_matrix:lf,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:o.paint.get("circle-emissive-strength")};if(a){c.u_inv_rot_matrix=r,c.u_merc_center=n,c.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],c.u_zoom_transition=tp(s.zoom);const t=n[0]*ur,i=n[1]*ur;c.u_up_dir=s.projection.upVector(new fd(0,0,0),t,i)}return c},uf=t=>{const e=[];return"map"===t.paint.get("circle-pitch-alignment")&&e.push("PITCH_WITH_MAP"),"map"===t.paint.get("circle-pitch-scale")&&e.push("SCALE_WITH_MAP"),e};function hf(t,e,i,r,n,o,s,a,l){if(o&&t.queryGeometry.isAboveHorizon)return!1;o&&(l*=t.pixelToTileUnitsFactor);const c=t.tileID.canonical,u=i.projection.upVectorScale(c,i.center.lat,i.worldSize).metersToTile;for(const h of e)for(const e of h){const h=e.add(a),d=n&&i.elevation?i.elevation.exaggeration()*n.getElevationAt(h.x,h.y,!0):0,p=i.projection.projectTilePoint(h.x,h.y,c);if(d>0){const t=i.projection.upVector(c,h.x,h.y);p.x+=t[0]*u*d,p.y+=t[1]*u*d,p.z+=t[2]*u*d}const f=o?h:df(p.x,p.y,p.z,r),m=o?t.tilespaceRays.map(t=>mf(t,d)):t.queryGeometry.screenGeometry,g=Xh.transformMat4([],[p.x,p.y,p.z,1],r);if(!s&&o?l*=g[3]/i.cameraToCenterDistance:s&&!o&&(l*=i.cameraToCenterDistance/g[3]),o){const t=bp((e.y/ur+c.y)/(1<<c.z));l/=i.projection.pixelsPerMeter(t,1)/vp(1,t)}if(jp(m,f,l))return!0}return!1}function df(t,e,i,r){const n=Xh.transformMat4([],[t,e,i,1],r);return new v(n[0]/n[3],n[1]/n[3])}const pf=nd.fromValues(0,0,0),ff=nd.fromValues(0,0,1);function mf(t,e){const i=nd.create();return pf[2]=e,t.intersectsPlane(pf,ff,i),new v(i[0],i[1])}class gf extends Up{}function _f(t,{width:e,height:i},r,n){if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==e*i*r)throw new RangeError("mismatched image size")}else n=new Uint8Array(e*i*r);return t.width=e,t.height=i,t.data=n,t}function yf(t,e,i){const{width:r,height:n}=e;r===t.width&&n===t.height||(vf(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,r),height:Math.min(t.height,n)},i),t.width=r,t.height=n,t.data=e.data)}function vf(t,e,i,r,n,o){if(0===n.width||0===n.height)return e;if(n.width>t.width||n.height>t.height||i.x>t.width-n.width||i.y>t.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>e.width||n.height>e.height||r.x>e.width-n.width||r.y>e.height-n.height)throw new RangeError("out of range destination coordinates for image copy");const s=t.data,a=e.data;for(let l=0;l<n.height;l++){const c=((i.y+l)*t.width+i.x)*o,u=((r.y+l)*e.width+r.x)*o;for(let t=0;t<n.width*o;t++)a[u+t]=s[c+t]}return e}xs(gf,"HeatmapBucket",{omit:["layers"]});class xf{constructor(t,e){_f(this,t,1,e)}resize(t){yf(this,new xf(t),1)}clone(){return new xf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,r,n){vf(t,e,i,r,n,1)}}class bf{constructor(t,e){_f(this,t,4,e)}resize(t){yf(this,new bf(t),4)}replace(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new bf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,r,n){vf(t,e,i,r,n,4)}}class wf{constructor(t,e){this.width=t.width,this.height=t.height,this.data=e instanceof Uint8Array?new Float32Array(e.buffer):e}}xs(xf,"AlphaImage"),xs(bf,"RGBAImage");const Tf=new Ja({visibility:new Ya(Oe.layout_heatmap.visibility)});var Ef={paint:new Ja({"heatmap-radius":new Za(Oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Za(Oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ya(Oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ka(Oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ya(Oe.paint_heatmap["heatmap-opacity"])}),layout:Tf};function Sf(t){const e={},i=t.resolution||256,r=t.clips?t.clips.length:1,n=t.image||new bf({width:i,height:r}),o=(i,r,o)=>{e[t.evaluationKey]=o;const s=t.expression.evaluate(e);s&&(n.data[i+r+0]=Math.floor(255*s.r/s.a),n.data[i+r+1]=Math.floor(255*s.g/s.a),n.data[i+r+2]=Math.floor(255*s.b/s.a),n.data[i+r+3]=Math.floor(255*s.a))};if(t.clips)for(let e=0,n=0;e<r;++e,n+=4*i)for(let r=0,s=0;r<i;r++,s+=4){const a=r/(i-1),{start:l,end:c}=t.clips[e];o(n,s,l*(1-a)+c*a)}else for(let t=0,e=0;t<i;t++,e+=4)o(0,e,t/(i-1));return n}const Af=new Ja({visibility:new Ya(Oe.layout_hillshade.visibility)});var Mf={paint:new Ja({"hillshade-illumination-direction":new Ya(Oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ya(Oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ya(Oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ya(Oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ya(Oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ya(Oe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Ya(Oe.paint_hillshade["hillshade-emissive-strength"])}),layout:Af};const If=ll([{name:"a_pos",components:2,type:"Int16"}],4),{members:Cf}=If;var Pf={exports:{}};function Rf(t,e,i){i=i||2;var r,n,o,s,a,l,c,u=e&&e.length,h=u?e[0]*i:t.length,d=Of(t,0,h,i,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(t,e,i,r){var n,o,s,a=[];for(n=0,o=e.length;n<o;n++)(s=Of(t,e[n]*r,n<o-1?e[n+1]*r:t.length,r,!1))===s.next&&(s.steiner=!0),a.push(Vf(s));for(a.sort(Nf),n=0;n<a.length;n++)i=Uf(a[n],i);return i}(t,e,d,i)),t.length>80*i){r=o=t[0],n=s=t[1];for(var f=i;f<h;f+=i)(a=t[f])<r&&(r=a),(l=t[f+1])<n&&(n=l),a>o&&(o=a),l>s&&(s=l);c=0!==(c=Math.max(o-r,s-n))?32767/c:0}return Lf(d,p,i,r,n,c,0),p}function Of(t,e,i,r,n){var o,s;if(n===im(t,e,i,r)>0)for(o=e;o<i;o+=r)s=Qf(o,t[o],t[o+1],s);else for(o=i-r;o>=e;o-=r)s=Qf(o,t[o],t[o+1],s);return s&&Wf(s,s.next)&&(tm(s),s=s.next),s}function Df(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!Wf(r,r.next)&&0!==qf(r.prev,r,r.next))r=r.next;else{if(tm(r),(r=e=r.prev)===r.next)break;i=!0}}while(i||r!==e);return e}function Lf(t,e,i,r,n,o,s){if(t){!s&&o&&function(t,e,i,r){var n=t;do{0===n.z&&(n.z=jf(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,i,r,n,o,s,a,l,c=1;do{for(i=t,t=null,o=null,s=0;i;){for(s++,r=i,a=0,e=0;e<c&&(a++,r=r.nextZ);e++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,l--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;i=r}o.nextZ=null,c*=2}while(s>1)}(n)}(t,r,n,o);for(var a,l,c=t;t.prev!==t.next;)if(a=t.prev,l=t.next,o?Bf(t,r,n,o):kf(t))e.push(a.i/i|0),e.push(t.i/i|0),e.push(l.i/i|0),tm(t),t=l.next,c=l.next;else if((t=l)===c){s?1===s?Lf(t=Ff(Df(t),e,i),e,i,r,n,o,2):2===s&&zf(t,e,i,r,n,o):Lf(Df(t),e,i,r,n,o,1);break}}}function kf(t){var e=t.prev,i=t,r=t.next;if(qf(e,i,r)>=0)return!1;for(var n=e.x,o=i.x,s=r.x,a=e.y,l=i.y,c=r.y,u=n<o?n<s?n:s:o<s?o:s,h=a<l?a<c?a:c:l<c?l:c,d=n>o?n>s?n:s:o>s?o:s,p=a>l?a>c?a:c:l>c?l:c,f=r.next;f!==e;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&Xf(n,a,o,l,s,c,f.x,f.y)&&qf(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Bf(t,e,i,r){var n=t.prev,o=t,s=t.next;if(qf(n,o,s)>=0)return!1;for(var a=n.x,l=o.x,c=s.x,u=n.y,h=o.y,d=s.y,p=a<l?a<c?a:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,m=a>l?a>c?a:c:l>c?l:c,g=u>h?u>d?u:d:h>d?h:d,_=jf(p,f,e,i,r),y=jf(m,g,e,i,r),v=t.prevZ,x=t.nextZ;v&&v.z>=_&&x&&x.z<=y;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==n&&v!==s&&Xf(a,u,l,h,c,d,v.x,v.y)&&qf(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==n&&x!==s&&Xf(a,u,l,h,c,d,x.x,x.y)&&qf(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;v&&v.z>=_;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==n&&v!==s&&Xf(a,u,l,h,c,d,v.x,v.y)&&qf(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;x&&x.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==n&&x!==s&&Xf(a,u,l,h,c,d,x.x,x.y)&&qf(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Ff(t,e,i){var r=t;do{var n=r.prev,o=r.next.next;!Wf(n,o)&&$f(n,r,r.next,o)&&Kf(n,o)&&Kf(o,n)&&(e.push(n.i/i|0),e.push(r.i/i|0),e.push(o.i/i|0),tm(r),tm(r.next),r=t=o),r=r.next}while(r!==t);return Df(r)}function zf(t,e,i,r,n,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&Hf(s,a)){var l=Jf(s,a);return s=Df(s,s.next),l=Df(l,l.next),Lf(s,e,i,r,n,o,0),void Lf(l,e,i,r,n,o,0)}a=a.next}s=s.next}while(s!==t)}function Nf(t,e){return t.x-e.x}function Uf(t,e){var i=function(t,e){var i,r=e,n=t.x,o=t.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>s&&(s=a,i=r.x<r.next.x?r:r.next,a===n))return i}r=r.next}while(r!==e);if(!i)return null;var l,c=i,u=i.x,h=i.y,d=1/0;r=i;do{n>=r.x&&r.x>=u&&n!==r.x&&Xf(o<h?n:s,o,u,h,o<h?s:n,o,r.x,r.y)&&(l=Math.abs(o-r.y)/(n-r.x),Kf(r,t)&&(l<d||l===d&&(r.x>i.x||r.x===i.x&&Gf(i,r)))&&(i=r,d=l)),r=r.next}while(r!==c);return i}(t,e);if(!i)return e;var r=Jf(i,t);return Df(r,r.next),Df(i,i.next)}function Gf(t,e){return qf(t.prev,t,e.prev)<0&&qf(e.next,t,t.next)<0}function jf(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Vf(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function Xf(t,e,i,r,n,o,s,a){return(n-s)*(e-a)>=(t-s)*(o-a)&&(t-s)*(r-a)>=(i-s)*(e-a)&&(i-s)*(o-a)>=(n-s)*(r-a)}function Hf(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&$f(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(Kf(t,e)&&Kf(e,t)&&function(t,e){var i=t,r=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}(t,e)&&(qf(t.prev,t,e.prev)||qf(t,e.prev,e))||Wf(t,e)&&qf(t.prev,t,t.next)>0&&qf(e.prev,e,e.next)>0)}function qf(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Wf(t,e){return t.x===e.x&&t.y===e.y}function $f(t,e,i,r){var n=Zf(qf(t,e,i)),o=Zf(qf(t,e,r)),s=Zf(qf(i,r,t)),a=Zf(qf(i,r,e));return n!==o&&s!==a||!(0!==n||!Yf(t,i,e))||!(0!==o||!Yf(t,r,e))||!(0!==s||!Yf(i,t,r))||!(0!==a||!Yf(i,e,r))}function Yf(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Zf(t){return t>0?1:t<0?-1:0}function Kf(t,e){return qf(t.prev,t,t.next)<0?qf(t,e,t.next)>=0&&qf(t,t.prev,e)>=0:qf(t,e,t.prev)<0||qf(t,t.next,e)<0}function Jf(t,e){var i=new em(t.i,t.x,t.y),r=new em(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function Qf(t,e,i,r){var n=new em(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function tm(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function em(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function im(t,e,i,r){for(var n=0,o=e,s=i-r;o<i;o+=r)n+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return n}Pf.exports=Rf,Pf.exports.default=Rf,Rf.deviation=function(t,e,i,r){var n=e&&e.length,o=Math.abs(im(t,0,n?e[0]*i:t.length,i));if(n)for(var s=0,a=e.length;s<a;s++)o-=Math.abs(im(t,e[s]*i,s<a-1?e[s+1]*i:t.length,i));var l=0;for(s=0;s<r.length;s+=3){var c=r[s]*i,u=r[s+1]*i,h=r[s+2]*i;l+=Math.abs((t[c]-t[h])*(t[u+1]-t[c+1])-(t[c]-t[u])*(t[h+1]-t[c+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},Rf.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,n=0;n<t.length;n++){for(var o=0;o<t[n].length;o++)for(var s=0;s<e;s++)i.vertices.push(t[n][o][s]);n>0&&i.holes.push(r+=t[n-1].length)}return i};var rm=p(Pf.exports);function nm(t,e){const i=t.length;if(i<=1)return[t];const r=[];let n,o;for(let e=0;e<i;e++){const i=K(t[e]);0!==i&&(t[e].area=Math.abs(i),void 0===o&&(o=i<0),o===i<0?(n&&r.push(n),n=[t[e]]):n.push(t[e]))}if(n&&r.push(n),e>1)for(let t=0;t<r.length;t++)r[t].length<=e||(Ni(r[t],e,1,r[t].length-1,om),r[t]=r[t].slice(0,e));return r}function om(t,e){return e.area-t.area}function sm(t,e,i){const r=i.patternDependencies;let n=!1;for(const i of e){const e=i.paint.get(t+"-pattern");e.isConstant()||(n=!0);const o=e.constantOr(null);o&&(n=!0,r[o]=!0)}return n}function am(t,e,i,r,n){const o=n.patternDependencies;for(const s of e){const e=s.paint.get(t+"-pattern").value;if("constant"!==e.kind){let t=e.evaluate({zoom:r},i,{},n.availableImages);t=t&&t.name?t.name:t,o[t]=!0,i.patterns[s.id]=t}}return i}class lm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ul,this.indexArray=new Ml,this.indexArray2=new wl,this.programConfigurations=new Dc(t.layers,t.zoom),this.segments=new Ql,this.segments2=new Ql,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.projection=t.projection}populate(t,e,i,r){this.hasPattern=sm("fill",this.layers,e);const n=this.layers[0].layout.get("fill-sort-key"),o=[];for(const{feature:s,id:a,index:l,sourceLayerIndex:c}of t){const t=this.layers[0]._featureFilter.needGeometry,u=Fp(s,t);if(!this.layers[0]._featureFilter.filter(new Ua(this.zoom),u,i))continue;const h=n?n.evaluate(u,{},i,e.availableImages):void 0,d={id:a,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:t?u.geometry:Bp(s,i,r),patterns:{},sortKey:h};o.push(d)}n&&o.sort((t,e)=>t.sortKey-e.sortKey);for(const r of o){const{geometry:n,index:o,sourceLayerIndex:s}=r;if(this.hasPattern){const t=am("fill",this.layers,r,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(r,n,o,i,{},e.availableImages,e.brightness);e.featureIndex.insert(t[o].feature,n,o,s,this.index)}}update(t,e,i,r,n){const o=0!==Object.keys(t).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,e,o?this.stateDependentLayers:this.layers,i,r,n)}addFeatures(t,e,i,r,n,o){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,i,r,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Cf),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,e,i,r,n,o=[],s){for(const t of nm(e,500)){let e=0;for(const i of t)e+=i.length;const i=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray),r=i.vertexLength,n=[],o=[];for(const e of t){if(0===e.length)continue;e!==t[0]&&o.push(n.length/2);const i=this.segments2.prepareSegment(e.length,this.layoutVertexArray,this.indexArray2),r=i.vertexLength;this.layoutVertexArray.emplaceBack(e[0].x,e[0].y),this.indexArray2.emplaceBack(r+e.length-1,r),n.push(e[0].x),n.push(e[0].y);for(let t=1;t<e.length;t++)this.layoutVertexArray.emplaceBack(e[t].x,e[t].y),this.indexArray2.emplaceBack(r+t-1,r+t),n.push(e[t].x),n.push(e[t].y);i.vertexLength+=e.length,i.primitiveLength+=e.length}const s=rm(n,o);for(let t=0;t<s.length;t+=3)this.indexArray.emplaceBack(r+s[t],r+s[t+1],r+s[t+2]);i.vertexLength+=e,i.primitiveLength+=s.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,n,o,r,s)}}xs(lm,"FillBucket",{omit:["layers","patternFeatures"]});const cm=new Ja({"fill-sort-key":new Za(Oe.layout_fill["fill-sort-key"]),visibility:new Ya(Oe.layout_fill.visibility)});var um={paint:new Ja({"fill-antialias":new Ya(Oe.paint_fill["fill-antialias"]),"fill-opacity":new Za(Oe.paint_fill["fill-opacity"]),"fill-color":new Za(Oe.paint_fill["fill-color"]),"fill-outline-color":new Za(Oe.paint_fill["fill-outline-color"]),"fill-translate":new Ya(Oe.paint_fill["fill-translate"]),"fill-translate-anchor":new Ya(Oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Za(Oe.paint_fill["fill-pattern"]),"fill-emissive-strength":new Ya(Oe.paint_fill["fill-emissive-strength"])}),layout:cm};const hm=ll([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),dm=ll([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),pm=ll([{name:"a_centroid_pos",components:2,type:"Uint16"}]),fm=ll([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),mm=ll([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:gm}=hm;var _m={},ym=_,vm=xm;function xm(t,e,i,r,n){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=n,t.readFields(bm,this,e)}function bm(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var r=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[r]=n}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function wm(t){for(var e,i,r=0,n=0,o=t.length,s=o-1;n<o;s=n++)r+=((i=t[s]).x-(e=t[n]).x)*(e.y+i.y);return r}xm.types=["Unknown","Point","LineString","Polygon"],xm.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,r=1,n=0,o=0,s=0,a=[];t.pos<i;){if(n<=0){var l=t.readVarint();r=7&l,n=l>>3}if(n--,1===r||2===r)o+=t.readSVarint(),s+=t.readSVarint(),1===r&&(e&&a.push(e),e=[]),e.push(new ym(o,s));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&a.push(e),a},xm.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,n=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;t.pos<e;){if(r<=0){var u=t.readVarint();i=7&u,r=u>>3}if(r--,1===i||2===i)(n+=t.readSVarint())<s&&(s=n),n>a&&(a=n),(o+=t.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==i)throw new Error("unknown command "+i)}return[s,l,a,c]},xm.prototype.toGeoJSON=function(t,e,i){var r,n,o=this.extent*Math.pow(2,i),s=this.extent*t,a=this.extent*e,l=this.loadGeometry(),c=xm.types[this.type];function u(t){for(var e=0;e<t.length;e++){var i=t[e];t[e]=[360*(i.x+s)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+a)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(r=0;r<l.length;r++)h[r]=l[r][0];u(l=h);break;case 2:for(r=0;r<l.length;r++)u(l[r]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var i,r,n=[],o=0;o<e;o++){var s=wm(t[o]);0!==s&&(void 0===r&&(r=s<0),r===s<0?(i&&n.push(i),i=[t[o]]):i.push(t[o]))}return i&&n.push(i),n}(l),r=0;r<l.length;r++)for(n=0;n<l[r].length;n++)u(l[r][n])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var Tm=vm,Em=Sm;function Sm(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Am,this,e),this.length=this._features.length}function Am(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}(i))}Sm.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Tm(this._pbf,e,this.extent,this._keys,this._values)};var Mm=Em;function Im(t,e,i){if(3===t){var r=new Mm(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r)}}var Cm=_m.VectorTile=function(t,e){this.layers=t.readFields(Im,{},e)},Pm=_m.VectorTileFeature=vm;function Rm(t,e,i,r){const n=[],o=0===r?(t,e,i,r,n,o)=>{t.push(new v(o,i+(o-e)/(r-e)*(n-i)))}:(t,e,i,r,n,o)=>{t.push(new v(e+(o-i)/(n-i)*(r-e),o))};for(const s of t){const t=[];for(const n of s){if(n.length<=2)continue;const s=[];for(let t=0;t<n.length-1;t++){const a=n[t].x,l=n[t].y,c=n[t+1].x,u=n[t+1].y,h=0===r?a:l,d=0===r?c:u;h<e?d>e&&o(s,a,l,c,u,e):h>i?d<i&&o(s,a,l,c,u,i):s.push(n[t]),d<e&&h>=e&&o(s,a,l,c,u,e),d>i&&h<=i&&o(s,a,l,c,u,i)}let a=n[n.length-1];const l=0===r?a.x:a.y;l>=e&&l<=i&&s.push(a),s.length&&(a=s[s.length-1],s[0].x===a.x&&s[0].y===a.y||s.push(s[0]),t.push(s))}t.length&&n.push(t)}return n}_m.VectorTileLayer=Em;class Om{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){const i=t[e];this._stringToNumber[i]=e,this._numberToString[e]=i}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}var Dm=km,Lm={read:function(t,e,i,r,n){var o,s,a=8*n-r-1,l=(1<<a)-1,c=l>>1,u=-7,h=i?n-1:0,d=i?-1:1,p=t[e+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+t[e+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=r;u>0;s=256*s+t[e+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),o-=c}return(p?-1:1)*s*Math.pow(2,o-r)},write:function(t,e,i,r,n,o){var s,a,l,c=8*o-n-1,u=(1<<c)-1,h=u>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,f=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=u):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(e*l-1)*Math.pow(2,n),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,n),s=0));n>=8;t[i+p]=255&a,p+=f,a/=256,n-=8);for(s=s<<n|a,c+=n;c>0;t[i+p]=255&s,p+=f,s/=256,c-=8);t[i+p-f]|=128*m}};function km(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}km.Varint=0,km.Fixed64=1,km.Bytes=2,km.Fixed32=5;var Bm=4294967296,Fm=1/Bm,zm="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Nm(t){return t.type===km.Bytes?t.readVarint()+t.pos:t.pos+1}function Um(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Gm(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=t;n--)i.buf[n+r]=i.buf[n]}function jm(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function Vm(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function Xm(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function Hm(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function qm(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function Wm(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function $m(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function Ym(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function Zm(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function Km(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Jm(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function Qm(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}km.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,o=this.pos;this.type=7&r,t(n,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Km(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Qm(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Km(this.buf,this.pos)+Km(this.buf,this.pos+4)*Bm;return this.pos+=8,t},readSFixed64:function(){var t=Km(this.buf,this.pos)+Qm(this.buf,this.pos+4)*Bm;return this.pos+=8,t},readFloat:function(){var t=Lm.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Lm.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,r=this.buf;return e=127&(i=r[this.pos++]),i<128?e:(e|=(127&(i=r[this.pos++]))<<7,i<128?e:(e|=(127&(i=r[this.pos++]))<<14,i<128?e:(e|=(127&(i=r[this.pos++]))<<21,i<128?e:function(t,e,i){var r,n,o=i.buf;if(r=(112&(n=o[i.pos++]))>>4,n<128)return Um(t,r,e);if(r|=(127&(n=o[i.pos++]))<<3,n<128)return Um(t,r,e);if(r|=(127&(n=o[i.pos++]))<<10,n<128)return Um(t,r,e);if(r|=(127&(n=o[i.pos++]))<<17,n<128)return Um(t,r,e);if(r|=(127&(n=o[i.pos++]))<<24,n<128)return Um(t,r,e);if(r|=(1&(n=o[i.pos++]))<<31,n<128)return Um(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&zm?function(t,e,i){return zm.decode(t.subarray(e,i))}(this.buf,e,t):function(t,e,i){for(var r="",n=e;n<i;){var o,s,a,l=t[n],c=null,u=l>239?4:l>223?3:l>191?2:1;if(n+u>i)break;1===u?l<128&&(c=l):2===u?128==(192&(o=t[n+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(s=t[n+2],128==(192&(o=t[n+1]))&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(s=t[n+2],a=t[n+3],128==(192&(o=t[n+1]))&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,r+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),r+=String.fromCharCode(c),n+=u}return r}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==km.Bytes)return t.push(this.readVarint(e));var i=Nm(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==km.Bytes)return t.push(this.readSVarint());var e=Nm(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==km.Bytes)return t.push(this.readBoolean());var e=Nm(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==km.Bytes)return t.push(this.readFloat());var e=Nm(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==km.Bytes)return t.push(this.readDouble());var e=Nm(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==km.Bytes)return t.push(this.readFixed32());var e=Nm(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==km.Bytes)return t.push(this.readSFixed32());var e=Nm(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==km.Bytes)return t.push(this.readFixed64());var e=Nm(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==km.Bytes)return t.push(this.readSFixed64());var e=Nm(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===km.Varint)for(;this.buf[this.pos++]>127;);else if(e===km.Bytes)this.pos=this.readVarint()+this.pos;else if(e===km.Fixed32)this.pos+=4;else{if(e!==km.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Jm(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Jm(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Jm(this.buf,-1&t,this.pos),Jm(this.buf,Math.floor(t*Fm),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Jm(this.buf,-1&t,this.pos),Jm(this.buf,Math.floor(t*Fm),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,r;if(t>=0?(i=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,i.buf[i.pos]=127&(t>>>=7)}(i,0,e),function(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var r,n,o=0;o<e.length;o++){if((r=e.charCodeAt(o))>55295&&r<57344){if(!n){r>56319||o+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):n=r;continue}if(r<56320){t[i++]=239,t[i++]=191,t[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(t[i++]=239,t[i++]=191,t[i++]=189,n=null);r<128?t[i++]=r:(r<2048?t[i++]=r>>6|192:(r<65536?t[i++]=r>>12|224:(t[i++]=r>>18|240,t[i++]=r>>12&63|128),t[i++]=r>>6&63|128),t[i++]=63&r|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&Gm(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),Lm.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Lm.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&Gm(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,km.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,jm,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Vm,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,qm,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Xm,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Hm,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Wm,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,$m,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Ym,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Zm,e)},writeBytesField:function(t,e){this.writeTag(t,km.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,km.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,km.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,km.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,km.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,km.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,km.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,km.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,km.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,km.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var tg=p(Dm);const eg=["tile","layer","source","sourceLayer","state"];class ig{constructor(t,e,i,r,n){this.type="Feature",this._vectorTileFeature=t,this._z=e,this._x=i,this._y=r,this.properties=t.properties,this.id=n}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(t.id=this.id);for(const e of eg)void 0!==this[e]&&(t[e]=this[e]);return t}}class rg{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,e,i){const r=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][r]=this.stateChanges[t][r]||{},B(this.stateChanges[t][r],i),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==r&&(this.deletedStates[t][e]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][r]){this.deletedStates[t][r]={};for(const e in this.state[t][r])i[e]||(this.deletedStates[t][r][e]=null)}else for(const e in i)this.deletedStates[t]&&this.deletedStates[t][r]&&null===this.deletedStates[t][r][e]&&delete this.deletedStates[t][r][e]}removeFeatureState(t,e,i){if(null===this.deletedStates[t])return;const r=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},i&&void 0!==e)null!==this.deletedStates[t][r]&&(this.deletedStates[t][r]=this.deletedStates[t][r]||{},this.deletedStates[t][r][i]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][r])for(i in this.deletedStates[t][r]={},this.stateChanges[t][r])this.deletedStates[t][r][i]=null;else this.deletedStates[t][r]=null;else this.deletedStates[t]=null}getState(t,e){const i=String(e),r=B({},(this.state[t]||{})[i],(this.stateChanges[t]||{})[i]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const i=this.deletedStates[t][e];if(null===i)return{};for(const t in i)delete r[t]}return r}initializeTileState(t,e){t.setFeatureState(this.state,e)}coalesceChanges(t,e){const i={};for(const t in this.stateChanges){this.state[t]=this.state[t]||{};const e={};for(const i in this.stateChanges[t])this.state[t][i]||(this.state[t][i]={}),B(this.state[t][i],this.stateChanges[t][i]),e[i]=this.state[t][i];i[t]=e}for(const t in this.deletedStates){this.state[t]=this.state[t]||{};const e={};if(null===this.deletedStates[t])for(const i in this.state[t])e[i]={},this.state[t][i]={};else for(const i in this.deletedStates[t]){if(null===this.deletedStates[t][i])this.state[t][i]={};else if(this.state[t][i])for(const e of Object.keys(this.deletedStates[t][i]))delete this.state[t][i][e];e[i]=this.state[t][i]}i[t]=i[t]||{},B(i[t],e)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(const r in t)t[r].setFeatureState(i,e)}}class ng{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,e){const i=this.toIdx(t,e);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(t,e){return this.leaves[this.toIdx(t,e)]}toIdx(t,e){return e*this.size+t}}function og(t,e,i,r){let n=0,o=Number.MAX_VALUE;for(let s=0;s<3;s++)if(Math.abs(r[s])<1e-15){if(i[s]<t[s]||i[s]>e[s])return null}else{const a=1/r[s];let l=(t[s]-i[s])*a,c=(e[s]-i[s])*a;if(l>c){const t=l;l=c,c=t}if(l>n&&(n=l),c<o&&(o=c),n>o)return null}return n}function sg(t,e,i,r,n,o,s,a,l,c,u){const h=r-t,d=n-e,p=o-i,f=s-t,m=a-e,g=l-i,_=u[1]*g-u[2]*m,y=u[2]*f-u[0]*g,v=u[0]*m-u[1]*f,x=h*_+d*y+p*v;if(Math.abs(x)<1e-15)return null;const b=1/x,w=c[0]-t,T=c[1]-e,E=c[2]-i,S=(w*_+T*y+E*v)*b;if(S<0||S>1)return null;const A=T*p-E*d,M=E*h-w*p,I=w*d-T*h,C=(u[0]*A+u[1]*M+u[2]*I)*b;return C<0||S+C>1?null:(f*A+m*M+g*I)*b}function ag(t,e,i){return(t-e)/(i-e)}function lg(t,e,i,r,n,o,s,a,l){const c=1<<i,u=o-r,h=s-n,d=(t+1)/c*u+r,p=(e+0)/c*h+n,f=(e+1)/c*h+n;a[0]=(t+0)/c*u+r,a[1]=p,l[0]=d,l[1]=f}class cg{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const e=function(t){const e=Math.ceil(Math.log2(t.dim/8)),i=[];let r=Math.ceil(Math.pow(2,e));const n=1/r,o=(t,e,i,r,n)=>{const o=r?1:0,s=(t+1)*i-o,a=e*i,l=(e+1)*i-o;n[0]=t*i,n[1]=a,n[2]=s,n[3]=l};let s=new ng(r);const a=[];for(let e=0;e<r*r;e++){o(e%r,Math.floor(e/r),n,!1,a);const i=hg(a[0],a[1],t),l=hg(a[2],a[1],t),c=hg(a[2],a[3],t),u=hg(a[0],a[3],t);s.minimums.push(Math.min(i,l,c,u)),s.maximums.push(Math.max(i,l,c,u)),s.leaves.push(1)}for(i.push(s),r/=2;r>=1;r/=2){const t=i[i.length-1];s=new ng(r);for(let e=0;e<r*r;e++){o(e%r,Math.floor(e/r),2,!0,a);const i=t.getElevation(a[0],a[1]),n=t.getElevation(a[2],a[1]),l=t.getElevation(a[2],a[3]),c=t.getElevation(a[0],a[3]),u=t.isLeaf(a[0],a[1]),h=t.isLeaf(a[2],a[1]),d=t.isLeaf(a[2],a[3]),p=t.isLeaf(a[0],a[3]),f=Math.min(i.min,n.min,l.min,c.min),m=Math.max(i.max,n.max,l.max,c.max),g=u&&h&&d&&p;s.maximums.push(m),s.minimums.push(f),s.leaves.push(m-f<=5&&g?1:0)}i.push(s)}return i}(this.dem),i=e.length-1,r=e[i];this._addNode(r.minimums[0],r.maximums[0],r.leaves[0]),this._construct(e,0,0,i,0)}raycastRoot(t,e,i,r,n,o,s=1){return og([t,e,-100],[i,r,this.maximums[0]*s],n,o)}raycast(t,e,i,r,n,o,s=1){if(!this.nodeCount)return null;const a=this.raycastRoot(t,e,i,r,n,o,s);if(null==a)return null;const l=[],c=[],u=[],h=[],d=[{idx:0,t:a,nodex:0,nodey:0,depth:0}];for(;d.length>0;){const{idx:a,t:p,nodex:f,nodey:m,depth:g}=d.pop();if(this.leaves[a]){lg(f,m,g,t,e,i,r,u,h);const a=1<<g,l=(f+0)/a,c=(f+1)/a,d=(m+0)/a,_=(m+1)/a,y=hg(l,d,this.dem)*s,v=hg(c,d,this.dem)*s,x=hg(c,_,this.dem)*s,b=hg(l,_,this.dem)*s,w=sg(u[0],u[1],y,h[0],u[1],v,h[0],h[1],x,n,o),T=sg(h[0],h[1],x,u[0],h[1],b,u[0],u[1],y,n,o),E=Math.min(null!==w?w:Number.MAX_VALUE,null!==T?T:Number.MAX_VALUE);if(E!==Number.MAX_VALUE)return E;{const t=nd.scaleAndAdd([],n,o,p);if(ug(y,v,b,x,ag(t[0],u[0],h[0]),ag(t[1],u[1],h[1]))>=t[2])return p}continue}let _=0;for(let d=0;d<this._siblingOffset.length;d++){lg((f<<1)+this._siblingOffset[d][0],(m<<1)+this._siblingOffset[d][1],g+1,t,e,i,r,u,h),u[2]=-100,h[2]=this.maximums[this.childOffsets[a]+d]*s;const p=og(u,h,n,o);if(null!=p){const t=p;l[d]=t;let e=!1;for(let i=0;i<_&&!e;i++)t>=l[c[i]]&&(c.splice(i,0,d),e=!0);e||(c[_]=d),_++}}for(let t=0;t<_;t++){const e=c[t];d.push({idx:this.childOffsets[a]+e,t:l[e],nodex:(f<<1)+this._siblingOffset[e][0],nodey:(m<<1)+this._siblingOffset[e][1],depth:g+1})}}return null}_addNode(t,e,i){return this.minimums.push(t),this.maximums.push(e),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(t,e,i,r,n){if(1===t[r].isLeaf(e,i))return;this.childOffsets[n]||(this.childOffsets[n]=this.nodeCount);const o=r-1,s=t[o];let a=0,l=0;for(let t=0;t<this._siblingOffset.length;t++){const r=2*e+this._siblingOffset[t][0],n=2*i+this._siblingOffset[t][1],o=s.getElevation(r,n),c=s.isLeaf(r,n),u=this._addNode(o.min,o.max,c);c&&(a|=1<<t),l||(l=u)}for(let r=0;r<this._siblingOffset.length;r++)a&1<<r||this._construct(t,2*e+this._siblingOffset[r][0],2*i+this._siblingOffset[r][1],o,l+r)}}function ug(t,e,i,r,n,o){return Yr(Yr(t,i,o),Yr(e,r,o),n)}function hg(t,e,i){const r=i.dim,n=R(t*r-.5,0,r-1),o=R(e*r-.5,0,r-1),s=Math.floor(n),a=Math.floor(o),l=Math.min(s+1,r-1),c=Math.min(a+1,r-1);return ug(i.get(s,a),i.get(l,a),i.get(s,c),i.get(l,c),n-s,o-a)}const dg={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function pg(t,e,i){return(256*t*256+256*e+i)/10-1e4}function fg(t,e,i){return 256*t+e+i/256-32768}class mg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,e,i,r=!1){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return Y(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=e.height;const n=this.dim=e.height-2,o=new Uint32Array(e.data.buffer);if(this.pixels=new Uint8Array(e.data.buffer),this.floatView=new Float32Array(e.data.buffer),this.borderReady=r,this._modifiedForSources={},!r){for(let t=0;t<n;t++)o[this._idx(-1,t)]=o[this._idx(0,t)],o[this._idx(n,t)]=o[this._idx(n-1,t)],o[this._idx(t,-1)]=o[this._idx(t,0)],o[this._idx(t,n)]=o[this._idx(t,n-1)];o[this._idx(-1,-1)]=o[this._idx(0,0)],o[this._idx(n,-1)]=o[this._idx(n-1,0)],o[this._idx(-1,n)]=o[this._idx(0,n-1)],o[this._idx(n,n)]=o[this._idx(n-1,n-1)]}const s="terrarium"===i?fg:pg;for(let t=0;t<o.length;++t){const e=4*t;this.floatView[t]=s(this.pixels[e],this.pixels[e+1],this.pixels[e+2])}this._timestamp=pe.now()}_buildQuadTree(){this._tree=new cg(this)}get(t,e,i=!1){i&&(t=R(t,-1,this.dim),e=R(e,-1,this.dim));const r=this._idx(t,e);return this.floatView[r]}set(t,e,i){const r=this._idx(t,e),n=this.floatView[r];return this.floatView[r]=i,i-n}static getUnpackVector(t){return dg[t]}_idx(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)}static pack(t,e){const i=[0,0,0,0],r=mg.getUnpackVector(e);let n=Math.floor((t+r[3])/r[2]);return i[2]=n%256,n=Math.floor(n/256),i[1]=n%256,n=Math.floor(n/256),i[0]=n,i}getPixels(){return new wf({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,e,i){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let r=e*this.dim,n=e*this.dim+this.dim,o=i*this.dim,s=i*this.dim+this.dim;switch(e){case-1:r=n-1;break;case 1:n=r+1}switch(i){case-1:o=s-1;break;case 1:s=o+1}const a=-e*this.dim,l=-i*this.dim;for(let e=o;e<s;e++)for(let i=r;i<n;i++){const r=4*this._idx(i,e),n=4*this._idx(i+a,e+l);this.pixels[r+0]=t.pixels[n+0],this.pixels[r+1]=t.pixels[n+1],this.pixels[r+2]=t.pixels[n+2],this.pixels[r+3]=t.pixels[n+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}xs(mg,"DEMData"),xs(cg,"DemMinMaxQuadTree",{omit:["dem"]});class gg{constructor(t,e,i){this._demTile=t,this._dem=this._demTile.dem,this._scale=e,this._offset=i}static create(t,e,i){const r=i||t.findDEMTileFor(e);if(!r||!r.dem)return;const n=r.dem,o=r.tileID,s=1<<e.canonical.z-o.canonical.z;return new gg(r,n.dim/ur/s,[(e.canonical.x/s-o.canonical.x)*n.dim,(e.canonical.y/s-o.canonical.y)*n.dim])}tileCoordToPixel(t,e){const i=e*this._scale+this._offset[1],r=Math.floor(t*this._scale+this._offset[0]),n=Math.floor(i);return new v(r,n)}getElevationAt(t,e,i,r){const n=t*this._scale+this._offset[0],o=e*this._scale+this._offset[1],s=Math.floor(n),a=Math.floor(o),l=this._dem;return r=!!r,i?Yr(Yr(l.get(s,a,r),l.get(s,a+1,r),o-a),Yr(l.get(s+1,a,r),l.get(s+1,a+1,r),o-a),n-s):l.get(s,a,r)}getElevationAtPixel(t,e,i){return this._dem.get(t,e,!!i)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*vp(1,t)*this._dem.stride}}class _g{constructor(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new ys(ur,16,0),this.featureIndexArray=new Yl,this.promoteId=e}insert(t,e,i,r,n,o=0){const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,r,n,o);const a=this.grid;for(let t=0;t<e.length;t++){const i=e[t],r=[1/0,1/0,-1/0,-1/0];for(let t=0;t<i.length;t++){const e=i[t];r[0]=Math.min(r[0],e.x),r[1]=Math.min(r[1],e.y),r[2]=Math.max(r[2],e.x),r[3]=Math.max(r[3],e.y)}r[0]<ur&&r[1]<ur&&r[2]>=0&&r[3]>=0&&a.insert(s,r[0],r[1],r[2],r[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Cm(new tg(this.rawTileData)).layers,this.sourceLayerCoder=new Om(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,e,i,r){this.loadVTLayers();const n=t.params||{},o=Co(n.filter),s=t.tileResult,a=t.transform,l=s.bufferedTilespaceBounds,c=this.grid.query(l.min.x,l.min.y,l.max.x,l.max.y,(t,e,i,r)=>Kp(s.bufferedTilespaceGeometry,t,e,i,r));c.sort(vg);let u=null;a.elevation&&c.length>0&&(u=gg.create(a.elevation,this.tileID));const h={};let d;for(let a=0;a<c.length;a++){const l=c[a];if(l===d)continue;d=l;const p=this.featureIndexArray.get(l);let f=null;this.loadMatchingFeature(h,p,o,n.layers,n.availableImages,e,i,r,(e,i,r,n=0)=>(f||(f=Bp(e,this.tileID.canonical,t.tileTransform)),i.queryIntersectsFeature(s,e,r,f,this.z,t.transform,t.pixelPosMatrix,u,n)))}return h}loadMatchingFeature(t,e,i,r,n,o,s,a,l){const{featureIndex:c,bucketIndex:u,sourceLayerIndex:h,layoutVertexArrayOffset:d}=e,p=this.bucketLayerIDs[u];if(r&&!function(t,e){for(let i=0;i<t.length;i++)if(e.indexOf(t[i])>=0)return!0;return!1}(r,p))return;const f=this.sourceLayerCoder.decode(h),m=this.vtLayers[f].feature(c);if(i.needGeometry){const t=Fp(m,!0);if(!i.filter(new Ua(this.tileID.overscaledZ),t,this.tileID.canonical))return}else if(!i.filter(new Ua(this.tileID.overscaledZ),m))return;const g=this.getId(m,f);for(let e=0;e<p.length;e++){const i=p[e];if(r&&r.indexOf(i)<0)continue;const u=o[i];if(!u)continue;let h={};void 0!==g&&a&&(h=a.getState(u.sourceLayer||"_geojsonTileLayer",g));const f=B({},s[i]);f.paint=yg(f.paint,u.paint,m,h,n),f.layout=yg(f.layout,u.layout,m,h,n);const _=!l||l(m,u,h,d);if(!_)continue;const y=new ig(m,this.z,this.x,this.y,g);y.layer=f;let v=t[i];void 0===v&&(v=t[i]=[]),v.push({featureIndex:c,feature:y,intersectionZ:_})}}lookupSymbolFeatures(t,e,i,r,n,o,s,a){const l={};this.loadVTLayers();const c=Co(n);for(const n of t)this.loadMatchingFeature(l,{bucketIndex:i,sourceLayerIndex:r,featureIndex:n,layoutVertexArrayOffset:0},c,o,s,a,e);return l}loadFeature(t){const{featureIndex:e,sourceLayerIndex:i}=t;this.loadVTLayers();const r=this.sourceLayerCoder.decode(i),n=this.vtFeatures[r];if(n[e])return n[e];const o=this.vtLayers[r].feature(e);return n[e]=o,o}hasLayer(t){for(const e of this.bucketLayerIDs)for(const i of e)if(t===i)return!0;return!1}getId(t,e){let i=t.id;if(this.promoteId){const r="string"==typeof this.promoteId?this.promoteId:this.promoteId[e];null!=r&&(i=t.properties[r]),"boolean"==typeof i&&(i=Number(i))}return i}}function yg(t,e,i,r,n){return H(t,(t,o)=>{const s=e instanceof $a?e.get(o):null;return s&&s.evaluate?s.evaluate(i,r,n):s})}function vg(t,e){return e-t}xs(_g,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const xg=ll([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),bg=ll([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),wg=ll([{name:"a_projected_pos",components:4,type:"Float32"}],4);ll([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Tg=ll([{name:"a_z_offset",components:1,type:"Float32"}],4),Eg=ll([{name:"a_texb",components:2,type:"Uint16"}]),Sg=ll([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Ag=ll([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);ll([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Mg=ll([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ig=ll([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ll([{name:"triangle",components:3,type:"Uint16"}]),ll([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ll([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),ll([{type:"Float32",name:"offsetX"}]),ll([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);const Cg=128;function Pg(t,e){const{expression:i}=e;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new Ua(t+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:e,interpolationType:r}=i;let n=0;for(;n<e.length&&e[n]<=t;)n++;n=Math.max(0,n-1);let o=n;for(;o<e.length&&e[o]<t+1;)o++;o=Math.min(e.length-1,o);const s=e[n],a=e[o];return"composite"===i.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:r}:{kind:"camera",minZoom:s,maxZoom:a,minSize:i.evaluate(new Ua(s)),maxSize:i.evaluate(new Ua(a)),interpolationType:r}}}function Rg(t,{uSize:e,uSizeT:i},{lowerSize:r,upperSize:n}){return"source"===t.kind?r/Cg:"composite"===t.kind?Yr(r/Cg,n/Cg,i):e}function Og(t,e){let i=0,r=0;if("constant"===t.kind)r=t.layoutSize;else if("source"!==t.kind){const{interpolationType:n,minZoom:o,maxZoom:s}=t,a=n?R(mn.interpolationFactor(n,e,o,s),0,1):0;"camera"===t.kind?r=Yr(t.minSize,t.maxSize,a):i=a}return{uSizeT:i,uSize:r}}var Dg=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Cg,evaluateSizeForFeature:Rg,evaluateSizeForZoom:Og,getSizeData:Pg});function Lg(t,e,i){return t.sections.forEach(t=>{t.text=function(t,e,i){const r=e.layout.get("text-transform").evaluate(i,{});return"uppercase"===r?t=t.toLocaleUpperCase():"lowercase"===r&&(t=t.toLocaleLowerCase()),Na.applyArabicShaping&&(t=Na.applyArabicShaping(t)),t}(t.text,e,i)}),t}const kg={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Bg(t){return""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t}function Fg(t){return""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t}function zg(t,e,i){e.glyphs=[],1===t&&i.readMessage(Ng,e)}function Ng(t,e,i){if(3===t){const{id:t,bitmap:r,width:n,height:o,left:s,top:a,advance:l}=i.readMessage(Ug,{});e.glyphs.push({id:t,bitmap:new xf({width:n+6,height:o+6},r),metrics:{width:n,height:o,left:s,top:a,advance:l}})}else 4===t?e.ascender=i.readSVarint():5===t&&(e.descender=i.readSVarint())}function Ug(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}const Gg={horizontal:1,vertical:2,horizontalOnly:3};class jg{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,e){const i=new jg;return i.scale=t||1,i.fontStack=e,i}static forImage(t){const e=new jg;return e.imageName=t,e}}class Vg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,e){const i=new Vg;for(let r=0;r<t.sections.length;r++){const n=t.sections[r];n.image?i.addImageSection(n):i.addTextSection(n,e)}return i}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(t,e){let i="";for(let r=0;r<t.length;r++){const n=t.charCodeAt(r+1)||null,o=t.charCodeAt(r-1)||null;i+=!e&&(n&&Ea(n)&&!kg[t[r+1]]||o&&Ea(o)&&!kg[t[r-1]])||!kg[t[r]]?t[r]:kg[t[r]]}return i}(this.text,t)}trim(){let t=0;for(let e=0;e<this.text.length&&Hg[this.text.charCodeAt(e)];e++)t++;let e=this.text.length;for(let i=this.text.length-1;i>=0&&i>=t&&Hg[this.text.charCodeAt(i)];i--)e--;this.text=this.text.substring(t,e),this.sectionIndex=this.sectionIndex.slice(t,e)}substring(t,e){const i=new Vg;return i.text=this.text.substring(t,e),i.sectionIndex=this.sectionIndex.slice(t,e),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,e)=>Math.max(t,this.sections[e].scale),0)}addTextSection(t,e){this.text+=t.text,this.sections.push(jg.forText(t.scale,t.fontStack||e));const i=this.sections.length-1;for(let e=0;e<t.text.length;++e)this.sectionIndex.push(i)}addImageSection(t){const e=t.image?t.image.namePrimary:"";if(0===e.length)return void Y("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCodePoint(i),this.sections.push(jg.forImage(e)),this.sectionIndex.push(this.sections.length-1)):Y("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Xg(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f){const m=Vg.fromFeature(t,n);h===Gg.vertical&&m.verticalizePunctuation(d);let g=[];const _=function(t,e,i,r,n,o){if(!t)return[];const s=[],a=function(t,e,i,r,n,o){let s=0;for(let i=0;i<t.length();i++){const a=t.getSection(i);s+=Wg(t.getCodePoint(i),a,r,n,e,o)}return s/Math.max(1,Math.ceil(s/i))}(t,e,i,r,n,o),l=t.text.indexOf("")>=0;let c=0;for(let i=0;i<t.length();i++){const h=t.getSection(i),d=t.getCodePoint(i);if(Hg[d]||(c+=Wg(d,h,r,n,e,o)),i<t.length()-1){const e=!((u=d)<11904||!(Js(u)||Ys(u)||ma(u)||da(u)||ia(u)||Vs(u)||Qs(u)||qs(u)||ra(u)||oa(u)||ea(u)||ya(u)||Ws(u)||Hs(u)||Xs(u)||ta(u)||$s(u)||fa(u)||aa(u)||sa(u)));(qg[d]||e||h.imageName)&&s.push(Zg(i+1,c,a,s,Yg(d,t.getCodePoint(i+1),e&&l),!1))}}var u;return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(Zg(t.length(),c,a,s,0,!0))}(m,c,o,e,r,p),{processBidirectionalText:y,processStyledBidirectionalText:v}=Na;if(y&&1===m.sections.length){const t=y(m.toString(),_);for(const e of t){const t=new Vg;t.text=e,t.sections=m.sections;for(let i=0;i<e.length;i++)t.sectionIndex.push(0);g.push(t)}}else if(v){const t=v(m.text,m.sectionIndex,_);for(const e of t){const t=new Vg;t.text=e[0],t.sectionIndex=e[1],t.sections=m.sections,g.push(t)}}else g=function(t,e){const i=[],r=t.text;let n=0;for(const r of e)i.push(t.substring(n,r)),n=r;return n<r.length&&i.push(t.substring(n,r.length)),i}(m,_);const x=[],b={positionedLines:x,text:m.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(t,e,i,r,n,o,s,a,l,c,u,h){let d=0,p=0,f=0;const m="right"===a?1:"left"===a?0:.5;let g=!1;for(const t of n){const i=t.getSections();for(const t of i){if(t.imageName)continue;const i=e[t.fontStack];if(i&&(g=void 0!==i.ascender&&void 0!==i.descender,!g))break}if(!g)break}let _=0;for(const s of n){s.trim();const n=s.getMaxScale(),a=24*(n-1),v={positionedGlyphs:[],lineOffset:0};t.positionedLines[_]=v;const x=v.positionedGlyphs;let b=0;if(!s.length()){p+=o,++_;continue}let w=0,T=0;for(let o=0;o<s.length();o++){const a=s.getSection(o),f=s.getSectionIndex(o),m=s.getCodePoint(o);let _=a.scale,v=null,E=null,S=null,A=24,M=0;const I=!(l===Gg.horizontal||!u&&!Ta(m)||u&&(Hg[m]||(y=m,As(y)||Ms(y)||Is(y)||pa(y)||_a(y))));if(a.imageName){const e=r[a.imageName];if(!e)continue;S=a.imageName,t.iconsInText=t.iconsInText||!0,E=e.paddedRect;const i=e.displaySize;_=24*_/h,v={width:i[0],height:i[1],left:0,top:-3,advance:I?i[1]:i[0],localGlyph:!1},M=g?-v.height*_:24*n-17-i[1]*_,A=v.advance;const o=(I?i[0]:i[1])*_-24*n;o>0&&o>b&&(b=o)}else{const t=i[a.fontStack];if(!t)continue;t[m]&&(E=t[m]);const r=e[a.fontStack];if(!r)continue;const o=r.glyphs[m];if(!o)continue;if(v=o.metrics,A=8203!==m?24:0,g){const t=void 0!==r.ascender?Math.abs(r.ascender):0,e=void 0!==r.descender?Math.abs(r.descender):0,i=(t+e)*_;w<i&&(w=i,T=(t-e)/2*_),M=-t*_}else M=24*(n-_)-17}I?(t.verticalizable=!0,x.push({glyph:m,imageName:S,x:d,y:p+M,vertical:I,scale:_,localGlyph:v.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:v,rect:E}),d+=A*_+c):(x.push({glyph:m,imageName:S,x:d,y:p+M,vertical:I,scale:_,localGlyph:v.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:v,rect:E}),d+=v.advance*_+c)}0!==x.length&&(f=Math.max(d-c,f),g?Jg(x,m,b,T,o*n/2):Jg(x,m,b,0,o/2)),d=0;const E=o*n+b;v.lineOffset=Math.max(b,a),p+=E,++_}var y;const v=p,{horizontalAlign:x,verticalAlign:b}=Kg(s);(function(t,e,i,r,n,o){const s=(e-i)*n,a=-o*r;for(const e of t)for(const t of e.positionedGlyphs)t.x+=s,t.y+=a})(t.positionedLines,m,x,b,f,v),t.top+=-b*v,t.bottom=t.top+v,t.left+=-x*f,t.right=t.left+f,t.hasBaseline=g}(b,e,i,r,g,s,a,l,h,c,d,f),!function(t){for(const e of t)if(0!==e.positionedGlyphs.length)return!1;return!0}(x)&&b}const Hg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},qg={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Wg(t,e,i,r,n,o){if(e.imageName){const t=r[e.imageName];return t?t.displaySize[0]*e.scale*24/o+n:0}{const r=i[e.fontStack],o=r&&r.glyphs[t];return o?o.metrics.advance*e.scale+n:0}}function $g(t,e,i,r){const n=Math.pow(t-e,2);return r?t<e?n/2:2*n:n+Math.abs(i)*i}function Yg(t,e,i){let r=0;return 10===t&&(r-=1e4),i&&(r+=150),40!==t&&65288!==t||(r+=50),41!==e&&65289!==e||(r+=50),r}function Zg(t,e,i,r,n,o){let s=null,a=$g(e,i,n,o);for(const t of r){const r=$g(e-t.x,i,n,o)+t.badness;r<=a&&(s=t,a=r)}return{index:t,x:e,priorBreak:s,badness:a}}function Kg(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Jg(t,e,i,r,n){if(!(e||i||r||n))return;const o=t.length-1,s=t[o],a=(s.x+s.metrics.advance*s.scale)*e;for(let e=0;e<=o;e++)t[e].x-=a,t[e].y+=i+r+n}function Qg(t,e,i,r){const{horizontalAlign:n,verticalAlign:o}=Kg(r),s=i[0]-t.displaySize[0]*n,a=i[1]-t.displaySize[1]*o;return{imagePrimary:t,imageSecondary:e,top:a,bottom:a+t.displaySize[1],left:s,right:s+t.displaySize[0]}}function t_(t,e,i,r,n,o){const s=t.imagePrimary;let a;if(s.content){const t=s.content,e=s.pixelRatio||1;a=[t[0]/e,t[1]/e,s.displaySize[0]-t[2]/e,s.displaySize[1]-t[3]/e]}const l=e.left*o,c=e.right*o;let u,h,d,p;"width"===i||"both"===i?(p=n[0]+l-r[3],h=n[0]+c+r[1]):(p=n[0]+(l+c-s.displaySize[0])/2,h=p+s.displaySize[0]);const f=e.top*o,m=e.bottom*o;return"height"===i||"both"===i?(u=n[1]+f-r[0],d=n[1]+m+r[2]):(u=n[1]+(f+m-s.displaySize[1])/2,d=u+s.displaySize[1]),{imagePrimary:s,imageSecondary:void 0,top:u,right:h,bottom:d,left:p,collisionPadding:a}}class e_ extends v{constructor(t,e,i,r,n){super(t,e),this.angle=r,this.z=i,void 0!==n&&(this.segment=n)}clone(){return new e_(this.x,this.y,this.z,this.angle,this.segment)}}function i_(t,e,i,r,n){if(void 0===e.segment)return!0;let o=e,s=e.segment+1,a=0;for(;a>-i/2;){if(s--,s<0)return!1;a-=t[s].dist(o),o=t[s]}a+=t[s].dist(t[s+1]),s++;const l=[];let c=0;for(;a<i/2;){const e=t[s],i=t[s+1];if(!i)return!1;let o=t[s-1].angleTo(e)-e.angleTo(i);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),c+=o;a-l[0].distance>r;)c-=l.shift().angleDelta;if(c>n)return!1;s++,a+=e.dist(i)}return!0}function r_(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function n_(t,e,i){return t?.6*e*i:0}function o_(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function s_(t,e,i,r,n,o){const s=n_(i,n,o),a=o_(i,r)*o;let l=0;const c=r_(t)/2;for(let i=0;i<t.length-1;i++){const r=t[i],n=t[i+1],o=r.dist(n);if(l+o>c){const u=(c-l)/o,h=Yr(r.x,n.x,u),d=Yr(r.y,n.y,u),p=new e_(h,d,0,n.angleTo(r),i);return!s||i_(t,p,a,s,e)?p:void 0}l+=o}}function a_(t,e,i,r,n,o,s,a,l){const c=n_(r,o,s),u=o_(r,n),h=u*s,d=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-h<e/4&&(e=h+e/4),function t(e,i,r,n,o,s,a,l,c){const u=s/2,h=r_(e);let d=0,p=i-r,f=[];for(let t=0;t<e.length-1;t++){const i=e[t],a=e[t+1],l=i.dist(a),m=a.angleTo(i);for(;p+r<d+l;){p+=r;const g=(p-d)/l,_=Yr(i.x,a.x,g),y=Yr(i.y,a.y,g);if(_>=0&&_<c&&y>=0&&y<c&&p-u>=0&&p+u<=h){const i=new e_(_,y,0,m,t);n&&!i_(e,i,s,n,o)||f.push(i)}}d+=l}return l||f.length||a||(f=t(e,d/2,r,n,o,s,a,!0,c)),f}(t,d?e/2*a%e:(u/2+2*o)*s*a%e,e,c,i,h,d,!1,l)}function l_(t,e,i,r,n){const o=[];for(let s=0;s<t.length;s++){const a=t[s];let l;for(let t=0;t<a.length-1;t++){let s=a[t],c=a[t+1];s.x<e&&c.x<e||(s.x<e?s=new v(e,s.y+(e-s.x)/(c.x-s.x)*(c.y-s.y))._round():c.x<e&&(c=new v(e,s.y+(e-s.x)/(c.x-s.x)*(c.y-s.y))._round()),s.y<i&&c.y<i||(s.y<i?s=new v(s.x+(i-s.y)/(c.y-s.y)*(c.x-s.x),i)._round():c.y<i&&(c=new v(s.x+(i-s.y)/(c.y-s.y)*(c.x-s.x),i)._round()),s.x>=r&&c.x>=r||(s.x>=r?s=new v(r,s.y+(r-s.x)/(c.x-s.x)*(c.y-s.y))._round():c.x>=r&&(c=new v(r,s.y+(r-s.x)/(c.x-s.x)*(c.y-s.y))._round()),s.y>=n&&c.y>=n||(s.y>=n?s=new v(s.x+(n-s.y)/(c.y-s.y)*(c.x-s.x),n)._round():c.y>=n&&(c=new v(s.x+(n-s.y)/(c.y-s.y)*(c.x-s.x),n)._round()),l&&s.equals(l[l.length-1])||(l=[s],o.push(l)),l.push(c)))))}}return o}function c_(t){let e=0,i=0;for(const r of t)e+=r.w*r.h,i=Math.max(i,r.w);t.sort((t,e)=>e.h-t.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let n=0,o=0;for(const e of t)for(let t=r.length-1;t>=0;t--){const i=r[t];if(!(e.w>i.w||e.h>i.h)){if(e.x=i.x,e.y=i.y,o=Math.max(o,e.y+e.h),n=Math.max(n,e.x+e.w),e.w===i.w&&e.h===i.h){const e=r.pop();t<r.length&&(r[t]=e)}else e.h===i.h?(i.x+=e.w,i.w-=e.w):e.w===i.w?(i.y+=e.h,i.h-=e.h):(r.push({x:i.x+e.w,y:i.y,w:i.w-e.w,h:e.h}),i.y+=e.h,i.h-=e.h);break}}return{w:n,h:o,fill:e/(n*o)||0}}xs(e_,"Anchor");class u_{constructor(t,{pixelRatio:e,version:i,stretchX:r,stretchY:n,content:o}){this.paddedRect=t,this.pixelRatio=e,this.stretchX=r,this.stretchY=n,this.content=o,this.version=i}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class h_{constructor(t,e){const i={},r={};this.haveRenderCallbacks=[];const n=[];this.addImages(t,i,n),this.addImages(e,r,n);const{w:o,h:s}=c_(n),a=new bf({width:o||1,height:s||1});for(const e in t){const r=t[e],n=i[e].paddedRect;bf.copy(r.data,a,{x:0,y:0},{x:n.x+1,y:n.y+1},r.data)}for(const t in e){const i=e[t],n=r[t].paddedRect,o=n.x+1,s=n.y+1,l=i.data.width,c=i.data.height;bf.copy(i.data,a,{x:0,y:0},{x:o,y:s},i.data),bf.copy(i.data,a,{x:0,y:c-1},{x:o,y:s-1},{width:l,height:1}),bf.copy(i.data,a,{x:0,y:0},{x:o,y:s+c},{width:l,height:1}),bf.copy(i.data,a,{x:l-1,y:0},{x:o-1,y:s},{width:1,height:c}),bf.copy(i.data,a,{x:0,y:0},{x:o+l,y:s},{width:1,height:c})}this.image=a,this.iconPositions=i,this.patternPositions=r}addImages(t,e,i){for(const r in t){const n=t[r],o={x:0,y:0,w:n.data.width+2,h:n.data.height+2};i.push(o),e[r]=new u_(o,n),n.hasRenderCallback&&this.haveRenderCallbacks.push(r)}}patchUpdatedImages(t,e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(e=>t.hasImage(e,i)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,i);for(const r in t.getUpdatedImages(i))this.patchUpdatedImage(this.iconPositions[r],t.getImage(r,i),e),this.patchUpdatedImage(this.patternPositions[r],t.getImage(r,i),e)}patchUpdatedImage(t,e,i){if(!t||!e)return;if(t.version===e.version)return;t.version=e.version;const[r,n]=t.tl;i.update(e.data,void 0,{x:r,y:n})}}xs(u_,"ImagePosition"),xs(h_,"ImageAtlas");const d_=1e20;function p_(t,e,i,r,n,o,s,a,l){for(let c=e;c<e+r;c++)f_(t,i*o+c,o,n,s,a,l);for(let c=i;c<i+n;c++)f_(t,c*o+e,1,r,s,a,l)}function f_(t,e,i,r,n,o,s){o[0]=0,s[0]=-d_,s[1]=d_,n[0]=t[e];for(let a=1,l=0,c=0;a<r;a++){n[a]=t[e+a*i];const r=a*a;do{const t=o[l];c=(n[a]-n[t]+r-t*t)/(a-t)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=d_}for(let a=0,l=0;a<r;a++){for(;s[l+1]<a;)l++;const r=o[l],c=a-r;t[e+a*i]=n[r]+c*c}}class m_{constructor(t,e,i){this.requestManager=t,this.localGlyphMode=e,this.localFontFamily=i,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,e){this.urls[e]=t}getGlyphs(t,e,i){const r=[],n=this.urls[e]||o.GLYPHS_URL;for(const e in t)for(const i of t[e])r.push({stack:e,id:i});L(r,({stack:t,id:e},i)=>{let r=this.entries[t];r||(r=this.entries[t]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let o=r.glyphs[e];if(void 0!==o)return void i(null,{stack:t,id:e,glyph:o});if(o=this._tinySDF(r,t,e),o)return r.glyphs[e]=o,void i(null,{stack:t,id:e,glyph:o});const s=Math.floor(e/256);if(256*s>65535)return void i(new Error("glyphs > 65535 not supported"));if(r.ranges[s])return void i(null,{stack:t,id:e,glyph:o});let a=r.requests[s];a||(a=r.requests[s]=[],m_.loadGlyphRange(t,s,n,this.requestManager,(t,e)=>{if(e){r.ascender=e.ascender,r.descender=e.descender;for(const t in e.glyphs)this._doesCharSupportLocalGlyph(+t)||(r.glyphs[+t]=e.glyphs[+t]);r.ranges[s]=!0}for(const i of a)i(t,e);delete r.requests[s]})),a.push((r,n)=>{r?i(r):n&&i(null,{stack:t,id:e,glyph:n.glyphs[e]||null})})},(t,e)=>{if(t)i(t);else if(e){const t={};for(const{stack:i,id:r,glyph:n}of e)void 0===t[i]&&(t[i]={}),void 0===t[i].glyphs&&(t[i].glyphs={}),t[i].glyphs[r]=n&&{id:n.id,bitmap:n.bitmap.clone(),metrics:n.metrics},t[i].ascender=this.entries[i].ascender,t[i].descender=this.entries[i].descender;i(null,t)}})}_doesCharSupportLocalGlyph(t){return 0!==this.localGlyphMode&&(2===this.localGlyphMode?!!this.localFontFamily:!!this.localFontFamily&&(oa(t)||ca(t)||Ws(t)||$s(t)||qs(t)||ra(t)||va(t)))}_tinySDF(t,e,i){const r=this.localFontFamily;if(!r||!this._doesCharSupportLocalGlyph(i))return;let n=t.tinySDF;if(!n){let i="400";/bold/i.test(e)?i="900":/medium/i.test(e)?i="500":/light/i.test(e)&&(i="200"),n=t.tinySDF=new m_.TinySDF({fontFamily:r,fontWeight:i,fontSize:48,buffer:6,radius:16}),n.fontWeight=i}if(this.localGlyphs[n.fontWeight][i])return this.localGlyphs[n.fontWeight][i];const o=String.fromCodePoint(i),{data:s,width:a,height:l,glyphWidth:c,glyphHeight:u,glyphLeft:h,glyphTop:d,glyphAdvance:p}=n.draw(o);return this.localGlyphs[n.fontWeight][i]={id:i,bitmap:new xf({width:a,height:l},s),metrics:{width:c/2,height:u/2,left:h/2,top:d/2-27,advance:p/2,localGlyph:!0}}}}function g_(t,e,i,r){const n=[],o=t.imagePrimary,s=o.pixelRatio,a=o.paddedRect.w-2,l=o.paddedRect.h-2,c=t.right-t.left,u=t.bottom-t.top,h=o.stretchX||[[0,a]],d=o.stretchY||[[0,l]],p=(t,e)=>t+e[1]-e[0],f=h.reduce(p,0),m=d.reduce(p,0),g=a-f,_=l-m;let y=0,x=f,b=0,w=m,T=0,E=g,S=0,A=_;if(o.content&&r){const t=o.content;y=__(h,0,t[0]),b=__(d,0,t[1]),x=__(h,t[0],t[2]),w=__(d,t[1],t[3]),T=t[0]-y,S=t[1]-b,E=t[2]-t[0]-x,A=t[3]-t[1]-w}const M=(r,n,a,l)=>{const h=v_(r.stretch-y,x,c,t.left),d=x_(r.fixed-T,E,r.stretch,f),p=v_(n.stretch-b,w,u,t.top),g=x_(n.fixed-S,A,n.stretch,m),_=v_(a.stretch-y,x,c,t.left),M=x_(a.fixed-T,E,a.stretch,f),I=v_(l.stretch-b,w,u,t.top),C=x_(l.fixed-S,A,l.stretch,m),P=new v(h,p),R=new v(_,p),O=new v(_,I),D=new v(h,I),L=new v(d/s,g/s),k=new v(M/s,C/s),B=e*Math.PI/180;if(B){const t=Math.sin(B),e=Math.cos(B),i=[e,-t,t,e];P._matMult(i),R._matMult(i),D._matMult(i),O._matMult(i)}const F=r.stretch+r.fixed,z=a.stretch+a.fixed,N=n.stretch+n.fixed,U=l.stretch+l.fixed,G=t.imageSecondary;return{tl:P,tr:R,bl:D,br:O,texPrimary:{x:o.paddedRect.x+1+F,y:o.paddedRect.y+1+N,w:z-F,h:U-N},texSecondary:G?{x:G.paddedRect.x+1+F,y:G.paddedRect.y+1+N,w:z-F,h:U-N}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:L,pixelOffsetBR:k,minFontScaleX:E/s/c,minFontScaleY:A/s/u,isSDF:i}};if(r&&(o.stretchX||o.stretchY)){const t=y_(h,g,f),e=y_(d,_,m);for(let i=0;i<t.length-1;i++){const r=t[i],o=t[i+1];for(let t=0;t<e.length-1;t++)n.push(M(r,e[t],o,e[t+1]))}}else n.push(M({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:a+1},{fixed:0,stretch:l+1}));return n}function __(t,e,i){let r=0;for(const n of t)r+=Math.max(e,Math.min(i,n[1]))-Math.max(e,Math.min(i,n[0]));return r}function y_(t,e,i){const r=[{fixed:-1,stretch:0}];for(const[e,i]of t){const t=r[r.length-1];r.push({fixed:e-t.stretch,stretch:t.stretch}),r.push({fixed:e-t.stretch,stretch:t.stretch+(i-e)})}return r.push({fixed:e+1,stretch:i}),r}function v_(t,e,i,r){return t/e*i+r}function x_(t,e,i,r){return t-e*i/r}function b_(t,e,i,r){const n=e+t.positionedLines[r].lineOffset;return 0===r?i+n/2:i+(n+(e+t.positionedLines[r-1].lineOffset))/2}function w_(t,e=1,i=!1){let r=1/0,n=1/0,o=-1/0,s=-1/0;const a=t[0];for(let t=0;t<a.length;t++){const e=a[t];(!t||e.x<r)&&(r=e.x),(!t||e.y<n)&&(n=e.y),(!t||e.x>o)&&(o=e.x),(!t||e.y>s)&&(s=e.y)}const l=Math.min(o-r,s-n);let c=l/2;const u=new cr([],T_);if(0===l)return new v(r,n);for(let e=r;e<o;e+=l)for(let i=n;i<s;i+=l)u.push(new E_(e+c,i+c,c,t));let h=function(t){let e=0,i=0,r=0;const n=t[0];for(let t=0,o=n.length,s=o-1;t<o;s=t++){const o=n[t],a=n[s],l=o.x*a.y-a.x*o.y;i+=(o.x+a.x)*l,r+=(o.y+a.y)*l,e+=3*l}return new E_(i/e,r/e,0,t)}(t),d=u.length;for(;u.length;){const r=u.pop();(r.d>h.d||!h.d)&&(h=r,i&&console.log("found best %d after %d probes",Math.round(1e4*r.d)/1e4,d)),r.max-h.d<=e||(c=r.h/2,u.push(new E_(r.p.x-c,r.p.y-c,c,t)),u.push(new E_(r.p.x+c,r.p.y-c,c,t)),u.push(new E_(r.p.x-c,r.p.y+c,c,t)),u.push(new E_(r.p.x+c,r.p.y+c,c,t)),d+=4)}return i&&(console.log("num probes: "+d),console.log("best distance: "+h.d)),h.p}function T_(t,e){return e.max-t.max}m_.loadGlyphRange=function(t,e,i,r,n){const o=256*e,s=o+255,a=r.transformRequest(r.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${o}-${s}`),vt.Glyphs);Et(a,(t,e)=>{if(t)n(t);else if(e){const t={},i=function(t){return new tg(t).readFields(zg,{})}(e);for(const e of i.glyphs)t[e.id]=e;n(null,{glyphs:t,ascender:i.ascender,descender:i.descender})}})},m_.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:r=.25,fontFamily:n="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}={}){this.buffer=e,this.cutoff=r,this.radius=i;const a=this.size=t+4*e,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${s} ${o} ${t}px ${n}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:n,actualBoundingBoxRight:o}=this.ctx.measureText(t),s=Math.ceil(i),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-n))),l=Math.min(this.size-this.buffer,s+Math.ceil(r)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:e};if(0===a||0===l)return p;const{ctx:f,buffer:m,gridInner:g,gridOuter:_}=this;f.clearRect(m,m,a,l),f.fillText(t,m,m+s);const y=f.getImageData(m,m,a,l);_.fill(d_,0,h),g.fill(0,0,h);for(let t=0;t<l;t++)for(let e=0;e<a;e++){const i=y.data[4*(t*a+e)+3]/255;if(0===i)continue;const r=(t+m)*c+e+m;if(1===i)_[r]=0,g[r]=d_;else{const t=.5-i;_[r]=t>0?t*t:0,g[r]=t<0?t*t:0}}p_(_,0,0,c,u,c,this.f,this.v,this.z),p_(g,m,m,a,l,c,this.f,this.v,this.z);for(let t=0;t<h;t++){const e=Math.sqrt(_[t])-Math.sqrt(g[t]);d[t]=Math.round(255-255*(e/this.radius+this.cutoff))}return p}};class E_{constructor(t,e,i,r){this.p=new v(t,e),this.h=i,this.d=function(t,e){let i=!1,r=1/0;for(let n=0;n<e.length;n++){const o=e[n];for(let e=0,n=o.length,s=n-1;e<n;s=e++){const n=o[e],a=o[s];n.y>t.y!=a.y>t.y&&t.x<(a.x-n.x)*(t.y-n.y)/(a.y-n.y)+n.x&&(i=!i),r=Math.min(r,$p(t,n,a))}}return(i?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}}const S_=Number.POSITIVE_INFINITY,A_=Math.sqrt(2);function M_(t,[e,i]){let r=0,n=0;if(i===S_){e<0&&(e=0);const i=e/A_;switch(t){case"top-right":case"top-left":n=i-7;break;case"bottom-right":case"bottom-left":n=7-i;break;case"bottom":n=7-e;break;case"top":n=e-7}switch(t){case"top-right":case"bottom-right":r=-i;break;case"top-left":case"bottom-left":r=i;break;case"left":r=e;break;case"right":r=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":n=i-7;break;case"bottom-right":case"bottom-left":case"bottom":n=7-i}switch(t){case"top-right":case"bottom-right":case"right":r=-e;break;case"top-left":case"bottom-left":case"left":r=e}}return[r,n]}function I_(t,e,i,r,n,o,s,a,l,c,u){t.createArrays(),t.tilePixelRatio=ur/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const h=t.layers[0].layout,d=t.layers[0]._unevaluatedLayout._values,p={};if("composite"===t.textSizeData.kind){const{minZoom:e,maxZoom:i}=t.textSizeData;p.compositeTextSizes=[d["text-size"].possiblyEvaluate(new Ua(e),a),d["text-size"].possiblyEvaluate(new Ua(i),a)]}if("composite"===t.iconSizeData.kind){const{minZoom:e,maxZoom:i}=t.iconSizeData;p.compositeIconSizes=[d["icon-size"].possiblyEvaluate(new Ua(e),a),d["icon-size"].possiblyEvaluate(new Ua(i),a)]}p.layoutTextSize=d["text-size"].possiblyEvaluate(new Ua(l+1),a),p.layoutIconSize=d["icon-size"].possiblyEvaluate(new Ua(l+1),a),p.textMaxSize=d["text-size"].possiblyEvaluate(new Ua(18),a);const f="map"===h.get("text-rotation-alignment")&&"point"!==h.get("symbol-placement"),m=h.get("text-size");let g=!1;for(const e of t.features)if(e.icon&&e.icon.nameSecondary){g=!0;break}for(const o of t.features){const l=h.get("text-font").evaluate(o,{},a).join(","),d=m.evaluate(o,{},a),_=p.layoutTextSize.evaluate(o,{},a),y=(p.layoutIconSize.evaluate(o,{},a),{horizontal:{},vertical:void 0}),v=o.text;let x,b=[0,0];if(v){const r=v.toString(),s=24*h.get("text-letter-spacing").evaluate(o,{},a),c=24*h.get("text-line-height").evaluate(o,{},a),u=ba(r)?s:0,p=h.get("text-anchor").evaluate(o,{},a),m=h.get("text-variable-anchor");if(!m){const t=h.get("text-radial-offset").evaluate(o,{},a);b=t?M_(p,[24*t,S_]):h.get("text-offset").evaluate(o,{},a).map(t=>24*t)}let g=f?"center":h.get("text-justify").evaluate(o,{},a);const x="point"===h.get("symbol-placement"),w=x?24*h.get("text-max-width").evaluate(o,{},a):1/0,T=o=>{t.allowVerticalPlacement&&xa(r)&&(y.vertical=Xg(v,e,i,n,l,w,c,p,o,u,b,Gg.vertical,!0,_,d))};if(!f&&m){const t="auto"===g?m.map(t=>C_(t)):[g];let r=!1;for(let o=0;o<t.length;o++){const s=t[o];if(!y.horizontal[s])if(r)y.horizontal[s]=y.horizontal[0];else{const t=Xg(v,e,i,n,l,w,c,"center",s,u,b,Gg.horizontal,!1,_,d);t&&(y.horizontal[s]=t,r=1===t.positionedLines.length)}}T("left")}else{if("auto"===g&&(g=C_(p)),x||h.get("text-writing-mode").indexOf("horizontal")>=0||!xa(r)){const t=Xg(v,e,i,n,l,w,c,p,g,u,b,Gg.horizontal,!1,_,d);t&&(y.horizontal[g]=t)}T(x?"left":g)}}let w=!1;if(o.icon&&o.icon.namePrimary){const e=r[o.icon.namePrimary];e&&(x=Qg(n[o.icon.namePrimary],o.icon.nameSecondary?n[o.icon.nameSecondary]:void 0,h.get("icon-offset").evaluate(o,{},a),h.get("icon-anchor").evaluate(o,{},a)),w=e.sdf,void 0===t.sdfIcons?t.sdfIcons=e.sdf:t.sdfIcons!==e.sdf&&Y("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(e.pixelRatio!==t.pixelRatio||0!==h.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const T=L_(y.horizontal)||y.vertical;t.iconsInText||(t.iconsInText=!!T&&T.iconsInText),(T||x)&&P_(t,o,y,x,r,p,_,0,b,w,s,a,c,u,g)}o&&t.generateCollisionDebugBuffers(l,t.collisionBoxArray)}function C_(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function P_(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f){let m=o.textMaxSize.evaluate(e,{},h);void 0===m&&(m=s);const g=t.layers[0].layout,_=g.get("icon-offset").evaluate(e,{},h),y=L_(i.horizontal)||i.vertical,v="globe"===d.name,x=s/24,b=t.tilePixelRatio*m/24,w=(R=t.overscaling,t.zoom>18&&R>2&&(R>>=1),Math.max(ur/(512*R),1)*g.get("symbol-spacing")),E=g.get("text-padding")*t.tilePixelRatio,S=g.get("icon-padding")*t.tilePixelRatio,A=T(g.get("text-max-angle")),M="map"===g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement"),I="map"===g.get("icon-rotation-alignment")&&"point"!==g.get("symbol-placement"),C=g.get("symbol-placement"),P=w/2;var R;const O=g.get("icon-text-fit").evaluate(e,{},h),D=g.get("icon-text-fit-padding").evaluate(e,{},h),L="none"!==O;let k;!1===t.hasAnyIconTextFit&&L&&(t.hasAnyIconTextFit=!0),r&&L&&(t.allowVerticalPlacement&&i.vertical&&(k=t_(r,i.vertical,O,D,_,x)),y&&(r=t_(r,y,O,D,_,x)));const B=(s,a,m)=>{if(a.x<0||a.x>=ur||a.y<0||a.y>=ur)return;let g=null;if(v){const{x:t,y:e,z:i}=d.projectTilePoint(a.x,a.y,m);g={anchor:new e_(t,e,i,0,void 0),up:d.upVector(m,a.x,a.y)}}!function(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,x,b,w,T,E,S,A){const M=t.addToLineVertexArray(e,r);let I,C,P,R,O,D,L,k=0,B=0,F=0,z=0,N=-1,U=-1;const G={};let j=cc("");const V=i?i.anchor:e,X="none"!==l.layout.get("icon-text-fit").evaluate(x,{},E);let H=0,q=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[H,q]=l.layout.get("text-offset").evaluate(x,{},E).map(t=>24*t):(H=24*l.layout.get("text-radial-offset").evaluate(x,{},E),q=S_),t.allowVerticalPlacement&&n.vertical){const t=n.vertical;if(f)D=B_(t),a&&(L=B_(a));else{const i=l.layout.get("text-rotate").evaluate(x,{},E)+90;P=k_(c,V,e,u,h,d,t,p,i,m),a&&(R=k_(c,V,e,u,h,d,a,_,i))}}if(o){const r=l.layout.get("icon-rotate").evaluate(x,{},E),n=g_(o,r,w,X),s=a?g_(a,r,w,X):void 0;C=k_(c,V,e,u,h,d,o,_,r),k=4*n.length;const p=t.iconSizeData;let f=null;"source"===p.kind?(f=[Cg*l.layout.get("icon-size").evaluate(x,{},E)],f[0]>O_&&Y(`${t.layerIds[0]}: Value for "icon-size" is >= ${R_}. Reduce your "icon-size".`)):"composite"===p.kind&&(f=[Cg*b.compositeIconSizes[0].evaluate(x,{},E),Cg*b.compositeIconSizes[1].evaluate(x,{},E)],(f[0]>O_||f[1]>O_)&&Y(`${t.layerIds[0]}: Value for "icon-size" is >= ${R_}. Reduce your "icon-size".`)),t.addSymbols(t.icon,n,f,v,y,x,!1,i,e,M.lineStartIndex,M.lineLength,-1,T,E,S,A),N=t.icon.placedSymbolArray.length-1,s&&(B=4*s.length,t.addSymbols(t.icon,s,f,v,y,x,Gg.vertical,i,e,M.lineStartIndex,M.lineLength,-1,T,E,S,A),U=t.icon.placedSymbolArray.length-1)}for(const r in n.horizontal){const o=n.horizontal[r];I||(j=cc(o.text),f?O=B_(o):I=k_(c,V,e,u,h,d,o,p,l.layout.get("text-rotate").evaluate(x,{},E),m));const a=1===o.positionedLines.length;if(F+=D_(t,i,e,o,s,l,f,x,m,M,n.vertical?Gg.horizontal:Gg.horizontalOnly,a?Object.keys(n.horizontal):[r],G,N,b,T,E,S),a)break}n.vertical&&(z+=D_(t,i,e,n.vertical,s,l,f,x,m,M,Gg.vertical,["vertical"],G,U,b,T,E,S));let W=-1;const $=(t,e)=>t?Math.max(t,e):e;W=$(O,W),W=$(D,W),W=$(L,W);const Z=W>-1?1:0;t.glyphOffsetArray.length>=Sy.MAX_GLYPHS&&Y("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,x.sortKey),t.symbolInstances.emplaceBack(e.x,e.y,V.x,V.y,V.z,G.right>=0?G.right:-1,G.center>=0?G.center:-1,G.left>=0?G.left:-1,G.vertical>=0?G.vertical:-1,N,U,j,void 0!==I?I:t.collisionBoxArray.length,void 0!==I?I+1:t.collisionBoxArray.length,void 0!==P?P:t.collisionBoxArray.length,void 0!==P?P+1:t.collisionBoxArray.length,void 0!==C?C:t.collisionBoxArray.length,void 0!==C?C+1:t.collisionBoxArray.length,R||t.collisionBoxArray.length,R?R+1:t.collisionBoxArray.length,u,F,z,k,B,Z,0,H,q,W,0,X?1:0)}(t,a,g,s,i,r,n,k,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,E,M,l,0,S,I,_,e,o,c,u,h,p,f)};if("line"===C)for(const n of l_(e.geometry,0,0,ur,ur)){const e=a_(n,w,A,i.vertical||y,r,24,b,t.overscaling,ur);for(const i of e)y&&F_(t,y.text,P,i)||B(n,i,h)}else if("line-center"===C){for(const t of e.geometry)if(t.length>1){const e=s_(t,A,i.vertical||y,r,24,b);e&&B(t,e,h)}}else if("Polygon"===e.type)for(const t of nm(e.geometry,0)){const e=w_(t,16);B(t[0],new e_(e.x,e.y,0,0,void 0),h)}else if("LineString"===e.type)for(const t of e.geometry)B(t,new e_(t[0].x,t[0].y,0,0,void 0),h);else if("Point"===e.type)for(const t of e.geometry)for(const e of t)B([e],new e_(e.x,e.y,0,0,void 0),h)}const R_=255,O_=R_*Cg;function D_(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,_){const y=function(t,e,i,r,n,o,s,a){const l=[];if(0===e.positionedLines.length)return l;const c=r.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,u=function(t){const e=t[0],i=t[1],r=e*i;return r>0?[e,-i]:r<0?[-e,i]:0===e?[i,e]:[i,-e]}(i);let h=Math.abs(e.top-e.bottom);for(const t of e.positionedLines)h-=t.lineOffset;const d=e.positionedLines.length,p=h/d;let f=e.top-i[1];for(let t=0;t<d;++t){const r=e.positionedLines[t];f=b_(e,p,f,t);for(const t of r.positionedGlyphs){if(!t.rect)continue;const r=t.rect||{};let o=4,h=!0,d=1,p=0;if(t.imageName){const e=s[t.imageName];if(!e)continue;if(e.sdf){Y("SDF images are not supported in formatted text and will be ignored.");continue}h=!1,d=e.pixelRatio,o=1/d}const m=(n||a)&&t.vertical,g=t.metrics.advance*t.scale/2,_=t.metrics,y=t.rect;if(null===y)continue;a&&e.verticalizable&&(p=t.imageName?g-t.metrics.width*t.scale/2:0);const x=n?[t.x+g,t.y]:[0,0];let b=[0,0],w=[0,0],T=!1;n||(m?(w=[t.x+g+u[0],t.y+u[1]-p],T=!0):b=[t.x+g+i[0],t.y+i[1]-p]);const E=y.w*t.scale/(d*(t.localGlyph?2:1)),S=y.h*t.scale/(d*(t.localGlyph?2:1));let A,M,I,C;if(m){const e=t.y-f,i=new v(-g,g-e),r=-Math.PI/2,n=new v(...w);A=new v(-g+b[0],b[1]),A._rotateAround(r,i)._add(n),A.x+=-e+g,A.y-=(_.left-o)*t.scale;const s=t.imageName?_.advance*t.scale:24*t.scale,a=String.fromCodePoint(t.glyph);Bg(a)?A.x+=(1-o)*t.scale:Fg(a)?A.x+=s-_.height*t.scale+(-o-1)*t.scale:A.x+=t.imageName||_.width+2*o===y.w&&_.height+2*o===y.h?(s-S)/2:(s-(_.height+2*o)*t.scale)/2,M=new v(A.x,A.y-E),I=new v(A.x+S,A.y),C=new v(A.x+S,A.y-E)}else{const e=(_.left-o)*t.scale-g+b[0],i=(-_.top-o)*t.scale+b[1],r=e+E,n=i+S;A=new v(e,i),M=new v(r,i),I=new v(e,n),C=new v(r,n)}if(c){let t;t=n?new v(0,0):T?new v(u[0],u[1]):new v(i[0],i[1]),A._rotateAround(c,t),M._rotateAround(c,t),I._rotateAround(c,t),C._rotateAround(c,t)}const P=new v(0,0),R=new v(0,0);l.push({tl:A,tr:M,bl:I,br:C,texPrimary:r,texSecondary:void 0,writingMode:e.writingMode,glyphOffset:x,sectionIndex:t.sectionIndex,isSDF:h,pixelOffsetTL:P,pixelOffsetBR:R,minFontScaleX:0,minFontScaleY:0})}}return l}(0,r,l,o,s,a,n,t.allowVerticalPlacement),x=t.textSizeData;let b=null;"source"===x.kind?(b=[Cg*o.layout.get("text-size").evaluate(a,{},g)],b[0]>O_&&Y(`${t.layerIds[0]}: Value for "text-size" is >= ${R_}. Reduce your "text-size".`)):"composite"===x.kind&&(b=[Cg*f.compositeTextSizes[0].evaluate(a,{},g),Cg*f.compositeTextSizes[1].evaluate(a,{},g)],(b[0]>O_||b[1]>O_)&&Y(`${t.layerIds[0]}: Value for "text-size" is >= ${R_}. Reduce your "text-size".`)),t.addSymbols(t.text,y,b,l,s,a,u,e,i,c.lineStartIndex,c.lineLength,p,m,g,_,!1);for(const e of h)d[e]=t.text.placedSymbolArray.length-1;return 4*y.length}function L_(t){for(const e in t)return t[e];return null}function k_(t,e,i,r,n,o,s,a,l,c){let u=s.top,h=s.bottom,d=s.left,p=s.right;const f=s.collisionPadding;if(f&&(d-=f[0],u-=f[1],p+=f[2],h+=f[3]),l){const t=new v(d,u),e=new v(p,u),i=new v(d,h),r=new v(p,h),n=T(l);let o=new v(0,0);c&&(o=new v(c[0],c[1])),t._rotateAround(n,o),e._rotateAround(n,o),i._rotateAround(n,o),r._rotateAround(n,o),d=Math.min(t.x,e.x,i.x,r.x),p=Math.max(t.x,e.x,i.x,r.x),u=Math.min(t.y,e.y,i.y,r.y),h=Math.max(t.y,e.y,i.y,r.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,d,u,p,h,a,r,n,o),t.length-1}function B_(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function F_(t,e,i,r){const n=t.compareText;if(e in n){const t=n[e];for(let e=t.length-1;e>=0;e--)if(r.dist(t[e])<i)return!0}else n[e]=[];return n[e].push(r),!1}function z_(t,e){const i=t.fovAboveCenter,r=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,n=(t._camera.position[2]*t.worldSize-r)/Math.cos(t._pitch),o=Math.sin(i)*n/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),s=Math.sin(t._pitch)*o+n;return Math.min(1.01*s,n*(1/t._horizonShift))}function N_(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),r=t.x*i,n=(t.x+1)*i,o=t.y*i,s=(t.y+1)*i,a=xp(r),l=xp(n),c=bp(o),u=bp(s),h=e.project(a,c),d=e.project(l,c),p=e.project(l,u),f=e.project(a,u);let m=Math.min(h.x,d.x,p.x,f.x),g=Math.min(h.y,d.y,p.y,f.y),_=Math.max(h.x,d.x,p.x,f.x),y=Math.max(h.y,d.y,p.y,f.y);const v=i/16;function x(t,i,r,n,o,s){const a=(r+o)/2,l=(n+s)/2,c=e.project(xp(a),bp(l)),u=Math.max(0,m-c.x,g-c.y,c.x-_,c.y-y);m=Math.min(m,c.x),_=Math.max(_,c.x),g=Math.min(g,c.y),y=Math.max(y,c.y),u>v&&(x(t,c,r,n,a,l),x(c,i,a,l,o,s))}x(h,d,r,o,n,o),x(d,p,n,o,n,s),x(p,f,n,s,r,s),x(f,h,r,s,r,o),m-=v,g-=v,_+=v,y+=v;const b=1/Math.max(_-m,y-g);return{scale:b,x:m*b,y:g*b,x2:_*b,y2:y*b,projection:e}}function U_(t,e,i,r,n,o,s,a,l){if("globe"===l.name)return Ud(t,e,new fd(i,r,n),!1);const c=N_({z:i,x:r,y:n},l);return new Ad([(o+c.x/c.scale)*e,e*(c.y/c.scale),s],[(o+c.x2/c.scale)*e,e*(c.y2/c.scale),a])}function G_(t,{x:e,y:i},r=0){return new v(((e-r)*t.scale-t.x)*ur,(i*t.scale-t.y)*ur)}function j_(t,e,i=0){return nd.fromValues(((e.x-i)*t.scale-t.x)*ur,(e.y*t.scale-t.y)*ur,wp(e.z,e.y))}const V_=Jh.identity(new Float32Array(16));class X_{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,e){return{x:0,y:0,z:0}}unproject(t,e){return new mp(0,0)}projectTilePoint(t,e,i){return{x:t,y:e,z:0}}locationPoint(t,e,i=!0){return t._coordinatePoint(t.locationCoordinate(e),i)}pixelsPerMeter(t,e){return vp(1,t)*e}pixelSpaceConversion(t,e,i){return 1}farthestPixelDistance(t){return z_(t,t.pixelsPerMeter)}pointCoordinate(t,e,i,r){const n=t.horizonLineFromTop(!1),o=new v(e,Math.max(n,i));return t.rayIntersectionCoordinate(t.pointRayIntersection(o,r))}pointCoordinate3D(t,e,i){const r=new v(e,i);if(t.elevation)return t.elevation.pointCoordinate(r);{const e=this.pointCoordinate(t,r.x,r.y,0);return[e.x,e.y,e.z]}}isPointAboveHorizon(t,e){if(t.elevation)return!this.pointCoordinate3D(t,e.x,e.y);const i=t.horizonLineFromTop();return e.y<i}createInversionMatrix(t,e){return V_}createTileMatrix(t,e,i){let r,n,o;const s=i.canonical,a=Jh.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const l=N_(s,this);r=1,n=l.x+i.wrap*l.scale,o=l.y,Jh.scale(a,a,[r/l.scale,r/l.scale,t.pixelsPerMeter/e])}else r=e/t.zoomScale(s.z),n=(s.x+Math.pow(2,s.z)*i.wrap)*r,o=s.y*r;return Jh.translate(a,a,[n,o,0]),Jh.scale(a,a,[r/ur,r/ur,1]),a}upVector(t,e,i){return[0,0,1]}upVectorScale(t,e,i){return{metersToTile:1}}}class H_ extends X_{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[e,i]=this.parallels=t.parallels||[29.5,45.5],r=Math.sin(T(e));this.n=(r+Math.sin(T(i)))/2,this.c=1+r*(2*this.n-r),this.r0=Math.sqrt(this.c)/this.n}project(t,e){const{n:i,c:r,r0:n}=this,o=T(t-this.center[0]),s=T(e),a=Math.sqrt(r-2*i*Math.sin(s))/i;return{x:a*Math.sin(o*i),y:a*Math.cos(o*i)-n,z:0}}unproject(t,e){const{n:i,c:r,r0:n}=this,o=n+e;let s=Math.atan2(t,Math.abs(o))*Math.sign(o);o*i<0&&(s-=Math.PI*Math.sign(t)*Math.sign(o));const a=T(this.center[0])*i;s=D(s,-Math.PI-a,Math.PI-a);const l=R(E(s/i)+this.center[0],-180,180),c=Math.asin(R((r-(t*t+o*o)*i*i)/(2*i),-1,1)),u=R(E(c),-Tp,Tp);return new mp(l,u)}}const q_=1.340264,W_=-.081106,$_=893e-6,Y_=.003796,Z_=Math.sqrt(3)/2;class K_ extends X_{project(t,e){e=e/180*Math.PI,t=t/180*Math.PI;const i=Math.asin(Z_*Math.sin(e)),r=i*i,n=r*r*r;return{x:.5*(t*Math.cos(i)/(Z_*(q_+3*W_*r+n*(7*$_+9*Y_*r)))/Math.PI+.5),y:1-.5*(i*(q_+W_*r+n*($_+Y_*r))/Math.PI+1),z:0}}unproject(t,e){t=(2*t-.5)*Math.PI;let i=e=(2*(1-e)-1)*Math.PI,r=i*i,n=r*r*r;for(let t,o,s,a=0;a<12&&(o=i*(q_+W_*r+n*($_+Y_*r))-e,s=q_+3*W_*r+n*(7*$_+9*Y_*r),t=o/s,i=R(i-t,-Math.PI/3,Math.PI/3),r=i*i,n=r*r*r,!(Math.abs(t)<1e-12));++a);const o=Z_*t*(q_+3*W_*r+n*(7*$_+9*Y_*r))/Math.cos(i),s=Math.asin(Math.sin(i)/Z_),a=R(180*o/Math.PI,-180,180),l=R(180*s/Math.PI,-Tp,Tp);return new mp(a,l)}}class J_ extends X_{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,e){return{x:.5+t/360,y:.5-e/360,z:0}}unproject(t,e){const i=360*(t-.5),r=R(360*(.5-e),-Tp,Tp);return new mp(i,r)}}const Q_=Math.PI/2;function ty(t){return Math.tan((Q_+t)/2)}class ey extends X_{constructor(t){super(t),this.center=t.center||[0,30];const[e,i]=this.parallels=t.parallels||[30,30];let r=T(e),n=T(i);this.southernCenter=r+n<0,this.southernCenter&&(r=-r,n=-n);const o=Math.cos(r),s=ty(r);this.n=r===n?Math.sin(r):Math.log(o/Math.cos(n))/Math.log(ty(n)/s),this.f=o*Math.pow(ty(r),this.n)/this.n}project(t,e){e=T(e),this.southernCenter&&(e=-e),t=T(t-this.center[0]);const i=1e-6,{n:r,f:n}=this;n>0?e<-Q_+i&&(e=-Q_+i):e>Q_-i&&(e=Q_-i);const o=n/Math.pow(ty(e),r);let s=o*Math.sin(r*t),a=n-o*Math.cos(r*t);return s=.5*(s/Math.PI+.5),a=.5*(a/Math.PI+.5),{x:s,y:this.southernCenter?a:1-a,z:0}}unproject(t,e){t=(2*t-.5)*Math.PI,this.southernCenter&&(e=1-e),e=(2*(1-e)-.5)*Math.PI;const{n:i,f:r}=this,n=r-e,o=Math.sign(n),s=Math.sign(i)*Math.sqrt(t*t+n*n);let a=Math.atan2(t,Math.abs(n))*o;n*i<0&&(a-=Math.PI*Math.sign(t)*o);const l=R(E(a/i)+this.center[0],-180,180),c=R(E(2*Math.atan(Math.pow(r/s,1/i))-Q_),-Tp,Tp);return new mp(l,this.southernCenter?-c:c)}}class iy extends X_{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,e){return{x:_p(t),y:yp(e),z:0}}unproject(t,e){const i=xp(t),r=bp(e);return new mp(i,r)}}const ry=T(Tp);class ny extends X_{project(t,e){const i=(e=T(e))*e,r=i*i;return{x:.5*((t=T(t))*(.8707-.131979*i+r*(r*(.003971*i-.001529*r)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+i*(.015085+r*(.028874*i-.044475-.005916*r)))/Math.PI+1),z:0}}unproject(t,e){t=(2*t-.5)*Math.PI;let i=e=(2*(1-e)-1)*Math.PI,r=25,n=0,o=i*i;do{o=i*i;const t=o*o;n=(i*(1.007226+o*(.015085+t*(.028874*o-.044475-.005916*t)))-e)/(1.007226+o*(.045255+t*(.259866*o-.311325-.005916*11*t))),i=R(i-n,-ry,ry)}while(Math.abs(n)>1e-6&&--r>0);o=i*i;const s=R(E(t/(.8707+o*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979))),-180,180),a=E(i);return new mp(s,a)}}const oy=T(Tp);class sy extends X_{project(t,e){e=T(e),t=T(t);const i=Math.cos(e),r=2/Math.PI,n=Math.acos(i*Math.cos(t/2)),o=Math.sin(n)/n,s=.5*(t*r+2*i*Math.sin(t/2)/o)||0,a=.5*(e+Math.sin(e)/o)||0;return{x:.5*(s/Math.PI+.5),y:1-.5*(a/Math.PI+1),z:0}}unproject(t,e){let i=t=(2*t-.5)*Math.PI,r=e=(2*(1-e)-1)*Math.PI,n=25;const o=1e-6;let s=0,a=0;do{const n=Math.cos(r),o=Math.sin(r),l=2*o*n,c=o*o,u=n*n,h=Math.cos(i/2),d=Math.sin(i/2),p=2*h*d,f=d*d,m=1-u*h*h,g=m?1/m:0,_=m?Math.acos(n*h)*Math.sqrt(1/m):0,y=.5*(2*_*n*d+2*i/Math.PI)-t,v=.5*(_*o+r)-e,x=.5*g*(u*f+_*n*h*c)+1/Math.PI,b=g*(p*l/4-_*o*d),w=.125*g*(l*d-_*o*u*p),T=.5*g*(c*h+_*f*n)+.5,E=b*w-T*x;s=(v*b-y*T)/E,a=(y*w-v*x)/E,i=R(i-s,-Math.PI,Math.PI),r=R(r-a,-oy,oy)}while((Math.abs(s)>o||Math.abs(a)>o)&&--n>0);return new mp(E(i),E(r))}}class ay extends X_{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(T(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,e){const{scale:i,cosPhi:r}=this;return{x:T(t)*r*i+.5,y:-Math.sin(T(e))/r*i+.5,z:0}}unproject(t,e){const{scale:i,cosPhi:r}=this,n=-(e-.5)/i,o=R(E((t-.5)/i)/r,-180,180),s=Math.asin(R(n*r,-1,1)),a=R(E(s),-Tp,Tp);return new mp(o,a)}}class ly extends iy{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,e,i){const r=Hd(t,e,i),n=$d(Bd(i));return nd.transformMat4(r,r,n),{x:r[0],y:r[1],z:r[2]}}locationPoint(t,e){const i=Xd(e.lat,e.lng),r=nd.normalize([],i),n=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(e),t._centerAltitude):t._centerAltitude,o=vp(1,0)*ur*n;nd.scaleAndAdd(i,i,r,o);const s=Jh.identity(new Float64Array(16));return Jh.multiply(s,t.pixelMatrix,t.globeMatrix),nd.transformMat4(i,i,s),new v(i[0],i[1])}pixelsPerMeter(t,e){return vp(1,0)*e}pixelSpaceConversion(t,e,i){const r=vp(1,t)*e,n=Yr(vp(1,45)*e,r,i);return this.pixelsPerMeter(t,e)/n}createTileMatrix(t,e,i){const r=Yd(Bd(i.canonical));return Jh.multiply(new Float64Array(16),t.globeMatrix,r)}createInversionMatrix(t,e){const{center:i}=t,r=$d(Bd(e));return Jh.rotateY(r,r,T(i.lng)),Jh.rotateX(r,r,T(i.lat)),Jh.scale(r,r,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(r)}pointCoordinate(t,e,i,r){return Dd(t,e,i,!0)||new Ip(0,0)}pointCoordinate3D(t,e,i){const r=this.pointCoordinate(t,e,i,0);return[r.x,r.y,r.z]}isPointAboveHorizon(t,e){return!Dd(t,e.x,e.y,!1)}farthestPixelDistance(t){const e=function(t,e){const i=t.cameraToCenterDistance,r=t._centerAltitude*e,n=t._camera,o=t._camera.forward(),s=nd.add([],nd.scale([],o,-i),[0,0,r]),a=t.worldSize/(2*Math.PI),l=[0,0,-a],c=t.width/t.height,u=Math.tan(t.fovAboveCenter),h=nd.scale([],n.up(),u),d=nd.scale([],n.right(),u*c),p=nd.normalize([],nd.add([],nd.add([],o,h),d)),f=[];let m;if(new vd(s,p).closestPointOnSphere(l,a,f)){const e=nd.add([],f,l),i=nd.sub([],e,s);m=Math.cos(t.fovAboveCenter)*nd.length(i)}else{const t=nd.sub([],s,l),e=nd.sub([],l,s);nd.normalize(e,e);const i=nd.length(t)-a;m=Math.sqrt(i*(i+2*a));const r=Math.acos(m/(a+i))-Math.acos(nd.dot(o,e));m*=Math.cos(r)}return 1.01*m}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),i=tp(t.zoom);if(i>0){const r=z_(t,vp(1,t.center.lat)*t.worldSize),n=t.worldSize/(2*Math.PI),o=Math.max(t.width,t.height)/t.worldSize*Math.PI;return Yr(e,r+n*(1-Math.cos(o)),Math.pow(i,10))}return e}upVector(t,e,i){return Hd(e,i,t,1)}upVectorScale(t){return{metersToTile:Od(qd(Bd(t)))}}}function cy(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new iy(t);case"equirectangular":return new J_(t);case"naturalEarth":return new ny(t);case"equalEarth":return new K_(t);case"winkelTripel":return new sy(t);case"albers":return i?new ay(t):new H_(t);case"lambertConformalConic":return i?new ay(t):new ey(t);case"globe":return new ly(t)}throw new Error("Invalid projection name: "+t.name)}const uy=new Ja({"symbol-placement":new Ya(Oe.layout_symbol["symbol-placement"]),"symbol-spacing":new Ya(Oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ya(Oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Za(Oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ya(Oe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Ya(Oe.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Ya(Oe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ya(Oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ya(Oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ya(Oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Za(Oe.layout_symbol["icon-size"]),"icon-text-fit":new Za(Oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Za(Oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Za(Oe.layout_symbol["icon-image"]),"icon-rotate":new Za(Oe.layout_symbol["icon-rotate"]),"icon-padding":new Ya(Oe.layout_symbol["icon-padding"]),"icon-keep-upright":new Ya(Oe.layout_symbol["icon-keep-upright"]),"icon-offset":new Za(Oe.layout_symbol["icon-offset"]),"icon-anchor":new Za(Oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ya(Oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ya(Oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ya(Oe.layout_symbol["text-rotation-alignment"]),"text-field":new Za(Oe.layout_symbol["text-field"]),"text-font":new Za(Oe.layout_symbol["text-font"]),"text-size":new Za(Oe.layout_symbol["text-size"]),"text-max-width":new Za(Oe.layout_symbol["text-max-width"]),"text-line-height":new Za(Oe.layout_symbol["text-line-height"]),"text-letter-spacing":new Za(Oe.layout_symbol["text-letter-spacing"]),"text-justify":new Za(Oe.layout_symbol["text-justify"]),"text-radial-offset":new Za(Oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ya(Oe.layout_symbol["text-variable-anchor"]),"text-anchor":new Za(Oe.layout_symbol["text-anchor"]),"text-max-angle":new Ya(Oe.layout_symbol["text-max-angle"]),"text-writing-mode":new Ya(Oe.layout_symbol["text-writing-mode"]),"text-rotate":new Za(Oe.layout_symbol["text-rotate"]),"text-padding":new Ya(Oe.layout_symbol["text-padding"]),"text-keep-upright":new Ya(Oe.layout_symbol["text-keep-upright"]),"text-transform":new Za(Oe.layout_symbol["text-transform"]),"text-offset":new Za(Oe.layout_symbol["text-offset"]),"text-allow-overlap":new Ya(Oe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ya(Oe.layout_symbol["text-ignore-placement"]),"text-optional":new Ya(Oe.layout_symbol["text-optional"]),visibility:new Ya(Oe.layout_symbol.visibility)});var hy={paint:new Ja({"icon-opacity":new Za(Oe.paint_symbol["icon-opacity"]),"icon-emissive-strength":new Za(Oe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Za(Oe.paint_symbol["text-emissive-strength"]),"icon-color":new Za(Oe.paint_symbol["icon-color"]),"icon-halo-color":new Za(Oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Za(Oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Za(Oe.paint_symbol["icon-halo-blur"]),"icon-translate":new Ya(Oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ya(Oe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Za(Oe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Za(Oe.paint_symbol["text-opacity"]),"text-color":new Za(Oe.paint_symbol["text-color"],{runtimeType:qe,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Za(Oe.paint_symbol["text-halo-color"]),"text-halo-width":new Za(Oe.paint_symbol["text-halo-width"]),"text-halo-blur":new Za(Oe.paint_symbol["text-halo-blur"]),"text-translate":new Ya(Oe.paint_symbol["text-translate"]),"text-translate-anchor":new Ya(Oe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Ya(Oe.paint_symbol["icon-color-saturation"])}),layout:uy};class dy{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:je,this.defaultValue=t}evaluate(t){if(t.formattedSection){const e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}xs(dy,"FormatSectionOverride",{omit:["defaultValue"]});class py extends rl{constructor(t,e){super(t,hy,e)}recalculate(t,e){super.recalculate(t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const i=this.layout.get("text-writing-mode");if(i){const t=[];for(const e of i)t.indexOf(e)<0&&t.push(e);this.layout._values["text-writing-mode"]=t}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,e,i,r){const n=this.layout.get(t).evaluate(e,{},i,r),o=this._unevaluatedLayout._values[t];return o.isDataDriven()||go(o.value)||!n?n:function(t,e){return e.replace(/{([^{}]+)}/g,(e,i)=>i in t?String(t[i]):"")}(e.properties,n)}createBucket(t){return new Sy(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of hy.paint.overridableProperties){if(!py.hasPaintOverride(this.layout,t))continue;const e=this.paint.get(t),i=new dy(e),r=new mo(i,e.property.specification);let n=null;n="constant"===e.value.kind||"source"===e.value.kind?new yo("source",r):new vo("composite",r,e.value.zoomStops,e.value._interpolationType),this.paint._values[t]=new Wa(e.property,n,e.parameters)}}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven())&&py.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,e){const i=t.get("text-field"),r=hy.paint.properties[e];let n=!1;const o=t=>{for(const e of t)if(r.overrides&&r.overrides.hasOverride(e))return void(n=!0)};if("constant"===i.value.kind&&i.value.value instanceof fi)o(i.value.value.sections);else if("source"===i.value.kind){const t=e=>{n||(e instanceof bi&&yi(e.value)===Ze?o(e.value.sections):e instanceof Ai?o(e.sections):e.eachChild(t))},e=i.value;e._styleExpression&&t(e._styleExpression.expression)}return n}getProgramIds(){const t=0!==this.paint.get("icon-opacity").constantOr(1),e=0!==this.paint.get("text-opacity").constantOr(1),i=[];return t&&i.push("symbolIcon"),e&&i.push("symbolSDF"),i}getDefaultProgramParams(t,e){return{config:new Oc(this,e),overrideFog:!1}}}const fy=Pm.types,my=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function gy(t,e,i,r,n,o,s,a,l,c,u,h,d){const p=a?Math.min(O_,Math.round(a[0])):0,f=a?Math.min(O_,Math.round(a[1])):0;t.emplaceBack(e,i,Math.round(32*r),Math.round(32*n),o,s,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function _y(t,e,i){t.emplaceBack(e,i)}function yy(t,e,i,r,n,o,s){t.emplaceBack(e,i,r,n,o,s)}function vy(t,e,i,r,n){const o=5*e+2;t.float32[o+0]=i,t.float32[o+1]=r,t.float32[o+2]=n}function xy(t,e,i,r,n){t.emplaceBack(e,i,r,n),t.emplaceBack(e,i,r,n),t.emplaceBack(e,i,r,n),t.emplaceBack(e,i,r,n)}function by(t){for(const e of t.sections)if(Ma(e.text))return!0;return!1}class wy{constructor(t){this.layoutVertexArray=new vl,this.indexArray=new Ml,this.programConfigurations=t,this.segments=new Ql,this.dynamicLayoutVertexArray=new ml,this.opacityVertexArray=new bl,this.placedSymbolArray=new Vl,this.iconTransitioningVertexArray=new wl,this.globeExtVertexArray=new xl,this.zOffsetVertexArray=new Pl}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(t,e,i,r,n){this.isEmpty()||(i&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,xg.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,wg.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,my,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,Eg.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,bg.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||n)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,Tg.members,!0)),this.opacityVertexBuffer.itemSize=1),(i||r)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}xs(wy,"SymbolBuffers");class Ty{constructor(t,e,i){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new i,this.segments=new Ql,this.collisionVertexArray=new Al,this.collisionVertexArrayExt=new ml}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Sg.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,Ag.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}xs(Ty,"CollisionBuffers");class Ey{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Jh.identity([]),this.placementViewportMatrix=Jh.identity([]);const e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Pg(this.zoom,e["text-size"]),this.iconSizeData=Pg(this.zoom,e["icon-size"]);const i=this.layers[0].layout,r=i.get("symbol-sort-key"),n=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==n&&void 0!==r.constantOr(1),this.sortFeaturesByY=("viewport-y"===n||"auto"===n&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=i.get("text-writing-mode").map(t=>Gg[t]),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=i.get("symbol-z-elevate")}createArrays(){this.text=new wy(new Dc(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new wy(new Dc(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new ql,this.lineVertexArray=new Wl,this.symbolInstances=new Hl}calculateGlyphDependencies(t,e,i,r,n){for(let i=0;i<t.length;i++){const o=t.codePointAt(i);if(void 0===o)break;if(e[o]=!0,r&&n&&o<=65535){const r=kg[t.charAt(i)];r&&(e[r.charCodeAt(0)]=!0)}}}populate(t,e,i,r){const n=this.layers[0],o=n.layout,s="globe"===this.projection.name,a=o.get("text-font"),l=o.get("text-field"),c=o.get("icon-image"),u=("constant"!==l.value.kind||l.value.value instanceof fi&&!l.value.value.isEmpty()||l.value.value.toString().length>0)&&("constant"!==a.value.kind||a.value.value.length>0),h="constant"!==c.value.kind||!!c.value.value||Object.keys(c.parameters).length>0,d=o.get("symbol-sort-key");if(this.features=[],!u&&!h)return;const p=e.iconDependencies,f=e.glyphDependencies,m=e.availableImages,g=new Ua(this.zoom);for(const{feature:e,id:l,index:c,sourceLayerIndex:_}of t){const t=n._featureFilter.needGeometry,y=Fp(e,t);if(!n._featureFilter.filter(g,y,i))continue;if(t||(y.geometry=Bp(e,i,r)),s&&1!==e.type&&i.z<=5){const t=y.geometry,e=.98078528056,r=(t,r)=>{const n=Hd(t.x,t.y,i,1),o=Hd(r.x,r.y,i,1);return nd.dot(n,o)<e};for(let e=0;e<t.length;e++)t[e]=Op(t[e],r)}let v,x;if(u){const t=n.getValueAndResolveTokens("text-field",y,i,m),e=fi.factory(t);by(e)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Fa()||this.hasRTLText&&Na.isParsed())&&(v=Lg(e,n,y))}if(h){const t=n.getValueAndResolveTokens("icon-image",y,i,m);x=t instanceof mi?t:mi.fromString(t)}if(!v&&!x)continue;const b=this.sortFeaturesByKey?d.evaluate(y,{},i):void 0;if(this.features.push({id:l,text:v,icon:x,index:c,sourceLayerIndex:_,geometry:y.geometry,properties:e.properties,type:fy[e.type],sortKey:b}),x&&(p[x.namePrimary]=!0,x.nameSecondary&&(p[x.nameSecondary]=!0)),v){const t=a.evaluate(y,{},i).join(","),e="map"===o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Gg.vertical)>=0;for(const i of v.sections)if(i.image)p[i.image.namePrimary]=!0;else{const r=xa(v.toString()),n=i.fontStack||t,o=f[n]=f[n]||{};this.calculateGlyphDependencies(i.text,o,e,this.allowVerticalPlacement,r)}}}"line"===o.get("symbol-placement")&&(this.features=function(t){const e={},i={},r=[];let n=0;function o(e){r.push(t[e]),n++}function s(t,e,n){const o=i[t];return delete i[t],i[e]=o,r[o].geometry[0].pop(),r[o].geometry[0]=r[o].geometry[0].concat(n[0]),o}function a(t,i,n){const o=e[i];return delete e[i],e[t]=o,r[o].geometry[0].shift(),r[o].geometry[0]=n[0].concat(r[o].geometry[0]),o}function l(t,e,i){const r=i?e[0][e[0].length-1]:e[0][0];return`${t}:${r.x}:${r.y}`}for(let c=0;c<t.length;c++){const u=t[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){o(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in i&&f in e&&i[p]!==e[f]){const t=a(p,f,h),n=s(p,f,r[t].geometry);delete e[p],delete i[f],i[l(d,r[n].geometry,!0)]=n,r[t].geometry=null}else p in i?s(p,f,h):f in e?a(p,f,h):(o(c),e[p]=n-1,i[f]=n-1)}return r.filter(t=>t.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((t,e)=>t.sortKey-e.sortKey)}update(t,e,i,r,n){const o=0!==Object.keys(t).length;if(o&&!this.stateDependentLayers.length)return;const s=o?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(t,e,s,i,r,n),this.icon.programConfigurations.updatePaintArrays(t,e,s,i,r,n)}updateZOffset(){const t=(t,e,r)=>{i+=e,i>t.length&&t.resize(i);for(let n=-e;n<0;n++)t.emplace(n+i,r)},e=(t,e,i)=>{r+=e,r>t.length&&t.resize(r);for(let n=-e;n<0;n++)t.emplace(n+r,i)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let i=0,r=0;for(let i=0;i<this.symbolInstances.length;i++){const r=this.symbolInstances.get(i),{numHorizontalGlyphVertices:n,numVerticalGlyphVertices:o,numIconVertices:s}=r,a=r.zOffset,l=s>0;if((n>0||o>0)&&(t(this.text.zOffsetVertexArray,n,a),t(this.text.zOffsetVertexArray,o,a)),l){const{placedIconSymbolIndex:t,verticalPlacedIconSymbolIndex:i}=r;t>=0&&e(this.icon.zOffsetVertexArray,s,a),i>=0&&e(this.icon.zOffsetVertexArray,r.numVerticalIconVertices,a)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=cy(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,e){const i=this.lineVertexArray.length;if(void 0!==t.segment)for(const{x:t,y:i}of e)this.lineVertexArray.emplaceBack(t,i);return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,m){const g=t.indexArray,_=t.layoutVertexArray,y=t.globeExtVertexArray,v=t.segments.prepareSegment(4*e.length,_,g,this.canOverlap?o.sortKey:void 0),x=this.glyphOffsetArray.length,b=v.vertexLength,w=this.allowVerticalPlacement&&s===Gg.vertical?Math.PI/2:0,T=o.text&&o.text.sections;for(let r=0;r<e.length;r++){const{tl:n,tr:s,bl:c,br:u,texPrimary:h,texSecondary:x,pixelOffsetTL:b,pixelOffsetBR:E,minFontScaleX:S,minFontScaleY:A,glyphOffset:M,isSDF:I,sectionIndex:C}=e[r],P=v.vertexLength,R=M[1];if(gy(_,l.x,l.y,n.x,R+n.y,h.x,h.y,i,I,b.x,b.y,S,A),gy(_,l.x,l.y,s.x,R+s.y,h.x+h.w,h.y,i,I,E.x,b.y,S,A),gy(_,l.x,l.y,c.x,R+c.y,h.x,h.y+h.h,i,I,b.x,E.y,S,A),gy(_,l.x,l.y,u.x,R+u.y,h.x+h.w,h.y+h.h,i,I,E.x,E.y,S,A),a){const{x:e,y:i,z:r}=a.anchor,[n,o,s]=a.up;yy(y,e,i,r,n,o,s),yy(y,e,i,r,n,o,s),yy(y,e,i,r,n,o,s),yy(y,e,i,r,n,o,s),xy(t.dynamicLayoutVertexArray,e,i,r,w)}else xy(t.dynamicLayoutVertexArray,l.x,l.y,l.z,w);if(m){const e=x||h;_y(t.iconTransitioningVertexArray,e.x,e.y),_y(t.iconTransitioningVertexArray,e.x+e.w,e.y),_y(t.iconTransitioningVertexArray,e.x,e.y+e.h),_y(t.iconTransitioningVertexArray,e.x+e.w,e.y+e.h)}g.emplaceBack(P,P+1,P+2),g.emplaceBack(P+1,P+2,P+3),v.vertexLength+=4,v.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(M[0]),r!==e.length-1&&C===e[r+1].sectionIndex||t.programConfigurations.populatePaintArrays(_.length,o,o.index,{},d,p,f,T&&T[C])}const E=a?a.anchor:l;t.placedSymbolArray.emplaceBack(E.x,E.y,E.z,l.x,l.y,x,this.glyphOffsetArray.length-x,b,c,u,l.segment,i?i[0]:0,i?i[1]:0,r[0],r[1],s,0,!1,0,h,0)}_commitLayoutVertex(t,e,i,r,n,o,s){t.emplaceBack(e,i,r,n,o,Math.round(s.x),Math.round(s.y))}_addCollisionDebugVertices(t,e,i,r,n,o,s){const a=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),l=a.vertexLength,c=s.tileAnchorX,u=s.tileAnchorY;for(let t=0;t<4;t++)i.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(i.collisionVertexArrayExt,e,t.padding,s.zOffset),this._commitLayoutVertex(i.layoutVertexArray,r,n,o,c,u,new v(t.x1,t.y1)),this._commitLayoutVertex(i.layoutVertexArray,r,n,o,c,u,new v(t.x2,t.y1)),this._commitLayoutVertex(i.layoutVertexArray,r,n,o,c,u,new v(t.x2,t.y2)),this._commitLayoutVertex(i.layoutVertexArray,r,n,o,c,u,new v(t.x1,t.y2)),a.vertexLength+=4;const h=i.indexArray;h.emplaceBack(l,l+1),h.emplaceBack(l+1,l+2),h.emplaceBack(l+2,l+3),h.emplaceBack(l+3,l),a.primitiveLength+=4}_addTextDebugCollisionBoxes(t,e,i,r,n,o){for(let s=r;s<n;s++){const r=i.get(s),n=this.getSymbolInstanceTextSize(t,o,e,s);this._addCollisionDebugVertices(r,n,this.textCollisionBox,r.projectedAnchorX,r.projectedAnchorY,r.projectedAnchorZ,o)}}_addIconDebugCollisionBoxes(t,e,i,r,n,o){for(let s=r;s<n;s++){const r=i.get(s),n=this.getSymbolInstanceIconSize(t,e,o.placedIconSymbolIndex);this._addCollisionDebugVertices(r,n,this.iconCollisionBox,r.projectedAnchorX,r.projectedAnchorY,r.projectedAnchorZ,o)}}generateCollisionDebugBuffers(t,e){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ty(El,Mg.members,wl),this.iconCollisionBox=new Ty(El,Mg.members,wl);const i=Og(this.iconSizeData,t),r=Og(this.textSizeData,t);for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this._addTextDebugCollisionBoxes(r,t,e,o.textBoxStartIndex,o.textBoxEndIndex,o),this._addTextDebugCollisionBoxes(r,t,e,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._addIconDebugCollisionBoxes(i,t,e,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._addIconDebugCollisionBoxes(i,t,e,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}}getSymbolInstanceTextSize(t,e,i,r){const n=this.text.placedSymbolArray.get(e.rightJustifiedTextSymbolIndex>=0?e.rightJustifiedTextSymbolIndex:e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.leftJustifiedTextSymbolIndex>=0?e.leftJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex>=0?e.verticalPlacedTextSymbolIndex:r),o=Rg(this.textSizeData,t,n)/24;return this.tilePixelRatio*o}getSymbolInstanceIconSize(t,e,i){const r=this.icon.placedSymbolArray.get(i),n=Rg(this.iconSizeData,t,r);return this.tilePixelRatio*n}_commitDebugCollisionVertexUpdate(t,e,i,r){t.emplaceBack(e,-i,-i,r),t.emplaceBack(e,i,-i,r),t.emplaceBack(e,i,i,r),t.emplaceBack(e,-i,i,r)}_updateTextDebugCollisionBoxes(t,e,i,r,n,o){for(let s=r;s<n;s++){const r=i.get(s),n=this.getSymbolInstanceTextSize(t,o,e,s);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,n,r.padding,o.zOffset)}}_updateIconDebugCollisionBoxes(t,e,i,r,n,o){for(let s=r;s<n;s++){const r=i.get(s),n=this.getSymbolInstanceIconSize(t,e,o.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,n,r.padding,o.zOffset)}}updateCollisionDebugBuffers(t,e){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const i=Og(this.iconSizeData,t),r=Og(this.textSizeData,t);for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this._updateTextDebugCollisionBoxes(r,t,e,o.textBoxStartIndex,o.textBoxEndIndex,o),this._updateTextDebugCollisionBoxes(r,t,e,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._updateIconDebugCollisionBoxes(i,t,e,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._updateIconDebugCollisionBoxes(i,t,e,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,e,i,r,n,o,s,a,l){const c={};if(e<i){const{x1:i,y1:r,x2:n,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=t.get(e);c.textBox={x1:i,y1:r,x2:n,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.textFeatureIndex=p}if(r<n){const{x1:e,y1:i,x2:n,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=t.get(r);c.verticalTextBox={x1:e,y1:i,x2:n,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalTextFeatureIndex=p}if(o<s){const{x1:e,y1:i,x2:r,y2:n,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=t.get(o);c.iconBox={x1:e,y1:i,x2:r,y2:n,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.iconFeatureIndex=p}if(a<l){const{x1:e,y1:i,x2:r,y2:n,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=t.get(a);c.verticalIconBox={x1:e,y1:i,x2:r,y2:n,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalIconFeatureIndex=p}return c}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){const i=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,e){const i=t.placedSymbolArray.get(e),r=i.vertexStartIndex+4*i.numGlyphs;for(let e=i.vertexStartIndex;e<r;e+=4)t.indexArray.emplaceBack(e,e+1,e+2),t.indexArray.emplaceBack(e+1,e+2,e+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const e=Math.sin(t),i=Math.cos(t),r=[],n=[],o=[];for(let t=0;t<this.symbolInstances.length;++t){o.push(t);const s=this.symbolInstances.get(t);r.push(0|Math.round(e*s.tileAnchorX+i*s.tileAnchorY)),n.push(s.featureIndex)}return o.sort((t,e)=>r[t]-r[e]||n[e]-n[t]),o}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,e)=>this.symbolInstances.get(e).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,e){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===e?i.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const e=this.symbolInstances.get(t);this.featureSortOrder.push(e.featureIndex);const{rightJustifiedTextSymbolIndex:i,centerJustifiedTextSymbolIndex:r,leftJustifiedTextSymbolIndex:n,verticalPlacedTextSymbolIndex:o,placedIconSymbolIndex:s,verticalPlacedIconSymbolIndex:a}=e;i>=0&&this.addIndicesForPlacedSymbol(this.text,i),r>=0&&r!==i&&this.addIndicesForPlacedSymbol(this.text,r),n>=0&&n!==r&&n!==i&&this.addIndicesForPlacedSymbol(this.text,n),o>=0&&this.addIndicesForPlacedSymbol(this.text,o),s>=0&&this.addIndicesForPlacedSymbol(this.icon,s),a>=0&&this.addIndicesForPlacedSymbol(this.icon,a)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}xs(Ey,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ey.MAX_GLYPHS=65535,Ey.addDynamicAttributes=xy;var Sy=Ey;const Ay=ll([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:My}=Ay,Iy=ll([{name:"a_packed",components:4,type:"Float32"}]),{members:Cy}=Iy,Py=Pm.types,Ry=Math.cos(Math.PI/180*37.5);class Oy{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(t=>{this.gradients[t.id]={}}),this.layoutVertexArray=new fl,this.layoutVertexArray2=new ml,this.indexArray=new Ml,this.programConfigurations=new Dc(t.layers,t.zoom),this.segments=new Ql,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,i,r){this.hasPattern=sm("line",this.layers,e);const n=this.layers[0].layout.get("line-sort-key"),o=[];for(const{feature:e,id:s,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,c=Fp(e,t);if(!this.layers[0]._featureFilter.filter(new Ua(this.zoom),c,i))continue;const u=n?n.evaluate(c,{},i):void 0,h={id:s,properties:e.properties,type:e.type,sourceLayerIndex:l,index:a,geometry:t?c.geometry:Bp(e,i,r),patterns:{},sortKey:u};o.push(h)}n&&o.sort((t,e)=>t.sortKey-e.sortKey);const{lineAtlas:s,featureIndex:a}=e,l=this.addConstantDashes(s);for(const r of o){const{geometry:n,index:o,sourceLayerIndex:c}=r;if(l&&this.addFeatureDashes(r,s),this.hasPattern){const t=am("line",this.layers,r,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(r,n,o,i,s.positions,e.availableImages,e.brightness);a.insert(t[o].feature,n,o,c,this.index)}}addConstantDashes(t){let e=!1;for(const i of this.layers){const r=i.paint.get("line-dasharray").value,n=i.layout.get("line-cap").value;if("constant"!==r.kind||"constant"!==n.kind)e=!0;else{const e=n.value,i=r.value;if(!i)continue;t.addDash(i,e)}}return e}addFeatureDashes(t,e){const i=this.zoom;for(const r of this.layers){const n=r.paint.get("line-dasharray").value,o=r.layout.get("line-cap").value;if("constant"===n.kind&&"constant"===o.kind)continue;let s,a;if("constant"===n.kind){if(s=n.value,!s)continue}else s=n.evaluate({zoom:i},t);a="constant"===o.kind?o.value:o.evaluate({zoom:i},t),e.addDash(s,a),t.patterns[r.id]=e.getKey(s,a)}}update(t,e,i,r,n){const o=0!==Object.keys(t).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,e,o?this.stateDependentLayers:this.layers,i,r,n)}addFeatures(t,e,i,r,n,o){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,i,r,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Cy)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,My),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,e,i,r,n,o,s){const a=this.layers[0].layout,l=a.get("line-join").evaluate(t,{}),c=a.get("line-cap").evaluate(t,{}),u=a.get("line-miter-limit"),h=a.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const i of e)this.addLine(i,t,l,c,u,h);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,n,o,r,s)}addLine(t,e,i,r,n,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const s="Polygon"===Py[e.type];let a=t.length;for(;a>=2&&t[a-1].equals(t[a-2]);)a--;let l=0;for(;l<a-1&&t[l].equals(t[l+1]);)l++;if(a<(s?3:2))return;"bevel"===i&&(n=1.05);const c=this.overscaling<=16?15*ur/(512*this.overscaling):0,u=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,d,p,f,m;this.e1=this.e2=-1,s&&(h=t[a-2],m=t[l].sub(h)._unit()._perp());for(let e=l;e<a;e++){if(p=e===a-1?s?t[l+1]:void 0:t[e+1],p&&t[e].equals(p))continue;m&&(f=m),h&&(d=h),h=t[e],m=p?p.sub(h)._unit()._perp():f,f=f||m;let g=f.add(m);0===g.x&&0===g.y||g._unit();const _=f.x*m.x+f.y*m.y,y=g.x*m.x+g.y*m.y,v=0!==y?1/y:1/0,x=2*Math.sqrt(2-2*y),b=y<Ry&&d&&p,w=f.x*m.y-f.y*m.x>0;if(b&&e>l){const t=h.dist(d);if(t>2*c){const e=h.sub(h.sub(d)._mult(c/t)._round());this.updateDistance(d,e),this.addCurrentVertex(e,f,0,0,u),d=e}}const T=d&&p;let E=T?i:s?"butt":r;if(T&&"round"===E&&(v<o?E="miter":v<=2&&(E="fakeround")),"miter"===E&&v>n&&(E="bevel"),"bevel"===E&&(v>2&&(E="flipbevel"),v<n&&(E="miter")),d&&this.updateDistance(d,h),"miter"===E)g._mult(v),this.addCurrentVertex(h,g,0,0,u);else if("flipbevel"===E){if(v>100)g=m.mult(-1);else{const t=v*f.add(m).mag()/f.sub(m).mag();g._perp()._mult(t*(w?-1:1))}this.addCurrentVertex(h,g,0,0,u),this.addCurrentVertex(h,g.mult(-1),0,0,u)}else if("bevel"===E||"fakeround"===E){const t=-Math.sqrt(v*v-1),e=w?t:0,i=w?0:t;if(d&&this.addCurrentVertex(h,f,e,i,u),"fakeround"===E){const t=Math.round(180*x/Math.PI/20);for(let e=1;e<t;e++){let i=e/t;if(.5!==i){const t=i-.5;i+=i*t*(i-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*t*t+(.848013+_*(.215638*_-1.06021)))}const r=m.sub(f)._mult(i)._add(f)._unit()._mult(w?-1:1);this.addHalfVertex(h,r.x,r.y,!1,w,0,u)}}p&&this.addCurrentVertex(h,m,-e,-i,u)}else if("butt"===E)this.addCurrentVertex(h,g,0,0,u);else if("square"===E){const t=d?1:-1;d||this.addCurrentVertex(h,g,t,t,u),this.addCurrentVertex(h,g,0,0,u),d&&this.addCurrentVertex(h,g,t,t,u)}else"round"===E&&(d&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),p&&(this.addCurrentVertex(h,m,-1,-1,u,!0),this.addCurrentVertex(h,m,0,0,u)));if(b&&e<a-1){const t=h.dist(p);if(t>2*c){const e=h.add(p.sub(h)._mult(c/t)._round());this.updateDistance(h,e),this.addCurrentVertex(e,m,0,0,u),h=e}}}}addCurrentVertex(t,e,i,r,n,o=!1){const s=e.y*r-e.x,a=-e.y-e.x*r;this.addHalfVertex(t,e.x+e.y*i,e.y-e.x*i,o,!1,i,n),this.addHalfVertex(t,s,a,o,!0,-r,n)}addHalfVertex({x:t,y:e},i,r,n,o,s,a){this.layoutVertexArray.emplaceBack((t<<1)+(n?1:0),(e<<1)+(o?1:0),Math.round(63*i)+128,Math.round(63*r)+128,1+(0===s?0:s<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const l=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),a.primitiveLength++),o?this.e2=l:this.e1=l}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,e){this.distance+=t.dist(e),this.updateScaledDistance()}}xs(Oy,"LineBucket",{omit:["layers","patternFeatures"]});class Dy{constructor(t,e,i,r){this.context=t,this.format=i,this.texture=t.gl.createTexture(),this.update(e,r)}update(t,e,r){const{width:n,height:o}=t,{context:s}=this,{gl:a}=s,{HTMLImageElement:l,HTMLCanvasElement:c,HTMLVideoElement:u,ImageData:h,ImageBitmap:d}=i;if(a.bindTexture(a.TEXTURE_2D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(this.format===a.RGBA&&(!e||!1!==e.premultiply)),r||this.size&&this.size[0]===n&&this.size[1]===o){const{x:e,y:i}=r||{x:0,y:0};if(t instanceof l||t instanceof c||t instanceof u||t instanceof h||d&&t instanceof d)a.texSubImage2D(a.TEXTURE_2D,0,e,i,a.RGBA,a.UNSIGNED_BYTE,t);else{let r=this.format,s=a.UNSIGNED_BYTE;this.format===a.R32F&&(r=a.RED,s=a.FLOAT),a.texSubImage2D(a.TEXTURE_2D,0,e,i,n,o,r,s,t.data)}}else if(this.size=[n,o],t instanceof l||t instanceof c||t instanceof u||t instanceof h||d&&t instanceof d){let e=this.format;this.format===a.R8&&(e=a.RED),a.texImage2D(a.TEXTURE_2D,0,this.format,e,a.UNSIGNED_BYTE,t)}else{let e=this.format,i=this.format,r=a.UNSIGNED_BYTE;this.format===a.DEPTH_COMPONENT&&(e=a.DEPTH_COMPONENT16,r=a.UNSIGNED_SHORT),this.format===a.R32F&&(r=a.FLOAT,i=a.RED),a.texImage2D(a.TEXTURE_2D,0,e,n,o,0,i,r,t.data)}this.useMipmap=Boolean(e&&e.useMipmap),this.useMipmap&&a.generateMipmap(a.TEXTURE_2D)}bind(t,e){const{context:i}=this,{gl:r}=i;r.bindTexture(r.TEXTURE_2D,this.texture),t!==this.minFilter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,this.useMipmap?t===r.NEAREST?r.NEAREST_MIPMAP_NEAREST:r.LINEAR_MIPMAP_NEAREST:t),this.minFilter=t),e!==this.wrapS&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,e),this.wrapS=e)}bindExtraParam(t,e,i,r){const{context:n}=this,{gl:o}=n;o.bindTexture(o.TEXTURE_2D,this.texture),e!==this.magFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,e),this.magFilter=e),t!==this.minFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,this.useMipmap?t===o.NEAREST?o.NEAREST_MIPMAP_NEAREST:o.LINEAR_MIPMAP_NEAREST:t),this.minFilter=t),i!==this.wrapS&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,i),this.wrapS=i),r!==this.wrapT&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,r),this.wrapT=r)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Ly{constructor(t,e){this.context=t,this.texture=e}bind(t,e){const{context:i}=this,{gl:r}=i;r.bindTexture(r.TEXTURE_2D,this.texture),t!==this.minFilter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,t),this.minFilter=t),e!==this.wrapS&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,e),this.wrapS=e)}}const ky=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,i=0,r=0,n=0,o=0,s=0,a=0;for(1&e?n=o=s=32:i=r=a=32;(e>>=1)>1;){const t=i+n>>1,l=r+o>>1;1&e?(n=i,o=r,i=s,r=a):(i=n,r=o,n=s,o=a),s=t,a=l}const l=4*t;ky[l+0]=i,ky[l+1]=r,ky[l+2]=n,ky[l+3]=o}const By=new Uint16Array(2178),Fy=new Uint8Array(1089),zy=new Uint16Array(1089);function Ny(t){return 0===t?-.03125:32===t?.03125:0}var Uy=ll([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Gy={type:2,extent:ur,loadGeometry:()=>[[new v(0,0),new v(8193,0),new v(8193,8193),new v(0,8193),new v(0,0)]]};class jy{constructor(t,e,i,r,n){this.tileID=t,this.uid=N(),this.uses=0,this.tileSize=e,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=n,r&&r.style&&(this._lastUpdatedBrightness=r.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",r&&r.transform&&(this.projection=r.transform.projection)}registerFadeDuration(t){const e=t+this.timeAdded;e<pe.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=N_(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,e,i){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){const i={};if(!e)return i;for(const r of t){const t=r.layerIds.map(t=>e.getLayer(t)).filter(Boolean);if(0!==t.length){r.layers=t,r.stateDependentLayerIds&&(r.stateDependentLayers=r.stateDependentLayerIds.map(e=>t.filter(t=>t.id===e)[0]));for(const e of t)i[e.fqid]=r}}return i}(t.buckets,e.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const e=this.buckets[t];if(e instanceof Sy){if(this.hasSymbolBuckets=!0,!i)break;e.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const e=this.buckets[t];if(e instanceof Sy&&e.hasRTLText){this.hasRTLText=!0,Na.isLoading()||Na.isLoaded()||"deferred"!==Fa()||za();break}}this.queryPadding=0;for(const t in this.buckets){const i=this.buckets[t],r=e.style.getOwnLayer(t);if(!r)continue;const n=r.queryRadius(i);this.queryPadding=Math.max(this.queryPadding,n)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new Gl}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const e in this.buckets){const i=this.buckets[e];i.uploadPending()&&i.upload(t)}const e=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Dy(t,this.imageAtlas.image,e.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Dy(t,this.glyphAtlasImage,e.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Dy(t,this.lineAtlas.image,e.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t,e,i){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,i),!e||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const r=e.style.getBrightness();(this._lastUpdatedBrightness||r)&&(this._lastUpdatedBrightness&&r&&Math.abs(this._lastUpdatedBrightness-r)<.001||(this._lastUpdatedBrightness=r,this.updateBuckets(void 0,e)))}queryRenderedFeatures(t,e,i,r,n,o,s,a){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:r,pixelPosMatrix:s,transform:o,params:n,tileTransform:this.tileTransform},t,e,i):{}}querySourceFeatures(t,e){const i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;const r=i.loadVTLayers(),n=e?e.sourceLayer:"",o=r._geojsonTileLayer||r[n];if(!o)return;const s=Co(e&&e.filter),{z:a,x:l,y:c}=this.tileID.canonical,u={z:a,x:l,y:c};for(let e=0;e<o.length;e++){const r=o.feature(e);if(s.needGeometry){const t=Fp(r,!0);if(!s.filter(new Ua(this.tileID.overscaledZ),t,this.tileID.canonical))continue}else if(!s.filter(new Ua(this.tileID.overscaledZ),r))continue;const h=i.getId(r,n),d=new ig(r,a,l,c,h);d.tile=u,t.push(d)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}bucketsLoaded(){for(const t in this.buckets)if(this.buckets[t].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const e=this.expirationTime;if(t.cacheControl){const e=et(t.cacheControl);e["max-age"]&&(this.expirationTime=Date.now()+1e3*e["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const t=Date.now();let i=!1;if(this.expirationTime>t)i=!1;else if(e)if(this.expirationTime<e)i=!0;else{const r=this.expirationTime-e;r?this.expirationTime=t+Math.max(r,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,e){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length&&e&&this.updateBuckets(t,e)}updateBuckets(t,e){if(!this.latestFeatureIndex)return;const i=this.latestFeatureIndex.loadVTLayers(),r=e.style.listImages(),n=e.style.getBrightness();for(const o in this.buckets){if(!e.style.hasLayer(o))continue;const s=this.buckets[o],a=s.layers[0].sourceLayer||"_geojsonTileLayer",l=i[a];let c={};if(t&&(c=t[a],!l||!c||0===Object.keys(c).length))continue;if(s.update(c,l,r,this.imageAtlas&&this.imageAtlas.patternPositions||{},n),s instanceof Oy||s instanceof lm){const t=e.style.getOwnSourceCache(s.layers[0].source);e._terrain&&e._terrain.enabled&&t&&s.programConfigurations.needsUpload&&e._terrain._clearRenderCacheForTile(t.id,this.tileID)}const u=e&&e.style&&e.style.getOwnLayer(o);u&&(this.queryPadding=Math.max(this.queryPadding,u.queryRadius(s)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<pe.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=pe.now()+t}setTexture(t,e){const i=e.context,r=i.gl;this.texture=this.texture||e.getTileTexture(t.width),this.texture&&this.texture instanceof Dy?this.texture.update(t,{useMipmap:!0}):(this.texture=new Dy(i,t,r.RGBA,{useMipmap:!0}),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE))}setDependencies(t,e){const i={};for(const t of e)i[t]=!0;this.dependencies[t]=i}hasDependency(t,e){for(const i of t){const t=this.dependencies[i];if(t)for(const i of e)if(t[i])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,e){if(!e||"mercator"===e.name||this._tileDebugBuffer)return;const i=Bp(Gy,this.tileID.canonical,this.tileTransform)[0],r=new ul,n=new Ll;for(let t=0;t<i.length;t++){const{x:e,y:o}=i[t];r.emplaceBack(e,o),n.emplaceBack(t)}n.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(n),this._tileDebugBuffer=t.createVertexBuffer(r,hd.members),this._tileDebugSegments=Ql.simpleSegment(0,0,r.length,n.length)}_makeTileBoundsBuffers(t,e){if(this._tileBoundsBuffer||!e||"mercator"===e.name)return;const i=Bp(Gy,this.tileID.canonical,this.tileTransform)[0];let r,n;if(this.isRaster){const t=function(t,e){const i=N_(t,e),r=Math.pow(2,t.z);for(let n=0;n<33;n++)for(let o=0;o<33;o++){const s=xp((t.x+(o+Ny(o))/32)/r),a=bp((t.y+(n+Ny(n))/32)/r),l=e.project(s,a),c=33*n+o;By[2*c+0]=Math.round((l.x*i.scale-i.x)*ur),By[2*c+1]=Math.round((l.y*i.scale-i.y)*ur)}Fy.fill(0),zy.fill(0);for(let t=2045;t>=0;t--){const e=4*t,i=ky[e+0],r=ky[e+1],n=ky[e+2],o=ky[e+3],s=i+n>>1,a=r+o>>1,l=s+a-r,c=a+i-s,u=33*r+i,h=33*o+n,d=33*a+s,p=Math.hypot((By[2*u+0]+By[2*h+0])/2-By[2*d+0],(By[2*u+1]+By[2*h+1])/2-By[2*d+1])>=16;Fy[d]=Fy[d]||(p?1:0),t<1022&&(Fy[d]=Fy[d]||Fy[33*(r+c>>1)+(i+l>>1)]||Fy[33*(o+c>>1)+(n+l>>1)])}const n=new dl,o=new Ml;let s=0;function a(t,e){const i=33*e+t;return 0===zy[i]&&(n.emplaceBack(By[2*i+0],By[2*i+1],t*ur/32,e*ur/32),zy[i]=++s),zy[i]-1}function l(t,e,i,r,n,s){const c=t+i>>1,u=e+r>>1;if(Math.abs(t-n)+Math.abs(e-s)>1&&Fy[33*u+c])l(n,s,t,e,c,u),l(i,r,n,s,c,u);else{const l=a(t,e),c=a(i,r),u=a(n,s);o.emplaceBack(l,c,u)}}return l(0,0,32,32,32,0),l(32,32,0,0,0,32),{vertices:n,indices:o}}(this.tileID.canonical,e);r=t.vertices,n=t.indices}else{r=new dl,n=new Ml;for(const{x:t,y:e}of i)r.emplaceBack(t,e,0,0);const t=rm(r.int16,void 0,4);for(let e=0;e<t.length;e+=3)n.emplaceBack(t[e],t[e+1],t[e+2])}this._tileBoundsBuffer=t.createVertexBuffer(r,Uy.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(n),this._tileBoundsSegments=Ql.simpleSegment(0,0,r.length,n.length)}_makeGlobeTileDebugBuffers(t,e){const i=e.projection;if(!i||"globe"!==i.name||e.freezeTileCoverage)return;const r=this.tileID.canonical,n=$d(zd(r,e)),o=tp(e.zoom);let s;o>0&&(s=Jh.invert(new Float64Array(16),e.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,r,e,n,s,o),this._makeGlobeTileDebugTextBuffer(t,r,e,n,s,o)}_globePoint(t,e,i,r,n,o,s){let a=Hd(t,e,i);if(o){const n=1<<i.z,l=_p(r.center.lng),c=yp(r.center.lat),u=(i.x+.5)/n-l;let h=0;u>.5?h=-1:u<-.5&&(h=1);let d=(t/ur+i.x)/n+h,p=(e/ur+i.y)/n;d=(d-l)*r._pixelsPerMercatorPixel+l,p=(p-c)*r._pixelsPerMercatorPixel+c;const f=[d*r.worldSize,p*r.worldSize,0];nd.transformMat4(f,f,o),a=Fd(a,f,s)}return nd.transformMat4(a,a,n)}_makeGlobeTileDebugBorderBuffer(t,e,i,r,n,o){const s=new ul,a=new Ll,l=new hl,c=(t,c,u,h,d)=>{const p=(u-t)/(d-1),f=(h-c)/(d-1),m=s.length;for(let u=0;u<d;u++){const h=t+u*p,d=c+u*f;s.emplaceBack(h,d);const g=this._globePoint(h,d,e,i,r,n,o);l.emplaceBack(g[0],g[1],g[2]),a.emplaceBack(m+u)}},u=ur;c(0,0,u,0,16),c(u,0,u,u,16),c(u,u,0,u,16),c(0,u,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(a),this._tileDebugBuffer=t.createVertexBuffer(s,hd.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(l,ud.members),this._tileDebugSegments=Ql.simpleSegment(0,0,s.length,a.length)}_makeGlobeTileDebugTextBuffer(t,e,i,r,n,o){const s=new ul,a=new Ml,l=new hl,c=25;a.reserve(32),s.reserve(c),l.reserve(c);const u=(t,e)=>c*t+e;for(let t=0;t<c;t++){const a=2048*t;for(let t=0;t<c;t++){const c=2048*t;s.emplaceBack(c,a);const u=this._globePoint(c,a,e,i,r,n,o);l.emplaceBack(u[0],u[1],u[2])}}for(let t=0;t<4;t++)for(let e=0;e<4;e++){const i=u(t,e),r=u(t,e+1),n=u(t+1,e),o=u(t+1,e+1);a.emplaceBack(i,r,n),a.emplaceBack(n,r,o)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(a),this._tileDebugTextBuffer=t.createVertexBuffer(s,hd.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(l,ud.members),this._tileDebugTextSegments=Ql.simpleSegment(0,0,c,32)}destroy(t=!1){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof Dy&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.latestFeatureIndex=null,this.state="unloaded"}}class Vy{constructor(t,e){this.max=t,this.onRemove=e,this.reset()}reset(){for(const t in this.data)for(const e of this.data[t])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(t,e,i){const r=t.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);const n={value:e,timeout:void 0};if(void 0!==i&&(n.timeout=setTimeout(()=>{this.remove(t,n)},i)),this.data[r].push(n),this.order.push(r),this.order.length>this.max){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value}getByKey(t){const e=this.data[t];return e?e[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,e){if(!this.has(t))return this;const i=t.wrapped().key,r=void 0===e?0:this.data[i].indexOf(e),n=this.data[i][r];return this.data[i].splice(r,1),n.timeout&&clearTimeout(n.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(n.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(t){const e=[];for(const i in this.data)for(const r of this.data[i])t(r.value)||e.push(r);for(const t of e)this.remove(t.value.tileID,t)}}class Xy{constructor(t,e,i,r){this.id=Xy.uniqueIdxCounter,Xy.uniqueIdxCounter++,this.context=t;const n=t.gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||r||e.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Xy.uniqueIdxCounter,Xy.uniqueIdxCounter++;const e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Xy.uniqueIdxCounter=0;const Hy={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class qy{constructor(t,e,i,r,n,o){this.length=e.length,this.attributes=i,this.itemSize=e.bytesPerElement,this.dynamicDraw=r,this.instanceCount=o,this.context=t;const s=t.gl;this.buffer=s.createBuffer(),t.bindVertexBuffer.set(this.buffer),s.bufferData(s.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?s.DYNAMIC_DRAW:s.STATIC_DRAW),this.dynamicDraw||n||e.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,e){for(let i=0;i<this.attributes.length;i++){const r=e.attributes[this.attributes[i].name];void 0!==r&&t.enableVertexAttribArray(r)}}setVertexAttribPointers(t,e,i){for(let r=0;r<this.attributes.length;r++){const n=this.attributes[r],o=e.attributes[n.name];void 0!==o&&t.vertexAttribPointer(o,n.components,t[Hy[n.type]],!1,this.itemSize,n.offset+this.itemSize*(i||0))}}setVertexAttribDivisor(t,e,i){for(let r=0;r<this.attributes.length;r++){const n=e.attributes[this.attributes[r].name];void 0!==n&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(n,i)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Wy{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class $y extends Wy{getDefault(){return hi.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Yy extends Wy{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Zy extends Wy{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Ky extends Wy{getDefault(){return[!0,!0,!0,!0]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Jy extends Wy{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Qy extends Wy{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class tv extends Wy{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ev extends Wy{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class iv extends Wy{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}}class rv extends Wy{getDefault(){return[0,1]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class nv extends Wy{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}}class ov extends Wy{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class sv extends Wy{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}}class av extends Wy{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class lv extends Wy{getDefault(){return hi.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class cv extends Wy{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class uv extends Wy{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}}class hv extends Wy{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class dv extends Wy{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let pv=class extends Wy{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}};class fv extends Wy{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class mv extends Wy{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class gv extends Wy{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class _v extends Wy{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class yv extends Wy{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class vv extends Wy{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class xv extends Wy{getDefault(){return null}set(t){const e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class bv extends Wy{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class wv extends Wy{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Tv extends Wy{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Ev extends Wy{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Sv extends Wy{constructor(t,e){super(t),this.context=t,this.parent=e}getDefault(){return null}}class Av extends Sv{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Mv extends Sv{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,this.attachment(),e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Iv extends Sv{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,this.attachment(),e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Cv extends Mv{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Pv{constructor(t,e,i,r,n){this.context=t,this.width=e,this.height=i;const o=this.framebuffer=t.gl.createFramebuffer();r&&(this.colorAttachment=new Av(t,o)),n&&(this.depthAttachmentType=n,this.depthAttachment="renderbuffer"===n?new Mv(t,o):new Iv(t,o))}destroy(){const t=this.context.gl;if(this.colorAttachment){const e=this.colorAttachment.get();e&&t.deleteTexture(e)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const e=this.depthAttachment.get();e&&t.deleteRenderbuffer(e)}else{const e=this.depthAttachment.get();e&&t.deleteTexture(e)}t.deleteFramebuffer(this.framebuffer)}}class Rv{constructor(t,e,i){this.func=t,this.mask=e,this.range=i}}Rv.ReadOnly=!1,Rv.ReadWrite=!0,Rv.disabled=new Rv(519,Rv.ReadOnly,[0,1]);class Ov{constructor(t,e,i,r,n,o){this.test=t,this.ref=e,this.mask=i,this.fail=r,this.depthFail=n,this.pass=o}}Ov.disabled=new Ov({func:519,mask:0},0,0,7680,7680,7680);class Dv{constructor(t,e,i,r){this.blendFunction=t,this.blendColor=e,this.mask=i,this.blendEquation=r}}Dv.Replace=[1,0,1,0],Dv.disabled=new Dv(Dv.Replace,hi.transparent,[!1,!1,!1,!1]),Dv.unblended=new Dv(Dv.Replace,hi.transparent,[!0,!0,!0,!0]),Dv.alphaBlended=new Dv([1,771,1,771],hi.transparent,[!0,!0,!0,!0]),Dv.multiply=new Dv([774,0,774,0],hi.transparent,[!0,!0,!0,!0]);class Lv{constructor(t,e,i){this.enable=t,this.mode=e,this.frontFace=i}}Lv.disabled=new Lv(!1,1029,2305),Lv.backCCW=new Lv(!0,1029,2305),Lv.backCW=new Lv(!0,1029,2304),Lv.frontCW=new Lv(!0,1028,2304),Lv.frontCCW=new Lv(!0,1028,2305);class kv{constructor(t,e){this.gl=t,this.clearColor=new $y(this),this.clearDepth=new Yy(this),this.clearStencil=new Zy(this),this.colorMask=new Ky(this),this.depthMask=new Jy(this),this.stencilMask=new Qy(this),this.stencilFunc=new tv(this),this.stencilOp=new ev(this),this.stencilTest=new iv(this),this.depthRange=new rv(this),this.depthTest=new nv(this),this.depthFunc=new ov(this),this.blend=new sv(this),this.blendFunc=new av(this),this.blendColor=new lv(this),this.blendEquation=new cv(this),this.cullFace=new uv(this),this.cullFaceSide=new hv(this),this.frontFace=new dv(this),this.program=new pv(this),this.activeTexture=new fv(this),this.viewport=new mv(this),this.bindFramebuffer=new gv(this),this.bindRenderbuffer=new _v(this),this.bindTexture=new yv(this),this.bindVertexBuffer=new vv(this),this.bindElementBuffer=new xv(this),this.bindVertexArrayOES=new bv(this),this.pixelStoreUnpack=new wv(this),this.pixelStoreUnpackPremultiplyAlpha=new Tv(this),this.pixelStoreUnpackFlipY=new Ev(this),this.options=e?{...e}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,e,i){return new Xy(this,t,e,i)}createVertexBuffer(t,e,i,r,n){return new qy(this,t,e,i,r,n)}createRenderbuffer(t,e,i){const r=this.gl,n=r.createRenderbuffer();return this.bindRenderbuffer.set(n),r.renderbufferStorage(r.RENDERBUFFER,t,e,i),this.bindRenderbuffer.set(null),n}createFramebuffer(t,e,i,r){return new Pv(this,t,e,i,r)}clear({color:t,depth:e,stencil:i,colorMask:r}){const n=this.gl;let o=0;t&&(o|=n.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(r||[!0,!0,!0,!0])),void 0!==e&&(o|=n.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(e),this.depthMask.set(!0)),void 0!==i&&(o|=n.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),n.clear(o)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){x(t.blendFunction,Dv.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class Bv extends Re{constructor(t,e,i){super(),this.id=t,this._onlySymbols=i,e.on("data",t=>{"source"===t.dataType&&"metadata"===t.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),e.on("error",()=>{this._sourceErrored=!0}),this._source=e,this._tiles={},this._cache=new Vy(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new rg,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(t){this.map=t,this._minTileCacheSize=void 0===this._minTileCacheSize&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const t in this._tiles){const e=this._tiles[t];if("errored"!==e.state&&("loaded"!==e.state||!e.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,e){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,e)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const e in this._tiles){const i=this._tiles[e];i.upload(t),i.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return k(this._tiles).map(t=>t.tileID).sort(Fv).map(t=>t.key)}getRenderableIds(t,e){const i=[];for(const r in this._tiles)this._isIdRenderable(+r,t,e)&&i.push(this._tiles[r]);return t?i.sort((t,e)=>{const i=t.tileID,r=e.tileID,n=new v(i.canonical.x,i.canonical.y)._rotate(this.transform.angle),o=new v(r.canonical.x,r.canonical.y)._rotate(this.transform.angle);return i.overscaledZ-r.overscaledZ||o.y-n.y||o.x-n.x}).map(t=>t.tileID.key):i.map(t=>t.tileID).sort(Fv).map(t=>t.key)}hasRenderableParent(t){const e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)}_isIdRenderable(t,e,i){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())&&(i||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,e){const i=this._tiles[t];i&&("loading"!==i.state&&(i.state=e),this._loadTile(i,this._tileLoaded.bind(this,i,t,e)))}_tileLoaded(t,e,i,r){if(r)if(t.state="errored",404!==r.status)this._source.fire(new Pe(r,{tile:t}));else{if(!(t.tileID.key in this._loadedParentTiles))return void this._source.fire(new Ce("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const t=this.map.painter.terrain;this.update(this.transform,t.getScaledDemTileSize(),!0),t.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=pe.now(),"expired"===i&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(e,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new Ce("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const e=this.getRenderableIds();for(let r=0;r<e.length;r++){const n=e[r];if(t.neighboringTiles&&t.neighboringTiles[n]){const e=this.getTileByID(n);i(t,e),i(e,t)}}function i(t,e){if(!t.dem||t.dem.borderReady)return;t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0;let i=e.tileID.canonical.x-t.tileID.canonical.x;const r=e.tileID.canonical.y-t.tileID.canonical.y,n=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===i&&0===r||Math.abs(r)>1||(Math.abs(i)>1&&(1===Math.abs(i+n)?i+=n:1===Math.abs(i-n)&&(i-=n)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,i,r),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,e,i,r){for(const n in this._tiles){let o=this._tiles[n];if(r[n]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>i)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>e+1;){const t=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[t.key],o&&o.hasData()&&(s=t)}let a=s;for(;a.overscaledZ>e;)if(a=a.scaledTo(a.overscaledZ-1),t[a.key]){r[s.key]=s;break}}}findLoadedParent(t,e){if(t.key in this._loadedParentTiles){const i=this._loadedParentTiles[t.key];return i&&i.tileID.overscaledZ>=e?i:null}for(let i=t.overscaledZ-1;i>=e;i--){const e=t.scaledTo(i),r=this._getLoadedTile(e);if(r)return r}}_getLoadedTile(t){const e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,e){e=e||this._source.tileSize;const i=Math.ceil(t.width/e)+1,r=Math.ceil(t.height/e)+1,n=Math.floor(i*r*5),o="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,n):n,s="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(s)}handleWrapJump(t){const e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){const t={};for(const i in this._tiles){const r=this._tiles[i];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+e),t[r.tileID.key]=r}this._tiles=t;for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t in this._tiles)this._setTileReloadTimer(+t,this._tiles[t])}}update(t,e,i,r){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!i)return;let n;if(this.updateCacheSize(t,e),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?n=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(t=>new gd(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)):(n=t.coveringTiles({tileSize:e||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(n=n.filter(t=>this._source.hasTile(t)))):n=[],n.length>0&&this.castsShadows&&r&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!zv(this._source.type)){const o=t.coveringZoomLevel({tileSize:e||this._source.tileSize,roundZoom:this._source.roundZoom&&!i}),s=Math.min(o,this._source.maxzoom),a=t.extendTileCoverForShadows(n,r,s);for(const t of a)this._shadowCasterTiles[t.key]=!0,n.push(t)}const o=this._updateRetainedTiles(n);if(zv(this._source.type)&&0!==n.length){const t={},e={},i=Object.keys(o);for(const r of i){const i=o[r],n=this._tiles[r];if(!n||n.fadeEndTime&&n.fadeEndTime<=pe.now())continue;const s=this.findLoadedParent(i,Math.max(i.overscaledZ-Bv.maxOverzooming,this._source.minzoom));s&&(this._addTile(s.tileID),t[s.tileID.key]=s.tileID),e[r]=i}const r=n[n.length-1].overscaledZ;for(const t in this._tiles){const i=this._tiles[t];if(o[t]||!i.hasData())continue;let n=i.tileID;for(;n.overscaledZ>r;){n=n.scaledTo(n.overscaledZ-1);const r=this._tiles[n.key];if(r&&r.hasData()&&e[n.key]){o[t]=i.tileID;break}}}for(const e in t)o[e]||(this._coveredTiles[e]=!0,o[e]=t[e])}for(const t in o)this._tiles[t].clearFadeHold();const s=function(t,e){const i=[];for(const r in t)r in e||i.push(r);return i}(this._tiles,o);for(const t of s){const e=this._tiles[t];e.hasSymbolBuckets&&!e.holdingForFade()?e.setHoldDuration(this.map._fadeDuration):e.hasSymbolBuckets&&!e.symbolFadeFinished()||this._removeTile(+t)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const e={};if(0===t.length)return e;const i={},r=t.reduce((t,e)=>Math.min(t,e.overscaledZ),1/0),n=t[0].overscaledZ,o=Math.max(n-Bv.maxOverzooming,this._source.minzoom),s=Math.max(n+Bv.maxUnderzooming,this._source.minzoom),a={};for(const i of t){const t=this._addTile(i);e[i.key]=i,t.hasData()||r<this._source.maxzoom&&(a[i.key]=i)}this._retainLoadedChildren(a,r,s,e);for(const r of t){let t=this._tiles[r.key];if(t.hasData())continue;if(r.canonical.z>=this._source.maxzoom){const t=r.children(this._source.maxzoom)[0],i=this.getTile(t);if(i&&i.hasData()){e[t.key]=t;continue}}else{const t=r.children(this._source.maxzoom);if(e[t[0].key]&&e[t[1].key]&&e[t[2].key]&&e[t[3].key])continue}let n=t.wasRequested();for(let s=r.overscaledZ-1;s>=o;--s){const o=r.scaledTo(s);if(i[o.key])break;if(i[o.key]=!0,t=this.getTile(o),!t&&n&&(t=this._addTile(o)),t&&(e[o.key]=o,n=t.wasRequested(),t.hasData()))break}}return e}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const e=[];let i,r=this._tiles[t].tileID;for(;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){i=this._loadedParentTiles[r.key];break}e.push(r.key);const t=r.scaledTo(r.overscaledZ-1);if(i=this._getLoadedTile(t),i)break;r=t}for(const t of e)this._loadedParentTiles[t]=i}}_addTile(t){let e=this._tiles[t.key];if(e)return!0!==e.isExtraShadowCaster||!!this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),e;e=this._cache.getAndRemove(t),e&&(this._setTileReloadTimer(t.key,e),e.tileID=t,this._state.initializeTileState(e,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,e)));const i=Boolean(e);if(!i){const i=this.map?this.map.painter:null;e=new jy(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,i,this._isRaster),this._loadTile(e,this._tileLoaded.bind(this,e,t.key,e.state))}return e?(e.uses++,this._tiles[t.key]=e,i||this._source.fire(new Ce("dataloading",{tile:e,coord:e.tileID,dataType:"source"})),e):null}_setTileReloadTimer(t,e){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const i=e.getExpiryTimeout();i&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},i))}_removeTile(t){const e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,e,i){const r=[],n=this.transform;if(!n)return r;const o="globe"===n.projection.name,s=_p(n.center.lng);for(const a in this._tiles){const l=this._tiles[a];if(i&&l.clearQueryDebugViz(),l.holdingForFade())continue;let c;if(o){const t=l.tileID.canonical;if(0===t.z){const e=[Math.abs(R(s,...Nv(t,-1))-s),Math.abs(R(s,...Nv(t,1))-s)];c=[0,2*e.indexOf(Math.min(...e))-1]}else{const e=[Math.abs(R(s,...Nv(t,-1))-s),Math.abs(R(s,...Nv(t,0))-s),Math.abs(R(s,...Nv(t,1))-s)];c=[e.indexOf(Math.min(...e))-1]}}else c=[0];for(const i of c){const o=t.containsTile(l,n,e,i);o&&r.push(o)}}return r}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,e){const i=this.getRenderableIds(t,e).map(t=>this._tiles[t].tileID),r="globe"===this.transform.projection.name;for(const t of i)t.projMatrix=this.transform.calculateProjMatrix(t.toUnwrapped()),t.expandedProjMatrix=r?this.transform.calculateProjMatrix(t.toUnwrapped(),!1,!0):t.projMatrix;return i}sortCoordinatesByDistance(t){const e=t.slice(),i=this.transform._camera.position,r=this.transform._camera.forward(),n={};for(const t of e){const e=1/(1<<t.canonical.z);n[t.key]=((t.canonical.x+.5)*e+t.wrap-i[0])*r[0]+((t.canonical.y+.5)*e-i[1])*r[1]-i[2]*r[2]}return e.sort((t,e)=>n[t.key]-n[e.key]),e}hasTransition(){if(this._source.hasTransition())return!0;if(zv(this._source.type))for(const t in this._tiles){const e=this._tiles[t];if(void 0!==e.fadeEndTime&&e.fadeEndTime>=pe.now())return!0}return!1}setFeatureState(t,e,i){this._state.updateState(t=t||"_geojsonTileLayer",e,i)}removeFeatureState(t,e,i){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,i)}getFeatureState(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)}setDependencies(t,e,i){const r=this._tiles[t];r&&r.setDependencies(e,i)}reloadTilesForDependencies(t,e){for(const i in this._tiles)this._tiles[i].hasDependency(t,e)&&this._reloadTile(+i,"reloading");this._cache.filter(i=>!i.hasDependency(t,e))}_preloadTiles(t,e){if(!this._sourceLoaded){const i=()=>{this._sourceLoaded&&(this._source.off("data",i),this._preloadTiles(t,e))};return void this._source.on("data",i)}const i=new Map,r=Array.isArray(t)?t:[t],n=this.map.painter.terrain,o=this.usedForTerrain&&n?n.getScaledDemTileSize():this._source.tileSize;for(const t of r){const e=t.coveringTiles({tileSize:o,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const t of e)i.set(t.key,t);this.usedForTerrain&&t.updateElevation(!1)}L(Array.from(i.values()),(t,e)=>{const i=new jy(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(i,t=>{"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),e(t,i)})},e)}}function Fv(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),r=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||r-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function zv(t){return"raster"===t||"image"===t||"video"===t||"custom"===t}function Nv(t,e){const i=1<<t.z;return[t.x/i+e,(t.x+1)/i+e]}Bv.maxOverzooming=10,Bv.maxUnderzooming=3;const Uv=ll([{name:"a_pos_3f",components:3,type:"Float32"}]),Gv=ll([{name:"a_color_3f",components:3,type:"Float32"}]),jv=ll([{name:"a_color_4f",components:4,type:"Float32"}]),Vv=ll([{name:"a_uv_2f",components:2,type:"Float32"}]),Xv=ll([{name:"a_normal_3f",components:3,type:"Float32"}]),Hv=ll([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),qv=ll([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class Wv{constructor(t=0,e=0,i=0,r=0){if(isNaN(t)||t<0||isNaN(e)||e<0||isNaN(i)||i<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=i,this.right=r}interpolate(t,e,i){return null!=e.top&&null!=t.top&&(this.top=Yr(t.top,e.top,i)),null!=e.bottom&&null!=t.bottom&&(this.bottom=Yr(t.bottom,e.bottom,i)),null!=e.left&&null!=t.left&&(this.left=Yr(t.left,e.left,i)),null!=e.right&&null!=t.right&&(this.right=Yr(t.right,e.right,i)),this}getCenter(t,e){const i=R((this.left+t-this.right)/2,0,t),r=R((this.top+e-this.bottom)/2,0,e);return new v(i,r)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Wv(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function $v(t,e){const i=ot(t,3);Jh.fromQuat(t,e),st(t,3,i)}function Yv(t,e){const i=td.identity([]);return td.rotateZ(i,i,-e),td.rotateX(i,i,-t),i}function Zv(t,e){const i=[t[0],t[1],0],r=[e[0],e[1],0];if(nd.length(i)>=1e-15){const t=nd.normalize([],i);nd.scale(r,t,nd.dot(r,t)),e[0]=r[0],e[1]=r[1]}const n=nd.cross([],e,t);if(nd.len(n)<1e-15)return null;const o=Math.atan2(-n[1],n[0]);return Yv(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),o)}class Kv{constructor(t,e){this.position=t,this.orientation=e}get position(){return this._position}set position(t){if(t){const e=t instanceof Ip?t:new Ip(t[0],t[1],t[2]);this._renderWorldCopies&&(e.x=D(e.x,0,1)),this._position=e}else this._position=null}lookAtPoint(t,e){if(this.orientation=null,!this.position)return;const i=this.position,r=this._elevation?this._elevation.getAtPointOrZero(Ip.fromLngLat(t)):0,n=Ip.fromLngLat(t,r),o=[n.x-i.x,n.y-i.y,n.z-i.z];e||(e=[0,0,1]),e[2]=Math.abs(e[2]),this.orientation=Zv(o,e)}setPitchBearing(t,e){this.orientation=Yv(T(t),T(-e))}}class Jv{constructor(t,e){this._transform=Jh.identity([]),this.orientation=e,this.position=t}get mercatorPosition(){const t=this.position;return new Ip(t[0],t[1],t[2])}get position(){const t=ot(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var e;t&&st(this._transform,3,[(e=t)[0],e[1],e[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||td.identity([]),t&&$v(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),e=this.right();return{bearing:Math.atan2(-e[1],e[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,e){this._orientation=Yv(t,e),$v(this._transform,this._orientation)}forward(){const t=ot(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=ot(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=ot(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,e){const i=new Float64Array(16);return Jh.invert(i,this.getWorldToCamera(t,e)),i}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,e,i){const r=this.position;nd.scale(r,r,-t);const n=new Float64Array(16);return Jh.fromScaling(n,[i,i,i]),Jh.translate(n,n,r),n[10]*=e,n}getWorldToCamera(t,e){const i=new Float64Array(16),r=new Float64Array(4),n=this.position;return td.conjugate(r,this._orientation),nd.scale(n,n,-t),Jh.fromQuat(i,r),Jh.translate(i,i,n),i[1]*=-1,i[5]*=-1,i[9]*=-1,i[13]*=-1,i[8]*=e,i[9]*=e,i[10]*=e,i[11]*=e,i}getCameraToClipPerspective(t,e,i,r){const n=new Float64Array(16);return Jh.perspective(n,t,e,i,r),n}getCameraToClipOrthographic(t,e,i,r,n,o){const s=new Float64Array(16);return Jh.ortho(s,t,e,i,r,n,o),s}getDistanceToElevation(t,e=!1){const i=0===t?0:vp(t,e?bp(this.position[1]):this.position[1]),r=this.forward();return(i-this.position[2])/r[2]}clone(){return new Jv([...this.position],[...this.orientation])}}function Qv(t,e){const i=ex(t.projection,t.zoom,t.width,t.height),r=function(t,e,i,r,n){const o=new mp(i.lng-180*ix,i.lat),s=new mp(i.lng+180*ix,i.lat),a=t.project(o.lng,o.lat),l=t.project(s.lng,s.lat),c=-Math.atan2(l.y-a.y,l.x-a.x),u=Ip.fromLngLat(i);u.y=R(u.y,-1+ix,1-ix);const h=u.toLngLat(),d=t.project(h.lng,h.lat),p=Ip.fromLngLat(h);p.x+=ix;const f=p.toLngLat(),m=t.project(f.lng,f.lat),g=nx(m.x-d.x,m.y-d.y,c),_=Ip.fromLngLat(h);_.y+=ix;const y=_.toLngLat(),v=t.project(y.lng,y.lat),x=nx(v.x-d.x,v.y-d.y,c),b=Math.abs(g.x)/Math.abs(x.y),w=Jh.identity([]);Jh.rotateZ(w,w,-c*(1-(n?0:r)));const T=Jh.identity([]);return Jh.scale(T,T,[1,1-(1-b)*r,1]),T[4]=-x.x/x.y*r,Jh.rotateZ(T,T,c),Jh.multiply(T,w,T),T}(t.projection,0,t.center,i,e),n=tx(t);return Jh.scale(r,r,[n,n,1]),r}function tx(t){const e=t.projection,i=ex(t.projection,t.zoom,t.width,t.height),r=rx(e,t.center),n=rx(e,mp.convert(e.center));return Math.pow(2,r*i+(1-i)*n)}function ex(t,e,i,r,n=1/0){const o=t.range;if(!o)return 0;const s=Math.min(n,Math.max(i,r)),a=Math.log(s/1024)/Math.LN2;return O(o[0]+a,o[1]+a,e)}const ix=1/4e4;function rx(t,e){const i=R(e.lat,-Tp,Tp),r=new mp(e.lng-180*ix,i),n=new mp(e.lng+180*ix,i),o=t.project(r.lng,i),s=t.project(n.lng,i),a=Ip.fromLngLat(r),l=Ip.fromLngLat(n),c=s.x-o.x,u=s.y-o.y,h=l.x-a.x,d=l.y-a.y,p=Math.sqrt((h*h+d*d)/(c*c+u*u));return Math.log(p)/Math.LN2}function nx(t,e,i){const r=Math.cos(i),n=Math.sin(i);return{x:t*r-e*n,y:t*n+e*r}}function ox(t,e,i){return e*(ur/(t.tileSize*Math.pow(2,i-t.tileID.overscaledZ)))}const sx=0,ax=1,lx=2,cx=Math.tan(85*Math.PI/180);function ux(t,e,i,r,n,o,s){const a=Jh.create();if(i)if("globe"===o.name){const t=function(t,e){const{x:i,y:r}=t.point,n=Jd(i,r,t.worldSize/t._pixelsPerMercatorPixel,0,0);return Jh.multiply(n,n,Yd(Bd(e)))}(n,e);Jh.multiply(a,a,t)}else{const t=Wh.invert([],s);a[0]=t[0],a[1]=t[1],a[4]=t[2],a[5]=t[3],r||Jh.rotateZ(a,a,n.angle)}else Jh.multiply(a,n.labelPlaneMatrix,t);return a}function hx(t,e,i,r,n,o,s){const a=ux(t,e,i,r,n,o,s);return"globe"===o.name&&i||(a[2]=a[6]=a[10]=a[14]=0),a}function dx(t,e,i,r,n,o,s){if(i){if("globe"===o.name){const a=ux(t,e,i,r,n,o,s);return Jh.invert(a,a),Jh.multiply(a,t,a),a}{const e=Jh.clone(t),i=Jh.identity([]);return i[0]=s[0],i[1]=s[1],i[4]=s[2],i[5]=s[3],Jh.multiply(e,e,i),r||Jh.rotateZ(e,e,-n.angle),e}}return n.glCoordMatrix}function px(t,e,i,r){const n=[t,e,i,1];i?Xh.transformMat4(n,n,r):Ex(n,n,r);const o=n[3];return n[0]/=o,n[1]/=o,n[2]/=o,n}function fx(t,e){return Math.min(.5+t/e*.5,1.5)}function mx(t,e){const i=t[0]/t[3],r=t[1]/t[3];return i>=-e[0]&&i<=e[0]&&r>=-e[1]&&r<=e[1]}function gx(t,e,i,r,n,o,s,a,l,c){const u=i.transform,h=r?t.textSizeData:t.iconSizeData,d=Og(h,i.transform.zoom),p="globe"===u.projection.name,f=[256/i.width*2+1,256/i.height*2+1],m=r?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;m.clear();let g=null;p&&(g=r?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);const _=t.lineVertexArray,y=r?t.text.placedSymbolArray:t.icon.placedSymbolArray,x=i.transform.width/i.transform.height;let b,w=!1;for(let r=0;r<y.length;r++){const p=y.get(r),{numGlyphs:T,writingMode:E}=p;if(E!==Gg.vertical||w||b===Gg.horizontal||(w=!0),b=E,(p.hidden||E===Gg.vertical)&&!w){Tx(T,m);continue}w=!1;const S=new v(p.tileAnchorX,p.tileAnchorY);let{x:A,y:M,z:I}=u.projection.projectTilePoint(S.x,S.y,c.canonical);if(l){const[t,e,i]=l(S);A+=t,M+=e,I+=i}const C=[A,M,I,1];if(Xh.transformMat4(C,C,e),!mx(C,f)){Tx(T,m);continue}const P=C[3],R=fx(i.transform.getCameraToCenterDistance(u.projection),P),O=Rg(h,d,p),D=s?O/R:O*R,L=px(A,M,I,n);if(L[3]<=0){Tx(T,m);continue}let k={};const B=s?null:l,F=vx(p,D,!1,a,e,n,o,t.glyphOffsetArray,_,m,g,L,S,k,x,B,u.projection,c,s);w=F.useVertical,B&&F.needsFlipping&&(k={}),(F.notEnoughRoom||w||F.needsFlipping&&vx(p,D,!0,a,e,n,o,t.glyphOffsetArray,_,m,g,L,S,k,x,B,u.projection,c,s).notEnoughRoom)&&Tx(T,m)}r?(t.text.dynamicLayoutVertexBuffer.updateData(m),g&&t.text.globeExtVertexBuffer&&t.text.globeExtVertexBuffer.updateData(g)):(t.icon.dynamicLayoutVertexBuffer.updateData(m),g&&t.icon.globeExtVertexBuffer&&t.icon.globeExtVertexBuffer.updateData(g))}function _x(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,m){const{lineStartIndex:g,glyphStartIndex:_,segment:y}=a,v=_+a.numGlyphs,x=g+a.lineLength,b=e.getoffsetX(_),w=e.getoffsetX(v-1),T=wx(t*b,i,r,n,o,s,y,g,x,l,c,u,h,d,!0,p,f,m);if(!T)return null;const E=wx(t*w,i,r,n,o,s,y,g,x,l,c,u,h,d,!0,p,f,m);return E?{first:T,last:E}:null}function yx(t,e,i,r){return t===Gg.horizontal&&Math.abs(r)>Math.abs(i)?{useVertical:!0}:t===Gg.vertical?r>0?{needsFlipping:!0}:null:e!==sx&&function(t,e){return 0===t||Math.abs(e/t)>cx}(i,r)?e===ax?{needsFlipping:!0}:null:i<0?{needsFlipping:!0}:null}function vx(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,_,y){const x=e/24,b=t.lineOffsetX*x,w=t.lineOffsetY*x,{lineStartIndex:T,glyphStartIndex:E,numGlyphs:S,segment:A,writingMode:M,flipState:I}=t,C=T+t.lineLength,P=t=>{if(u){const[e,i,r]=t.up,n=c.length;vy(u,n+0,e,i,r),vy(u,n+1,e,i,r),vy(u,n+2,e,i,r),vy(u,n+3,e,i,r)}const[e,i,r]=t.point;xy(c,e,i,r,t.angle)};if(S>1){const e=_x(x,a,b,w,i,h,d,t,l,o,p,m,!1,g,_,y);if(!e)return{notEnoughRoom:!0};if(r&&!i){let[i,r,n]=e.first.point,[o,a,l]=e.last.point;[i,r]=px(i,r,n,s),[o,a]=px(o,a,l,s);const c=yx(M,I,(o-i)*f,a-r);if(t.flipState=c&&c.needsFlipping?ax:lx,c)return c}P(e.first);for(let t=E+1;t<E+S-1;t++){const e=wx(x*a.getoffsetX(t),b,w,i,h,d,A,T,C,l,o,p,m,!1,!1,g,_,y);if(!e)return c.length-=4*(t-E),{notEnoughRoom:!0};P(e)}P(e.last)}else{if(r&&!i){const e=px(d.x,d.y,0,n),i=T+A+1,r=new v(l.getx(i),l.gety(i)),o=px(r.x,r.y,0,n),s=o[3]>0?o:bx(d,r,e,1,n,void 0,g,_.canonical),a=yx(M,I,(s[0]-e[0])*f,s[1]-e[1]);if(t.flipState=a&&a.needsFlipping?ax:lx,a)return a}const e=wx(x*a.getoffsetX(E),b,w,i,h,d,A,T,C,l,o,p,m,!1,!1,g,_,y);if(!e)return{notEnoughRoom:!0};P(e)}return{}}function xx(t,e,i,r,n){const{x:o,y:s,z:a}=r.projectTilePoint(t.x,t.y,e);if(!n)return px(o,s,a,i);const[l,c,u]=n(t);return px(o+l,s+c,a+u,i)}function bx(t,e,i,r,n,o,s,a){const l=xx(t.sub(e)._unit()._add(t),a,n,s,o);return nd.sub(l,i,l),nd.normalize(l,l),nd.scaleAndAdd(l,i,l,r)}function wx(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,_){const y=r?t-e:t+e;let x=y>0?1:-1,b=0;r&&(x*=-1,b=Math.PI),x<0&&(b+=Math.PI);let w=a+s+(x>0?0:1)|0,T=n,E=n,S=0,A=0;const M=Math.abs(y),I=[],C=[];let P=o,R=P;const O=()=>bx(R,P,E,M-S+1,u,d,m,g.canonical);for(;S+A<=M;){if(w+=x,w<a||w>=l)return null;if(E=T,R=P,I.push(E),p&&C.push(R),P=new v(c.getx(w),c.gety(w)),T=h[w],!T){const t=xx(P,g.canonical,u,m,d);T=t[3]>0?h[w]=t:O()}S+=A,A=nd.distance(E,T)}f&&d&&(h[w]&&(T=O(),A=nd.distance(E,T)),h[w]=T);const D=(M-S)/A,L=P.sub(R)._mult(D)._add(R),k=nd.sub([],T,E),B=nd.scaleAndAdd([],E,k,D);let F=[0,0,1],z=k[0],N=k[1];if(_&&(F=m.upVector(g.canonical,L.x,L.y),0!==F[0]||0!==F[1]||1!==F[2])){const t=[F[2],0,-F[0]],e=nd.cross([],F,t);nd.normalize(t,t),nd.normalize(e,e),z=nd.dot(k,t),N=nd.dot(k,e)}if(i){const t=nd.cross([],F,k);nd.normalize(t,t),nd.scaleAndAdd(B,B,t,i*x)}const U=b+Math.atan2(N,z);return I.push(B),p&&C.push(L),{point:B,angle:U,path:I,tilePath:C,up:F}}function Tx(t,e){const i=e.length,r=i+4*t;e.resize(r),e.float32.fill(-1/0,4*i,4*r)}function Ex(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t[3]=i[3]*r+i[7]*n+i[15],t}const Sx=(t,e,i)=>(1-i)*t+i*e,Ax=t=>t*t*t*t*t;class Mx{constructor(t,e,i,r,n,o,s){this.tileSize=512,this._renderWorldCopies=void 0===n||n,this._minZoom=t||0,this._maxZoom=e||22,this._minPitch=null==i?0:i,this._maxPitch=null==r?60:r,this.setProjection(o),this.setMaxBounds(s),this.width=0,this.height=0,this._center=new mp(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Wv,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Jv,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const t=new Mx(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(t,e=!1){const i=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||i)&&this._updateCameraOnTerrain(),(t||i)&&this._constrainCamera(e),this._calcMatrices()}getProjection(){return F(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const e=this.projection?this.getProjection():void 0;this.projection=cy(this.projectionOptions);const i=!x(e,this.getProjection());return i&&this._calcMatrices(),this.mercatorFromTransition=!1,i}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=cy({name:"mercator"});const e=t!==this.projection.name;return e&&this._calcMatrices(),e}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return vp(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new v(this.width,this.height)}get bearing(){return D(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const e=-t*Math.PI/180;this.angle!==e&&(this._unmodified=!1,this.angle=e,this._calcMatrices(),this.rotationMatrix=Wh.create(),Wh.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const e=R(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==e&&(this._unmodified=!1,this._pitch=e,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=T(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._setZoom(e),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,e=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!e||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const i=this._elevation;e||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&i.exaggeration()&&this._centerAltitudeValidForExaggeration!==i.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*i.exaggeration(),this._centerAltitudeValidForExaggeration=i.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=i.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,e=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],i=this.horizonLineFromTop();let r=0,n=0;for(let o=0;o<e.length;o++){const s=new v(e[o][0]*this.width,i+e[o][1]*(this.height-i)),a=t.pointCoordinate(s);if(!a)continue;const l=1/Math.hypot(a[0]-this._camera.position[0],a[1]-this._camera.position[1]);r+=a[3]*l,n+=l}return 0===n?NaN:r/n}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const t=this._seaLevelZoom,e=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),i=this.pixelsPerMeter/this.worldSize*e,r=this._mercatorZfromZoom(t),n=this._mercatorZfromZoom(this._maxZoom),o=Math.max(r-i,n);this._setZoom(this._zoomFromMercatorZ(o))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const e=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let i;i=t.z<this._camera.position[2]?[e.x,e.y,e.z]:[t.x,t.y,t.z];const r=nd.length(nd.sub([],this._camera.position,i));return R(this._zoomFromMercatorZ(r),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height)return;if(!t.position&&!t.orientation)return;this._updateCameraState();let e=!1;if(t.orientation&&!td.exactEquals(t.orientation,this._camera.orientation)&&(e=this._setCameraOrientation(t.orientation)),t.position){const i=[t.position.x,t.position.y,t.position.z];nd.exactEquals(i,this._camera.position)||(this._setCameraPosition(i),e=!0)}e&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,e=new Kv;return e.position=new Ip(t[0],t[1],t[2]),e.orientation=this._camera.orientation,e._elevation=this.elevation,e._renderWorldCopies=this.renderWorldCopies,e}_setCameraOrientation(t){if(!td.length(t))return!1;td.normalize(t,t);const e=nd.transformQuat([],[0,0,-1],t),i=nd.transformQuat([],[0,-1,0],t);if(i[2]<0)return!1;const r=Zv(e,i);return!!r&&(this._camera.orientation=r,!0)}_setCameraPosition(t){const e=this.zoomScale(this.minZoom)*this.tileSize,i=this.zoomScale(this.maxZoom)*this.tileSize,r=this.cameraToCenterDistance;t[2]=R(t[2],r/i,r/e),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,e,i){this._unmodified=!1,this._edgeInsets.interpolate(t,e,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)}getVisibleUnwrappedCoordinates(t){const e=[new md(0,t)];if(this.renderWorldCopies){const i=this.pointCoordinate(new v(0,0)),r=this.pointCoordinate(new v(this.width,0)),n=this.pointCoordinate(new v(this.width,this.height)),o=this.pointCoordinate(new v(0,this.height)),s=Math.floor(Math.min(i.x,r.x,n.x,o.x)),a=Math.floor(Math.max(i.x,r.x,n.x,o.x)),l=1;for(let i=s-l;i<=a+l;i++)0!==i&&e.push(new md(i,t))}return e}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(t,e,i){let r=[];if(0===e[0]&&0===e[1])return r;for(const i of t){const t=i.canonical,n=i.overscaledZ,o=i.wrap,s=1<<t.z,a=t.x+1<s,l=t.x>0,c=t.y+1<s,u=t.y>0,h=i.wrap-(l?0:1),d=i.wrap+(a?0:1),p=l?t.x-1:s-1,f=a?t.x+1:0;e[0]<0?(r.push(new gd(n,d,t.z,f,t.y)),e[1]<0&&c&&(r.push(new gd(n,o,t.z,t.x,t.y+1)),r.push(new gd(n,d,t.z,f,t.y+1))),e[1]>0&&u&&(r.push(new gd(n,o,t.z,t.x,t.y-1)),r.push(new gd(n,d,t.z,f,t.y-1)))):e[0]>0?(r.push(new gd(n,h,t.z,p,t.y)),e[1]<0&&c&&(r.push(new gd(n,o,t.z,t.x,t.y+1)),r.push(new gd(n,h,t.z,p,t.y+1))),e[1]>0&&u&&(r.push(new gd(n,o,t.z,t.x,t.y-1)),r.push(new gd(n,h,t.z,p,t.y-1)))):e[1]<0&&c?r.push(new gd(n,o,t.z,t.x,t.y+1)):u&&r.push(new gd(n,o,t.z,t.x,t.y-1))}if(r.length>1){r.sort((t,e)=>t.overscaledZ-e.overscaledZ||t.wrap-e.wrap||t.canonical.z-e.canonical.z||t.canonical.x-e.canonical.x||t.canonical.y-e.canonical.y);let t=0,e=0;for(;e<r.length;)r[e].equals(r[t])?++e:r[++t]=r[e++];r.length=t+1}const n=[];for(const t of r)r.some(e=>t.isChildOf(e))||n.push(t);return r=n.filter(e=>!t.some(t=>!!(e.overscaledZ<i&&t.isChildOf(e))||e.equals(t)||e.isChildOf(t))),r}coveringTiles(t){let e=this.coveringZoomLevel(t);const i=e,r=this.elevation&&this.elevation.exaggeration(),n=r&&!t.isTerrainDEM,o="mercator"===this.projection.name;if(void 0!==t.minzoom&&e<t.minzoom)return[];void 0!==t.maxzoom&&e>t.maxzoom&&(e=t.maxzoom);const s=this.locationCoordinate(this.center),a=this.center.lat,l=1<<e,c=[l*s.x,l*s.y,0],u="globe"===this.projection.name,h=!u,d=Sd.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,e,h),p=u?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),f=l*vp(1,this.center.lat),m=this._camera.position[2]/vp(1,this.center.lat),g=[l*p.x,l*p.y,m*(h?1:f)],_=u||r,y=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),v=this.isLODDisabled(!0)?e:0;let x;if(this._elevation&&t.isTerrainDEM)x=1e4*this._elevation.exaggeration();else if(this._elevation){const t=this._elevation.getMinMaxForVisibleTiles();x=t?t.max:this._centerAltitude}else x=this._centerAltitude;const b=t.isTerrainDEM?-x:this._elevation?this._elevation.getMinElevationBelowMSL():0,w=this.projection.isReprojectedInTileSpace?tx(this):1,T=t=>{const e=1/4e4,i=new Ip(t.x+e,t.y,t.z),r=new Ip(t.x,t.y+e,t.z),n=t.toLngLat(),o=i.toLngLat(),s=r.toLngLat(),a=this.locationCoordinate(n),l=this.locationCoordinate(o),c=this.locationCoordinate(s),u=Math.hypot(l.x-a.x,l.y-a.y),h=Math.hypot(c.x-a.x,c.y-a.y);return Math.sqrt(u*h)*w/e},E=t=>{const e=x,i=b;return{aabb:U_(this,l,0,0,0,t,i,e,this.projection),zoom:0,x:0,y:0,minZ:i,maxZ:e,wrap:t,fullyVisible:!1}},A=[];let M=[];const I=e,C=t.reparseOverscaled?i:e,P=t=>t*t,R=P((m-this._centerAltitude)*f),O=t=>{if(!this._elevation||!t.tileID||!o)return;const e=this._elevation.getMinMaxForTile(t.tileID),i=t.aabb;e?(i.min[2]=e.min,i.max[2]=e.max,i.center[2]=(i.min[2]+i.max[2])/2):(t.shouldSplit=D(t),t.shouldSplit||(i.min[2]=i.max[2]=i.center[2]=this._centerAltitude))},D=t=>{if(t.zoom<v)return!0;if(t.zoom===I)return!1;if(null!=t.shouldSplit)return t.shouldSplit;const e=t.aabb.distanceX(g),r=t.aabb.distanceY(g);let o=R,s=1;if(u){o=P(t.aabb.distanceZ(g));const e=Math.pow(2,t.zoom),i=bp((t.y+1)/e),r=bp(t.y/e),n=Math.min(Math.max(a,i),r),l=gp(n)/gp(a);if(s=n===a?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,l/this._mercatorScaleRatio),this.zoom<=5&&t.zoom===I-1&&l>=.9)return!0}else if(n&&(o=P(t.aabb.distanceZ(g)*f)),this.projection.isReprojectedInTileSpace&&i<=5){const e=Math.pow(2,t.zoom),i=T(new Ip((t.x+.5)/e,(t.y+.5)/e));s=i>.85?1:i}const l=e*e+r*r+o;return l<P((1<<I-t.zoom)*y*s*((t,e)=>{if(e*P(.707)<t)return 1;const i=Math.sqrt(e/t);return i/(1.4144271570014144+(Math.pow(1.1,i-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(o,R),l))};if(this.renderWorldCopies)for(let t=1;t<=3;t++)A.push(E(-t)),A.push(E(t));for(A.push(E(0));A.length>0;){const i=A.pop(),r=i.x,s=i.y;let a=i.fullyVisible;const h=()=>"globe"===this.projection.name&&(0===i.y||i.y===(1<<i.zoom)-1);if(!a){let t=_?i.aabb.intersects(d):i.aabb.intersectsFlat(d);if(0===t&&h()){const e=new fd(i.zoom,r,s);t=Ud(this,l,e,!0).intersects(d)}if(0===t)continue;a=2===t}if(i.zoom!==I&&D(i))for(let t=0;t<4;t++){const e=(r<<1)+t%2,c=(s<<1)+(t>>1),h={aabb:o?i.aabb.quadrant(t):U_(this,l,i.zoom+1,e,c,i.wrap,i.minZ,i.maxZ,this.projection),zoom:i.zoom+1,x:e,y:c,wrap:i.wrap,fullyVisible:a,tileID:void 0,shouldSplit:void 0,minZ:i.minZ,maxZ:i.maxZ};n&&!u&&(h.tileID=new gd(i.zoom+1===I?C:i.zoom+1,i.wrap,i.zoom+1,e,c),O(h)),A.push(h)}else{const n=i.zoom===I?C:i.zoom;if(t.minzoom&&t.minzoom>n)continue;if(!a){let t=_?i.aabb.intersectsPrecise(d):i.aabb.intersectsPreciseFlat(d);if(0===t&&h()){const e=new fd(i.zoom,r,s);t=Ud(this,l,e,!0).intersectsPrecise(d)}if(0===t)continue}const o=c[0]-(.5+r+(i.wrap<<i.zoom))*(1<<e-i.zoom),u=c[1]-.5-s,p=i.tileID?i.tileID:new gd(n,i.wrap,i.zoom,r,s);M.push({tileID:p,distanceSq:o*o+u*u})}}if(this.fogCullDistSq){const e=this.fogCullDistSq,i=this.horizonLineFromTop();M=M.filter(r=>{const n=[0,0,0,1],o=[ur,ur,0,1],s=this.calculateFogTileMatrix(r.tileID.toUnwrapped());Xh.transformMat4(n,n,s),Xh.transformMat4(o,o,s);const a=function(t,e,i){let r=0;for(let i=0;i<2;++i){const n=0;t[i]>n&&(r+=(t[i]-n)*(t[i]-n)),e[i]<n&&(r+=(n-e[i])*(n-e[i]))}return r}(Xh.min([],n,o),Xh.max([],n,o));if(0===a)return!0;let l=!1;const c=this._elevation;if(c&&a>e&&0!==i){const e=this.calculateProjMatrix(r.tileID.toUnwrapped());let n;t.isTerrainDEM||(n=c.getMinMaxForTile(r.tileID)),n||(n={min:b,max:x});const o=function(t){const e=Math.round((t+45+360)%360/90)%4;return S[e]}(this.rotation),s=[o[0]*ur,o[1]*ur,n.max];nd.transformMat4(s,s,e),l=(1-s[1])*this.height*.5<i}return a<e||l})}return M.sort((t,e)=>t.distanceSq-e.distanceSq).map(t=>t.tileID)}resize(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const e=R(t.lat,-Tp,Tp),i=this.projection.project(t.lng,e);return new v(i.x*this.worldSize,i.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/vp(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,e){let i,r;const n=this.centerPoint;if("globe"===this.projection.name){const t=this.worldSize;i=(e.x-n.x)/t,r=(e.y-n.y)/t}else{const t=this.pointCoordinate(e),o=this.pointCoordinate(n);i=t.x-o.x,r=t.y-o.y}const o=this.locationCoordinate(t);this.setLocation(new Ip(o.x-i,o.y-r))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,e){const i=e?vp(e,t.lat):void 0,r=this.projection.project(t.lng,t.lat);return new Ip(r.x,r.y,i)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,e){const i=null!=e?e:this._centerAltitude,r=[t.x,t.y,0,1],n=[t.x,t.y,1,1];Xh.transformMat4(r,r,this.pixelMatrixInverse),Xh.transformMat4(n,n,this.pixelMatrixInverse);const o=n[3];Xh.scale(r,r,1/r[3]),Xh.scale(n,n,1/o);const s=r[2],a=n[2];return{p0:r,p1:n,t:s===a?0:(i-s)/(a-s)}}screenPointToMercatorRay(t){const e=[t.x,t.y,0,1],i=[t.x,t.y,1,1];return Xh.transformMat4(e,e,this.pixelMatrixInverse),Xh.transformMat4(i,i,this.pixelMatrixInverse),Xh.scale(e,e,1/e[3]),Xh.scale(i,i,1/i[3]),e[2]=vp(e[2],this._center.lat)*this.worldSize,i[2]=vp(i[2],this._center.lat)*this.worldSize,Xh.scale(e,e,1/this.worldSize),Xh.scale(i,i,1/this.worldSize),new vd([e[0],e[1],e[2]],nd.normalize([],nd.sub([],i,e)))}rayIntersectionCoordinate(t){const{p0:e,p1:i,t:r}=t,n=vp(e[2],this._center.lat),o=vp(i[2],this._center.lat);return new Ip(Yr(e[0],i[0],r)/this.worldSize,Yr(e[1],i[1],r)/this.worldSize,Yr(n,o,r))}pointCoordinate(t,e=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,e)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let e=this.projection.pointCoordinate3D(this,t.x,t.y);if(e)return new Ip(e[0],e[1],e[2]);let i=0,r=this.horizonLineFromTop();if(t.y>r)return this.pointCoordinate(t);const n=.02*r,o=t.clone();for(let t=0;t<10&&r-i>n;t++){o.y=Yr(i,r,.66);const t=this.projection.pointCoordinate3D(this,o.x,o.y);t?(r=o.y,e=t):i=o.y}return e?new Ip(e[0],e[1],e[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=6)return!this.isPointAboveHorizon(t);const e=this.pointCoordinate(t);return e.y>=0&&e.y<=1}_coordinatePoint(t,e){const i=e&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,r=[t.x*this.worldSize,t.y*this.worldSize,i+t.toAltitude(),1];return Xh.transformMat4(r,r,this.pixelMatrix),r[3]>0?new v(r[0]/r[3],r[1]/r[3]):new v(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:e}=this._edgeInsets,i=this.height-this._edgeInsets.bottom,r=this.width-this._edgeInsets.right,n=this.pointLocation3D(new v(e,t)),o=this.pointLocation3D(new v(r,t)),s=this.pointLocation3D(new v(r,i)),a=this.pointLocation3D(new v(e,i));let l=Math.min(n.lng,o.lng,s.lng,a.lng),c=Math.max(n.lng,o.lng,s.lng,a.lng),u=Math.min(n.lat,o.lat,s.lat,a.lat),h=Math.max(n.lat,o.lat,s.lat,a.lat);const d=Math.pow(2,-this.zoom)/16*270,p="globe"===this.projection.name?1:4,f=(t,e,i,r,n)=>{const o=(t+i)/2,s=(e+r)/2,a=new v(o,s),{lng:m,lat:g}=this.pointLocation3D(a),_=Math.max(0,l-m,u-g,m-c,g-h);l=Math.min(l,m),c=Math.max(c,m),u=Math.min(u,g),h=Math.max(h,g),(n<p||_>d)&&(f(t,e,o,s,n+1),f(o,s,i,r,n+1))};if(f(e,t,r,t,1),f(r,t,r,i,1),f(r,i,e,i,1),f(e,i,e,t,1),"globe"===this.projection.name){const[t,e]=function(t){const e=Jh.identity(new Float64Array(16));Jh.multiply(e,t.pixelMatrix,t.globeMatrix);const i=[0,Cd,0],r=[0,Pd,0];return nd.transformMat4(i,i,e),nd.transformMat4(r,r,e),[i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!ap(t,new mp(t.center.lat,90)),r[0]>0&&r[0]<=t.width&&r[1]>0&&r[1]<=t.height&&!ap(t,new mp(t.center.lat,-90))]}(this);t?(h=90,c=180,l=-180):e&&(u=-90,c=180,l=-180)}return new Nc(new mp(l,u),new mp(c,h))}_getBoundsRectangular(t,e){const{top:i,left:r}=this._edgeInsets,n=this.height-this._edgeInsets.bottom,o=this.width-this._edgeInsets.right,s=new v(r,i),a=new v(o,i),l=new v(o,n),c=new v(r,n);let u=this.pointCoordinate(s,t),h=this.pointCoordinate(a,t);const d=this.pointCoordinate(l,e),p=this.pointCoordinate(c,e),f=(t,e)=>(e.y-t.y)/(e.x-t.x);return u.y>1&&h.y>=0?u=new Ip((1-p.y)/f(p,u)+p.x,1):u.y<0&&h.y<=1&&(u=new Ip(-p.y/f(p,u)+p.x,0)),h.y>1&&u.y>=0?h=new Ip((1-d.y)/f(d,h)+d.x,1):h.y<0&&u.y<=1&&(h=new Ip(-d.y/f(d,h)+d.x,0)),(new Nc).extend(this.coordinateLocation(u)).extend(this.coordinateLocation(h)).extend(this.coordinateLocation(p)).extend(this.coordinateLocation(d))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const e=t.visibleDemTiles.reduce((t,e)=>{if(e.dem){const i=e.dem.tree;t.min=Math.min(t.min,i.minimums[0]),t.max=Math.max(t.max,i.maximums[0])}return t},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(e.min*t.exaggeration(),e.max*t.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const e=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,i=this.height/2-e*(1-this._horizonShift);return t?Math.max(0,i):i}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-Tp,this.maxLat=Tp,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=_p(this.minLng)*this.tileSize,this.worldMaxX=_p(this.maxLng)*this.tileSize,this.worldMinY=yp(this.maxLat)*this.tileSize,this.worldMaxY=yp(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,e){return this.projection.createTileMatrix(this,e,t)}calculateDistanceTileData(t){const e=t.key,i=this._distanceTileDataCache;if(i[e])return i[e];const r=t.canonical,n=1/this.height,o=this.cameraWorldSize,s=o/this.zoomScale(r.z),a=(r.x+Math.pow(2,r.z)*t.wrap)*s,l=r.y*s,c=this.point;c.x*=o/this.worldSize,c.y*=o/this.worldSize;const u=this.angle,h=Math.sin(-u),d=-Math.cos(-u);return i[e]={bearing:[h,d],center:[(c.x-a)*n,(c.y-l)*n],scale:s/ur*n},i[e]}calculateFogTileMatrix(t){const e=t.key,i=this._fogTileMatrixCache;if(i[e])return i[e];const r=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return Jh.multiply(r,this.worldToFogMatrix,r),i[e]=new Float32Array(r),i[e]}calculateProjMatrix(t,e=!1,i=!1){const r=t.key;let n;if(n=i?this._expandedProjMatrixCache:e?this._alignedProjMatrixCache:this._projMatrixCache,n[r])return n[r];const o=this.calculatePosMatrix(t,this.worldSize);let s;return s=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:i?this.expandedFarZProjMatrix:e?this.alignedProjMatrix:this.projMatrix,Jh.multiply(o,s,o),n[r]=new Float32Array(o),n[r]}calculatePixelsToTileUnitsMatrix(t){const e=t.tileID.key,i=this._pixelsToTileUnitsCache;if(i[e])return i[e];const r=function(t,e){const{scale:i}=t.tileTransform,r=i*ur/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return Wh.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[r,r])}(t,this);return i[e]=r,i[e]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const t=1/this.worldSize,e=Jh.fromScaling([],[t,t,t]);return Jh.multiply(e,e,this.globeMatrix),e}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const e=vp(1,this._center.lat)*this.worldSize,i=this._computeCameraPosition(e),r=this._camera.forward(),n=vp(1,this._center.lat);i[2]/=n,r[2]/=n,nd.normalize(r,r);const o=t.raycast(i,r,t.exaggeration());if(o){const t=nd.scaleAndAdd([],i,r,o),e=new Ip(t[0],t[1],vp(t[2],bp(t[1]))),s=(e.z+nd.length([e.x-i[0],e.y-i[1],e.z-i[2]*n]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(s),this._centerAltitude=e.toAltitude(),this._center=this.coordinateLocation(e),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const e=this._elevation,i=vp(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(i),n=e.getAtPointOrZero(new Ip(...r)),o=this.pixelsPerMeter/this.worldSize*n,s=this._minimumHeightOverTerrain(),a=r[2]-o;if(a<=s)if(a<0||t){const t=this.locationCoordinate(this._center,this._centerAltitude),e=[r[0],r[1],t.z-r[2]],i=nd.length(e);e[2]-=(s-a)/this._pixelsPerMercatorPixel;const n=nd.length(e);if(0===n)return;nd.scale(e,e,i/n*this._pixelsPerMercatorPixel),this._camera.position=[r[0],r[1],t.z*this._pixelsPerMercatorPixel-e[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const e=this.center;return e.lat=R(e.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(e.lng=R(e.lng,this.minLng,this.maxLng)),this.center=e,void(this._constraining=!1)}const e=this._unmodified,{x:i,y:r}=this.point;let n=0,o=i,s=r;const a=this.width/2,l=this.height/2,c=this.worldMinY*this.scale,u=this.worldMaxY*this.scale;if(r-l<c&&(s=c+l),r+l>u&&(s=u-l),u-c<this.height&&(n=Math.max(n,this.height/(u-c)),s=(u+c)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const t=this.worldMinX*this.scale,e=this.worldMaxX*this.scale,r=this.worldSize/2-(t+e)/2;o=(i+r+this.worldSize)%this.worldSize-r,o-a<t&&(o=t+a),o+a>e&&(o=e-a),e-t<this.width&&(n=Math.max(n,this.width/(e-t)),o=(e+t)/2)}o===i&&s===r||(this.center=this.unproject(new v(o,s))),n&&(this.zoom+=this.scaleZoom(n)),this._constrainCamera(),this._unmodified=e,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,e="globe"===this.projection.name,i=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=vp(1,this.center.lat)/vp(1,45));const r=ex(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,r),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const n="meters"===this.projection.zAxisUnit?i:1,o=this._camera.getWorldToCamera(this.worldSize,n);let s;const a=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(a[8]=2*-t.x/this.width,a[9]=2*t.y/this.height,this.isOrthographic){let e=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),i=e*this.aspect,r=-i,n=-e;i-=t.x,r-=t.x,e+=t.y,n+=t.y,s=this._camera.getCameraToClipOrthographic(r,i,n,e,this._nearZ,this._farZ),((t,e,i,r)=>{for(let n=0;n<16;n++)t[n]=Sx(e[n],i[n],r)})(s,s,a,Ax(this.pitch>=15?1:this.pitch/15))}else s=a;const l=Jh.mul([],a,o);let c=Jh.mul([],s,o);if(this.projection.isReprojectedInTileSpace){const t=this.locationCoordinate(this.center),e=Jh.identity([]);Jh.translate(e,e,[t.x*this.worldSize,t.y*this.worldSize,0]),Jh.multiply(e,e,Qv(this)),Jh.translate(e,e,[-t.x*this.worldSize,-t.y*this.worldSize,0]),Jh.multiply(c,c,e),Jh.multiply(l,l,e),this.inverseAdjustmentMatrix=function(t){const e=Qv(t,!0);return Wh.invert([],[e[0],e[1],e[4],e[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=Jh.scale([],c,[this.worldSize,this.worldSize,this.worldSize/n,1]),this.projMatrix=c,this.invProjMatrix=Jh.invert(new Float64Array(16),this.projMatrix),e){const e=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);e[8]=2*-t.x/this.width,e[9]=2*t.y/this.height,this.expandedFarZProjMatrix=Jh.mul([],e,o)}else this.expandedFarZProjMatrix=this.projMatrix;const u=Jh.invert([],s);this.frustumCorners=xd.fromInvProjectionMatrix(u,this.horizonLineFromTop(),this.height),this.cameraFrustum=Sd.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!e);const h=new Float32Array(16);Jh.identity(h),Jh.scale(h,h,[1,-1,1]),Jh.rotateX(h,h,this._pitch),Jh.rotateZ(h,h,this.angle);const d=Jh.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=Jh.clone(d);const p=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;d[8]=2*-t.x/this.width,d[9]=2*(t.y+p)/this.height,this.skyboxMatrix=Jh.multiply(h,d,h);const f=this.point,m=f.x,g=f.y,_=this.width%2/2,y=this.height%2/2,v=Math.cos(this.angle),x=Math.sin(this.angle),b=m-Math.round(m)+v*_+x*y,w=g-Math.round(g)+v*y+x*_,T=new Float64Array(c);if(Jh.translate(T,T,[b>.5?b-1:b,w>.5?w-1:w,0]),this.alignedProjMatrix=T,c=Jh.create(),Jh.scale(c,c,[this.width/2,-this.height/2,1]),Jh.translate(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=Jh.create(),Jh.scale(c,c,[1,-1,1]),Jh.translate(c,c,[-1,-1,0]),Jh.scale(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.pixelMatrix=Jh.multiply(new Float64Array(16),this.labelPlaneMatrix,l),this._calcFogMatrices(),this._distanceTileDataCache={},c=Jh.invert(new Float64Array(16),this.pixelMatrix),!c)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=c,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=function(t){const{x:e,y:i}=t.point,{lng:r,lat:n}=t._center;return Jd(e,i,t.worldSize,r,n)}(this);const t=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=nd.transformMat4(t,t,o),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=c;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,e=this.cameraPixelsPerMeter,i=this._camera.position,r=1/this.height/this._pixelsPerMercatorPixel,n=[t,t,e];nd.scale(n,n,r),nd.scale(i,i,-1),nd.multiply(i,i,n);const o=Jh.create();Jh.translate(o,o,i),Jh.scale(o,o,n),this.mercatorFogMatrix=o,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,e,r)}_computeCameraPosition(t){const e=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,i=this._camera.forward(),r=this.point,n=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*e-t/this.worldSize*this._centerAltitude;return[r.x/this.worldSize-i[0]*n,r.y/this.worldSize-i[1]*n,t/this.worldSize*this._centerAltitude-i[2]*n]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const e=this._maxCameraBoundsDistance()*Math.cos(this._pitch),i=this._camera.position[2],r=t[2];let n=1;this.projection.wrap&&(this.center=this.center.wrap()),r>0&&(n=Math.min((e-i)/r,1)),this._camera.position=nd.scaleAndAdd([],this._camera.position,t,n),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,e=this._camera.forward(),{pitch:i,bearing:r}=this._camera.getPitchBearing(),n=vp(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,o=this._mercatorZfromZoom(this._maxZoom)*Math.cos(T(this._maxPitch)),s=Math.max((t[2]-n)/Math.cos(i),o),a=this._zoomFromMercatorZ(s);nd.scaleAndAdd(t,t,e,s),this._pitch=R(i,T(this.minPitch),T(this.maxPitch)),this.angle=D(r,-Math.PI,Math.PI),this._setZoom(R(a,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new Ip(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let e=0,i=6,r=0,n=1/0;for(;i-e>1e-6&&i>e;){const o=e+.5*(i-e),s=this.tileSize*Math.pow(2,o),a=this.getCameraToCenterDistance(this.projection,o,s),l=this.scaleZoom(a/(t*this.tileSize)),c=Math.abs(o-l);c<n&&(n=c,r=o),o<l?e=o:i=o}return r}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(Y("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,e){const i=Math.min(t.x,e.x),r=Math.max(t.x,e.x),n=Math.min(t.y,e.y),o=Math.max(t.y,e.y);if(n<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const s=[new v(i,n),new v(r,o),new v(i,o),new v(r,n)],a=this.renderWorldCopies?-3:0,l=this.renderWorldCopies?4:1;for(const t of s){const e=this.pointRayIntersection(t);if(e.t<0)return!0;const i=this.rayIntersectionCoordinate(e);if(i.x<a||i.y<0||i.x>l||i.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+E(this.fovAboveCenter)>88||this.anyCornerOffEdge(new v(0,0),new v(this.width,this.height))}zoomDeltaToMovement(t,e){const i=nd.length(nd.sub([],this._camera.position,t)),r=this._zoomFromMercatorZ(i)+e;return i-this._mercatorZfromZoom(r)}getCameraPoint(){if("globe"===this.projection.name){const t=function([t,e,i],r){const n=[t,e,i,1];Xh.transformMat4(n,n,r);const o=n[3]=Math.max(n[3],1e-6);return n[0]/=o,n[1]/=o,n[2]/=o,n}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new v(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new v(0,t))}}getCameraToCenterDistance(t,e=this.zoom,i=this.worldSize){const r=ex(t,e,this.width,this.height,1024),n=t.pixelSpaceConversion(this.center.lat,i,r);let o=.5/Math.tan(.5*this._fov)*this.height*n;return this.isOrthographic&&(o=Sx(1,o,Ax(this.pitch>=15?1:this.pitch/15))),o}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&Jh.multiply(t,t,this.globeMatrix),t}getFrustum(t){return Sd.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,"meters"===this.projection.zAxisUnit)}}function Ix(t,e,i){Jh.identity(t),Jh.rotateZ(t,t,T(e[2])),Jh.rotateX(t,t,T(e[0])),Jh.rotateY(t,t,T(e[1])),Jh.scale(t,t,i),Jh.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Cx(t,e,i,r,n,o,s,a){const l=[i[0]-e[0],i[1]-e[1],0],c=[r[0]-e[0],r[1]-e[1],0];if(nd.length(l)<1e-12||nd.length(c)<1e-12)return td.identity(t);const u=nd.cross([],l,c);nd.normalize(u,u),nd.subtract(c,r,e),l[2]=(o-n)*a,c[2]=(s-n)*a;const h=l;return nd.cross(h,l,c),nd.normalize(h,h),td.rotationTo(t,u,h)}function Px(t,e,i=!1){const r=tp(e.zoom),n=function(t,e,i){const r=e.worldSize,n=[t[12],t[13],t[14]],o=bp(n[1]/r),s=xp(n[0]/r),a=Jh.identity([]),l=vp(1,o)*r,c=vp(1,0)*r*Sp(o,e.zoom),u=1/Zd(r);let h=c*u;if(i){const t=ex(e.projection,e.zoom,e.width,e.height,1024);h=u*e.projection.pixelSpaceConversion(e.center.lat,r,t)}const d=Xd(o,s);nd.add(d,d,nd.scale([],nd.normalize([],d),l*h*n[2]));const p=function(t){const e=[t[0],t[1],t[2]];let i=[0,1,0];const r=nd.cross([],i,e);return nd.cross(i,e,r),0===nd.squaredLength(i)&&(i=[0,1,0],nd.cross(r,e,i)),nd.normalize(r,r),nd.normalize(i,i),nd.normalize(e,e),[r[0],r[1],r[2],0,i[0],i[1],i[2],0,e[0],e[1],e[2],0,t[0],t[1],t[2],1]}(d);Jh.scale(a,a,[h,h,h*l]),Jh.translate(a,a,[-n[0],-n[1],-n[2]]);const f=Jh.multiply([],e.globeMatrix,p);return Jh.multiply(f,f,a),Jh.multiply(f,f,t),f}(t,e,i);return r>0?function(t,e,i){const r=(t,e,i)=>{const r=nd.length(t),n=nd.length(e),o=Fd(t,e,i);return nd.scale(o,o,1/nd.length(o)*Yr(r,n,i))},n=r([t[0],t[1],t[2]],[e[0],e[1],e[2]],i),o=r([t[4],t[5],t[6]],[e[4],e[5],e[6]],i),s=r([t[8],t[9],t[10]],[e[8],e[9],e[10]],i),a=Fd([t[12],t[13],t[14]],[e[12],e[13],e[14]],i);return[n[0],n[1],n[2],0,o[0],o[1],o[2],0,s[0],s[1],s[2],0,a[0],a[1],a[2],1]}(n,function(t,e){const i=e.worldSize,r=vp(1,0)*i*Sp(e.center.lat,e.zoom)/Zd(i),n=vp(1,e.center.lat)*i,o=Jh.identity([]);return Jh.rotateY(o,o,T(e.center.lng)),Jh.rotateX(o,o,T(e.center.lat)),Jh.translate(o,o,[0,0,Md]),Jh.scale(o,o,[r,r,r*n]),Jh.translate(o,o,[e.point.x-.5*i,e.point.y-.5*i,0]),Jh.multiply(o,o,t),Jh.multiply(o,e.globeMatrix,o)}(t,e),r):n}const Rx=[1,1,1];class Ox{constructor(t,e,i,r){this.id=t,this.position=null!=e?new mp(e[0],e[1]):new mp(0,0),this.orientation=null!=i?i:[0,0,0],this.nodes=r,this.uploaded=!1,this.aabb=new Ad([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(Jh.multiply(t.matrix,e,t.matrix),t.meshes)for(const e of t.meshes){const i=Ad.applyTransform(e.aabb,t.matrix);this.aabb.encapsulate(i)}if(t.children)for(const e of t.children)this._applyTransformations(e,t.matrix)}computeBoundsAndApplyParent(){const t=Jh.identity([]);for(const e of this.nodes)this._applyTransformations(e,t)}_positionModelOnTerrain(t,e){const i=t.elevation;if(!i)return 0;const r=Ad.projectAabbCorners(this.aabb,this.matrix),n=vp(1,this.position.lat)*t.worldSize,o=function(t,e){const i=[0,0,1],r=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const n of r){const r=t[n.corners[0]],o=t[n.corners[1]],s=t[n.corners[2]],a=[o[0]-r[0],o[1]-r[1],e*(o[2]-r[2])],l=nd.cross(a,a,[s[0]-r[0],s[1]-r[1],e*(s[2]-r[2])]);nd.normalize(l,l),n.dotProductWithUp=nd.dot(l,i)}return r.sort((t,e)=>t.dotProductWithUp-e.dotProductWithUp),r[0].corners}(r,n),s=r[o[0]],a=r[o[1]],l=r[o[2]],c=r[o[3]],u=i.getAtPointOrZero(new Ip(s[0]/t.worldSize,s[1]/t.worldSize),0),h=i.getAtPointOrZero(new Ip(a[0]/t.worldSize,a[1]/t.worldSize),0),d=i.getAtPointOrZero(new Ip(l[0]/t.worldSize,l[1]/t.worldSize),0),p=i.getAtPointOrZero(new Ip(c[0]/t.worldSize,c[1]/t.worldSize),0),f=(u+p)/2,m=(h+d)/2;return f>m?h<d?Cx(e,a,c,s,h,p,u,n):Cx(e,l,s,c,d,u,p,n):u<p?Cx(e,s,a,l,u,h,d,n):Cx(e,c,l,a,p,d,h,n),Math.max(f,m)}computeModelMatrix(t,e,i,r,n,o,s=!1){const a=t.transform,l=a.zoom,c=a.project(this.position),u=Sp(this.position.lat,l),h=1/u;Jh.identity(this.matrix),Jh.translate(this.matrix,this.matrix,[c.x+r[0]*h,c.y+r[1]*h,r[2]]);let d=1,p=1;const f=a.worldSize;if(s){if("mercator"===a.projection.name){let t=0;a.elevation&&(t=a.elevation.getAtPointOrZero(new Ip(c.x/f,c.y/f),0));const e=Xh.transformMat4([],[c.x,c.y,t,1],a.projMatrix)[3]/a.cameraToCenterDistance;d=e,p=e*Sp(a.center.lat,l)}else if("globe"===a.projection.name){const t=Px(this.matrix,a),e=Jh.multiply([],a.projMatrix,t),i=[0,0,0,1];Xh.transformMat4(i,i,e);const r=i[3]/a.cameraToCenterDistance,n=tp(l),o=a.projection.pixelsPerMeter(this.position.lat,f)*Sp(this.position.lat,l),s=a.projection.pixelsPerMeter(a.center.lat,f)*Sp(a.center.lat,l);d=r/Yr(o,Ep(a.center.lat),n),p=r*u/o,d*=s,p*=s}}else d=h;Jh.scale(this.matrix,this.matrix,[d,d,p]);const m=[...this.matrix],g=this.orientation,_=[];if(Ix(_,[g[0]+e[0],g[1]+e[1],g[2]+e[2]],i),Jh.multiply(this.matrix,m,_),n&&a.elevation){let t=0;const e=[];if(o&&a.elevation){t=this._positionModelOnTerrain(a,e);const i=Jh.fromQuat([],e),r=Jh.multiply([],i,_);Jh.multiply(this.matrix,m,r)}else t=a.elevation.getAtPointOrZero(new Ip(c.x/f,c.y/f),0);0!==t&&(this.matrix[14]+=t)}}upload(t){if(!this.uploaded){for(const e of this.nodes)kx(e,t);for(const t of this.nodes)Bx(t);this.uploaded=!0}}destroy(){for(const t of this.nodes)Fx(t)}}function Dx(t,e,i=!1){t.uploaded||(t.gfxTexture=new Dy(e,t.image,i?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function Lx(t,e,i){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,Uv.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,Xv.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,Vv.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(12===t.colorArray.bytesPerElement?Gv:jv).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,qv.members,!0)),t.segments=Ql.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const r=t.material;r.pbrMetallicRoughness.baseColorTexture&&Dx(r.pbrMetallicRoughness.baseColorTexture,e),r.pbrMetallicRoughness.metallicRoughnessTexture&&Dx(r.pbrMetallicRoughness.metallicRoughnessTexture,e),r.normalTexture&&Dx(r.normalTexture,e),r.occlusionTexture&&Dx(r.occlusionTexture,e,i),r.emissionTexture&&Dx(r.emissionTexture,e)}function kx(t,e,i){if(t.meshes)for(const r of t.meshes)Lx(r,e,i);if(t.children)for(const r of t.children)kx(r,e,i)}function Bx(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)Bx(e)}function Fx(t){if(t.meshes)for(const i of t.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const e of t.children)Fx(e)}class zx{constructor(t,e){this.feature=t,this.instancedDataOffset=e,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Nx{constructor(){this.instancedDataArray=new Fl,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Ux{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.fqid),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(t,e,i,r){this.tileToMeter=Mp(i);const n=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:o,id:s,index:a,sourceLayerIndex:l}of t){const t=Fp(o,n);if(!this.layers[0]._featureFilter.filter(new Ua(this.zoom),t,i))continue;const c={id:s,sourceLayerIndex:l,index:a,geometry:n?t.geometry:Bp(o,i,r),properties:o.properties,type:o.type,patterns:{}},u=this.addFeature(c,c.geometry,t);u&&e.featureIndex.insert(o,c.geometry,a,l,this.index,this.instancesPerModel[u].instancedDataArray.length)}this.lookup=null}update(t,e,i,r){for(const e in this.instancesPerModel){const i=this.instancesPerModel[e];for(const e in t)i.idToFeaturesIndex.hasOwnProperty(e)&&this.evaluate(i.features[i.idToFeaturesIndex[e]],t[e],i,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const e in this.instancesPerModel){const i=this.instancesPerModel[e];for(const e of i.features){const r=this.layers[0],n=e.feature,o=this.canonical,s=r.paint.get("model-rotation").evaluate(n,{},o),a=r.paint.get("model-scale").evaluate(n,{},o),l=r.paint.get("model-translation").evaluate(n,{},o);nd.exactEquals(e.rotation,s)&&nd.exactEquals(e.scale,a)&&nd.exactEquals(e.translation,l)||(this.evaluate(e,e.featureStates,i,!0),t=!0)}}return t}isEmpty(){for(const t in this.instancesPerModel)if(0!==this.instancesPerModel[t].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const e in this.instancesPerModel){const i=this.instancesPerModel[e];i.instancedDataArray.length<0||0===i.instancedDataArray.length||(i.instancedDataBuffer?i.instancedDataBuffer.updateData(i.instancedDataArray):i.instancedDataBuffer=t.createVertexBuffer(i.instancedDataArray,Hv.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const t in this.instancesPerModel){const e=this.instancesPerModel[t];0!==e.instancedDataArray.length&&e.instancedDataBuffer&&e.instancedDataBuffer.destroy()}}addFeature(t,e,i){const r=this.layers[0],n=r.layout.get("model-id").evaluate(i,{},this.canonical);if(!n)return Y(`modelId is not evaluated for layer ${r.id} and it is not going to get rendered.`),n;this.instancesPerModel[n]||(this.instancesPerModel[n]=new Nx);const o=this.instancesPerModel[n],s=o.instancedDataArray,a=new zx(i,s.length);for(const t of e)for(const e of t){if(e.x<0||e.x>=ur||e.y<0||e.y>=ur)continue;const t=(this.lookupDim-1)/ur,i=this.lookupDim*(e.y*t|0)+e.x*t|0;if(this.lookup){if(0!==this.lookup[i])continue;this.lookup[i]=1}this.instanceCount++;const r=s.length;s.resize(r+1),o.instancesEvaluatedElevation.push(0),s.float32[16*r]=e.x,s.float32[16*r+1]=e.y}return a.instancedDataCount=o.instancedDataArray.length-a.instancedDataOffset,a.instancedDataCount>0&&(t.id&&(o.idToFeaturesIndex[t.id]=o.features.length),o.features.push(a),this.evaluate(a,{},o,!1)),n}evaluate(t,e,i,r){const n=this.layers[0],o=t.feature,s=this.canonical,a=t.rotation=n.paint.get("model-rotation").evaluate(o,e,s),l=t.scale=n.paint.get("model-scale").evaluate(o,e,s),c=t.translation=n.paint.get("model-translation").evaluate(o,e,s),u=n.paint.get("model-color").evaluate(o,e,s);u.a=n.paint.get("model-color-mix-intensity").evaluate(o,e,s);const h=[];this.maxVerticalOffset<c[2]&&(this.maxVerticalOffset=c[2]),this.maxScale=Math.max(Math.max(this.maxScale,l[0]),Math.max(l[1],l[2])),Ix(h,a,l);const d=Math.round(100*u.a)+u.b/1.05;for(let e=0;e<t.instancedDataCount;++e){const n=t.instancedDataOffset+e,o=16*n,a=i.instancedDataArray.float32;let l=0;r&&(l=a[o+6]-i.instancesEvaluatedElevation[n]);const p=0|a[o+1];a[o]=(0|a[o])+u.r/1.05,a[o+1]=p+u.g/1.05,a[o+2]=d,a[o+3]=1/(s.z>10?this.tileToMeter:Mp(s,p)),a[o+4]=c[0],a[o+5]=c[1],a[o+6]=c[2]+l,a[o+7]=h[0],a[o+8]=h[1],a[o+9]=h[2],a[o+10]=h[4],a[o+11]=h[5],a[o+12]=h[6],a[o+13]=h[8],a[o+14]=h[9],a[o+15]=h[10],i.instancesEvaluatedElevation[n]=c[2]}}}xs(Ux,"ModelBucket",{omit:["layers"]}),xs(Nx,"PerModelAttributes"),xs(zx,"ModelFeature");const Gx=new Ja({visibility:new Ya(Oe.layout_model.visibility),"model-id":new Za(Oe.layout_model["model-id"])});var jx={paint:new Ja({"model-opacity":new Ya(Oe.paint_model["model-opacity"]),"model-rotation":new Za(Oe.paint_model["model-rotation"]),"model-scale":new Za(Oe.paint_model["model-scale"]),"model-translation":new Za(Oe.paint_model["model-translation"]),"model-color":new Za(Oe.paint_model["model-color"]),"model-color-mix-intensity":new Za(Oe.paint_model["model-color-mix-intensity"]),"model-type":new Ya(Oe.paint_model["model-type"]),"model-cast-shadows":new Ya(Oe.paint_model["model-cast-shadows"]),"model-receive-shadows":new Ya(Oe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Ya(Oe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Za(Oe.paint_model["model-emissive-strength"]),"model-roughness":new Za(Oe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Za(Oe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Ya(Oe.paint_model["model-cutoff-fade-range"])}),layout:Gx};const Vx=new Float32Array(262144),Xx=new Uint8Array(262144);function Hx(t){let e=0;if(t.meshes)for(const i of t.meshes)e=Math.max(e,i.aabb.max[2]);if(t.children)for(const i of t.children)e=Math.max(e,Hx(i));return e}const qx=["","wall","door","roof","window","lamp","logo"];class Wx{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:t.id,geometry:[],properties:{height:Hx(t)}}}}class $x{constructor(t,e,i,r){this.nodes=t,this.id=e,this.modelTraits|=1,this.uploaded=!1,this.hasPattern=!1,i&&(this.modelTraits|=4),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=r,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const e=this.getNodesInfo();for(const i of e){const e=i.node;this.uploaded?this.updatePbrBuffer(e):kx(e,t,!0)}for(const t of e)Bx(t.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let e=!1;if(!t.meshes)return e;for(const i of t.meshes)i.pbrBuffer&&(i.pbrBuffer.updateData(i.featureArray),e=!0);return e}needsReEvaluation(t,e,i){const r=t.transform.projectionOptions,n=t.style.getBrightness(),o=this.brightness!==n;return!!(!this.uploaded||this.dirty||r.name!==this.projection.name||Yx(i.paint.get("model-color").value,o)||Yx(i.paint.get("model-color-mix-intensity").value,o)||Yx(i.paint.get("model-roughness").value,o)||Yx(i.paint.get("model-emissive-strength").value,o)||Yx(i.paint.get("model-height-based-emissive-strength-multiplier").value,o))&&(this.projection=r,this.brightness=n,!0)}evaluateScale(t,e){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const i=this.getNodesInfo(),r=this.id.canonical;for(const t of i){const i=t.feature;t.evaluatedScale=e.paint.get("model-scale").evaluate(i,{},r)}}evaluate(t){const e=this.getNodesInfo();for(const i of e){if(!i.node.meshes)continue;const e=i.feature,r=i.node.meshes&&i.node.meshes[0].featureData,n=i.evaluatedColor[2],o=i.evaluatedRMEA[2],s=this.id.canonical;if(i.hasTranslucentParts=!1,r){for(let r=0;r<qx.length;r++){const n=qx[r];n.length&&(e.properties.part=n);const o=t.paint.get("model-color").evaluate(e,{},s),a=t.paint.get("model-color-mix-intensity").evaluate(e,{},s);i.evaluatedColor[r]=[o.r,o.g,o.b,a],i.evaluatedRMEA[r][0]=t.paint.get("model-roughness").evaluate(e,{},s),i.evaluatedRMEA[r][2]=t.paint.get("model-emissive-strength").evaluate(e,{},s),i.evaluatedRMEA[r][3]=o.a,i.emissionHeightBasedParams[r]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(e,{},s),!i.hasTranslucentParts&&o.a<1&&(i.hasTranslucentParts=!0)}delete e.properties.part,Kx(i,n!==i.evaluatedColor[2]||o!==i.evaluatedRMEA[2])}i.evaluatedScale=t.paint.get("model-scale").evaluate(e,{},s),this.updatePbrBuffer(i.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,e,i,r){const n=t.findDEMTileFor(i);if(n&&(n.tileID.canonical!==this.terrainTile||e!==this.terrainExaggeration)){if(n.dem&&n.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=n.tileID.overscaledZ;const e=gg.create(t,i,n);if(!e)return;4&this.modelTraits&&this.updateDEM(t,e,i,r);for(const t of this.getNodesInfo()){const i=t.node;if(!i.footprint||!i.footprint.vertices||!i.footprint.vertices.length)continue;const r=i.footprint.vertices;let n=e.getElevationAt(r[0].x,r[0].y,!0,!0);for(let t=1;t<r.length;t++)n=Math.min(n,e.getElevationAt(r[t].x,r[t].y,!0,!0));i.elevation=n}}this.terrainTile=n.tileID.canonical,this.terrainExaggeration=e}}updateDEM(t,e,i,r){let n=e._dem._modifiedForSources[r];if(void 0===n&&(e._dem._modifiedForSources[r]=[],n=e._dem._modifiedForSources[r]),n.includes(i.canonical))return;const o=e._dem.dim;n.push(i.canonical);let s=!1;for(const t of this.getNodesInfo()){const i=t.node;if(!i.footprint||!i.footprint.grid)continue;const r=i.footprint.grid,n=e.tileCoordToPixel(r.min.x,r.min.y),a=e.tileCoordToPixel(r.max.x,r.max.y),l=Math.min(Math.min(o-a.y,n.x),Math.min(n.y,o-a.x));if(l<0)continue;const c=R(l,2,5);let u=Math.max(0,n.x-c),h=Math.max(0,n.y-c),d=Math.min(a.x+c,o-1),p=Math.min(a.y+c,o-1);for(let t=h;t<=p;++t)for(let e=u;e<=d;++e)Xx[t*o+e]=255;let f=0,m=0;for(let t=0;t<r.cellsY;++t)for(let i=0;i<r.cellsX;++i){if(!r.cells[t*r.cellsX+i])continue;const n=e.tileCoordToPixel(r.min.x+i/r.xScale,r.min.y+t/r.yScale),s=e.tileCoordToPixel(r.min.x+(i+1)/r.xScale,r.min.y+(t+1)/r.yScale);for(let t=n.y;t<=Math.min(s.y+1,o-1);++t)for(let i=n.x;i<=Math.min(s.x+1,o-1);++i)255===Xx[t*o+i]&&(Xx[t*o+i]=0,f+=e.getElevationAtPixel(i,t),m++)}const g=f/m;u=Math.max(1,n.x-c),h=Math.max(1,n.y-c),d=Math.min(a.x+c,o-2),p=Math.min(a.y+c,o-2),s=!0;for(let t=h;t<=p;++t)for(let i=u;i<=d;++i)0===Xx[t*o+i]&&(Vx[t*o+i]=e._dem.set(i,t,g));for(let t=1;t<c;++t){u=Math.max(1,n.x-t),h=Math.max(1,n.y-t),d=Math.min(a.x+t,o-2),p=Math.min(a.y+t,o-2);for(let i=h;i<=p;++i)for(let r=u;r<=d;++r){const n=i*o+r;if(255===Xx[n]){let s=0,a=0,l=-1,u=-1;for(let e=-1;e<=1;++e)for(let n=-1;n<=1;++n){const c=(i+e)*o+r+n;if(Xx[c]>=t)continue;const h=Vx[c],d=Math.abs(h);d>a&&(s=h,a=d,l=n,u=e)}if(a>.1){const o=1-(t+.5*Math.abs(l*u))/c;let a=e._dem.get(r,i)+s*o;const h=e._dem.get(r+l,i+u),d=e._dem.get(r-l,i-u,!0);(a-h)*(a-d)>0&&(a=(h+d)/2),Vx[n]=e._dem.set(r,i,a),Xx[n]=t}}}}}s&&(e._demTile.needsDEMTextureUpload=!0,e._dem._timestamp=pe.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(const t of this.nodes)this.nodesInfo.push(new Wx(t));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(const t of this.nodes)Fx(t);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();const t=this.getNodesInfo();for(const e of t)Bx(e.node),Fx(e.node)}isEmpty(){return!this.nodes.length}updateReplacement(t,e){if(e.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=e.updateTime;const i=e.getReplacementRegionsForTile(t.toUnwrapped()),r=this.getNodesInfo();for(let t=0;t<this.nodesInfo.length;t++){const e=r[t].node;r[t].hiddenByReplacement=!!e.footprint&&!i.find(t=>t.footprint===e.footprint)}}getHeightAtTileCoord(t,e){const i=this.getNodesInfo(),r=[];for(let n=0;n<this.nodesInfo.length;n++){const o=i[n],s=o.node.meshes[0];if(t<s.aabb.min[0]||e<s.aabb.min[1]||t>s.aabb.max[0]||e>s.aabb.max[1])continue;const a=(t-s.aabb.min[0])/(s.aabb.max[0]-s.aabb.min[0])*64|0,l=64*Math.min(63,(e-s.aabb.min[1])/(s.aabb.max[1]-s.aabb.min[1])*64|0)+Math.min(63,a);if(!(s.heightmap[l]<0&&o.node.footprint)){if(o.hiddenByReplacement)return;return{height:s.heightmap[l],maxHeight:o.feature.properties.height,hidden:!1,verticalScale:o.evaluatedScale[2]}}if(o.node.footprint.grid.query(new v(t,e),new v(t,e),r),r.length>0)return{height:void 0,maxHeight:o.feature.properties.height,hidden:o.hiddenByReplacement,verticalScale:o.evaluatedScale[2]}}}}function Yx(t,e){return!t.isLightConstant&&e}function Zx(t,e,i,r,n,o,s,a){let l=(61440&e|(61440&e)>>4)>>8,c=(3840&e|(3840&e)>>4)>>4,u=240&e|(240&e)>>4;i[3]>0&&(l=Yr(l,255*i[0],i[3]),c=Yr(c,255*i[1],i[3]),u=Yr(u,255*i[2],i[3]));const h=l<<8|c,d=u<<8|Math.floor(255*r[3]),p=function(t){const e=R(t,0,2);return Math.min(Math.round(.5*e*255),255)}(r[2])<<8|15*r[0]<<4|15*r[1],f=R(n[0],0,1),m=R(n[1],0,1),g=R(n[2],0,1),_=R(n[3],0,1);let y,v,x,b;if(f!==m&&s!==o&&m!==f){const t=s-o;v=1/(t*(m-f)),x=-(o+t*f)/(t*(m-f));const e=R(n[4],-1,1);b=Math.pow(10,e),y=255*g<<8|255*_}else y=65535,v=0,x=1,b=1;if(t.emplaceBack(h,d,p,y,v,x,b),a){const t=a.length;a.clear();for(let e=0;e<t;e++)a.emplaceBack(h,d,p,y,v,x,b)}}function Kx(t,e){const i=t.node;let r=0;for(const n of i.meshes){if(i.lights&&i.lightMeshIndex===r)continue;if(!n.featureData)continue;n.featureArray=new zl,n.featureArray.reserve(n.featureData.length);let o=e;for(const e of n.featureData){let r;const s=65535&e,a=(15&s)<8?15&s:0,l=e>>16&65535,c=t.evaluatedRMEA[a],u=t.evaluatedColor[a],h=t.emissionHeightBasedParams[a];if(o&&2===a&&i.lights&&(r=new zl,r.resize(10*i.lights.length)),Zx(n.featureArray,l,u,c,h,n.aabb.min[2],n.aabb.max[2],r),r&&o){o=!1;const t=i.meshes[i.lightMeshIndex];t.featureArray=r,t.featureArray._trim()}}n.featureArray._trim(),r++}}xs($x,"Tiled3dModelBucket",{omit:["layers"]}),xs(Wx,"Tiled3dModelFeature");class Jx{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){const e=ib(new v(0,0),new v(ur,ur),t),i=[];for(const r of this._activeRegions){if(r.hiddenByOverlap)continue;if(!eb(e,r))continue;const n=rb(r.min,r.max,t);i.push({min:n.min,max:n.max,sourceId:this._sourceIds[r.priority],footprint:r.footprint,footprintTileId:r.tileId})}return i}setSources(t){this._setSources(t.map(t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{const e=[];for(const i of t.cache.getVisibleCoordinates()){const r=t.cache.getTile(i).buckets[t.layer];if(r)for(const t of r.getNodesInfo()){const r=t.node;r.footprint&&e.push({footprint:r.footprint,id:i.toUnwrapped()})}}return e}})))}_addSource(t){const e=t.getFootprints();if(0!==e.length){for(const t of e){if(!t.footprint)continue;const e=ib(t.footprint.min,t.footprint.max,t.id);this._activeRegions.push({min:e.min,max:e.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:t.id,footprint:t.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((t,e)=>t.priority-e.priority||Qx(t.min,e.min)||Qx(t.max,e.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0,i=0;for(;!t&&e!==this._activeRegions.length;){const r=this._activeRegions[e],n=this._prevRegions[i];t=r.priority!==n.priority||!tb(r,n),++e,++i}}if(t){++this._updateTime;const t=t=>{const e=this._activeRegions;if(t>=e.length)return t;const i=e[t].priority;for(;t<e.length&&e[t].priority===i;)++t;return t};if(this._sourceIds.length>1){let e=0,i=t(e);for(;e!==i;){let r=e;const n=e;for(;r!==i;){const t=this._activeRegions[r];t.hiddenByOverlap=!1;for(let e=0;e<n;e++){const i=this._activeRegions[e];if(!i.hiddenByOverlap&&eb(t,i)&&(t.hiddenByOverlap=ob(t.footprint,t.tileId,i.footprint,i.tileId),t.hiddenByOverlap))break}++r}e=i,i=t(e)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}}function Qx(t,e){return t.x-e.x||t.y-e.y}function tb(t,e){return 0===Qx(t.min,e.min)&&0===Qx(t.max,e.max)}function eb(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function ib(t,e,i){const r=1/ur,n=1/(1<<i.canonical.z),o=(e.x*r+i.canonical.x)*n+i.wrap,s=(e.y*r+i.canonical.y)*n;return{min:new v((t.x*r+i.canonical.x)*n+i.wrap,(t.y*r+i.canonical.y)*n),max:new v(o,s)}}function rb(t,e,i){const r=1<<i.canonical.z,n=((e.x-i.wrap)*r-i.canonical.x)*ur,o=(e.y*r-i.canonical.y)*ur;return{min:new v(((t.x-i.wrap)*r-i.canonical.x)*ur,(t.y*r-i.canonical.y)*ur),max:new v(n,o)}}function nb(t,e,i,r,n,o,s){const a=t.indices,l=t.vertices,c=[];for(let u=r;u<r+n;u+=3){const r=e[i[u+0]+o],n=e[i[u+1]+o],h=e[i[u+2]+o],d=Math.min(r.x,n.x,h.x),p=Math.max(r.x,n.x,h.x),f=Math.min(r.y,n.y,h.y),m=Math.max(r.y,n.y,h.y);c.length=0,t.grid.query(new v(d,f),new v(p,m),c);for(let t=0;t<c.length;t++){const e=c[t];if(tf(l[a[3*e+0]],l[a[3*e+1]],l[a[3*e+2]],r,n,h,s))return!0}}return!1}function ob(t,e,i,r){if(!t||!i)return!1;let n=t.vertices;if(!e.canonical.equals(r.canonical)||e.wrap!==r.wrap){if(i.vertices.length<t.vertices.length)return ob(i,r,t,e);const o=e.canonical,s=r.canonical,a=Math.pow(2,s.z-o.z);n=t.vertices.map(t=>new v(t.x*o.x*ur*a-s.x*ur,t.y*o.y*ur*a-s.y*ur))}return nb(i,n,t.indices,0,t.indices.length,0,0)}const sb=Pm.types,ab=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],lb=["fill-extrusion-flood-light-ground-radius"],cb=Math.pow(2,13),ub=Math.pow(2,15)-1,hb=new v(0,1),db=2147483648;function pb(t,e,i,r,n,o,s,a){t.emplaceBack((e<<1)+s,(i<<1)+o,(Math.floor(r*cb)<<1)+n,Math.round(a))}function fb(t,e,i,r,n,o){t.emplaceBack(e.x,e.y,(i.x<<1)+r,(i.y<<1)+n,o)}function mb(t,e,i){const r=16384;t.emplaceBack(e.x,e.y,e.z,i[0]*r,i[1]*r,i[2]*r)}class gb{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class _b{constructor(){this.centroidXY=new v(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new v(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new v(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new v(this.max.x-this.min.x,this.max.y-this.min.y)}}class yb{constructor(){this.acc=new v(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,e){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=e.x,t.min.y=t.max.y=e.y)}appendEdge(t,e,i){this.accCount++,this.acc._add(e);let r=!!this.borders;e.x<t.min.x?(t.min.x=e.x,r=!0):e.x>t.max.x&&(t.max.x=e.x,r=!0),e.y<t.min.y?(t.min.y=e.y,r=!0):e.y>t.max.y&&(t.max.y=e.y,r=!0),((0===e.x||e.x===ur)&&e.x===i.x)!=((0===e.y||e.y===ur)&&e.y===i.y)&&this.processBorderOverlap(e,i),r&&this.checkBorderIntersection(e,i)}checkBorderIntersection(t,e){e.x<0!=t.x<0&&this.addBorderIntersection(0,Yr(e.y,t.y,(0-e.x)/(t.x-e.x))),e.x>ur!=t.x>ur&&this.addBorderIntersection(1,Yr(e.y,t.y,(ur-e.x)/(t.x-e.x))),e.y<0!=t.y<0&&this.addBorderIntersection(2,Yr(e.x,t.x,(0-e.y)/(t.y-e.y))),e.y>ur!=t.y>ur&&this.addBorderIntersection(3,Yr(e.x,t.x,(ur-e.y)/(t.y-e.y)))}addBorderIntersection(t,e){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const i=this.borders[t];e<i[0]&&(i[0]=e),e>i[1]&&(i[1]=e)}processBorderOverlap(t,e){if(t.x===e.x){if(t.y===e.y)return;const i=0===t.x?0:1;this.addBorderIntersection(i,e.y),this.addBorderIntersection(i,t.y)}else{const i=0===t.y?2:3;this.addBorderIntersection(i,e.x),this.addBorderIntersection(i,t.x)}}centroid(){return 0===this.accCount?new v(0,0):new v(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,e)=>t+ +(e[0]!==Number.MAX_VALUE),0):0}}function vb(t,e){const i=t.add(e)._unit(),r=R(t.x*i.x+t.y*i.y,-1,1);var n,o,s;return n=Math.acos(r),Math.min(4,Math.max(-4,Math.tan(n)))/4*ub*((o=t).x*(s=e).y-o.y*s.x<0?-1:1)}const xb=[t=>t.x<0,t=>t.x>ur,t=>t.y<0,t=>t.y>ur];function bb(t,e,i,r){const n=[4];if(0===r)return n;i._mult(r);const o=t.sub(i),s=e.sub(i),a=[t,e,o,s];for(let t=0;t<4;t++)for(const e of a)if(xb[t](e)){n.push(t);break}return n}class wb{constructor(t){this.vertexArray=new pl,this.indexArray=new Ml,this.programConfigurations=new Dc(t.layers,t.zoom,t=>lb.includes(t)),this._segments=new Ql,this.hiddenByLandmarkVertexArray=new Nl,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Ql}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(t,e,i,r=!1){const n=t.length;if(n>2){let o=Math.max(0,this._segments.get().length-1);const s=this._segments._prepareSegment(4*n,this.vertexArray.length,2*this._segmentToGroundQuads[o].length);let a;o!==this._segments.get().length-1&&(o++,this._segmentToGroundQuads[o]=[],this._segmentToRegionTriCounts[o]=[0,0,0,0,0]);{const e=t[0],i=t[1];a=vb(e.sub(t[n-1])._perp()._unit(),i.sub(e)._perp()._unit())}for(let l=0;l<n;l++){const c=l===n-1?0:l+1,u=t[l],h=t[c],d=t[c===n-1?0:c+1],p=h.sub(u)._perp()._unit(),f=vb(p,d.sub(h)._perp()._unit()),m=a,g=f;if(Mb(u,h,e)||r&&Ib(u,e)&&Ib(h,e)){a=f;continue}const _=s.vertexLength;fb(this.vertexArray,u,h,1,1,m),fb(this.vertexArray,u,h,1,0,m),fb(this.vertexArray,u,h,0,1,g),fb(this.vertexArray,u,h,0,0,g),s.vertexLength+=4;const y=bb(u,h,p,i);for(const t of y)this._segmentToGroundQuads[o].push({id:_,region:t}),this._segmentToRegionTriCounts[o][t]+=2,s.primitiveLength+=2;a=f}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),e=t.length;for(let t=0;t<e;t++)this._segmentToGroundQuads[t].sort((t,e)=>t.region-e.region);for(let i=0;i<e;i++){const e=this._segmentToGroundQuads[i],r=t[i],n=this._segmentToRegionTriCounts[i];n.reduce((t,e)=>t+e,0);let o=0;for(let t=0;t<=4;t++){const e=n[t];if(0!==e){let i=this.regionSegments[t];i||(i=this.regionSegments[t]=new Ql);const n={vertexOffset:r.vertexOffset,primitiveOffset:r.primitiveOffset+o,vertexLength:r.vertexLength,primitiveLength:e};i.get().push(n)}o+=e}for(let t=0;t<e.length;t++){const i=e[t].id;this.indexArray.emplaceBack(i,i+1,i+3),this.indexArray.emplaceBack(i,i+3,i+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,e,i,r,n,o){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,e,i,r,n,o)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,dm.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,e,i,r,n,o){this.hasData()&&this.programConfigurations.updatePaintArrays(t,e,i,r,n,o)}updateHiddenByLandmark(t){if(!this.hasData())return;const e=t.groundVertexCount+t.groundVertexArrayOffset;if(0===t.groundVertexCount)return;const i=t.flags&db?1:0;for(let r=t.groundVertexArrayOffset;r<e;++r)this.hiddenByLandmarkVertexArray.emplace(r,i);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,fm.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const e=this.regionSegments[t];e&&e.destroy()}}}}class Tb{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ml,this.footprintVertices=new ul,this.footprintSegments=[],this.layoutVertexArray=new dl,this.centroidVertexArray=new Zl,this.indexArray=new Ml,this.programConfigurations=new Dc(t.layers,t.zoom,t=>ab.includes(t)),this.segments=new Ql,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.groundEffect=new wb(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(t,e,i,r){this.features=[],this.hasPattern=sm("fill-extrusion",this.layers,e),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Mp(i),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:n,id:o,index:s,sourceLayerIndex:a}of t){const t=this.layers[0]._featureFilter.needGeometry,l=Fp(n,t);if(!this.layers[0]._featureFilter.filter(new Ua(this.zoom),l,i))continue;const c={id:o,sourceLayerIndex:a,index:s,geometry:t?l.geometry:Bp(n,i,r),properties:n.properties,type:n.type,patterns:{}},u=this.layoutVertexArray.length;this.hasPattern?this.features.push(am("fill-extrusion",this.layers,c,this.zoom,e)):this.addFeature(c,c.geometry,s,i,{},e.availableImages,r,e.brightness),e.featureIndex.insert(n,c.geometry,s,a,this.index,u)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,e,i,r,n,o){for(const t of this.features){const{geometry:s}=t;this.addFeature(t,s,t.index,e,i,r,n,o)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(t,e,i,r,n){const o=0!==Object.keys(t).length;if(o&&!this.stateDependentLayers.length)return;const s=o?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(t,e,s,i,r,n),this.groundEffect.update(t,e,s,i,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,gm),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,mm.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,pm.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,i,r,n,o,s,a){const l=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,c=[new v(0,0),new v(ur,ur)],u=s.projection,h="globe"===u.name,d="Polygon"===sb[t.type],p=new yb;p.centroidDataIndex=this.centroidData.length;const f=new _b,m=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},r)<=0,g=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},r);f.height=g,f.vertexArrayOffset=this.layoutVertexArray.length,f.groundVertexArrayOffset=this.groundEffect.vertexArray.length,h&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new yl);const _=nm(e,500);for(let t=_.length-1;t>=0;t--){const e=_[t];(0===e.length||(y=e[0]).every(t=>t.x<=0)||y.every(t=>t.x>=ur)||y.every(t=>t.y<=0)||y.every(t=>t.y>=ur))&&_.splice(t,1)}var y;let x;if(h)x=Ob(_,c,r);else{x=[];for(const t of _)x.push({polygon:t,bounds:c})}const b=d?this.edgeRadius:0,w=b>0&&this.zoom<17,T=(t,e)=>{if(0===t.length)return!1;const i=t[t.length-1];return e.x===i.x&&e.y===i.y};for(const{polygon:t,bounds:e}of x){let i=0,n=0;for(const e of t)d&&!e[0].equals(e[e.length-1])&&e.push(e[0]),n+=d?e.length-1:e.length;const o=this.segments.prepareSegment((d?5:4)*n,this.layoutVertexArray,this.indexArray);f.footprintSegIdx<0&&(f.footprintSegIdx=this.footprintSegments.length),f.polygonSegIdx<0&&(f.polygonSegIdx=this.polygonSegments.length);const s={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},a=new gb;if(a.vertexOffset=this.footprintVertices.length,a.indexOffset=3*this.footprintIndices.length,a.ringIndices=[],d){const n=[],s=[];i=o.vertexLength;for(let i=0;i<t.length;i++){const c=t[i];c.length&&0!==i&&s.push(n.length/2);const d=[];let p,f;p=c[1].sub(c[0])._perp()._unit(),a.ringIndices.push(c.length-1);for(let t=1;t<c.length;t++){const e=c[t],i=c[t===c.length-1?1:t+1],s=e.clone();if(b){f=i.sub(e)._perp()._unit();const t=p.add(f)._unit(),r=b*Math.min(4,1/(p.x*t.x+p.y*t.y));s.x+=r*t.x,s.y+=r*t.y,s.x=Math.round(s.x),s.y=Math.round(s.y),p=f}!m||0!==b&&!w||T(d,s)||d.push(s),pb(this.layoutVertexArray,s.x,s.y,0,0,1,1,0),o.vertexLength++,this.footprintVertices.emplaceBack(e.x,e.y),n.push(e.x,e.y),h&&mb(this.layoutVertexExtArray,u.projectTilePoint(s.x,s.y,r),u.upVector(r,s.x,s.y))}m&&(0===b||w)&&(0!==d.length&&T(d,d[0])&&d.pop(),this.groundEffect.addData(d,e,l))}const c=rm(n,s);for(let t=0;t<c.length;t+=3)this.footprintIndices.emplaceBack(a.vertexOffset+c[t+0],a.vertexOffset+c[t+1],a.vertexOffset+c[t+2]),this.indexArray.emplaceBack(i+c[t],i+c[t+2],i+c[t+1]),o.primitiveLength++;a.indexCount+=c.length,a.vertexCount+=this.footprintVertices.length-a.vertexOffset}for(let n=0;n<t.length;n++){const s=t[n];p.startRing(f,s[0]);let a=s.length>4&&Cb(s[s.length-2],s[0],s[1]),c=b?Sb(s[s.length-2],s[0],s[1],b):0;const g=[];let _,y,v;y=s[1].sub(s[0])._perp()._unit();let x=!0;for(let t=1,n=0;t<s.length;t++){let l=s[t-1],d=s[t];const w=s[t===s.length-1?1:t+1];if(p.appendEdge(f,d,l),Mb(d,l,e)){b&&(y=w.sub(d)._perp()._unit(),x=!x);continue}const E=d.sub(l)._perp(),S=E.x/(Math.abs(E.x)+Math.abs(E.y)),A=E.y>0?1:0,M=l.dist(d);if(n+M>32768&&(n=0),b){v=w.sub(d)._perp()._unit();let t=Ab(l,d,w,Eb(y,v),b);isNaN(t)&&(t=0);const e=d.sub(l)._unit();l=l.add(e.mult(c))._round(),d=d.add(e.mult(-t))._round(),c=t,y=v,m&&this.zoom>=17&&(T(g,l)||g.push(l),T(g,d)||g.push(d))}const I=o.vertexLength,C=s.length>4&&Cb(l,d,w);let P=Pb(n,a,x);if(pb(this.layoutVertexArray,l.x,l.y,S,A,0,0,P),pb(this.layoutVertexArray,l.x,l.y,S,A,0,1,P),n+=M,P=Pb(n,C,!x),a=C,pb(this.layoutVertexArray,d.x,d.y,S,A,0,0,P),pb(this.layoutVertexArray,d.x,d.y,S,A,0,1,P),o.vertexLength+=4,this.indexArray.emplaceBack(I+0,I+1,I+2),this.indexArray.emplaceBack(I+1,I+3,I+2),o.primitiveLength+=2,b){const r=i+(1===t?s.length-2:t-2),n=1===t?i:r+1;if(this.indexArray.emplaceBack(I+1,r,I+3),this.indexArray.emplaceBack(r,n,I+3),o.primitiveLength+=2,void 0===_&&(_=I),!Mb(w,s[t],e)){const e=t===s.length-1?_:o.vertexLength;this.indexArray.emplaceBack(I+2,I+3,e),this.indexArray.emplaceBack(I+3,e+1,e),this.indexArray.emplaceBack(I+3,n,e+1),o.primitiveLength+=3}x=!x}if(h){const t=this.layoutVertexExtArray,e=u.projectTilePoint(l.x,l.y,r),i=u.projectTilePoint(d.x,d.y,r),n=u.upVector(r,l.x,l.y),o=u.upVector(r,d.x,d.y);mb(t,e,n),mb(t,e,n),mb(t,i,o),mb(t,i,o)}}d&&(i+=s.length-1),m&&b&&this.zoom>=17&&(0!==g.length&&T(g,g[0])&&g.pop(),this.groundEffect.addData(g,e,l,b>0))}this.footprintSegments.push(a),s.triangleCount=this.indexArray.length-s.triangleArrayOffset,this.polygonSegments.push(s),++f.footprintSegLen,++f.polygonSegLen}if(f.vertexCount=this.layoutVertexArray.length-f.vertexArrayOffset,f.groundVertexCount=this.groundEffect.vertexArray.length-f.groundVertexArrayOffset,0!==f.vertexCount){if(f.centroidXY=p.borders?hb:this.encodeCentroid(p,f),this.centroidData.push(f),p.borders){this.featuresOnBorder.push(p);const t=this.featuresOnBorder.length-1;for(let e=0;e<p.borders.length;e++)p.borders[e][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[e].push(t)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,n,o,r,a),this.groundEffect.addPaintPropertiesData(t,i,n,o,r,a),this.maxHeight=Math.max(this.maxHeight,g)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((e,i)=>this.featuresOnBorder[e].borders[t][0]-this.featuresOnBorder[i].borders[t][0])}splitToSubtiles(){const t=[];for(let e=0;e<this.centroidData.length;e++){const i=this.centroidData[e],r=+(i.min.y+i.max.y>ur),n=2*r+(+(i.min.x+i.max.x>ur)^r);for(let r=0;r<i.polygonSegLen;r++){const o=i.polygonSegIdx+r;t.push({centroidIdx:e,subtile:n,polygonSegmentIdx:o,triangleSegmentIdx:this.polygonSegments[o].triangleSegIdx})}}const e=new Ml;t.sort((t,e)=>t.triangleSegmentIdx===e.triangleSegmentIdx?t.subtile-e.subtile:t.triangleSegmentIdx-e.triangleSegmentIdx);let i=0,r=0,n=0;for(const e of t){if(e.triangleSegmentIdx!==i)break;n++}const o=t.length;for(;r!==t.length;){i=t[r].triangleSegmentIdx;let s=0,a=r,l=r;for(let e=a;e<n&&t[e].subtile===s;e++)l++;for(;a!==n;){const r=t[a];s=r.subtile;const o=this.centroidData[r.centroidIdx].min.clone(),c=this.centroidData[r.centroidIdx].max.clone(),u={vertexOffset:this.segments.segments[i].vertexOffset,primitiveOffset:e.length,vertexLength:this.segments.segments[i].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let i=a;i<l;i++){const r=t[i],n=this.polygonSegments[r.polygonSegmentIdx],s=this.centroidData[r.centroidIdx].min,a=this.centroidData[r.centroidIdx].max,l=this.indexArray.uint16;for(let t=n.triangleArrayOffset;t<n.triangleArrayOffset+n.triangleCount;t++)e.emplaceBack(l[3*t],l[3*t+1],l[3*t+2]);u.primitiveLength+=n.triangleCount,o.x=Math.min(o.x,s.x),o.y=Math.min(o.y,s.y),c.x=Math.max(c.x,a.x),c.y=Math.max(c.y,a.y)}u.primitiveLength>0&&this.triangleSubSegments.push({segment:u,min:o,max:c}),a=l;for(let e=a;e<n&&t[e].subtile===t[a].subtile;e++)l++}r=n;for(let e=r;e<o&&t[e].triangleSegmentIdx===t[r].triangleSegmentIdx;e++)n++}e._trim(),this.indexArray=e}getVisibleSegments(t,e,i){let r=0,n=0;const o=1<<t.canonical.z;if(e){const i=e.getMinMaxForTile(t);i&&(r=i.min,n=i.max)}n+=this.maxHeight;const s=t.toUnwrapped();let a;const l=[s.canonical.x/o+s.wrap,s.canonical.y/o],c=[(s.canonical.x+1)/o+s.wrap,(s.canonical.y+1)/o],u=new Ql,h=(t,e,i)=>[t[0]*(1-i[0])+e[0]*i[0],t[1]*(1-i[1])+e[1]*i[1]],d=[],p=[];for(const t of this.triangleSubSegments){d[0]=t.min.x/ur,d[1]=t.min.y/ur,p[0]=t.max.x/ur,p[1]=t.max.y/ur;const e=h(l,c,d),o=h(l,c,p);if(0===new Ad([e[0],e[1],r],[o[0],o[1],n]).intersectsPrecise(i)){a&&(u.segments.push(a),a=void 0);continue}const s=t.segment;a&&a.vertexOffset!==s.vertexOffset&&(u.segments.push(a),a=void 0),a?(a.vertexLength+=s.vertexLength,a.primitiveLength+=s.primitiveLength):a={vertexOffset:s.vertexOffset,primitiveLength:s.primitiveLength,vertexLength:s.vertexLength,primitiveOffset:s.primitiveOffset,sortKey:void 0,vaos:{}}}return a&&u.segments.push(a),u}encodeCentroid(t,e){const i=t.centroid(),r=e.span(),n=Math.min(7,Math.round(r.x*this.tileToMeter/10)),o=Math.min(7,Math.round(r.y*this.tileToMeter/10));return new v(R(i.x,1,8191)<<3|n,R(i.y,1,8191)<<3|o)}showCentroid(t){const e=this.centroidData[t.centroidDataIndex];e.flags&=db,e.centroidXY.x=0,e.centroidXY.y=0,this.writeCentroidToBuffer(e)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const e=t.vertexArrayOffset,i=t.vertexCount+t.vertexArrayOffset,r=t.flags&db?hb:t.centroidXY,n=this.centroidVertexArray.geta_centroid_pos0(e);if(this.centroidVertexArray.geta_centroid_pos1(e)!==r.y||n!==r.x){for(let t=e;t<i;++t)this.centroidVertexArray.emplace(t,r.x,r.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,e){if(e.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=e.updateTime;const i=e.getReplacementRegionsForTile(t.toUnwrapped());if(function(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i].sourceId!==e[i].sourceId||!tb(t[i],e[i]))return!1;return!0}(this.activeReplacements,i))return;if(this.activeReplacements=i,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const t of this.centroidData)t.flags&=2147483647;const r=[];for(const e of this.activeReplacements){const i=Math.pow(2,e.footprintTileId.canonical.z-t.canonical.z);for(const n of this.centroidData)if(!(n.flags&db||e.min.x>n.max.x||n.min.x>e.max.x||e.min.y>n.max.y||n.min.y>e.max.y))for(let o=0;o<n.footprintSegLen;o++){const s=this.footprintSegments[n.footprintSegIdx+o];if(r.length=0,Db(this.footprintVertices,s.vertexOffset,s.vertexCount,e.footprintTileId.canonical,t.canonical,r),nb(e.footprint,r,this.footprintIndices.uint16,s.indexOffset,s.indexCount,-s.vertexOffset,-i)){n.flags|=db;break}}}for(const t of this.centroidData)this.writeCentroidToBuffer(t);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,e,i){let r=!1;for(let n=0;n<i.footprintSegLen;n++){const o=this.footprintSegments[i.footprintSegIdx+n];let s=0;for(const i of o.ringIndices){for(let n=s,a=i+s-1;n<i+s;a=n++){const i=this.footprintVertices.int16[2*(n+o.vertexOffset)+0],s=this.footprintVertices.int16[2*(n+o.vertexOffset)+1],l=this.footprintVertices.int16[2*(a+o.vertexOffset)+1];s>e!=l>e&&t<(this.footprintVertices.int16[2*(a+o.vertexOffset)+0]-i)*(e-s)/(l-s)+i&&(r=!r)}s=i}}return r}getHeightAtTileCoord(t,e){let i=Number.NEGATIVE_INFINITY,r=!0;const n=4*(t+ur)*ur+(e+ur);if(this.partLookup.hasOwnProperty(n)){const t=this.partLookup[n];return t?{height:t.height,hidden:!!(t.flags&db)}:void 0}for(const o of this.centroidData)t>o.max.x||o.min.x>t||e>o.max.y||o.min.y>e||this.footprintContainsPoint(t,e,o)&&o&&o.height>i&&(i=o.height,this.partLookup[n]=o,r=!!(o.flags&db));if(i!==Number.NEGATIVE_INFINITY)return{height:i,hidden:r};this.partLookup[n]=void 0}}function Eb(t,e){const i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function Sb(t,e,i,r){const n=e.sub(t)._perp()._unit(),o=i.sub(e)._perp()._unit();return Ab(t,e,i,Eb(n,o),r)}function Ab(t,e,i,r,n){const o=Math.sqrt(1-r*r);return Math.min(t.dist(e)/3,e.dist(i)/3,n*o/r)}function Mb(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function Ib(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function Cb(t,e,i){if(t.x<0||t.x>=ur||e.x<0||e.x>=ur||i.x<0||i.x>=ur)return!1;const r=i.sub(e),n=r.perp(),o=t.sub(e);return(r.x*o.x+r.y*o.y)/Math.sqrt((r.x*r.x+r.y*r.y)*(o.x*o.x+o.y*o.y))>-.866&&n.x*o.x+n.y*o.y<0}function Pb(t,e,i){const r=e?2|t:-3&t;return i?1|r:-2&r}function Rb(){const t=Math.PI/32,e=Math.tan(t),i=dp;return i*Math.sqrt(1+2*e*e)-i}function Ob(t,e,i){const r=1<<i.z,n=xp(i.x/r),o=xp((i.x+1)/r),s=bp(i.y/r),a=bp((i.y+1)/r);return function(t,e,i,r,n=0,o){const s=[];if(!t.length||!i||!r)return s;const a=(t,e)=>{for(const i of t)s.push({polygon:i,bounds:e})},l=Math.ceil(Math.log2(i)),c=Math.ceil(Math.log2(r)),u=l-c,h=[];for(let t=0;t<Math.abs(u);t++)h.push(u>0?0:1);for(let t=0;t<Math.min(l,c);t++)h.push(0),h.push(1);let d=t;if(d=Rm(d,e[0].y-n,e[1].y+n,1),d=Rm(d,e[0].x-n,e[1].x+n,0),!d.length)return s;const p=[];for(h.length?p.push({polygons:d,bounds:e,depth:0}):a(d,e);p.length;){const t=p.pop(),e=t.depth,i=h[e],r=t.bounds[0],s=t.bounds[1],l=0===i?r.x:r.y,c=0===i?s.x:s.y,u=o?o(i,l,c):.5*(l+c),d=Rm(t.polygons,l-n,u+n,i),f=Rm(t.polygons,u-n,c+n,i);if(d.length){const t=[r,new v(0===i?u:s.x,1===i?u:s.y)];h.length>e+1?p.push({polygons:d,bounds:t,depth:e+1}):a(d,t)}if(f.length){const t=[new v(0===i?u:r.x,1===i?u:r.y),s];h.length>e+1?p.push({polygons:f,bounds:t,depth:e+1}):a(f,t)}}return s}(t,e,Math.ceil((o-n)/11.25),Math.ceil((s-a)/11.25),1,(t,e,n)=>{if(0===t)return.5*(e+n);{const t=bp((i.y+e/ur)/r);return(yp(.5*(bp((i.y+n/ur)/r)+t))*r-i.y)*ur}})}function Db(t,e,i,r,n,o){const s=Math.pow(2,r.z-n.z);for(let a=0;a<i;a++){let i=t.int16[2*(a+e)+0],l=t.int16[2*(a+e)+1];i=(i+n.x*ur)*s-r.x*ur,l=(l+n.y*ur)*s-r.y*ur,o.push(new v(i,l))}}xs(Tb,"FillExtrusionBucket",{omit:["layers","features"]}),xs(_b,"PartData"),xs(gb,"FootprintSegment"),xs(yb,"BorderCentroidData"),xs(wb,"GroundEffect");const Lb=new Ja({visibility:new Ya(Oe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Ya(Oe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var kb={paint:new Ja({"fill-extrusion-opacity":new Ya(Oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Za(Oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ya(Oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ya(Oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Za(Oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Za(Oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Za(Oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ya(Oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ya(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ya(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Ya(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Ya(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Ya(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Ya(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Ya(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Za(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Za(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Ya(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Ya(Oe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Ya(Oe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Ya(Oe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Ya(Oe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:Lb};class Bb extends v{constructor(t,e,i){super(t,e),this.z=i}}function Fb(t,e){return t.x*e.x+t.y*e.y}function zb(t,e){if(1===t.length){let i=0;const r=e[i++];let n;for(;!n||r.equals(n);)if(n=e[i++],!n)return 1/0;for(;i<e.length;i++){const o=e[i],s=t[0],a=n.sub(r),l=o.sub(r),c=s.sub(r),u=Fb(a,a),h=Fb(a,l),d=Fb(l,l),p=Fb(c,a),f=Fb(c,l),m=u*d-h*h,g=(d*p-h*f)/m,_=(u*f-h*p)/m,y=r.z*(1-g-_)+n.z*g+o.z*_;if(isFinite(y))return y}return 1/0}{let t=1/0;for(const i of e)t=Math.min(t,i.z);return t}}function Nb(t,e,i,r,n,o,s,a){const l=s*n.getElevationAt(t,e,!0,!0),c=0!==o[0],u=c?0===o[1]?s*(o[0]/7-450):s*function(t,e,i){const r=Math.floor(e[0]/8),n=Math.floor(e[1]/8),o=10*(e[0]-8*r),s=10*(e[1]-8*n),a=t.getElevationAt(r,n,!0,!0),l=t.getMeterToDEM(i),c=Math.floor(.5*(o*l-1)),u=Math.floor(.5*(s*l-1)),h=t.tileCoordToPixel(r,n),d=2*c+1,p=2*u+1,f=function(t,e,i,r,n){return[t.getElevationAtPixel(e,i,!0),t.getElevationAtPixel(e+n,i,!0),t.getElevationAtPixel(e,i+n,!0),t.getElevationAtPixel(e+r,i+n,!0)]}(t,h.x-c,h.y-u,d,p),m=Math.abs(f[0]-f[1]),g=Math.abs(f[2]-f[3]),_=Math.abs(f[0]-f[2])+Math.abs(f[1]-f[3]),y=Math.min(.25,.5*l*(m+g)/d),v=Math.min(.25,.5*l*_/p);return a+Math.max(y*o,v*s)}(n,o,a):l;return{base:l+(0===i)?-1:i,top:c?Math.max(u+r,l+i+2):l+r}}const Ub=new Ja({"line-cap":new Za(Oe.layout_line["line-cap"]),"line-join":new Za(Oe.layout_line["line-join"]),"line-miter-limit":new Ya(Oe.layout_line["line-miter-limit"]),"line-round-limit":new Ya(Oe.layout_line["line-round-limit"]),"line-sort-key":new Za(Oe.layout_line["line-sort-key"]),visibility:new Ya(Oe.layout_line.visibility)});var Gb={paint:new Ja({"line-opacity":new Za(Oe.paint_line["line-opacity"]),"line-color":new Za(Oe.paint_line["line-color"]),"line-translate":new Ya(Oe.paint_line["line-translate"]),"line-translate-anchor":new Ya(Oe.paint_line["line-translate-anchor"]),"line-width":new Za(Oe.paint_line["line-width"]),"line-gap-width":new Za(Oe.paint_line["line-gap-width"]),"line-offset":new Za(Oe.paint_line["line-offset"]),"line-blur":new Za(Oe.paint_line["line-blur"]),"line-dasharray":new Za(Oe.paint_line["line-dasharray"]),"line-pattern":new Za(Oe.paint_line["line-pattern"]),"line-gradient":new Ka(Oe.paint_line["line-gradient"]),"line-trim-offset":new Ya(Oe.paint_line["line-trim-offset"]),"line-emissive-strength":new Ya(Oe.paint_line["line-emissive-strength"]),"line-border-width":new Za(Oe.paint_line["line-border-width"]),"line-border-color":new Za(Oe.paint_line["line-border-color"])}),layout:Ub};const jb=(t,e,i,r,n,o,s)=>{const a=t.transform,l=a.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:Hb(t,e,i,r),u_pixels_to_tile_units:l,u_device_pixel_ratio:o,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:n,u_texsize:Wb(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Xb(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:s,u_emissive_strength:i.paint.get("line-emissive-strength")}},Vb=(t,e,i,r,n)=>{const o=t.transform;return{u_matrix:Hb(t,e,i,r),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:o.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:n,u_image:0,u_tile_units_to_pixels:Xb(e,o),u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Xb(t,e){return 1/ox(t,1,e.tileZoom)}function Hb(t,e,i,r){return t.translatePosMatrix(r||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const qb=t=>{const e=[];Wb(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=t.paint.get("line-trim-offset");return 0===i[0]&&0===i[1]||e.push("RENDER_LINE_TRIM_OFFSET"),0!==t.paint.get("line-border-width").constantOr(1)&&e.push("RENDER_LINE_BORDER"),e};function Wb(t){const e=t.paint.get("line-dasharray").value;return e.value||"constant"!==e.kind}const $b=new class extends Za{possiblyEvaluate(t,e){return e=new Ua(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,r){return e=B({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,r)}}(Gb.paint.properties["line-width"].specification);function Yb(t,e){return e>0?e+2*t:t}$b.useIntegerZoom=!0;const Zb=new Ja({visibility:new Ya(Oe.layout_background.visibility)});var Kb={paint:new Ja({"background-color":new Ya(Oe.paint_background["background-color"]),"background-pattern":new Ya(Oe.paint_background["background-pattern"]),"background-opacity":new Ya(Oe.paint_background["background-opacity"]),"background-emissive-strength":new Ya(Oe.paint_background["background-emissive-strength"])}),layout:Zb};const Jb=new Ja({visibility:new Ya(Oe.layout_raster.visibility)});var Qb={paint:new Ja({"raster-opacity":new Ya(Oe.paint_raster["raster-opacity"]),"raster-color":new Ka(Oe.paint_raster["raster-color"]),"raster-color-mix":new Ya(Oe.paint_raster["raster-color-mix"]),"raster-color-range":new Ya(Oe.paint_raster["raster-color-range"]),"raster-hue-rotate":new Ya(Oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ya(Oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ya(Oe.paint_raster["raster-brightness-max"]),"raster-saturation":new Ya(Oe.paint_raster["raster-saturation"]),"raster-contrast":new Ya(Oe.paint_raster["raster-contrast"]),"raster-resampling":new Ya(Oe.paint_raster["raster-resampling"]),"raster-fade-duration":new Ya(Oe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Ya(Oe.paint_raster["raster-emissive-strength"]),"raster-array-band":new Ya(Oe.paint_raster["raster-array-band"]),"raster-elevation":new Ya(Oe.paint_raster["raster-elevation"])}),layout:Jb};function tw(t,e,i,r,n,o,s,a){const l=[t,i,n,e,r,o,1,1,1],c=[s,a,1],u=Zh.adjoint([],l),[h,d,p]=nd.transformMat3(c,c,Zh.transpose(u,u));return Zh.multiply(l,[h,0,0,0,d,0,0,0,p],l)}class ew extends Re{constructor(t,e,i,r){super(),this.id=t,this.dispatcher=i,this.coordinates=e.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(r),this.options=e,this._dirty=!1}load(t,e){if(this._loaded=e||!1,this.fire(new Ce("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=Ct(this.map._requestManager.transformRequest(this.url,vt.Image),(e,r)=>{if(this._imageRequest=null,this._loaded=!0,e)this.fire(new Pe(e));else if(r){const{HTMLImageElement:e}=i;this.image=r instanceof e?pe.getImageData(r):r,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Ly(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ce("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Ly||this.texture.destroy()}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let e=t[0][1],i=t[0][1];for(const r of t)r[1]>i&&(i=r[1]),r[1]<e&&(e=r[1]);const r=(i+e)/2;if(r>Tp?this.onNorthPole=!0:r<-Tp&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const e=t.map(Ip.fromLngLat);this.tileID=function(t){let e=1/0,i=1/0,r=-1/0,n=-1/0;for(const o of t)e=Math.min(e,o.x),i=Math.min(i,o.y),r=Math.max(r,o.x),n=Math.max(n,o.y);const o=Math.max(r-e,n-i),s=Math.max(0,Math.floor(-Math.log(o)/Math.LN2)),a=Math.pow(2,s);return new fd(s,Math.floor((e+r)/2*a),Math.floor((i+n)/2*a))}(e),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ce("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}if(this._boundsArray)return;const e=N_(this.tileID,this.map.transform.projection),[i,r,n,o]=this.coordinates.map(t=>{const i=e.projection.project(t[0],t[1]);return G_(e,i)._round()});this.perspectiveTransform=function(t,e,i,r,n,o,s,a,l,c){const u=tw(0,0,t,0,0,e,t,e),h=tw(i,r,n,o,s,a,l,c);return Zh.multiply(h,Zh.adjoint(u,u),h),[h[6]/h[8]*t/ur,h[7]/h[8]*e/ur]}(this.width,this.height,i.x,i.y,r.x,r.y,o.x,o.y,n.x,n.y);const s=this._boundsArray=new dl;s.emplaceBack(i.x,i.y,0,0),s.emplaceBack(r.x,r.y,ur,0),s.emplaceBack(o.x,o.y,0,ur),s.emplaceBack(n.x,n.y,ur,ur),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(s,Uy.members),this.boundsSegments=Ql.simpleSegment(0,0,4,2)}prepare(){const t=0!==Object.keys(this.tiles).length;if(this.tileID&&!t)return;const e=this.map.painter.context,i=e.gl;!this._dirty||this.texture instanceof Ly||(this.texture?this.texture.update(this.image):(this.texture=new Dy(e,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(e)}loadTile(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class iw extends rl{constructor(t){super(t,{}),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(t){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}const rw=new Ja({visibility:new Ya(Oe.layout_sky.visibility)});var nw={paint:new Ja({"sky-type":new Ya(Oe.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ya(Oe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ya(Oe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ya(Oe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ya(Oe.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ka(Oe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ya(Oe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ya(Oe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ya(Oe.paint_sky["sky-opacity"])}),layout:rw};function ow(t,e,i){const r=[0,0,1],n=td.identity([]);return td.rotateY(n,n,i?-T(t)+Math.PI:T(t)),td.rotateX(n,n,-T(e)),nd.transformQuat(r,r,n),nd.normalize(r,r)}var sw={paint:new Ja({})};const aw={circle:class extends rl{constructor(t,e){super(t,af,e)}createBucket(t){return new Up(t)}queryRadius(t){const e=t;return ef("circle-radius",this,e)+ef("circle-stroke-width",this,e)+rf(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,r,n,o,s,a){const l=of(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return hf(t,r,o,s,a,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,c)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){const i=uf(this);return{config:new Oc(this,e),defines:i,overrideFog:!1}}},heatmap:class extends rl{createBucket(t){return new gf(t)}constructor(t,e){super(t,Ef,e),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Sf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return ef("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,r,n,o,s,a){const l=this.paint.get("heatmap-radius").evaluate(e,i);return hf(t,r,o,s,a,!0,!0,new v(0,0),l)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return"heatmap"===t?{config:new Oc(this,e),overrideFog:!1}:{}}},hillshade:class extends rl{constructor(t,e){super(t,Mf,e)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends rl{constructor(t,e){super(t,um,e)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(t,e){return{config:new Oc(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new lm(t)}queryRadius(){return rf(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,r,n,o){return!t.queryGeometry.isAboveHorizon&&Vp(nf(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends rl{constructor(t,e){super(t,kb,e),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new Tb(t)}queryRadius(){return rf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,i,r,n,o,s,a,l){const c=of(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),u=this.paint.get("fill-extrusion-height").evaluate(e,i),h=this.paint.get("fill-extrusion-base").evaluate(e,i),d=[0,0],p=a&&o.elevation,f=o.elevation?o.elevation.exaggeration():1,m=t.tile.getBucket(this);if(p&&m instanceof Tb){const t=m.centroidVertexArray,e=l+1;e<t.length&&(d[0]=t.geta_centroid_pos0(e),d[1]=t.geta_centroid_pos1(e))}if(0===d[0]&&1===d[1])return!1;"globe"===o.projection.name&&(r=Ob([r],[new v(0,0),new v(ur,ur)],t.tileID.canonical).map(t=>t.polygon).flat());const g=p?a:null,[_,y]=function(t,e,i,r,n,o,s,a,l,c,u){return"globe"===t.projection.name?function(t,e,i,r,n,o,s,a,l,c,u){const h=[],d=[],p=t.projection.upVectorScale(u,t.center.lat,t.worldSize).metersToTile,f=[0,0,0,1],m=[0,0,0,1],g=(t,e,i,r)=>{t[0]=e,t[1]=i,t[2]=r,t[3]=1},_=Rb();i>0&&(i+=_),r+=_;for(const _ of e){const e=[],y=[];for(const h of _){const d=h.x+n.x,_=h.y+n.y,v=t.projection.projectTilePoint(d,_,u),x=t.projection.upVector(u,h.x,h.y);let b=i,w=r;if(s){const t=Nb(d,_,i,r,s,a,l,c);b+=t.base,w+=t.top}0!==i?g(f,v.x+x[0]*p*b,v.y+x[1]*p*b,v.z+x[2]*p*b):g(f,v.x,v.y,v.z),g(m,v.x+x[0]*p*w,v.y+x[1]*p*w,v.z+x[2]*p*w),nd.transformMat4(f,f,o),nd.transformMat4(m,m,o),e.push(new Bb(f[0],f[1],f[2])),y.push(new Bb(m[0],m[1],m[2]))}h.push(e),d.push(y)}return[h,d]}(t,e,i,r,n,o,s,a,l,c,u):s?function(t,e,i,r,n,o,s,a,l){const c=[],u=[],h=[0,0,0,1];for(const d of t){const t=[],p=[];for(const c of d){const u=c.x+r.x,d=c.y+r.y,f=Nb(u,d,e,i,o,s,a,l);h[0]=u,h[1]=d,h[2]=f.base,h[3]=1,Xh.transformMat4(h,h,n),h[3]=Math.max(h[3],1e-5);const m=new Bb(h[0]/h[3],h[1]/h[3],h[2]/h[3]);h[0]=u,h[1]=d,h[2]=f.top,h[3]=1,Xh.transformMat4(h,h,n),h[3]=Math.max(h[3],1e-5);const g=new Bb(h[0]/h[3],h[1]/h[3],h[2]/h[3]);t.push(m),p.push(g)}c.push(t),u.push(p)}return[c,u]}(e,i,r,n,o,s,a,l,c):function(t,e,i,r,n){const o=[],s=[],a=n[8]*e,l=n[9]*e,c=n[10]*e,u=n[11]*e,h=n[8]*i,d=n[9]*i,p=n[10]*i,f=n[11]*i;for(const e of t){const t=[],i=[];for(const o of e){const e=o.x+r.x,s=o.y+r.y,m=n[0]*e+n[4]*s+n[12],g=n[1]*e+n[5]*s+n[13],_=n[2]*e+n[6]*s+n[14],y=n[3]*e+n[7]*s+n[15],v=m+a,x=g+l,b=_+c,w=Math.max(y+u,1e-5),T=m+h,E=g+d,S=_+p,A=Math.max(y+f,1e-5);t.push(new Bb(v/w,x/w,b/w)),i.push(new Bb(T/A,E/A,S/A))}o.push(t),s.push(i)}return[o,s]}(e,i,r,n,o)}(o,r,h,u,c,s,g,d,f,o.center.lat,t.tileID.canonical),x=t.queryGeometry;return function(t,e,i){let r=1/0;Vp(i,e)&&(r=zb(i,e[0]));for(let n=0;n<e.length;n++){const o=e[n],s=t[n];for(let t=0;t<o.length-1;t++){const e=o[t],n=[e,o[t+1],s[t+1],s[t],e];Gp(i,n)&&(r=Math.min(r,zb(i,n)))}}return r!==1/0&&r}(_,y,x.isPointQuery()?x.screenBounds:x.screenGeometry)}},line:class extends rl{constructor(t,e){super(t,Gb,e),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof $r,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=$b.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Oy(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){const i=qb(this);return{config:new Oc(this,e),defines:i,overrideFog:!1}}queryRadius(t){const e=t,i=Yb(ef("line-width",this,e),ef("line-gap-width",this,e)),r=ef("line-offset",this,e);return i/2+Math.abs(r)+rf(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,r,n,o){if(t.queryGeometry.isAboveHorizon)return!1;const s=nf(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),a=t.pixelToTileUnitsFactor/2*Yb(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),l=this.paint.get("line-offset").evaluate(e,i);return l&&(r=function(t,e){const i=[],r=new v(0,0);for(let n=0;n<t.length;n++){const o=t[n],s=[];for(let t=0;t<o.length;t++){const i=o[t],n=o[t+1],a=0===t?r:i.sub(o[t-1])._unit()._perp(),l=t===o.length-1?r:n.sub(i)._unit()._perp(),c=a._add(l)._unit();c._mult(1/(c.x*l.x+c.y*l.y)),s.push(c._mult(e)._add(i))}i.push(s)}return i}(r,l*t.pixelToTileUnitsFactor)),function(t,e,i){for(let r=0;r<e.length;r++){const n=e[r];if(t.length>=3)for(let e=0;e<n.length;e++)if(Zp(t,n[e]))return!0;if(Xp(t,n,i))return!0}return!1}(s,r,a)}isTileClipped(){return!0}},symbol:py,background:class extends rl{constructor(t,e){super(t,Kb,e)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:class extends rl{constructor(t,e){super(t,Qb,e),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(t){return!(t&&t._source instanceof ew)||!t._source.onNorthPole&&!t._source.onSouthPole&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(t){"raster-color"!==t&&"raster-color-range"!==t||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-color"].value.expression,[e,i]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=Sf({expression:t,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:e,end:i}],resolution:256}),this.colorRampTexture=null}},sky:class extends rl{constructor(t,e){super(t,nw,e),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Sf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const i=this.paint.get("sky-atmosphere-sun"),r=!i,n=t.style.light,o=n.properties.get("position");return r&&"viewport"===n.properties.get("anchor")&&Y("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),r?ow(o.azimuthal,90-o.polar,e):ow(i[0],90-i[1],e)}const i=this.paint.get("sky-gradient-center");return ow(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}},slot:class extends rl{constructor(t,e){super(t,sw)}},model:class extends rl{constructor(t,e){super(t,jx,e)}createBucket(t){return new Ux(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||"model-color"!==t&&"model-color-mix-intensity"!==t&&"model-rotation"!==t&&"model-scale"!==t&&"model-translation"!==t&&"model-emissive-strength"!==t)}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof vo}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};function lw(t,e){return"custom"===t.type?new iw(t):new aw[t.type](t,e)}function cw(t){const{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class uw extends Re{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new bf({width:1,height:1})}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,e){if(this.loaded[e]!==t&&(this.loaded[e]=t,t)){for(const{ids:t,callback:i}of this.requestors)this._notify(t,e,i);this.requestors=[]}}hasImage(t,e){return!!this.getImage(t,e)}getImage(t,e){return this.images[e][t]}addImage(t,e,i){this._validate(t,i)&&(this.images[e][t]=i)}_validate(t,e){let i=!0;return this._validateStretch(e.stretchX,e.data&&e.data.width)||(this.fire(new Pe(new Error(`Image "${t}" has invalid "stretchX" value`))),i=!1),this._validateStretch(e.stretchY,e.data&&e.data.height)||(this.fire(new Pe(new Error(`Image "${t}" has invalid "stretchY" value`))),i=!1),this._validateContent(e.content,e)||(this.fire(new Pe(new Error(`Image "${t}" has invalid "content" value`))),i=!1),i}_validateStretch(t,e){if(!t)return!0;let i=0;for(const r of t){if(r[0]<i||r[1]<r[0]||e<r[1])return!1;i=r[1]}return!0}_validateContent(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,e,i){i.version=this.images[e][t].version+1,this.images[e][t]=i,this.updatedImages[e][t]=!0}removeImage(t,e){const i=this.images[e][t];delete this.images[e][t],delete this.patterns[e][t],i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,e,i){let r=!0;const n=!!this.loaded[e];if(!n)for(const i of t)this.images[e][i]||(r=!1);n||r?this._notify(t,e,i):this.requestors.push({ids:t,scope:e,callback:i})}getUpdatedImages(t){return this.updatedImages[t]}_notify(t,e,i){const r={};for(const i of t){this.images[e][i]||this.fire(new Ce("styleimagemissing",{id:i}));const t=this.images[e][i];t?r[i]={data:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)}:Y(`Image "${i}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}i(null,r)}getPixelSize(t){const{width:e,height:i}=this.atlasImage[t];return{width:e,height:i}}getPattern(t,e){const i=this.patterns[e][t],r=this.getImage(t,e);if(!r)return null;if(i&&i.position.version===r.version)return i.position;if(i)i.position.version=r.version;else{const i={w:r.data.width+2,h:r.data.height+2,x:0,y:0},n=new u_(i,r);this.patterns[e][t]={bin:i,position:n}}return this._updatePatternAtlas(e),this.patterns[e][t].position}bind(t,e){const i=t.gl;let r=this.atlasTexture[e];r?this.dirty&&(r.update(this.atlasImage[e]),this.dirty=!1):(r=new Dy(t,this.atlasImage[e],i.RGBA),this.atlasTexture[e]=r),r.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(t){const e=[];for(const i in this.patterns[t])e.push(this.patterns[t][i].bin);const{w:i,h:r}=c_(e),n=this.atlasImage[t];n.resize({width:i||1,height:r||1});for(const e in this.patterns[t]){const{bin:i}=this.patterns[t][e],r=i.x+1,o=i.y+1,s=this.images[t][e].data,a=s.width,l=s.height;bf.copy(s,n,{x:0,y:0},{x:r,y:o},{width:a,height:l}),bf.copy(s,n,{x:0,y:l-1},{x:r,y:o-1},{width:a,height:1}),bf.copy(s,n,{x:0,y:0},{x:r,y:o+l},{width:a,height:1}),bf.copy(s,n,{x:a-1,y:0},{x:r-1,y:o},{width:1,height:l}),bf.copy(s,n,{x:0,y:0},{x:r+a,y:o},{width:1,height:l})}this.dirty=!0}beginFrame(){for(const t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,e){for(const i of t){if(this.callbackDispatchedThisFrame[e][i])continue;this.callbackDispatchedThisFrame[e][i]=!0;const t=this.images[e][i];cw(t)&&this.updateImage(i,e,t)}}}const hw=new Ja({anchor:new Ya(Oe.light.anchor),position:new class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return J(t.expression.evaluate(e))}interpolate(t,e,i){return{x:Yr(t.x,e.x,i),y:Yr(t.y,e.y,i),z:Yr(t.z,e.z,i),azimuthal:Yr(t.azimuthal,e.azimuthal,i),polar:Yr(t.polar,e.polar,i)}}}(Oe.light.position),color:new Ya(Oe.light.color),intensity:new Ya(Oe.light.intensity)});class dw extends Re{constructor(t,e="flat"){super(),this._transitionable=new Va(hw),this.setLight(t,e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,e,i={}){this._validate(os,t,i)||(this._transitionable.setTransitionOrValue(t),this.id=e)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,e,i){return(!i||!1!==i.validate)&&ms(this,t.call(rs,B({value:e,style:{glyphs:!0,sprite:!0},styleSpec:Oe})))}}const pw=new Ja({source:new Ya(Oe.terrain.source),exaggeration:new Ya(Oe.terrain.exaggeration)});let fw=class extends Re{constructor(t,e,i,r){super(),this.scope=i,this._transitionable=new Va(pw,r),this._transitionable.setTransitionOrValue(t,r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=e}get(){return this._transitionable.serialize()}set(t,e){this._transitionable.setTransitionOrValue(t,e)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}getExaggeration(t){return this._transitioning.possiblyEvaluate(new Ua(t)).get("exaggeration")}isZoomDependent(){const t=this._transitionable._values.exaggeration;return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof vo}};const mw=.05;function gw(t,e,i,r){const n=O(45,65,i),[o,s]=_w(t,r);let a=1-Math.min(1,Math.exp((e-o)/(s-o)*-6));return a*=a*a,a=Math.min(1,1.00747*a),a*n*t.alpha}function _w(t,e){const i=.5/Math.tan(.5*e);return[t.range[0]+i,t.range[1]+i]}function yw(t,e,i,r,n){const o=nd.transformMat4([],[e,i,r],n.mercatorFogMatrix);return gw(t,nd.length(o),n.pitch,n._fov)}function vw(t,e,i,r,n,o,s){const a=[[i,r,0],[n,r,0],[n,o,0],[i,o,0]];let l=Number.MAX_VALUE,c=-Number.MAX_VALUE;for(const t of a){const i=nd.transformMat4([],t,e),r=nd.length(i);l=Math.min(l,r),c=Math.max(c,r)}return[gw(t,l,s.pitch,s._fov),gw(t,c,s.pitch,s._fov)]}const xw=new Ja({range:new Ya(Oe.fog.range),color:new Ya(Oe.fog.color),"high-color":new Ya(Oe.fog["high-color"]),"space-color":new Ya(Oe.fog["space-color"]),"horizon-blend":new Ya(Oe.fog["horizon-blend"]),"star-intensity":new Ya(Oe.fog["star-intensity"]),"vertical-range":new Ya(Oe.fog["vertical-range"])});class bw extends Re{constructor(t,e){super(),this._transitionable=new Va(xw),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=e}get state(){const t=this._transform,e="globe"===t.projection.name,i=tp(t.zoom),r=this.properties.get("range"),n=[.5,3];return{range:e?[Yr(n[0],r[0],i),Yr(n[1],r[1],i)]:r,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,e={}){if(this._validate(ls,t,e))return;const i=B({},t);for(const t of Object.keys(Oe.fog))void 0===i[t]&&(i[t]=Oe.fog[t].default);this._transitionable.setTransitionOrValue(i)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const e=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:O(45,65,t))*e.a}getOpacityAtLatLng(t,e){return this._transform.projection.supportsFog?function(t,e,i){const r=Ip.fromLngLat(e),n=i.elevation?i.elevation.getAtPointOrZero(r):0;return yw(t,r.x,r.y,n,i)}(this.state,t,e):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const e=this._transform.calculateFogTileMatrix(t.toUnwrapped());return vw(this.state,e,0,0,ur,ur,this._transform)}getOpacityForBounds(t,e,i,r,n){return this._transform.projection.supportsFog?vw(this.state,t,e,i,r,n,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?_w(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const e=[4,5,6,7];for(const i of e){const e=t.points[i];let r;if(e[2]>=0)r=e;else{const n=t.points[i-4];r=Zr(n,e,n[2]/(n[2]-e[2]))}if(yw(this.state,r[0],r[1],0,this._transform)>=mw)return!0}return!1}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,e,i){return(!i||!1!==i.validate)&&ms(this,t.call(rs,B({value:e,style:{glyphs:!0,sprite:!0},styleSpec:Oe})))}}class ww{constructor(t){this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Tw{constructor(){this.tasks={},this.taskQueue=[],V(["process"],this),this.invoker=new ww(this.process),this.nextId=0}add(t,e){const i=this.nextId++,r=function({type:t,isSymbolTile:e,zoom:i}){return i=i||0,"message"===t?0:"maybePrepare"!==t||e?"parseTile"!==t||e?"parseTile"===t&&e?300-i:"maybePrepare"===t&&e?400-i:500:200-i:100-i}(e);if(0===r){tt();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[i]={fn:t,metadata:e,priority:r,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){tt();try{if(this.taskQueue=this.taskQueue.filter(t=>!!this.tasks[t]),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const e=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!e)return;e.fn()}finally{}}pick(){let t=null,e=1/0;for(let i=0;i<this.taskQueue.length;i++){const r=this.tasks[this.taskQueue[i]];r.priority<e&&(e=r.priority,t=i)}if(null===t)return null;const i=this.taskQueue[t];return this.taskQueue.splice(t,1),i}remove(){this.invoker.remove()}}class Ew{constructor(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},V(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Tw}send(t,e,i,r,n=!1,o){const s=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=o,this.callbacks[s]=i);const a=new Set;return this.target.postMessage({id:s,type:t,hasCallback:!!i,targetMapId:r,mustQueue:n,sourceMapId:this.mapId,data:Ts(e,a)},a),{cancel:()=>{i&&delete this.callbacks[s],this.target.postMessage({id:s,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}receive(t){const e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const t=this.cancelCallbacks[i];delete this.cancelCallbacks[i],t&&t.cancel()}else if(e.mustQueue||tt()){const t=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),t&&t.metadata||{type:"message"})}else this.processTask(i,e)}processTask(t,e){if("<response>"===e.type){const i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(Es(e.error)):i(null,Es(e.data)))}else{const i=new Set,r=e.hasCallback?(e,r)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:e?Ts(e):null,data:Ts(r,i)},i)}:t=>{},n=Es(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,n,r);else if(this.parent.getWorkerSource){const t=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,t[0],n.source,n.scope)[t[1]](n,r)}else r(new Error("Could not find function "+e.type))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class Sw{constructor(t,e){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=N();const i=this.workerPool.acquire(this.id);for(let t=0;t<i.length;t++){const r=new Sw.Actor(i[t],e,this.id);r.name="Worker "+t,this.actors.push(r)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,e,i){L(this.actors,(i,r)=>{i.send(t,e,r)},i=i||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}Sw.Actor=Ew;class Aw extends Re{constructor(t,e,i,r){super(),this.scope=i,this._options=t,this.properties=new $a(e),this._transitionable=new Va(e,new Map(r)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,e){this._options=t,this._transitionable.setTransitionOrValue(t.properties,e)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}const Mw=new Ja({color:new Ya(Oe.properties_light_ambient.color),intensity:new Ya(Oe.properties_light_ambient.intensity)}),Iw=new Ja({direction:new class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([t,e]){const i=J([1,t,e]);return{x:i.x,y:i.y,z:i.z}}(t.expression.evaluate(e))}interpolate(t,e,i){return{x:Yr(t.x,e.x,i),y:Yr(t.y,e.y,i),z:Yr(t.z,e.z,i)}}}(Oe.properties_light_directional.direction),color:new Ya(Oe.properties_light_directional.color),intensity:new Ya(Oe.properties_light_directional.intensity),"cast-shadows":new Ya(Oe.properties_light_directional["cast-shadows"]),"shadow-intensity":new Ya(Oe.properties_light_directional["shadow-intensity"])});class Cw{constructor(t,e,i,r){this.screenBounds=t,this.cameraPoint=e,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,r)}static createFromScreenPoints(t,e){let i,r;if(t instanceof v||"number"==typeof t[0]){const n=v.convert(t);i=[n],r=e.isPointAboveHorizon(n)}else{const n=v.convert(t[0]),o=v.convert(t[1]);i=[n,o],r=I(n,o).every(t=>e.isPointAboveHorizon(t))}return new Cw(i,e.getCameraPoint(),r,e)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return I(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const e=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new v(1,1)):this.screenBounds[1],r=I(e,i,0,!1);return this.cameraPoint.y>i.y&&(this.cameraPoint.x>e.x&&this.cameraPoint.x<i.x?r.splice(3,0,this.cameraPoint):this.cameraPoint.x>=i.x?r[2]=this.cameraPoint:this.cameraPoint.x<=e.x&&(r[3]=this.cameraPoint)),function(t,e){const i=[];for(let r=0;r<t.length;r++){const n=D(r-1,-1,t.length-1),o=D(r+1,-1,t.length-1),s=t[r],a=t[o],l=t[n].sub(s).unit(),c=a.sub(s).unit(),u=c.angleWithSep(l.x,l.y),h=l.add(c).unit().mult(-1*e/Math.sin(u/2));i.push(s.add(h))}return i}(r,t)}bufferedCameraGeometryGlobe(t){const e=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new v(1,1)):this.screenBounds[1],r=I(e,i,t),n=this.cameraPoint.clone();switch(3*((n.y>e.y)+(n.y>i.y))+((n.x>e.x)+(n.x>i.x))){case 0:r[0]=n,r[4]=n.clone();break;case 1:r.splice(1,0,n);break;case 2:r[1]=n;break;case 3:r.splice(4,0,n);break;case 5:r.splice(2,0,n);break;case 6:r[3]=n;break;case 7:r.splice(3,0,n);break;case 8:r[2]=n}return r}containsTile(t,e,i,r=0){const n=t.queryPadding/e._pixelsPerMercatorPixel+1,o=i?this._bufferedCameraMercator(n,e):this._bufferedScreenMercator(n,e);let s=t.tileID.wrap+(o.unwrapped?r:0);const a=o.polygon.map(e=>G_(t.tileTransform,e,s));if(!Kp(a,0,0,ur,ur))return;s=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?r:0);const l=this.screenGeometryMercator.polygon.map(e=>j_(t.tileTransform,e,s)),c=l.map(t=>new v(t[0],t[1])),u=e.getFreeCameraOptions().position||new Ip(0,0,0),h=j_(t.tileTransform,u,s),d=l.map(t=>{const e=nd.sub(t,t,h);return nd.normalize(e,e),new vd(h,e)}),p=ox(t,1,e.zoom)*e._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:c,tilespaceRays:d,bufferedTilespaceGeometry:a,bufferedTilespaceBounds:(f=M(a),f.min.x=R(f.min.x,0,ur),f.min.y=R(f.min.y,0,ur),f.max.x=R(f.max.x,0,ur),f.max.y=R(f.max.y,0,ur),f),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:p};var f}_bufferedScreenMercator(t,e){const i=Ow(t);if(this._screenRaycastCache[i])return this._screenRaycastCache[i];{let r;return r="globe"===e.projection.name?this._projectAndResample(this.bufferedScreenGeometry(t),e):{polygon:this.bufferedScreenGeometry(t).map(t=>e.pointCoordinate3D(t)),unwrapped:!0},this._screenRaycastCache[i]=r,r}}_bufferedCameraMercator(t,e){const i=Ow(t);if(this._cameraRaycastCache[i])return this._cameraRaycastCache[i];{let r;return r="globe"===e.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),e):{polygon:this.bufferedCameraGeometry(t).map(t=>e.pointCoordinate3D(t)),unwrapped:!0},this._cameraRaycastCache[i]=r,r}}_projectAndResample(t,e){const i=function(t,e){const i=Jh.multiply([],e.pixelMatrix,e.globeMatrix),r=[0,-Md,0,1],n=[0,Md,0,1],o=[0,0,0,1];Xh.transformMat4(r,r,i),Xh.transformMat4(n,n,i),Xh.transformMat4(o,o,i);const s=new v(r[0]/r[3],r[1]/r[3]),a=new v(n[0]/n[3],n[1]/n[3]),l=Zp(t,s)&&r[3]<o[3],c=Zp(t,a)&&n[3]<o[3];if(!l&&!c)return null;const u=function(t,e,i){for(let r=1;r<t.length;r++){const n=Rw(e.pointCoordinate3D(t[r-1]).x),o=Rw(e.pointCoordinate3D(t[r]).x);if(i<0){if(n<o)return{idx:r,t:-n/(o-1-n)}}else if(o<n)return{idx:r,t:(1-n)/(o+1-n)}}return null}(t,e,l?-1:1);if(!u)return null;const{idx:h,t:d}=u;let p=h>1?Pw(t.slice(0,h),e):[],f=h<t.length?Pw(t.slice(h),e):[];p=p.map(t=>new v(Rw(t.x),t.y)),f=f.map(t=>new v(Rw(t.x),t.y));const m=[...p];0===m.length&&m.push(f[f.length-1]);const g=Yr(m[m.length-1].y,(0===f.length?p[0]:f[0]).y,d);let _;return _=l?[new v(0,g),new v(0,0),new v(1,0),new v(1,g)]:[new v(1,g),new v(1,1),new v(0,1),new v(0,g)],m.push(..._),0===f.length?m.push(p[0]):m.push(...f),{polygon:m.map(t=>new Ip(t.x,t.y)),unwrapped:!1}}(t,e);if(i)return i;const r=function(t,e){let i=!1,r=-1/0,n=0;for(let e=0;e<t.length-1;e++)t[e].x>r&&(r=t[e].x,n=e);for(let e=0;e<t.length-1;e++){const r=(n+e)%(t.length-1),o=t[r],s=t[r+1];Math.abs(o.x-s.x)>.5&&(o.x<s.x?(o.x+=1,0===r&&(t[t.length-1].x+=1)):(s.x+=1,r+1===t.length-1&&(t[0].x+=1)),i=!0)}const o=_p(e.center.lng);return i&&o<Math.abs(o-1)&&t.forEach(t=>{t.x-=1}),{polygon:t,unwrapped:i}}(Pw(t,e).map(t=>new v(Rw(t.x),t.y)),e);return{polygon:r.polygon.map(t=>new Ip(t.x,t.y)),unwrapped:r.unwrapped}}}function Pw(t,e){return Pp(t,t=>{const i=e.pointCoordinate3D(t);t.x=i.x,t.y=i.y},1/256)}function Rw(t){return t<0?1+t%1:t%1}function Ow(t){return 100*t|0}function Dw(t,e,i,r,n){const o=function(i,r){if(i)return n(i);if(r){t.url&&r.tiles&&t.tiles&&delete t.tiles;const i=F(B(r,t),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);r.vector_layers&&(i.vectorLayers=r.vector_layers,i.vectorLayerIds=i.vectorLayers.map(t=>t.id)),i.tiles=e.canonicalizeTileset(i,t.url),n(null,i)}};return t.url?Tt(e.transformRequest(e.normalizeSourceURL(t.url,null,i,r),vt.Source),o):pe.frame(()=>o(null,t))}class Lw{constructor(t,e,i){this.bounds=Nc.convert(this.validateBounds(t)),this.minzoom=e||0,this.maxzoom=i||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const e=Math.pow(2,t.z),i=Math.floor(_p(this.bounds.getWest())*e),r=Math.floor(yp(this.bounds.getNorth())*e),n=Math.ceil(_p(this.bounds.getEast())*e),o=Math.ceil(yp(this.bounds.getSouth())*e);return t.x>=i&&t.x<n&&t.y>=r&&t.y<o}}class kw{constructor(t,e){this.width=t,this.height=e,this.nextRow=0,this.image=new xf({width:t,height:e}),this.positions={},this.uploaded=!1}getDash(t,e){const i=this.getKey(t,e);return this.positions[i]}trim(){const t=this.width,e=this.height=G(this.nextRow);this.image.resize({width:t,height:e})}getKey(t,e){return t.join(",")+e}getDashRanges(t,e,i){const r=[];let n=t.length%2==1?-t[t.length-1]*i:0,o=t[0]*i,s=!0;r.push({left:n,right:o,isDash:s,zeroLength:0===t[0]});let a=t[0];for(let e=1;e<t.length;e++){s=!s;const l=t[e];n=a*i,a+=l,o=a*i,r.push({left:n,right:o,isDash:s,zeroLength:0===l})}return r}addRoundDash(t,e,i){const r=e/2;for(let e=-i;e<=i;e++){const n=this.width*(this.nextRow+i+e);let o=0,s=t[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=t[++o]);const l=Math.abs(a-s.left),c=Math.abs(a-s.right),u=Math.min(l,c);let h;const d=e/i*(r+1);if(s.isDash){const t=r-Math.abs(d);h=Math.sqrt(u*u+t*t)}else h=r-Math.sqrt(u*u+d*d);this.image.data[n+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(t,e){for(let e=t.length-1;e>=0;--e){const i=t[e],r=t[e+1];i.zeroLength?t.splice(e,1):r&&r.isDash===i.isDash&&(r.left=i.left,t.splice(e,1))}const i=t[0],r=t[t.length-1];i.isDash===r.isDash&&(i.left=r.left-this.width,r.right=i.right+this.width);const n=this.width*this.nextRow;let o=0,s=t[o];for(let i=0;i<this.width;i++){i/s.right>1&&(s=t[++o]);const r=Math.abs(i-s.left),a=Math.abs(i-s.right),l=Math.min(r,a);this.image.data[n+i]=Math.max(0,Math.min(255,(s.isDash?l:-l)+e+128))}}addDash(t,e){const i=this.getKey(t,e);if(this.positions[i])return this.positions[i];const r="round"===e,n=r?7:0,o=2*n+1;if(this.nextRow+o>this.height)return Y("LineAtlas out of space"),null;0===t.length&&t.push(1);let s=0;for(let e=0;e<t.length;e++)t[e]<0&&(Y("Negative value is found in line dasharray, replacing values with 0"),t[e]=0),s+=t[e];if(0!==s){const i=this.width/s,o=this.getDashRanges(t,this.width,i);r?this.addRoundDash(o,i,n):this.addRegularDash(o,"square"===e?.5*i:0)}const a=this.nextRow+n;this.nextRow+=o;const l={tl:[a,n],br:[s,0]};return this.positions[i]=l,l}}xs(kw,"LineAtlas");class Bw{constructor(t){const e={},i=[];for(const r in t){const n=t[r],o=e[r]={};for(const t in n.glyphs){const e=n.glyphs[+t];if(!e||0===e.bitmap.width||0===e.bitmap.height)continue;const r=e.metrics.localGlyph?2:1,s={x:0,y:0,w:e.bitmap.width+2*r,h:e.bitmap.height+2*r};i.push(s),o[t]=s}}const{w:r,h:n}=c_(i),o=new xf({width:r||1,height:n||1});for(const i in t){const r=t[i];for(const t in r.glyphs){const n=r.glyphs[+t];if(!n||0===n.bitmap.width||0===n.bitmap.height)continue;const s=e[i][t],a=n.metrics.localGlyph?2:1;xf.copy(n.bitmap,o,{x:0,y:0},{x:s.x+a,y:s.y+a},n.bitmap)}}this.image=o,this.positions=e}}xs(Bw,"GlyphAtlas");class Fw{constructor(t){this.tileID=new gd(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.scope=t.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.promoteId=t.promoteId,this.isSymbolTile=t.isSymbolTile,this.tileTransform=N_(t.tileID.canonical,t.projection),this.projection=t.projection,this.brightness=t.brightness,this.extraShadowCaster=!!t.extraShadowCaster}parse(t,e,i,r,n){this.status="parsing",this.data=t,this.collisionBoxArray=new Gl;const o=new Om(Object.keys(t.layers).sort()),s=new _g(this.tileID,this.promoteId);s.bucketLayerIDs=[];const a={},l=new kw(256,256),c={featureIndex:s,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:l,availableImages:i,brightness:this.brightness},u=e.familiesBySource[this.source];for(const e in u){const r=t.layers[e];if(!r)continue;let n=!1,l=!1,h=!1;for(const t of u[e])"symbol"===t[0].type?n=!0:l=!0,t[0].is3D()&&"model"!==t[0].type&&(h=!0);if(this.extraShadowCaster&&!h)continue;if(!0===this.isSymbolTile&&!n)continue;if(!1===this.isSymbolTile&&!l)continue;1===r.version&&Y(`Vector tile source "${this.source}" layer "${e}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const d=o.encode(e),p=[];for(let t=0;t<r.length;t++){const i=r.feature(t),n=s.getId(i,e);p.push({feature:i,id:n,index:t,sourceLayerIndex:d})}for(const t of u[e]){const e=t[0];(!this.extraShadowCaster||e.is3D()&&"model"!==e.type)&&(void 0!==this.isSymbolTile&&"symbol"===e.type!==this.isSymbolTile||e.minzoom&&this.zoom<Math.floor(e.minzoom)||e.maxzoom&&this.zoom>=e.maxzoom||"none"!==e.visibility&&(zw(t,this.zoom,c.brightness,i),(a[e.id]=e.createBucket({index:s.bucketLayerIDs.length,layers:t,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:d,sourceID:this.source,projection:this.projection.spec})).populate(p,c,this.tileID.canonical,this.tileTransform),s.bucketLayerIDs.push(t.map(t=>t.id))))}}let h,d,p,f;l.trim();const m={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},g=()=>{if(h)return this.status="done",n(h);if(this.extraShadowCaster)this.status="done",n(null,{buckets:k(a).filter(t=>!t.isEmpty()),featureIndex:s,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:c.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(d&&p&&f){const t=new Bw(d),e=new h_(p,f);for(const r in a){const n=a[r];n instanceof Sy?(zw(n.layers,this.zoom,c.brightness,i),I_(n,d,t.positions,p,e.iconPositions,this.showCollisionBoxes,i,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):n.hasPattern&&(n instanceof Oy||n instanceof lm||n instanceof Tb)&&(zw(n.layers,this.zoom,c.brightness,i),n.addFeatures(c,this.tileID.canonical,e.patternPositions,i,this.tileTransform,this.brightness))}this.status="done",n(null,{buckets:k(a).filter(t=>!t.isEmpty()),featureIndex:s,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,lineAtlas:l,imageAtlas:e,brightness:c.brightness})}};if(!this.extraShadowCaster){const t=H(c.glyphDependencies,t=>Object.keys(t).map(Number));Object.keys(t).length?r.send("getGlyphs",{uid:this.uid,stacks:t,scope:this.scope},(t,e)=>{h||(h=t,d=e,g())},void 0,!1,m):d={};const e=Object.keys(c.iconDependencies);e.length?r.send("getImages",{icons:e,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(t,e)=>{h||(h=t,p=e,g())},void 0,!1,m):p={};const i=Object.keys(c.patternDependencies);i.length?r.send("getImages",{icons:i,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(t,e)=>{h||(h=t,f=e,g())},void 0,!1,m):f={}}g()}}function zw(t,e,i,r){const n=new Ua(e,{brightness:i});for(const e of t)e.recalculate(n,r)}class Nw{constructor(t){this.entries={},this.scheduler=t}request(t,e,i,r){const n=this.entries[t]=this.entries[t]||{callbacks:[]};if(n.result){const[t,i]=n.result;return this.scheduler?this.scheduler.add(()=>{r(t,i)},e):r(t,i),()=>{}}return n.callbacks.push(r),n.cancel||(n.cancel=i((i,r)=>{n.result=[i,r];for(const t of n.callbacks)this.scheduler?this.scheduler.add(()=>{t(i,r)},e):t(i,r);setTimeout(()=>delete this.entries[t],3e3)})),()=>{n.result||(n.callbacks=n.callbacks.filter(t=>t!==r),n.callbacks.length||(n.cancel(),delete this.entries[t]))}}}function Uw(t,e,i){const r=JSON.stringify(t.request);return t.data&&(this.deduped.entries[r]={result:[null,t.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},e=>{const r=Et(t.request,(t,r,n,o)=>{t?e(t):r&&e(null,{vectorTile:i?void 0:new Cm(new tg(r)),rawData:r,cacheControl:n,expires:o})});return()=>{r.cancel(),e()}},e)}class Gw extends Re{constructor(t,e,i,r){if(super(),this.id=t,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,B(this,F(e,["url","scheme","tileSize","promoteId"])),this._options=B({type:"vector"},e),this._collectResourceTiming=!!e.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r),this._tileWorkers={},this._deduped=new Nw}load(t){this._loaded=!1,this.fire(new Ce("dataloading",{dataType:"source"}));const e=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map._worldview;this._tileJSONRequest=Dw(this._options,this.map._requestManager,e,i,(r,n)=>{this._tileJSONRequest=null,this._loaded=!0,r?(e&&console.warn("Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: "+e),i&&2!==i.length&&console.warn("Requested worldview strings must be a valid ISO alpha-2 code. Found: "+i),this.fire(new Pe(r))):n&&(B(this,n),n.bounds&&(this.tileBounds=new Lw(n.bounds,this.minzoom,this.maxzoom)),Xt(n.tiles,this.map._requestManager._customAccessToken),this.fire(new Ce("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Ce("data",{dataType:"source",sourceDataType:"content"}))),t&&t(r)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=tl(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return B({},this._options)}loadTile(t,e){const i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(i,vt.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:pe.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster};if(r.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=e:t.request=t.actor.send("reloadTile",r,n.bind(this));else if(t.actor=this._tileWorkers[i]=this._tileWorkers[i]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",r,n.bind(this),void 0,!0);else{const e=Uw.call({deduped:this._deduped},r,(e,i)=>{e||!i?n.call(this,e):(r.data={cacheControl:i.cacheControl,expires:i.expires,rawData:i.rawData.slice(0)},t.actor&&t.actor.send("loadTile",r,n.bind(this),void 0,!0))},!0);t.request={cancel:e}}function n(i,r){return delete t.request,t.aborted?e(null):i&&404!==i.status?e(i):(r&&r.resourceTiming&&(t.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&r&&t.setExpiryData(r),t.loadVectorData(r,this.map.painter),yt(this.dispatcher),e(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class jw extends Re{constructor(t,e,i,r){super(),this.id=t,this.dispatcher=i,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=B({type:"raster"},e),B(this,F(e,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new Ce("dataloading",{dataType:"source"})),this._tileJSONRequest=Dw(this._options,this.map._requestManager,null,null,(e,i)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new Pe(e)):i&&(B(this,i),i.bounds&&(this.tileBounds=new Lw(i.bounds,this.minzoom,this.maxzoom)),Xt(i.tiles),this.fire(new Ce("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Ce("data",{dataType:"source",sourceDataType:"content"}))),t&&t(e)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=tl(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return B({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,e){const i=pe.devicePixelRatio>=2,r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),i,this.tileSize);t.request=Ct(this.map._requestManager.transformRequest(r,vt.Tile),(i,r,n,o)=>(delete t.request,t.aborted?(t.state="unloaded",e(null)):i?(t.state="errored",e(i)):r?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:n,expires:o}),t.setTexture(r,this.map.painter),t.state="loaded",yt(this.dispatcher),void e(null)):e(null)))}abortTile(t,e){t.request&&(t.request.cancel(),delete t.request),e()}unloadTile(t,e){t.texture&&t.texture instanceof Dy?(t.destroy(!0),t.texture&&t.texture instanceof Dy&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),e()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Vw(){return null!=xI.workerClass?new xI.workerClass:new i.Worker(xI.workerUrl)}const Xw="mapboxgl_preloaded_worker_pool";class Hw{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Hw.workerCount;)this.workers.push(new Vw);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&0===this.numActive()&&(this.workers.forEach(t=>{t.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Xw]}numActive(){return Object.keys(this.active).length}}let qw;function Ww(){return qw||(qw=new Hw),qw}Hw.workerCount=2;let $w,Yw,Zw,Kw=null;function Jw(){return tt()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Yw||o.DRACO_URL}const Qw={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},tT={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},eT={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function iT(t,e,i){const r=i.json.bufferViews.length,n=i.buffers.length;e.bufferView=r,i.json.bufferViews[r]={buffer:n,byteLength:t.byteLength},i.buffers[n]=t}const rT="KHR_draco_mesh_compression";function nT(t,e){const i=t.extensions&&t.extensions[rT];if(!i)return;const r=new Zw.Decoder,n=cT(e,i.bufferView),o=new Zw.Mesh;if(!r.DecodeArrayToMesh(n,n.byteLength,o))throw new Error("Failed to decode Draco mesh");const s=e.json.accessors[t.indices],a=Qw[s.componentType],l=s.count*a.BYTES_PER_ELEMENT,c=Zw._malloc(l);a===Uint16Array?r.GetTrianglesUInt16Array(o,l,c):r.GetTrianglesUInt32Array(o,l,c),iT(Zw.memory.buffer.slice(c,c+l),s,e),Zw._free(c);for(const n of Object.keys(i.attributes)){const s=r.GetAttributeByUniqueId(o,i.attributes[n]),a=e.json.accessors[t.attributes[n]],l=tT[a.componentType],c=a.count*eT[a.type]*Qw[a.componentType].BYTES_PER_ELEMENT,u=Zw._malloc(c);r.GetAttributeDataArrayForAllPoints(o,s,Zw[l],c,u),iT(Zw.memory.buffer.slice(u,u+c),a,e),Zw._free(u)}r.destroy(),o.destroy(),delete t.extensions[rT]}const oT=1179937895,sT=new TextDecoder("utf8");function aT(t,e){return new URL(t,e).href}function lT(t,e,i,r){return fetch(aT(t.uri,r)).then(t=>t.arrayBuffer()).then(t=>{e.buffers[i]=t})}function cT(t,e){const i=t.json.bufferViews[e];return new Uint8Array(t.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function uT(t,e,r,n){if(t.uri){const o=aT(t.uri,n);return fetch(o).then(t=>t.blob()).then(t=>i.createImageBitmap(t)).then(t=>{e.images[r]=t})}if(void 0!==t.bufferView){const n=cT(e,t.bufferView),o=new i.Blob([n],{type:t.mimeType});return i.createImageBitmap(o).then(t=>{e.images[r]=t})}}function hT(t,e=0,i){const r={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===oT){const i=new Uint32Array(t,e);let n=2;const o=(i[n++]>>2)-3,s=i[n++]>>2;if(n++,r.json=JSON.parse(sT.decode(i.subarray(n,n+s))),n+=s,n<o){const o=i[n++];n++;const s=e+(n<<2);r.buffers[0]=t.slice(s,s+o)}}else r.json=JSON.parse(sT.decode(new Uint8Array(t,e)));const{buffers:n,images:o,meshes:s,extensionsUsed:a}=r.json;let l=Promise.resolve();if(n){const t=[];for(let e=0;e<n.length;e++){const o=n[e];o.uri?t.push(lT(o,r,e,i)):r.buffers[e]||(r.buffers[e]=null)}l=Promise.all(t)}return l.then(()=>{const t=[],e=a&&a.includes(rT);if(e&&t.push(function(){if(!Zw)return $w||($w=function(t){let e,i=null;function r(){e=new Uint8Array(i.buffer)}function n(){throw new Error("Unexpected Draco error.")}const o={a:{a:n,d:function(t,i,r){return e.copyWithin(t,i,i+r)},c:function(t){const n=e.length,o=Math.max(t>>>0,Math.ceil(1.2*n)),s=Math.ceil((o-n)/65536);try{return i.grow(s),r(),!0}catch(t){return!1}},b:n}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(t,o):t.then(t=>t.arrayBuffer()).then(t=>WebAssembly.instantiate(t,o))).then(t=>{const{Rb:n,Qb:o,P:s,T:a,X:l,Ja:c,La:u,Qa:h,Va:d,Wa:p,eb:f,jb:m,f:g,e:_,yb:y,zb:v,Ab:x,Bb:b,Db:w,Gb:T}=t.instance.exports;i=_;const E=(()=>{let t=0,i=0,r=0,s=0;return a=>{r&&(n(s),n(t),i+=r,r=t=0),t||(i+=128,t=o(i));const l=a.length+7&-8;let c=t;l>=i&&(r=l,c=s=o(l));for(let t=0;t<a.length;t++)e[c+t]=a[t];return c}})();return r(),g(),{memory:_,_free:n,_malloc:o,Mesh:class{constructor(){this.ptr=s()}destroy(){a(this.ptr)}},Decoder:class{constructor(){this.ptr=c()}destroy(){m(this.ptr)}DecodeArrayToMesh(t,e,i){const r=E(t),n=u(this.ptr,r,e,i.ptr);return!!l(n)}GetAttributeByUniqueId(t,e){return{ptr:h(this.ptr,t.ptr,e)}}GetTrianglesUInt16Array(t,e,i){d(this.ptr,t.ptr,e,i)}GetTrianglesUInt32Array(t,e,i){p(this.ptr,t.ptr,e,i)}GetAttributeDataArrayForAllPoints(t,e,i,r,n){f(this.ptr,t.ptr,e.ptr,i,r,n)}},DT_INT8:y(),DT_UINT8:v(),DT_INT16:x(),DT_UINT16:b(),DT_UINT32:w(),DT_FLOAT32:T()}})}(fetch(Jw())),$w.then(t=>{Zw=t,$w=void 0}))}()),o)for(let e=0;e<o.length;e++)t.push(uT(o[e],r,e,i));return(t.length?Promise.all(t):Promise.resolve()).then(()=>{if(e&&s)for(const{primitives:t}of s)for(const e of t)nT(e,r);return r})})}function dT(t){return fetch(t).then(t=>t.arrayBuffer()).then(e=>hT(e,0,t))}class pT{constructor(t,e,i){if(this.triangleCount=e.length/3,this.min=new v(0,0),this.max=new v(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===t.length||0===i)return;const r=t.map(t=>t.x),n=t.map(t=>t.y);this.min=new v(Math.min(...r),Math.min(...n)),this.max=new v(Math.max(...r),Math.max(...n));const o=this.max.sub(this.min);o.x=Math.max(o.x,1),o.y=Math.max(o.y,1);const s=Math.max(o.x,o.y)/i;this.cellsX=Math.max(1,Math.ceil(o.x/s)),this.cellsY=Math.max(1,Math.ceil(o.y/s)),this.xScale=1/s,this.yScale=1/s;const a=[];for(let i=0;i<this.triangleCount;i++){const r=t[e[3*i+0]].sub(this.min),n=t[e[3*i+1]].sub(this.min),o=t[e[3*i+2]].sub(this.min),l=fT(Math.floor(Math.min(r.x,n.x,o.x)),this.xScale,this.cellsX),c=fT(Math.floor(Math.max(r.x,n.x,o.x)),this.xScale,this.cellsX),u=fT(Math.floor(Math.min(r.y,n.y,o.y)),this.yScale,this.cellsY),h=fT(Math.floor(Math.max(r.y,n.y,o.y)),this.yScale,this.cellsY),d=new v(0,0),p=new v(0,0),f=new v(0,0),m=new v(0,0);for(let t=u;t<=h;++t){d.y=p.y=t*s,f.y=m.y=(t+1)*s;for(let e=l;e<=c;++e)d.x=f.x=e*s,p.x=m.x=(e+1)*s,(tf(r,n,o,d,p,m)||tf(r,n,o,d,m,f))&&a.push({cellIdx:t*this.cellsX+e,triIdx:i})}}if(0===a.length)return;a.sort((t,e)=>t.cellIdx-e.cellIdx||t.triIdx-e.triIdx);let l=0;for(;l<a.length;){const t=a[l].cellIdx,e={start:this.payload.length,len:0};for(;l<a.length&&a[l].cellIdx===t;)++e.len,this.payload.push(a[l++].triIdx);this.cells[t]=e}}query(t,e,i){if(0===this.triangleCount||0===this.cells.length)return;if(t.x>this.max.x||this.min.x>e.x)return;if(t.y>this.max.y||this.min.y>e.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let t=0;t<this.lookup.length;t++)this.lookup[t]=0;const r=fT(t.x-this.min.x,this.xScale,this.cellsX),n=fT(e.x-this.min.x,this.xScale,this.cellsX),o=fT(t.y-this.min.y,this.yScale,this.cellsY),s=fT(e.y-this.min.y,this.yScale,this.cellsY);for(let t=o;t<=s;t++)for(let e=r;e<=n;e++){const r=this.cells[t*this.cellsX+e];if(r)for(let t=0;t<r.len;t++){const e=this.payload[r.start+t],n=Math.floor(e/8),o=1<<e%8;if(!(this.lookup[n]&o)&&(this.lookup[n]|=o,i.push(e),i.length===this.triangleCount))return}}}}function fT(t,e,i){return Math.max(0,Math.min(i-1,Math.floor(t*e)))}function mT(t,e){const i=t.json.bufferViews[e.bufferView];return new(0,Qw[e.componentType])(t.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*eT[e.type])}function gT(t,e,i){const r=t.indices,n=t.attributes,o={};o.indexArray=new Ml;const s=e.json.accessors[r],a=s.count/3;o.indexArray.reserve(a);const l=mT(e,s);for(let t=0;t<a;t++)o.indexArray.emplaceBack(l[3*t],l[3*t+1],l[3*t+2]);o.indexArray._trim(),o.vertexArray=new kl;const c=e.json.accessors[n.POSITION];o.vertexArray.reserve(c.count);const u=mT(e,c);for(let t=0;t<c.count;t++)o.vertexArray.emplaceBack(u[3*t],u[3*t+1],u[3*t+2]);if(o.vertexArray._trim(),o.aabb=new Ad(c.min,c.max),o.centroid=function(t,e){const i=[0,0,0],r=t.length;if(r>0){for(let n=0;n<r;n++){const r=3*t[n];i[0]+=e[r],i[1]+=e[r+1],i[2]+=e[r+2]}i[0]/=r,i[1]/=r,i[2]/=r}return i}(l,u),void 0!==n.COLOR_0){const t=e.json.accessors[n.COLOR_0],i=eT[t.type];if(5126===t.componentType){o.colorArray=3===i?new kl:new ml,o.colorArray.reserve(t.count);const r=mT(e,t);if(3===i)for(let e=0;e<t.count;e++)o.colorArray.emplaceBack(r[3*e],r[3*e+1],r[3*e+2]);else for(let e=0;e<t.count;e++)o.colorArray.emplaceBack(r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]);o.colorArray._trim()}else if(5123===t.componentType&&4===i){o.colorArray=new ml,o.colorArray.resize(t.count);const i=mT(e,t),r=1/65535,n=o.colorArray.float32;for(let t=0;t<4*i.length;++t)n[t]=i[t]*r}else Y(`glTF color buffer parsing for accessor ${JSON.stringify(t)} is not supported`)}if(void 0!==n.NORMAL){o.normalArray=new kl;const t=e.json.accessors[n.NORMAL];o.normalArray.reserve(t.count);const i=mT(e,t);for(let e=0;e<t.count;e++)o.normalArray.emplaceBack(i[3*e],i[3*e+1],i[3*e+2]);o.normalArray._trim()}if(void 0!==n.TEXCOORD_0&&i.length>0){o.texcoordArray=new Bl;const t=e.json.accessors[n.TEXCOORD_0];o.texcoordArray.reserve(t.count);const i=mT(e,t);for(let e=0;e<t.count;e++)o.texcoordArray.emplaceBack(i[2*e],i[2*e+1]);o.texcoordArray._trim()}const h=t.material;return o.material=function(t,e){const{emissiveFactor:i=[0,0,0],alphaMode:r="OPAQUE",alphaCutoff:n=.5,normalTexture:o,occlusionTexture:s,emissiveTexture:a,doubleSided:l}=t,{baseColorFactor:c=[1,1,1,1],metallicFactor:u=1,roughnessFactor:h=1,baseColorTexture:d,metallicRoughnessTexture:p}=t.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new hi(...c),metallicFactor:u,roughnessFactor:h,baseColorTexture:d?e[d.index]:void 0,metallicRoughnessTexture:p?e[p.index]:void 0},doubleSided:l,emissiveFactor:i,alphaMode:r,alphaCutoff:n,normalTexture:o?e[o.index]:void 0,occlusionTexture:s?e[s.index]:void 0,emissionTexture:a?e[a.index]:void 0,defined:void 0===t.defined}}(void 0!==h?e.json.materials[h]:{defined:!1},i),void 0!==n._FEATURE_RGBA4444&&(o.featureData=new Uint32Array(mT(e,e.json.accessors[n._FEATURE_RGBA4444]).buffer)),o}function _T(t,e,i){const{matrix:r,rotation:n,translation:o,scale:s,mesh:a,extras:l,children:c}=t,u={};if(u.matrix=r||Jh.fromRotationTranslationScale([],n||[0,0,0,1],o||[0,0,0],s||[1,1,1]),void 0!==a){u.meshes=i[a];const t=u.anchor=[0,0];for(const e of u.meshes){const{min:i,max:r}=e.aabb;t[0]+=i[0]+r[0],t[1]+=i[1]+r[1]}t[0]=Math.floor(t[0]/u.meshes.length/2),t[1]=Math.floor(t[1]/u.meshes.length/2)}if(l&&(l.id&&(u.id=l.id),l.lights&&(u.lights=function(t){if(!t.length)return[];const e=function(t){const e=atob(t),i=new Uint8Array(e.length);for(let t=0;t<e.length;t++)i[t]=e.codePointAt(t);return i}(t),i=[],r=e.length/24,n=new Uint16Array(e.buffer),o=new Float32Array(e.buffer);for(let t=0;t<r;t++){const e=n[2*t*6]/30,r=n[2*t*6+1]/30,s=n[2*t*6+10]/100,a=o[6*t+1],l=o[6*t+2],c=o[6*t+3],u=o[6*t+4],h=c-a,d=u-l,p=Math.hypot(h,d);i.push({pos:[a+.5*h,l+.5*d,r],normal:[d/p,-h/p,0],width:p,height:e,depth:s,points:[a,l,c,u]})}return i}(l.lights))),c){const t=[];for(const r of c)t.push(_T(e.json.nodes[r],e,i));u.children=t}return u}function yT(t){if(0===t.vertices.length||0===t.indices.length)return null;const[e,i]=[t.vertices[0].clone(),t.vertices[0].clone()];for(let r=1;r<t.vertices.length;++r){const n=t.vertices[r];e.x=Math.min(e.x,n.x),e.y=Math.min(e.y,n.y),i.x=Math.max(i.x,n.x),i.y=Math.max(i.y,n.y)}const r=Math.ceil(Math.max(i.x-e.x,i.y-e.y)/256),n=Math.max(8,r),o=new pT(t.vertices,t.indices,n);return{vertices:t.vertices,indices:t.indices,grid:o,min:e,max:i}}function vT(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||0===e.length)return null;const i=e[0];if(!i||!Array.isArray(i)||0===i.length)return null;const r=[];for(const t of i){if(!Array.isArray(t)||2!==t.length)continue;const e=t[0],i=t[1];"number"==typeof e&&"number"==typeof i&&r.push(new v(e,i))}if(r.length<3)return null;r.length>1&&r[r.length-1].equals(r[0])&&r.pop();let n=0;for(let t=0;t<r.length;t++){const e=r[t],i=r[(t+1)%r.length],o=r[(t+2)%r.length];n+=(e.x-i.x)*(o.y-i.y)-(o.x-i.x)*(e.y-i.y)}n>0&&r.reverse();const o=rm(r.flatMap(t=>[t.x,t.y]),[]);return 0===o.length?null:{vertices:r,indices:o}}function xT(t){const e=[],i=[];let r=0;for(const n of t){r=e.length;const t=n.vertexArray.float32,o=n.indexArray.uint16;for(let i=0;i<n.vertexArray.length;i++)e.push(new v(t[3*i+0],t[3*i+1]));for(let t=0;t<3*n.indexArray.length;t++)i.push(o[t]+r)}if(i.length%3!=0)return null;for(let t=0;t<i.length;t+=3){const r=e[i[t+0]],n=e[i[t+1]],o=e[i[t+2]];(r.x-n.x)*(o.y-n.y)-(o.x-n.x)*(r.y-n.y)>0&&([i[t+1],i[t+2]]=[i[t+2],i[t+1]])}return{vertices:e,indices:i}}function bT(t){const e=function(t,e){const i=[];for(const r of t.json.meshes){const n=[];for(const i of r.primitives)n.push(gT(i,t,e));i.push(n)}return i}(t,function(t,e){const r=[],n=i.WebGL2RenderingContext;if(t.json.textures)for(const i of t.json.textures){const o={magFilter:n.LINEAR,minFilter:n.NEAREST,wrapS:n.REPEAT,wrapT:n.REPEAT};void 0!==i.sampler&&Object.assign(o,t.json.samplers[i.sampler]),r.push({image:e[i.source],sampler:o,uploaded:!1})}return r}(t,t.images)),{scenes:r,scene:n,nodes:o}=t.json,s=r?r[n||0].nodes:o,a=[];for(const i of s)a.push(_T(o[i],t,e));return function(t,e,i){const r={},n=new Set;for(let o=0;o<t.length;o++){const t=i[e[o]];if(!t.extras)continue;const s=t.extras["mapbox:footprint:version"],a=t.extras["mapbox:footprint:id"];(s||a)&&n.add(o),"1.0.0"===s&&a&&(r[a]=o)}for(let o=0;o<t.length;o++){if(n.has(o))continue;const s=t[o],a=i[e[o]];if(!a.extras)continue;let l=null;s.id in r&&(l=xT(t[r[s.id]].meshes)),l||(l=vT(a)),l&&(s.footprint=yT(l))}if(n.size>0){const e=Array.from(n.values()).sort((t,e)=>t-e);for(let i=e.length-1;i>=0;i--)t.splice(e[i],1)}}(a,s,t.json.nodes),a}function wT(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,i=t.aabb.min[0]-1,r=t.aabb.min[1]-1,n=64/(t.aabb.max[0]-i+2),o=64/(t.aabb.max[1]-r+2);for(let s=0;s<e.length;s+=3){const a=e[s+2],l=(e[s+0]-i)*n|0,c=(e[s+1]-r)*o|0;a>t.heightmap[64*c+l]&&(t.heightmap[64*c+l]=a)}}function TT(t,e){const i={};i.indexArray=new Ml,i.indexArray.reserve(4*t.length),i.vertexArray=new kl,i.vertexArray.reserve(10*t.length),i.colorArray=new ml,i.vertexArray.reserve(10*t.length);let r=0;for(const n of t){const t=Math.min(10,Math.max(4,1.3*n.height))*e,o=[-n.normal[1],n.normal[0],0],s=Math.min(.29,.1*n.width/n.depth),a=n.width-2*n.depth*e*(s+.01),l=nd.scaleAndAdd([],n.pos,o,a/2),c=nd.scaleAndAdd([],n.pos,o,-a/2),u=[l[0],l[1],l[2]+n.height],h=[c[0],c[1],c[2]+n.height],d=nd.scaleAndAdd([],n.normal,o,s);nd.scale(d,d,t);const p=nd.scaleAndAdd([],n.normal,o,-s);nd.scale(p,p,t),nd.add(d,l,d),nd.add(p,c,p),l[2]+=.1,c[2]+=.1,i.vertexArray.emplaceBack(d[0],d[1],d[2]),i.vertexArray.emplaceBack(p[0],p[1],p[2]),i.vertexArray.emplaceBack(l[0],l[1],l[2]),i.vertexArray.emplaceBack(c[0],c[1],c[2]),i.vertexArray.emplaceBack(u[0],u[1],u[2]),i.vertexArray.emplaceBack(h[0],h[1],h[2]),i.vertexArray.emplaceBack(l[0],l[1],l[2]),i.vertexArray.emplaceBack(c[0],c[1],c[2]),i.vertexArray.emplaceBack(d[0],d[1],d[2]),i.vertexArray.emplaceBack(p[0],p[1],p[2]);const f=a/t/2;i.colorArray.emplaceBack(-f-s,-1,f,.8),i.colorArray.emplaceBack(f+s,-1,f,.8),i.colorArray.emplaceBack(-f,0,f,1.3),i.colorArray.emplaceBack(f,0,f,1.3),i.colorArray.emplaceBack(f+s,-.8,f,.7),i.colorArray.emplaceBack(f+s,-.8,f,.7),i.colorArray.emplaceBack(0,0,f,1.3),i.colorArray.emplaceBack(0,0,f,1.3),i.colorArray.emplaceBack(f+s,-1.2,f,.8),i.colorArray.emplaceBack(f+s,-1.2,f,.8),i.indexArray.emplaceBack(6+r,4+r,8+r),i.indexArray.emplaceBack(7+r,9+r,5+r),i.indexArray.emplaceBack(0+r,1+r,2+r),i.indexArray.emplaceBack(1+r,3+r,2+r),r+=10}const n={defined:!0,emissiveFactor:[0,0,0]},o={};return o.baseColorFactor=hi.white,n.pbrMetallicRoughness=o,i.material=n,i.aabb=new Ad([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}xs(pT,"TriangleGridIndex");const ET={vector:Gw,raster:jw,"raster-dem":class extends jw{constructor(t,e,i,r){super(t,e,i,r),this.type="raster-dem",this.maxzoom=22,this._options=B({type:"raster-dem"},e),this.encoding=e.encoding||"mapbox"}loadTile(t,e){const r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function n(i,r){i&&(t.state="errored",e(i)),r&&(t.dem=r,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",e(null))}t.request=Ct(this.map._requestManager.transformRequest(r,vt.Tile),function(r,o,s,a){if(delete t.request,t.aborted)t.state="unloaded",e(null);else if(r)t.state="errored",e(r);else if(o){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:s,expires:a});const e=i.ImageBitmap&&o instanceof i.ImageBitmap&&de(),r=1-(o.width-((l=o.width)<=1?1:Math.pow(2,Math.floor(Math.log(l)/Math.LN2))))/2;r<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const c=e?o:pe.getImageData(o,r),u={uid:t.uid,coord:t.tileID,source:this.id,scope:this.scope,rawImageData:c,encoding:this.encoding,padding:r};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",u,n.bind(this),void 0,!0))}var l}.bind(this))}_getNeighboringTiles(t){const e=t.canonical,i=Math.pow(2,e.z),r=(e.x-1+i)%i,n=0===e.x?t.wrap-1:t.wrap,o=(e.x+1+i)%i,s=e.x+1===i?t.wrap+1:t.wrap,a={};return a[new gd(t.overscaledZ,n,e.z,r,e.y).key]={backfilled:!1},a[new gd(t.overscaledZ,s,e.z,o,e.y).key]={backfilled:!1},e.y>0&&(a[new gd(t.overscaledZ,n,e.z,r,e.y-1).key]={backfilled:!1},a[new gd(t.overscaledZ,t.wrap,e.z,e.x,e.y-1).key]={backfilled:!1},a[new gd(t.overscaledZ,s,e.z,o,e.y-1).key]={backfilled:!1}),e.y+1<i&&(a[new gd(t.overscaledZ,n,e.z,r,e.y+1).key]={backfilled:!1},a[new gd(t.overscaledZ,t.wrap,e.z,e.x,e.y+1).key]={backfilled:!1},a[new gd(t.overscaledZ,s,e.z,o,e.y+1).key]={backfilled:!1}),a}},geojson:class extends Re{constructor(t,e,i,r){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(r),this._data=e.data,this._options=B({},e),this._collectResourceTiming=e.collectResourceTiming,void 0!==e.maxzoom&&(this.maxzoom=e.maxzoom),e.type&&(this.type=e.type),e.attribution&&(this.attribution=e.attribution),this.promoteId=e.promoteId;const n=ur/this.tileSize;this.workerOptions=B({source:this.id,scope:this.scope,cluster:e.cluster||!1,geojsonVtOptions:{buffer:(void 0!==e.buffer?e.buffer:128)*n,tolerance:(void 0!==e.tolerance?e.tolerance:.375)*n,extent:ur,maxZoom:this.maxzoom,lineMetrics:e.lineMetrics||!1,generateId:e.generateId||!1},superclusterOptions:{maxZoom:void 0!==e.clusterMaxZoom?e.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,e.clusterMinPoints||2),extent:ur,radius:(void 0!==e.clusterRadius?e.clusterRadius:50)*n,log:!1,generateId:e.generateId||!1},clusterProperties:e.clusterProperties,filter:e.filter},e.workerOptions)}onAdd(t){this.map=t,this.setData(this._data)}setData(t){return this._data=t,this._updateWorkerData(),this}getClusterExpansionZoom(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id,scope:this.scope},e),this}getClusterChildren(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id,scope:this.scope},e),this}getClusterLeaves(t,e,i,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:t,limit:e,offset:i},r),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new Ce("dataloading",{dataType:"source"})),this._loaded=!1;const t=B({},this.workerOptions);t.scope=this.scope;const e=this._data;"string"==typeof e?(t.request=this.map._requestManager.transformRequest(pe.resolveURL(e),vt.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(e),this._pendingLoad=this.actor.send(this.type+".loadData",t,(t,e)=>{if(this._loaded=!0,this._pendingLoad=null,t)this.fire(new Pe(t));else{const t={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&e&&e.resourceTiming&&e.resourceTiming[this.id]&&(t.resourceTiming=e.resourceTiming[this.id]),this.fire(new Ce("data",t)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(t,e){const i=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const r={type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:pe.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};t.request=this.actor.send(i,r,(r,n)=>(delete t.request,t.destroy(),t.aborted?e(null):r?e(r):(t.loadVectorData(n,this.map.painter,"reloadTile"===i),e(null))),void 0,"loadTile"===i)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return B({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ew{constructor(t,e,i,r){super(t,e,i,r),this.roundZoom=!0,this.type="video",this.options=e}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const e of t.urls)this.urls.push(this.map._requestManager.transformRequest(e,vt.Source).url);!function(t,e){const r=i.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let e=0;e<t.length;e++){const n=i.document.createElement("source");St(t[e])||(r.crossOrigin="Anonymous"),n.src=t[e],r.appendChild(n)}}(this.urls,(t,e)=>{this._loaded=!0,t?this.fire(new Pe(t)):e&&(this.video=e,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const e=this.video.seekable;t<e.start(0)||t>e.end(0)?this.fire(new Pe(new De("sources."+this.id,null,`Playback for this video can be set only between the ${e.start(0)} and ${e.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,e=t.gl;this.texture?this.video.paused||(this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE),e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,this.video)):(this.texture=new Dy(t,this.video,e.RGBA),this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ew,model:class extends Re{constructor(t,e,i,r){super(),this.id=t,this.type="model",this.models=[],this._loaded=!1,this._options=e}load(){const t=[];for(const e in this._options.models){const i=this._options.models[e],r=dT(this.map._requestManager.transformRequest(i.uri,vt.Model).url).then(t=>{if(!t)return;const r=bT(t),n=new Ox(e,i.position,i.orientation,r);n.computeBoundsAndApplyParent(),this.models.push(n)}).catch(t=>{this.fire(new Pe(new Error(`Could not load model ${e} from ${i.uri}: ${t.message}`)))});t.push(r)}return Promise.allSettled(t).then(()=>{this._loaded=!0,this.fire(new Ce("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new Pe(new Error("Could not load models: "+t.message)))})}onAdd(t){this.map=t,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(t,e){}serialize(){return{type:"model"}}},"batched-model":class extends Re{constructor(t,e,i,r){super(),this.type="batched-model",this.id=t,this.tileSize=512,this._options=e,this.tiles=this._options.tiles,this.maxzoom=e.maxzoom||19,this.minzoom=e.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=i,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(r)}onAdd(t){this.map=t,this.load()}load(t){this._loaded=!1,this.fire(new Ce("dataloading",{dataType:"source"}));const e=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map._worldview;this._tileJSONRequest=Dw(this._options,this.map._requestManager,e,i,(r,n)=>{this._tileJSONRequest=null,this._loaded=!0,r?(e&&console.warn("Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: "+e),i&&2!==i.length&&console.warn("Requested worldview strings must be a valid ISO alpha-2 code. Found: "+i),this.fire(new Pe(r))):n&&(B(this,n),n.bounds&&(this.tileBounds=new Lw(n.bounds,this.minzoom,this.maxzoom)),Xt(n.tiles,this.map._requestManager._customAccessToken),this.fire(new Ce("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Ce("data",{dataType:"source",sourceDataType:"content"}))),t&&t(r)})}hasTransition(){return!1}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loaded(){return this._loaded}loadTile(t,e){const i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(i,vt.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(t.actor&&"expired"!==t.state)if("loading"===t.state)t.reloadCallback=e;else{if(t.buckets){const e=Object.values(t.buckets);for(const t of e)t.dirty=!0;return void(t.state="loaded")}t.request=t.actor.send("reloadTile",r,n.bind(this))}else t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",r,n.bind(this),void 0,!0);function n(i,r){return t.aborted?e(null):i&&404!==i.status?e(i):(r&&(r.resourceTiming&&(t.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&t.setExpiryData(r),t.buckets={...t.buckets,...r.buckets}),t.state="loaded",void e(null))}}serialize(){return B({},this._options)}},canvas:class extends ew{constructor(t,e,r,n){super(t,e,r,n),e.coordinates?Array.isArray(e.coordinates)&&4===e.coordinates.length&&!e.coordinates.some(t=>!Array.isArray(t)||2!==t.length||t.some(t=>"number"!=typeof t))||this.fire(new Pe(new De("sources."+t,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new Pe(new De("sources."+t,null,'missing required property "coordinates"'))),e.animate&&"boolean"!=typeof e.animate&&this.fire(new Pe(new De("sources."+t,null,'optional "animate" property must be a boolean value'))),e.canvas?"string"==typeof e.canvas||e.canvas instanceof i.HTMLCanvasElement||this.fire(new Pe(new De("sources."+t,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new Pe(new De("sources."+t,null,'missing required property "canvas"'))),this.options=e,this.animate=void 0===e.animate||e.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof i.HTMLCanvasElement?this.options.canvas:i.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new Pe(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const e=this.map.painter.context;this.texture?!t&&!this._playing||this.texture instanceof Ly||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Dy(e,this.canvas,e.gl.RGBA,{premultiply:!0}),this._prepareData(e)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}},custom:class extends Re{constructor(t,e,i,r){super(),this.id=t,this.type="custom",this._dataType="raster",this._dispatcher=i,this._implementation=e,this.setEventedParent(r),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new Pe(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new Pe(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Lw(this._implementation.bounds,this.minzoom,this.maxzoom)),e.update=this._update.bind(this),e.clearTiles=this._clearTiles.bind(this),e.coveringTiles=this._coveringTiles.bind(this),B(this,F(e,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return F(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new Ce("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Ce("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(t){this._map=t,this._loaded=!1,this.fire(new Ce("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load()}onRemove(t){this._implementation.onRemove&&this._implementation.onRemove(t)}hasTile(t){if(this._implementation.hasTile){const{x:e,y:i,z:r}=t.canonical;return this._implementation.hasTile({x:e,y:i,z:r})}return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,e){const{x:r,y:n,z:o}=t.tileID.canonical,s=new i.AbortController;t.request=Promise.resolve(this._implementation.loadTile({x:r,y:n,z:o},{signal:s.signal})).then(function(r){return delete t.request,t.aborted?(t.state="unloaded",e(null)):void 0===r?(t.state="errored",e(null)):null===r?(this.loadTileData(t,{width:this.tileSize,height:this.tileSize,data:null}),t.state="loaded",e(null)):function(t){return t instanceof i.ImageData||t instanceof i.HTMLCanvasElement||t instanceof i.ImageBitmap||t instanceof i.HTMLImageElement}(r)?(this.loadTileData(t,r),t.state="loaded",void e(null)):(t.state="errored",e(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(i=>{20!==i.code&&(t.state="errored",e(i))}),t.request.cancel=()=>s.abort()}loadTileData(t,e){t.setTexture(e,this._map.painter)}unloadTile(t,e){if(t.texture&&t.texture instanceof Dy?(t.destroy(!0),t.texture&&t.texture instanceof Dy&&this._map.painter.saveTileTexture(t.texture)):t.destroy(),this._implementation.unloadTile){const{x:e,y:i,z:r}=t.tileID.canonical;this._implementation.unloadTile({x:e,y:i,z:r})}e()}abortTile(t,e){t.request&&t.request.cancel&&(t.request.cancel(),delete t.request),e()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(t=>({x:t.canonical.x,y:t.canonical.y,z:t.canonical.z}))}_clearTiles(){const t=tl(this.id,this.scope);this._map.style.clearSource(t)}_update(){this.fire(new Ce("data",{dataType:"source",sourceDataType:"content"}))}}},ST=function(t,e,i,r){const n=new ET[e.type](t,e,i,r);if(n.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${n.id}`);return V(["load","abort","unload","serialize","prepare"],n),n};function AT(t,e){const i=Jh.identity([]);return Jh.scale(i,i,[.5*t.width,.5*-t.height,1]),Jh.translate(i,i,[1,-1,0]),Jh.multiply(i,i,t.calculateProjMatrix(e.toUnwrapped())),Float32Array.from(i)}function MT(t,e,i,r,n,o,s,a=!1){const l=t.tilesIn(r,s,a);l.sort(CT);const c=[];for(const r of l)c.push({wrappedTileID:r.tile.tileID.wrapped().key,queryResults:r.tile.queryRenderedFeatures(e,i,t._state,r,n,o,AT(t.transform,r.tile.tileID),a)});const u=function(t){const e={},i={};for(const r of t){const t=r.queryResults,n=r.wrappedTileID,o=i[n]=i[n]||{};for(const i in t){const r=t[i],n=o[i]=o[i]||{},s=e[i]=e[i]||[];for(const t of r)n[t.featureIndex]||(n[t.featureIndex]=!0,s.push(t))}}return e}(c);for(const e in u)u[e].forEach(e=>{const i=e.feature,r=i.layer;r&&"background"!==r.type&&"sky"!==r.type&&"slot"!==r.type&&(i.source=r.source,r["source-layer"]&&(i.sourceLayer=r["source-layer"]),i.state=void 0!==i.id?t.getFeatureState(r["source-layer"],i.id):{})});return u}function IT(t,e){const i=t.getRenderableIds().map(e=>t.getTileByID(e)),r=[],n={};for(let t=0;t<i.length;t++){const o=i[t],s=o.tileID.canonical.key;n[s]||(n[s]=!0,o.querySourceFeatures(r,e))}return r}function CT(t,e){const i=t.tileID,r=e.tileID;return i.overscaledZ-r.overscaledZ||i.canonical.y-r.canonical.y||i.wrap-r.wrap||i.canonical.x-r.canonical.x}class PT{constructor(t){this.style=t}processLayersChanged(){this.layers=[];for(const t in this.style._mergedLayers){const e=this.style._mergedLayers[t];if("fill-extrusion"===e.type)this.layers.push(e);else if("model"===e.type){const t=this.style.getLayerSource(e);t&&"batched-model"===t.type&&this.layers.push(e)}}}updateZOffset(t,e){this.currentBuildingBuckets=[];for(let t=0;t<this.layers.length;++t){const i=this.layers[t],r=this.style.getLayerSourceCache(i);let n=1;"fill-extrusion"===i.type&&(n=i.paint.get("fill-extrusion-opacity")>0?i.paint.get("fill-extrusion-vertical-scale"):0);let o=r?r.getTile(e):null;if(!o&&r&&e.canonical.z>r.getSource().minzoom){let t=e.scaledTo(Math.min(r.getSource().maxzoom,e.overscaledZ-1));for(;t.overscaledZ>=r.getSource().minzoom&&(o=r.getTile(t),!o&&0!==t.overscaledZ);)t=t.scaledTo(t.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:o?o.getBucket(i):null,tileID:o?o.tileID:e,verticalScale:n})}t.hasAnyZOffset=!1;let i=!1;for(let r=0;r<t.symbolInstances.length;r++){const n=t.symbolInstances.get(r),o=n.zOffset,s=this._getHeightAtTileOffset(e,n.tileAnchorX,n.tileAnchorY);n.zOffset=-1!==s?s:o,i||o===n.zOffset||(i=!0),t.hasAnyZOffset||0===n.zOffset||(t.hasAnyZOffset=!0)}i&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,e,i,r){let n=e,o=i;if(t.canonical.z!==r.canonical.z){const s=r.canonical,a=1/(1<<t.canonical.z-s.z);n=(e+t.canonical.x*ur)*a-s.x*ur|0,o=(i+t.canonical.y*ur)*a-s.y*ur|0}return{tileX:n,tileY:o}}_getHeightAtTileOffset(t,e,i){let r;for(let n=0;n<this.layers.length;++n){if("fill-extrusion"!==this.layers[n].type)continue;const{bucket:o,tileID:s,verticalScale:a}=this.currentBuildingBuckets[n];if(!o)continue;const{tileX:l,tileY:c}=this._mapCoordToOverlappingTile(t,e,i,s),u=o.getHeightAtTileCoord(l,c);if(u&&void 0!==u.height){if(!u.hidden)return u.height*a;r=u.height}}for(let n=0;n<this.layers.length;++n){if("model"!==this.layers[n].type)continue;const{bucket:o,tileID:s}=this.currentBuildingBuckets[n];if(!o)continue;const{tileX:a,tileY:l}=this._mapCoordToOverlappingTile(t,e,i,s),c=o.getHeightAtTileCoord(a,l);if(c&&!c.hidden)return void 0===c.height&&void 0!==r?Math.min(c.maxHeight,r)*c.verticalScale:(c.height||0)*c.verticalScale}return-1}}var RT=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function OT(t,e){const i={};for(const e in t)"ref"!==e&&(i[e]=t[e]);return RT.forEach(t=>{t in e&&(i[t]=e[t])}),i}function DT(t){t=t.slice();const e=Object.create(null);for(let i=0;i<t.length;i++)e[t[i].id]=t[i];for(let i=0;i<t.length;i++)"ref"in t[i]&&(t[i]=OT(t[i],e[t[i].ref]));return t}const LT={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function kT(t,e,i){i.push({command:LT.addSource,args:[t,e[t]]})}function BT(t,e,i){e.push({command:LT.removeSource,args:[t]}),i[t]=!0}function FT(t,e,i,r){BT(t,i,r),kT(t,e,i)}function zT(t,e,i){let r;for(r in t[i])if(t[i].hasOwnProperty(r)&&"data"!==r&&!x(t[i][r],e[i][r]))return!1;for(r in e[i])if(e[i].hasOwnProperty(r)&&"data"!==r&&!x(t[i][r],e[i][r]))return!1;return!0}function NT(t,e,i,r,n,o){let s;for(s in e=e||{},t=t||{})t.hasOwnProperty(s)&&(x(t[s],e[s])||i.push({command:o,args:[r,s,e[s],n]}));for(s in e)e.hasOwnProperty(s)&&!t.hasOwnProperty(s)&&(x(t[s],e[s])||i.push({command:o,args:[r,s,e[s],n]}))}function UT(t){return t.id}function GT(t,e){return t[e.id]=e,t}class jT{constructor(t,e){this.reset(t,e)}reset(t,e){this.points=t||[],this._distances=[0];for(let t=1;t<this.points.length;t++)this._distances[t]=this._distances[t-1]+this.points[t].dist(this.points[t-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=R(t,0,1);let e=1,i=this._distances[e];const r=t*this.paddedLength+this.padding;for(;i<r&&e<this._distances.length;)i=this._distances[++e];const n=e-1,o=this._distances[n],s=i-o,a=s>0?(r-o)/s:0;return this.points[n].mult(1-a).add(this.points[e].mult(a))}}class VT{constructor(t,e,i){const r=this.boxCells=[],n=this.circleCells=[];this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(e/i);for(let t=0;t<this.xCellCount*this.yCellCount;t++)r.push([]),n.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,e,i,r,n){this._forEachCell(e,i,r,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)}insertCircle(t,e,i,r){this._forEachCell(e-r,i-r,e+r,i+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(i),this.circles.push(r)}_insertBoxCell(t,e,i,r,n,o){this.boxCells[n].push(o)}_insertCircleCell(t,e,i,r,n,o){this.circleCells[n].push(o)}_query(t,e,i,r,n,o){if(i<0||t>this.width||r<0||e>this.height)return!n&&[];const s=[];if(t<=0&&e<=0&&this.width<=i&&this.height<=r){if(n)return!0;for(let t=0;t<this.boxKeys.length;t++)s.push({key:this.boxKeys[t],x1:this.bboxes[4*t],y1:this.bboxes[4*t+1],x2:this.bboxes[4*t+2],y2:this.bboxes[4*t+3]});for(let t=0;t<this.circleKeys.length;t++){const e=this.circles[3*t],i=this.circles[3*t+1],r=this.circles[3*t+2];s.push({key:this.circleKeys[t],x1:e-r,y1:i-r,x2:e+r,y2:i+r})}return o?s.filter(o):s}return this._forEachCell(t,e,i,r,this._queryCell,s,{hitTest:n,seenUids:{box:{},circle:{}}},o),n?s.length>0:s}_queryCircle(t,e,i,r,n){const o=t-i,s=t+i,a=e-i,l=e+i;if(s<0||o>this.width||l<0||a>this.height)return!r&&[];const c=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,c,{hitTest:r,circle:{x:t,y:e,radius:i},seenUids:{box:{},circle:{}}},n),r?c.length>0:c}query(t,e,i,r,n){return this._query(t,e,i,r,!1,n)}hitTest(t,e,i,r,n){return this._query(t,e,i,r,!0,n)}hitTestCircle(t,e,i,r){return this._queryCircle(t,e,i,!0,r)}_queryCell(t,e,i,r,n,o,s,a){const l=s.seenUids,c=this.boxCells[n];if(null!==c){const n=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(t<=n[c+2]&&e<=n[c+3]&&i>=n[c+0]&&r>=n[c+1]&&(!a||a(this.boxKeys[u]))){if(s.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[u],x1:n[c],y1:n[c+1],x2:n[c+2],y2:n[c+3]})}}}const u=this.circleCells[n];if(null!==u){const n=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(n[u],n[u+1],n[u+2],t,e,i,r)&&(!a||a(this.circleKeys[c]))){if(s.hitTest)return o.push(!0),!0;{const t=n[u],e=n[u+1],i=n[u+2];o.push({key:this.circleKeys[c],x1:t-i,y1:e-i,x2:t+i,y2:e+i})}}}}}_queryCellCircle(t,e,i,r,n,o,s,a){const l=s.circle,c=s.seenUids,u=this.boxCells[n];if(null!==u){const t=this.bboxes;for(const e of u)if(!c.box[e]){c.box[e]=!0;const i=4*e;if(this._circleAndRectCollide(l.x,l.y,l.radius,t[i+0],t[i+1],t[i+2],t[i+3])&&(!a||a(this.boxKeys[e])))return o.push(!0),!0}}const h=this.circleCells[n];if(null!==h){const t=this.circles;for(const e of h)if(!c.circle[e]){c.circle[e]=!0;const i=3*e;if(this._circlesCollide(t[i],t[i+1],t[i+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[e])))return o.push(!0),!0}}}_forEachCell(t,e,i,r,n,o,s,a){const l=this._convertToXCellCoord(t),c=this._convertToYCellCoord(e),u=this._convertToXCellCoord(i),h=this._convertToYCellCoord(r);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(n.call(this,t,e,i,r,this.xCellCount*l+d,o,s,a))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,e,i,r,n,o){const s=r-t,a=n-e,l=i+o;return l*l>s*s+a*a}_circleAndRectCollide(t,e,i,r,n,o,s){const a=(o-r)/2,l=Math.abs(t-(r+a));if(l>a+i)return!1;const c=(s-n)/2,u=Math.abs(e-(n+c));if(u>c+i)return!1;if(l<=a||u<=c)return!0;const h=l-a,d=u-c;return h*h+d*d<=i*i}}const XT=100;class HT{constructor(t,e,i=new VT(t.width+200,t.height+200,25),r=new VT(t.width+200,t.height+200,25)){this.transform=t,this.grid=i,this.ignoredGrid=r,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+XT,this.screenBottomBoundary=t.height+XT,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=e}placeCollisionBox(t,e,i,r,n,o,s,a){let l=i.projectedAnchorX,c=i.projectedAnchorY,u=i.projectedAnchorZ;const h=i.elevation,d=i.tileID,p=t.getProjection();if(h&&d){const[t,e,r]=p.upVector(d.canonical,i.tileAnchorX,i.tileAnchorY),n=p.upVectorScale(d.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;l+=t*h*n,c+=e*h*n,u+=r*h*n}const f=this.projectAndGetPerspectiveRatio(s,l,c,u,i.tileID,"globe"===p.name||!!h||this.transform.pitch>0,p),m=o*f.perspectiveRatio,g=(i.x1*e+r.x-i.padding)*m+f.point.x,_=(i.y1*e+r.y-i.padding)*m+f.point.y,y=(i.x2*e+r.x+i.padding)*m+f.point.x,v=(i.y2*e+r.y+i.padding)*m+f.point.y,x=f.perspectiveRatio<=.55||f.occluded;return!this.isInsideGrid(g,_,y,v)||!n&&this.grid.hitTest(g,_,y,v,a)||x?{box:[],offscreen:!1,occluded:f.occluded}:{box:[g,_,y,v],offscreen:this.isOffscreen(g,_,y,v),occluded:!1}}placeCollisionCircles(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f){const m=[],g=this.transform.elevation,_=t.getProjection(),y=g?g.getAtTileOffsetFunc(f,this.transform.center.lat,this.transform.worldSize,_):null,x=new v(i.tileAnchorX,i.tileAnchorY);let{x:b,y:w,z:T}=_.projectTilePoint(x.x,x.y,f.canonical);if(y){const[t,e,i]=y(x);b+=t,w+=e,T+=i}const E="globe"===_.name,S=this.projectAndGetPerspectiveRatio(s,b,w,T,f,E||!!g||this.transform.pitch>0,_),{perspectiveRatio:A}=S,M=(u?o/A:o*A)/24,I=px(b,w,T,a),C=S.signedDistanceFromCamera>0?_x(M,n,i.lineOffsetX*M,i.lineOffsetY*M,!1,I,x,i,r,a,{},g&&!u?y:null,u&&!!g,_,f,u):null;let P=!1,R=!1,O=!0;if(C&&!S.occluded){const t=.5*d*A+p,i=new v(-100,-100),r=new v(this.screenRightBoundary,this.screenBottomBoundary),n=new jT,{first:o,last:s}=C,a=o.path.length;let u=[];for(let t=a-1;t>=1;t--)u.push(o.path[t]);for(let t=1;t<s.path.length;t++)u.push(s.path[t]);const f=2.5*t;l&&(u=u.map(([t,e,i],r)=>(y&&!E&&(i=y(r<a-1?o.tilePath[a-1-r]:s.tilePath[r-a+2])[2]),px(t,e,i,l))),u.some(t=>t[3]<=0)&&(u=[]));let g=[];if(u.length>0){let t=1/0,e=-1/0,n=1/0,o=-1/0;for(const i of u)t=Math.min(t,i[0]),n=Math.min(n,i[1]),e=Math.max(e,i[0]),o=Math.max(o,i[1]);e>=i.x&&t<=r.x&&o>=i.y&&n<=r.y&&(g=[u.map(t=>new v(t[0],t[1]))],(t<i.x||e>r.x||n<i.y||o>r.y)&&(g=l_(g,i.x,i.y,r.x,r.y)))}for(const i of g){n.reset(i,.25*t);let r=0;r=n.length<=.5*t?1:Math.ceil(n.paddedLength/f)+1;for(let i=0;i<r;i++){const o=i/Math.max(r-1,1),s=n.lerp(o),a=s.x+XT,l=s.y+XT;m.push(a,l,t,0);const u=a-t,d=l-t,p=a+t,f=l+t;if(O=O&&this.isOffscreen(u,d,p,f),R=R||this.isInsideGrid(u,d,p,f),!e&&this.grid.hitTestCircle(a,l,t,h)&&(P=!0,!c))return{circles:[],offscreen:!1,collisionDetected:P,occluded:!1}}}}return{circles:!c&&P||!R?[]:m,offscreen:O,collisionDetected:P,occluded:S.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const e=[];let i=1/0,r=1/0,n=-1/0,o=-1/0;for(const s of t){const t=new v(s.x+XT,s.y+XT);i=Math.min(i,t.x),r=Math.min(r,t.y),n=Math.max(n,t.x),o=Math.max(o,t.y),e.push(t)}const s=this.grid.query(i,r,n,o).concat(this.ignoredGrid.query(i,r,n,o)),a={},l={};for(const t of s){const i=t.key;void 0===a[i.bucketInstanceId]&&(a[i.bucketInstanceId]={}),a[i.bucketInstanceId][i.featureIndex]||Gp(e,[new v(t.x1,t.y1),new v(t.x2,t.y1),new v(t.x2,t.y2),new v(t.x1,t.y2)])&&(a[i.bucketInstanceId][i.featureIndex]=!0,void 0===l[i.bucketInstanceId]&&(l[i.bucketInstanceId]=[]),l[i.bucketInstanceId].push(i.featureIndex))}return l}insertCollisionBox(t,e,i,r,n){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:r,collisionGroupID:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,e,i,r,n){const o=e?this.ignoredGrid:this.grid,s={bucketInstanceId:i,featureIndex:r,collisionGroupID:n};for(let e=0;e<t.length;e+=4)o.insertCircle(s,t[e],t[e+1],t[e+2])}projectAndGetPerspectiveRatio(t,e,i,r,n,o,s){const a=[e,i,r,1];let l=!1;r||this.transform.pitch>0?(Xh.transformMat4(a,a,t),this.fogState&&n&&"globe"!==s.name&&(l=function(t,e,i,r,n,o){const s=o.calculateFogTileMatrix(n),a=[e,i,r];return nd.transformMat4(a,a,s),gw(t,nd.length(a),o.pitch,o._fov)}(this.fogState,e,i,r,n.toUnwrapped(),this.transform)>.9)):Ex(a,a,t);const c=a[3];return{point:new v((a[0]/c+1)/2*this.transform.width+XT,(-a[1]/c+1)/2*this.transform.height+XT),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(s)/c*.5,1.5),signedDistanceFromCamera:c,occluded:o&&a[2]>c||l}}isOffscreen(t,e,i,r){return i<XT||t>=this.screenRightBoundary||r<XT||e>this.screenBottomBoundary}isInsideGrid(t,e,i,r){return i>=0&&t<this.gridRightBoundary&&r>=0&&e<this.gridBottomBoundary}getViewportMatrix(){const t=Jh.identity([]);return Jh.translate(t,t,[-100,-100,0]),t}}function qT(t,e,i){const r=e.createTileMatrix(t,t.worldSize,i.toUnwrapped());return Jh.multiply(new Float32Array(16),t.projMatrix,r)}function WT(t,e,i){if(e.projection.name===i.projection.name)return t.projMatrix;const r=i.clone();return r.setProjection(e.projection),qT(r,e.getProjection(),t)}function $T(t,e,i){return e.name===i.projection.name?t.projMatrix:qT(i,e,t)}class YT{constructor(t,e,i,r){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):r&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class ZT{constructor(t,e,i,r,n,o=!1){this.text=new YT(t?t.text:null,e,i,n),this.icon=new YT(t?t.icon:null,e,r,n),this.clipped=o}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class KT{constructor(t,e,i,r=!1){this.text=t,this.icon=e,this.skipFade=i,this.clipped=r}}class JT{constructor(){this.invProjMatrix=Jh.create(),this.viewportMatrix=Jh.create(),this.circles=[]}}class QT{constructor(t,e,i,r,n){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=i,this.bucketIndex=r,this.tileID=n}}class tE{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:t=>t.collisionGroupID===e}}return this.collisionGroups[t]}}function eE(t,e,i,r,n){const{horizontalAlign:o,verticalAlign:s}=Kg(t),a=-(o-.5)*e,l=-(s-.5)*i,c=M_(t,r);return new v(a+c[0]*n,l+c[1]*n)}function iE(t,e,i,r,n){const o=new v(t,e);return i&&o._rotate(r?n:-n),o}class rE{constructor(t,e,i,r,n,o){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new HT(this.transform,n),this.buildingIndex=o,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new tE(i),this.collisionCircleArrays={},this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,e,i,r){const n=i.getBucket(e),o=i.latestFeatureIndex;if(!n||!o||e.fqid!==n.layerIds[0])return;const s=n.layers[0].layout,a=i.collisionBoxArray,l=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),c=i.tileSize/ur,u=i.tileID.toUnwrapped();this.transform.setProjection(n.projection);const h=(d=i.tileID,p=n.getProjection(),f=this.transform,p.name===this.projection?f.calculateProjMatrix(d.toUnwrapped()):qT(f,p,d));var d,p,f;const m="map"===s.get("text-pitch-alignment"),g="map"===s.get("text-rotation-alignment");e.compileFilter();const _=e.dynamicFilter(),y=e.dynamicFilterNeedsFeature(),v=this.transform.calculatePixelsToTileUnitsMatrix(i),x=hx(h,i.tileID.canonical,m,g,this.transform,n.getProjection(),v);let b=null;if(m){const t=dx(h,i.tileID.canonical,m,g,this.transform,n.getProjection(),v);b=Jh.multiply([],this.transform.labelPlaneMatrix,t)}let w=null;_&&i.latestFeatureIndex&&(w={unwrappedTileID:u,dynamicFilter:_,dynamicFilterNeedsFeature:y,featureIndex:i.latestFeatureIndex}),this.retainedQueryData[n.bucketInstanceId]=new QT(n.bucketInstanceId,o,n.sourceLayerIndex,n.index,i.tileID);const T={bucket:n,layout:s,posMatrix:h,textLabelPlaneMatrix:x,labelToScreenMatrix:b,clippingData:w,scale:l,textPixelRatio:c,holdingForFade:i.holdingForFade(),collisionBoxArray:a,partiallyEvaluatedTextSize:Og(n.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:Og(n.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(n.sourceID)};if(r)for(const e of n.sortKeyRanges){const{sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n}=e;t.push({sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n,parameters:T})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:n.symbolInstances.length,parameters:T})}attemptAnchorPlacement(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,_){const{textOffset0:y,textOffset1:v,crossTileID:x}=h,b=[y,v],w=eE(t,i,r,b,n),T=this.collisionIndex.placeCollisionBox(p,n,e,iE(w.x,w.y,o,s,this.transform.angle),u,a,l,c.predicate);if(m){const t=p.getSymbolInstanceIconSize(_,this.transform.zoom,h.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(p,t,m,iE(w.x,w.y,o,s,this.transform.angle),u,a,l,c.predicate).box.length)return}if(T.box.length>0){let e;return this.prevPlacement&&this.prevPlacement.variableOffsets[x]&&this.prevPlacement.placements[x]&&this.prevPlacement.placements[x].text&&(e=this.prevPlacement.variableOffsets[x].anchor),this.variableOffsets[x]={textOffset:b,width:i,height:r,anchor:t,textScale:n,prevAnchor:e},this.markUsedJustification(p,t,h,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,h),this.placedOrientations[x]=f),{shift:w,placedGlyphBoxes:T}}}placeLayerBucketPart(t,e,i,r){const{bucket:n,layout:o,posMatrix:s,textLabelPlaneMatrix:a,labelToScreenMatrix:l,clippingData:c,textPixelRatio:u,holdingForFade:h,collisionBoxArray:d,partiallyEvaluatedTextSize:p,partiallyEvaluatedIconSize:f,collisionGroup:m}=t.parameters,g=o.get("text-optional"),_=o.get("icon-optional"),y=o.get("text-allow-overlap"),x=o.get("icon-allow-overlap"),b="map"===o.get("text-rotation-alignment"),w="map"===o.get("text-pitch-alignment"),T="viewport-y"===o.get("symbol-z-order"),E=o.get("symbol-z-elevate");this.transform.setProjection(n.projection);let S=y&&(x||!n.hasIconData()||_),A=x&&(y||!n.hasTextData()||g);!n.collisionArrays&&d&&n.deserializeCollisionBoxes(d),i&&r&&n.updateCollisionDebugBuffers(this.transform.zoom,d);const M=(t,r,d)=>{const{crossTileID:T,numVerticalGlyphVertices:E}=t;if(c){const i={zoom:this.transform.zoom,pitch:this.transform.pitch};let r=null;if(c.dynamicFilterNeedsFeature){const e=this.retainedQueryData[n.bucketInstanceId];r=c.featureIndex.loadFeature({featureIndex:t.featureIndex,bucketIndex:e.bucketIndex,sourceLayerIndex:e.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,c.dynamicFilter)(i,r,this.retainedQueryData[n.bucketInstanceId].tileID.canonical,new v(t.tileAnchorX,t.tileAnchorY),this.transform.calculateDistanceTileData(c.unwrappedTileID)))return this.placements[T]=new KT(!1,!1,!1,!0),void e.add(T)}if(e.has(T))return;if(h)return void(this.placements[T]=new KT(!1,!1,!1));let M=!1,I=!1,C=!0,P=!1,R=!1,O=null,D={box:null,offscreen:null,occluded:null},L={box:null,offscreen:null,occluded:null},k=null,B=null,F=null,z=0,N=0,U=0;d.textFeatureIndex?z=d.textFeatureIndex:t.useRuntimeCollisionCircles&&(z=t.featureIndex),d.verticalTextFeatureIndex&&(N=d.verticalTextFeatureIndex);const G=e=>{e.tileID=this.retainedQueryData[n.bucketInstanceId].tileID;const i=this.transform.elevation;e.elevation=t.zOffset+(i?i.getAtTileOffset(e.tileID,e.tileAnchorX,e.tileAnchorY):0)},j=d.textBox;if(j){G(j);const e=e=>{let i=Gg.horizontal;if(n.allowVerticalPlacement&&!e&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[T];e&&(this.placedOrientations[T]=e,i=e,this.markUsedOrientation(n,i,t))}return i},i=(t,e)=>{if(n.allowVerticalPlacement&&E>0&&d.verticalTextBox){for(const i of n.writingModes)if(i===Gg.vertical?(D=e(),L=D):D=t(),D&&D.box&&D.box.length)break}else D=t()};if(o.get("text-variable-anchor")){let a=o.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[T]){const t=this.prevPlacement.variableOffsets[T];a.indexOf(t.anchor)>0&&(a=a.filter(e=>e!==t.anchor),a.unshift(t.anchor))}const l=(e,i,o)=>{const l=n.getSymbolInstanceTextSize(p,t,this.transform.zoom,r),c=(e.x2-e.x1)*l+2*e.padding,h=(e.y2-e.y1)*l+2*e.padding,d=t.hasIconTextFit&&!x?i:null;d&&G(d);let g={box:[],offscreen:!1,occluded:!1};const _=y?2*a.length:a.length;for(let i=0;i<_;++i){const _=this.attemptAnchorPlacement(a[i%a.length],e,c,h,l,b,w,u,s,m,i>=a.length,t,r,n,o,d,p,f);if(_&&(g=_.placedGlyphBoxes,g&&g.box&&g.box.length)){M=!0,O=_.shift;break}}return g};i(()=>l(j,d.iconBox,Gg.horizontal),()=>{const t=d.verticalTextBox;return t&&G(t),n.allowVerticalPlacement&&!(D&&D.box&&D.box.length)&&E>0&&t?l(t,d.verticalIconBox,Gg.vertical):{box:null,offscreen:null,occluded:null}}),D&&(M=D.box,C=D.offscreen,P=D.occluded);const c=e(!(!D||!D.box));if(!M&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[T];e&&(this.variableOffsets[T]=e,this.markUsedJustification(n,e.anchor,t,c))}}else{const o=(e,i)=>{const o=n.getSymbolInstanceTextSize(p,t,this.transform.zoom,r),a=this.collisionIndex.placeCollisionBox(n,o,e,new v(0,0),y,u,s,m.predicate);return a&&a.box&&a.box.length&&(this.markUsedOrientation(n,i,t),this.placedOrientations[T]=i),a};i(()=>o(j,Gg.horizontal),()=>{const t=d.verticalTextBox;return n.allowVerticalPlacement&&E>0&&t?(G(t),o(t,Gg.vertical)):{box:null,offscreen:null,occluded:null}}),e(!!(D&&D.box&&D.box.length))}}if(k=D,M=k&&k.box&&k.box.length>0,C=k&&k.offscreen,P=k&&k.occluded,t.useRuntimeCollisionCircles){const e=n.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex),r=Rg(n.textSizeData,p,e),c=o.get("text-padding");B=this.collisionIndex.placeCollisionCircles(n,y,e,n.lineVertexArray,n.glyphOffsetArray,r,s,a,l,i,w,m.predicate,t.collisionCircleDiameter*r/24,c,this.retainedQueryData[n.bucketInstanceId].tileID),M=y||B.circles.length>0&&!B.collisionDetected,C=C&&B.offscreen,P=B.occluded}if(d.iconFeatureIndex&&(U=d.iconFeatureIndex),d.iconBox){const e=e=>{G(e);const i=t.hasIconTextFit&&O?iE(O.x,O.y,b,w,this.transform.angle):new v(0,0),r=n.getSymbolInstanceIconSize(f,this.transform.zoom,t.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(n,r,e,i,x,u,s,m.predicate)};L&&L.box&&L.box.length&&d.verticalIconBox?(F=e(d.verticalIconBox),I=F.box.length>0):(F=e(d.iconBox),I=F.box.length>0),C=C&&F.offscreen,R=F.occluded}const V=g||0===t.numHorizontalGlyphVertices&&0===E,X=_||0===t.numIconVertices;if(V||X?X?V||(I=I&&M):M=I&&M:I=M=I&&M,M&&k&&k.box&&this.collisionIndex.insertCollisionBox(k.box,o.get("text-ignore-placement"),n.bucketInstanceId,L&&L.box&&N?N:z,m.ID),I&&F&&this.collisionIndex.insertCollisionBox(F.box,o.get("icon-ignore-placement"),n.bucketInstanceId,U,m.ID),B&&(M&&this.collisionIndex.insertCollisionCircles(B.circles,o.get("text-ignore-placement"),n.bucketInstanceId,z,m.ID),i)){const t=n.bucketInstanceId;let e=this.collisionCircleArrays[t];void 0===e&&(e=this.collisionCircleArrays[t]=new JT);for(let t=0;t<B.circles.length;t+=4)e.circles.push(B.circles[t+0]),e.circles.push(B.circles[t+1]),e.circles.push(B.circles[t+2]),e.circles.push(B.collisionDetected?1:0)}const H="globe"!==n.projection.name;S=S&&(H||!P),A=A&&(H||!R),this.placements[T]=new KT(M||S,I||A,C||n.justReloaded),e.add(T)};if(E&&this.buildingIndex&&(this.buildingIndex.updateZOffset(n,this.retainedQueryData[n.bucketInstanceId].tileID),n.updateZOffset()),T){const t=n.getSortedSymbolIndexes(this.transform.angle);for(let e=t.length-1;e>=0;--e){const i=t[e];M(n.symbolInstances.get(i),i,n.collisionArrays[i])}n.hasAnyZOffset&&Y(n.layerIds[0]+" layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y")}else if(n.hasAnyZOffset){const t=n.getSortedIndexesByZOffset();for(let e=0;e<t.length;++e){const i=t[e];M(n.symbolInstances.get(i),i,n.collisionArrays[i])}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)M(n.symbolInstances.get(e),e,n.collisionArrays[e]);if(i&&n.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[n.bucketInstanceId];Jh.invert(t.invProjMatrix,s),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}n.justReloaded=!1}markUsedJustification(t,e,i,r){const{leftJustifiedTextSymbolIndex:n,centerJustifiedTextSymbolIndex:o,rightJustifiedTextSymbolIndex:s,verticalPlacedTextSymbolIndex:a,crossTileID:l}=i,c=C_(e),u=r===Gg.vertical?a:"left"===c?n:"center"===c?o:"right"===c?s:-1;n>=0&&(t.text.placedSymbolArray.get(n).crossTileID=u>=0&&n!==u?0:l),o>=0&&(t.text.placedSymbolArray.get(o).crossTileID=u>=0&&o!==u?0:l),s>=0&&(t.text.placedSymbolArray.get(s).crossTileID=u>=0&&s!==u?0:l),a>=0&&(t.text.placedSymbolArray.get(a).crossTileID=u>=0&&a!==u?0:l)}markUsedOrientation(t,e,i){const r=e===Gg.horizontal||e===Gg.horizontalOnly?e:0,n=e===Gg.vertical?e:0,{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:l}=i,c=t.text.placedSymbolArray;o>=0&&(c.get(o).placedOrientation=r),s>=0&&(c.get(s).placedOrientation=r),a>=0&&(c.get(a).placedOrientation=r),l>=0&&(c.get(l).placedOrientation=n)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const e=this.prevPlacement;let i=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;const r=e?e.symbolFadeChange(t):1,n=e?e.opacities:{},o=e?e.variableOffsets:{},s=e?e.placedOrientations:{};for(const t in this.placements){const e=this.placements[t],o=n[t];o?(this.opacities[t]=new ZT(o,r,e.text,e.icon,null,e.clipped),i=i||e.text!==o.text.placed||e.icon!==o.icon.placed):(this.opacities[t]=new ZT(null,r,e.text,e.icon,e.skipFade,e.clipped),i=i||e.text||e.icon)}for(const t in n){const e=n[t];if(!this.opacities[t]){const n=new ZT(e,r,!1,!1);n.isHidden()||(this.opacities[t]=n,i=i||e.text.placed||e.icon.placed)}}for(const t in o)this.variableOffsets[t]||!this.opacities[t]||this.opacities[t].isHidden()||(this.variableOffsets[t]=o[t]);for(const t in s)this.placedOrientations[t]||!this.opacities[t]||this.opacities[t].isHidden()||(this.placedOrientations[t]=s[t]);i?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)}updateLayerOpacities(t,e){const i=new Set;for(const r of e){const e=r.getBucket(t);e&&r.latestFeatureIndex&&t.fqid===e.layerIds[0]&&(this.updateBucketOpacities(e,i,r.collisionBoxArray),e.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(e,r.tileID),e.updateZOffset()))}}updateBucketOpacities(t,e,i){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const r=t.layers[0].layout,n=!!t.layers[0].dynamicFilter(),o=new ZT(null,0,!1,!1,!0),s=r.get("text-allow-overlap"),a=r.get("icon-allow-overlap"),l=r.get("text-variable-anchor"),c="map"===r.get("text-rotation-alignment"),u="map"===r.get("text-pitch-alignment"),h=new ZT(null,0,s&&(a||!t.hasIconData()||r.get("icon-optional")),a&&(s||!t.hasTextData()||r.get("text-optional")),!0);!t.collisionArrays&&i&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(i);const d=(t,e,i)=>{for(let r=0;r<e/4;r++)t.opacityVertexArray.emplaceBack(i)};let p=0;for(let i=0;i<t.symbolInstances.length;i++){const r=t.symbolInstances.get(i),{numHorizontalGlyphVertices:s,numVerticalGlyphVertices:a,crossTileID:f,numIconVertices:m}=r,g=e.has(f);let _=this.opacities[f];g?_=o:_||(_=h,this.opacities[f]=_),e.add(f);const y=s>0||a>0,x=m>0,b=this.placedOrientations[f],w=b===Gg.vertical,T=b===Gg.horizontal||b===Gg.horizontalOnly;if(!y&&!x||_.isHidden()||p++,y){const e=dE(_.text);d(t.text,s,w?pE:e),d(t.text,a,T?pE:e);const i=_.text.isHidden(),{leftJustifiedTextSymbolIndex:n,centerJustifiedTextSymbolIndex:o,rightJustifiedTextSymbolIndex:l,verticalPlacedTextSymbolIndex:c}=r,u=t.text.placedSymbolArray,h=i||w?1:0;n>=0&&(u.get(n).hidden=h),o>=0&&(u.get(o).hidden=h),l>=0&&(u.get(l).hidden=h),c>=0&&(u.get(c).hidden=i||T?1:0);const p=this.variableOffsets[f];p&&this.markUsedJustification(t,p.anchor,r,b);const m=this.placedOrientations[f];m&&(this.markUsedJustification(t,"left",r,m),this.markUsedOrientation(t,m,r))}if(x){const e=dE(_.icon),{placedIconSymbolIndex:i,verticalPlacedIconSymbolIndex:n}=r,o=t.icon.placedSymbolArray,s=_.icon.isHidden()?1:0;i>=0&&(d(t.icon,m,w?pE:e),o.get(i).hidden=s),n>=0&&(d(t.icon,r.numVerticalIconVertices,T?pE:e),o.get(n).hidden=s)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const e=t.collisionArrays[i];if(e){let i=new v(0,0),o=!0;if(e.textBox||e.verticalTextBox){if(l){const t=this.variableOffsets[f];t?(i=eE(t.anchor,t.width,t.height,t.textOffset,t.textScale),c&&i._rotate(u?this.transform.angle:-this.transform.angle)):o=!1}n&&(o=!_.clipped),e.textBox&&nE(t.textCollisionBox.collisionVertexArray,_.text.placed,!o||w,i.x,i.y),e.verticalTextBox&&nE(t.textCollisionBox.collisionVertexArray,_.text.placed,!o||T,i.x,i.y)}const s=o&&Boolean(!T&&e.verticalIconBox);e.iconBox&&nE(t.iconCollisionBox.collisionVertexArray,_.icon.placed,s,r.hasIconTextFit?i.x:0,r.hasIconTextFit?i.y:0),e.verticalIconBox&&nE(t.iconCollisionBox.collisionVertexArray,_.icon.placed,!s,r.hasIconTextFit?i.x:0,r.hasIconTextFit?i.y:0)}}}if(t.fullyClipped=0===p,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=e.invProjMatrix,t.placementViewportMatrix=e.viewportMatrix,t.collisionCircleArray=e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,e){const i=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*i>t}setStale(){this.stale=!0}}function nE(t,e,i,r,n){t.emplaceBack(e?1:0,i?1:0,r||0,n||0),t.emplaceBack(e?1:0,i?1:0,r||0,n||0),t.emplaceBack(e?1:0,i?1:0,r||0,n||0),t.emplaceBack(e?1:0,i?1:0,r||0,n||0)}const oE=Math.pow(2,25),sE=Math.pow(2,24),aE=Math.pow(2,17),lE=Math.pow(2,16),cE=Math.pow(2,9),uE=Math.pow(2,8),hE=Math.pow(2,1);function dE(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;const e=t.placed?1:0,i=Math.floor(127*t.opacity);return i*oE+e*sE+i*aE+e*lE+i*cE+e*uE+i*hE+e}const pE=0;class fE{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,e,i,r,n){const o=this._bucketParts;for(;this._currentTileIndex<t.length;)if(e.getBucketParts(o,r,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,n())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort((t,e)=>t.sortKey-e.sortKey));this._currentPartIndex<o.length;){const t=o[this._currentPartIndex];if(e.placeLayerBucketPart(t,this._seenCrossTileIDs,i,0===t.symbolInstanceStart),this._currentPartIndex++,n())return!0}return!1}}class mE{constructor(t,e,i,r,n,o,s,a,l){this.placement=new rE(t,n,o,s,a,l),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=r,this._done=!1}isDone(){return this._done}continuePlacement(t,e,i,r){const n=pe.now(),o=()=>{const t=pe.now()-n;return!this._forceFullPlacement&&t>2};for(;this._currentPlacementIndex>=0;){const n=e[t[this._currentPlacementIndex]],s=this.placement.collisionIndex.transform.zoom;if("symbol"===n.type&&(!n.minzoom||n.minzoom<=s)&&(!n.maxzoom||n.maxzoom>s)){const t=n,e=t.layout.get("symbol-z-elevate"),s=this._inProgressLayer=this._inProgressLayer||new fE(t),a=tl(n.source,n.scope);if(s.continuePlacement(e?r[a]:i[a],this.placement,this._showCollisionBoxes,n,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const gE=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class _E{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[e,i]=new Uint8Array(t,0,2);if(219!==e)throw new Error("Data does not appear to be in a KDBush format.");const r=i>>4;if(1!==r)throw new Error(`Got v${r} data when expected v1.`);const n=gE[15&i];if(!n)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(t,2,1),[s]=new Uint32Array(t,4,1);return new _E(s,o,n,t)}constructor(t,e=64,i=Float64Array,r){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535),this.ArrayType=i,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const n=gE.indexOf(this.ArrayType),o=2*t*this.ArrayType.BYTES_PER_ELEMENT,s=t*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-s%8)%8;if(n<0)throw new Error(`Unexpected typed array class: ${i}.`);r&&r instanceof ArrayBuffer?(this.data=r,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+s+a,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+o+s+a),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+s+a,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+n]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=t)}add(t,e){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=t,this.coords[this._pos++]=e,i}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return function t(e,i,r,n,o,s){if(o-n<=r)return;const a=n+o>>1;(function t(e,i,r,n,o,s){for(;o>n;){if(o-n>600){const a=o-n+1,l=r-n+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);t(e,i,r,Math.max(n,Math.floor(r-l*u/a+h)),Math.min(o,Math.floor(r+(a-l)*u/a+h)),s)}const a=i[2*r+s];let l=n,c=o;for(yE(e,i,n,r),i[2*o+s]>a&&yE(e,i,n,o);l<c;){for(yE(e,i,l,c),l++,c--;i[2*l+s]<a;)l++;for(;i[2*c+s]>a;)c--}i[2*n+s]===a?yE(e,i,n,c):(c++,yE(e,i,c,o)),c<=r&&(n=c+1),r<=c&&(o=c-1)}})(e,i,a,n,o,s),t(e,i,r,n,a-1,1-s),t(e,i,r,a+1,o,1-s)}(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,e,i,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:o,nodeSize:s}=this,a=[0,n.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=s){for(let s=h;s<=u;s++){const a=o[2*s],c=o[2*s+1];a>=t&&a<=i&&c>=e&&c<=r&&l.push(n[s])}continue}const d=h+u>>1,p=o[2*d],f=o[2*d+1];p>=t&&p<=i&&f>=e&&f<=r&&l.push(n[d]),(0===c?t<=p:e<=f)&&(a.push(h),a.push(d-1),a.push(1-c)),(0===c?i>=p:r>=f)&&(a.push(d+1),a.push(u),a.push(1-c))}return l}within(t,e,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:n,nodeSize:o}=this,s=[0,r.length-1,0],a=[],l=i*i;for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=o){for(let i=h;i<=u;i++)xE(n[2*i],n[2*i+1],t,e)<=l&&a.push(r[i]);continue}const d=h+u>>1,p=n[2*d],f=n[2*d+1];xE(p,f,t,e)<=l&&a.push(r[d]),(0===c?t-i<=p:e-i<=f)&&(s.push(h),s.push(d-1),s.push(1-c)),(0===c?t+i>=p:e+i>=f)&&(s.push(d+1),s.push(u),s.push(1-c))}return a}}function yE(t,e,i,r){vE(t,i,r),vE(e,2*i,2*r),vE(e,2*i+1,2*r+1)}function vE(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}function xE(t,e,i,r){const n=t-i,o=e-r;return n*n+o*o}const bE=.03125;class wE{constructor(t,e,i){this.tileID=t,this.bucketInstanceId=i,this.index=new _E(e.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const r=t.canonical.x*ur,n=t.canonical.y*ur;for(let t=0;t<e.length;t++){const{key:i,crossTileID:o,tileAnchorX:s,tileAnchorY:a}=e.get(t),l=Math.floor((r+s)*bE),c=Math.floor((n+a)*bE);this.index.add(l,c),this.keys.push(i),this.crossTileIDs.push(o)}this.index.finish()}findMatches(t,e,i){const r=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z),n=bE/Math.pow(2,e.canonical.z-this.tileID.canonical.z),o=e.canonical.x*ur,s=e.canonical.y*ur;for(let e=0;e<t.length;e++){const a=t.get(e);if(a.crossTileID)continue;const{key:l,tileAnchorX:c,tileAnchorY:u}=a,h=Math.floor((o+c)*n),d=Math.floor((s+u)*n),p=this.index.range(h-r,d-r,h+r,d+r);for(const t of p){const e=this.crossTileIDs[t];if(this.keys[t]===l&&!i.has(e)){i.add(e),a.crossTileID=e;break}}}}}class TE{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class EE{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const e=Math.round((t-this.lng)/360);if(0!==e)for(const t in this.indexes){const i=this.indexes[t],r={};for(const t in i){const n=i[t];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+e),r[n.tileID.key]=n}this.indexes[t]=r}this.lng=t}addBucket(t,e,i){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let t=0;t<e.symbolInstances.length;t++)e.symbolInstances.get(t).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const r=this.usedCrossTileIDs[t.overscaledZ];for(const i in this.indexes){const n=this.indexes[i];if(Number(i)>t.overscaledZ)for(const i in n){const o=n[i];o.tileID.isChildOf(t)&&o.findMatches(e.symbolInstances,t,r)}else{const o=n[t.scaledTo(Number(i)).key];o&&o.findMatches(e.symbolInstances,t,r)}}for(let t=0;t<e.symbolInstances.length;t++){const n=e.symbolInstances.get(t);n.crossTileID||(n.crossTileID=i.generate(),r.add(n.crossTileID))}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new wE(t,e.symbolInstances,e.bucketInstanceId),!0}removeBucketCrossTileIDs(t,e){for(const i of e.crossTileIDs)this.usedCrossTileIDs[t].delete(i)}removeStaleBuckets(t){let e=!1;for(const i in this.indexes){const r=this.indexes[i];for(const n in r)t[r[n].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,r[n]),delete r[n],e=!0)}return e}}class SE{constructor(){this.layerIndexes={},this.crossTileIDs=new TE,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,e,i,r){let n=this.layerIndexes[t.fqid];void 0===n&&(n=this.layerIndexes[t.fqid]=new EE);let o=!1;const s={};"globe"!==r.name&&n.handleWrapJump(i);for(const i of e){const e=i.getBucket(t);e&&t.fqid===e.layerIds[0]&&(e.bucketInstanceId||(e.bucketInstanceId=++this.maxBucketInstanceId),n.addBucket(i.tileID,e,this.crossTileIDs)&&(o=!0),s[e.bucketInstanceId]=!0)}return n.removeStaleBuckets(s)&&(o=!0),o}pruneUnusedLayers(t){const e={};t.forEach(t=>{e[t]=!0});for(const t in this.layerIndexes)e[t]||delete this.layerIndexes[t]}}var AE="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w-0.0001;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",ME="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",IE="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",CE="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",PE="highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",RE="#ifdef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);vec4 _raTexLinearCoord(vec2 texCoord,vec2 texResolution,out vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return (texCoord.xxyy+vec2(1.5,0.5).xyxy)/texResolution.xxyy;}vec2 _raTexLinearMix(vec2 fxy,vec4 colorMix,float colorOffset,vec4 t00,vec4 t10,vec4 t01,vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image0,c.yz),texture(u_image0,c.xz),texture(u_image0,c.yw),texture(u_image0,c.xw)\n);}vec2 raTexture2D_image1_linear(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image1,c.yz),texture(u_image1,c.xz),texture(u_image1,c.yw),texture(u_image1,c.xw)\n);}vec2 raTexture2D_image0_nearest(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec4 t=texture(u_image0,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec4 t=texture(u_image1,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",OE="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",DE="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef NATIVE\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const LE=[];UE(AE,LE);const kE={"_prelude_fog.vertex.glsl":CE,"_prelude_terrain.vertex.glsl":IE,"_prelude_shadow.vertex.glsl":OE,"_prelude_fog.fragment.glsl":PE,"_prelude_shadow.fragment.glsl":DE,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":RE},BE={};GE("",IE),GE(PE,CE),GE(DE,OE),GE(RE,"");const FE=GE("\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif","\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}"),zE=AE;var NE={background:GE('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:GE('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:GE('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:GE("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:GE('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:GE("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:GE("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:GE("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:GE("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:GE('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:GE('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:GE('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in vec2 v_pos;in vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;out vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:GE('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:GE('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nuniform float u_emissive_strength;in float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef RENDER_CUTOFF\ncolor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\n#ifdef RENDER_CUTOFF\ninvariant gl_Position;\n#endif\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),fillExtrusionDepth:GE("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:GE('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nout vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:GE('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:GE("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;HANDLE_WIREFRAME_DEBUG;\n#endif\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;\n#ifdef FORCE_ABS_FL_GROUND_RADIUS\nfl_ground_radius=abs(flood_light_ground_radius);\n#endif\nfloat flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:GE("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:GE('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:GE('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    \nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:GE('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:GE('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform vec4 u_tl_br;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#elif defined(PROJECTION_GLOBE_VIEW)\nin vec2 a_pos;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;void main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec2 globe_tl=vec2(u_tl_br.x,u_tl_br.y);vec2 globe_br=vec2(u_tl_br.z,u_tl_br.w);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=1.0-((mercatorY-globe_br.y)/(globe_tl.y-globe_br.y));float mercatorX=mercatorXfromLng(latLng[1]);float uvX=(mercatorX-globe_br.x)/(globe_tl.x-globe_br.x);vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);uv=vec2(uvX,uvY);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\nuv=a_texture_pos/8192.0;\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),symbolIcon:GE('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nin float v_fade_opacity;in vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nuniform mediump float u_icon_saturation;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;\n#else\nout_color=texture(u_texture,v_tex_a)*alpha;\n#endif\n#ifdef SATURATION\nvec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;}'),symbolSDF:GE('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:GE('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:GE('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}'),terrainDepth:GE("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:GE('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',ME),skyboxGradient:GE('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',ME),skyboxCapture:GE("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:GE('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:GE('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\nglFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:GE('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\ntexColor.rgb=sRGBToLinear(texColor.rgb);if(u_baseTextureIsAlpha) {if (texColor.w < 0.5) {discard;}albedo*=mix(vec4(texColor.rgb,texColor.a),vec4(texColor.a),float(u_baseTextureIsAlpha));} else {albedo*=texColor;}\n#endif\nreturn vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 diffuse=getDiffuseShadedColor(getBaseColor().rgb,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(diffuse,1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nao=(texture(u_occlusionTexture,uv_2f).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=local_pos;\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:GE("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:GE("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}")};function UE(t,e){const i=t.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let t of i)if(t=t.trim(),"#"===t[0]&&t.includes("if")&&!t.includes("endif")){t=t.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const i=t.split(" ");for(const t of i)e.includes(t)||e.push(t)}}function GE(t,e){const i=/#include\s+"([^"]+)"/g,r=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let n=e.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);n&&(n=n.map(t=>{const e=t.split(" ");return e[e.length-1]}),n=[...new Set(n)]);const o={},s=[],a=[];t=t.replace(i,(t,e)=>(a.push(e),"")),e=e.replace(i,(t,e)=>(s.push(e),""));let l=[...LE];UE(t,l),UE(e,l);for(const t of[...s,...a])kE[t]||console.error("Undefined include: "+t),BE[t]||(BE[t]=[],UE(kE[t],BE[t])),l=[...l,...BE[t]];return{fragmentSource:t=t.replace(r,(t,e,i,r,n)=>(o[n]=!0,"define"===e?`\n#ifndef HAS_UNIFORM_u_${n}\nin ${i} ${r} ${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"initialize"===e?`\n#ifdef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:"define-attribute"===e?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    in ${i} ${r} ${n};\n#endif\n`:"initialize-attribute"===e?"":void 0)),vertexSource:e=e.replace(r,(t,e,i,r,n)=>{const s="float"===r?"vec2":r,a=n.match(/color/)?"color":s;return"define-attribute-vertex-shader-only"===e?`\n#ifdef HAS_ATTRIBUTE_a_${n}\nin ${i} ${r} a_${n};\n#endif\n`:o[n]?"define"===e?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nin ${i} ${s} a_${n};\nout ${i} ${r} ${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"initialize"===e?"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = a_${n};\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = unpack_mix_${a}(a_${n}, u_${n}_t);\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:"define-attribute"===e?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    in ${i} ${r} a_${n};\n    out ${i} ${r} ${n};\n#endif\n`:"initialize-attribute"===e?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    ${n} = a_${n};\n#endif\n`:void 0:"define"===e?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nin ${i} ${s} a_${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"define-instanced"===e?"mat4"===a?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${n}0;\nin vec4 a_${n}1;\nin vec4 a_${n}2;\nin vec4 a_${n}3;\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${i} ${s} a_${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"initialize-attribute-custom"===e?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    ${i} ${r} ${n} = a_${n};\n#endif\n`:"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = a_${n};\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = unpack_mix_${a}(a_${n}, u_${n}_t);\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`}),staticAttributes:n,usedDefines:l,vertexIncludes:s,fragmentIncludes:a}}class jE{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,e,i,r,n,o,s,a){this.context=t;let l=this.boundPaintVertexBuffers.length!==r.length;for(let t=0;!l&&t<r.length;t++)this.boundPaintVertexBuffers[t]!==r[t]&&(l=!0);let c=this.boundDynamicVertexBuffers.length!==s.length;for(let t=0;!c&&t<s.length;t++)this.boundDynamicVertexBuffers[t]!==s[t]&&(c=!0);if(!this.vao||this.boundProgram!==e||this.boundLayoutVertexBuffer!==i||l||c||this.boundIndexBuffer!==n||this.boundVertexOffset!==o)this.freshBind(e,i,r,n,o,s,a);else{t.bindVertexArrayOES.set(this.vao);for(const i of s)i&&(i.bind(),a&&i.instanceCount&&i.setVertexAttribDivisor(t.gl,e,a));n&&n.dynamicDraw&&n.bind()}}freshBind(t,e,i,r,n,o,s){const a=t.numAttributes,l=this.context,c=l.gl;this.vao&&this.destroy(),this.vao=l.gl.createVertexArray(),l.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=r,this.boundVertexOffset=n,this.boundDynamicVertexBuffers=o,e.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,n);for(const e of i)e.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,n);for(const e of o)e&&(e.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,n),s&&e.instanceCount&&e.setVertexAttribDivisor(c,t,s));r&&r.bind(),l.currentNumAttributes=a}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function VE(t,e){const i=Math.pow(2,e.canonical.z),r=e.canonical.y;return[new Ip(0,r/i).toLngLat().lat,new Ip(0,(r+1)/i).toLngLat().lat]}function XE(t,e,i,r,n,o,s){const a=t.context,l=a.gl,c=i.hillshadeFBO;if(!c)return;t.prepareDrawTile();const u=t.isTileAffectedByFog(e),h=t.getOrCreateProgram("hillshade",{overrideFog:u});a.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,c.colorAttachment.get());const d=((t,e,i,r)=>{const n=i.paint.get("hillshade-shadow-color"),o=i.paint.get("hillshade-highlight-color"),s=i.paint.get("hillshade-accent-color"),a=i.paint.get("hillshade-emissive-strength");let l=T(i.paint.get("hillshade-illumination-direction"));if("viewport"===i.paint.get("hillshade-illumination-anchor"))l-=t.transform.angle;else if(t.style&&t.style.enable3dLights()&&t.style.directionalLight){const e=t.style.directionalLight.properties.get("direction");l=T(Q(e.x,e.y,e.z)[1])}const c=!t.options.moving;return{u_matrix:r||t.transform.calculateProjMatrix(e.tileID.toUnwrapped(),c),u_image:0,u_latrange:VE(0,e.tileID),u_light:[i.paint.get("hillshade-exaggeration"),l],u_shadow:n,u_highlight:o,u_emissive_strength:a,u_accent:s}})(t,i,r,t.terrain?e.projMatrix:null);t.uploadCommonUniforms(a,h,e.toUnwrapped());const{tileBoundsBuffer:p,tileBoundsIndexBuffer:f,tileBoundsSegments:m}=t.getTileBoundsBuffers(i);h.draw(t,l.TRIANGLES,n,o,s,Lv.disabled,d,r.id,p,f,m)}function HE(t,e,i){if(!e.needsDEMTextureUpload)return;const r=t.context,n=r.gl;r.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||t.getTileTexture(i.stride);const o=i.getPixels();e.demTexture?e.demTexture.update(o,{premultiply:!1}):e.demTexture=new Dy(r,o,n.R32F,{premultiply:!1}),e.needsDEMTextureUpload=!1}function qE(t,e,i){const r=t.context,n=r.gl;if(!e.dem)return;const o=e.dem;if(r.activeTexture.set(n.TEXTURE1),HE(t,e,o),!e.demTexture)return;e.demTexture.bind(n.NEAREST,n.CLAMP_TO_EDGE);const s=o.dim;r.activeTexture.set(n.TEXTURE0);let a=e.hillshadeFBO;if(!a){const t=new Dy(r,{width:s,height:s,data:null},n.RGBA);t.bind(n.LINEAR,n.CLAMP_TO_EDGE),a=e.hillshadeFBO=r.createFramebuffer(s,s,!0,"renderbuffer"),a.colorAttachment.set(t.texture)}r.bindFramebuffer.set(a.framebuffer),r.viewport.set([0,0,s,s]);const{tileBoundsBuffer:l,tileBoundsIndexBuffer:c,tileBoundsSegments:u}=t.getMercatorTileBoundsBuffers(),h=[];t.linearFloatFilteringSupported()&&h.push("TERRAIN_DEM_FLOAT_FORMAT"),t.getOrCreateProgram("hillshadePrepare",{defines:h}).draw(t,n.TRIANGLES,Rv.disabled,Ov.disabled,Dv.unblended,Lv.disabled,((t,e)=>{const i=e.stride,r=Jh.create();return Jh.ortho(r,0,ur,-ur,0,0,1),Jh.translate(r,r,[0,-ur,0]),{u_matrix:r,u_image:1,u_dimension:[i,i],u_zoom:t.overscaledZ}})(e.tileID,o),i.id,l,c,u),e.needsHillshadePrepare=!1}const WE=t=>({u_matrix:new bc(t),u_image0:new fc(t),u_skirt_height:new mc(t),u_ground_shadow_factor:new _c(t)}),$E=(t,e,i)=>({u_matrix:t,u_image0:0,u_skirt_height:e,u_ground_shadow_factor:i}),YE=(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f)=>({u_proj_matrix:Float32Array.from(t),u_globe_matrix:e,u_normalize_matrix:Float32Array.from(r),u_merc_matrix:i,u_zoom_transition:n,u_merc_center:o,u_image0:0,u_frustum_tl:s,u_frustum_tr:a,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:u,u_globe_radius:h,u_viewport:d,u_grid_matrix:f?Float32Array.from(f):new Float32Array(9),u_skirt_height:p}),ZE=(t,e)=>{if(e>0&&t.terrain&&Y("Cutoff is currently disabled on terrain"),e<=0||t.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,0]}};const i=t.transform,r=Math.max(Math.abs(i._zoom-(t.minCutoffZoom-1)),1),n=i.isLODDisabled(!1)?O(60,45,i.pitch):O(30,15,i.pitch),o=i._farZ-i._nearZ,s=e*i.height,a=((1-(l=n))*(.75*i.cameraToCenterDistance)+l*(i._farZ+s))*r;var l;return{shouldRenderCutoff:n<1,uniformValues:{u_cutoff_params:[i._nearZ,i._farZ,(a-i._nearZ)/o,(a-s-i._nearZ)/o]}}};function KE(t,e){return null!=t&&null!=e&&!(!t.hasData()||!e.hasData())&&null!=t.demTexture&&null!=e.demTexture&&t.tileID.key!==e.tileID.key}const JE=new class{constructor(){this.operations={}}newMorphing(t,e,i,r,n){if(t in this.operations){const e=this.operations[t];e.to.tileID.key!==i.tileID.key&&(e.queued=i)}else this.operations[t]={startTime:r,phase:0,duration:n,from:e,to:i,queued:null}}getMorphValuesForProxy(t){if(!(t in this.operations))return null;const e=this.operations[t];return{from:e.from,to:e.to,phase:e.phase}}update(t){for(const e in this.operations){const i=this.operations[e];for(i.phase=(t-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,t)){delete this.operations[e];break}}}_nextOp(t,e){return!!t.queued&&(t.from=t.to,t.to=t.queued,t.queued=null,t.phase=0,t.startTime=e,!0)}_validOp(t){return t.from.hasData()&&t.to.hasData()}},QE={0:null,1:"TERRAIN_VERTEX_MORPHING"};function tS(t,e,i){if(0===e)return 0;const r=e<1&&514===i?.25/e:1;return 6*Math.pow(1.5,22-t)*Math.max(e,1)*r}function eS(t,e){const i=1<<t.z;return!e&&(0===t.x||t.x===i-1)||0===t.y||t.y===i-1}const iS=t=>({u_matrix:t});function rS(t,e,i,r,n){if(n>0){const o=pe.now(),s=(o-t.timeAdded)/n,a=e?(o-e.timeAdded)/n:-1,l=i.getSource(),c=r.coveringZoomLevel({tileSize:l.tileSize,roundZoom:l.roundZoom}),u=!e||Math.abs(e.tileID.overscaledZ-c)>Math.abs(t.tileID.overscaledZ-c),h=u&&t.refreshedUponExpiration?1:R(u?s:1-a,0,1);return t.refreshedUponExpiration&&s>=1&&(t.refreshedUponExpiration=!1),e?{opacity:1,mix:1-h}:{opacity:h,mix:0}}return{opacity:1,mix:0}}class nS extends Bv{constructor(t){const e={type:"raster-dem",maxzoom:t.transform.maxZoom},i=new Sw(Ww(),null),r=ST("mock-dem",e,i,t.style);super("mock-dem",r,!1),r.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,e){t.state="loaded",e(null)}}class oS extends Bv{constructor(t){const e=ST("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new Sw(Ww(),null),t.style);super("proxy",e,!1),e.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,e,i){if(t.freezeTileCoverage)return;this.transform=t;const r=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((e,i)=>{if(e[i.key]="",!this._tiles[i.key]){const e=new jy(i,this._source.tileSize*i.overscaleFactor(),t.tileZoom);e.state="loaded",this._tiles[i.key]=e}return e},{});for(const t in this._tiles)t in r||(this.freeFBO(t),this._tiles[t].unloadVectorData(),delete this._tiles[t])}freeFBO(t){const e=this.proxyCachedFBO[t];if(void 0!==e){const i=Object.values(e);this.renderCachePool.push(...i),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class sS extends gd{constructor(t,e,i){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=e,this.projMatrix=i}}class aS extends class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const i=e.getSource().maxzoom,r=1<<i,n=Math.floor(t.x),o=Math.floor((t.x-n)*r),s=Math.floor(t.y*r),a=this.findDEMTileFor(new gd(i,n,i,o,s));return!(!a||!a.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const r=this._source();if(!r)return e;if(t.y<0||t.y>1)return e;const n=r.getSource().maxzoom,o=1<<n,s=Math.floor(t.x),a=t.x-s,l=new gd(n,s,n,Math.floor(a*o),Math.floor(t.y*o)),c=this.findDEMTileFor(l);if(!c||!c.dem)return e;const u=c.dem,h=1<<c.tileID.canonical.z,d=(a*h-c.tileID.canonical.x)*u.dim,p=(t.y*h-c.tileID.canonical.y)*u.dim,f=Math.floor(d),m=Math.floor(p);return(i?this.exaggeration():1)*Yr(Yr(u.get(f,m),u.get(f,m+1),p-m),Yr(u.get(f+1,m),u.get(f+1,m+1),p-m),d-f)}getAtTileOffset(t,e,i){const r=1<<t.canonical.z;return this.getAtPointOrZero(new Ip(t.wrap+(t.canonical.x+e/ur)/r,(t.canonical.y+i/ur)/r))}getAtTileOffsetFunc(t,e,i,r){return n=>{const o=this.getAtTileOffset(t,n.x,n.y),s=r.upVector(t.canonical,n.x,n.y),a=r.upVectorScale(t.canonical,e,i).metersToTile;return nd.scale(s,s,o*a),s}}getForTilePoints(t,e,i,r){if(this.isUsingMockSource())return!1;const n=gg.create(this,t,r);return!!n&&(e.forEach(t=>{t[2]=this.exaggeration()*n.getElevationAt(t[0],t[1],i)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,r=e.tileID,n=1<<t.canonical.z-r.canonical.z;let o=t.canonical.x/n-r.canonical.x,s=t.canonical.y/n-r.canonical.y,a=0;for(let e=0;e<t.canonical.z-r.canonical.z&&!i.leaves[a];e++){o*=2,s*=2;const t=2*Math.floor(s)+Math.floor(o);a=i.childOffsets[a]+t,o%=1,s%=1}return{min:this.exaggeration()*i.minimums[a],max:this.exaggeration()*i.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(0===t.length)return null;let e=!1,i=Number.MAX_VALUE,r=Number.MIN_VALUE;for(const n of t){const t=this.getMinMaxForTile(n.tileID);t&&(i=Math.min(i,t.min),r=Math.max(r,t.max),e=!0)}return e?{min:i,max:r}:null}}{constructor(t,e){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[i,r,n]=function(t){const e=new ul,i=new Ml,r=131;e.reserve(17161),i.reserve(33800);const n=64,o=8224;for(let t=-64;t<8288;t+=n)for(let i=-64;i<8288;i+=n){const r=i<0||i>o||t<0||t>o?24575:0,n=R(Math.round(i),0,ur),s=R(Math.round(t),0,ur);e.emplaceBack(n+r,s)}const s=(t,e)=>{const n=e*r+t;i.emplaceBack(n+1,n,n+r),i.emplaceBack(n+r,n+r+1,n+1)};for(let t=1;t<129;t++)for(let e=1;e<129;e++)s(e,t);return[0,129].forEach(t=>{for(let e=0;e<130;e++)s(e,t),s(t,e)}),[e,i,32768]}(),o=t.context;this.gridBuffer=o.createVertexBuffer(i,hd.members),this.gridIndexBuffer=o.createIndexBuffer(r),this.gridSegments=Ql.simpleSegment(0,0,i.length,r.length),this.gridNoSkirtSegments=Ql.simpleSegment(0,0,i.length,n),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new oS(e.map),this.orthoMatrix=Jh.create(),Jh.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,ur,0,ur,0,1);const s=o.gl;this._overlapStencilMode=new Ov({func:s.GEQUAL,mask:255},0,255,s.KEEP,s.KEEP,s.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=e,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new nS(e.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,e,i){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const r=t.terrain.properties,n=0===t.terrain.drapeRenderMode,o=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=pe.now();const s=t.terrain&&t.terrain.scope,a=r.get("source"),l=n?this._mockSourceCache:t.getSourceCache(a,s);if(!l)return void Y(`Couldn't find terrain source "${a}".`);if(this.sourceCache=l,this._exaggeration=o?this.calculateExaggeration(e):r.get("exaggeration"),!e.projection.requiresDraping&&o&&0===this._exaggeration)return void this._disable();this.enabled=!0;const c=()=>{this.sourceCache.used&&Y(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const t=this.getScaledDemTileSize();this.sourceCache.update(e,t,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,c(),this._initializing=!0),c(),e.updateElevation(!0,i),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(e),this._emptyDEMTextureDirty=!0,this._previousZoom=e.zoom}else this._disable()}calculateExaggeration(t){const e=this._previousCameraAltitude,i=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=i;const r=null!=e?i-e:Number.MAX_VALUE;if(Math.abs(r)<2)return this._exaggeration;const n=t.zoom,o=this._style.terrain;if(!this._previousUpdateTimestamp)return o.getExaggeration(n);let s=n-this._previousZoom;const a=this._previousUpdateTimestamp;let l=n;null!=this._evaluationZoom&&(l=this._evaluationZoom,Math.abs(n-l)>.5&&(s=.5*(n-l+s)),s*r<0&&(l+=s)),this._evaluationZoom=l;const c=o.getExaggeration(l),u=c===o.getExaggeration(Math.max(0,l-.1));if(u&&Math.abs(c-this._exaggeration)<.01)return c;let h=Math.min(.1,.00375*(this._updateTimestamp-a));return(u||c<.1||Math.abs(s)<1e-4)&&(h=Math.min(.2,4*h)),Yr(this._exaggeration,c,h)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&"source"===t.dataType?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):"style"===t.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const e=this.proxySourceCache,i=this.painter.transform;this._initializing&&(this._initializing=0===i._centerAltitude&&-1===this.getAtPointOrZero(Ip.fromLngLat(i.center),-1),this._emptyDEMTextureDirty=!this._initializing);const r=this.proxyCoords=e.getIds().map(t=>{const r=e.getTileByID(t).tileID;return r.projMatrix=i.calculateProjMatrix(r.toUnwrapped()),r});!function(t,e){const i=e.transform.pointCoordinate(e.transform.getCameraPoint()),r=new v(i.x,i.y);t.sort((t,e)=>{if(e.overscaledZ-t.overscaledZ)return e.overscaledZ-t.overscaledZ;const i=new v(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),n=new v(e.canonical.x+(1<<e.canonical.z)*e.wrap,e.canonical.y),o=r.mult(1<<t.canonical.z);return o.x-=.5,o.y-=.5,o.distSqr(i)-o.distSqr(n)})}(r,this.painter);const n=this.proxyToSource||{};this.proxyToSource={},r.forEach(t=>{this.proxyToSource[t.key]={}}),this.terrainTileForTile={};const o=this._style._mergedSourceCaches;for(const e in o){const i=o[e];if(!i.used)continue;if(i!==this.sourceCache&&this.resetTileLookupCache(i.id),this._setupProxiedCoordsForOrtho(i,t[e],n),i.usedForTerrain)continue;const r=t[e];i.getSource().reparseOverscaled&&this._assignTerrainTiles(r)}this.proxiedCoords[e.id]=r.map(t=>new sS(t,t.key,this.orthoMatrix)),this._assignTerrainTiles(r),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(n),this.renderingToTexture=!1;const s={};this._visibleDemTiles=[];for(const t of this.proxyCoords){const e=this.terrainTileForTile[t.key];if(!e)continue;const i=e.tileID.key;i in s||(this._visibleDemTiles.push(e),s[i]=i)}}_assignTerrainTiles(t){this._initializing||t.forEach(t=>{if(this.terrainTileForTile[t.key])return;const e=this._findTileCoveringTileID(t,this.sourceCache);e&&(this.terrainTileForTile[t.key]=e)})}_prepareDEMTextures(){const t=this.painter.context,e=t.gl;for(const i in this.terrainTileForTile){const r=this.terrainTileForTile[i],n=r.dem;!n||r.demTexture&&!r.needsDEMTextureUpload||(t.activeTexture.set(e.TEXTURE1),HE(this.painter,r,n))}}_prepareDemTileUniforms(t,e,i,r){if(!e||null==e.demTexture)return!1;const n=t.tileID.canonical,o=Math.pow(2,e.tileID.canonical.z-n.z),s=r||"";return i["u_dem_tl"+s]=[n.x*o%1,n.y*o%1],i["u_dem_scale"+s]=o,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,e=t.gl;if(!this._emptyDepthBufferTexture){const i=new bf({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new Dy(t,i,e.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0;const e=this._visibleDemTiles.reduce((e,i)=>{if(!i.dem)return e;const r=i.dem.tree.minimums[0];return r>0&&t++,e+r},0);return t?e/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,e=t.gl;t.activeTexture.set(e.TEXTURE2);const i=this._getLoadedAreaMinimum(),[r,n]=(()=>{const t=new wf({width:1,height:1},new Float32Array([i]));return[e.R32F,t]})();this._emptyDEMTextureDirty=!1;let o=this._emptyDEMTexture;return o?o.update(n,{premultiply:!1}):o=this._emptyDEMTexture=new Dy(t,n,r,{premultiply:!1}),o}setupElevationDraw(t,e,i){const r=this.painter.context,n=r.gl,o={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};o.u_exaggeration=this.exaggeration();let s=null,a=null,l=1;if(i&&i.morphing&&this._useVertexMorphing){const e=i.morphing.srcDemTile,r=i.morphing.dstDemTile;l=i.morphing.phase,e&&r&&(this._prepareDemTileUniforms(t,e,o,"_prev")&&(a=e),this._prepareDemTileUniforms(t,r,o)&&(s=r))}const c=t=>t&&t.demTexture&&this.painter.linearFloatFilteringSupported()?n.LINEAR:n.NEAREST,u=t=>{o.u_dem_size=1===t.size[0]?1:t.size[0]-2};if(a&&s)r.activeTexture.set(n.TEXTURE2),s.demTexture.bind(c(s),n.CLAMP_TO_EDGE),r.activeTexture.set(n.TEXTURE4),a.demTexture.bind(c(a),n.CLAMP_TO_EDGE),s.demTexture&&u(s.demTexture),o.u_dem_lerp=l;else{s=this.terrainTileForTile[t.tileID.key],r.activeTexture.set(n.TEXTURE2);const e=this._prepareDemTileUniforms(t,s,o)?s.demTexture:this.emptyDEMTexture;e.bind(c(s),n.CLAMP_TO_EDGE),u(e)}if(r.activeTexture.set(n.TEXTURE3),i&&i.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(n.NEAREST,n.CLAMP_TO_EDGE),this._depthFBO&&(o.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(n.NEAREST,n.CLAMP_TO_EDGE),o.u_depth_size_inv=[1,1]),i&&i.useMeterToDem&&s){const t=(1<<s.tileID.canonical.z)*vp(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;o.u_meter_to_dem=t}if(i&&i.labelPlaneMatrixInv&&(o.u_label_plane_matrix_inv=i.labelPlaneMatrixInv),e.setTerrainUniformValues(r,o),"globe"===this.painter.transform.projection.name){const n=this.globeUniformValues(this.painter.transform,t.tileID.canonical,i&&i.useDenormalizedUpVectorScale);e.setGlobeUniformValues(r,n)}}globeUniformValues(t,e,i){const r=t.projection;return{u_tile_tl_up:r.upVector(e,0,0),u_tile_tr_up:r.upVector(e,ur,0),u_tile_br_up:r.upVector(e,ur,ur),u_tile_bl_up:r.upVector(e,0,ur),u_tile_up_scale:i?Od(1):r.upVectorScale(e,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const e=this.painter,i=this.painter.context;0!==t.length&&(i.bindFramebuffer.set(null),i.viewport.set([0,0,e.width,e.height]),e.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(t,e,i,r,n){if("globe"===t.transform.projection.name)!function(t,e,i,r,n){const o=t.context,s=o.gl;let a,l;const c=t.transform,u=ip(t,o,c),h=(e,i)=>{if(l===i)return;const r=[QE[i],"PROJECTION_GLOBE_VIEW"];u&&r.push("CUSTOM_ANTIALIASING");const n=t.isTileAffectedByFog(e);a=t.getOrCreateProgram("globeRaster",{defines:r,overrideFog:n}),l=i},d=t.colorModeForRenderPass(),p=new Rv(s.LEQUAL,Rv.ReadWrite,t.depthRangeFor3D);JE.update(n);const f=Qd(c),m=[_p(c.center.lng),yp(c.center.lat)],g=t.globeSharedBuffers,_=[c.width*pe.devicePixelRatio,c.height*pe.devicePixelRatio],y=Float32Array.from(c.globeMatrix),v={useDenormalizedUpVectorScale:!0};{const c=t.transform,u=tS(c.zoom,e.exaggeration(),e.sourceCache._source.tileSize);l=-1;const x=s.TRIANGLES;for(const l of r){const r=i.getTile(l),b=Ov.disabled,w=e.prevTerrainTileForTile[l.key],T=e.terrainTileForTile[l.key];KE(w,T)&&JE.newMorphing(l.key,w,T,n,250),o.activeTexture.set(s.TEXTURE0),r.texture&&r.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);const E=JE.getMorphValuesForProxy(l.key),S=E?1:0;E&&ke(v,{morphing:{srcDemTile:E.from,dstDemTile:E.to,phase:A(E.phase)}});const M=Gd(l.canonical),I=np(M.getCenter().lat),C=rp(l.canonical,M,I,c.worldSize/c._pixelsPerMercatorPixel),P=$d(Bd(l.canonical)),R=YE(c.expandedFarZProjMatrix,y,f,P,tp(c.zoom),m,c.frustumCorners.TL,c.frustumCorners.TR,c.frustumCorners.BR,c.frustumCorners.BL,c.globeCenterInViewSpace,c.globeRadius,_,u,C);if(h(l,S),a&&(e.setupElevationDraw(r,a,v),t.uploadCommonUniforms(o,a,l.toUnwrapped()),g)){const[e,i,r]=g.getGridBuffers(I,0!==u);a.draw(t,x,p,b,d,Lv.backCCW,R,"globe_raster",e,i,r)}}}if(g&&(t.renderDefaultNorthPole||t.renderDefaultSouthPole)){const n=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];u&&n.push("CUSTOM_ANTIALIASING"),a=t.getOrCreateProgram("globeRaster",{defines:n});for(const n of r){const{x:r,y:l,z:u}=n.canonical,h=0===l,f=l===(1<<u)-1,[y,x,b,w]=g.getPoleBuffers(u,!1);if(w&&(h||f)){const l=i.getTile(n);o.activeTexture.set(s.TEXTURE0),l.texture&&l.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);let g=ep(u,r,c);const T=$d(Bd(n.canonical)),E=(e,i)=>e.draw(t,s.TRIANGLES,p,Ov.disabled,d,Lv.disabled,YE(c.expandedFarZProjMatrix,g,g,T,0,m,c.frustumCorners.TL,c.frustumCorners.TR,c.frustumCorners.BR,c.frustumCorners.BL,c.globeCenterInViewSpace,c.globeRadius,_,0),"globe_pole_raster",i,b,w);e.setupElevationDraw(l,a,v),t.uploadCommonUniforms(o,a,n.toUnwrapped()),h&&t.renderDefaultNorthPole&&E(a,y),f&&t.renderDefaultSouthPole&&(g=Jh.scale(Jh.create(),g,[1,-1,1]),E(a,x))}}}}(t,e,i,r,n);else{const o=t.context,s=o.gl;let a,l;const c=t.shadowRenderer,u=ZE(t,t.longestCutoffRange),h=e=>{if(l===e)return;const i=[];i.push(QE[e]),u.shouldRenderCutoff&&i.push("RENDER_CUTOFF"),a=t.getOrCreateProgram("terrainRaster",{defines:i}),l=e},d=t.colorModeForRenderPass(),p=new Rv(s.LEQUAL,Rv.ReadWrite,t.depthRangeFor3D);JE.update(n);const f=t.transform,m=tS(f.zoom,e.exaggeration(),e.sourceCache._source.tileSize);let g=[0,0,0];if(c){const e=t.style.directionalLight,i=t.style.ambientLight;e&&i&&(g=$A(e,i))}{l=-1;const _=s.TRIANGLES,[y,v]=[e.gridIndexBuffer,e.gridSegments];for(const l of r){const r=i.getTile(l),x=Ov.disabled,b=e.prevTerrainTileForTile[l.key],w=e.terrainTileForTile[l.key];KE(b,w)&&JE.newMorphing(l.key,b,w,n,250),o.activeTexture.set(s.TEXTURE0),r.texture&&r.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);const T=JE.getMorphValuesForProxy(l.key),E=T?1:0;let S;T&&(S={morphing:{srcDemTile:T.from,dstDemTile:T.to,phase:A(T.phase)}});const M=$E(l.projMatrix,eS(l.canonical,f.renderWorldCopies)?m/10:m,g);if(h(E),!a)continue;e.setupElevationDraw(r,a,S);const I=l.toUnwrapped();c&&c.setupShadows(I,a),t.uploadCommonUniforms(o,a,I,null,u),a.draw(t,_,p,x,d,Lv.backCCW,M,"terrain_raster",e.gridBuffer,y,v)}}}}(e,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,e.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const e=this.painter,i=this.painter.context,r=this.proxySourceCache,n=this.proxiedCoords[r.id],o=this._drapedRenderBatches.shift(),s=e.style.order,a=[];let l=0;for(const c of n){const n=r.getTileByID(c.proxyTileKey),u=r.proxyCachedFBO[c.key]?r.proxyCachedFBO[c.key][t]:void 0,h=void 0!==u?r.renderCache[u]:this.pool[l++],d=void 0!==u;if(n.texture=h.tex,d&&!h.dirty){a.push(n.tileID);continue}let p;i.bindFramebuffer.set(h.fb.framebuffer),this.renderedToTile=!1,h.dirty&&(i.clear({color:hi.transparent,stencil:0}),h.dirty=!1);for(let t=o.start;t<=o.end;++t){const r=e.style._mergedLayers[s[t]];if(r.isHidden(e.transform.zoom))continue;const n=e.style.getLayerSourceCache(r),o=n?this.proxyToSource[c.key][n.id]:[c];if(!o)continue;const a=o;i.viewport.set([0,0,h.fb.width,h.fb.height]),p!==(n?n.id:null)&&(this._setupStencil(h,o,r,n),p=n?n.id:null),e.renderLayer(e,n,r,a)}if(0===this._drapedRenderBatches.length)for(const t of this._pendingGroundEffectLayers){const r=e.style._mergedLayers[s[t]];if(r.isHidden(e.transform.zoom))continue;const n=e.style.getLayerSourceCache(r),o=n?this.proxyToSource[c.key][n.id]:[c];if(!o)continue;const a=o;i.viewport.set([0,0,h.fb.width,h.fb.height]),p!==(n?n.id:null)&&(this._setupStencil(h,o,r,n),p=n?n.id:null),e.renderLayer(e,n,r,a)}this.renderedToTile?(h.dirty=!0,a.push(n.tileID)):d||--l,5===l&&(l=0,this.renderToBackBuffer(a))}return this.renderToBackBuffer(a),this.renderingToTexture=!1,i.bindFramebuffer.set(null),i.viewport.set([0,0,e.width,e.height]),o.end+1}postRender(){}isLayerOrderingCorrect(t){const e=t.order.length;let i=-1,r=e;for(let n=0;n<e;++n)this._style.isLayerDraped(t._mergedLayers[t.order[n]])?i=Math.max(i,n):r=Math.min(r,n);return r>i}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(t=>t.dem).forEach(e=>{t=Math.min(t,e.dem.tree.minimums[0])}),0===t?t:(t-30)*this._exaggeration}raycast(t,e,i){if(!this._visibleDemTiles)return null;const r=this._visibleDemTiles.filter(t=>t.dem).map(r=>{const n=r.tileID,o=1<<n.overscaledZ,{x:s,y:a}=n.canonical,l=s/o,c=(s+1)/o,u=a/o,h=(a+1)/o;return{minx:l,miny:u,maxx:c,maxy:h,t:r.dem.tree.raycastRoot(l,u,c,h,t,e,i),tile:r}});r.sort((t,e)=>(null!==t.t?t.t:Number.MAX_VALUE)-(null!==e.t?e.t:Number.MAX_VALUE));for(const n of r){if(null==n.t)return null;const r=n.tile.dem.tree.raycast(n.minx,n.miny,n.maxx,n.maxy,t,e,i);if(null!=r)return r}return null}_createFBO(){const t=this.painter.context,e=t.gl,i=this.drapeBufferSize;t.activeTexture.set(e.TEXTURE0);const r=new Dy(t,{width:i[0],height:i[1],data:null},e.RGBA);r.bind(e.LINEAR,e.CLAMP_TO_EDGE);const n=t.createFramebuffer(i[0],i[1],!0,null);return n.colorAttachment.set(r.texture),n.depthAttachment=new Cv(t,n.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,i[0],i[1]),this._stencilRef=0,n.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):n.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&e.texParameterf(e.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:n,tex:r,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const e=this._style._mergedLayers[t],i=e.isHidden(this.painter.transform.zoom);return"custom"===e.type?!i&&e.shouldRedrape():!i&&e.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const e of this._style.getSources())if(e instanceof Gw){t=!0;break}if(!t)return;const e={};for(let t=0;t<this._style.order.length;++t){const i=this._style._mergedLayers[this._style.order[t]],r=this._style.getLayerSourceCache(i);if(r&&!e[r.id]&&!i.isHidden(this.painter.transform.zoom)&&"line"===i.type&&i.widthExpression()instanceof vo){e[r.id]=!0;for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][r.id];if(e)for(const t of e)this._clearRenderCacheForTile(r.id,t)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e]._source instanceof jw){t=!0;break}if(!t)return;const e={};for(let t=0;t<this._style.order.length;++t){const i=this._style._mergedLayers[this._style.order[t]],r=this._style.getLayerSourceCache(i);if(!r||e[r.id])continue;if(i.isHidden(this.painter.transform.zoom)||"raster"!==i.type)continue;const n=i.paint.get("raster-fade-duration");for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][r.id];if(e)for(const t of e){const e=rS(r.getTile(t),r.findLoadedParent(t,0),r,this.painter.transform,n);(1!==e.opacity||0!==e.mix)&&this._clearRenderCacheForTile(r.id,t)}}}}_setupDrapedRenderBatches(){const t=this._style.order,e=t.length;if(0===e)return;const i=[];this._pendingGroundEffectLayers=[];let r,n=0,o=this._style._mergedLayers[t[n]];for(;!this._style.isLayerDraped(o)&&o.isHidden(this.painter.transform.zoom)&&++n<e;)o=this._style._mergedLayers[t[n]];for(;n<e;++n){const e=this._style._mergedLayers[t[n]];e.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(e)?void 0===r&&(r=n):("fill-extrusion"===e.type&&this._pendingGroundEffectLayers.push(n),void 0!==r&&(i.push({start:r,end:n-1}),r=void 0)))}if(void 0!==r&&i.push({start:r,end:n-1}),0!==i.length){const t=i[i.length-1];this._pendingGroundEffectLayers.every(e=>e>t.end)||Y("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=i}_setupRenderCache(t){const e=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,e.renderCache.length>e.renderCachePool.length){const t=Object.values(e.proxyCachedFBO);e.proxyCachedFBO={};for(let i=0;i<t.length;++i){const r=Object.values(t[i]);e.renderCachePool.push(...r)}}return}this._clearRasterLayersFromRenderCache();const i=this.proxyCoords,r=this._tilesDirty;for(let n=i.length-1;n>=0;n--){const o=i[n];if(e.getTileByID(o.key),void 0!==e.proxyCachedFBO[o.key]){const i=t[o.key],n=this.proxyToSource[o.key];let s=0;for(const t in n){const e=n[t],o=i[t];if(!o||o.length!==e.length||e.some((e,i)=>e!==o[i]||r[t]&&r[t].hasOwnProperty(e.key))){s=-1;break}++s}for(const t in e.proxyCachedFBO[o.key])e.renderCache[e.proxyCachedFBO[o.key][t]].dirty=s<0||s!==Object.values(i).length}}const n=[...this._drapedRenderBatches];n.sort((t,e)=>e.end-e.start-(t.end-t.start));for(const t of n)for(const r of i){if(e.proxyCachedFBO[r.key])continue;let i=e.renderCachePool.pop();void 0===i&&e.renderCache.length<50&&(i=e.renderCache.length,e.renderCache.push(this._createFBO())),void 0!==i&&(e.proxyCachedFBO[r.key]={},e.proxyCachedFBO[r.key][t.start]=i,e.renderCache[i].dirty=!0)}this._tilesDirty={}}_setupStencil(t,e,i,r){if(!r||!this._sourceTilesOverlap[r.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const n=this.painter.context,o=n.gl;if(e.length<=1)return void(this._overlapStencilType=!1);let s;if(i.isTileClipped())s=e.length,this._overlapStencilMode.test={func:o.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(e[0].overscaledZ>e[e.length-1].overscaledZ))return void(this._overlapStencilType=!1);s=1,this._overlapStencilMode.test={func:o.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+s>255&&(n.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=s,this._overlapStencilMode.ref=this._stencilRef,i.isTileClipped()&&this._renderTileClippingMasks(e,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Ov.disabled}_renderTileClippingMasks(t,e){const i=this.painter,r=this.painter.context,n=r.gl;i._tileClippingMaskIDs={},r.setColorMode(Dv.disabled),r.setDepthMode(Rv.disabled);const o=i.getOrCreateProgram("clippingMask");for(const r of t){const t=i._tileClippingMaskIDs[r.key]=--e;o.draw(i,n.TRIANGLES,Rv.disabled,new Ov({func:n.ALWAYS,mask:0},t,255,n.KEEP,n.KEEP,n.REPLACE),Dv.disabled,Lv.disabled,iS(r.projMatrix),"$clipping",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}pointCoordinate(t){const e=this.painter.transform;if(t.x<0||t.x>e.width||t.y<0||t.y>e.height)return null;const i=[t.x,t.y,1,1];Xh.transformMat4(i,i,e.pixelMatrixInverse),Xh.scale(i,i,1/i[3]),i[0]/=e.worldSize,i[1]/=e.worldSize;const r=e._camera.position,n=vp(1,e.center.lat),o=[r[0],r[1],r[2]/n,0],s=nd.subtract([],i.slice(0,3),o);nd.normalize(s,s);const a=this.raycast(o,s,this._exaggeration);return null!==a&&a?(nd.scaleAndAdd(o,o,s,a),o[3]=o[2],o[2]*=n,o):null}drawDepth(){const t=this.painter,e=t.context,i=this.proxySourceCache,r=Math.ceil(t.width),n=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===r&&this._depthFBO.height===n||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const t=e.gl,i=e.createFramebuffer(r,n,!0,"renderbuffer");e.activeTexture.set(t.TEXTURE0);const o=new Dy(e,{width:r,height:n,data:null},t.RGBA);o.bind(t.NEAREST,t.CLAMP_TO_EDGE),i.colorAttachment.set(o.texture);const s=e.createRenderbuffer(e.gl.DEPTH_COMPONENT16,r,n);i.depthAttachment.set(s),this._depthFBO=i,this._depthTexture=o}e.bindFramebuffer.set(this._depthFBO.framebuffer),e.viewport.set([0,0,r,n]),function(t,e,i,r){if("globe"===t.transform.projection.name)return;const n=t.context,o=n.gl;n.clear({depth:1});const s=t.getOrCreateProgram("terrainDepth"),a=new Rv(o.LESS,Rv.ReadWrite,t.depthRangeFor3D);for(const n of r){const r=i.getTile(n),l=$E(n.projMatrix,0,[0,0,0]);e.setupElevationDraw(r,s),s.draw(t,o.TRIANGLES,a,Ov.disabled,Dv.unblended,Lv.backCCW,l,"terrain_depth",e.gridBuffer,e.gridIndexBuffer,e.gridNoSkirtSegments)}}(t,this,i,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,e,i){if(t.getSource()instanceof ew)return this._setupProxiedCoordsForImageSource(t,e,i);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const r=this.proxiedCoords[t.id]=[],n=this.proxyCoords;for(let e=0;e<n.length;e++){const o=n[e],s=this._findTileCoveringTileID(o,t);if(s){const e=this._createProxiedId(o,s,i[o.key]&&i[o.key][t.id]);r.push(e),this.proxyToSource[o.key][t.id]=[e]}}let o=!1;for(let n=0;n<e.length;n++){const s=t.getTile(e[n]);if(!s||!s.hasData())continue;const a=this._findTileCoveringTileID(s.tileID,this.proxySourceCache);if(a&&a.tileID.canonical.z!==s.tileID.canonical.z){const e=this.proxyToSource[a.tileID.key][t.id],n=this._createProxiedId(a.tileID,s,i[a.tileID.key]&&i[a.tileID.key][t.id]);e?e.splice(e.length-1,0,n):this.proxyToSource[a.tileID.key][t.id]=[n],r.push(n),o=!0}}this._sourceTilesOverlap[t.id]=o}_setupProxiedCoordsForImageSource(t,e,i){if(!t.getSource().loaded())return;const r=this.proxiedCoords[t.id]=[],n=this.proxyCoords,o=t.getSource(),s=o.tileID;if(!s)return;const a=new v(s.x,s.y)._div(1<<s.z),l=o.coordinates.map(Ip.fromLngLat).reduce((t,e)=>(t.min.x=Math.min(t.min.x,e.x-a.x),t.min.y=Math.min(t.min.y,e.y-a.y),t.max.x=Math.max(t.max.x,e.x-a.x),t.max.y=Math.max(t.max.y,e.y-a.y),t),{min:new v(Number.MAX_VALUE,Number.MAX_VALUE),max:new v(-Number.MAX_VALUE,-Number.MAX_VALUE)}),c=(t,e)=>{const i=t.wrap+t.canonical.x/(1<<t.canonical.z),r=t.canonical.y/(1<<t.canonical.z),n=ur/(1<<t.canonical.z),o=e.wrap+e.canonical.x/(1<<e.canonical.z),s=e.canonical.y/(1<<e.canonical.z);return i+n<o+l.min.x||i>o+l.max.x||r+n<s+l.min.y||r>s+l.max.y};for(let o=0;o<n.length;o++){const s=n[o];for(let n=0;n<e.length;n++){const o=t.getTile(e[n]);if(!o||!o.hasData())continue;if(c(s,o.tileID))continue;const a=this._createProxiedId(s,o,i[s.key]&&i[s.key][t.id]),l=this.proxyToSource[s.key][t.id];l?l.push(a):this.proxyToSource[s.key][t.id]=[a],r.push(a)}}}_createProxiedId(t,e,i){let r=this.orthoMatrix;if(i){const t=i.find(t=>t.key===e.tileID.key);if(t)return t}if(e.tileID.key!==t.key){const i=t.canonical.z-e.tileID.canonical.z;let n,o,s;r=Jh.create();const a=e.tileID.wrap-t.wrap<<t.overscaledZ;i>0?(n=ur>>i,o=n*((e.tileID.canonical.x<<i)-t.canonical.x+a),s=n*((e.tileID.canonical.y<<i)-t.canonical.y)):(n=ur<<-i,o=ur*(e.tileID.canonical.x-(t.canonical.x+a<<-i)),s=ur*(e.tileID.canonical.y-(t.canonical.y<<-i))),Jh.ortho(r,0,n,0,n,0,1),Jh.translate(r,r,[o,s,0])}return new sS(e.tileID,t.key,r)}_findTileCoveringTileID(t,e){let i=e.getTile(t);if(i&&i.hasData())return i;const r=this._findCoveringTileCache[e.id],n=r[t.key];if(i=n?e.getTileByID(n):null,i&&i.hasData()||null===n)return i;let o=i?i.tileID:t,s=o.overscaledZ;const a=e.getSource().minzoom,l=[];if(!n){const r=e.getSource().maxzoom;if(t.canonical.z>=r){const i=t.canonical.z-r;e.getSource().reparseOverscaled?(s=Math.max(t.canonical.z+2,e.transform.tileZoom),o=new gd(s,t.wrap,r,t.canonical.x>>i,t.canonical.y>>i)):0!==i&&(s=r,o=new gd(s,t.wrap,r,t.canonical.x>>i,t.canonical.y>>i))}o.key!==t.key&&(l.push(o.key),i=e.getTile(o))}const c=t=>{l.forEach(e=>{r[e]=t}),l.length=0};for(s-=1;s>=a&&(!i||!i.hasData());s--){i&&c(i.tileID.key);const t=o.calculateScaledKey(s);if(i=e.getTileByID(t),i&&i.hasData())break;const n=r[t];if(null===n)break;void 0===n?l.push(t):i=e.getTileByID(n)}return c(i?i.tileID.key:null),i&&i.hasData()?i:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,e){let i=this._tilesDirty[t];i||(i=this._tilesDirty[t]={}),i[e.key]=!0}}function lS(t,e,i){const r=function(t,e,i){const r=nd.dot(e,t),n=nd.dot(i,[.2126,.7152,.0722]),o=(t,e,i)=>(1-i)*t+i*e,s=o(1-.3*Math.min(n,1),1,Math.min(r+1,1));return o(.92,1,Math.asin(R(e[2],-1,1))/Math.PI+.5)*s}(t,[0,0,1],e),n=[0,0,0];nd.scale(n,i.slice(0,3),r);const o=[0,0,0];nd.scale(o,e.slice(0,3),t[2]);const s=[0,0,0];return nd.add(s,n,o),lt(s)}const cS=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],uS=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class hS{static cacheKey(t,e,i,r){let n=`${e}${r?r.cacheKey:""}`;for(const e of i)t.usedDefines.includes(e)&&(n+="/"+e);return n}constructor(t,e,i,r,n,o){const s=t.gl;this.program=s.createProgram(),this.configuration=r,this.name=e,this.fixedDefines=[...o];const a=r?r.getBinderAttributes():[],l=(i.staticAttributes||[]).concat(a);let c=r?r.defines():[];c=c.concat(o.map(t=>"#define "+t));const u="#version 300 es\n";let h=u+c.concat("precision mediump float;",zE,FE.fragmentSource).join("\n");for(const t of i.fragmentIncludes)h+="\n"+kE[t];h+="\n"+i.fragmentSource;let d=u+c.concat("precision highp float;",zE,FE.vertexSource).join("\n");for(const t of i.vertexIncludes)d+="\n"+kE[t];d+="\n"+i.vertexSource;const p=s.createShader(s.FRAGMENT_SHADER);if(s.isContextLost())return void(this.failedToCreate=!0);s.shaderSource(p,h),s.compileShader(p),s.attachShader(this.program,p);const f=s.createShader(s.VERTEX_SHADER);if(s.isContextLost())this.failedToCreate=!0;else{s.shaderSource(f,d),s.compileShader(f),s.attachShader(this.program,f),this.attributes={},this.numAttributes=l.length;for(let t=0;t<this.numAttributes;t++)if(l[t]){const e=l[t].startsWith("a_")?l[t]:"a_"+l[t];s.bindAttribLocation(this.program,t,e),this.attributes[e]=t}s.linkProgram(this.program),s.deleteShader(f),s.deleteShader(p),this.fixedUniforms=n(t),this.binderUniforms=r?r.getUniforms(t):[],o.includes("TERRAIN")&&(this.terrainUniforms=(t=>({u_dem:new fc(t),u_dem_prev:new fc(t),u_dem_tl:new gc(t),u_dem_scale:new mc(t),u_dem_tl_prev:new gc(t),u_dem_scale_prev:new mc(t),u_dem_size:new mc(t),u_dem_lerp:new mc(t),u_exaggeration:new mc(t),u_depth:new fc(t),u_depth_size_inv:new gc(t),u_meter_to_dem:new mc(t),u_label_plane_matrix_inv:new bc(t)}))(t)),o.includes("GLOBE")&&(this.globeUniforms=(t=>({u_tile_tl_up:new _c(t),u_tile_tr_up:new _c(t),u_tile_br_up:new _c(t),u_tile_bl_up:new _c(t),u_tile_up_scale:new mc(t)}))(t)),o.includes("FOG")&&(this.fogUniforms=(t=>({u_fog_matrix:new bc(t),u_fog_range:new gc(t),u_fog_color:new yc(t),u_fog_horizon_blend:new mc(t),u_fog_vertical_limit:new gc(t),u_fog_temporal_offset:new mc(t),u_frustum_tl:new _c(t),u_frustum_tr:new _c(t),u_frustum_br:new _c(t),u_frustum_bl:new _c(t),u_globe_pos:new _c(t),u_globe_radius:new mc(t),u_globe_transition:new mc(t),u_is_globe:new fc(t),u_viewport:new gc(t)}))(t)),o.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(t=>({u_cutoff_params:new yc(t)}))(t)),o.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(t=>({u_lighting_ambient_color:new _c(t),u_lighting_directional_dir:new _c(t),u_lighting_directional_color:new _c(t),u_ground_radiance:new _c(t)}))(t)),o.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(t=>({u_light_matrix_0:new bc(t),u_light_matrix_1:new bc(t),u_fade_range:new gc(t),u_shadow_normal_offset:new _c(t),u_shadow_intensity:new mc(t),u_shadow_texel_size:new mc(t),u_shadow_map_resolution:new mc(t),u_shadow_direction:new _c(t),u_shadow_bias:new _c(t),u_shadowmap_0:new fc(t),u_shadowmap_1:new fc(t)}))(t))}}setTerrainUniformValues(t,e){if(!this.terrainUniforms)return;const i=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t]&&i[t].set(this.program,t,e[t])}}setGlobeUniformValues(t,e){if(!this.globeUniforms)return;const i=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t]&&i[t].set(this.program,t,e[t])}}setFogUniformValues(t,e){if(!this.fogUniforms)return;const i=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t].set(this.program,t,e[t])}}setCutoffUniformValues(t,e){if(!this.cutoffUniforms)return;const i=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t].set(this.program,t,e[t])}}setLightsUniformValues(t,e){if(!this.lightsUniforms)return;const i=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t].set(this.program,t,e[t])}}setShadowUniformValues(t,e){if(this.failedToCreate||!this.shadowUniforms)return;const i=this.shadowUniforms;t.program.set(this.program);for(const t in e)i[t].set(this.program,t,e[t])}_drawDebugWireframe(t,e,i,r,n,o,s,a,l,c){const u=t.options.wireframe;if(!1===u.terrain&&!1===u.layers2D&&!1===u.layers3D)return;const h=t.context;if(!(()=>!(!u.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!u.layers2D||t._terrain&&t._terrain.renderingToTexture||!cS.includes(this.name))||!(!u.layers3D||!uS.includes(this.name)))())return;const d=h.gl,p=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,n,h);if(!p)return;const f=[...this.fixedDefines];f.push("DEBUG_WIREFRAME");const m=t.getOrCreateProgram(this.name,{config:this.configuration,defines:f});h.program.set(m.program);const g=(t,e,i)=>{if(e[t]&&i[t])for(const r in e[t])i[t][r]&&i[t][r].set(i.program,r,e[t][r].current)};l&&l.setUniforms(m.program,h,m.binderUniforms,s,{zoom:a}),g("fixedUniforms",this,m),g("terrainUniforms",this,m),g("globeUniforms",this,m),g("fogUniforms",this,m),g("lightsUniforms",this,m),g("shadowUniforms",this,m),p.bind(),h.setColorMode(new Dv([d.ONE,d.ONE_MINUS_SRC_ALPHA,d.ZERO,d.ONE],hi.transparent,[!0,!0,!0,!1])),h.setDepthMode(new Rv(e.func===d.LESS?d.LEQUAL:e.func,Rv.ReadOnly,e.range)),h.setStencilMode(Ov.disabled);const _=3*o.primitiveLength*2,y=3*o.primitiveOffset*2*2;c&&c>1?d.drawElementsInstanced(d.LINES,_,d.UNSIGNED_SHORT,y,c):d.drawElements(d.LINES,_,d.UNSIGNED_SHORT,y),n.bind(),h.program.set(this.program),h.setDepthMode(e),h.setStencilMode(i),h.setColorMode(r)}draw(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,m){const g=t.context,_=g.gl;if(this.failedToCreate)return;g.program.set(this.program),g.setDepthMode(i),g.setStencilMode(r),g.setColorMode(n),g.setCullFace(o);for(const t of Object.keys(this.fixedUniforms))this.fixedUniforms[t].set(this.program,t,s[t]);p&&p.setUniforms(this.program,g,this.binderUniforms,h,{zoom:d});const y={[_.LINES]:2,[_.TRIANGLES]:3,[_.LINE_STRIP]:1}[e],v=m&&m>0?1:void 0;for(const o of u.get()){const s=o.vaos||(o.vaos={});(s[a]||(s[a]=new jE)).bind(g,this,l,p?p.getPaintVertexBuffers():[],c,o.vertexOffset,f||[],v),m&&m>1?_.drawElementsInstanced(e,o.primitiveLength*y,_.UNSIGNED_SHORT,o.primitiveOffset*y*2,m):_.drawElements(e,o.primitiveLength*y,_.UNSIGNED_SHORT,o.primitiveOffset*y*2),e===_.TRIANGLES&&this._drawDebugWireframe(t,i,r,n,c,o,h,d,p,m)}}}function dS(t,e){const i=Math.pow(2,e.tileID.overscaledZ),r=e.tileSize*Math.pow(2,t.transform.tileZoom)/i,n=r*(e.tileID.canonical.x+e.tileID.wrap*i),o=r*e.tileID.canonical.y;return{u_image:0,u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/ox(e,1,t.transform.tileZoom),u_pixel_coord_upper:[n>>16,o>>16],u_pixel_coord_lower:[65535&n,65535&o]}}const pS=Jh.create(),fS=(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,m)=>{const g=e.style.light,_=g.properties.get("position"),y=[_.x,_.y,_.z],v=Zh.create();"viewport"===g.properties.get("anchor")&&(Zh.fromRotation(v,-e.transform.angle),nd.transformMat3(y,y,v));const x=g.properties.get("color"),b=e.transform,w={u_matrix:t,u_lightpos:y,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[x.r,x.g,x.b],u_vertical_gradient:+i,u_opacity:r,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:pS,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:n,u_edge_radius:o,u_flood_light_color:h,u_vertical_scale:d,u_flood_light_intensity:p,u_ground_shadow_factor:f,u_emissive_strength:m};return"globe"===b.projection.name&&(w.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],w.u_zoom_transition=l,w.u_inv_rot_matrix=u,w.u_merc_center=c,w.u_up_dir=b.projection.upVector(new fd(0,0,0),c[0]*ur,c[1]*ur),w.u_height_lift=a),w},mS=(t,e,i)=>({u_matrix:t,u_edge_radius:e,u_vertical_scale:i}),gS=(t,e,i,r,n,o,s,a,l,c,u,h,d,p)=>{const f=fS(t,e,i,r,n,o,s,l,c,u,h,d,p,1,[0,0,0],0),m={u_height_factor:-Math.pow(2,s.overscaledZ)/a.tileSize/8};return B(f,dS(e,a),m)},_S=(t,e)=>({u_matrix:t,u_emissive_strength:e}),yS=(t,e,i,r)=>B(_S(t,e),dS(i,r)),vS=(t,e,i)=>({u_matrix:t,u_world:i,u_emissive_strength:e}),xS=(t,e,i,r,n)=>B(yS(t,e,i,r),{u_world:n}),bS=(t,e,i,r)=>{const n=ur/i.tileSize;return{u_matrix:t,u_camera_to_center_distance:e.getCameraToCenterDistance(r),u_extrude_scale:[e.pixelsToGLUnits[0]/n,e.pixelsToGLUnits[1]/n]}},wS=(t,e,i=1)=>({u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:i}),TS=Jh.create(),ES=(t,e,i,r,n,o,s)=>{const a=t.transform,l="globe"===a.projection.name,c=l?Kd(a.zoom,e.canonical)*a._pixelsPerMercatorPixel:ox(i,1,o),u={u_matrix:e.projMatrix,u_extrude_scale:c,u_intensity:s,u_inv_rot_matrix:TS,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(l){u.u_inv_rot_matrix=r,u.u_merc_center=n,u.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],u.u_zoom_transition=tp(a.zoom);const t=n[0]*ur,i=n[1]*ur;u.u_up_dir=a.projection.upVector(new fd(0,0,0),t,i)}return u},SS=(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,x,b)=>{return{u_matrix:t,u_normalize_matrix:e,u_globe_matrix:i,u_merc_matrix:r,u_grid_matrix:n,u_tl_parent:o,u_scale_parent:u,u_fade_t:h.mix,u_opacity:h.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(T=d.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(w=d.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:AS(d.paint.get("raster-hue-rotate")),u_perspective_transform:p,u_raster_elevation:f,u_tl_br:s,u_zoom_transition:a,u_merc_center:l,u_cutoff_params:c,u_colorization_mix:MS(g,y),u_colorization_offset:IS(_,y),u_color_ramp:m,u_texture_offset:[x/(v+2*x),v/(v+2*x)],u_texture_res:[v+2*x,v+2*x],u_emissive_strength:b};var w,T};function AS(t){t*=Math.PI/180;const e=Math.sin(t),i=Math.cos(t);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}function MS([t,e,i,r],[n,o]){if(n===o)return[0,0,0,0];const s=259/257/(o-n);return[t*s,e*s,i*s,r*s]}function IS(t,[e,i]){return e===i?0:((t-e)/(i-e)*259-1)/257}const CS=Jh.create(),PS=(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,_)=>{const y=n.transform,v={u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:y.getCameraToCenterDistance(m),u_rotate_symbol:+i,u_aspect_ratio:y.width/y.height,u_fade_change:n.options.fadeDuration?n.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:s,u_coord_matrix:a,u_is_text:+l,u_pitch_with_map:+r,u_texsize:c,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:CS,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:CS,u_up_vector:[0,-1,0],u_icon_transition:_||0,u_icon_saturation:g};return"globe"===m.name&&(v.u_tile_id=[u.canonical.x,u.canonical.y,1<<u.canonical.z],v.u_zoom_transition=h,v.u_inv_rot_matrix=p,v.u_merc_center=d,v.u_camera_forward=y._camera.forward(),v.u_ecef_origin=function(t,e){const i=[0,0,0],r=$d(Bd(e.canonical));return nd.transformMat4(i,i,r),nd.transformMat4(i,i,t),i}(y.globeMatrix,u.toUnwrapped()),v.u_tile_matrix=Float32Array.from(y.globeMatrix),v.u_up_vector=f),v},RS=(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g)=>B(PS(t,e,i,r,n,o,s,a,l,c,h,d,p,f,m,g,1),{u_gamma_scale:r?n.transform.getCameraToCenterDistance(g)*Math.cos(n.terrain?0:n.transform._pitch):1,u_device_pixel_ratio:pe.devicePixelRatio,u_is_halo:+u,undefined:void 0}),OS=(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,m)=>B(RS(t,e,i,r,n,o,s,a,!0,l,!0,u,h,d,p,f,m),{u_texsize_icon:c,u_texture_icon:1}),DS=(t,e,i,r)=>({u_matrix:t,u_emissive_strength:e,u_opacity:i,u_color:r}),LS=(t,e,i,r,n,o,s)=>B(function(t,e,i,r){const n=i.imageManager.getPattern(t.toString(),e),{width:o,height:s}=i.imageManager.getPixelSize(e),a=Math.pow(2,r.tileID.overscaledZ),l=r.tileSize*Math.pow(2,i.transform.tileZoom)/a,c=l*(r.tileID.canonical.x+r.tileID.wrap*a),u=l*r.tileID.canonical.y;return{u_image:0,u_pattern_tl:n.tl,u_pattern_br:n.br,u_texsize:[o,s],u_pattern_size:n.displaySize,u_tile_units_to_pixels:1/ox(r,1,i.transform.tileZoom),u_pixel_coord_upper:[c>>16,u>>16],u_pixel_coord_lower:[65535&c,65535&u]}}(n,o,r,s),{u_matrix:t,u_emissive_strength:e,u_opacity:i}),kS=5,BS=6,FS=7,zS=8,NS=9,US=10,GS=(t,e,i,r,n,o,s,a,l,c,u,h,d=[0,0,0])=>{const p=r.style.light,f=p.properties.get("position"),m=[-f.x,-f.y,f.z],g=Zh.create();"viewport"===p.properties.get("anchor")&&(Zh.fromRotation(g,-r.transform.angle),nd.transformMat3(m,m,g));const _="MASK"===c.alphaMode,y=p.properties.get("color"),v=h.paint.get("model-ambient-occlusion-intensity"),x=h.paint.get("model-color").constantOr(hi.white),b=h.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:t,u_lighting_matrix:e,u_normal_matrix:i,u_lightpos:m,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[y.r,y.g,y.b],u_camera_pos:d,u_opacity:n,u_baseTextureIsAlpha:0,u_alphaMask:+_,u_alphaCutoff:c.alphaCutoff,u_baseColorFactor:[o.r,o.g,o.b,o.a],u_emissiveFactor:[s[0],s[1],s[2],1],u_metallicFactor:a,u_roughnessFactor:l,u_baseColorTexture:kS,u_metallicRoughnessTexture:BS,u_normalTexture:FS,u_occlusionTexture:zS,u_emissionTexture:NS,u_color_mix:[x.r,x.g,x.b,b],u_aoIntensity:v,u_emissive_strength:u}},jS=new Float32Array(16),VS=(t,e=jS,i=jS)=>({u_matrix:t,u_instance:e,u_node_matrix:i}),XS={fillExtrusion:t=>({u_matrix:new bc(t),u_lightpos:new _c(t),u_lightintensity:new mc(t),u_lightcolor:new _c(t),u_vertical_gradient:new mc(t),u_opacity:new mc(t),u_edge_radius:new mc(t),u_ao:new gc(t),u_tile_id:new _c(t),u_zoom_transition:new mc(t),u_inv_rot_matrix:new bc(t),u_merc_center:new gc(t),u_up_dir:new _c(t),u_height_lift:new mc(t),u_flood_light_color:new _c(t),u_vertical_scale:new mc(t),u_flood_light_intensity:new mc(t),u_ground_shadow_factor:new _c(t),u_emissive_strength:new mc(t)}),fillExtrusionDepth:t=>({u_matrix:new bc(t),u_edge_radius:new mc(t),u_vertical_scale:new mc(t)}),fillExtrusionPattern:t=>({u_matrix:new bc(t),u_lightpos:new _c(t),u_lightintensity:new mc(t),u_lightcolor:new _c(t),u_vertical_gradient:new mc(t),u_height_factor:new mc(t),u_edge_radius:new mc(t),u_ao:new gc(t),u_tile_id:new _c(t),u_zoom_transition:new mc(t),u_inv_rot_matrix:new bc(t),u_merc_center:new gc(t),u_up_dir:new _c(t),u_height_lift:new mc(t),u_image:new fc(t),u_texsize:new gc(t),u_pixel_coord_upper:new gc(t),u_pixel_coord_lower:new gc(t),u_tile_units_to_pixels:new mc(t),u_opacity:new mc(t)}),fillExtrusionGroundEffect:t=>({u_matrix:new bc(t),u_opacity:new mc(t),u_ao_pass:new mc(t),u_meter_to_tile:new mc(t),u_ao:new gc(t),u_flood_light_intensity:new mc(t),u_flood_light_color:new _c(t),u_attenuation:new mc(t),u_edge_radius:new mc(t),u_fb:new fc(t),u_fb_size:new mc(t)}),fill:t=>({u_matrix:new bc(t),u_emissive_strength:new mc(t)}),fillPattern:t=>({u_matrix:new bc(t),u_emissive_strength:new mc(t),u_image:new fc(t),u_texsize:new gc(t),u_pixel_coord_upper:new gc(t),u_pixel_coord_lower:new gc(t),u_tile_units_to_pixels:new mc(t)}),fillOutline:t=>({u_matrix:new bc(t),u_emissive_strength:new mc(t),u_world:new gc(t)}),fillOutlinePattern:t=>({u_matrix:new bc(t),u_emissive_strength:new mc(t),u_world:new gc(t),u_image:new fc(t),u_texsize:new gc(t),u_pixel_coord_upper:new gc(t),u_pixel_coord_lower:new gc(t),u_tile_units_to_pixels:new mc(t)}),circle:t=>({u_camera_to_center_distance:new mc(t),u_extrude_scale:new Sc(t),u_device_pixel_ratio:new mc(t),u_matrix:new bc(t),u_inv_rot_matrix:new bc(t),u_merc_center:new gc(t),u_tile_id:new _c(t),u_zoom_transition:new mc(t),u_up_dir:new _c(t),u_emissive_strength:new mc(t)}),collisionBox:t=>({u_matrix:new bc(t),u_camera_to_center_distance:new mc(t),u_extrude_scale:new gc(t)}),collisionCircle:t=>({u_matrix:new bc(t),u_inv_matrix:new bc(t),u_camera_to_center_distance:new mc(t),u_viewport_size:new gc(t)}),debug:t=>({u_color:new vc(t),u_matrix:new bc(t),u_overlay:new fc(t),u_overlay_scale:new mc(t)}),clippingMask:t=>({u_matrix:new bc(t)}),heatmap:t=>({u_extrude_scale:new mc(t),u_intensity:new mc(t),u_matrix:new bc(t),u_inv_rot_matrix:new bc(t),u_merc_center:new gc(t),u_tile_id:new _c(t),u_zoom_transition:new mc(t),u_up_dir:new _c(t)}),heatmapTexture:t=>({u_image:new fc(t),u_color_ramp:new fc(t),u_opacity:new mc(t)}),hillshade:t=>({u_matrix:new bc(t),u_image:new fc(t),u_latrange:new gc(t),u_light:new gc(t),u_shadow:new vc(t),u_highlight:new vc(t),u_emissive_strength:new mc(t),u_accent:new vc(t)}),hillshadePrepare:t=>({u_matrix:new bc(t),u_image:new fc(t),u_dimension:new gc(t),u_zoom:new mc(t)}),line:t=>({u_matrix:new bc(t),u_pixels_to_tile_units:new Sc(t),u_device_pixel_ratio:new mc(t),u_units_to_pixels:new gc(t),u_dash_image:new fc(t),u_gradient_image:new fc(t),u_image_height:new mc(t),u_texsize:new gc(t),u_tile_units_to_pixels:new mc(t),u_alpha_discard_threshold:new mc(t),u_trim_offset:new gc(t),u_emissive_strength:new mc(t)}),linePattern:t=>({u_matrix:new bc(t),u_texsize:new gc(t),u_pixels_to_tile_units:new Sc(t),u_device_pixel_ratio:new mc(t),u_image:new fc(t),u_units_to_pixels:new gc(t),u_tile_units_to_pixels:new mc(t),u_alpha_discard_threshold:new mc(t)}),raster:t=>({u_matrix:new bc(t),u_normalize_matrix:new bc(t),u_globe_matrix:new bc(t),u_merc_matrix:new bc(t),u_grid_matrix:new Tc(t),u_tl_parent:new gc(t),u_scale_parent:new mc(t),u_fade_t:new mc(t),u_opacity:new mc(t),u_image0:new fc(t),u_image1:new fc(t),u_brightness_low:new mc(t),u_brightness_high:new mc(t),u_saturation_factor:new mc(t),u_contrast_factor:new mc(t),u_spin_weights:new _c(t),u_perspective_transform:new gc(t),u_raster_elevation:new mc(t),u_tl_br:new yc(t),u_zoom_transition:new mc(t),u_merc_center:new gc(t),u_cutoff_params:new yc(t),u_colorization_mix:new yc(t),u_colorization_offset:new mc(t),u_color_ramp:new fc(t),u_texture_offset:new gc(t),u_texture_res:new gc(t),u_emissive_strength:new mc(t)}),symbolIcon:t=>({u_is_size_zoom_constant:new fc(t),u_is_size_feature_constant:new fc(t),u_size_t:new mc(t),u_size:new mc(t),u_camera_to_center_distance:new mc(t),u_rotate_symbol:new fc(t),u_aspect_ratio:new mc(t),u_fade_change:new mc(t),u_matrix:new bc(t),u_label_plane_matrix:new bc(t),u_coord_matrix:new bc(t),u_is_text:new fc(t),u_pitch_with_map:new fc(t),u_texsize:new gc(t),u_tile_id:new _c(t),u_zoom_transition:new mc(t),u_inv_rot_matrix:new bc(t),u_merc_center:new gc(t),u_camera_forward:new _c(t),u_tile_matrix:new bc(t),u_up_vector:new _c(t),u_ecef_origin:new _c(t),u_texture:new fc(t),u_icon_transition:new mc(t),u_icon_saturation:new mc(t)}),symbolSDF:t=>({u_is_size_zoom_constant:new fc(t),u_is_size_feature_constant:new fc(t),u_size_t:new mc(t),u_size:new mc(t),u_camera_to_center_distance:new mc(t),u_rotate_symbol:new fc(t),u_aspect_ratio:new mc(t),u_fade_change:new mc(t),u_matrix:new bc(t),u_label_plane_matrix:new bc(t),u_coord_matrix:new bc(t),u_is_text:new fc(t),u_pitch_with_map:new fc(t),u_texsize:new gc(t),u_texture:new fc(t),u_gamma_scale:new mc(t),u_device_pixel_ratio:new mc(t),u_tile_id:new _c(t),u_zoom_transition:new mc(t),u_inv_rot_matrix:new bc(t),u_merc_center:new gc(t),u_camera_forward:new _c(t),u_tile_matrix:new bc(t),u_up_vector:new _c(t),u_ecef_origin:new _c(t),u_is_halo:new fc(t)}),symbolTextAndIcon:t=>({u_is_size_zoom_constant:new fc(t),u_is_size_feature_constant:new fc(t),u_size_t:new mc(t),u_size:new mc(t),u_camera_to_center_distance:new mc(t),u_rotate_symbol:new fc(t),u_aspect_ratio:new mc(t),u_fade_change:new mc(t),u_matrix:new bc(t),u_label_plane_matrix:new bc(t),u_coord_matrix:new bc(t),u_is_text:new fc(t),u_pitch_with_map:new fc(t),u_texsize:new gc(t),u_texsize_icon:new gc(t),u_texture:new fc(t),u_texture_icon:new fc(t),u_gamma_scale:new mc(t),u_device_pixel_ratio:new mc(t),u_is_halo:new fc(t)}),background:t=>({u_matrix:new bc(t),u_emissive_strength:new mc(t),u_opacity:new mc(t),u_color:new vc(t)}),backgroundPattern:t=>({u_matrix:new bc(t),u_emissive_strength:new mc(t),u_opacity:new mc(t),u_image:new fc(t),u_pattern_tl:new gc(t),u_pattern_br:new gc(t),u_texsize:new gc(t),u_pattern_size:new gc(t),u_pixel_coord_upper:new gc(t),u_pixel_coord_lower:new gc(t),u_tile_units_to_pixels:new mc(t)}),terrainRaster:WE,terrainDepth:WE,skybox:t=>({u_matrix:new bc(t),u_sun_direction:new _c(t),u_cubemap:new fc(t),u_opacity:new mc(t),u_temporal_offset:new mc(t)}),skyboxGradient:t=>({u_matrix:new bc(t),u_color_ramp:new fc(t),u_center_direction:new _c(t),u_radius:new mc(t),u_opacity:new mc(t),u_temporal_offset:new mc(t)}),skyboxCapture:t=>({u_matrix_3f:new Tc(t),u_sun_direction:new _c(t),u_sun_intensity:new mc(t),u_color_tint_r:new yc(t),u_color_tint_m:new yc(t),u_luminance:new mc(t)}),globeRaster:t=>({u_proj_matrix:new bc(t),u_globe_matrix:new bc(t),u_normalize_matrix:new bc(t),u_merc_matrix:new bc(t),u_zoom_transition:new mc(t),u_merc_center:new gc(t),u_image0:new fc(t),u_grid_matrix:new Tc(t),u_skirt_height:new mc(t),u_frustum_tl:new _c(t),u_frustum_tr:new _c(t),u_frustum_br:new _c(t),u_frustum_bl:new _c(t),u_globe_pos:new _c(t),u_globe_radius:new mc(t),u_viewport:new gc(t)}),globeAtmosphere:t=>({u_frustum_tl:new _c(t),u_frustum_tr:new _c(t),u_frustum_br:new _c(t),u_frustum_bl:new _c(t),u_horizon:new mc(t),u_transition:new mc(t),u_fadeout_range:new mc(t),u_color:new yc(t),u_high_color:new yc(t),u_space_color:new yc(t),u_temporal_offset:new mc(t),u_horizon_angle:new mc(t)}),model:t=>({u_matrix:new bc(t),u_lighting_matrix:new bc(t),u_normal_matrix:new bc(t),u_lightpos:new _c(t),u_lightintensity:new mc(t),u_lightcolor:new _c(t),u_camera_pos:new _c(t),u_opacity:new mc(t),u_baseColorFactor:new yc(t),u_emissiveFactor:new yc(t),u_metallicFactor:new mc(t),u_roughnessFactor:new mc(t),u_baseTextureIsAlpha:new fc(t),u_alphaMask:new fc(t),u_alphaCutoff:new mc(t),u_baseColorTexture:new fc(t),u_metallicRoughnessTexture:new fc(t),u_normalTexture:new fc(t),u_occlusionTexture:new fc(t),u_emissionTexture:new fc(t),u_color_mix:new yc(t),u_aoIntensity:new mc(t),u_emissive_strength:new mc(t)}),modelDepth:t=>({u_matrix:new bc(t),u_instance:new bc(t),u_node_matrix:new bc(t)}),groundShadow:t=>({u_matrix:new bc(t),u_ground_shadow_factor:new _c(t)}),stars:t=>({u_matrix:new bc(t),u_up:new _c(t),u_right:new _c(t),u_intensity_multiplier:new mc(t)})};let HS;function qS(t,e,i,r,n,o,s){const a=t.context,l=a.gl,c=t.transform,u=t.getOrCreateProgram("collisionBox"),h=[];let d=0,p=0;for(let a=0;a<r.length;a++){const f=r[a],m=e.getTile(f),g=m.getBucket(i);if(!g)continue;const _=WT(f,g,c);let y=_;0===n[0]&&0===n[1]||(y=t.translatePosMatrix(_,m,n,o));const v=s?g.textCollisionBox:g.iconCollisionBox,x=g.collisionCircleArray;if(x.length>0){const t=Jh.create(),e=y;Jh.mul(t,g.placementInvProjMatrix,c.glCoordMatrix),Jh.mul(t,t,g.placementViewportMatrix),h.push({circleArray:x,circleOffset:p,transform:e,invTransform:t,projection:g.getProjection()}),d+=x.length/4,p=d}v&&(t.terrain&&t.terrain.setupElevationDraw(m,u),u.draw(t,l.LINES,Rv.disabled,Ov.disabled,t.colorModeForRenderPass(),Lv.disabled,bS(y,c,m,g.getProjection()),i.id,v.layoutVertexBuffer,v.indexBuffer,v.segments,null,c.zoom,null,[v.collisionVertexBuffer,v.collisionVertexBufferExt]))}if(!s||!h.length)return;const f=t.getOrCreateProgram("collisionCircle"),m=new Sl;m.resize(4*d),m._trim();let g=0;for(const t of h)for(let e=0;e<t.circleArray.length/4;e++){const i=4*e,r=t.circleArray[i+0],n=t.circleArray[i+1],o=t.circleArray[i+2],s=t.circleArray[i+3];m.emplace(g++,r,n,o,s,0),m.emplace(g++,r,n,o,s,1),m.emplace(g++,r,n,o,s,2),m.emplace(g++,r,n,o,s,3)}(!HS||HS.length<2*d)&&(HS=function(t){const e=2*t,i=new Ml;i.resize(e),i._trim();for(let t=0;t<e;t++){const e=6*t;i.uint16[e+0]=4*t+0,i.uint16[e+1]=4*t+1,i.uint16[e+2]=4*t+2,i.uint16[e+3]=4*t+2,i.uint16[e+4]=4*t+3,i.uint16[e+5]=4*t+0}return i}(d));const _=a.createIndexBuffer(HS,!0),y=a.createVertexBuffer(m,Ig.members,!0);for(const e of h){const r={u_matrix:e.transform,u_inv_matrix:e.invTransform,u_camera_to_center_distance:(v=c).getCameraToCenterDistance(e.projection),u_viewport_size:[v.width,v.height]};f.draw(t,l.TRIANGLES,Rv.disabled,Ov.disabled,t.colorModeForRenderPass(),Lv.disabled,r,i.id,y,_,Ql.simpleSegment(0,2*e.circleOffset,e.circleArray.length,e.circleArray.length/2),null,c.zoom)}var v;y.destroy(),_.destroy()}const WS=Jh.create();function $S({width:t,height:e,anchor:i,textOffset:r,textScale:n},o){const{horizontalAlign:s,verticalAlign:a}=Kg(i),l=-(s-.5)*t,c=-(a-.5)*e,u=M_(i,r);return new v((l/n+u[0])*o,(c/n+u[1])*o)}function YS(t,e,i,r,n,o,s,a,l,c,u){const h=t.text.placedSymbolArray,d=t.text.dynamicLayoutVertexArray,p=t.icon.dynamicLayoutVertexArray,f={},m=t.getProjection(),g=$T(a,m,o),_=o.elevation,y=m.upVectorScale(a.canonical,o.center.lat,o.worldSize).metersToTile;d.clear();for(let p=0;p<h.length;p++){const v=h.get(p),{tileAnchorX:x,tileAnchorY:b,numGlyphs:w}=v,T=v.hidden||!v.crossTileID||t.allowVerticalPlacement&&!v.placedOrientation?null:r[v.crossTileID];if(T){let r=0,h=0,p=0;if(_){const t=_?_.getAtTileOffset(a,x,b):0,[e,i,n]=m.upVector(a.canonical,x,b);r=t*e*y,h=t*i*y,p=t*n*y}let[E,S,A,M]=px(v.projectedAnchorX+r,v.projectedAnchorY+h,v.projectedAnchorZ+p,i?g:s);const I=fx(o.getCameraToCenterDistance(m),M);let C=n.evaluateSizeForFeature(t.textSizeData,c,v)*I/24;i&&(C*=t.tilePixelRatio/l);const P=$S(T,C);i?(({x:E,y:S,z:A}=m.projectTilePoint(x+P.x,b+P.y,a.canonical)),[E,S,A]=px(E+r,S+h,A+p,s)):(e&&P._rotate(-o.angle),E+=P.x,S+=P.y,A=0);const R=t.allowVerticalPlacement&&v.placedOrientation===Gg.vertical?Math.PI/2:0;for(let t=0;t<w;t++)xy(d,E,S,A,R);u&&v.associatedIconIndex>=0&&(f[v.associatedIconIndex]={x:E,y:S,z:A,angle:R})}else Tx(w,d)}if(u){p.clear();const e=t.icon.placedSymbolArray;for(let t=0;t<e.length;t++){const i=e.get(t),{numGlyphs:r}=i,n=f[t];if(i.hidden||!n)Tx(r,p);else{const{x:t,y:e,z:i,angle:o}=n;for(let n=0;n<r;n++)xy(p,t,e,i,o)}}t.icon.dynamicLayoutVertexBuffer.updateData(p)}t.text.dynamicLayoutVertexBuffer.updateData(d)}function ZS(t,e,i){return i.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function KS(t,e,i,r,n,o,s,a,l,c,u,h,d){const p=t.context,f=p.gl,m=t.transform,g="map"===a,_="map"===l,y=g&&"point"!==i.layout.get("symbol-placement"),v=g&&!_&&!y,x=void 0!==i.layout.get("symbol-sort-key").constantOr(1);let b=!1;const w=t.depthModeForSublayer(0,Rv.ReadOnly),T=[_p(m.center.lng),yp(m.center.lat)],E=i.layout.get("text-variable-anchor"),S="globe"===m.projection.name,A=[],M=[0,-1,0];let I=M;!S&&!m.mercatorFromTransition||g||(I=function(t){const e=t._camera.getWorldToCamera(t.worldSize,1),i=Jh.multiply([],e,t.globeMatrix);Jh.invert(i,i);const r=[0,0,0],n=[0,1,0,0];return Xh.transformMat4(n,n,i),r[0]=n[0],r[1]=n[1],r[2]=n[2],nd.normalize(r,r),r}(m));for(const a of r){const r=e.getTile(a),l=r.getBucket(i);if(!l)continue;if("mercator"===l.projection.name&&S)continue;const h=n?l.text:l.icon;if(!h||l.fullyClipped||!h.segments.get().length)continue;const d=h.programConfigurations.get(i.id),p=n||l.sdfIcons,w=n?l.textSizeData:l.iconSizeData,C=_||0!==m.pitch,P=Og(w,m.zoom);let R,O,D,L,k=[0,0],B=null;if(n)O=r.glyphAtlasTexture?r.glyphAtlasTexture:null,D=f.LINEAR,R=r.glyphAtlasTexture?r.glyphAtlasTexture.size:[0,0],l.iconsInText&&(k=r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],B=r.imageAtlasTexture?r.imageAtlasTexture:null,L=C||t.options.rotating||t.options.zooming||"composite"===w.kind||"camera"===w.kind?f.LINEAR:f.NEAREST);else{const e=1!==i.layout.get("icon-size").constantOr(0)||l.iconsNeedLinear;O=r.imageAtlasTexture?r.imageAtlasTexture:null,D=p||t.options.rotating||t.options.zooming||e||C?f.LINEAR:f.NEAREST,R=r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0]}const F="globe"===l.projection.name,z=F?I:M,N=F?tp(m.zoom):0,U=$T(a,l.getProjection(),m),G=m.calculatePixelsToTileUnitsMatrix(r),j=ux(U,r.tileID.canonical,_,g,m,l.getProjection(),G),V=t.terrain&&_&&y?Jh.invert(Jh.create(),j):WS,X=dx(U,r.tileID.canonical,_,g,m,l.getProjection(),G),H=E&&l.hasTextData(),q=l.hasIconTextFit()&&H&&l.hasIconData();if(y){const e=m.elevation,i=e?e.getAtTileOffsetFunc(a,m.center.lat,m.worldSize,l.getProjection()):null,o=hx(U,r.tileID.canonical,_,g,m,l.getProjection(),G);gx(l,U,t,n,o,X,_,c,i,a)}const W=y||n&&E||q,$=t.translatePosMatrix(U,r,o,s),Y=W?WS:j,Z=t.translatePosMatrix(X,r,o,s,!0),K=l.getProjection().createInversionMatrix(m,a.canonical),J=i.paint.get("icon-image-cross-fade").constantOr(0),Q=[];t.terrainRenderModeElevated()&&_&&Q.push("PITCH_WITH_MAP_TERRAIN"),F&&(Q.push("PROJECTION_GLOBE_VIEW"),W&&Q.push("PROJECTED_POS_ON_VIEWPORT")),J>0&&Q.push("ICON_TRANSITION"),h.zOffsetVertexBuffer&&Q.push("Z_OFFSET");const tt=p&&0!==i.paint.get(n?"text-halo-width":"icon-halo-width").constantOr(1);let et;p?et=l.iconsInText?OS(w.kind,P,v,_,t,$,Y,Z,R,k,a,N,T,K,z,l.getProjection()):RS(w.kind,P,v,_,t,$,Y,Z,n,R,!0,a,N,T,K,z,l.getProjection()):(u<1&&Q.push("SATURATION"),et=PS(w.kind,P,v,_,t,$,Y,Z,n,R,a,N,T,K,z,l.getProjection(),u,J));const it={program:t.getOrCreateProgram(ZS(p,n,l),{config:d,defines:Q}),buffers:h,uniformValues:et,atlasTexture:O,atlasTextureIcon:B,atlasInterpolation:D,atlasInterpolationIcon:L,isSDF:p,hasHalo:tt,tile:r,labelPlaneMatrixInv:V};if(x&&l.canOverlap){b=!0;const t=h.segments.get();for(const e of t)A.push({segments:new Ql([e]),sortKey:e.sortKey,state:it})}else A.push({segments:h.segments,sortKey:0,state:it})}b&&A.sort((t,e)=>t.sortKey-e.sortKey);for(const e of A){const r=e.state;if(t.terrain&&t.terrain.setupElevationDraw(r.tile,r.program,{useDepthForOcclusion:m.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:r.labelPlaneMatrixInv}),p.activeTexture.set(f.TEXTURE0),r.atlasTexture&&r.atlasTexture.bind(r.atlasInterpolation,f.CLAMP_TO_EDGE),r.atlasTextureIcon&&(p.activeTexture.set(f.TEXTURE1),r.atlasTextureIcon&&r.atlasTextureIcon.bind(r.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),t.uploadCommonLightUniforms(t.context,r.program),r.hasHalo){const n=r.uniformValues;n.u_is_halo=1,JS(r.buffers,e.segments,i,t,r.program,w,h,d,n,2),n.u_is_halo=0}else{if(r.isSDF){const n=r.uniformValues;r.hasHalo&&(n.u_is_halo=1,JS(r.buffers,e.segments,i,t,r.program,w,h,d,n,1)),n.u_is_halo=0}JS(r.buffers,e.segments,i,t,r.program,w,h,d,r.uniformValues,1)}}}function JS(t,e,i,r,n,o,s,a,l,c){const u=[t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer,t.iconTransitioningVertexBuffer,t.globeExtVertexBuffer,t.zOffsetVertexBuffer];n.draw(r,r.context.gl.TRIANGLES,o,s,a,Lv.disabled,l,i.id,t.layoutVertexBuffer,t.indexBuffer,e,i.paint,r.transform.zoom,t.programConfigurations.get(i.id),u,c)}function QS(t,e,i,r,n,o,s){const a=t.context.gl,l=i.paint.get("fill-pattern"),c=l&&l.constantOr(1);let u,h,d,p,f;s?(h=c&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",u=a.LINES):(h=c?"fillPattern":"fill",u=a.TRIANGLES);for(const m of r){const r=e.getTile(m);if(c&&!r.patternsLoaded())continue;const g=r.getBucket(i);if(!g)continue;t.prepareDrawTile();const _=g.programConfigurations.get(i.id),y=t.isTileAffectedByFog(m),v=t.getOrCreateProgram(h,{config:_,overrideFog:y});c&&(t.context.activeTexture.set(a.TEXTURE0),r.imageAtlasTexture&&r.imageAtlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),_.updatePaintBuffers());const x=l.constantOr(null);if(x&&r.imageAtlas){const t=r.imageAtlas.patternPositions[x.toString()];t&&_.setConstantPatternPositions(t)}const b=t.translatePosMatrix(m.projMatrix,r,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor")),w=i.paint.get("fill-emissive-strength");if(s){p=g.indexBuffer2,f=g.segments2;const e=t.terrain&&t.terrain.renderingToTexture?t.terrain.drapeBufferSize:[a.drawingBufferWidth,a.drawingBufferHeight];d="fillOutlinePattern"===h&&c?xS(b,w,t,r,e):vS(b,w,e)}else p=g.indexBuffer,f=g.segments,d=c?yS(b,w,t,r):_S(b,w);t.uploadCommonUniforms(t.context,v,m.toUnwrapped()),v.draw(t,u,n,t.stencilModeForClipping(m),o,Lv.disabled,d,i.id,g.layoutVertexBuffer,p,f,i.paint,t.transform.zoom,_,void 0)}}function tA(t,e,i,r,n,o,s,a){i.resetLayerRenderingStats();const l=t.context,c=l.gl,u=t.transform,h=i.paint.get("fill-extrusion-pattern"),d=h.constantOr(1),p=i.paint.get("fill-extrusion-opacity"),f=t.style.enable3dLights(),m=i.paint.get(f&&!d?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),g=[i.paint.get("fill-extrusion-ambient-occlusion-intensity"),m],_=i.layout.get("fill-extrusion-edge-radius"),y=_>0&&!i.paint.get("fill-extrusion-rounded-roof"),v=y?0:_,x="globe"===u.projection.name?Rb():0,b="globe"===u.projection.name,w=b?tp(u.zoom):0,T=[_p(u.center.lng),yp(u.center.lat)],E=i.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),S=i.paint.get("fill-extrusion-flood-light-intensity"),A=i.paint.get("fill-extrusion-vertical-scale"),M=ZE(t,i.paint.get("fill-extrusion-cutoff-fade-range")),I=i.paint.get("fill-extrusion-emissive-strength"),C=[];let P;b&&C.push("PROJECTION_GLOBE_VIEW"),g[0]>0&&C.push("FAUX_AO"),y&&C.push("ZERO_ROOF_RADIUS"),a&&C.push("HAS_CENTROID"),S>0&&C.push("FLOOD_LIGHT"),M.shouldRenderCutoff&&C.push("RENDER_CUTOFF");const R="shadow"===t.renderPass,O=t.shadowRenderer,D=R&&!!O;t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!0);let L=[0,0,0];if(O){const e=t.style.directionalLight,i=t.style.ambientLight;e&&i&&(L=$A(e,i)),P=C.concat(["SHADOWS_SINGLE_CASCADE"])}const k=D?"fillExtrusionDepth":d?"fillExtrusionPattern":"fillExtrusion",B=i.getLayerRenderingStats();for(const f of r){const r=e.getTile(f),m=r.getBucket(i);if(!m||m.projection.name!==u.projection.name)continue;let _=!1;O&&(_=0===O.getMaxCascadeForTile(f.toUnwrapped()));const y=t.isTileAffectedByFog(f),D=m.programConfigurations.get(i.id),F=t.getOrCreateProgram(k,{config:D,defines:_?P:C,overrideFog:y});if(t.terrain&&t.terrain.setupElevationDraw(r,F,{useMeterToDem:!0}),!m.centroidVertexBuffer){const t=F.attributes.a_centroid_pos;void 0!==t&&c.vertexAttrib2f(t,0,0)}!R&&O&&O.setupShadows(r.tileID.toUnwrapped(),F,"vector-tile",r.tileID.overscaledZ),d&&(t.context.activeTexture.set(c.TEXTURE0),r.imageAtlasTexture&&r.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),D.updatePaintBuffers());const z=h.constantOr(null);if(z&&r.imageAtlas){const t=r.imageAtlas.patternPositions[z.toString()];t&&D.setConstantPatternPositions(t)}const N=i.paint.get("fill-extrusion-vertical-gradient");let U;if(R&&O){if(sA(r.tileID,m,t))continue;const e=O.calculateShadowPassMatrixFromTile(r.tileID.toUnwrapped());U=mS(e,v,A)}else{const e=t.translatePosMatrix(f.expandedProjMatrix,r,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),n=u.projection.createInversionMatrix(u,f.canonical);U=d?gS(e,t,N,p,g,v,f,r,x,w,T,n,E,A):fS(e,t,N,p,g,v,f,x,w,T,n,E,A,S,L,I)}t.uploadCommonUniforms(l,F,f.toUnwrapped(),null,M);let G=m.segments;if("mercator"===u.projection.name&&!R&&(G=m.getVisibleSegments(r.tileID,t.terrain,t.transform.getFrustum(0)),!G.get().length))continue;if(B)if(R)for(const t of G.get())B.numRenderedVerticesInShadowPass+=t.primitiveLength;else for(const t of G.get())B.numRenderedVerticesInTransparentPass+=t.primitiveLength;const j=[];(t.terrain||a)&&j.push(m.centroidVertexBuffer),b&&j.push(m.layoutVertexExtBuffer),F.draw(t,l.gl.TRIANGLES,n,o,s,Lv.backCCW,U,i.id,m.layoutVertexBuffer,m.indexBuffer,G,i.paint,t.transform.zoom,D,j)}t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!1)}function eA(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,_,y){const v=t.context,x=v.gl,b=t.transform,w=t.transform.zoom,T=[],E=ZE(t,i.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===c?(T.push("CLEAR_SUBPASS"),y&&(T.push("CLEAR_FROM_TEXTURE"),v.activeTexture.set(x.TEXTURE0),y.bind(x.LINEAR,x.CLAMP_TO_EDGE))):"sdf"===c&&T.push("SDF_SUBPASS"),g&&T.push("HAS_CENTROID"),E.shouldRenderCutoff&&T.push("RENDER_CUTOFF");const S=i.layout.get("fill-extrusion-edge-radius"),A=(e,r,c,_,x)=>{const b=r.programConfigurations.get(i.id),A=t.isTileAffectedByFog(e),M=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:b,defines:T,overrideFog:A}),I=((t,e,i,r,n,o,s,a,l,c,u)=>({u_matrix:e,u_opacity:i,u_ao_pass:r?1:0,u_meter_to_tile:n,u_ao:o,u_flood_light_intensity:s,u_flood_light_color:a,u_attenuation:l,u_edge_radius:c,u_fb:0,u_fb_size:u}))(0,_,u,l,x,[h,d*x],p,f,m,w>=17?0:S*x,y?y.size[0]:0),C=[];g&&C.push(r.hiddenByLandmarkVertexBuffer),t.uploadCommonUniforms(v,M,e.toUnwrapped(),null,E),M.draw(t,v.gl.TRIANGLES,n,o,s,a,I,i.id,r.vertexBuffer,r.indexBuffer,c,i.paint,w,b,C)};for(const n of r){const r=e.getTile(n),o=r.getBucket(i);if(!o||o.projection.name!==b.projection.name||!o.groundEffect||o.groundEffect&&!o.groundEffect.hasData())continue;const s=o.groundEffect,a=1/o.tileToMeter;{const e=t.translatePosMatrix(n.projMatrix,r,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),o=s.getDefaultSegment();A(n,s,o,e,a)}if(_)for(let o=0;o<4;o++){const s=yd[o](n),l=e.getTile(s);if(!l)continue;const c=l.getBucket(i);if(!c||c.projection.name!==b.projection.name||!c.groundEffect||c.groundEffect&&!c.groundEffect.hasData())continue;const u=c.groundEffect;let h,d;0===o?(h=[-ur,0,0],d=1):1===o?(h=[ur,0,0],d=0):2===o?(h=[0,-ur,0],d=3):(h=[0,ur,0],d=2);const p=u.regionSegments[d];if(!p)continue;const f=new Float32Array(16);Jh.translate(f,n.projMatrix,h),A(n,u,p,t.translatePosMatrix(f,r,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),a)}}}function iA(t,e,i,r,n,o,s){0===r.centroidVertexArray.length&&r.createCentroidsBuffer();const a=o?o.findDEMTileFor(i):null;if(!(a&&a.dem||s))return;const l=t=>{const i=e.getSource().minzoom,r=t=>{const i=e.getTileByID(t);if(i&&i.hasData())return i.getBucket(n)},o=[0,-1,1];for(const e of o){if(t.overscaledZ+e<i)continue;const n=r(t.calculateScaledKey(t.overscaledZ+e));if(n)return n}},c=[0,0,0],u=(t,e)=>(c[0]=Math.min(t.min.y,e.min.y),c[1]=Math.max(t.max.y,e.max.y),c[2]=ur-e.min.x>t.max.x?e.min.x-ur:t.max.x,c),h=(t,e)=>(c[0]=Math.min(t.min.x,e.min.x),c[1]=Math.max(t.max.x,e.max.x),c[2]=ur-e.min.y>t.max.y?e.min.y-ur:t.max.y,c),d=[(t,e)=>u(t,e),(t,e)=>u(e,t),(t,e)=>h(t,e),(t,e)=>h(e,t)],p=(t,e,r,n,s,l,c)=>{if(!o)return 0;const u=[[l?r:t,l?t:r,0],[l?r:e,l?e:r,0]],h=c<0?ur+c:c,d=[l?h:(t+e)/2,l?(t+e)/2:h,0];return 0===r&&c<0||0!==r&&c>0?o.getForTilePoints(s,[d],!0,n):u.push(d),o.getForTilePoints(i,u,!0,a),Math.max(u[0][2],u[1][2],d[2])/o.exaggeration()};for(let t=0;t<4;t++){const e=r.borderFeatureIndices[t];if(0===e.length)continue;const n=yd[t](i),a=l(n);if(!(a&&a instanceof Tb))continue;if(r.borderDoneWithNeighborZ[t]===a.canonical.z)continue;0===a.centroidVertexArray.length&&a.createCentroidsBuffer();const c=o?o.findDEMTileFor(n):null;if(!(c&&c.dem||s))continue;const u=(t<2?1:5)-t,h=a.borderDoneWithNeighborZ[u]!==r.canonical.z,_=a.borderFeatureIndices[u];let y=0;if(r.canonical.z!==a.canonical.z){for(const t of e)r.showCentroid(r.featuresOnBorder[t]);if(h)for(const t of _)a.showCentroid(a.featuresOnBorder[t]);r.borderDoneWithNeighborZ[t]=a.canonical.z,a.borderDoneWithNeighborZ[u]=r.canonical.z}for(const i of e){const e=r.featuresOnBorder[i],o=r.centroidData[e.centroidDataIndex],l=e.borders[t];let h;for(;y<_.length;){h=a.featuresOnBorder[_[y]];const t=h.borders[u];if(t[1]>l[0]+3||t[0]>l[0]-3)break;a.showCentroid(h),y++}if(h&&y<_.length){const i=y;let x=0;for(;!(h.borders[u][0]>l[1]-3)&&(x++,++y!==_.length);)h=a.featuresOnBorder[_[y]];if(h=a.featuresOnBorder[_[i]],x>1){const t=h.borders[u];Math.abs(l[0]-t[0])<3&&Math.abs(l[1]-t[1])<3&&(x=1,y=i+1)}else if(0===x){r.showCentroid(e);continue}const b=a.centroidData[h.centroidDataIndex];s&&1===x&&(((m=o).flags|(g=b).flags)&db?(m.flags|=db,g.flags|=db):(m.flags&=2147483647,g.flags&=2147483647));let w=new v(0,0);if(x>1)y=i;else if(c&&c.dem&&!(e.intersectsCount()>1||h.intersectsCount()>1)){const e=d[t](o,b),i=t%2?8191:0;f=p(e[0],Math.min(8191,e[1]),i,c,n,t<2,e[2]),w=new v(Math.ceil(7*(f+450)),0)}o.centroidXY=b.centroidXY=w,r.writeCentroidToBuffer(o),a.writeCentroidToBuffer(b)}else r.showCentroid(e)}r.borderDoneWithNeighborZ[t]=a.canonical.z,a.borderDoneWithNeighborZ[u]=r.canonical.z}var f,m,g;(r.needsCentroidUpdate||!r.centroidVertexBuffer&&0!==r.centroidVertexArray.length)&&r.uploadCentroid(t)}const rA=[1,0,0],nA=[0,1,0],oA=[0,0,1];function sA(t,e,i){const r=i.transform,n=i.shadowRenderer;if(!n)return!0;const o=t.toUnwrapped(),s=r.tileSize*n._cascades[i.currentShadowCascade].scale;let a=e.maxHeight;if(r.elevation){const e=r.elevation.getMinMaxForTile(t);e&&(a+=e.max)}const l=[...n.shadowDirection];l[2]=-l[2];const c=n.computeSimplifiedTileShadowVolume(o,a,s,l);if(!c)return!1;const u=[rA,nA,oA,l,[l[0],0,l[2]],[0,l[1],l[2]]],h="globe"===r.projection.name,d=r.scaleZoom(s),p=Sd.fromInvProjectionMatrix(r.invProjMatrix,r.worldSize,d,!h),f=n.getCurrentCascadeFrustum();return 0===p.intersectsPrecise(c.vertices,c.planes,u)||0===f.intersectsPrecise(c.vertices,c.planes,u)}function aA(t){const e=t._nearZ,i=t.projection.farthestPixelDistance(t),r=i-e,n=.2*t.height,o=e+n;return[e,i,(o-n-e)/r,(o-e)/r]}const lA=new hi(1,0,0,1),cA=new hi(0,1,0,1),uA=new hi(0,0,1,1),hA=new hi(1,0,1,1),dA=new hi(0,1,1,1);function pA(t,e,i){const r=t.context,n=t.transform,o=r.gl,s="globe"===n.projection.name,a=s?["PROJECTION_GLOBE_VIEW"]:[];let l=i.projMatrix;if(s&&tp(n.zoom)>0){const t=Yd(zd(i.canonical,n));l=Jh.multiply(new Float32Array(16),n.globeMatrix,t),Jh.multiply(l,n.projMatrix,l)}const c=t.getOrCreateProgram("debug",{defines:a}),u=e.getTileByID(i.key);t.terrain&&t.terrain.setupElevationDraw(u,c);const h=Rv.disabled,d=Ov.disabled,p=t.colorModeForRenderPass(),f="$debug";r.activeTexture.set(o.TEXTURE0),t.emptyTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s?u._makeGlobeTileDebugBuffers(t.context,n):u._makeDebugTileBoundsBuffers(t.context,n.projection);const m=u._tileDebugBuffer||t.debugBuffer,g=u._tileDebugIndexBuffer||t.debugIndexBuffer,_=u._tileDebugSegments||t.debugSegments;c.draw(t,o.LINE_STRIP,h,d,p,Lv.disabled,wS(l,hi.red),f,m,g,_,null,null,null,[u._globeTileDebugBorderBuffer]);const y=u.latestRawTileData,v=Math.floor((y&&y.byteLength||0)/1024),x=e.getTile(i).tileSize,b=512/Math.min(x,512)*(i.overscaledZ/n.zoom)*.5;let w=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(w+=" => "+i.overscaledZ),w+=` ${v}kb`,function(t,e){t.initDebugOverlayCanvas();const i=t.debugOverlayCanvas,r=t.context.gl,n=t.debugOverlayCanvas.getContext("2d");n.clearRect(0,0,i.width,i.height),n.shadowColor="white",n.shadowBlur=2,n.lineWidth=1.5,n.strokeStyle="white",n.textBaseline="top",n.font="bold 36px Open Sans, sans-serif",n.fillText(e,5,5),n.strokeText(e,5,5),t.debugOverlayTexture.update(i),t.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(t,w);const T=u._tileDebugTextBuffer||t.debugBuffer,E=u._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,S=u._tileDebugTextSegments||t.debugSegments;c.draw(t,o.TRIANGLES,h,d,Dv.alphaBlended,Lv.disabled,wS(l,hi.transparent,b),f,T,E,S,null,null,null,[u._globeTileDebugTextBuffer])}function fA(t,e,i,r){gA(t,0,e+i/2,t.transform.width,i,r)}function mA(t,e,i,r){gA(t,e-i/2,0,i,t.transform.height,r)}function gA(t,e,i,r,n,o){const s=t.context,a=s.gl;a.enable(a.SCISSOR_TEST),a.scissor(e*pe.devicePixelRatio,i*pe.devicePixelRatio,r*pe.devicePixelRatio,n*pe.devicePixelRatio),s.clear({color:o}),a.disable(a.SCISSOR_TEST)}const _A=ll([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:yA}=_A;function vA(t,e,i,r){t.emplaceBack(e,i,r)}class xA{constructor(t){this.vertexArray=new kl,this.indices=new Ml,vA(this.vertexArray,-1,-1,1),vA(this.vertexArray,1,-1,1),vA(this.vertexArray,-1,1,1),vA(this.vertexArray,1,1,1),vA(this.vertexArray,-1,-1,-1),vA(this.vertexArray,1,-1,-1),vA(this.vertexArray,-1,1,-1),vA(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,yA),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=Ql.simpleSegment(0,0,36,12)}}function bA(t,e,i,r,n,o){const s=t.context.gl,a=e.paint.get("sky-atmosphere-color"),l=e.paint.get("sky-atmosphere-halo-color"),c=e.paint.get("sky-atmosphere-sun-intensity"),u=((t,e,i,r,n)=>({u_matrix_3f:t,u_sun_direction:e,u_sun_intensity:i,u_color_tint_r:[r.r,r.g,r.b,r.a],u_color_tint_m:[n.r,n.g,n.b,n.a],u_luminance:5e-5}))(Zh.fromMat4(Zh.create(),r),n,c,a,l);s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+o,e.skyboxTexture,0),i.draw(t,s.TRIANGLES,Rv.disabled,Ov.disabled,Dv.unblended,Lv.frontCW,u,"skyboxCapture",e.skyboxGeometry.vertexBuffer,e.skyboxGeometry.indexBuffer,e.skyboxGeometry.segment)}const wA=ll([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class TA{constructor(t){const e=new Rl;e.emplaceBack(-1,1,1,0,0),e.emplaceBack(1,1,1,1,0),e.emplaceBack(1,-1,1,1,1),e.emplaceBack(-1,-1,1,0,1);const i=new Ml;i.emplaceBack(0,1,2),i.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(e,wA.members),this.indexBuffer=t.createIndexBuffer(i),this.segments=Ql.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const EA=ll([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class SA{constructor(){this.colorModeAlphaBlendedWriteRGB=new Dv([1,771,1,771],hi.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Dv([1,0,1,0],hi.transparent,[!1,!1,!1,!0])}update(t){const e=t.context;if(!this.atmosphereBuffer){this.atmosphereBuffer=new TA(e);const t=100,i=200,r=function(t){const e=Vn(30),i=[];for(let t=0;t<16e3;++t){const t=2*Math.PI*e(),r=Math.acos(1-2*e())-.5*Math.PI;i.push(nd.fromValues(Math.cos(r)*Math.cos(t),Math.cos(r)*Math.sin(t),Math.sin(r)))}return i}(),n=Vn(300),o=new Ol,s=new Ml;let a=0;for(let e=0;e<r.length;++e){const l=nd.scale([],r[e],200),c=Math.max(0,1+.01*t*(1*n()-.5)),u=Math.max(0,1+.01*i*(1*n()-.5));o.emplaceBack(l[0],l[1],l[2],-1,-1,c,u),o.emplaceBack(l[0],l[1],l[2],1,-1,c,u),o.emplaceBack(l[0],l[1],l[2],1,1,c,u),o.emplaceBack(l[0],l[1],l[2],-1,1,c,u),s.emplaceBack(a+0,a+1,a+2),s.emplaceBack(a+0,a+2,a+3),a+=4}this.starsVx=e.createVertexBuffer(o,EA.members),this.starsIdx=e.createIndexBuffer(s),this.starsSegments=Ql.simpleSegment(0,0,o.length,s.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,e){const i=t.context,r=i.gl,n=t.transform,o=new Rv(r.LEQUAL,Rv.ReadOnly,[0,1]),s=tp(n.zoom),a=e.properties.get("color").toArray01(),l=e.properties.get("high-color").toArray01(),c=e.properties.get("space-color").toArray01PremultipliedAlpha(),u=5e-4,h=R((e.properties.get("horizon-blend")-0)/1*.2495+u,5e-4,.25),d=ip(t,i,n)&&h===u?n.worldSize/(2*Math.PI*1.025)-1:n.globeRadius,p=t.frameCounter/1e3%1,f=nd.length(n.globeCenterInViewSpace),m=Math.sqrt(Math.pow(f,2)-Math.pow(d,2)),g=Math.acos(m/f),_=e=>{const u="globe"===n.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];e&&u.push("ALPHA_PASS");const d=t.getOrCreateProgram("globeAtmosphere",{defines:u}),f=((t,e,i,r,n,o,s,a,l,c,u,h)=>({u_frustum_tl:t,u_frustum_tr:e,u_frustum_br:i,u_frustum_bl:r,u_horizon:n,u_transition:o,u_fadeout_range:s,u_color:a,u_high_color:l,u_space_color:c,u_temporal_offset:u,u_horizon_angle:h}))(n.frustumCorners.TL,n.frustumCorners.TR,n.frustumCorners.BR,n.frustumCorners.BL,n.frustumCorners.horizon,s,h,a,l,c,p,g);t.uploadCommonUniforms(i,d);const m=this.atmosphereBuffer;m&&d.draw(t,r.TRIANGLES,o,Ov.disabled,e?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Lv.backCW,f,e?"atmosphere_glow_alpha":"atmosphere_glow",m.vertexBuffer,m.indexBuffer,m.segments)};_(!1),_(!0)}drawStars(t,e){const i=R(e.properties.get("star-intensity"),0,1);if(0===i)return;const r=t.context,n=r.gl,o=t.transform,s=t.getOrCreateProgram("stars"),a=td.identity([]);td.rotateX(a,a,-o._pitch),td.rotateZ(a,a,-o.angle),td.rotateX(a,a,T(o._center.lat)),td.rotateY(a,a,-T(o._center.lng));const l=Jh.fromQuat(new Float32Array(16),a),c=Jh.multiply([],o.starsProjMatrix,l),u=Zh.fromMat4([],l),h=Zh.invert([],u),d=[0,1,0];nd.transformMat3(d,d,h),nd.scale(d,d,.15);const p=[1,0,0];nd.transformMat3(p,p,h),nd.scale(p,p,.15);const f=((t,e,i,r)=>({u_matrix:Float32Array.from(t),u_up:e,u_right:i,u_intensity_multiplier:r}))(c,d,p,i);t.uploadCommonUniforms(r,s),this.starsVx&&this.starsIdx&&s.draw(t,n.TRIANGLES,Rv.disabled,Ov.disabled,this.colorModeAlphaBlendedWriteRGB,Lv.disabled,f,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function AA(t,e){const i=[...t],r=e.cameraWorldSizeForFog/e.worldSize,n=Jh.identity([]);return Jh.scale(n,n,[r,r,1]),Jh.multiply(i,n,i),Jh.multiply(i,e.worldToFogMatrix,i),i}function MA(t,e,i,r){const n=i.material,o=r.context,{baseColorTexture:s,metallicRoughnessTexture:a}=n.pbrMetallicRoughness,{normalTexture:l,occlusionTexture:c,emissionTexture:u}=n;function h(e,i,r){if(e&&(t.push(i),o.activeTexture.set(o.gl.TEXTURE0+r),e.gfxTexture)){const{minFilter:t,magFilter:i,wrapS:r,wrapT:n}=e.sampler;e.gfxTexture.bindExtraParam(t,i,r,n)}}h(s,"HAS_TEXTURE_u_baseColorTexture",kS),h(a,"HAS_TEXTURE_u_metallicRoughnessTexture",BS),h(l,"HAS_TEXTURE_u_normalTexture",FS),h(c,"HAS_TEXTURE_u_occlusionTexture",zS),h(u,"HAS_TEXTURE_u_emissionTexture",NS),i.texcoordBuffer&&(t.push("HAS_ATTRIBUTE_a_uv_2f"),e.push(i.texcoordBuffer)),i.colorBuffer&&(t.push(12===i.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),e.push(i.colorBuffer)),i.normalBuffer&&(t.push("HAS_ATTRIBUTE_a_normal_3f"),e.push(i.normalBuffer)),i.pbrBuffer&&(t.push("HAS_ATTRIBUTE_a_pbr"),t.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),e.push(i.pbrBuffer)),"OPAQUE"!==n.alphaMode&&"MASK"!==n.alphaMode||t.push("UNPREMULT_TEXTURE_IN_SHADER"),n.defined||t.push("DIFFUSE_SHADED"),t.push("USE_STANDARD_DERIVATIVES")}function IA(t,e,i,r,n,o){const s=i.paint.get("model-opacity"),a=e.context,l=new Rv(e.context.gl.LEQUAL,Rv.ReadWrite,e.depthRangeFor3D),c=e.transform,u=t.mesh,h=u.material,d=h.pbrMetallicRoughness,p=e.style.fog;let f;f="pixels"===e.transform.projection.zAxisUnit?[...t.nodeModelMatrix]:Jh.multiply([],r.zScaleMatrix,t.nodeModelMatrix),Jh.multiply(f,r.negCameraPosMatrix,f);const m=Jh.invert([],f);Jh.transpose(m,m);const g=i.paint.get("model-emissive-strength").constantOr(0),_=GS(new Float32Array(t.worldViewProjection),new Float32Array(f),new Float32Array(m),e,s,d.baseColorFactor,h.emissiveFactor,d.metallicFactor,d.roughnessFactor,h,g,i),y={defines:[]},v=[];MA(y.defines,v,u,e);const x=e.shadowRenderer;x&&(x.useNormalOffset=!1);let b=null;if(p){const i=AA(t.nodeModelMatrix,e.transform);if(b=new Float32Array(i),"globe"!==c.projection.name){const t=u.aabb.min,e=u.aabb.max,[r,n]=p.getOpacityForBounds(i,t[0],t[1],e[0],e[1]);y.overrideFog=r>=mw||n>=mw}}const w=ZE(e,i.paint.get("model-cutoff-fade-range"));w.shouldRenderCutoff&&y.defines.push("RENDER_CUTOFF");const T=e.getOrCreateProgram("model",y);e.uploadCommonUniforms(a,T,null,b,w),"shadow"!==e.renderPass&&x&&x.setupShadowsFromMatrix(t.nodeModelMatrix,T),T.draw(e,a.gl.TRIANGLES,l,n,o,u.material.doubleSided?Lv.disabled:Lv.backCCW,_,i.id,u.vertexBuffer,u.indexBuffer,u.segments,i.paint,e.transform.zoom,void 0,v)}function CA(t,e,i,r,n,o,s){let a;a="globe"===t.projection.name?Px(i,t):[...i],Jh.multiply(a,a,e.matrix);const l=Jh.multiply([],r,a);if(e.meshes)for(const t of e.meshes){if("BLEND"!==t.material.alphaMode){s.push({mesh:t,depth:0,modelIndex:n,worldViewProjection:l,nodeModelMatrix:a});continue}const e=nd.transformMat4([],t.centroid,l);e[2]>0&&o.push({mesh:t,depth:e[2],modelIndex:n,worldViewProjection:l,nodeModelMatrix:a})}if(e.children)for(const a of e.children)CA(t,a,i,r,n,o,s)}function PA(t,e,i,r){const n=i.shadowRenderer;if(!n)return;const o=n.getShadowPassDepthMode(),s=n.getShadowPassColorMode(),a=n.calculateShadowPassMatrixFromMatrix(e),l=VS(a);i.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(i,i.context.gl.TRIANGLES,o,Ov.disabled,s,Lv.backCCW,l,r.id,t.vertexBuffer,t.indexBuffer,t.segments,r.paint,i.transform.zoom,void 0,void 0)}function RA(t,e,i){const r=e.updateZoomBasedPaintProperties(),n=function(t,e,i){let r,n,o,s=t.terrain?t.terrain.exaggeration():0;if(t.terrain&&s>0){const e=t.terrain,n=e.findDEMTileFor(i);n&&n.dem?r=gg.create(e,i,n):s=0}if(0===s&&(e.terrainElevationMin=0,e.terrainElevationMax=0),s===e.validForExaggeration&&(0===s||r&&r._demTile&&r._demTile.tileID===e.validForDEMTile.id&&r._dem._timestamp===e.validForDEMTile.timestamp))return!1;for(const t in e.instancesPerModel){const i=e.instancesPerModel[t];for(let t=0;t<i.instancedDataArray.length;++t){const a=(r?s*r.getElevationAt(0|i.instancedDataArray.float32[16*t],0|i.instancedDataArray.float32[16*t+1],!0,!0):0)+i.instancesEvaluatedElevation[t];i.instancedDataArray.float32[16*t+6]=a,n=n?Math.min(e.terrainElevationMin,a):a,o=o?Math.max(e.terrainElevationMax,a):a}}return e.terrainElevationMin=n||0,e.terrainElevationMax=o||0,e.validForExaggeration=s,e.validForDEMTile=r&&r._demTile?{id:r._demTile.tileID,timestamp:r._dem._timestamp}:{id:void 0,timestamp:0},!0}(t,e,i);(r||n)&&(e.uploaded=!1,e.upload(t.context))}const OA={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new Ad([0,0,0],[ur,ur,0])};function DA(t,e){const i=1<<t.canonical.z,r=e.getFreeCameraOptions().position,n=e.elevation,o=t.canonical.x/i,s=(t.canonical.x+1)/i,a=t.canonical.y/i,l=(t.canonical.y+1)/i;let c=e._centerAltitude;if(n){const e=n.getMinMaxForTile(t);e&&e.max>c&&(c=e.max)}const u=R(r.x,o,s)-r.x,h=R(r.y,a,l)-r.y,d=vp(c,e.center.lat)-r.z;return e._zoomFromMercatorZ(Math.sqrt(u*u+h*h+d*d))}function LA(t,e,i,r,n,o,s){const a=t.context,l="shadow"===t.renderPass,c=t.shadowRenderer,u=l&&c?c.getShadowPassDepthMode():new Rv(a.gl.LEQUAL,Rv.ReadWrite,t.depthRangeFor3D),h=t.isTileAffectedByFog(o);if(i.meshes)for(const d of i.meshes){const p=["MODEL_POSITION_ON_GPU"],f=[];let m,g,_;r.instancedDataArray.length>20&&p.push("INSTANCED_ARRAYS");const y=ZE(t,e.paint.get("model-cutoff-fade-range"));if(y.shouldRenderCutoff&&p.push("RENDER_CUTOFF"),l&&c)m=t.getOrCreateProgram("modelDepth",{defines:p}),g=VS(s.shadowTileMatrix,s.shadowTileMatrix,Float32Array.from(i.matrix)),_=c.getShadowPassColorMode();else{MA(p,f,d,t),m=t.getOrCreateProgram("model",{defines:p,overrideFog:h});const r=d.material,l=r.pbrMetallicRoughness,u=e.paint.get("model-opacity"),v=e.paint.get("model-emissive-strength").constantOr(0);g=GS(o.expandedProjMatrix,Float32Array.from(i.matrix),new Float32Array(16),t,u,l.baseColorFactor,r.emissiveFactor,l.metallicFactor,l.roughnessFactor,r,v,e,n),c&&(s.shadowUniformsInitialized?m.setShadowUniformValues(a,c.getShadowUniformValues()):(c.setupShadows(o.toUnwrapped(),m,"model-tile",o.overscaledZ),s.shadowUniformsInitialized=!0)),_=y.shouldRenderCutoff||u<1||"OPAQUE"!==r.alphaMode?Dv.alphaBlended:Dv.unblended}t.uploadCommonUniforms(a,m,o.toUnwrapped(),null,y);const v=d.material.doubleSided?Lv.disabled:Lv.backCCW;if(r.instancedDataArray.length>20)f.push(r.instancedDataBuffer),m.draw(t,a.gl.TRIANGLES,u,Ov.disabled,_,v,g,e.id,d.vertexBuffer,d.indexBuffer,d.segments,e.paint,t.transform.zoom,void 0,f,r.instancedDataArray.length);else{const i=l?"u_instance":"u_normal_matrix";for(let n=0;n<r.instancedDataArray.length;++n)g[i]=new Float32Array(r.instancedDataArray.arrayBuffer,64*n,16),m.draw(t,a.gl.TRIANGLES,u,Ov.disabled,_,v,g,e.id,d.vertexBuffer,d.indexBuffer,d.segments,e.paint,t.transform.zoom,void 0,f)}}if(i.children)for(const a of i.children)LA(t,e,a,r,n,o,s)}const kA=[1,-1,1];function BA(t,e,i,r){if(!i.modelManager)return!0;const n=i.modelManager;if(!i.shadowRenderer)return!0;const o=i.shadowRenderer,s=e.aabb;let a=!0,l=t.maxHeight;if(0===l){let e=0;for(const i in t.instancesPerModel){const t=n.getModel(i,r);t?e=Math.max(e,Math.max(Math.max(t.aabb.max[0],t.aabb.max[1]),t.aabb.max[2])):a=!1}l=t.maxScale*e*1.41+t.maxVerticalOffset,a&&(t.maxHeight=l)}s.max[2]=l,s.min[2]+=t.terrainElevationMin,s.max[2]+=t.terrainElevationMax,nd.transformMat4(s.min,s.min,e.tileMatrix),nd.transformMat4(s.max,s.max,e.tileMatrix);const c=s.intersects(o.getCurrentCascadeFrustum());return 0===i.currentShadowCascade&&(t.isInsideFirstShadowMapFrustum=2===c),0===c}class FA{}class zA{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,e,i){{const i=this._storage.get(e.id);if(i)return i.lastUsedFrameIdx=t,i.buf}const r=i.gl,n=r.getBufferParameter(r.ELEMENT_ARRAY_BUFFER,r.BUFFER_SIZE),o=new ArrayBuffer(n),s=new Int16Array(o);r.getBufferSubData(r.ELEMENT_ARRAY_BUFFER,0,new Int16Array(o));const a=new wl;for(let t=0;t<n/2;t+=3){const e=s[t],i=s[t+1],r=s[t+2];a.emplaceBack(e,i),a.emplaceBack(i,r),a.emplaceBack(r,e)}const l=i.bindVertexArrayOES.current,c=new FA;return c.buf=new Xy(i,a),c.lastUsedFrameIdx=t,this._storage.set(e.id,c),i.bindVertexArrayOES.set(l),c.buf}update(t){for(const[e,i]of this._storage)t-i.lastUsedFrameIdx>30&&(i.buf.destroy(),this._storage.delete(e))}destroy(){for(const[t,e]of this._storage)e.buf.destroy(),this._storage.delete(t)}}const NA={symbol:function(t,e,i,r,n){if("translucent"!==t.renderPass)return;const o=Ov.disabled,s=t.colorModeForRenderPass();i.layout.get("text-variable-anchor")&&function(t,e,i,r,n,o,s){const a=e.transform,l="map"===n,c="map"===o;for(const e of t){const t=r.getTile(e),n=t.getBucket(i);if(!n||!n.text||!n.text.segments.get().length)continue;const o=Og(n.textSizeData,a.zoom),u=$T(e,n.getProjection(),a),h=a.calculatePixelsToTileUnitsMatrix(t),d=ux(u,t.tileID.canonical,c,l,a,n.getProjection(),h),p=n.hasIconTextFit()&&n.hasIconData();if(o){const i=Math.pow(2,a.zoom-t.tileID.overscaledZ);YS(n,l,c,s,Dg,a,d,e,i,o,p)}}}(r,t,i,e,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),n),0!==i.paint.get("icon-opacity").constantOr(1)&&KS(t,e,i,r,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright"),i.paint.get("icon-color-saturation"),o,s),0!==i.paint.get("text-opacity").constantOr(1)&&KS(t,e,i,r,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright"),i.paint.get("icon-color-saturation"),o,s),e.map.showCollisionBoxes&&(qS(t,e,i,r,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),qS(t,e,i,r,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))},circle:function(t,e,i,r){if("translucent"!==t.renderPass)return;const n=i.paint.get("circle-opacity"),o=i.paint.get("circle-stroke-width"),s=i.paint.get("circle-stroke-opacity"),a=void 0!==i.layout.get("circle-sort-key").constantOr(1),l=i.paint.get("circle-emissive-strength");if(0===n.constantOr(1)&&(0===o.constantOr(1)||0===s.constantOr(1)))return;const c=t.context,u=c.gl,h=t.transform,d=t.depthModeForSublayer(0,Rv.ReadOnly),p=Ov.disabled,f=t.colorModeForDrapableLayerRenderPass(l),m="globe"===h.projection.name,g=[_p(h.center.lng),yp(h.center.lat)],_=[];for(let n=0;n<r.length;n++){const o=r[n],s=e.getTile(o),l=s.getBucket(i);if(!l||l.projection.name!==h.projection.name)continue;const c=l.programConfigurations.get(i.id),u=uf(i),d=t.isTileAffectedByFog(o);m&&u.push("PROJECTION_GLOBE_VIEW");const p=t.getOrCreateProgram("circle",{config:c,defines:u,overrideFog:d}),f=l.layoutVertexBuffer,y=l.globeExtVertexBuffer,v=l.indexBuffer,x=h.projection.createInversionMatrix(h,o.canonical),b={programConfiguration:c,program:p,layoutVertexBuffer:f,globeExtVertexBuffer:y,indexBuffer:v,uniformValues:cf(t,o,s,x,g,i),tile:s};if(a){const t=l.segments.get();for(const e of t)_.push({segments:new Ql([e]),sortKey:e.sortKey,state:b})}else _.push({segments:l.segments,sortKey:0,state:b})}a&&_.sort((t,e)=>t.sortKey-e.sortKey);const y={useDepthForOcclusion:h.depthOcclusionForSymbolsAndCircles};for(const e of _){const{programConfiguration:r,program:n,layoutVertexBuffer:o,globeExtVertexBuffer:s,indexBuffer:a,uniformValues:l,tile:m}=e.state,g=e.segments;t.terrain&&t.terrain.setupElevationDraw(m,n,y),t.uploadCommonUniforms(c,n,m.tileID.toUnwrapped()),n.draw(t,u.TRIANGLES,d,p,f,Lv.disabled,l,i.id,o,a,g,i.paint,h.zoom,r,[s])}},heatmap:function(t,e,i,r){if(0!==i.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const n=t.context,o=n.gl,s=Ov.disabled,a=new Dv([o.ONE,o.ONE,o.ONE,o.ONE],hi.transparent,[!0,!0,!0,!0]);!function(t,e,i,r){const n=t.gl,o=e.width*r,s=e.height*r;t.activeTexture.set(n.TEXTURE1),t.viewport.set([0,0,o,s]);let a=i.heatmapFbo;if(!a||a&&(a.width!==o||a.height!==s)){a&&a.destroy();const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),a=i.heatmapFbo=t.createFramebuffer(o,s,!0,null),function(t,e,i,r,n,o){const s=t.gl;s.texImage2D(s.TEXTURE_2D,0,t.extRenderToTextureHalfFloat?s.RGBA16F:s.RGBA,n,o,0,s.RGBA,t.extRenderToTextureHalfFloat?s.HALF_FLOAT:s.UNSIGNED_BYTE,null),r.colorAttachment.set(i)}(t,0,e,a,o,s)}else n.bindTexture(n.TEXTURE_2D,a.colorAttachment.get()),t.bindFramebuffer.set(a.framebuffer)}(n,t,i,"globe"===t.transform.projection.name?.5:.25),n.clear({color:hi.transparent});const l=t.transform,c="globe"===l.projection.name,u=c?["PROJECTION_GLOBE_VIEW"]:[],h=c?Lv.frontCCW:Lv.disabled,d=[_p(l.center.lng),yp(l.center.lat)];for(let p=0;p<r.length;p++){const f=r[p];if(e.hasRenderableParent(f))continue;const m=e.getTile(f),g=m.getBucket(i);if(!g||g.projection.name!==l.projection.name)continue;const _=t.isTileAffectedByFog(f),y=g.programConfigurations.get(i.id),v=t.getOrCreateProgram("heatmap",{config:y,defines:u,overrideFog:_}),{zoom:x}=t.transform;t.terrain&&t.terrain.setupElevationDraw(m,v),t.uploadCommonUniforms(n,v,f.toUnwrapped());const b=l.projection.createInversionMatrix(l,f.canonical);v.draw(t,o.TRIANGLES,Rv.disabled,s,a,h,ES(t,f,m,b,d,x,i.paint.get("heatmap-intensity")),i.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,i.paint,t.transform.zoom,y,c?[g.globeExtVertexBuffer]:null)}n.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,e){const i=t.context,r=i.gl,n=e.heatmapFbo;if(!n)return;i.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,n.colorAttachment.get()),i.activeTexture.set(r.TEXTURE1);let o=e.colorRampTexture;o||(o=e.colorRampTexture=new Dy(i,e.colorRamp,r.RGBA)),o.bind(r.LINEAR,r.CLAMP_TO_EDGE),t.getOrCreateProgram("heatmapTexture").draw(t,r.TRIANGLES,Rv.disabled,Ov.disabled,t.colorModeForRenderPass(),Lv.disabled,((t,e,i,r)=>({u_image:0,u_color_ramp:1,u_opacity:e.paint.get("heatmap-opacity")}))(0,e),e.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,e.paint,t.transform.zoom)}(t,i))},line:function(t,e,i,r){if("translucent"!==t.renderPass)return;const n=i.paint.get("line-opacity"),o=i.paint.get("line-width");if(0===n.constantOr(1)||0===o.constantOr(1))return;const s=i.paint.get("line-emissive-strength"),a=t.depthModeForSublayer(0,Rv.ReadOnly),l=t.colorModeForDrapableLayerRenderPass(s),c=t.terrain&&t.terrain.renderingToTexture?1:pe.devicePixelRatio,u=i.paint.get("line-dasharray"),h=u.constantOr(1),d=i.layout.get("line-cap"),p=i.paint.get("line-pattern"),f=p.constantOr(1),m=i.paint.get("line-pattern").constantOr(1),g=1!==i.paint.get("line-opacity").constantOr(1);let _=!m&&g;const y=i.paint.get("line-gradient"),v=f?"linePattern":"line",x=t.context,b=x.gl,w=qb(i);t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&(_=!1);for(const n of r){const r=e.getTile(n);if(f&&!r.patternsLoaded())continue;const o=r.getBucket(i);if(!o)continue;t.prepareDrawTile();const s=o.programConfigurations.get(i.id),m=t.isTileAffectedByFog(n),g=t.getOrCreateProgram(v,{config:s,defines:w,overrideFog:m}),T=p.constantOr(null);if(T&&r.imageAtlas){const t=r.imageAtlas.patternPositions[T.toString()];t&&s.setConstantPatternPositions(t)}const E=u.constantOr(null),S=d.constantOr(null);if(!f&&E&&S&&r.lineAtlas){const t=r.lineAtlas.getDash(E,S);t&&s.setConstantPatternPositions(t)}let[A,M]=i.paint.get("line-trim-offset");if("round"===S||"square"===S){const t=1;A!==M&&(0===A&&(A-=t),1===M&&(M+=t))}const I=t.terrain?n.projMatrix:null,C=f?Vb(t,r,i,I,c):jb(t,r,i,I,o.lineClipsArray.length,c,[A,M]);if(y){const r=o.gradients[i.id];let s=r.texture;if(i.gradientVersion!==r.version){let a=256;if(i.stepInterpolant){const i=e.getSource().maxzoom,r=n.canonical.z===i?Math.ceil(1<<t.transform.maxZoom-n.canonical.z):1;a=R(G(o.maxLineLength/ur*1024*r),256,x.maxTextureSize)}r.gradient=Sf({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:a,image:r.gradient||void 0,clips:o.lineClipsArray}),r.texture?r.texture.update(r.gradient):r.texture=new Dy(x,r.gradient,b.RGBA),r.version=i.gradientVersion,s=r.texture}x.activeTexture.set(b.TEXTURE1),s.bind(i.stepInterpolant?b.NEAREST:b.LINEAR,b.CLAMP_TO_EDGE)}h&&(x.activeTexture.set(b.TEXTURE0),r.lineAtlasTexture&&r.lineAtlasTexture.bind(b.LINEAR,b.REPEAT),s.updatePaintBuffers()),f&&(x.activeTexture.set(b.TEXTURE0),r.imageAtlasTexture&&r.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),s.updatePaintBuffers()),t.uploadCommonUniforms(x,g,n.toUnwrapped());const P=e=>{g.draw(t,b.TRIANGLES,a,e,l,Lv.disabled,C,i.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,i.paint,t.transform.zoom,s,[o.layoutVertexBuffer2])};if(_){const e=t.stencilModeForClipping(n).ref;0===e&&t.terrain&&x.clear({stencil:0});const i={func:b.EQUAL,mask:255};C.u_alpha_discard_threshold=.8,P(new Ov(i,e,255,b.KEEP,b.KEEP,b.INVERT)),C.u_alpha_discard_threshold=0,P(new Ov(i,e,255,b.KEEP,b.KEEP,b.KEEP))}else P(t.stencilModeForClipping(n))}_&&(t.resetStencilClippingMasks(),t.terrain&&x.clear({stencil:0}))},fill:function(t,e,i,r){const n=i.paint.get("fill-color"),o=i.paint.get("fill-opacity");if(0===o.constantOr(1))return;const s=i.paint.get("fill-emissive-strength"),a=t.colorModeForDrapableLayerRenderPass(s),l=i.paint.get("fill-pattern"),c=t.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===n.constantOr(hi.transparent).a&&1===o.constantOr(0)?"opaque":"translucent";if(t.renderPass===c){const n=t.depthModeForSublayer(1,"opaque"===t.renderPass?Rv.ReadWrite:Rv.ReadOnly);QS(t,e,i,r,n,a,!1)}if("translucent"===t.renderPass&&i.paint.get("fill-antialias")){const n=t.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,Rv.ReadOnly);QS(t,e,i,r,n,a,!0)}},"fill-extrusion":function(t,e,i,r){const n=i.paint.get("fill-extrusion-opacity"),o=t.context,s=o.gl,a=t.terrain,l=a&&a.renderingToTexture,c=i.paint.get("fill-extrusion-cutoff-fade-range");if(0===n)return;const u=t.conflationActive&&t.layerUsedInConflation(i,e.getSource());if(u&&function(t,e,i,r){for(const n of r){const r=e.getTile(n).getBucket(i);r&&(r.updateReplacement(n,t.replacementSource),r.uploadCentroid(t.context))}}(t,e,i,r),a||u)for(const n of r){const r=e.getTile(n).getBucket(i);r&&iA(t.context,e,n,r,i,a,u)}if("shadow"===t.renderPass&&t.shadowRenderer){const o=t.shadowRenderer;if(a&&n<.65&&i._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof vo)return;const s=o.getShadowPassDepthMode(),l=o.getShadowPassColorMode();tA(t,e,i,r,s,Ov.disabled,l,u)}else if("translucent"===t.renderPass){const h=!i.paint.get("fill-extrusion-pattern").constantOr(1);if(!l){const o=new Rv(t.context.gl.LEQUAL,Rv.ReadWrite,t.depthRangeFor3D);0===c&&1===n&&h?tA(t,e,i,r,o,Ov.disabled,Dv.unblended,u):(tA(t,e,i,r,o,Ov.disabled,Dv.disabled,u),tA(t,e,i,r,o,t.stencilModeFor3D(),t.colorModeForRenderPass(),u),t.resetStencilClippingMasks())}if(t.style.enable3dLights()&&h&&(!a&&"globe"!==t.transform.projection.name||l)){const n=i.paint.get("fill-extrusion-opacity"),c=i.paint.get("fill-extrusion-ambient-occlusion-intensity"),h=i.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),d=i.paint.get("fill-extrusion-flood-light-intensity"),p=i.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),f=c>0&&h>0,m=d>0,g=(t,e,i)=>(1-i)*t+i*e,_=o=>{const a=t.depthModeForSublayer(1,Rv.ReadOnly,s.LEQUAL,!0),l=i.paint.get(o?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),f=g(.1,3,l),m=t._showOverdrawInspector;if(!m){const l=new Ov({func:s.ALWAYS,mask:255},255,255,s.KEEP,s.KEEP,s.REPLACE),m=new Dv([s.ONE,s.ONE,s.ONE,s.ONE],hi.transparent,[!1,!1,!1,!0],s.MIN);eA(t,e,i,r,a,l,m,Lv.disabled,o,"sdf",n,c,h,d,p,f,u,!1)}{const l=m?Ov.disabled:new Ov({func:s.EQUAL,mask:255},255,255,s.KEEP,s.DECR,s.DECR),g=m?t.colorModeForRenderPass():new Dv([s.ONE_MINUS_DST_ALPHA,s.DST_ALPHA,s.ONE,s.ONE],hi.transparent,[!0,!0,!0,!0]);eA(t,e,i,r,a,l,g,Lv.disabled,o,"color",n,c,h,d,p,f,u,!1)}};if(l){const l=(o,a,l)=>{const f=t.depthModeForSublayer(1,Rv.ReadOnly,s.LEQUAL,!1),m=i.paint.get(o?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),_=g(.1,3,m);{const l=new Dv([s.ONE,s.ONE,s.ONE,s.ONE],hi.transparent,[!1,!1,!1,!0]);eA(t,e,i,r,f,Ov.disabled,l,Lv.disabled,o,"clear",n,c,h,d,p,_,u,a)}{const l=new Ov({func:s.ALWAYS,mask:255},255,255,s.KEEP,s.KEEP,s.REPLACE),m=new Dv([s.ONE,s.ONE,s.ONE,s.ONE],hi.transparent,[!1,!1,!1,!0],s.MIN);eA(t,e,i,r,f,l,m,Lv.disabled,o,"sdf",n,c,h,d,p,_,u,a)}{const l=o?s.ZERO:s.ONE_MINUS_DST_ALPHA,m=new Ov({func:s.EQUAL,mask:255},255,255,s.KEEP,s.DECR,s.DECR),g=new Dv([l,s.DST_ALPHA,s.ONE_MINUS_DST_ALPHA,s.ZERO],hi.transparent,[!0,!0,!0,!0]);eA(t,e,i,r,f,m,g,Lv.disabled,o,"color",n,c,h,d,p,_,u,a)}{const m=new Dv([s.ONE,s.ONE,s.ONE,o?s.ZERO:s.ONE],hi.transparent,[!1,!1,!1,!0],o?s.FUNC_ADD:s.MAX);eA(t,e,i,r,f,Ov.disabled,m,Lv.disabled,o,"clear",n,c,h,d,p,_,u,a,l)}};if(f||m){let e;if(t.prepareDrawTile(),a){const t=a.drapeBufferSize[0],i=a.drapeBufferSize[1];e=a.framebufferCopyTexture,e&&(!e||e.size[0]===t&&e.size[1]===i)||(e&&e.destroy(),e=a.framebufferCopyTexture=new Dy(o,new bf({width:t,height:i}),s.RGBA)),e.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,t,i,0)}f&&l(!0,!1,e),m&&l(!1,!0,e)}}else f&&_(!0),m&&_(!1)}}},hillshade:function(t,e,i,r){if("offscreen"!==t.renderPass&&"translucent"!==t.renderPass)return;if(t.style.disableElevatedTerrain)return;const n=t.context,o=t.terrain&&t.terrain.renderingToTexture,[s,a]="translucent"!==t.renderPass||o?[{},r]:t.stencilConfigForOverlap(r);for(const r of a){const n=e.getTile(r);if(n.needsHillshadePrepare&&"offscreen"===t.renderPass)qE(t,n,i);else if("translucent"===t.renderPass){const e=t.depthModeForSublayer(0,Rv.ReadOnly),a=i.paint.get("hillshade-emissive-strength"),l=t.colorModeForDrapableLayerRenderPass(a),c=o&&t.terrain?t.terrain.stencilModeForRTTOverlap(r):s[r.overscaledZ];XE(t,r,n,i,e,c,l)}}n.viewport.set([0,0,t.width,t.height]),t.resetStencilClippingMasks()},raster:function(t,e,i,r,n,o){if("translucent"!==t.renderPass)return;if(0===i.paint.get("raster-opacity"))return;const s=t.context,a=s.gl,l=e.getSource(),c=function(t,e,i){const r=t.paint.get("raster-color"),n=[],o=t.paint.get("raster-resampling"),s=t.paint.get("raster-color-mix"),a=t.paint.get("raster-color-range"),l=[s[0],s[1],s[2],0],c=s[3],u="nearest"===o?i.NEAREST:i.LINEAR;if(r&&n.push("RASTER_COLOR"),r){e.activeTexture.set(i.TEXTURE2);let r=t.colorRampTexture;r||(r=t.colorRampTexture=new Dy(e,t.colorRamp,i.RGBA)),r.bind(i.LINEAR,i.CLAMP_TO_EDGE)}return{mix:l,range:a,offset:c,defines:n,resampling:u}}(i,s,a),u=c.defines,h="globe"===t.transform.projection.name;let d=!1;if(l instanceof ew&&!r.length){if(!h)return;if(l.onNorthPole)d=!0,u.push("GLOBE_POLES");else{if(!l.onSouthPole)return;d=!0,u.push("GLOBE_POLES")}}const p=i.paint.get("raster-emissive-strength"),f=t.colorModeForDrapableLayerRenderPass(p),m=t.terrain&&t.terrain.renderingToTexture,g=l instanceof ew&&0!==i.paint.get("raster-elevation"),_=!t.options.moving,y="nearest"===i.paint.get("raster-resampling")?a.NEAREST:a.LINEAR;if(d){const r=e.getSource();if(!(r instanceof ew))return;const n=r.texture;if(!n)return;const o=t.globeSharedBuffers;if(!o)return;const l=new Rv(a.LEQUAL,Rv.ReadWrite,t.depthRangeFor3D),u=Float32Array.from(t.transform.expandedFarZProjMatrix);let h=ep(0,0,t.transform);const d=Float32Array.from($d(Bd(new fd(0,0,0)))),m={opacity:1,mix:0};t.terrain&&t.terrain.prepareDrawTile(),s.activeTexture.set(a.TEXTURE0),n.bind(y,a.CLAMP_TO_EDGE),s.activeTexture.set(a.TEXTURE1),n.bind(y,a.CLAMP_TO_EDGE),n.useMipmap&&s.extTextureFilterAnisotropic&&t.transform.pitch>20&&a.texParameterf(a.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax);const[g,_,v,x]=o.getPoleBuffers(0,!0);let b;r.onNorthPole?(b=g,t.renderDefaultNorthPole=!1):(h=Jh.scale(Jh.create(),h,[1,-1,1]),b=_,t.renderDefaultSouthPole=!1);const w=((t,e,i,r,n,o,s,a,l,c,u,h)=>SS(t,e,i,new Float32Array(16),new Float32Array(9),[0,0],[0,0,0,0],0,[0,0],[0,0,0,0],1,r,n,o||[0,0],s,2,l,c,u,1,0,h))(u,d,h,m,i,r.perspectiveTransform||[0,0],i.paint.get("raster-elevation"),0,c.mix,c.offset,c.range,p),T=t.getOrCreateProgram("raster",{defines:c.defines});return t.uploadCommonUniforms(s,T,null),void T.draw(t,a.TRIANGLES,l,Ov.disabled,f,Lv.disabled,w,i.id,b,v,x)}if(!r.length)return;const[v,x]=l instanceof ew||m?[{},r]:t.stencilConfigForOverlap(r),b=x[x.length-1].overscaledZ,w=g&&h;w&&c.defines.push("PROJECTION_GLOBE_VIEW"),g&&c.defines.push("RENDER_CUTOFF");for(const r of x){const n=r.toUnwrapped(),u=e.getTile(r);if(m&&(!u||!u.hasData()))continue;if(!u.texture)continue;let d,x;m?(d=Rv.disabled,x=r.projMatrix):g?(d=new Rv(a.LEQUAL,Rv.ReadWrite,t.depthRangeFor3D),x=h?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(n,_)):(d=t.depthModeForSublayer(r.overscaledZ-b,1===i.paint.get("raster-opacity")?Rv.ReadWrite:Rv.ReadOnly,a.LESS),x=t.transform.calculateProjMatrix(n,_));const T=t.terrain&&m?t.terrain.stencilModeForRTTOverlap(r):v[r.overscaledZ],E=o?0:i.paint.get("raster-fade-duration");u.registerFadeDuration(E);const S=e.findLoadedParent(r,0),A=rS(u,S,e,t.transform,E);let M,I;t.terrain&&t.terrain.prepareDrawTile(),s.activeTexture.set(a.TEXTURE0),u.texture&&u.texture.bind(y,a.CLAMP_TO_EDGE),s.activeTexture.set(a.TEXTURE1),S?(S.texture&&S.texture.bind(y,a.CLAMP_TO_EDGE),M=Math.pow(2,S.tileID.overscaledZ-u.tileID.overscaledZ),I=[u.tileID.canonical.x*M%1,u.tileID.canonical.y*M%1]):u.texture&&u.texture.bind(y,a.CLAMP_TO_EDGE),u.texture&&u.texture.useMipmap&&s.extTextureFilterAnisotropic&&t.transform.pitch>20&&a.texParameterf(a.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax);const C=t.transform,P=l instanceof ew?l.perspectiveTransform:[0,0],R=g?aA(C):[0,0,0,0];let O,D,L,k,B,F;if(w&&l instanceof ew&&l.coordinates.length>3){O=Float32Array.from($d(Bd(new fd(0,0,0)))),D=Float32Array.from(C.globeMatrix),L=Float32Array.from(Qd(C)),k=[_p(C.center.lng),yp(C.center.lat)],F=[_p(l.coordinates[1][0]),yp(l.coordinates[1][1]),_p(l.coordinates[3][0]),yp(l.coordinates[3][1])];const e=new Nc(l.coordinates[1],l.coordinates[3]);B=Float32Array.from(rp(new fd(0,0,0),e,0,C.worldSize/t.transform._pixelsPerMercatorPixel))}else O=new Float32Array(16),D=new Float32Array(9),L=new Float32Array(16),k=[0,0],B=new Float32Array(16),F=[0,0,0,0];const z=SS(x,O,D,L,B,I||[0,0],F,tp(t.transform.zoom),k,R,M||1,A,i,P,g?i.paint.get("raster-elevation"):0,2,c.mix,c.offset,c.range,1,0,p),N=t.isTileAffectedByFog(r),U=t.getOrCreateProgram("raster",{defines:c.defines,overrideFog:N});if(t.uploadCommonUniforms(s,U,n),l instanceof ew){if(m||!h)l.boundsBuffer&&l.boundsSegments&&U.draw(t,a.TRIANGLES,d,Ov.disabled,f,Lv.disabled,z,i.id,l.boundsBuffer,t.quadTriangleIndexBuffer,l.boundsSegments);else if(t.globeSharedBuffers){const[e,r,n]=t.globeSharedBuffers.getGridBuffers(0,!1);U.draw(t,a.TRIANGLES,d,Ov.disabled,f,Lv.frontCCW,z,i.id,e,r,n),U.draw(t,a.TRIANGLES,d,Ov.disabled,f,Lv.backCCW,z,i.id,e,r,n)}}else{const{tileBoundsBuffer:e,tileBoundsIndexBuffer:r,tileBoundsSegments:n}=t.getTileBoundsBuffers(u);U.draw(t,a.TRIANGLES,d,T,f,Lv.disabled,z,i.id,e,r,n)}}t.resetStencilClippingMasks()},background:function(t,e,i,r){const n=i.paint.get("background-color"),o=i.paint.get("background-opacity"),s=i.paint.get("background-emissive-strength");if(0===o)return;const a=t.context,l=a.gl,c=t.transform,u=c.tileSize,h=i.paint.get("background-pattern");if(t.isPatternMissing(h,i.scope))return;const d=!h&&1===n.a&&1===o&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==d)return;const p=Ov.disabled,f=t.depthModeForSublayer(0,"opaque"===d?Rv.ReadWrite:Rv.ReadOnly),m=t.colorModeForDrapableLayerRenderPass(s),g=h?"backgroundPattern":"background";let _,y=r;y||(_=t.getBackgroundTiles(),y=Object.values(_).map(t=>t.tileID)),h&&(a.activeTexture.set(l.TEXTURE0),t.imageManager.bind(t.context,i.scope));for(const d of y){const y=t.isTileAffectedByFog(d),v=t.getOrCreateProgram(g,{overrideFog:y}),x=d.toUnwrapped(),b=r?d.projMatrix:t.transform.calculateProjMatrix(x);t.prepareDrawTile();const w=e?e.getTile(d):_?_[d.key]:new jy(d,u,c.zoom,t),T=h?LS(b,s,o,t,h,i.scope,{tileID:d,tileSize:u}):DS(b,s,o,n);t.uploadCommonUniforms(a,v,x);const{tileBoundsBuffer:E,tileBoundsIndexBuffer:S,tileBoundsSegments:A}=t.getTileBoundsBuffers(w);v.draw(t,l.TRIANGLES,f,p,m,Lv.disabled,T,i.id,E,S,A)}},sky:function(t,e,i){const r=t._atmosphere?tp(t.transform.zoom):1,n=i.paint.get("sky-opacity")*r;if(0===n)return;const o=t.context,s=i.paint.get("sky-type"),a=new Rv(o.gl.LEQUAL,Rv.ReadOnly,[0,1]),l=t.frameCounter/1e3%1;"atmosphere"===s?"offscreen"===t.renderPass?i.needsSkyboxCapture(t)&&(function(t,e,i,r){const n=t.context,o=n.gl;let s=e.skyboxFbo;if(!s){s=e.skyboxFbo=n.createFramebuffer(32,32,!0,null),e.skyboxGeometry=new xA(n),e.skyboxTexture=n.gl.createTexture(),o.bindTexture(o.TEXTURE_CUBE_MAP,e.skyboxTexture),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR);for(let t=0;t<6;++t)o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,o.RGBA,32,32,0,o.RGBA,o.UNSIGNED_BYTE,null)}n.bindFramebuffer.set(s.framebuffer),n.viewport.set([0,0,32,32]);const a=e.getCenter(t,!0),l=t.getOrCreateProgram("skyboxCapture"),c=new Float64Array(16);Jh.identity(c),Jh.rotateY(c,c,.5*-Math.PI),bA(t,e,l,c,a,0),Jh.identity(c),Jh.rotateY(c,c,.5*Math.PI),bA(t,e,l,c,a,1),Jh.identity(c),Jh.rotateX(c,c,.5*-Math.PI),bA(t,e,l,c,a,2),Jh.identity(c),Jh.rotateX(c,c,.5*Math.PI),bA(t,e,l,c,a,3),Jh.identity(c),bA(t,e,l,c,a,4),Jh.identity(c),Jh.rotateY(c,c,Math.PI),bA(t,e,l,c,a,5),n.viewport.set([0,0,t.width,t.height])}(t,i),i.markSkyboxValid(t)):"sky"===t.renderPass&&function(t,e,i,r,n){const o=t.context,s=o.gl,a=t.transform,l=t.getOrCreateProgram("skybox");o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_CUBE_MAP,e.skyboxTexture);const c=((t,e,i,r,n)=>({u_matrix:t,u_sun_direction:e,u_cubemap:0,u_opacity:r,u_temporal_offset:n}))(a.skyboxMatrix,e.getCenter(t,!1),0,r,n);t.uploadCommonUniforms(o,l),l.draw(t,s.TRIANGLES,i,Ov.disabled,t.colorModeForRenderPass(),Lv.backCW,c,"skybox",e.skyboxGeometry.vertexBuffer,e.skyboxGeometry.indexBuffer,e.skyboxGeometry.segment)}(t,i,a,n,l):"gradient"===s&&"sky"===t.renderPass&&function(t,e,i,r,n){const o=t.context,s=o.gl,a=t.transform,l=t.getOrCreateProgram("skyboxGradient");e.skyboxGeometry||(e.skyboxGeometry=new xA(o)),o.activeTexture.set(s.TEXTURE0);let c=e.colorRampTexture;c||(c=e.colorRampTexture=new Dy(o,e.colorRamp,s.RGBA)),c.bind(s.LINEAR,s.CLAMP_TO_EDGE);const u=((t,e,i,r,n)=>({u_matrix:t,u_color_ramp:0,u_center_direction:e,u_radius:T(i),u_opacity:r,u_temporal_offset:n}))(a.skyboxMatrix,e.getCenter(t,!1),e.paint.get("sky-gradient-radius"),r,n);t.uploadCommonUniforms(o,l),l.draw(t,s.TRIANGLES,i,Ov.disabled,t.colorModeForRenderPass(),Lv.backCW,u,"skyboxGradient",e.skyboxGeometry.vertexBuffer,e.skyboxGeometry.indexBuffer,e.skyboxGeometry.segment)}(t,i,a,n,l)},debug:function(t,e,i){for(let r=0;r<i.length;r++)pA(t,e,i[r])},custom:function(t,e,i,r){const n=t.context,o=i.implementation;if(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes("custom")||t.terrain&&(t.terrain.renderingToTexture||"offscreen"===t.renderPass)&&i.isLayerDraped(e)){if("offscreen"===t.renderPass){const e=o.prerender;if(e){if(t.setCustomLayerDefaults(),n.setColorMode(t.colorModeForRenderPass()),"globe"===t.transform.projection.name){const i=t.transform.pointMerc;e.call(o,n.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),tp(t.transform.zoom),[i.x,i.y],t.transform.pixelsPerMeterRatio)}else e.call(o,n.gl,t.transform.customLayerMatrix());n.setDirty(),t.setBaseState()}}else if("translucent"===t.renderPass){if(t.terrain&&t.terrain.renderingToTexture){const e=o.renderToTile;if(e){const i=r[0].canonical,s=new Ip(i.x+r[0].wrap*(1<<i.z),i.y,i.z);n.setDepthMode(Rv.disabled),n.setStencilMode(Ov.disabled),n.setColorMode(t.colorModeForRenderPass()),t.setCustomLayerDefaults(),e.call(o,n.gl,s),n.setDirty(),t.setBaseState()}return}t.setCustomLayerDefaults(),n.setColorMode(t.colorModeForRenderPass()),n.setStencilMode(Ov.disabled);const e="3d"===o.renderingMode?new Rv(t.context.gl.LEQUAL,Rv.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Rv.ReadOnly);if(n.setDepthMode(e),"globe"===t.transform.projection.name){const e=t.transform.pointMerc;o.render(n.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),tp(t.transform.zoom),[e.x,e.y],t.transform.pixelsPerMeterRatio)}else o.render(n.gl,t.transform.customLayerMatrix());n.setDirty(),t.setBaseState(),n.bindFramebuffer.set(null)}}else Y("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(t,e,i,r){if("opaque"===t.renderPass)return;const n=i.paint.get("model-opacity");if(0===n)return;const o=i.paint.get("model-cast-shadows");if("shadow"===t.renderPass){if(!o)return;if(t.terrain&&n<.65&&i._transitionablePaint._values["model-opacity"].value.expression instanceof vo)return}const s=t.shadowRenderer,a=i.paint.get("model-receive-shadows");s&&(s.useNormalOffset=!0,a||(s.enabled=!1));const l=()=>{s&&(s.useNormalOffset=!0,a||(s.enabled=!0))},c=e.getSource();if("light-beam"===t.renderPass&&"batched-model"!==c.type)return;if("vector"===c.type||"geojson"===c.type)return function(t,e,i,r){const n=t.transform;if("mercator"!==n.projection.name)return void Y(`Drawing 3D models for ${n.projection.name} projection is not yet implemented`);const o=n.getFreeCameraOptions().position;if(!t.modelManager)return;const s=t.modelManager,a=t.shadowRenderer;if(!i._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const l=i._unevaluatedLayout._values["model-id"],c={...i.layout.get("model-id").parameters};for(const u of r){const r=e.getTile(u).getBucket(i);if(!r||r.projection.name!==n.projection.name)continue;const h=DA(u,n);c.zoom=h;const d=l.possiblyEvaluate(c);if(RA(t,r,u),OA.shadowUniformsInitialized=!1,OA.useSingleShadowCascade=!!a&&0===a.getMaxCascadeForTile(u.toUnwrapped()),"shadow"===t.renderPass&&a){if(1===t.currentShadowCascade&&r.isInsideFirstShadowMapFrustum)continue;const e=n.calculatePosMatrix(u.toUnwrapped(),n.worldSize);if(OA.tileMatrix.set(e),OA.shadowTileMatrix=Float32Array.from(a.calculateShadowPassMatrixFromMatrix(e)),OA.aabb.min.fill(0),OA.aabb.max[0]=OA.aabb.max[1]=ur,OA.aabb.max[2]=0,BA(r,OA,t,i.scope))continue}const p=1<<u.canonical.z,f=[((o.x-u.wrap)*p-u.canonical.x)*ur,(o.y*p-u.canonical.y)*ur,o.z*p*ur];for(let e in r.instancesPerModel){const n=r.instancesPerModel[e];n.features.length>0&&(e=d.evaluate(n.features[0].feature,{}));const o=s.getModel(e,i.scope);if(o&&o.uploaded)for(const e of o.nodes)LA(t,i,e,n,f,u,OA)}}}(t,e,i,r),void l();if(!c.loaded())return;if("batched-model"===c.type)return function(t,e,i,r){const n=t.context,o=t.transform,s=t.style.fog,a=t.shadowRenderer;if("mercator"!==o.projection.name)return void Y(`Drawing 3D landmark models for ${o.projection.name} projection is not yet implemented`);const l=t.transform.getFreeCameraOptions().position,c=nd.scale([],[l.x,l.y,l.z],t.transform.worldSize);nd.negate(c,c);const u=Jh.identity([]),h=Sp(o.center.lat,o.zoom),d=Jh.fromScaling([],[1,1,1/h]);Jh.translate(u,u,c);const p=i.paint.get("model-opacity"),f=new Rv(n.gl.LEQUAL,Rv.ReadWrite,t.depthRangeFor3D),m=new Rv(n.gl.LEQUAL,Rv.ReadOnly,t.depthRangeFor3D),g=function(l,c){for(const h of r){const r=e.getTile(h).getBucket(i);if(!r||!r.uploaded)continue;let g=!1;a&&(g=0===a.getMaxCascadeForTile(h.toUnwrapped()));const _=o.calculatePosMatrix(h.toUnwrapped(),o.worldSize),y=r.modelTraits;for(const e of r.getNodesInfo()){if(e.hiddenByReplacement)continue;if(!e.node.meshes)continue;const r=e.node,v="light-beam"===t.renderPass,x=[..._],b=e.evaluatedScale;let w=0;t.terrain&&r.elevation&&(w=r.elevation*t.terrain.exaggeration()),Jh.translate(x,x,[(r.anchor?r.anchor[0]:0)*(b[0]-1),(r.anchor?r.anchor[1]:0)*(b[1]-1),w]),b!==Rx&&Jh.scale(x,x,b),Jh.multiply(x,x,r.matrix);const T=Jh.multiply([],d,x);Jh.multiply(T,u,T);const E=Jh.invert([],T);Jh.transpose(E,E),Jh.scale(E,E,kA);const S=Jh.multiply([],o.expandedFarZProjMatrix,x);for(let u=0;u<r.meshes.length;++u){const d=r.meshes[u],_=u===r.lightMeshIndex;if(_){if(!v&&!t.terrain&&t.shadowRenderer){t.currentLayer<t.firstLightBeamLayer&&(t.firstLightBeamLayer=t.currentLayer);continue}}else if(v)continue;const b={defines:[]},w=[];MA(b.defines,w,d,t),4&y||b.defines.push("DIFFUSE_SHADED"),g&&b.defines.push("SHADOWS_SINGLE_CASCADE");const A="shadow"===t.renderPass;if(A){PA(d,x,t,i);continue}let M=null;if(s){const e=AA(x,t.transform);if(M=new Float32Array(e),"globe"!==o.projection.name){const t=d.aabb.min,i=d.aabb.max,[r,n]=s.getOpacityForBounds(e,t[0],t[1],i[0],i[1]);b.overrideFog=r>=mw||n>=mw}}const I=t.getOrCreateProgram("model",b);!A&&a&&(a.useNormalOffset=!!d.normalBuffer,a.setupShadowsFromMatrix(x,I,a.useNormalOffset)),t.uploadCommonUniforms(n,I,h.toUnwrapped(),M);const C=d.material,P=C.pbrMetallicRoughness;P.metallicFactor=.9,P.roughnessFactor=.5;const R=0,O=GS(new Float32Array(S),new Float32Array(T),new Float32Array(E),t,p,P.baseColorFactor,C.emissiveFactor,P.metallicFactor,P.roughnessFactor,C,R,i);I.draw(t,n.gl.TRIANGLES,c&&!_?f:m,Ov.disabled,l?_||p<1||e.hasTranslucentParts?Dv.alphaBlended:Dv.unblended:Dv.disabled,Lv.backCCW,O,i.id,d.vertexBuffer,d.indexBuffer,d.segments,i.paint,t.transform.zoom,void 0,w)}}}};(function(t,e,i,r){const n=t.terrain?t.terrain.exaggeration():0,o=t.transform.zoom;for(const s of r){const r=e.getTile(s).getBucket(i);r&&(t.conflationActive&&r.updateReplacement(s,t.replacementSource),r.evaluateScale(t,i),t.terrain&&n>0&&r.elevationUpdate(t.terrain,n,s,i.source),r.needsReEvaluation(t,o,i)&&r.evaluate(i))}})(t,e,i,r),1===p?g(!0,!0):(g(!1,!0),g(!0,!1))}(t,e,i,r),void l();const u=c.getModels(),h=[],d=t.transform.getFreeCameraOptions().position,p=nd.scale([],[d.x,d.y,d.z],t.transform.worldSize);nd.negate(p,p);const f=[],m=[];let g=0;for(const e of u){const r=i.paint.get("model-rotation").constantOr(null),n=i.paint.get("model-scale").constantOr(null),o=i.paint.get("model-translation").constantOr(null);e.computeModelMatrix(t,r,n,o,!0,!0,!1);const s=Jh.identity([]),a=Sp(e.position.lat,t.transform.zoom),l=Jh.fromScaling([],[1,1,1/a]);Jh.translate(s,s,p),h.push({zScaleMatrix:l,negCameraPosMatrix:s});for(const i of e.nodes)CA(t.transform,i,e.matrix,t.transform.expandedFarZProjMatrix,g,f,m);g++}if(f.sort((t,e)=>e.depth-t.depth),"shadow"!==t.renderPass){if(1===n)for(const e of m)IA(e,t,i,h[e.modelIndex],Ov.disabled,t.colorModeForRenderPass());else{for(const e of m)IA(e,t,i,h[e.modelIndex],Ov.disabled,Dv.disabled);for(const e of m)IA(e,t,i,h[e.modelIndex],t.stencilModeFor3D(),t.colorModeForRenderPass());t.resetStencilClippingMasks()}for(const e of f)IA(e,t,i,h[e.modelIndex],Ov.disabled,t.colorModeForRenderPass());l()}else{for(const e of m)PA(e.mesh,e.nodeModelMatrix,t,i);for(const e of f)PA(e.mesh,e.nodeModelMatrix,t,i);l()}}},UA={modelUpload:function(t,e,i){const r=e.getSource();if(!r.loaded())return;if("vector"===r.type||"geojson"===r.type)return void(t.modelManager&&t.modelManager.upload(t,i));if("batched-model"===r.type)return;const n=r.getModels();for(const e of n)e.upload(t.context)}};class GA{constructor(t,e,i){this.context=new kv(t,e),this.transform=i,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=Bv.maxUnderzooming+Bv.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new Jx,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new HA(this),this._wireframeDebugCache=new zA,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(t,e){const i=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(i||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new aS(this,t));const r=this._terrain;this.transform.elevation=i?r:null,r.update(t,this.transform,e),this.transform.elevation&&!r.enabled&&(this.transform.elevation=null)}_updateFog(t){const e=t.fog;if(!e||"globe"===this.transform.projection.name||e.getOpacity(this.transform.pitch)<1||e.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[i,r]=e.getFovAdjustedRange(this.transform._fov);if(i>r)return void(this.transform.fogCullDistSq=null);const n=i+.78*(r-i);this.transform.fogCullDistSq=n*n}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,e){if(this.width=t*pe.devicePixelRatio,this.height=e*pe.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const t of this.style.order)this.style._mergedLayers[t].resize()}setup(){const t=this.context,e=new ul;e.emplaceBack(0,0),e.emplaceBack(ur,0),e.emplaceBack(0,ur),e.emplaceBack(ur,ur),this.tileExtentBuffer=t.createVertexBuffer(e,hd.members),this.tileExtentSegments=Ql.simpleSegment(0,0,4,2);const r=new ul;r.emplaceBack(0,0),r.emplaceBack(ur,0),r.emplaceBack(0,ur),r.emplaceBack(ur,ur),this.debugBuffer=t.createVertexBuffer(r,hd.members),this.debugSegments=Ql.simpleSegment(0,0,4,5);const n=new ul;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(-1,1),n.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(n,hd.members),this.viewportSegments=Ql.simpleSegment(0,0,4,2);const o=new dl;o.emplaceBack(0,0,0,0),o.emplaceBack(ur,0,ur,0),o.emplaceBack(0,ur,0,ur),o.emplaceBack(ur,ur,ur,ur),this.mercatorBoundsBuffer=t.createVertexBuffer(o,Uy.members),this.mercatorBoundsSegments=Ql.simpleSegment(0,0,4,2);const s=new Ml;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(s);const a=new Ll;for(const t of[0,1,3,2,0])a.emplaceBack(t);this.debugIndexBuffer=t.createIndexBuffer(a),this.emptyTexture=new Dy(t,new bf({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=Jh.create();const l=this.context.gl;this.stencilClearMode=new Ov({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(i.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Rv.disabled,this.stencilClearMode,Dv.disabled,Lv.disabled,iS(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,e,i){if(!e||this.currentStencilSource===e.id||!t.isTileClipped()||!i||0===i.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let t=!1;for(const e of i)if(void 0===this._tileClippingMaskIDs[e.key]){t=!0;break}if(!t)return}this.currentStencilSource=e.id;const r=this.context,n=r.gl;this.nextStencilID+i.length>256&&this.clearStencil(),r.setColorMode(Dv.disabled),r.setDepthMode(Rv.disabled);const o=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const t of i){const i=e.getTile(t),r=this._tileClippingMaskIDs[t.key]=this.nextStencilID++,{tileBoundsBuffer:s,tileBoundsIndexBuffer:a,tileBoundsSegments:l}=this.getTileBoundsBuffers(i);o.draw(this,n.TRIANGLES,Rv.disabled,new Ov({func:n.ALWAYS,mask:0},r,255,n.KEEP,n.KEEP,n.REPLACE),Dv.disabled,Lv.disabled,iS(t.projMatrix),"$clipping",s,a,l)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,e=this.context.gl;return new Ov({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const e=this.context.gl;return new Ov({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)}stencilConfigForOverlap(t){const e=this.context.gl,i=t.sort((t,e)=>e.overscaledZ-t.overscaledZ),r=i[i.length-1].overscaledZ,n=i[0].overscaledZ-r+1;if(n>1){this.currentStencilSource=void 0,this.nextStencilID+n>256&&this.clearStencil();const t={};for(let i=0;i<n;i++)t[i+r]=new Ov({func:e.GEQUAL,mask:255},i+this.nextStencilID,255,e.KEEP,e.KEEP,e.REPLACE);return this.nextStencilID+=n,[t,i]}return[{[r]:Ov.disabled},i]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const e=1/8;return new Dv([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new hi(e,e,e,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?Dv.unblended:Dv.alphaBlended}colorModeForDrapableLayerRenderPass(t){const e=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new Dv([e.ONE,e.ONE_MINUS_SRC_ALPHA,e.CONSTANT_ALPHA,e.ONE_MINUS_SRC_ALPHA],new hi(0,0,0,void 0===t?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,e,i,r=!1){if(!this.opaquePassEnabledForLayer()&&!r)return Rv.disabled;const n=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Rv(i||this.context.gl.LEQUAL,e,[n,n])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,e){this._wireframeDebugCache.update(this.frameCounter),this.style=t,this.options=e;const r=this.style._mergedLayers,n=this.style.order,o=n.map(t=>r[t]),s=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(pe.now()),this.imageManager.beginFrame();let a=0,l=!1;for(const t in s){const e=s[t];e.used&&(e.prepare(this.context),e.getSource().usedInConflation&&++a)}const c={},u={},h={},d={},p={};for(const t in s){const e=s[t];c[t]=e.getVisibleCoordinates(),u[t]=c[t].slice().reverse(),h[t]=e.getVisibleCoordinates(!0).reverse(),d[t]=e.getShadowCasterCoordinates(),p[t]=e.sortCoordinatesByDistance(c[t])}const f=t=>{const e=this.style.getLayerSourceCache(t);return e&&e.used?e.getSource():null};if(a){const t=[];for(const e of o)this.layerUsedInConflation(e,f(e))&&t.push(e);if(t&&t.length>1){const e=[];for(const i of t){const t=this.style.getLayerSourceCache(i);t&&t.used&&t.getSource().usedInConflation&&e.push({layer:i.fqid,cache:t})}this.replacementSource.setSources(e),l=!0}}l||this.replacementSource.clear(),this.conflationActive=l,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const t of o){const e=t.cutoffRange();if(this.longestCutoffRange=Math.max(e,this.longestCutoffRange),e>0){const e=f(t);e&&(this.minCutoffZoom=Math.max(e.minzoom,this.minCutoffZoom)),t.minzoom&&(this.minCutoffZoom=Math.max(t.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let t=0;t<o.length;t++)if(o[t].is3D()){this.opaquePassCutoff=t;break}const m=this.style&&this.style.fog;m?(this._fogVisible=0!==m.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=m.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(h),this.opaquePassCutoff=0);const g=this._shadowRenderer;if(g){g.updateShadowParameters(this.transform,this.style.directionalLight);for(const t in s)for(const e of c[t]){let t={min:0,max:0};this.terrain&&(t=this.terrain.getMinMaxForTile(e)||t),g.addShadowReceiver(e.toUnwrapped(),t.min,t.max)}}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new hp(this.context));for(const e of o){if(e.isHidden(this.transform.zoom))continue;const i=t.getLayerSourceCache(e);this.uploadLayer(this,e,i)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new SA),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!Kt.has(this.context.gl))return;this.renderPass="offscreen";for(const e of o){const i=t.getLayerSourceCache(e);if(!e.hasOffscreenPass()||e.isHidden(this.transform.zoom))continue;const r=i?u[i.id]:void 0;("custom"===e.type||"raster"===e.type||e.isSky()||r&&r.length)&&this.renderLayer(this,i,e,r)}this.depthRangeFor3D=[0,1-(o.length+2)*this.numSublayers*this.depthEpsilon];const _=this.terrain;_&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&_.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,d)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const y="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),v=(()=>{if(e.showOverdrawInspector)return hi.black;if(this.style.fog&&this.transform.projection.supportsFog&&!y){const t=this.style.fog.properties.get("color").toArray01();return new hi(...t)}if(this.style.fog&&this.transform.projection.supportsFog&&y){const t=this.style.fog.properties.get("space-color").toArray01();return new hi(...t)}return hi.transparent})();if(this.context.clear({color:v,depth:1}),this.clearStencil(),this._showOverdrawInspector=e.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&y&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=n.length-1;this.currentLayer>=0;this.currentLayer--){const e=o[this.currentLayer],i=t.getLayerSourceCache(e);if(e.isSky())continue;const r=i?(e.is3D()?p:u)[i.id]:void 0;this._renderTileClippingMasks(e,i,r),this.renderLayer(this,i,e,r)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&y&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||tp(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<n.length;this.currentLayer++){const e=o[this.currentLayer],i=t.getLayerSourceCache(e);e.isSky()&&this.renderLayer(this,i,e,i?u[i.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let x=0;for(g&&(x=g.getShadowCastingLayerCount());this.currentLayer<n.length;){const e=o[this.currentLayer],i=t.getLayerSourceCache(e);if(e.isSky()){++this.currentLayer;continue}if(_&&this.style.isLayerDraped(e)){if(e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=_.renderBatch(this.currentLayer);continue}let r;if(i&&(r=("symbol"===e.type?h:e.is3D()?p:u)[i.id]),this._renderTileClippingMasks(e,i,i?c[i.id]:void 0),this.renderLayer(this,i,e,r),!_&&g&&x>0&&e.hasShadowPass()&&0==--x&&(g.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const e=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=e;this.currentLayer++){const e=o[this.currentLayer];if(!e.hasLightBeamPass())continue;const i=t.getLayerSourceCache(e);this.renderLayer(this,i,e,i?u[i.id]:void 0)}this.currentLayer=e,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let e=null;o.forEach(i=>{const r=t.getLayerSourceCache(i);r&&!i.isHidden(this.transform.zoom)&&r.getVisibleCoordinates().length&&(!e||e.getSource().maxzoom<r.getSource().maxzoom)&&(e=r)}),e&&this.options.showTileBoundaries&&NA.debug(this,e,e.getVisibleCoordinates())}this.options.showPadding&&function(t){const e=t.transform.padding;fA(t,t.transform.height-(e.top||0),3,lA),fA(t,e.bottom||0,3,cA),mA(t,e.left||0,3,uA),mA(t,t.transform.width-(e.right||0),3,hA);const i=t.transform.centerPoint;!function(t,e,i,r){gA(t,e-1,i-10,2,20,r),gA(t,e-10,i-1,20,2,r)}(t,i.x,t.transform.height-i.y,dA)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(i.performance.now()),this.saveCanvasCopy()),l||(this.conflationActive=!1)}uploadLayer(t,e,i){this.gpuTimingStart(e),(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes(e.type)||t.terrain&&"custom"===e.type)&&UA[e.type+"Upload"]&&UA[e.type+"Upload"](t,i,e.scope),this.gpuTimingEnd()}renderLayer(t,e,i,r){i.isHidden(this.transform.zoom)||("background"===i.type||"sky"===i.type||"custom"===i.type||"model"===i.type||"raster"===i.type||r&&r.length)&&(this.id=i.id,this.gpuTimingStart(i),(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes(i.type)||t.terrain&&"custom"===i.type)&&NA[i.type](t,e,i,r,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const e=this.context.extTimerQuery,i=this.context.gl;let r=this.gpuTimers[t.id];r||(r=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:i.createQuery()}),r.calls++,i.beginQuery(e.TIME_ELAPSED_EXT,r.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,e=this.context.gl,i=e.createQuery();this.deferredRenderGpuTimeQueries.push(i),e.beginQuery(t.TIME_ELAPSED_EXT,i)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const e={};for(const i in t){const r=t[i],n=this.context.extTimerQuery,o=n.getQueryParameter(r.query,this.context.gl.QUERY_RESULT)/1e6;n.deleteQueryEXT(r.query),e[i]=o}return e}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const e=this.context.extTimerQuery,i=this.context.gl;let r=0;for(const n of t)r+=e.getQueryParameter(n,i.QUERY_RESULT)/1e6,e.deleteQueryEXT(n);return r}translatePosMatrix(t,e,i,r,n){if(!i[0]&&!i[1])return t;const o=n?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(o){const t=Math.sin(o),e=Math.cos(o);i=[i[0]*e-i[1]*t,i[0]*t+i[1]*e]}const s=[n?i[0]:ox(e,i[0],this.transform.zoom),n?i[1]:ox(e,i[1],this.transform.zoom),0],a=new Float32Array(16);return Jh.translate(a,t,s),a}saveTileTexture(t){const e=t.size[0],i=this._tileTextures[e];i?i.push(t):this._tileTextures[e]=[t]}getTileTexture(t){const e=this._tileTextures[t];return e&&e.length>0?e.pop():null}isPatternMissing(t,e){return null===t||void 0!==t&&!this.imageManager.getPattern(t.toString(),e)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(t,e,i){const r=void 0===i?this.terrain&&this.terrain.renderingToTexture:i,n=this.terrain&&0===this.terrain.exaggeration(),o=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===t||"terrainRaster"===t?(o.push("LIGHTING_3D_MODE"),o.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):r||o.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||o.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?o.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):o.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(o.push("TERRAIN"),this.linearFloatFilteringSupported()&&o.push("TERRAIN_DEM_FLOAT_FORMAT"),n&&o.push("ZERO_EXAGGERATION")),"globe"===this.transform.projection.name&&o.push("GLOBE"),!this._fogVisible||r||void 0!==e&&!e||o.push("FOG","FOG_DITHERING"),r&&o.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&o.push("OVERDRAW_INSPECTOR"),o}getOrCreateProgram(t,e){this.cache=this.cache||{};const i=e&&e.defines||[],r=e&&e.config,n=this.currentGlobalDefines(t,e&&e.overrideFog,e&&e.overrideRtt).concat(i),o=hS.cacheKey(NE[t],t,n,r);return this.cache[o]||(this.cache[o]=new hS(this.context,t,NE[t],r,XS[t],n)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=i.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Dy(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,e){if(this.style.enable3dLights()){const i=this.style.directionalLight,r=this.style.ambientLight;if(i&&r){const n=((t,e)=>{const i=t.properties.get("direction"),r=t.properties.get("color").toArray01(),n=t.properties.get("intensity"),o=e.properties.get("color").toArray01(),s=e.properties.get("intensity"),a=[i.x,i.y,i.z],l=at(o,s),c=at(r,n);return{u_lighting_ambient_color:l,u_lighting_directional_dir:a,u_lighting_directional_color:c,u_ground_radiance:lS(a,c,l)}})(i,r);e.setLightsUniformValues(t,n)}}}uploadCommonUniforms(t,e,i,r,n){if(this.uploadCommonLightUniforms(t,e),this.terrain&&this.terrain.renderingToTexture)return;const o=this.style.fog;if(o){const n=o.getOpacity(this.transform.pitch),s=((t,e,i,r,n,o,s,a,l,c,u,h)=>{const d=t.transform,p=e.properties.get("color").toArray01();p[3]=r;const f=t.frameCounter/1e3%1,[m,g]=e.properties.get("vertical-range");return{u_fog_matrix:i?d.calculateFogTileMatrix(i):h||t.identityMat,u_fog_range:e.getFovAdjustedRange(d._fov),u_fog_color:p,u_fog_horizon_blend:e.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(m,g),g],u_fog_temporal_offset:f,u_frustum_tl:n,u_frustum_tr:o,u_frustum_br:s,u_frustum_bl:a,u_globe_pos:l,u_globe_radius:c,u_viewport:u,u_globe_transition:tp(d.zoom),u_is_globe:+("globe"===d.projection.name)}})(this,o,i,n,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*pe.devicePixelRatio,this.transform.height*pe.devicePixelRatio],r);e.setFogUniformValues(t,s)}n&&e.setCutoffUniformValues(t,n.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),e}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&0!==t.getOpacity(this.transform.pitch)}getBackgroundTiles(){const t=this._backgroundTiles,e=this._backgroundTiles={},i=this.transform.coveringTiles({tileSize:512});for(const r of i)e[r.key]=t[r.key]||new jy(r,512,this.transform.tileZoom,this);return e}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(t,e){return!(!t.is3D()||t.minzoom&&t.minzoom>this.transform.zoom||"building"!==t.sourceLayer&&(!e||"batched-model"!==e.type))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let e=this._cachedTileFogOpacities[t.key];return e||(this._cachedTileFogOpacities[t.key]=e=this.style.fog.getOpacityForTile(t)),e[0]>=mw||e[1]>=mw}}const jA=2048;class VA{constructor(t,e){this.aabb=t,this.lastCascade=e}}class XA{add(t,e){const i=this.receivers[t.key];void 0!==i?(i.aabb.min[0]=Math.min(i.aabb.min[0],e.min[0]),i.aabb.min[1]=Math.min(i.aabb.min[1],e.min[1]),i.aabb.min[2]=Math.min(i.aabb.min[2],e.min[2]),i.aabb.max[0]=Math.max(i.aabb.max[0],e.max[0]),i.aabb.max[1]=Math.max(i.aabb.max[1],e.max[1]),i.aabb.max[2]=Math.max(i.aabb.max[2],e.max[2])):this.receivers[t.key]=new VA(e,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,e,i){const r=Ad.fromPoints(t.points);let n=0;for(const t in this.receivers){const o=this.receivers[t];if(!o)continue;if(!r.intersectsAabb(o.aabb))continue;o.aabb.min=r.closestPoint(o.aabb.min),o.aabb.max=r.closestPoint(o.aabb.max);const s=o.aabb.getCorners();for(let t=0;t<i.length;t++){let r=!0;for(const n of s){const o=[n[0]*e,n[1]*e,n[2]];if(nd.transformMat4(o,o,i[t].matrix),o[0]<-1||o[0]>1||o[1]<-1||o[1]>1){r=!1;break}}if(o.lastCascade=t,n=Math.max(n,t),r)break}}return n+1}}class HA{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new XA,this._depthMode=new Rv(t.context.gl.LEQUAL,Rv.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,e){const i=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!e||!e.properties)return;const r=e.properties.get("shadow-intensity");if(!e.shadowsEnabled()||r<=0)return;if(this._shadowLayerCount=i.style.order.reduce((e,r)=>{const n=i.style._mergedLayers[r];return e+(n.hasShadowPass()&&!n.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled)return;const n=i.context,o=jA,s=jA;if(0===this._cascades.length)for(let t=0;t<2;++t){const t=i._shadowMapDebug,e=n.gl,r=n.createFramebuffer(o,s,t,"texture"),a=new Dy(n,{width:o,height:s,data:null},e.DEPTH_COMPONENT);if(r.depthAttachment.set(a.texture),t){const t=new Dy(n,{width:o,height:s,data:null},e.RGBA);r.colorAttachment.set(t.texture)}this._cascades.push({framebuffer:r,texture:a,matrix:[],far:0,boundingSphereRadius:0,frustum:new Sd,scale:0})}this.shadowDirection=WA(e);let a=0;if(t.elevation){const e=t.elevation,i=[1e4,-1e4];e.visibleDemTiles.filter(t=>t.dem).forEach(t=>{const e=t.dem.tree;i[0]=Math.min(i[0],e.minimums[0]),i[1]=Math.max(i[1],e.maximums[0])}),1e4!==i[0]&&(a=(i[1]-i[0])*e.exaggeration())}const l=1.5*t.cameraToCenterDistance,c=3*l,u=new Float64Array(16);for(let e=0;e<2;++e){const i=this._cascades[e];let r=t.height/50,n=1;0===e?n=l:(r=l,n=c);const[o,s]=YA(t,this.shadowDirection,r,n,jA,a);i.scale=t.scale,i.matrix=o,i.boundingSphereRadius=s,Jh.invert(u,i.matrix),i.frustum=Sd.fromInvProjectionMatrix(u,1,0,!0),i.far=n}this._uniformValues.u_fade_range=[.75*this._cascades[1].far,this._cascades[1].far],this._uniformValues.u_shadow_intensity=r,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=jA,this._uniformValues.u_shadowmap_0=US,this._uniformValues.u_shadowmap_1=US+1,this._groundShadowTiles=i.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const h=i.transform.elevation;for(const t of this._groundShadowTiles){let e={min:0,max:0};if(h){const i=h.getMinMaxForTile(t);i&&(e=i)}this.addShadowReceiver(t.toUnwrapped(),e.min,e.max)}}get enabled(){return this._enabled}set enabled(t){this._enabled=t}drawShadowPass(t,e){if(!this._enabled)return;const i=this.painter,r=i.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(i.transform.getFrustum(0),i.transform.worldSize,this._cascades),r.viewport.set([0,0,jA,jA]);for(let n=0;n<this._numCascadesToRender;++n){i.currentShadowCascade=n,r.bindFramebuffer.set(this._cascades[n].framebuffer.framebuffer),r.clear({color:hi.white,depth:1});for(const r of t.order){const n=t._mergedLayers[r];if(!n.hasShadowPass()||n.isHidden(i.transform.zoom))continue;const o=t.getLayerSourceCache(n),s=o?e[o.id]:void 0;("model"===n.type||s&&s.length)&&i.renderLayer(i,o,n,s)}}i.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const t=this.painter,e=t.style,i=t.context,r=e.directionalLight,n=e.ambientLight;if(!r||!n)return;const o=[],s=ZE(t,t.longestCutoffRange);s.shouldRenderCutoff&&o.push("RENDER_CUTOFF");const a=$A(r,n),l=new Rv(i.gl.LEQUAL,Rv.ReadOnly,t.depthRangeFor3D);for(const e of this._groundShadowTiles){const r=e.toUnwrapped(),n=t.isTileAffectedByFog(e),c=t.getOrCreateProgram("groundShadow",{defines:o,overrideFog:n});this.setupShadows(r,c),t.uploadCommonUniforms(i,c,r,null,s);const u={u_matrix:t.transform.calculateProjMatrix(r),u_ground_shadow_factor:a};c.draw(t,i.gl.TRIANGLES,l,Ov.disabled,Dv.multiply,Lv.disabled,u,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Dv.unblended:Dv.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const e=this.painter.transform,i=e.calculatePosMatrix(t,e.worldSize);return Jh.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}calculateShadowPassMatrixFromMatrix(t){return Jh.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,e,i,r=0){if(!this._enabled)return;const n=this.painter.transform,o=this.painter.context,s=o.gl,a=this._uniformValues,l=new Float64Array(16),c=n.calculatePosMatrix(t,n.worldSize);for(let t=0;t<2;t++)Jh.multiply(l,this._cascades[t].matrix,c),a[0===t?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(l),o.activeTexture.set(s.TEXTURE0+US+t),this._cascades[t].texture.bind(s.NEAREST,s.CLAMP_TO_EDGE);if(this.useNormalOffset=!!i,this.useNormalOffset){const e=Mp(t.canonical),o=2/n.tileSize*ur/jA,s=o*this._cascades[0].boundingSphereRadius,l=o*this._cascades[1].boundingSphereRadius,c=("vector-tile"===i?1:3)/Math.pow(2,r-t.canonical.z-(1-n.zoom+Math.floor(n.zoom)));a.u_shadow_normal_offset=[e,s*c,l*c],a.u_shadow_bias=[6e-5,.0012,.012]}else a.u_shadow_bias=[36e-5,.0012,.012];e.setShadowUniformValues(o,a)}setupShadowsFromMatrix(t,e,i=!1){if(!this._enabled)return;const r=this.painter.context,n=r.gl,o=this._uniformValues,s=new Float64Array(16);for(let e=0;e<2;e++)Jh.multiply(s,this._cascades[e].matrix,t),o[0===e?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(s),r.activeTexture.set(n.TEXTURE0+US+e),this._cascades[e].texture.bind(n.NEAREST,n.CLAMP_TO_EDGE);if(this.useNormalOffset=i,i){const t=5;o.u_shadow_normal_offset=[1,t,t],o.u_shadow_bias=[6e-5,.0012,.012]}else o.u_shadow_bias=[36e-5,.0012,.012];e.setShadowUniformValues(r,o)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,e,i,r){if(r[2]>=0)return{};const n=function(t,e,i){const r=i/(1<<t.canonical.z);return new Ad([t.canonical.x*r+t.wrap*i,t.canonical.y*r+t.wrap*i,0],[(t.canonical.x+1)*r+t.wrap*i,(t.canonical.y+1)*r+t.wrap*i,e])}(t,e,i).getCorners(),o=e/-r[2];r[0]<0?(nd.add(n[0],n[0],[r[0]*o,0,0]),nd.add(n[3],n[3],[r[0]*o,0,0])):r[0]>0&&(nd.add(n[1],n[1],[r[0]*o,0,0]),nd.add(n[2],n[2],[r[0]*o,0,0])),r[1]<0?(nd.add(n[0],n[0],[0,r[1]*o,0]),nd.add(n[1],n[1],[0,r[1]*o,0])):r[1]>0&&(nd.add(n[2],n[2],[0,r[1]*o,0]),nd.add(n[3],n[3],[0,r[1]*o,0]));const s={};return s.vertices=n,s.planes=[qA(n[1],n[0],n[4]),qA(n[2],n[1],n[5]),qA(n[3],n[2],n[6]),qA(n[0],n[3],n[7])],s}addShadowReceiver(t,e,i){this._receivers.add(t,Ad.fromTileIdAndHeight(t,e,i))}getMaxCascadeForTile(t){const e=this._receivers.get(t);return e&&e.lastCascade?e.lastCascade:0}}function qA(t,e,i){const r=nd.sub([],i,e),n=nd.sub([],t,e),o=nd.cross([],r,n),s=nd.length(o);return 0===s?[0,0,1,0]:(nd.scale(o,o,1/s),[o[0],o[1],o[2],-nd.dot(o,e)])}function WA(t){const e=t.properties.get("direction"),i=Q(e.x,e.y,e.z);i[2]=R(i[2],0,75);const r=J([i[0],i[1],i[2]]);return nd.fromValues(r.x,r.y,r.z)}function $A(t,e){const i=t.properties.get("color"),r=t.properties.get("intensity"),n=t.properties.get("direction"),o=[n.x,n.y,n.z],s=e.properties.get("color"),a=e.properties.get("intensity"),l=Math.max(nd.dot([0,0,1],o),0),c=[0,0,0];nd.scale(c,s.toArray01Linear().slice(0,3),a);const u=[0,0,0];return nd.scale(u,i.toArray01Linear().slice(0,3),l*r),lt([c[0]>0?c[0]/(c[0]+u[0]):0,c[1]>0?c[1]/(c[1]+u[1]):0,c[2]>0?c[2]/(c[2]+u[2]):0])}function YA(t,e,i,r,n,o){const s=t.zoom,a=t.scale,l=t.worldSize,c=1/l,u=t.aspect,h=Math.sqrt(1+u*u)*Math.tan(.5*t.fovX),d=h*h,p=r-i,f=r+i;let m,g;d>p/f?(m=r,g=r*h):(m=.5*f*(1+d),g=.5*Math.sqrt(p*p+2*(r*r+i*i)*d+f*f*d*d));const _=t.projection.pixelsPerMeter(t.center.lat,l),y=t._camera.getCameraToWorldMercator(),v=[0,0,-m*c];nd.transformMat4(v,v,y);let x=g*c;const b=t._edgeInsets;if(!(0===b.left&&0===b.top&&0===b.right&&0===b.bottom||b.left===b.right&&b.top===b.bottom)){const e=t._camera.getWorldToCamera(t.worldSize,"meters"===t.projection.zAxisUnit?_:1),n=t._camera.getCameraToClipPerspective(t._fov,t.width/t.height,i,r);n[8]=2*-t.centerOffset.x/t.width,n[9]=2*t.centerOffset.y/t.height;const o=new Float64Array(16);Jh.mul(o,n,e);const c=new Float64Array(16);Jh.invert(c,o);const u=Sd.fromInvProjectionMatrix(c,l,s,!0);for(const e of u.points){const i=((w=e)[0]/=a,w[1]/=a,w[2]=vp(w[2],t._center.lat),w);x=Math.max(x,nd.len(nd.subtract([],v,i)))}}var w;x*=n/(n-1);const T=Math.acos(e[2]),E=Math.atan2(-e[0],-e[1]),S=new Jv;S.position=v,S.setPitchBearing(T,E);const A=S.getWorldToCamera(l,_),M=x*l,I=Math.min(t._mercatorZfromZoom(17)*l*-2,-2*M),C=S.getCameraToClipOrthographic(-M,M,-M,M,I,(M+o*_)/e[2]),P=new Float64Array(16);Jh.multiply(P,C,A);const R=nd.fromValues(Math.floor(1e6*v[0])/1e6*l,Math.floor(1e6*v[1])/1e6*l,0),O=.5*n,D=[0,0,0];nd.transformMat4(D,R,P),nd.scale(D,D,O);const L=[Math.floor(D[0]),Math.floor(D[1]),Math.floor(D[2])],k=[0,0,0];nd.sub(k,D,L),nd.scale(k,k,-1/O);const B=new Float64Array(16);return Jh.identity(B),Jh.translate(B,B,k),Jh.multiply(P,B,P),[P,M]}class ZA extends Re{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.numModelsLoading={}}loadModel(t,e){return dT(this.requestManager.transformRequest(e,vt.Model).url).then(e=>{if(!e)return;const i=bT(e),r=new Ox(t,void 0,void 0,i);return r.computeBoundsAndApplyParent(),r}).catch(i=>{this.fire(new Pe(new Error(`Could not load model ${t} from ${e}: ${i.message}`)))})}load(t,e){this.models[e]||(this.models[e]={});const i=Object.keys(t);this.numModelsLoading[e]=(this.numModelsLoading[e]||0)+i.length;const r=[];for(const e of i)r.push(this.loadModel(e,t[e]));Promise.allSettled(r).then(t=>{for(let r=0;r<t.length;r++){const{status:n,value:o}=t[r];"fulfilled"===n&&o&&(this.models[e][i[r]]=o)}this.numModelsLoading[e]-=i.length,this.fire(new Ce("data",{dataType:"style"}))}).catch(t=>{this.fire(new Pe(new Error("Could not load models: "+t.message)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,e){return!!this.getModel(t,e)}getModel(t,e){return this.models[e]||(this.models[e]={}),this.models[e][t]}addModel(t,e,i){this.models[i]||(this.models[i]={}),this.hasModel(t,i)&&this.removeModel(t,i),this.load({[t]:this.requestManager.normalizeModelURL(e)},i)}addModels(t,e){const i={};for(const e in t)i[e]=this.requestManager.normalizeModelURL(t[e]);this.load(i,e)}removeModel(t,e){this.models[e]||(this.models[e]={});const i=this.models[e][t];delete this.models[e][t],i.destroy()}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,e){this.models[e]||(this.models[e]={});for(const i in this.models[e])this.models[e][i].upload(t.context)}}const KA=(t,e)=>ms(t,e&&e.filter(t=>"source.canvas"!==t.identifier)),JA=F(LT,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),QA=F(LT,["setCenter","setZoom","setBearing","setPitch"]),tM={version:8,layers:[],sources:{}},eM={duration:300,delay:0},iM=new Set(["fill","line","background","hillshade","raster"]);class rM extends Re{constructor(t,e={}){super(),this.map=t,this.scope=e.scope||"",this.fragments=[],this.importDepth=e.importDepth||0,this.importsCache=e.importsCache||new Map,this.resolvedImports=e.resolvedImports||new Set,this.transition=B({},eM),this._buildingIndex=new PT(this),this.crossTileSymbolIndex=new SE,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=e.styleChanges||new nl,this.dispatcher=e.dispatcher?e.dispatcher:new Sw(Ww(),this),e.imageManager?this.imageManager=e.imageManager:(this.imageManager=new uw,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=e.glyphManager?e.glyphManager:new m_(t._requestManager,e.localFontFamily?2:e.localIdeographFontFamily?1:0,e.localFontFamily||e.localIdeographFontFamily),e.modelManager?this.modelManager=e.modelManager:(this.modelManager=new ZA(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=new Map,this._configDependentLayers=new Set,this._config=e.config,this.dispatcher.broadcast("setReferrer",bt());const i=this;this._rtlTextPluginCallback=rM.registerForPluginStateChange(t=>{i.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},(t,e)=>{if(La(t),e&&e.every(t=>t))for(const t in i._sourceCaches){const e=i._sourceCaches[t],r=e.getSource().type;"vector"!==r&&"geojson"!==r||e.reload()}})}),this.on("data",t=>{if("source"!==t.dataType||"metadata"!==t.sourceDataType)return;const e=this.getOwnSource(t.sourceId);if(e&&e.vectorLayerIds)for(const t in this._layers){const i=this._layers[t];i.source===e.id&&this._validateLayer(i)}})}loadURL(t,e={}){this.fire(new Ce("dataloading",{dataType:"style"}));const i="boolean"==typeof e.validate?e.validate:!Ot(t);t=this.map._requestManager.normalizeStyleURL(t,e.accessToken),this.resolvedImports.add(t);const r=this.importsCache.get(t);if(r)return this._load(r,i);const n=this.map._requestManager.transformRequest(t,vt.Style);this._request=Tt(n,(e,r)=>{if(this._request=null,e)this.fire(new Pe(e));else if(r)return this.importsCache.set(t,r),this._load(r,i)})}loadJSON(t,e={}){this.fire(new Ce("dataloading",{dataType:"style"})),this._request=pe.frame(()=>{this._request=null,this._load(t,!1!==e.validate)})}loadEmpty(){this.fire(new Ce("dataloading",{dataType:"style"})),this._load(tM,!1)}_loadImports(t,e){if(this.importDepth>=4)return Y("Style doesn't support nesting deeper than 5"),Promise.resolve();const i=[];for(const r of t){const t=this._createFragmentStyle(r),n=new Promise(e=>{t.once("style.import.load",e),t.once("error",e)}).then(()=>this.mergeAll());if(i.push(n),this.resolvedImports.has(r.url)){t.loadEmpty();continue}const o=r.data||this.importsCache.get(r.url);o?t.loadJSON(o,{validate:e}):r.url?t.loadURL(r.url,{validate:e}):t.loadEmpty(),this.fragments.push({style:t,id:r.id,config:r.config})}return Promise.allSettled(i)}_createFragmentStyle(t){const e=this.scope?tl(t.id,this.scope):t.id,i=new rM(this.map,{scope:e,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:t.config});return i.setEventedParent(this.map,{style:i}),i}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const t=this.isRootStyle();this._shouldPrecompile=t,this.fire(new Ce(t?"style.load":"style.import.load"))}_load(t,e){const i=t.schema;if(this.isRootStyle()&&(t.fragment||i&&!1!==t.fragment)){const i=B({},tM,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(i,e)}if(this.setConfig(this._config,i),e&&KA(this,rs(t)))return;this._loaded=!0,this.stylesheet=W(t);for(const e in t.sources)this.addSource(e,t.sources[e],{validate:!1,isInitialLoad:!0});t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);const r=DT(this.stylesheet.layers);if(this._order=r.map(t=>t.id),this.stylesheet.light&&Y("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const t=this.stylesheet.lights[0];this.light=new dw(t.properties,t.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new dw(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const t of r){const e=lw(t,this.options);e.setScope(this.scope),e.isConfigDependent&&this._configDependentLayers.add(e.fqid),e.setEventedParent(this,{layer:{id:e.id}}),this._layers[e.id]=e,this._serializedLayers[e.id]=e.serialize();const i=this.getOwnLayerSourceCache(e),r=!!this.directionalLight&&this.directionalLight.shadowsEnabled();i&&e.canCastShadows()&&r&&(i.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const n=this.stylesheet.terrain;n&&(void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=pe.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?Y("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(n,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new Ce("data",{dataType:"style"})),t.imports?this._loadImports(t.imports,e).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return 0===this.importDepth}mergeAll(){let t,e,i,r,n,o,s,a;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(l=>{if(l.stylesheet){if(null!=l.light&&(t=l.light),l.stylesheet.lights)for(const t of l.stylesheet.lights)"ambient"===t.type&&null!=l.ambientLight&&(e=l.ambientLight),"directional"===t.type&&null!=l.directionalLight&&(i=l.directionalLight);r=this._prioritizeTerrain(r,l.terrain,l.stylesheet.terrain),l.stylesheet.fog&&null!=l.fog&&(n=l.fog),null!=l.stylesheet.camera&&(a=l.stylesheet.camera),null!=l.stylesheet.projection&&(o=l.stylesheet.projection),null!=l.stylesheet.transition&&(s=l.stylesheet.transition)}}),this.light=t,this.ambientLight=e,this.directionalLight=i,this.fog=n,null===r?delete this.terrain:this.terrain=r,this.camera=a||{"camera-projection":"perspective"},this.projection=o||{name:"mercator"},this.transition=B({},eM,s),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const e=i=>{for(const t of i.fragments)e(t.style);t(i)};e(this)}_prioritizeTerrain(t,e,i){const r=t&&0===t.drapeRenderMode;return null===i?e&&0===e.drapeRenderMode?e:r?t:null:null!=e&&(!t||r||e&&1===e.drapeRenderMode)?e:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(e=>{t=this._prioritizeTerrain(t,e.terrain,e.stylesheet.terrain)}),null===t?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(e=>{null!=e.stylesheet.projection&&(t=e.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},e={},i={};this.forEachFragmentStyle(r=>{for(const e in r._sourceCaches){const i=tl(e,r.scope);t[i]=r._sourceCaches[e]}for(const t in r._otherSourceCaches){const i=tl(t,r.scope);e[i]=r._otherSourceCaches[t]}for(const t in r._symbolSourceCaches){const e=tl(t,r.scope);i[e]=r._symbolSourceCaches[t]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=e,this._mergedSymbolSourceCaches=i}mergeLayers(){const t={},e=[],i={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(i=>{for(const r of i._order){const n=i._layers[r];if("slot"===n.type){const e=el(r);if(t[e])continue;t[e]=[]}n.slot&&t[n.slot]?t[n.slot].push(n):e.push(n)}}),this._mergedOrder=[];const r=(e=[])=>{for(const n of e)if("slot"===n.type){const e=el(n.id);t[e]&&r(t[e])}else{const t=tl(n.id,n.scope);this._mergedOrder.push(t),i[t]=n,n.is3D()&&(this._has3DLayers=!0),"circle"===n.type&&(this._hasCircleLayers=!0),"symbol"===n.type&&(this._hasSymbolLayers=!0)}};r(e),this._mergedLayers=i,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=B({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(t,e,i){let r,n,o;const s=pe.devicePixelRatio>1?"@2x":"";let a=Tt(e.transformRequest(e.normalizeSpriteURL(t,s,".json"),vt.SpriteJSON),(t,e)=>{a=null,o||(o=t,r=e,c())}),l=Ct(e.transformRequest(e.normalizeSpriteURL(t,s,".png"),vt.SpriteImage),(t,e)=>{l=null,o||(o=t,n=e,c())});function c(){if(o)i(o);else if(r&&n){const t=pe.getImageData(n),e={};for(const i in r){const{width:n,height:o,x:s,y:a,sdf:l,pixelRatio:c,stretchX:u,stretchY:h,content:d}=r[i],p=new bf({width:n,height:o});bf.copy(t,p,{x:s,y:a},{x:0,y:0},{width:n,height:o}),e[i]={data:p,pixelRatio:c,sdf:l,stretchX:u,stretchY:h,content:d}}i(null,e)}}return{cancel(){a&&(a.cancel(),a=null),l&&(l.cancel(),l=null)}}}(t,this.map._requestManager,(t,e)=>{if(this._spriteRequest=null,t)this.fire(new Pe(t));else if(e)for(const t in e)this.imageManager.addImage(t,this.scope,e[t]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new Ce("data",{dataType:"style"}))})}_validateLayer(t){const e=this.getOwnSource(t.source);if(!e)return;const i=t.sourceLayer;i&&("geojson"===e.type||e.vectorLayerIds&&-1===e.vectorLayerIds.indexOf(i))&&this.fire(new Pe(new Error(`Source layer "${i}" does not exist on source "${e.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded())return!1;if(!this.modelManager.isLoaded())return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,e)=>{const i=this.fragments[e];return i&&i.style&&(t.data=i.style.serialize()),t})}_serializeSources(){const t={};for(const e in this._sourceCaches){const i=this._sourceCaches[e].getSource();t[i.id]||(t[i.id]=i.serialize())}return t}_serializeLayers(t){const e=[];for(const i of t){const t=this._layers[i];t&&"custom"!==t.type&&e.push(t.serialize())}return e}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions())return!0;if(this.hasFogTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&("function"==typeof t.isLayerDraped?t.isLayerDraped(this.getLayerSourceCache(t)):iM.has(t.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const e=this.getOwnLayer(t);if(e)return e;this.fire(new Pe(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const e=this.getOwnSource(t);if(e)return e;this.fire(new Pe(new Error(`The source '${t}' does not exist in the map's style.`)))}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const e=this.calculateLightsBrightness();t.brightness=e||0,e!==this._brightness&&(this._brightness=e,this.dispatcher.broadcast("setBrightness",e));const i=this._changes.isDirty();if(this._changes.isDirty()){const e=this._changes.getLayerUpdatesByScope();for(const t in e){const{updatedIds:i,removedIds:r}=e[t];(i||r)&&this._updateWorkerLayers(t,i,r)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._changes.reset()}const r={};for(const t in this._mergedSourceCaches){const e=this._mergedSourceCaches[t];r[t]=e.used,e.used=!1}for(const e of this._mergedOrder){const i=this._mergedLayers[e];if(i.recalculate(t,this._availableImages),!i.isHidden(t.zoom)){const t=this.getLayerSourceCache(i);t&&(t.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let e=i.minzoom||0;e<(i.maxzoom||25.5);e++){const e=this.map.painter;if(e){const r=i.getProgramIds();if(!r)continue;for(const n of r){const r=i.getDefaultProgramParams(n,t.zoom);r&&(e.style=this,this.fog&&(e._fogVisible=!0,r.overrideFog=!0,e.getOrCreateProgram(n,r)),e._fogVisible=!1,r.overrideFog=!1,e.getOrCreateProgram(n,r),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(r.overrideRtt=!0,e.getOrCreateProgram(n,r)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const t in r){const e=this._mergedSourceCaches[t];r[t]!==e.used&&e.getSource().fire(new Ce("data",{sourceDataType:"visibility",dataType:"source",sourceId:e.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),i&&this.fire(new Ce("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=this._changes.getUpdatedImages();if(t.length){for(const e in this._sourceCaches)this._sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,e,i){const r=this.getFragmentStyle(t);r&&this.dispatcher.broadcast("updateLayers",{layers:e?r._serializeLayers(e):[],scope:t,removedIds:i||[],options:r.options})}setState(t){if(this._checkLoaded(),KA(this,rs(t)))return!1;(t=W(t)).layers=DT(t.layers);const e=function(t,e){if(!t)return[{command:LT.setStyle,args:[e]}];let i=[];try{if(!x(t.version,e.version))return[{command:LT.setStyle,args:[e]}];x(t.center,e.center)||i.push({command:LT.setCenter,args:[e.center]}),x(t.zoom,e.zoom)||i.push({command:LT.setZoom,args:[e.zoom]}),x(t.bearing,e.bearing)||i.push({command:LT.setBearing,args:[e.bearing]}),x(t.pitch,e.pitch)||i.push({command:LT.setPitch,args:[e.pitch]}),x(t.sprite,e.sprite)||i.push({command:LT.setSprite,args:[e.sprite]}),x(t.glyphs,e.glyphs)||i.push({command:LT.setGlyphs,args:[e.glyphs]}),x(t.imports,e.imports)||function(t=[],e=[],i){e=e||[];const r=(t=t||[]).map(UT),n=e.map(UT),o=t.reduce(GT,{}),s=e.reduce(GT,{}),a=r.slice();let l,c,u,h;for(l=0,c=0;l<r.length;l++)u=r[l],s.hasOwnProperty(u)?c++:(i.push({command:LT.removeImport,args:[u]}),a.splice(a.indexOf(u,c),1));for(l=0,c=0;l<n.length;l++)u=n[n.length-1-l],a[a.length-1-l]!==u&&(o.hasOwnProperty(u)?(i.push({command:LT.removeImport,args:[u]}),a.splice(a.lastIndexOf(u,a.length-c),1)):c++,h=a[a.length-l],i.push({command:LT.addImport,args:[s[u],h]}),a.splice(a.length-l,0,u));for(const t of e){const e=o[t.id];if(!e||x(e,t))continue;x(e.config,t.config)||i.push({command:LT.setImportConfig,args:[t.id,t.config]}),x(e.url,t.url)||i.push({command:LT.setImportUrl,args:[t.id,t.url]});const r=t.data;x(e&&e.data,r)||i.push({command:LT.setImportData,args:[t.id,r]})}}(t.imports,e.imports,i),x(t.transition,e.transition)||i.push({command:LT.setTransition,args:[e.transition]}),x(t.light,e.light)||i.push({command:LT.setLight,args:[e.light]}),x(t.fog,e.fog)||i.push({command:LT.setFog,args:[e.fog]}),x(t.projection,e.projection)||i.push({command:LT.setProjection,args:[e.projection]}),x(t.lights,e.lights)||i.push({command:LT.setLights,args:[e.lights]}),x(t.camera,e.camera)||i.push({command:LT.setCamera,args:[e.camera]});const r={},n=[];!function(t,e,i,r){let n;for(n in e=e||{},t=t||{})t.hasOwnProperty(n)&&(e.hasOwnProperty(n)||BT(n,i,r));for(n in e){if(!e.hasOwnProperty(n))continue;const o=e[n];t.hasOwnProperty(n)?x(t[n],o)||("geojson"===t[n].type&&"geojson"===o.type&&zT(t,e,n)?i.push({command:LT.setGeoJSONSourceData,args:[n,o.data]}):FT(n,e,i,r)):kT(n,e,i)}}(t.sources,e.sources,n,r);const o=[];t.layers&&t.layers.forEach(t=>{t.source&&r[t.source]?i.push({command:LT.removeLayer,args:[t.id]}):o.push(t)});let s=t.terrain;s&&r[s.source]&&(i.push({command:LT.setTerrain,args:[void 0]}),s=void 0),i=i.concat(n),x(s,e.terrain)||i.push({command:LT.setTerrain,args:[e.terrain]}),function(t,e,i){e=e||[];const r=(t=t||[]).map(UT),n=e.map(UT),o=t.reduce(GT,{}),s=e.reduce(GT,{}),a=r.slice(),l=Object.create(null);let c,u,h,d,p,f,m;for(c=0,u=0;c<r.length;c++)h=r[c],s.hasOwnProperty(h)?u++:(i.push({command:LT.removeLayer,args:[h]}),a.splice(a.indexOf(h,u),1));for(c=0,u=0;c<n.length;c++)h=n[n.length-1-c],a[a.length-1-c]!==h&&(o.hasOwnProperty(h)?(i.push({command:LT.removeLayer,args:[h]}),a.splice(a.lastIndexOf(h,a.length-u),1)):u++,f=a[a.length-c],i.push({command:LT.addLayer,args:[s[h],f]}),a.splice(a.length-c,0,h),l[h]=!0);for(c=0;c<n.length;c++)if(h=n[c],d=o[h],p=s[h],!l[h]&&!x(d,p))if(x(d.source,p.source)&&x(d["source-layer"],p["source-layer"])&&x(d.type,p.type)){for(m in NT(d.layout,p.layout,i,h,null,LT.setLayoutProperty),NT(d.paint,p.paint,i,h,null,LT.setPaintProperty),x(d.slot,p.slot)||i.push({command:LT.setSlot,args:[h,p.slot]}),x(d.filter,p.filter)||i.push({command:LT.setFilter,args:[h,p.filter]}),x(d.minzoom,p.minzoom)&&x(d.maxzoom,p.maxzoom)||i.push({command:LT.setLayerZoomRange,args:[h,p.minzoom,p.maxzoom]}),d)d.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&"slot"!==m&&(0===m.indexOf("paint.")?NT(d[m],p[m],i,h,m.slice(6),LT.setPaintProperty):x(d[m],p[m])||i.push({command:LT.setLayerProperty,args:[h,m,p[m]]}));for(m in p)p.hasOwnProperty(m)&&!d.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&"slot"!==m&&(0===m.indexOf("paint.")?NT(d[m],p[m],i,h,m.slice(6),LT.setPaintProperty):x(d[m],p[m])||i.push({command:LT.setLayerProperty,args:[h,m,p[m]]}))}else i.push({command:LT.removeLayer,args:[h]}),f=a[a.lastIndexOf(h)+1],i.push({command:LT.addLayer,args:[p,f]})}(o,e.layers,i)}catch(t){console.warn("Unable to compute style diff:",t),i=[{command:LT.setStyle,args:[e]}]}return i}(this.serialize(),t).filter(t=>!(t.command in QA));if(0===e.length)return!1;const i=e.filter(t=>!(t.command in JA));if(i.length>0)throw new Error(`Unimplemented: ${i.map(t=>t.command).join(", ")}.`);return e.forEach(t=>{this[t.command].apply(this,t.args)}),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,e){return this.getImage(t)?this.fire(new Pe(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,e),this._afterImageUpdated(t),this)}updateImage(t,e){this.imageManager.updateImage(t,this.scope,e)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new Pe(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new Ce("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,e,i={}){return this._checkLoaded(),this._validate(ps,"models."+t,e,null,i)||(this.modelManager.addModel(t,e,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new Pe(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,e,i={}){if(this._checkLoaded(),void 0!==this.getOwnSource(t))throw new Error(`There is already a source with ID "${t}".`);if(!e.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(e).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(e.type)>=0&&this._validate(ns,"sources."+t,e,null,i))return;this.map&&this.map._collectResourceTiming&&(e.collectResourceTiming=!0);const r=ST(t,e,this.dispatcher,this);r.scope=this.scope,r.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r.id),source:r.serialize(),sourceId:r.id}));const n=t=>{const e=(t?"symbol:":"other:")+r.id,i=tl(e,this.scope),n=this._sourceCaches[e]=new Bv(i,r,t);(t?this._symbolSourceCaches:this._otherSourceCaches)[r.id]=n,n.onAdd(this.map)};n(!1),"vector"!==e.type&&"geojson"!==e.type||n(!0),r.onAdd&&r.onAdd(this.map),i.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const e=this.getOwnSource(t);if(!e)throw new Error("There is no source with this ID");for(const e in this._layers)if(this._layers[e].source===t)return this.fire(new Pe(new Error(`Source "${t}" cannot be removed while layer "${e}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new Pe(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const i=this.getOwnSourceCaches(t);for(const t of i){const e=el(t.id);delete this._sourceCaches[e],this._changes.discardSourceCacheUpdate(t.id),t.fire(new Ce("data",{sourceDataType:"metadata",dataType:"source",sourceId:t.getSource().id})),t.setEventedParent(null),t.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),e.setEventedParent(null),e.onRemove&&e.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,e){this._checkLoaded(),this.getOwnSource(t).setData(e),this._changes.setDirty()}getOwnSource(t){const e=this.getOwnSourceCache(t);return e&&e.getSource()}getOwnSources(){const t=[];for(const e in this._otherSourceCaches){const i=this.getOwnSourceCache(e);i&&t.push(i.getSource())}return t}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const e=this._getTransitionParameters();for(const i of t){if(this._validate(ss,"lights",i))return;switch(i.type){case"ambient":if(this.ambientLight){const t=this.ambientLight;t.set(i),t.updateTransitions(e)}else this.ambientLight=new Aw(i,Mw,this.scope,this.options);break;case"directional":if(this.directionalLight){const t=this.directionalLight;t.set(i),t.updateTransitions(e)}else this.directionalLight=new Aw(i,Iw,this.scope,this.options)}}const i=new Ua(this.z||0,e);this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,e=this.ambientLight;if(!t||!e)return;const i=t=>.2126*(t[0]<=.03928?t[0]/12.92:Math.pow((t[0]+.055)/1.055,2.4))+.7152*(t[1]<=.03928?t[1]/12.92:Math.pow((t[1]+.055)/1.055,2.4))+.0722*(t[2]<=.03928?t[2]/12.92:Math.pow((t[2]+.055)/1.055,2.4)),r=t.properties.get("color").toArray01(),n=t.properties.get("intensity"),o=t.properties.get("direction"),s=1-Q(o.x,o.y,o.z)[2]/90,a=i(r)*n*s,l=e.properties.get("color").toArray01(),c=e.properties.get("intensity");return(a+i(l)*c)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(Qa(t)){const e=function(t){const e=t.indexOf("");return e>=0?t.slice(e+1):""}(t),i=this.fragments.find(({id:t})=>t===e);if(!i)throw new Error("Style import not found: "+t);const r=el(t);return i.style.getFragmentStyle(r)}{const e=this.fragments.find(({id:e})=>e===t);if(!e)throw new Error("Style import not found: "+t);return e.style}}getConfigProperty(t,e){const i=this.getFragmentStyle(t);if(!i)return null;const r=i.options.get(e),n=r?r.value||r.default:null;return n?n.serialize():null}setConfigProperty(t,e,i){const r=_o(i);if("success"!==r.result)return void KA(this,r.value);const n=r.value.expression,o=this.getFragmentStyle(t);if(!o)return;const s=o.options.get(e);s&&(o.options.set(e,{...s,value:n}),o.updateConfigDependencies())}setConfig(t,e){if(this._config=t,t||e)if(e){this.options.clear();for(const i in e){let r,n;const o=_o(e[i].default);if("success"===o.result&&(r=o.value.expression),t&&void 0!==t[i]){const e=_o(t[i]);"success"===e.result&&(n=e.value.expression)}const{minValue:s,maxValue:a,stepValue:l,type:c,values:u}=e[i];r?this.options.set(i,{default:r,value:n,minValue:s,maxValue:a,stepValue:l,type:c,values:u}):this.fire(new Pe(new Error(`No schema defined for config option "${i}".`)))}}else this.fire(new Pe(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const t of this._configDependentLayers){const e=this.getLayer(t);e&&(e.possiblyEvaluateVisibility(),this._updateLayer(e))}this.ambientLight&&this.ambientLight.scope===this.scope&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.scope===this.scope&&this.directionalLight.updateConfig(this.options),this._changes.setDirty()}addLayer(t,e,i={}){this._checkLoaded();const r=t.id;if(this._layers[r])return void this.fire(new Pe(new Error(`Layer with id "${r}" already exists on this map`)));let n;if("custom"===t.type){if(KA(this,function(t){const e=[],i=t.id;return void 0===i&&e.push({message:`layers.${i}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e}(t)))return;n=lw(t,this.options)}else{if("object"==typeof t.source&&(this.addSource(r,t.source),t=B(t=W(t),{source:r})),this._validate(cs,"layers."+r,t,{arrayIndex:-1},i))return;n=lw(t,this.options),this._validateLayer(n),n.setEventedParent(this,{layer:{id:r}}),this._serializedLayers[n.id]=n.serialize()}n.isConfigDependent&&this._configDependentLayers.add(n.fqid),n.setScope(this.scope);let o=this._order.length;if(e){const t=this._order.indexOf(e);if(-1===t)return void this.fire(new Pe(new Error(`Layer with id "${e}" does not exist on this map.`)));n.slot===this._layers[e].slot?o=t:Y(`Layer with id "${e}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(o,0,r),this._layerOrderChanged=!0,this._layers[r]=n;const s=this.getOwnLayerSourceCache(n),a=!!this.directionalLight&&this.directionalLight.shadowsEnabled();s&&n.canCastShadows()&&a&&(s.castsShadows=!0);const l=this._changes.getRemovedLayer(n);if(l&&n.source&&s&&"custom"!==n.type){this._changes.discardLayerRemoval(n);const t=tl(n.source,n.scope);l.type!==n.type?this._changes.updateSourceCache(t,"clear"):(this._changes.updateSourceCache(t,"reload"),s.pause())}this._updateLayer(n),n.onAdd&&n.onAdd(this.map),n.scope=this.scope,this.mergeLayers()}moveLayer(t,e){this._checkLoaded();const i=this._checkLayer(t);if(!i)return;if(t===e)return;const r=this._order.indexOf(t);this._order.splice(r,1);let n=this._order.length;if(e){const t=this._order.indexOf(e);if(-1===t)return void this.fire(new Pe(new Error(`Layer with id "${e}" does not exist on this map.`)));i.slot===this._layers[e].slot?n=t:Y(`Layer with id "${e}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(n,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const e=this._checkLayer(t);if(!e)return;e.setEventedParent(null);const i=this._order.indexOf(t);this._order.splice(i,1),delete this._layers[t],delete this._serializedLayers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(e.fqid),this._changes.removeLayer(e);const r=this.getOwnLayerSourceCache(e);if(r&&r.castsShadows){let t=!1;for(const i in this._layers)if(this._layers[i].source===e.source&&this._layers[i].canCastShadows()){t=!0;break}r.castsShadows=t}e.onRemove&&e.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const e in this._layers)if(this._layers[e].type===t)return!0;return!1}setLayerZoomRange(t,e,i){this._checkLoaded();const r=this._checkLayer(t);r&&(r.minzoom===e&&r.maxzoom===i||(null!=e&&(r.minzoom=e),null!=i&&(r.maxzoom=i),this._updateLayer(r)))}setSlot(t,e){this._checkLoaded();const i=this._checkLayer(t);i&&i.slot!==e&&(i.slot=e,this._updateLayer(i))}setFilter(t,e,i={}){this._checkLoaded();const r=this._checkLayer(t);if(r&&!x(r.filter,e))return null==e?(r.filter=void 0,void this._updateLayer(r)):void(this._validate(us,`layers.${r.id}.filter`,e,{layerType:r.type},i)||(r.filter=W(e),this._updateLayer(r)))}getFilter(t){const e=this._checkLayer(t);if(e)return W(e.filter)}setLayoutProperty(t,e,i,r={}){this._checkLoaded();const n=this._checkLayer(t);n&&(x(n.getLayoutProperty(e),i)||(n.setLayoutProperty(e,i,r),n.isConfigDependent&&this._configDependentLayers.add(n.fqid),this._updateLayer(n)))}getLayoutProperty(t,e){const i=this._checkLayer(t);if(i)return i.getLayoutProperty(e)}setPaintProperty(t,e,i,r={}){this._checkLoaded();const n=this._checkLayer(t);if(!n)return;if(x(n.getPaintProperty(e),i))return;const o=n.setPaintProperty(e,i,r);n.isConfigDependent&&this._configDependentLayers.add(n.fqid),o&&this._updateLayer(n),this._changes.updatePaintProperties(n)}getPaintProperty(t,e){const i=this._checkLayer(t);if(i)return i.getPaintProperty(e)}setFeatureState(t,e){this._checkLoaded();const i=t.source,r=t.sourceLayer,n=this._checkSource(i);if(!n)return;const o=n.type;if("geojson"===o&&r)return void this.fire(new Pe(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===o&&!r)return void this.fire(new Pe(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new Pe(new Error("The feature id parameter must be provided.")));const s=this.getOwnSourceCaches(i);for(const i of s)i.setFeatureState(r,t.id,e)}removeFeatureState(t,e){this._checkLoaded();const i=t.source,r=this._checkSource(i);if(!r)return;const n=r.type,o="vector"===n?t.sourceLayer:void 0;if("vector"===n&&!o)return void this.fire(new Pe(new Error("The sourceLayer parameter must be provided for vector source types.")));if(e&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new Pe(new Error("A feature id is required to remove its specific state property.")));const s=this.getOwnSourceCaches(i);for(const i of s)i.removeFeatureState(o,t.id,e)}getFeatureState(t){this._checkLoaded();const e=t.source,i=t.sourceLayer,r=this._checkSource(e);if(r){if("vector"!==r.type||i)return void 0===t.id&&this.fire(new Pe(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(e)[0].getFeatureState(i,t.id);this.fire(new Pe(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=B({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return B({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),e=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return q({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:e,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},t=>void 0!==t)}_updateLayer(t){this._changes.updateLayer(t);const e=this.getLayerSourceCache(t),i=tl(t.source,t.scope),r=this._changes.getUpdatedSourceCaches();t.source&&!r[i]&&e&&"raster"!==e.getSource().type&&(this._changes.updateSourceCache(i,"reload"),e.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const e=t=>"fill-extrusion"===this._mergedLayers[t].type,i=this.order,r={},n=[];for(let o=i.length-1;o>=0;o--){const s=i[o];if(e(s)){r[s]=o;for(const e of t){const t=e[s];if(t)for(const e of t)n.push(e)}}}n.sort((t,e)=>e.intersectionZ-t.intersectionZ);const o=[];for(let s=i.length-1;s>=0;s--){const a=i[s];if(e(a))for(let t=n.length-1;t>=0;t--){const e=n[t].feature;if(r[e.layer.id]<s)break;o.push(e),n.pop()}else for(const e of t){const t=e[a];if(t)for(const e of t)o.push(e.feature)}}return o}queryRenderedFeatures(t,e,i){e&&e.filter&&this._validate(us,"queryRenderedFeatures.filter",e.filter,null,e),e.scope=this.scope,e.availableImages=this._availableImages,e.serializedLayers=this._serializedLayers;const r={};if(e&&e.layers){if(!Array.isArray(e.layers))return this.fire(new Pe(new Error("parameters.layers must be an Array."))),[];for(const t of e.layers){const e=this._mergedLayers[t];if(!e)return this.fire(new Pe(new Error(`The layer '${t}' does not exist in the map's style and cannot be queried for features.`))),[];r[e.source]=!0}}const n=[],o=e.serializedLayers||{},s=e&&e.layers?e.layers.some(t=>{const e=this.getLayer(t);return e&&e.is3D()}):this.has3DLayers(),a=Cw.createFromScreenPoints(t,i);for(const t in this._mergedSourceCaches){const l=this._mergedSourceCaches[t].getSource();if(!l||l.scope!==e.scope)continue;const c=this._mergedSourceCaches[t].getSource().id;e.layers&&!r[c]||n.push(MT(this._mergedSourceCaches[t],this._mergedLayers,o,a,e,i,s,!!this.map._showQueryGeometry))}return this.placement&&n.push(function(t,e,i,r,n,o,s){const a={},l=o.queryRenderedSymbols(r),c=[];for(const t of Object.keys(l).map(Number))c.push(s[t]);c.sort(CT);for(const i of c){const r=i.featureIndex.lookupSymbolFeatures(l[i.bucketInstanceId],e,i.bucketIndex,i.sourceLayerIndex,n.filter,n.layers,n.availableImages,t);for(const t in r){const e=a[t]=a[t]||[],n=r[t];n.sort((t,e)=>{const r=i.featureSortOrder;if(r){const i=r.indexOf(t.featureIndex);return r.indexOf(e.featureIndex)-i}return e.featureIndex-t.featureIndex});for(const t of n)e.push(t)}}for(const e in a)a[e].forEach(r=>{const n=r.feature,o=i(t[e]);if(!o)return;const s=o.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=s});return a}(this._mergedLayers,o,this.getLayerSourceCache.bind(this),a.screenGeometry,e,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(n)}querySourceFeatures(t,e){e&&e.filter&&this._validate(us,"querySourceFeatures.filter",e.filter,null,e);const i=this.getOwnSourceCaches(t);let r=[];for(const t of i)r=r.concat(IT(t,e));return r}addSourceType(t,e,i){return rM.getSourceType(t)?i(new Error(`A source type called "${t}" already exists.`)):(rM.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},i):i(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,e,i={}){this._checkLoaded();const r=this.light.getLight();let n=!1;for(const e in t)if(!x(t[e],r[e])){n=!0;break}if(!n)return;const o=this._getTransitionParameters();this.light.setLight(t,e,i),this.light.updateTransitions(o)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(t,e=1){if(this._checkLoaded(),!t)return delete this.terrain,null===t?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let i=t;const r=null==t.source;if(1===e){if("object"==typeof i.source){const t="terrain-dem-src";this.addSource(t,i.source),i=W(i),i=B(i,{source:t})}const t=B({},i),e={};if(this.terrain&&r){t.source=this.terrain.get().source;const i=this.terrain?this.getFragmentStyle(this.terrain.scope):null;i&&(e.style=i.serialize())}if(this._validate(as,"terrain",t,e))return}if(!this.terrain||this.terrain.scope!==this.scope&&!r||this.terrain&&e!==this.terrain.drapeRenderMode){if(!i)return;this._createTerrain(i,e),this.fire(new Ce("data",{dataType:"style"}))}else{const e=this.terrain,r=e.get();for(const t of Object.keys(Oe.terrain))!i.hasOwnProperty(t)&&Oe.terrain[t].default&&(i[t]=Oe.terrain[t].default);for(const i in t)if(!x(t[i],r[i])){e.set(t,this.options),this.stylesheet.terrain=t;const i=this._getTransitionParameters({duration:0});e.updateTransitions(i),this.fire(new Ce("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const e=this.fog=new bw(t,this.map.transform);this.stylesheet.fog=e.get();const i=this._getTransitionParameters({duration:0});e.updateTransitions(i)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const e=this.fog;if(!x(e.get(),t)){e.set(t),this.stylesheet.fog=e.get();const i=this._getTransitionParameters({duration:0});e.updateTransitions(i)}}else this._createFog(t);this._markersNeedUpdate=!0}_getTransitionParameters(t){return{now:pe.now(),transition:B(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],e=[];for(const i in this._mergedLayers)this.isLayerDraped(this._mergedLayers[i])?t.push(i):e.push(i);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...e)}_createTerrain(t,e){const i=this.terrain=new fw(t,e,this.scope,this.options);1===e&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const r=this._getTransitionParameters({duration:0});i.updateTransitions(r)}_force3DLayerUpdate(){for(const t in this._layers){const e=this._layers[t];"fill-extrusion"===e.type&&this._updateLayer(e)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const e=this._layers[t];"symbol"===e.type&&this._updateLayer(e)}}_validate(t,e,i,r,n={}){if(n&&!1===n.validate)return!1;const o=B({},this.serialize());return KA(this,t.call(rs,B({key:e,style:o,value:i,styleSpec:Oe},r)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),Ba.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const e=this.getSourceCaches(t);for(const t of e)t.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const e=this.getSourceCaches(t);for(const t of e)t.resume(),t.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}updateSources(t){let e;this.directionalLight&&(e=WA(this.directionalLight));for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].update(t,void 0,void 0,e)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const e=this._sourceCaches[t];e.resume(),e.reload()}}_updatePlacement(t,e,i,r,n=!1){let o=!1,s=!1;const a={},l={};for(const e of this._mergedOrder){const i=this._mergedLayers[e];if("symbol"!==i.type)continue;const r=tl(i.source,i.scope);let n=a[r];if(!n){const t=this.getLayerSourceCache(i);if(!t)continue;const e=t.getRenderableIds(!0).map(e=>t.getTileByID(e));l[r]=e.slice(),n=a[r]=e.sort((t,e)=>e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1))}const s=this.crossTileSymbolIndex.addLayer(i,n,t.center.lng,t.projection);o=o||s}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),n=n||this._layerOrderChanged||0===i,this._layerOrderChanged&&this.fire(new Ce("neworder")),(n||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(pe.now(),t.zoom))&&(this.pauseablePlacement=new mE(t,this._mergedOrder,n,e,i,r,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,a,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(pe.now()),s=!0),o&&this.pauseablePlacement.placement.setStale()),s||o)for(const t of this._mergedOrder){const e=this._mergedLayers[t];"symbol"===e.type&&this.placement.updateLayerOpacities(e,a[tl(e.source,e.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(pe.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t){this._checkLoaded();const e=this.stylesheet.imports=this.stylesheet.imports||[];return-1!==e.findIndex(({id:e})=>e===t.id)?this.fire(new Pe(new Error(`Import with id '${t.id}' already exists in the map's style.`))):(e.push(t),this._loadImports([t],!0),this)}setImportUrl(t,e){this._checkLoaded();const i=this.stylesheet.imports||[],r=this.getImportIndex(t);if(-1===r)return this;i[r].url=e;const n=this.fragments[r];return n.style=this._createFragmentStyle(i[r]),n.style.on("style.import.load",()=>this.mergeAll()),n.style.loadURL(e),this}setImportData(t,e){this._checkLoaded();const i=this.getImportIndex(t),r=this.stylesheet.imports||[];return-1===i?this:e?(this.fragments[i].style.setState(e),this._reloadImports(),this):(delete r[i].data,this.setImportUrl(t,r[i].url))}setImportConfig(t,e){this._checkLoaded();const i=this.getImportIndex(t),r=this.stylesheet.imports||[];if(-1===i)return this;e?r[i].config=e:delete r[i].config;const n=this.fragments[i],o=n.style.stylesheet&&n.style.stylesheet.schema;return n.config=e,n.style.setConfig(e,o),n.style.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const e=this.stylesheet.imports||[],i=this.getImportIndex(t);return-1===i||(e.splice(i,1),this.fragments[i].style._remove(),this.fragments.splice(i,1),this._reloadImports()),this}getImportIndex(t){const e=(this.stylesheet.imports||[]).findIndex(e=>e.id===t);return-1===e&&this.fire(new Pe(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),e}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const e in this._mergedOtherSourceCaches){const i=this._mergedOtherSourceCaches[e];i&&t.push(i.getSource())}return t}getSource(t,e){const i=this.getSourceCache(t,e);return i&&i.getSource()}getLayerSource(t){const e=this.getLayerSourceCache(t);return e&&e.getSource()}getSourceCache(t,e){const i=tl(t,e);return this._mergedOtherSourceCaches[i]}getLayerSourceCache(t){const e=tl(t.source,t.scope);return"symbol"===t.type?this._mergedSymbolSourceCaches[e]:this._mergedOtherSourceCaches[e]}getSourceCaches(t){const e=[];return this._mergedOtherSourceCaches[t]&&e.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&e.push(this._mergedSymbolSourceCaches[t]),e}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const e in t){const i=t[e];"reload"===i?this.reloadSource(e):"clear"===i&&this.clearSource(e)}}updateLayers(t){const e=this._changes.getUpdatedPaintProperties();for(const i of e){const e=this.getLayer(i);e&&e.updateTransitions(t)}}getImages(t,e,i){this.imageManager.getImages(e.icons,e.scope,i),this._updateTilesForChangedImages();const r=t=>{t&&t.setDependencies(e.tileID.key,e.type,e.icons)};r(this._otherSourceCaches[e.source]),r(this._symbolSourceCaches[e.source])}getGlyphs(t,e,i){this.glyphManager.getGlyphs(e.stacks,e.scope,i)}getResource(t,e,i){return wt(e,i)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return"symbol"===t.type?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const e=[];return this._otherSourceCaches[t]&&e.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&e.push(this._symbolSourceCaches[t]),e}_isSourceCacheLoaded(t){const e=this.getOwnSourceCaches(t);return 0===e.length?(this.fire(new Pe(new Error(`There is no source with ID '${t}'`))),!1):e.every(t=>t.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function nM(t,e){let i=!1,r=null;const n=()=>{r=null,i&&(t(),r=setTimeout(n,e),i=!1)};return()=>(i=!0,r||n(),r)}rM.getSourceType=function(t){return ET[t]},rM.setSourceType=function(t,e){ET[t]=e},rM.registerForPluginStateChange=function(t){return t({pluginStatus:Oa,pluginURL:Da}),Ba.on("pluginStateChange",t),t};class oM{constructor(t){this._hashName=t&&encodeURIComponent(t),V(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=nM(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,i.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),i.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const e=sM(t);if(this._hashName){const t=this._hashName;let r=!1;const n=i.location.hash.slice(1).split("&").map(i=>{const n=i.split("=")[0];return n===t?(r=!0,`${n}=${e}`):i}).filter(t=>t);return r||n.push(`${t}=${e}`),"#"+n.join("&")}return"#"+e}_getCurrentHash(){const t=i.location.hash.replace("#","");if(this._hashName){let e;return t.split("&").map(t=>t.split("=")).forEach(t=>{t[0]===this._hashName&&(e=t)}),(e&&e[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const e=this._getCurrentHash();if(e.length>=3&&!e.some(t=>isNaN(t))){const i=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(e[3]||0):t.getBearing();return t.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:i,pitch:+(e[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=i.location.href.replace(/(#.+)?$/,this.getHashString());i.history.replaceState(i.history.state,null,t)}}function sM(t,e){const i=t.getCenter(),r=Math.round(100*t.getZoom())/100,n=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,n),s=Math.round(i.lng*o)/o,a=Math.round(i.lat*o)/o,l=t.getBearing(),c=t.getPitch();let u=e?`/${s}/${a}/${r}`:`${r}/${a}/${s}`;return(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+="/"+Math.round(c)),u}const aM={linearity:.3,easing:C(0,0,.3,1)},lM=B({deceleration:2500,maxSpeed:1400},aM),cM=B({deceleration:20,maxSpeed:1400},aM),uM=B({deceleration:1e3,maxSpeed:360},aM),hM=B({deceleration:1e3,maxSpeed:90},aM);class dM{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:pe.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,e=pe.now();for(;t.length>0&&e-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion())return;if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const e={zoom:0,bearing:0,pitch:0,pan:new v(0,0),pinchAround:void 0,around:void 0};for(const{settings:t}of this._inertiaBuffer)e.zoom+=t.zoomDelta||0,e.bearing+=t.bearingDelta||0,e.pitch+=t.pitchDelta||0,t.panDelta&&e.pan._add(t.panDelta),t.around&&(e.around=t.around),t.pinchAround&&(e.pinchAround=t.pinchAround);const i=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(e.pan.mag()){const n=fM(e.pan.mag(),i,B({},lM,t||{}));r.offset=e.pan.mult(n.amount/e.pan.mag()),r.center=this._map.transform.center,pM(r,n)}if(e.zoom){const t=fM(e.zoom,i,cM);r.zoom=this._map.transform.zoom+t.amount,pM(r,t)}if(e.bearing){const t=fM(e.bearing,i,uM);r.bearing=this._map.transform.bearing+R(t.amount,-179,179),pM(r,t)}if(e.pitch){const t=fM(e.pitch,i,hM);r.pitch=this._map.transform.pitch+t.amount,pM(r,t)}if(r.zoom||r.bearing){const t=void 0===e.pinchAround?e.around:e.pinchAround;r.around=t?this._map.unproject(t):this._map.getCenter()}return this.clear(),r.noMoveStart=!0,r}}function pM(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function fM(t,e,i){const{maxSpeed:r,linearity:n,deceleration:o}=i,s=R(t*n/(e/1e3),-r,r),a=Math.abs(s)/(o*n);return{easing:i.easing,duration:1e3*a,amount:s*(a/2)}}class mM extends Ce{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,i,r={}){const n=Te(e.getCanvasContainer(),i);super(t,B({point:n,lngLat:e.unproject(n),originalEvent:i},r)),this._defaultPrevented=!1,this.target=e}}class gM extends Ce{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,i){const r="touchend"===t?i.changedTouches:i.touches,n=Ee(e.getCanvasContainer(),r),o=n.map(t=>e.unproject(t)),s=n.reduce((t,e,i,r)=>t.add(e.div(r.length)),new v(0,0));super(t,{points:n,point:s,lngLats:o,lngLat:e.unproject(s),originalEvent:i}),this._defaultPrevented=!1}}class _M extends Ce{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,i){super(t,{originalEvent:i}),this._defaultPrevented=!1}}class yM{constructor(t,e){this._map=t,this._clickTolerance=e.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new _M(t.type,this._map,t))}mousedown(t,e){return this._mousedownPos=e,this._firePreventable(new mM(t.type,this._map,t))}mouseup(t){this._map.fire(new mM(t.type,this._map,t))}preclick(t){const e=B({},t);e.type="preclick",this._map.fire(new mM(e.type,this._map,e))}click(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||(this.preclick(t),this._map.fire(new mM(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new mM(t.type,this._map,t))}mouseover(t){this._map.fire(new mM(t.type,this._map,t))}mouseout(t){this._map.fire(new mM(t.type,this._map,t))}touchstart(t){return this._firePreventable(new gM(t.type,this._map,t))}touchmove(t){this._map.fire(new gM(t.type,this._map,t))}touchend(t){this._map.fire(new gM(t.type,this._map,t))}touchcancel(t){this._map.fire(new gM(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class vM{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new mM(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new mM("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new mM(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xM{constructor(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(ve(),this._startPos=this._lastPos=e,this._active=!0)}mousemoveWindow(t,e){if(!this._active)return;const i=e,r=this._startPos,n=this._lastPos;if(!r||!n||n.equals(i)||!this._box&&i.dist(r)<this._clickTolerance)return;this._lastPos=i,this._box||(this._box=fe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const o=Math.min(r.x,i.x),s=Math.max(r.x,i.x),a=Math.min(r.y,i.y),l=Math.max(r.y,i.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${o}px,${a}px)`,this._box.style.width=s-o+"px",this._box.style.height=l-a+"px")})}mouseupWindow(t,e){if(!this._active)return;const i=this._startPos,r=e;if(i&&0===t.button){if(this.reset(),we(),i.x!==r.x||i.y!==r.y)return this._map.fire(new Ce("boxzoomend",{originalEvent:t})),{cameraAnimation:t=>t.fitScreenCoordinates(i,r,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),xe(),delete this._startPos,delete this._lastPos}_fireEvent(t,e){return this._map.fire(new Ce(t,{originalEvent:e}))}}function bM(t,e){const i={};for(let r=0;r<t.length;r++)i[t[r].identifier]=e[r];return i}class wM{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,e,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),i.length===this.numTouches&&(this.centroid=function(t){const e=new v(0,0);for(const i of t)e._add(i);return e.div(t.length)}(e),this.touches=bM(i,e)))}touchmove(t,e,i){if(this.aborted||!this.centroid)return;const r=bM(i,e);for(const t in this.touches){const e=r[t];(!e||e.dist(this.touches[t])>30)&&(this.aborted=!0)}}touchend(t,e,i){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const t=!this.aborted&&this.centroid;if(this.reset(),t)return t}}}class TM{constructor(t){this.singleTap=new wM(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,e,i){this.singleTap.touchstart(t,e,i)}touchmove(t,e,i){this.singleTap.touchmove(t,e,i)}touchend(t,e,i){const r=this.singleTap.touchend(t,e,i);if(r){const e=t.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(r)<30;if(e&&i||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}class EM{constructor(){this._zoomIn=new TM({numTouches:1,numTaps:2}),this._zoomOut=new TM({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,e,i){this._zoomIn.touchstart(t,e,i),this._zoomOut.touchstart(t,e,i)}touchmove(t,e,i){this._zoomIn.touchmove(t,e,i),this._zoomOut.touchmove(t,e,i)}touchend(t,e,i){const r=this._zoomIn.touchend(t,e,i),n=this._zoomOut.touchend(t,e,i);return r?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(r)},{originalEvent:t})}):n?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(n)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const SM={0:1,2:2};class AM{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,e){return!1}_move(t,e){return{}}mousedown(t,e){if(this._lastPoint)return;const i=Se(t);this._correctButton(t,i)&&(this._lastPoint=e,this._eventButton=i)}mousemoveWindow(t,e){const i=this._lastPoint;if(i)if(t.preventDefault(),null!=this._eventButton&&function(t,e){const i=SM[e];return void 0===t.buttons||(t.buttons&i)!==i}(t,this._eventButton))this.reset();else if(this._moved||!(e.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=e,this._move(i,e)}mouseupWindow(t){this._lastPoint&&Se(t)===this._eventButton&&(this._moved&&we(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class MM extends AM{mousedown(t,e){super.mousedown(t,e),this._lastPoint&&(this._active=!0)}_correctButton(t,e){return 0===e&&!t.ctrlKey}_move(t,e){return{around:e,panDelta:e.sub(t)}}}class IM extends AM{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const i=.8*(e.x-t.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(t){t.preventDefault()}}class CM extends AM{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const i=-.5*(e.y-t.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(t){t.preventDefault()}}class PM{constructor(t,e){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=e.clickTolerance||1,this.reset(),V(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new v(0,0)}touchstart(t,e,i){return this._calculateTransform(t,e,i)}touchmove(t,e,i){if(this._active&&!(i.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===i.length&&!rt())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,e,i)}}touchend(t,e,i){this._calculateTransform(t,e,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,e,i){i.length>0&&(this._active=!0);const r=bM(i,e),n=new v(0,0),o=new v(0,0);let s=0;for(const t in r){const e=r[t],i=this._touches[t];i&&(n._add(e),o._add(e.sub(i)),s++,r[t]=e)}if(this._touches=r,s<this._minTouches||!o.mag())return;const a=o.div(s);return this._sum._add(a),this._sum.mag()<this._clickTolerance?void 0:{around:n.div(s),panDelta:a}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=fe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))+"px")}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class RM{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,e,i){return{}}touchstart(t,e,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([e[0],e[1]]))}touchmove(t,e,i){const r=this._firstTwoTouches;if(!r)return;t.preventDefault();const[n,o]=r,s=OM(i,e,n),a=OM(i,e,o);if(!s||!a)return;const l=this._aroundCenter?null:s.add(a).div(2);return this._move([s,a],l,t)}touchend(t,e,i){if(!this._firstTwoTouches)return;const[r,n]=this._firstTwoTouches,o=OM(i,e,r),s=OM(i,e,n);o&&s||(this._active&&we(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function OM(t,e,i){for(let r=0;r<t.length;r++)if(t[r].identifier===i)return e[r]}function DM(t,e){return Math.log(t/e)/Math.LN2}class LM extends RM{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,e){const i=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(DM(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:DM(this._distance,i),pinchAround:e}}}function kM(t,e){return 180*t.angleWith(e)/Math.PI}class BM extends RM{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,e){const i=this._vector;if(this._vector=t[0].sub(t[1]),i&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:kM(this._vector,i),pinchAround:e}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const e=25/(Math.PI*this._minDiameter)*360,i=this._startVector;if(!i)return!1;const r=kM(t,i);return Math.abs(r)<e}}function FM(t){return Math.abs(t.y)>Math.abs(t.x)}class zM extends RM{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,FM(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,e,i){const r=this._lastPoints;if(!r)return;const n=t[0].sub(r[0]),o=t[1].sub(r[1]);return this._map._cooperativeGestures&&!rt()&&i.touches.length<3||(this._valid=this.gestureBeginsVertically(n,o,i.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(n.y+o.y)/2*-.5})}gestureBeginsVertically(t,e,i){if(void 0!==this._valid)return this._valid;const r=t.mag()>=2,n=e.mag()>=2;if(!r&&!n)return;if(!r||!n)return null==this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const o=t.y>0==e.y>0;return FM(t)&&FM(e)&&o}}const NM={panStep:100,bearingStep:15,pitchStep:10};class UM{constructor(){const t=NM;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let e=0,i=0,r=0,n=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?i=-1:(t.preventDefault(),n=-1);break;case 39:t.shiftKey?i=1:(t.preventDefault(),n=1);break;case 38:t.shiftKey?r=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?r=-1:(t.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(i=0,r=0),{cameraAnimation:s=>{const a=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:GM,zoom:e?Math.round(a)+e*(t.shiftKey?2:1):a,bearing:s.getBearing()+i*this._bearingStep,pitch:s.getPitch()+r*this._pitchStep,offset:[-n*this._panStep,-o*this._panStep],center:s.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function GM(t){return t*(2-t)}const jM=4.000244140625;class VM{constructor(t,e){this._map=t,this._el=t.getCanvasContainer(),this._handler=e,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,V(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||rt()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let e=t.deltaMode===i.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const r=pe.now(),n=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==e&&e%jM==0?this._type="wheel":0!==e&&Math.abs(e)<4?this._type="trackpad":n>400?(this._type=null,this._lastValue=e,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(n*e)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,e+=this._lastValue)),t.shiftKey&&e&&(e/=4),this._type&&(this._lastWheelEvent=t,this._delta-=e,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const e=Te(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:e,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._map.transform;"wheel"===this._type&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const e=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const i="wheel"===this._type&&Math.abs(this._delta)>jM?this._wheelZoomRate:this._defaultZoomRate;let r=2/(1+Math.exp(-Math.abs(this._delta*i)));this._delta<0&&0!==r&&(r=1/r);const n=e(),o=Math.pow(2,n),s="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):o;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(s*r))),"wheel"===this._type&&(this._startZoom=n,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const i="number"==typeof this._targetZoom?this._targetZoom:e(),r=this._startZoom,n=this._easing;let o,s=!1;if("wheel"===this._type&&r&&n){const t=Math.min((pe.now()-this._lastWheelEventTime)/200,1);o=Yr(r,i,n(t)),t<1?this._frameId||(this._frameId=!0):s=!0}else o=i,s=!0;this._active=!0,s&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let a=o-e();return a*this._lastDelta<0&&(a=0),{noInertia:!0,needsRenderFrame:!s,zoomDelta:a,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let e=P;if(this._prevEase){const t=this._prevEase,i=(pe.now()-t.start)/t.duration,r=t.easing(i+.01)-t.easing(i),n=.27/Math.sqrt(r*r+1e-4)*.01;e=C(n,Math.sqrt(.0729-n*n),.25,1)}return this._prevEase={start:pe.now(),duration:t,easing:e},e}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=fe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(i.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))+"px")}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class XM{constructor(t,e){this._clickZoom=t,this._tapZoom=e}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class HM{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,e){return t.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:i.getZoom()+(t.shiftKey?-1:1),around:i.unproject(e)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qM{constructor(){this._tap=new TM({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,e,i){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=e[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(t,e,i))}touchmove(t,e,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const r=e[0],n=r.y-this._swipePoint.y;return this._swipePoint=r,t.preventDefault(),this._active=!0,{zoomDelta:n/128}}}else this._tap.touchmove(t,e,i)}touchend(t,e,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(t,e,i)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class WM{constructor(t,e,i){this._el=t,this._mousePan=e,this._touchPan=i}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class $M{constructor(t,e,i){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class YM{constructor(t,e,i,r){this._el=t,this._touchZoom=e,this._touchRotate=i,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ZM=t=>t.zoom||t.drag||t.pitch||t.rotate;class KM extends Ce{}class JM{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,e){const i=nd.sub([],e,t);this.radius=nd.length(i[2]<0?nd.div([],i,this.constants):[i[0],i[1],0])}projectRay(t){nd.div(t,t,this.constants),nd.normalize(t,t),nd.mul(t,t,this.constants);const e=nd.scale([],t,this.radius);if(e[2]>0){const t=nd.scale([],[0,0,1],nd.dot(e,[0,0,1])),i=nd.scale([],nd.normalize([],[e[0],e[1],0]),this.radius),r=nd.add([],e,nd.scale([],nd.sub([],nd.add([],i,t),e),2));e[0]=r[0],e[1]=r[1]}return e}}function QM(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class tI{constructor(t,e){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new dM(t),this._bearingSnap=e.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new JM,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(e),V(["handleEvent","handleWindowEvent"],this);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[i.document,"mousemove",{capture:!0}],[i.document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[i,"blur",void 0]];for(const[t,e,r]of this._listeners)t.addEventListener(e,t===i.document?this.handleWindowEvent:this.handleEvent,r)}destroy(){for(const[t,e,r]of this._listeners)t.removeEventListener(e,t===i.document?this.handleWindowEvent:this.handleEvent,r)}_addDefaultHandlers(t){const e=this._map,i=e.getCanvasContainer();this._add("mapEvent",new yM(e,t));const r=e.boxZoom=new xM(e,t);this._add("boxZoom",r);const n=new EM,o=new HM;e.doubleClickZoom=new XM(o,n),this._add("tapZoom",n),this._add("clickZoom",o);const s=new qM;this._add("tapDragZoom",s);const a=e.touchPitch=new zM(e);this._add("touchPitch",a);const l=new IM(t),c=new CM(t);e.dragRotate=new $M(t,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new MM(t),h=new PM(e,t);e.dragPan=new WM(i,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);const d=new BM,p=new LM;e.touchZoomRotate=new YM(i,p,d,s),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),this._add("blockableMapEvent",new vM(e));const f=e.scrollZoom=new VM(e,this);this._add("scrollZoom",f,["mousePan"]);const m=e.keyboard=new UM;this._add("keyboard",m);for(const i of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[i]&&e[i].enable(t[i])}_add(t,e,i){this._handlers.push({handlerName:t,handler:e,allowed:i}),this._handlersById[t]=e}stop(t){if(!this._updatingCamera){for(const{handler:t}of this._handlers)t.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ZM(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,e,i){for(const r in t)if(r!==i&&(!e||e.indexOf(r)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,t.type+"Window")}_getMapTouches(t){const e=[];for(const i of t)this._el.contains(i.target)&&e.push(i);return e}handleEvent(t,e){this._updatingCamera=!0;const i="renderFrame"===t.type,r=i?void 0:t,n={needsRenderFrame:!1},o={},s={},a=t.touches?this._getMapTouches(t.touches):void 0,l=a?Ee(this._el,a):i?void 0:Te(this._el,t);for(const{handlerName:i,handler:c,allowed:u}of this._handlers){if(!c.isEnabled())continue;let h;this._blockedByActive(s,u,i)?c.reset():c[e||t.type]&&(h=c[e||t.type](t,l,a),this.mergeHandlerResult(n,o,h,i,r),h&&h.needsRenderFrame&&this._triggerRenderFrame()),(h||c.isActive())&&(s[i]=c)}const c={};for(const t in this._previousActiveHandlers)s[t]||(c[t]=r);this._previousActiveHandlers=s,(Object.keys(c).length||QM(n))&&(this._changes.push([n,o,c]),this._triggerRenderFrame()),(Object.keys(s).length||QM(n))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:u}=n;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}mergeHandlerResult(t,e,i,r,n){if(!i)return;B(t,i);const o={handlerName:r,originalEvent:i.originalEvent||n};void 0!==i.zoomDelta&&(e.zoom=o),void 0!==i.panDelta&&(e.drag=o),void 0!==i.pitchDelta&&(e.pitch=o),void 0!==i.bearingDelta&&(e.rotate=o)}_applyChanges(){const t={},e={},i={};for(const[r,n,o]of this._changes)r.panDelta&&(t.panDelta=(t.panDelta||new v(0,0))._add(r.panDelta)),r.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+r.zoomDelta),r.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+r.bearingDelta),r.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+r.pitchDelta),void 0!==r.around&&(t.around=r.around),void 0!==r.aroundCoord&&(t.aroundCoord=r.aroundCoord),void 0!==r.pinchAround&&(t.pinchAround=r.pinchAround),r.noInertia&&(t.noInertia=r.noInertia),B(e,n),B(i,o);this._updateMapTransform(t,e,i),this._changes=[]}_updateMapTransform(t,e,i){const r=this._map,n=r.transform,o=t=>[t.x,t.y,t.z];if((t=>{const e=this._eventsInProgress.drag;return e&&!this._handlersById[e.handlerName].isActive()})()&&!QM(t)){const t=n.zoom;n.cameraElevationReference="sea",null!=this._originalZoom&&n._orthographicProjectionAtLowPitch&&"globe"!==n.projection.name&&0===n.pitch?(n.cameraElevationReference="ground",n.zoom=this._originalZoom):(n.recenterOnTerrain(),n.cameraElevationReference="ground"),t!==n.zoom&&this._map._update(!0)}if(n._isCameraConstrained&&r._stop(!0),!QM(t))return void this._fireEvents(e,i,!0);let{panDelta:s,zoomDelta:a,bearingDelta:l,pitchDelta:c,around:u,aroundCoord:h,pinchAround:d}=t;n._isCameraConstrained&&(a>0&&(a=0),n._isCameraConstrained=!1),void 0!==d&&(u=d),(a||(t=>e[t]&&!this._eventsInProgress[t])("drag"))&&u&&(this._dragOrigin=o(n.pointCoordinate3D(u)),this._originalZoom=n.zoom,this._trackingEllipsoid.setup(n._camera.position,this._dragOrigin)),n.cameraElevationReference="sea",r._stop(!0),u=u||r.transform.centerPoint,l&&(n.bearing+=l),c&&(n.pitch+=c),n._updateCameraState();const p=[0,0,0];if(s)if("mercator"===n.projection.name){const t=this._trackingEllipsoid.projectRay(n.screenPointToMercatorRay(u).dir),e=this._trackingEllipsoid.projectRay(n.screenPointToMercatorRay(u.sub(s)).dir);p[0]=e[0]-t[0],p[1]=e[1]-t[1]}else{const t=n.pointCoordinate(u);if("globe"===n.projection.name){s=s.rotate(-n.angle);const e=n._pixelsPerMercatorPixel/n.worldSize;p[0]=-s.x*Ap(bp(t.y))*e,p[1]=-s.y*Ap(n.center.lat)*e}else{const e=n.pointCoordinate(u.sub(s));t&&e&&(p[0]=e.x-t.x,p[1]=e.y-t.y)}}const f=n.zoom,m=[0,0,0];if(a){const t=o(h||n.pointCoordinate3D(u)),e={dir:nd.normalize([],nd.sub([],t,n._camera.position))};if(e.dir[2]<0){const i=n.zoomDeltaToMovement(t,a);nd.scale(m,e.dir,i)}}const g=nd.add(p,p,m);n._translateCameraConstrained(g),a&&Math.abs(n.zoom-f)>1e-4&&n.recenterOnTerrain(),n.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(e,i,!0)}_fireEvents(t,e,i){const r=ZM(this._eventsInProgress),n=ZM(t),o={};for(const e in t){const{originalEvent:i}=t[e];this._eventsInProgress[e]||(o[e+"start"]=i),this._eventsInProgress[e]=t[e]}!r&&n&&this._fireEvent("movestart",n.originalEvent);for(const t in o)this._fireEvent(t,o[t]);n&&this._fireEvent("move",n.originalEvent);for(const e in t){const{originalEvent:i}=t[e];this._fireEvent(e,i)}const s={};let a;for(const t in this._eventsInProgress){const{handlerName:i,originalEvent:r}=this._eventsInProgress[t];this._handlersById[i].isActive()||(delete this._eventsInProgress[t],a=e[i]||r,s[t+"end"]=a)}for(const t in s)this._fireEvent(t,s[t]);const l=ZM(this._eventsInProgress);if(i&&(r||n)&&!l){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),e=t=>0!==t&&-this._bearingSnap<t&&t<this._bearingSnap;t?(e(t.bearing||this._map.getBearing())&&(t.bearing=0),this._map.easeTo(t,{originalEvent:a})):(this._map.fire(new Ce("moveend",{originalEvent:a})),e(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,e){this._map.fire(new Ce(t,e?{originalEvent:e}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new KM("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const eI="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class iI extends Re{constructor(t,e){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=e.bearingSnap,this._respectPrefersReducedMotion=!1!==e.respectPrefersReducedMotion,V(["_renderFrameCallback"],this)}getCenter(){return new mp(this.transform.center.lng,this.transform.center.lat)}setCenter(t,e){return this.jumpTo({center:t},e)}panBy(t,e,i){return t=v.convert(t).mult(-1),this.panTo(this.transform.center,B({offset:t},e),i)}panTo(t,e,i){return this.easeTo(B({center:t},e),i)}getZoom(){return this.transform.zoom}setZoom(t,e){return this.jumpTo({zoom:t},e),this}zoomTo(t,e,i){return this.easeTo(B({zoom:t},e),i)}zoomIn(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}zoomOut(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}getBearing(){return this.transform.bearing}setBearing(t,e){return this.jumpTo({bearing:t},e),this}getPadding(){return this.transform.padding}setPadding(t,e){return this.jumpTo({padding:t},e),this}rotateTo(t,e,i){return this.easeTo(B({bearing:t},e),i)}resetNorth(t,e){return this.rotateTo(0,B({duration:1e3},t),e),this}resetNorthPitch(t,e){return this.easeTo(B({bearing:0,pitch:0,duration:1e3},t),e),this}snapToNorth(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this}getPitch(){return this.transform.pitch}setPitch(t,e){return this.jumpTo({pitch:t},e),this}cameraForBounds(t,e){t=Nc.convert(t);const i=e&&e.bearing||0,r=e&&e.pitch||0,n=t.getNorthWest(),o=t.getSouthEast();return this._cameraForBounds(this.transform,n,o,i,r,e)}_extendCameraOptions(t){const e={top:0,bottom:0,right:0,left:0};if("number"==typeof(t=B({padding:e,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding){const e=t.padding;t.padding={top:e,bottom:e,right:e,left:e}}return t.padding=B(e,t.padding),t}_minimumAABBFrustumDistance(t,e){const i=e.max[0]-e.min[0],r=e.max[1]-e.min[1];return i/r>t.aspect?i/(2*Math.tan(.5*t.fovX)*t.aspect):r/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,e,i,r,n,o){const s=t.clone(),a=this._extendCameraOptions(o);s.bearing=r,s.pitch=n;const l=mp.convert(e),c=mp.convert(i),u=.5*(l.lat+c.lat),h=.5*(l.lng+c.lng),d=Xd(u,h),p=nd.normalize([],d),f=nd.normalize([],nd.cross([],p,[0,1,0])),m=nd.cross([],f,p),g=[f[0],f[1],f[2],0,m[0],m[1],m[2],0,p[0],p[1],p[2],0,0,0,0,1],_=[d,Xd(l.lat,l.lng),Xd(c.lat,l.lng),Xd(c.lat,c.lng),Xd(l.lat,c.lng),Xd(u,l.lng),Xd(u,c.lng),Xd(l.lat,h),Xd(c.lat,h)];let y=Ad.fromPoints(_.map(t=>[nd.dot(f,t),nd.dot(m,t),nd.dot(p,t)]));const v=nd.transformMat4([],y.center,g);0===nd.squaredLength(v)&&nd.set(v,0,0,1),nd.normalize(v,v),nd.scale(v,v,Md),s.center=function([t,e,i]){const r=Math.hypot(t,e,i),n=Math.atan2(t,i),o=.5*Math.PI-Math.acos(-e/r);return new mp(E(n),E(o))}(v);const x=s.getWorldToCameraMatrix(),b=Jh.invert(new Float64Array(16),x);y=Ad.applyTransform(y,Jh.multiply([],x,g)),nd.transformMat4(v,v,x);const w=.5*(y.max[2]-y.min[2]),T=this._minimumAABBFrustumDistance(s,y),S=nd.scale([],[0,0,1],w),A=nd.add(S,v,S),M=T+(0===s.pitch?0:nd.distance(v,A)),I=s.globeCenterInViewSpace,C=nd.sub([],v,[I[0],I[1],I[2]]);nd.normalize(C,C),nd.scale(C,C,M);const P=nd.add([],v,C);nd.transformMat4(P,P,b);const R=dp/Md,O=nd.length(P),D=vp(Math.max(O*R-dp,Number.EPSILON),0),L=Math.min(s.zoomFromMercatorZAdjusted(D),a.maxZoom);return L>5.5?(s.setProjection({name:"mercator"}),s.zoom=L,this._cameraForBounds(s,e,i,r,n,o)):{center:s.center,zoom:L,bearing:r,pitch:n}}queryTerrainElevation(t,e){const i=this.transform.elevation;return i?(e=B({},{exaggerated:!0},e),i.getAtPoint(Ip.fromLngLat(t),null,e.exaggerated)):null}_cameraForBounds(t,e,i,r,n,o){if("globe"===t.projection.name)return this._cameraForBoundsOnGlobe(t,e,i,r,n,o);const s=t.clone(),a=this._extendCameraOptions(o),l=s.padding;s.bearing=r,s.pitch=n;const c=mp.convert(e),u=mp.convert(i),h=new mp(c.lng,u.lat),d=new mp(u.lng,c.lat),p=s.project(c),f=s.project(u),m=this.queryTerrainElevation(c),g=this.queryTerrainElevation(u),_=this.queryTerrainElevation(h),y=this.queryTerrainElevation(d),x=[[p.x,p.y,Math.min(m||0,g||0,_||0,y||0)],[f.x,f.y,Math.max(m||0,g||0,_||0,y||0)]];let b=Ad.fromPoints(x);const w=s.getWorldToCameraMatrix(),E=Jh.invert(new Float64Array(16),w);b=Ad.applyTransform(b,w);const S=nd.sub([],b.max,b.min),A=l.left||0,M=l.right||0,I=l.bottom||0,C=l.top||0,{left:P,right:R,top:O,bottom:D}=a.padding,L=.5*(A+M),k=.5*(C+I),B=Math.min(s.scaleZoom(s.scale*Math.min((s.width-(A+M+P+R))/S[0],(s.height-(I+C+D+O))/S[1])),a.maxZoom),F=s.scale/s.zoomScale(B);b=new Ad([b.min[0]-(P+L)*F,b.min[1]-(D+k)*F,b.min[2]],[b.max[0]+(R+L)*F,b.max[1]+(O+k)*F,b.max[2]]);const z=.5*S[2],N=this._minimumAABBFrustumDistance(s,b),U=[0,0,1,0];Xh.transformMat4(U,U,w),Xh.normalize(U,U);const G=nd.scale([],U,N+z),j=nd.add([],b.center,G),V=("number"==typeof a.offset.x&&"number"==typeof a.offset.y?new v(a.offset.x,a.offset.y):v.convert(a.offset)).rotate(-T(r));b.center[0]-=V.x*F,b.center[1]+=V.y*F,nd.transformMat4(b.center,b.center,E),nd.transformMat4(j,j,E);const X=[b.center[0],b.center[1],j[2]*s.pixelsPerMeter];nd.scale(X,X,1/s.worldSize);const H=xp(X[0]),q=bp(X[1]),W=Math.min(s._zoomFromMercatorZ(X[2]),a.maxZoom),$=new mp(H,q);return s.mercatorFromTransition&&W<5.5?(s.setProjection({name:"globe"}),s.zoom=W,this._cameraForBounds(s,e,i,r,n,o)):{center:$,zoom:W,bearing:r,pitch:n}}fitBounds(t,e,i){const r=this.cameraForBounds(t,e);return this._fitInternal(r,e,i)}fitScreenCoordinates(t,e,i,r,n){const o=v.convert(t),s=v.convert(e),a=new v(Math.min(o.x,s.x),Math.min(o.y,s.y)),l=new v(Math.max(o.x,s.x),Math.max(o.y,s.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(o,s))return this;const c=this.transform.pointLocation3D(a),u=this.transform.pointLocation3D(l),h=this.transform.pointLocation3D(new v(a.x,l.y)),d=this.transform.pointLocation3D(new v(l.x,a.y)),p=[Math.min(c.lng,u.lng,h.lng,d.lng),Math.min(c.lat,u.lat,h.lat,d.lat)],f=[Math.max(c.lng,u.lng,h.lng,d.lng),Math.max(c.lat,u.lat,h.lat,d.lat)],m=r&&r.pitch?r.pitch:this.getPitch(),g=this._cameraForBounds(this.transform,p,f,i,m,r);return this._fitInternal(g,r,n)}_fitInternal(t,e,i){return t?(delete(e=B(t,e)).padding,e.linear?this.easeTo(e,i):this.flyTo(e,i)):this}jumpTo(t,e){this.stop();const i=t.preloadOnly?this.transform.clone():this.transform;let r=!1,n=!1,o=!1;return"zoom"in t&&i.zoom!==+t.zoom&&(r=!0,i.zoom=+t.zoom),void 0!==t.center&&(i.center=mp.convert(t.center)),"bearing"in t&&i.bearing!==+t.bearing&&(n=!0,i.bearing=+t.bearing),"pitch"in t&&i.pitch!==+t.pitch&&(o=!0,i.pitch=+t.pitch),null==t.padding||i.isPaddingEqual(t.padding)||(i.padding=t.padding),t.preloadOnly?(this._preloadTiles(i),this):(this.fire(new Ce("movestart",e)).fire(new Ce("move",e)),r&&this.fire(new Ce("zoomstart",e)).fire(new Ce("zoom",e)).fire(new Ce("zoomend",e)),n&&this.fire(new Ce("rotatestart",e)).fire(new Ce("rotate",e)).fire(new Ce("rotateend",e)),o&&this.fire(new Ce("pitchstart",e)).fire(new Ce("pitch",e)).fire(new Ce("pitchend",e)),this.fire(new Ce("moveend",e)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||Y(eI),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,e){const i=this.transform;if(!i.projection.supportsFreeCamera)return Y(eI),this;this.stop();const r=i.zoom,n=i.pitch,o=i.bearing;i.setFreeCameraOptions(t);const s=r!==i.zoom,a=n!==i.pitch,l=o!==i.bearing;return this.fire(new Ce("movestart",e)).fire(new Ce("move",e)),s&&this.fire(new Ce("zoomstart",e)).fire(new Ce("zoom",e)).fire(new Ce("zoomend",e)),l&&this.fire(new Ce("rotatestart",e)).fire(new Ce("rotate",e)).fire(new Ce("rotateend",e)),a&&this.fire(new Ce("pitchstart",e)).fire(new Ce("pitch",e)).fire(new Ce("pitchend",e)),this.fire(new Ce("moveend",e)),this}easeTo(t,e){this._stop(!1,t.easeId),(!1===(t=B({offset:[0,0],duration:500,easing:P},t)).animate||this._prefersReducedMotion(t))&&(t.duration=0);const i=this.transform,r=this.getZoom(),n=this.getBearing(),o=this.getPitch(),s=this.getPadding(),a="zoom"in t?+t.zoom:r,l="bearing"in t?this._normalizeBearing(t.bearing,n):n,c="pitch"in t?+t.pitch:o,u="padding"in t?t.padding:i.padding,h=v.convert(t.offset);let d,p,f;if("globe"===i.projection.name){const e=Ip.fromLngLat(i.center),r=h.rotate(-i.angle);e.x+=r.x/i.worldSize,e.y+=r.y/i.worldSize;const n=e.toLngLat(),o=mp.convert(t.center||n);this._normalizeCenter(o),d=i.centerPoint.add(r),p=new v(e.x,e.y).mult(i.worldSize),f=new v(_p(o.lng),yp(o.lat)).mult(i.worldSize).sub(p)}else{d=i.centerPoint.add(h);const e=i.pointLocation(d),r=mp.convert(t.center||e);this._normalizeCenter(r),p=i.project(e),f=i.project(r).sub(p)}const m=i.zoomScale(a-r);let g,_;t.around&&(g=mp.convert(t.around),_=i.locationPoint(g));const y=this._zooming||a!==r,x=this._rotating||n!==l,b=this._pitching||c!==o,w=!i.isPaddingEqual(u),T=i=>v=>{if(y&&(i.zoom=Yr(r,a,v)),x&&(i.bearing=Yr(n,l,v)),b&&(i.pitch=Yr(o,c,v)),w&&(i.interpolatePadding(s,u,v),d=i.centerPoint.add(h)),g)i.setLocationAtPoint(g,_);else{const t=i.zoomScale(i.zoom-r),e=a>r?Math.min(2,m):Math.max(.5,m),n=Math.pow(e,1-v),o=i.unproject(p.add(f.mult(v*n)).mult(t));i.setLocationAtPoint(i.renderWorldCopies?o.wrap():o,d)}return t.preloadOnly||this._fireMoveEvents(e),i};if(t.preloadOnly){const e=this._emulate(T,t.duration,i);return this._preloadTiles(e),this}const E={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=y,this._rotating=x,this._pitching=b,this._padding=w,this._easeId=t.easeId,this._prepareEase(e,t.noMoveStart,E),this._ease(T(i),t=>{"sea"===i.cameraElevationReference&&i.recenterOnTerrain(),this._afterEase(e,t)},t),this}_prepareEase(t,e,i={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),e||i.moving||this.fire(new Ce("movestart",t)),this._zooming&&!i.zooming&&this.fire(new Ce("zoomstart",t)),this._rotating&&!i.rotating&&this.fire(new Ce("rotatestart",t)),this._pitching&&!i.pitching&&this.fire(new Ce("pitchstart",t))}_fireMoveEvents(t){this.fire(new Ce("move",t)),this._zooming&&this.fire(new Ce("zoom",t)),this._rotating&&this.fire(new Ce("rotate",t)),this._pitching&&this.fire(new Ce("pitch",t))}_afterEase(t,e){if(this._easeId&&e&&this._easeId===e)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const i=this._zooming,r=this._rotating,n=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,i&&this.fire(new Ce("zoomend",t)),r&&this.fire(new Ce("rotateend",t)),n&&this.fire(new Ce("pitchend",t)),this.fire(new Ce("moveend",t))}flyTo(t,e){if(this._prefersReducedMotion(t)){const i=F(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(i,e)}this.stop(),t=B({offset:[0,0],speed:1.2,curve:1.42,easing:P},t);const i=this.transform,r=this.getZoom(),n=this.getBearing(),o=this.getPitch(),s=this.getPadding(),a="zoom"in t?R(+t.zoom,i.minZoom,i.maxZoom):r,l="bearing"in t?this._normalizeBearing(t.bearing,n):n,c="pitch"in t?+t.pitch:o,u="padding"in t?t.padding:i.padding,h=i.zoomScale(a-r),d=v.convert(t.offset);let p=i.centerPoint.add(d);const f=i.pointLocation(p),m=mp.convert(t.center||f);this._normalizeCenter(m);const g=i.project(f),_=i.project(m).sub(g);let y=t.curve;const x=Math.max(i.width,i.height),b=x/h,w=_.mag();if("minZoom"in t){const e=R(Math.min(t.minZoom,r,a),i.minZoom,i.maxZoom),n=x/i.zoomScale(e-r);y=Math.sqrt(n/w*2)}const T=y*y;function E(t){const e=(b*b-x*x+(t?-1:1)*T*T*w*w)/(2*(t?b:x)*T*w);return Math.log(Math.sqrt(e*e+1)-e)}function S(t){return(Math.exp(t)-Math.exp(-t))/2}function A(t){return(Math.exp(t)+Math.exp(-t))/2}const M=E(0);let I=function(t){return A(M)/A(M+y*t)},C=function(t){return x*((A(M)*(S(e=M+y*t)/A(e))-S(M))/T)/w;var e},O=(E(1)-M)/y;if(Math.abs(w)<1e-6||!isFinite(O)){if(Math.abs(x-b)<1e-6)return this.easeTo(t,e);const i=b<x?-1:1;O=Math.abs(Math.log(b/x))/y,C=function(){return 0},I=function(t){return Math.exp(i*y*t)}}t.duration="duration"in t?+t.duration:1e3*O/("screenSpeed"in t?+t.screenSpeed/y:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const D=n!==l,L=c!==o,k=!i.isPaddingEqual(u),z=i=>h=>{const f=h*O,y=1/I(f);i.zoom=1===h?a:r+i.scaleZoom(y),D&&(i.bearing=Yr(n,l,h)),L&&(i.pitch=Yr(o,c,h)),k&&(i.interpolatePadding(s,u,h),p=i.centerPoint.add(d));const v=1===h?m:i.unproject(g.add(_.mult(C(f))).mult(y));return i.setLocationAtPoint(i.renderWorldCopies?v.wrap():v,p),i._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(e),i};if(t.preloadOnly){const e=this._emulate(z,t.duration,i);return this._preloadTiles(e),this}return this._zooming=!0,this._rotating=D,this._pitching=L,this._padding=k,this._prepareEase(e,!1),this._ease(z(i),()=>this._afterEase(e),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const t=this._onEaseEnd;this._onEaseEnd=void 0,t.call(this,e)}if(!t){const t=this.handlers;t&&t.stop(!1)}return this}_ease(t,e,i){!1===i.animate||0===i.duration?(t(1),e()):(this._easeStart=pe.now(),this._easeOptions=i,this._onEaseFrame=t,this._onEaseEnd=e,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((pe.now()-this._easeStart)/this._easeOptions.duration,1),e=this._onEaseFrame;e&&e(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,e){t=D(t,-180,180);const i=Math.abs(t-e);return Math.abs(t-360-e)<i&&(t-=360),Math.abs(t+360-e)<i&&(t+=360),t}_normalizeCenter(t){const e=this.transform;if(e.maxBounds)return;if("globe"!==e.projection.name&&!e.renderWorldCopies)return;const i=t.lng-e.center.lng;t.lng+=i>180?-360:i<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&pe.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,e,i){const r=Math.ceil(15*e/1e3),n=[],o=t(i.clone());for(let t=0;t<=r;t++){const e=o(t/r);n.push(e.clone())}return n}}class rI{constructor(t={}){this.options=t,V(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const e=this.options&&this.options.compact;return this._map=t,this._container=fe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=fe("button","mapboxgl-ctrl-attrib-button",this._container),fe("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=fe("div","mapboxgl-ctrl-attrib-inner",this._container),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,e){const i=this._map._getUIString("AttributionControl."+e);t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",i)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const e=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.ACCESS_TOKEN}];if(t){const i=e.reduce((t,i,r)=>(i.value&&(t+=`${i.key}=${i.value}${r<e.length-1?"&":""}`),t),"?");t.href=`${o.FEEDBACK_URL}/${i}#${sM(this._map,!0)}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}const e=this._map.style._mergedSourceCaches;for(const i in e){const r=e[i];if(r.used){const e=r.getSource();e.attribution&&t.indexOf(e.attribution)<0&&t.push(e.attribution)}}t.sort((t,e)=>t.length-e.length),t=t.filter((e,i)=>{for(let r=i+1;r<t.length;r++)if(t[r].indexOf(e)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const i=t.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,t.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class nI{constructor(){V(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=fe("div","mapboxgl-ctrl");const e=fe("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(0===Object.entries(t).length)return!0;for(const e in t){const i=t[e].getSource();if(i.hasOwnProperty("mapbox_logo")&&!i.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}}}class oI{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e}remove(t){const e=this._currentlyRunning,i=e?this._queue.concat(e):this._queue;for(const e of i)if(e.id===t)return void(e.cancelled=!0)}run(t=0){const e=this._currentlyRunning=this._queue;this._queue=[];for(const i of e)if(!i.cancelled&&(i.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function sI(t,e,i){if(t=new mp(t.lng,t.lat),e){const r=new mp(t.lng-360,t.lat),n=new mp(t.lng+360,t.lat),o=360*Math.ceil(Math.abs(t.lng-i.center.lng)/360),s=i.locationPoint(t).distSqr(e),a=e.x<0||e.y<0||e.x>i.width||e.y>i.height;i.locationPoint(r).distSqr(e)<s&&(a||Math.abs(r.lng-i.center.lng)<o)?t=r:i.locationPoint(n).distSqr(e)<s&&(a||Math.abs(n.lng-i.center.lng)<o)&&(t=n)}for(;Math.abs(t.lng-i.center.lng)>180;){const e=i.locationPoint(t);if(e.x>=0&&e.y>=0&&e.x<=i.width&&e.y<=i.height)break;t.lng>i.center.lng?t.lng-=360:t.lng+=360}return t}const aI={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class lI extends Re{constructor(t,e){if(super(),(t instanceof i.HTMLElement||e)&&(t=B({element:t},e)),V(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=v.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=fe("div");const e=41,i=27,r=me("svg",{display:"block",height:e*this._scale+"px",width:i*this._scale+"px",viewBox:`0 0 ${i} ${e}`},this._element),n=me("radialGradient",{id:"shadowGradient"},me("defs",{},r));me("stop",{offset:"10%","stop-opacity":.4},n),me("stop",{offset:"100%","stop-opacity":.05},n),me("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},r),me("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},r),me("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},r),me("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},r),this._offset=v.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",t=>{t.preventDefault()}),this._element.addEventListener("mousedown",t=>{t.preventDefault()});const r=this._element.classList;for(const t in aI)r.remove("mapboxgl-marker-anchor-"+t);r.add("mapboxgl-marker-anchor-"+this._anchor);const n=t&&t.className?t.className.trim().split(/\s+/):[];r.add(...n),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=mp.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const e=38.1,i=13.5,r=Math.sqrt(Math.pow(i,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-e],"bottom-left":[r,-1*(e-i+r)],"bottom-right":[-r,-1*(e-i+r)],left:[i,-1*(e-i)],right:[-i,-1*(e-i)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const e=t.code,i=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==i&&13!==i||this.togglePopup()}_onMapClick(t){const e=t.originalEvent.target,i=this._element;this._popup&&(e===i||i.contains(e))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,e=this._pos;if(!t||!e)return!1;const i=t.unproject(e),r=t.getFreeCameraOptions();if(!r.position)return!1;const n=r.position.toLngLat();return n.distanceTo(i)<.9*n.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const e=this._pos;if(!e||e.x<0||e.x>t.transform.width||e.y<0||e.y>t.transform.height)return void this._clearFadeTimer();const i=t.unproject(e);let r;t._showingGlobe()&&ap(t.transform,this._lngLat)?r=0:(r=1-t._queryFogOpacity(i),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(r*=this._occludedOpacity)),this._element.style.opacity=""+r,this._element.style.pointerEvents=r>0?"auto":"none",this._popup&&this._popup._setOpacity(r),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const e=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${t.x}px,${t.y}px)\n            ${aI[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${e.x}px,${e.y}px)\n        `}_calculateXYTransform(){const t=this._pos,e=this._map,i=this.getPitchAlignment();if(!e||!t||"map"!==i)return"";if(!e._showingGlobe()){const t=e.getPitch();return t?`rotateX(${t}deg)`:""}const r=E(sp(e.transform,this._lngLat)),n=t.sub(op(e.transform)),o=Math.abs(n.x)+Math.abs(n.y);if(0===o)return"";const s=r/o;return`rotateX(${-n.y*s}deg) rotateY(${n.x*s}deg)`}_calculateZTransform(){const t=this._pos,e=this._map;if(!e||!t)return"";let i=0;const r=this.getRotationAlignment();if("map"===r)if(e._showingGlobe()){const t=e.project(new mp(this._lngLat.lng,this._lngLat.lat+.001)),r=e.project(new mp(this._lngLat.lng,this._lngLat.lat-.001)).sub(t);i=E(Math.atan2(r.y,r.x))-90}else i=-e.getBearing();else if("horizon"===r){const r=O(4,6,e.getZoom()),n=op(e.transform);n.y+=r*e.transform.height;const o=t.sub(n),s=E(Math.atan2(o.y,o.x));i=(s>90?s-270:s+90)*(1-r)}return i+=this._rotation,i?`rotateZ(${i}deg)`:""}_update(t){i.cancelAnimationFrame(this._updateFrameId);const e=this._map;e&&(e.transform.renderWorldCopies&&(this._lngLat=sI(this._lngLat,this._pos,e.transform)),this._pos=e.project(this._lngLat),!0===t?this._updateFrameId=i.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),e._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(e._showingGlobe()||e.getTerrain()||e.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=v.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const e=this._map;if(!e)return;const i=this._pointerdownPos,r=this._positionDelta;if(i&&r){if(!this._isDragging){const r=this._clickTolerance||e._clickTolerance;if(t.point.dist(i)<r)return;this._isDragging=!0}this._pos=t.point.sub(r),this._lngLat=e.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new Ce("dragstart"))),this.fire(new Ce("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new Ce("dragend")),this._state="inactive"}_addDragHandler(t){const e=this._map,i=this._pos;e&&i&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(i),this._pointerdownPos=t.point,this._state="pending",e.on("mousemove",this._onMove),e.on("touchmove",this._onMove),e.once("mouseup",this._onUp),e.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const e=this._map;return e&&(t?(e.on("mousedown",this._addDragHandler),e.on("touchstart",this._addDragHandler)):(e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const cI={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},uI=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function hI(t=new v(0,0),e="bottom"){if("number"==typeof t){const i=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(e){case"top":return new v(0,t);case"top-left":return new v(i,i);case"top-right":return new v(-i,i);case"bottom":return new v(0,-t);case"bottom-left":return new v(i,-i);case"bottom-right":return new v(-i,-i);case"left":return new v(t,0);case"right":return new v(-t,0)}return new v(0,0)}return t instanceof v||Array.isArray(t)?v.convert(t):v.convert(t[e]||[0,0])}class dI{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const e=A((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-e)+this._end*e}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,e,i){this._start=this.getValue(e),this._end=t,this._startTime=e,this._endTime=e+i}}const pI={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},fI={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},mI={showCompass:!0,showZoom:!0,visualizePitch:!1};class gI{constructor(t,e,i=!1){this._clickTolerance=10,this.element=e,this.mouseRotate=new IM({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,i&&(this.mousePitch=new CM({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),V(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),e.addEventListener("mousedown",this.mousedown),e.addEventListener("touchstart",this.touchstart,{passive:!1}),e.addEventListener("touchmove",this.touchmove),e.addEventListener("touchend",this.touchend),e.addEventListener("touchcancel",this.reset)}down(t,e){this.mouseRotate.mousedown(t,e),this.mousePitch&&this.mousePitch.mousedown(t,e),ve()}move(t,e){const i=this.map,r=this.mouseRotate.mousemoveWindow(t,e),n=r&&r.bearingDelta;if(n&&i.setBearing(i.getBearing()+n),this.mousePitch){const r=this.mousePitch.mousemoveWindow(t,e),n=r&&r.pitchDelta;n&&i.setPitch(i.getPitch()+n)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){xe(),i.removeEventListener("mousemove",this.mousemove),i.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(B({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Te(this.element,t)),i.addEventListener("mousemove",this.mousemove),i.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Te(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=Ee(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=Ee(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const _I={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},yI={maxWidth:100,unit:"metric"},vI={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},xI={version:r,supported:ne,setRTLTextPlugin:function(t,e,i=!1){if(Oa===Ia||Oa===Ca||Oa===Pa)throw new Error("setRTLTextPlugin cannot be called multiple times.");Da=pe.resolveURL(t),Oa=Ia,Ra=e,ka(),i||za()},getRTLTextPluginStatus:Fa,Map:class extends iI{constructor(t){te.mark(Qt.create);const e=t;if(null!=(t=B({},fI,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&function(t){const e=t.navigator?t.navigator.userAgent:null;return!!function(t){if(null==it){const e=t.navigator?t.navigator.userAgent:null;it=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return it}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))}(i)&&(t.antialias=!1,Y("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Mx(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),t),this._interactive=t.interactive,this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._collectResourceTiming=t.collectResourceTiming,this._language=this._parseLanguage(t.language),this._worldview=t.worldview,this._renderTaskQueue=new oI,this._domRenderTaskQueue=new oI,this._controls=[],this._markers=[],this._popups=[],this._mapId=N(),this._locale=B({},pI,t.locale),this._clickTolerance=t.clickTolerance,this._cooperativeGestures=t.cooperativeGestures,this._performanceMetricsCollection=t.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new dI(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new Rt(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,this._contextCreateOptions=t.contextCreateOptions?{...t.contextCreateOptions}:{},"string"==typeof t.container){if(this._container=i.document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container.toString()}' not found.`)}else{if(!(t.container instanceof i.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(this._container.childNodes.length>0&&Y("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),V(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==i&&(this._fullscreenchangeEvent="onfullscreenchange"in i.document?"fullscreenchange":"webkitfullscreenchange",i.addEventListener("online",this._onWindowOnline,!1),i.addEventListener("resize",this._onWindowResize,!1),i.addEventListener("orientationchange",this._onWindowResize,!1),i.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),i.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new tI(this,t),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,(t.style||!t.testMode)&&this.setStyle(t.style||o.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.projection&&this.setProjection(t.projection),t.hash&&(this._hash=new oM("string"==typeof t.hash&&t.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==e.center&&null==e.zoom||(this.transform._unmodified=!1),this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch});const i=t.bounds;i&&(this.resize(),this.fitBounds(i,B({},t.fitBoundsOptions,{duration:0})))}this.resize(),t.attributionControl&&this.addControl(new rI({customAttribution:t.customAttribution})),this._logoControl=new nI,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update("style"===t.dataType),this.fire(new Ce(t.dataType+"data",t))}),this.on("dataloading",t=>{this.fire(new Ce(t.dataType+"dataloading",t))})}_getMapId(){return this._mapId}addControl(t,e){if(void 0===e&&(e=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new Pe(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=t.onAdd(this);this._controls.push(t);const r=this._controlPositions[e];return-1!==e.indexOf("bottom")?r.insertBefore(i,r.firstChild):r.appendChild(i),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new Pe(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(t);return e>-1&&this._controls.splice(e,1),t.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const e=!this._moving;return e&&this.fire(new Ce("movestart",t)).fire(new Ce("move",t)),this.fire(new Ce("resize",t)),e&&this.fire(new Ce("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(t){return this.transform.setMaxBounds(Nc.convert(t)),this._update()}setMinZoom(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new Ce("zoomstart")).fire(new Ce("zoom")).fire(new Ce("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new Ce("zoomstart")).fire(new Ce("zoom")).fire(new Ce("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new Ce("pitchstart")).fire(new Ce("pitch")).fire(new Ce("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null==t?85:t)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new Ce("pitchstart")).fire(new Ce("pitch")).fire(new Ce("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(t){return"auto"===t?i.navigator.language:Array.isArray(t)?0===t.length?void 0:t.map(t=>"auto"===t?i.navigator.language:t):t}setLanguage(t){const e=this._parseLanguage(t);if(!this.style||e===this._language)return this;this._language=e,this.style.reloadSources();for(const t of this._controls)t._setLanguage&&t._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(t){return this.style&&t!==this._worldview?(this._worldview=t,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(t){return this._lazyInitEmptyStyle(),t?"string"==typeof t&&(t={name:t}):t=null,this._useExplicitProjection=!!t,this._prioritizeAndUpdateProjection(t,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const t=this.transform,e=t.projection.name;let i;"globe"===e&&t.zoom>=6?(t.setMercatorFromTransition(),i=!0):"mercator"===e&&t.zoom<6&&(t.setProjection({name:"globe"}),i=!0),i&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(t,e){return this._updateProjection(t||e||{name:"mercator"})}_updateProjection(t){let e;return e="globe"===t.name&&this.transform.zoom>=6?this.transform.setMercatorFromTransition():this.transform.setProjection(t),this.style.applyProjectionUpdate(),e&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(t){return this.transform.locationPoint3D(mp.convert(t))}unproject(t){return this.transform.pointLocation3D(v.convert(t))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(t,e,i){if("mouseenter"===t||"mouseover"===t){let r=!1;const n=n=>{const o=e.filter(t=>this.getLayer(t)),s=o.length?this.queryRenderedFeatures(n.point,{layers:o}):[];s.length?r||(r=!0,i.call(this,new mM(t,this,n.originalEvent,{features:s}))):r=!1},o=()=>{r=!1};return{layers:new Set(e),listener:i,delegates:{mousemove:n,mouseout:o}}}if("mouseleave"===t||"mouseout"===t){let r=!1;const n=n=>{const o=e.filter(t=>this.getLayer(t));(o.length?this.queryRenderedFeatures(n.point,{layers:o}):[]).length?r=!0:r&&(r=!1,i.call(this,new mM(t,this,n.originalEvent)))},o=e=>{r&&(r=!1,i.call(this,new mM(t,this,e.originalEvent)))};return{layers:new Set(e),listener:i,delegates:{mousemove:n,mouseout:o}}}{const r=t=>{const r=e.filter(t=>this.getLayer(t)),n=r.length?this.queryRenderedFeatures(t.point,{layers:r}):[];n.length&&(t.features=n,i.call(this,t),delete t.features)};return{layers:new Set(e),listener:i,delegates:{[t]:r}}}}on(t,e,i){if(void 0===i)return super.on(t,e);if(Array.isArray(e)||(e=[e]),e)for(const t of e)if(!this._isValidId(t))return this;const r=this._createDelegatedListener(t,e,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(r);for(const t in r.delegates)this.on(t,r.delegates[t]);return this}once(t,e,i){if(void 0===i)return super.once(t,e);if(Array.isArray(e)||(e=[e]),e)for(const t of e)if(!this._isValidId(t))return this;const r=this._createDelegatedListener(t,e,i);for(const t in r.delegates)this.once(t,r.delegates[t]);return this}off(t,e,i){if(void 0===i)return super.off(t,e);e=new Set(Array.isArray(e)?e:[e]);for(const t of e)if(!this._isValidId(t))return this;const r=(t,e)=>{if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0},n=this._delegatedListeners?this._delegatedListeners[t]:void 0;return n&&(t=>{for(let n=0;n<t.length;n++){const o=t[n];if(o.listener===i&&r(o.layers,e)){for(const t in o.delegates)this.off(t,o.delegates[t]);return t.splice(n,1),this}}})(n),this}queryRenderedFeatures(t,e){if(!this.style)return[];if(void 0!==e||void 0===t||t instanceof v||Array.isArray(t)||(e=t,t=void 0),t=t||[[0,0],[this.transform.width,this.transform.height]],(e=e||{}).layers&&Array.isArray(e.layers))for(const t of e.layers)if(!this._isValidId(t))return[];return this.style.queryRenderedFeatures(t,e,this.transform)}querySourceFeatures(t,e){return this._isValidId(t)?this.style.querySourceFeatures(t,e):[]}isPointOnSurface(t){const{name:e}=this.transform.projection;return"globe"!==e&&"mercator"!==e&&Y(e+" projection does not support isPointOnSurface, this API may behave unexpectedly."),this.transform.isPointOnSurface(v.convert(t))}setStyle(t,e){return!1!==(e=B({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},e)).diff&&e.localIdeographFontFamily===this._localIdeographFontFamily&&e.localFontFamily===this._localFontFamily&&this.style&&t?(this._diffStyle(t,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._localFontFamily=e.localFontFamily,this._updateStyle(t,e))}_getUIString(t){const e=this._locale[t];if(null==e)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),t&&(this.style=new rM(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new rM(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,e){if("string"==typeof t){const i=this._requestManager.normalizeStyleURL(t),r=this._requestManager.transformRequest(i,vt.Style);Tt(r,(t,i)=>{t?this.fire(new Pe(t)):i&&this._updateDiff(i,e)})}else"object"==typeof t&&this._updateDiff(t,e)}_updateDiff(t,e){try{this.style.setState(t)&&this._update(!0)}catch(i){Y(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(t,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(Y("There is no style added to the map."),!1)}_isValidId(t){return null==t?(this.fire(new Pe(new Error("IDs can't be empty."))),!1):!Qa(t)||(this.fire(new Pe(new Error(`IDs can't contain special symbols: "${t}".`))),!1)}addSource(t,e){return this._isValidId(t)?(this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)):this}isSourceLoaded(t){return!!this._isValidId(t)&&!!this.style&&this.style._isSourceCacheLoaded(t)}areTilesLoaded(){const t=this.style&&this.style._sourceCaches;for(const e in t){const i=t[e]._tiles;for(const t in i){const e=i[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}}return!0}addSourceType(t,e,i){this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,i)}removeSource(t){return this._isValidId(t)?(this.style.removeSource(t),this._updateTerrain(),this._update(!0)):this}getSource(t){return this._isValidId(t)?this.style.getOwnSource(t):null}addImage(t,e,{pixelRatio:r=1,sdf:n=!1,stretchX:o,stretchY:s,content:a}={}){if(this._lazyInitEmptyStyle(),e instanceof i.HTMLImageElement||i.ImageBitmap&&e instanceof i.ImageBitmap){const{width:i,height:l,data:c}=pe.getImageData(e);this.style.addImage(t,{data:new bf({width:i,height:l},c),pixelRatio:r,stretchX:o,stretchY:s,content:a,sdf:n,version:0})}else if(void 0===e.width||void 0===e.height)this.fire(new Pe(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:i,height:l}=e,c=e;this.style.addImage(t,{data:new bf({width:i,height:l},new Uint8Array(c.data)),pixelRatio:r,stretchX:o,stretchY:s,content:a,sdf:n,version:0,userImage:c}),c.onAdd&&c.onAdd(this,t)}}updateImage(t,e){this._lazyInitEmptyStyle();const r=this.style.getImage(t);if(!r)return void this.fire(new Pe(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const n=e instanceof i.HTMLImageElement||i.ImageBitmap&&e instanceof i.ImageBitmap?pe.getImageData(e):e,{width:o,height:s}=n;void 0!==o&&void 0!==s?o===r.data.width&&s===r.data.height?(r.data.replace(n.data,!(e instanceof i.HTMLImageElement||i.ImageBitmap&&e instanceof i.ImageBitmap)),this.style.updateImage(t,r)):this.fire(new Pe(new Error(`The width and height of the updated image (${o}, ${s})\n                must be that same as the previous version of the image\n                (${r.data.width}, ${r.data.height})`))):this.fire(new Pe(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(t){return t?!!this.style&&!!this.style.getImage(t):(this.fire(new Pe(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(t,e){Ct(this._requestManager.transformRequest(t,vt.Image),(t,r)=>{e(t,r instanceof i.HTMLImageElement?pe.getImageData(r):r)})}listImages(){return this.style.listImages()}addModel(t,e){this._lazyInitEmptyStyle(),this.style.addModel(t,e)}hasModel(t){return t?this.style.hasModel(t):(this.fire(new Pe(new Error("Missing required model id"))),!1)}removeModel(t){this.style.removeModel(t)}listModels(){return this.style.listModels()}addLayer(t,e){return this._isValidId(t.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)):this}moveLayer(t,e){return this._isValidId(t)?(this.style.moveLayer(t,e),this._update(!0)):this}removeLayer(t){return this._isValidId(t)?(this.style.removeLayer(t),this._update(!0)):this}getLayer(t){return this._isValidId(t)?this.style.getOwnLayer(t):null}setLayerZoomRange(t,e,i){return this._isValidId(t)?(this.style.setLayerZoomRange(t,e,i),this._update(!0)):this}setFilter(t,e,i={}){return this._isValidId(t)?(this.style.setFilter(t,e,i),this._update(!0)):this}getFilter(t){return this._isValidId(t)?this.style.getFilter(t):null}setPaintProperty(t,e,i,r={}){return this._isValidId(t)?(this.style.setPaintProperty(t,e,i,r),this._update(!0)):this}getPaintProperty(t,e){return this._isValidId(t)?this.style.getPaintProperty(t,e):null}setLayoutProperty(t,e,i,r={}){return this._isValidId(t)?(this.style.setLayoutProperty(t,e,i,r),this._update(!0)):this}getLayoutProperty(t,e){return this._isValidId(t)?this.style.getLayoutProperty(t,e):null}getConfigProperty(t,e){return this.style.getConfigProperty(t,e)}setConfigProperty(t,e,i){return this.style.setConfigProperty(t,e,i),this._update(!0)}setLights(t){if(this._lazyInitEmptyStyle(),t&&1===t.length&&"flat"===t[0].type){const e=t[0];e.properties?this.style.setFlatLight(e.properties,e.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(t),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const t=this.style.getLights()||[];return 0===t.length&&t.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),t}setLight(t,e={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:t}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(t){return this._lazyInitEmptyStyle(),!t&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(t),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(t){return this._lazyInitEmptyStyle(),this.style.setFog(t),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(t){return this.style.setCamera(t),this._triggerCameraUpdate(t)}_triggerCameraUpdate(t){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===t["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(mp.convert(t),this.transform):0}setFeatureState(t,e){return this._isValidId(t.source)?(this.style.setFeatureState(t,e),this._update()):this}removeFeatureState(t,e){return this._isValidId(t.source)?(this.style.removeFeatureState(t,e),this._update()):this}getFeatureState(t){return this._isValidId(t.source)?this.style.getFeatureState(t):null}_updateContainerDimensions(){if(!this._container)return;const t=this._container.getBoundingClientRect().width||400,e=this._container.getBoundingClientRect().height||300;let r,n,o,s=this._container;for(;s&&(!n||!o);){const t=i.getComputedStyle(s).transform;t&&"none"!==t&&(r=t.match(/matrix.*\((.+)\)/)[1].split(", "),r[0]&&"0"!==r[0]&&"1"!==r[0]&&(n=r[0]),r[3]&&"0"!==r[3]&&"1"!==r[3]&&(o=r[3])),s=s.parentElement}this._containerWidth=n?Math.abs(t/n):t,this._containerHeight=o?Math.abs(e/o):e}_detectMissingCSS(){"rgb(250, 128, 114)"!==i.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&Y("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=fe("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();const e=this._canvasContainer=fe("div","mapboxgl-canvas-container",t);this._canvas=fe("canvas","mapboxgl-canvas",e),this._interactive&&(e.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=fe("div","mapboxgl-control-container",t),r=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(t=>{r[t]=fe("div","mapboxgl-ctrl-"+t,i)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,e){const i=pe.devicePixelRatio||1;this._canvas.width=i*Math.ceil(t),this._canvas.height=i*Math.ceil(e),this._canvas.style.width=t+"px",this._canvas.style.height=e+"px"}_addMarker(t){this._markers.push(t)}_removeMarker(t){const e=this._markers.indexOf(t);-1!==e&&this._markers.splice(e,1)}_addPopup(t){this._popups.push(t)}_removePopup(t){const e=this._popups.indexOf(t);-1!==e&&this._popups.splice(e,1)}_setupPainter(){const t=B({},ne.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),e=this._canvas.getContext("webgl2",t);e?(Jt(e,!0),this.painter=new GA(e,this._contextCreateOptions,this.transform),this.on("data",t=>{"source"===t.dataType&&this.painter.setTileLoadedFlag(!0)}),s.testSupport(e)):this.fire(new Pe(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new Ce("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.resize(),this._update(),this.fire(new Ce("webglcontextrestored",{originalEvent:t}))}_onMapScroll(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_requestDomTask(t){!this.loaded()||this.loaded()&&!this.isMoving()?t():this._domRenderTaskQueue.add(t)}_render(t){let e;this.fire(new Ce("renderstart"));const r=this.painter.context.extTimerQuery,n=pe.now(),o=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(e=o.createQuery(),o.beginQuery(r.TIME_ELAPSED_EXT,e)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],i.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],i.performance.now())),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;this._updateProjectionTransition();const s=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,e=this.transform.pitch,i=pe.now(),r=new Ua(t,{now:i,fadeDuration:s,pitch:e,transition:this.style.transition});this.style.update(r)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let a=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),a=this._updateAverageElevation(n),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):a=this._updateAverageElevation(n),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new Ce("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new Ce("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),e){const t=pe.now()-n;o.endQuery(r.TIME_ELAPSED_EXT),setTimeout(()=>{const r=o.getQueryParameter(e,o.QUERY_RESULT)/1e6;o.deleteQuery(e),this.fire(new Ce("gpu-timing-frame",{cpuTime:t,gpuTime:r})),i.performance.mark("frame-gpu",{startTime:n,detail:{gpuTime:r}})},50)}if(this.listens("gpu-timing-layer")){const t=this.painter.collectGpuTimers();setTimeout(()=>{const e=this.painter.queryGpuTimers(t);this.fire(new Ce("gpu-timing-layer",{layerTimes:e}))},50)}if(this.listens("gpu-timing-deferred-render")){const t=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const e=this.painter.queryGpuTimeDeferredRender(t);this.fire(new Ce("gpu-timing-deferred-render",{gpuTime:e}))},50)}const l=this._sourcesDirty||this._styleDirty||this._placementDirty||a;if(l||this._repaint)this.triggerRepaint();else{const t=!this.isMoving()&&this.loaded();if(t&&(a=this._updateAverageElevation(n,!0)),a)this.triggerRepaint();else if(this._triggerFrame(!1),t&&(this.fire(new Ce("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const t=this._calculateSpeedIndex();this.fire(new Ce("speedindexcompleted",{speedIndex:t})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,te.mark(Qt.fullLoad),this._performanceMetricsCollection&&$t(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(t){for(const e of this._markers)t&&!this.getRenderWorldCopies()&&(e._lngLat=e._lngLat.wrap()),e._update();for(const e of this._popups)!t||this.getRenderWorldCopies()||e._trackPointer||(e._lngLat=e._lngLat.wrap()),e._update()}_updateAverageElevation(t,e=!1){const i=t=>(this.transform.averageElevation=t,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&i(0);const r=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(r||(e||t-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(t)){const e=this.transform.averageElevation;let n=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(n)?n=0:this._averageElevationLastSampledAt=t;const o=Math.abs(e-n);if(o>1){if(this._isInitialLoad||r)return this._averageElevation.jumpTo(n),i(n);this._averageElevation.easeTo(n,t,300)}else if(o>1e-4)return this._averageElevation.jumpTo(n),i(n)}return!!this._averageElevation.isEasing(t)&&i(this._averageElevation.getValue(t))}_authenticate(){Zt(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,t=>{if(t&&(t.message===Pt||401===t.status)){const t=this.painter.context.gl;Jt(t,!1),this._logoControl instanceof nI&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new Pe(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),qt(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const t=this._isDragging();this.painter.updateTerrain(this.style,t)}_calculateSpeedIndex(){const t=this.painter.canvasCopy(),e=this.painter.getCanvasCopiesAndTimestamps();e.timeStamps.push(performance.now());const i=this.painter.context.gl,r=i.createFramebuffer();function n(t){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t,0);const e=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,e),e}return i.bindFramebuffer(i.FRAMEBUFFER,r),this._canvasPixelComparison(n(t),e.canvasCopies.map(n),e.timeStamps)}_canvasPixelComparison(t,e,i){let r=i[1]-i[0];const n=t.length/4;for(let o=0;o<e.length;o++){const s=e[o];let a=0;for(let e=0;e<s.length;e+=4)s[e]===t[e]&&s[e+1]===t[e+1]&&s[e+2]===t[e+2]&&s[e+3]===t[e+3]&&(a+=1);r+=(i[o+2]-i[o+1])*(1-a/n)}return r}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==i&&(i.removeEventListener("resize",this._onWindowResize,!1),i.removeEventListener("orientationchange",this._onWindowResize,!1),i.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),i.removeEventListener("online",this._onWindowOnline,!1),i.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Kt.delete(this.painter.context.gl),this._removed=!0,this.fire(new Ce("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=pe.frame(t=>{const e=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,e&&this._render(t)}))}_preloadTiles(t){return L(this.style?Object.values(this.style._sourceCaches):[],(e,i)=>e._preloadTiles(t,i),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(t){this._trackResize&&this.resize({originalEvent:t})._update()}_onVisibilityChange(){"hidden"===i.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(t){this._showTerrainWireframe!==t&&(this._showTerrainWireframe=t,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(t){this._showLayers2DWireframe!==t&&(this._showLayers2DWireframe=t,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(t){this._showLayers3DWireframe!==t&&(this._showLayers3DWireframe=t,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(t){this._speedIndexTiming!==t&&(this._speedIndexTiming=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(t){this._showTileAABBs!==t&&(this._showTileAABBs=t,t&&this._update())}_setCacheLimits(t,e){!function(t,e){dt=t,pt=e}(t,e)}get version(){return r}},NavigationControl:class{constructor(t){this.options=B({},mI,t),this._container=fe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(V(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),fe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),fe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(V(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const e=this._map;e&&(this.options.visualizePitch?e.resetNorthPitch({},{originalEvent:t}):e.resetNorth({},{originalEvent:t}))}),this._compassIcon=fe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const t=this._map;if(!t)return;const e=t.getZoom(),i=e===t.getMaxZoom(),r=e===t.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=r,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",r.toString())}_rotateCompassArrow(){const t=this._map;if(!t)return;const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(t.transform.pitch*(Math.PI/180)),.5)}) rotateX(${t.transform.pitch}deg) rotateZ(${t.transform.angle*(180/Math.PI)}deg)`:`rotate(${t.transform.angle*(180/Math.PI)}deg)`;t._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=e)})}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),t.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&t.on("pitch",this._rotateCompassArrow),t.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new gI(t,this._compass,this.options.visualizePitch)),this._container}onRemove(){const t=this._map;t&&(this._container.remove(),this.options.showZoom&&t.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&t.off("pitch",this._rotateCompassArrow),t.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(t,e){const i=fe("button",t,this._container);return i.type="button",i.addEventListener("click",e),i}_setButtonTitle(t,e){if(!this._map)return;const i=this._map._getUIString("NavigationControl."+e);t.setAttribute("aria-label",i),t.firstElementChild&&t.firstElementChild.setAttribute("title",i)}},GeolocateControl:class extends Re{constructor(t){super(),this.options=B({geolocation:i.navigator.geolocation},_I,t),V(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=nM(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(t){return this._map=t,this._container=fe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(t){const e=(e=!!this.options.geolocation)=>{this._supportsGeolocation=e,t(e)};void 0!==this._supportsGeolocation?t(this._supportsGeolocation):void 0!==i.navigator.permissions?i.navigator.permissions.query({name:"geolocation"}).then(t=>e("denied"!==t.state)).catch(()=>e()):e()}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),i=t.coords;return!!e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new Ce("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new Ce("geolocate",t)),this._finish()}}_updateCamera(t){const e=new mp(t.coords.longitude,t.coords.latitude),i=t.coords.accuracy,r=B({bearing:this._map.getBearing()},this.options.fitBoundsOptions);this._map.fitBounds(e.toBounds(i),r,{geolocateSource:!0})}_updateMarker(t){if(t){const e=new mp(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(e).addTo(this._map),this._userLocationDotMarker.setLngLat(e).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map.transform,e=vp(1,t._center.lat)*t.worldSize,i=Math.ceil(2*this._accuracy*e);this._circleElement.style.width=i+"px",this._circleElement.style.height=i+"px"}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new Ce("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=fe("button","mapboxgl-ctrl-geolocate",this._container),fe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===t){Y("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=fe("div","mapboxgl-user-location"),this._dotElement.appendChild(fe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(fe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new lI({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=fe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new lI({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new Ce("trackuserlocationend")))})}}_onDeviceOrientation(t){this._userLocationDotMarker&&(t.webkitCompassHeading?this._heading=t.webkitCompassHeading:!0===t.absolute&&(this._heading=-1*t.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return Y("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new Ce("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new Ce("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new Ce("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let t;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(t={maximumAge:6e5,timeout:0},this._noTimeout=!0):(t=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,t),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const t=()=>{i.addEventListener("ondeviceorientationabsolute"in i?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==i.DeviceMotionEvent&&"function"==typeof i.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(e=>{"granted"===e&&t()}).catch(console.error):t()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),i.removeEventListener("deviceorientation",this._onDeviceOrientation),i.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:rI,ScaleControl:class{constructor(t){this.options=B({},yI,t),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(t){return!1}}(),V(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const t=this.options.maxWidth||100,e=this._map,i=e._containerHeight/2,r=e._containerWidth/2-t/2,n=e.unproject([r,i]),o=e.unproject([r+t,i]),s=n.distanceTo(o);if("imperial"===this.options.unit){const e=3.2808*s;e>5280?this._setScale(t,e/5280,"mile"):this._setScale(t,e,"foot")}else"nautical"===this.options.unit?this._setScale(t,s/1852,"nautical-mile"):s>=1e3?this._setScale(t,s/1e3,"kilometer"):this._setScale(t,s,"meter")}_setScale(t,e,i){this._map._requestDomTask(()=>{const r=function(t){const e=Math.pow(10,(""+Math.floor(t)).length-1);let i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(t){const e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(i),e*i}(e),n=r/e;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==i?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:i}).format(r):`${r}&nbsp;${vI[i]}`,this._container.style.width=t*n+"px"})}onAdd(t){return this._map=t,this._language=t.getLanguage(),this._container=fe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(t){this._language=t,this._update()}setUnit(t){this.options.unit=t,this._update()}},FullscreenControl:class{constructor(t){this._fullscreen=!1,t&&t.container&&(t.container instanceof i.HTMLElement?this._container=t.container:Y("Full screen control 'container' must be a DOM element.")),V(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in i.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in i.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=fe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",Y("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,i.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!i.document.fullscreenEnabled&&!i.document.webkitFullscreenEnabled)}_setupUI(){const t=this._fullscreenButton=fe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);fe("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),i.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",t)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(i.document.fullscreenElement||i.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?i.document.exitFullscreen?i.document.exitFullscreen():i.document.webkitCancelFullScreen&&i.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends Re{constructor(t){super(),this.options=B(Object.create(cI),t),V(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[])}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),t._addPopup(this),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new Ce("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),t._canvasContainer&&t._canvasContainer.classList.remove("mapboxgl-track-pointer"),t._removePopup(this),this._map=void 0),this.fire(new Ce("close")),this}getLngLat(){return this._lngLat}setLngLat(t){this._lngLat=mp.convert(t),this._pos=null,this._trackPointer=!1,this._update();const e=this._map;return e&&(e.on("move",this._update),e.off("mousemove",this._onMouseEvent),e._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const t=this._map;return t&&(t.off("move",this._update),t.on("mousemove",this._onMouseEvent),t.on("drag",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(i.document.createTextNode(t))}setHTML(t){const e=i.document.createDocumentFragment(),r=i.document.createElement("body");let n;for(r.innerHTML=t;n=r.firstChild,n;)e.appendChild(n);return this.setDOMContent(e)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){let e=this._content;if(e)for(;e.hasChildNodes();)e.firstChild&&e.removeChild(e.firstChild);else e=this._content=fe("div","mapboxgl-popup-content",this._container||void 0);if(e.appendChild(t),this.options.closeButton){const t=this._closeButton=fe("button","mapboxgl-popup-close-button",e);t.type="button",t.setAttribute("aria-label","Close popup"),t.setAttribute("aria-hidden","true"),t.innerHTML="&#215;",t.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(t){return this._classList.add(t),this._updateClassList(),this}removeClassName(t){return this._classList.delete(t),this._updateClassList(),this}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){let e;return this._classList.delete(t)?e=!1:(this._classList.add(t),e=!0),this._updateClassList(),e}_onMouseEvent(t){this._update(t.point)}_getAnchor(t){if(this.options.anchor)return this.options.anchor;const e=this._map,i=this._container,r=this._pos;if(!e||!i||!r)return"bottom";const n=i.offsetWidth,o=i.offsetHeight,s=r.x<n/2,a=r.x>e.transform.width-n/2;if(r.y+t<o)return s?"top-left":a?"top-right":"top";if(r.y>e.transform.height-o){if(s)return"bottom-left";if(a)return"bottom-right"}return s?"left":a?"right":"bottom"}_updateClassList(){const t=this._container;if(!t)return;const e=[...this._classList];e.push("mapboxgl-popup"),this._anchor&&e.push("mapboxgl-popup-anchor-"+this._anchor),this._trackPointer&&e.push("mapboxgl-popup-track-pointer"),t.className=e.join(" ")}_update(t){const e=this._map,i=this._content;if(!e||!this._lngLat&&!this._trackPointer||!i)return;let r=this._container;if(r||(r=this._container=fe("div","mapboxgl-popup",e.getContainer()),this._tip=fe("div","mapboxgl-popup-tip",r),r.appendChild(i)),this.options.maxWidth&&r.style.maxWidth!==this.options.maxWidth&&(r.style.maxWidth=this.options.maxWidth),e.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=sI(this._lngLat,this._pos,e.transform)),!this._trackPointer||t){const i=this._pos=this._trackPointer&&t?t:e.project(this._lngLat),r=hI(this.options.offset),n=this._anchor=this._getAnchor(r.y),o=hI(this.options.offset,n),s=i.add(o).round();e._requestDomTask(()=>{this._container&&n&&(this._container.style.transform=`${aI[n]} translate(${s.x}px,${s.y}px)`)})}if(!this._marker&&e._showingGlobe()){const t=ap(e.transform,this._lngLat)?0:1;this._setOpacity(t)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(uI);t&&t.focus()}_onClose(){this.remove()}_setOpacity(t){this._container&&(this._container.style.opacity=""+t),this._content&&(this._content.style.pointerEvents=t?"auto":"none")}},Marker:lI,Style:rM,LngLat:mp,LngLatBounds:Nc,Point:v,MercatorCoordinate:Ip,FreeCameraOptions:Kv,Evented:Re,config:o,prewarm:function(){Ww().acquire(Xw)},clearPrewarmedResources:function(){const t=qw;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(Xw),qw=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.ACCESS_TOKEN},set accessToken(t){o.ACCESS_TOKEN=t},get baseApiUrl(){return o.API_URL},set baseApiUrl(t){o.API_URL=t},get workerCount(){return Hw.workerCount},set workerCount(t){Hw.workerCount=t},get maxParallelImageRequests(){return o.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){o.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){!function(t){if(!ft())return;const e=i.caches.delete(ct);t&&e.catch(t).then(()=>t())}(t)},workerUrl:"",workerClass:null,get dracoUrl(){return Jw()},set dracoUrl(t){!function(t){Yw=pe.resolveURL(t),Kw||(Kw=new Sw(Ww(),new Re)),Kw.broadcast("setDracoUrl",Yw)}(t)},setNow:pe.setNow,restoreNow:pe.restoreNow};t.A=Ew,t.D=mg,t.E=ur,t.F=_g,t.K=_E,t.O=gd,t.P=v,t.T=$x,t.V=Pm,t.a=_m,t.b=Dm,t.c=lw,t.d=class extends Re{constructor(t,e,i,r,n,o){super(),this.actor=t,this.layerIndex=e,this.availableImages=i,this.loadVectorData=n||Uw,this.loading={},this.loaded={},this.deduped=new Nw(t.scheduler),this.isSpriteLoaded=r,this.scheduler=t.scheduler,this.brightness=o}loadTile(t,e){const i=t.uid,r=t&&t.request,n=r&&r.collectResourceTiming,o=this.loading[i]=new Fw(t);o.abort=this.loadVectorData(t,(s,a)=>{const l=!this.loading[i];if(delete this.loading[i],l||s||!a)return o.status="done",l||(this.loaded[i]=o),e(s);const c=a.rawData,u={};a.expires&&(u.expires=a.expires),a.cacheControl&&(u.cacheControl=a.cacheControl),o.vectorTile=a.vectorTile||new Cm(new tg(c));const h=()=>{o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,(t,i)=>{if(t||!i)return e(t);const o={};if(n){const t=re(r);t.length>0&&(o.resourceTiming=JSON.parse(JSON.stringify(t)))}e(null,B({rawTileData:c.slice(0)},i,u,o))})};this.isSpriteLoaded?h():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(h,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):h()}),this.loaded=this.loaded||{},this.loaded[i]=o})}reloadTile(t,e){const i=this.loaded,r=t.uid,n=this;if(i&&i[r]){const o=i[r];o.showCollisionBoxes=t.showCollisionBoxes,o.projection=t.projection,o.brightness=t.brightness,o.tileTransform=N_(t.tileID.canonical,t.projection),o.extraShadowCaster=t.extraShadowCaster;const s=(t,i)=>{const r=o.reloadCallback;r&&(delete o.reloadCallback,o.parse(o.vectorTile,n.layerIndex,this.availableImages,n.actor,r)),e(t,i)};"parsing"===o.status?o.reloadCallback=s:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}else e(null,void 0)}abortTile(t,e){const i=t.uid,r=this.loading[i];r&&(r.abort&&r.abort(),delete this.loading[i]),e()}removeTile(t,e){const i=this.loaded,r=t.uid;i&&i[r]&&delete i[r],e()}},t.e=_o,t.f=re,t.g=p,t.h=Tt,t.i=Et,t.j=function(t,e){const i=bT(t);for(const t of i){for(const e of t.meshes)wT(e);t.lights&&(t.lightMeshIndex=t.meshes.length,t.meshes.push(TT(t.lights,e)))}return i},t.k=Ua,t.l=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==oT){const i=new Uint32Array(t,0,7),[,,r,n,o,s]=i;e=i.byteLength+n+o+s+o,(r!==t.byteLength||e>=t.byteLength)&&Y("Invalid b3dm header information.")}return hT(t,e)},t.m=cy,t.n=Na,t.o=Ce,t.p=_,t.q=function(t){mt(),ut&&ut.then(e=>{e.keys().then(i=>{for(let r=0;r<i.length-t;r++)e.delete(i[r])})})},t.r=RT,t.s=xI,t.t=Mp,t.v=k,t.w=i})),n(0,(function(t){function e(t){if("number"==typeof t||"boolean"==typeof t||"string"==typeof t||null==t)return JSON.stringify(t);if(Array.isArray(t)){let i="[";for(const r of t)i+=e(r)+",";return i+"]"}let i="{";for(const r of Object.keys(t).sort())i+=`${r}:${e(t[r])},`;return i+"}"}function i(i){let r="";for(const n of t.r)r+="/"+e(i[n]);return r}class r{constructor(t){this.keyCache={},this._layers={},this._layerConfigs={},t&&this.replace(t)}replace(t,e){this._layerConfigs={},this._layers={},this.update(t,[],e)}update(e,r,n){this._options=n;for(const i of e){this._layerConfigs[i.id]=i;const e=this._layers[i.id]=t.c(i,this._options);e.setScope(this.scope),e.compileFilter(),this.keyCache[i.id]&&delete this.keyCache[i.id]}for(const t of r)delete this.keyCache[t],delete this._layerConfigs[t],delete this._layers[t];this.familiesBySource={};const o=function(t,e){const r={};for(let n=0;n<t.length;n++){const o=e&&e[t[n].id]||i(t[n]);e&&(e[t[n].id]=o);let s=r[o];s||(s=r[o]=[]),s.push(t[n])}const n=[];for(const t in r)n.push(r[t]);return n}(t.v(this._layerConfigs),this.keyCache);for(const t of o){const e=t.map(t=>this._layers[t.id]),i=e[0];if("none"===i.visibility)continue;const r=i.source||"";let n=this.familiesBySource[r];n||(n=this.familiesBySource[r]={});const o=i.sourceLayer||"_geojsonTileLayer";let s=n[o];s||(s=n[o]=[]),s.push(e)}}}class n{loadTile(e,i){const{uid:r,encoding:n,rawImageData:o,padding:s}=e,a=t.w.ImageBitmap&&o instanceof t.w.ImageBitmap?this.getImageData(o,s):o;i(null,new t.D(r,a,n,s<1))}getImageData(t,e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(t.width,t.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=t.width,this.offscreenCanvas.height=t.height,this.offscreenCanvasContext.drawImage(t,0,0,t.width,t.height);const i=this.offscreenCanvasContext.getImageData(-e,-e,t.width+2*e,t.height+2*e);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),i}}function o(t,e){if(0!==t.length){s(t[0],e);for(var i=1;i<t.length;i++)s(t[i],!e)}}function s(t,e){for(var i=0,r=0,n=0,o=t.length,s=o-1;n<o;s=n++){var a=(t[n][0]-t[s][0])*(t[s][1]+t[n][1]),l=i+a;r+=Math.abs(i)>=Math.abs(a)?i-l+a:a-l+i,i=l}i+r>=0!=!!e&&t.reverse()}var a=t.g((function t(e,i){var r,n=e&&e.type;if("FeatureCollection"===n)for(r=0;r<e.features.length;r++)t(e.features[r],i);else if("GeometryCollection"===n)for(r=0;r<e.geometries.length;r++)t(e.geometries[r],i);else if("Feature"===n)t(e.geometry,i);else if("Polygon"===n)o(e.coordinates,i);else if("MultiPolygon"===n)for(r=0;r<e.coordinates.length;r++)o(e.coordinates[r],i);return e}));const l=t.V.prototype.toGeoJSON;var c={exports:{}},u=t.p,h=t.a.VectorTileFeature,d=p;function p(t,e){this.options=e||{},this.features=t,this.length=t.length}function f(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}p.prototype.feature=function(t){return new f(this.features[t],this.options.extent)},f.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var i=t[e],r=[],n=0;n<i.length;n++)r.push(new u(i[n][0],i[n][1]));this.geometry.push(r)}return this.geometry},f.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,i=-1/0,r=1/0,n=-1/0,o=0;o<t.length;o++)for(var s=t[o],a=0;a<s.length;a++){var l=s[a];e=Math.min(e,l.x),i=Math.max(i,l.x),r=Math.min(r,l.y),n=Math.max(n,l.y)}return[e,r,i,n]},f.prototype.toGeoJSON=h.prototype.toGeoJSON;var m=t.b,g=d;function _(t){var e=new m;return function(t,e){for(var i in t.layers)e.writeMessage(3,y,t.layers[i])}(t,e),e.finish()}function y(t,e){var i;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<t.length;i++)r.feature=t.feature(i),e.writeMessage(2,v,r);var n=r.keys;for(i=0;i<n.length;i++)e.writeStringField(3,n[i]);var o=r.values;for(i=0;i<o.length;i++)e.writeMessage(4,E,o[i])}function v(t,e){var i=t.feature;void 0!==i.id&&e.writeVarintField(1,i.id),e.writeMessage(2,x,t),e.writeVarintField(3,i.type),e.writeMessage(4,T,i)}function x(t,e){var i=t.feature,r=t.keys,n=t.values,o=t.keycache,s=t.valuecache;for(var a in i.properties){var l=i.properties[a],c=o[a];if(null!==l){void 0===c&&(r.push(a),o[a]=c=r.length-1),e.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,d=s[h];void 0===d&&(n.push(l),s[h]=d=n.length-1),e.writeVarint(d)}}}function b(t,e){return(e<<3)+(7&t)}function w(t){return t<<1^t>>31}function T(t,e){for(var i=t.loadGeometry(),r=t.type,n=0,o=0,s=i.length,a=0;a<s;a++){var l=i[a],c=1;1===r&&(c=l.length),e.writeVarint(b(1,c));for(var u=3===r?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==r&&e.writeVarint(b(2,u-1));var d=l[h].x-n,p=l[h].y-o;e.writeVarint(w(d)),e.writeVarint(w(p)),n+=d,o+=p}3===r&&e.writeVarint(b(7,1))}}function E(t,e){var i=typeof t;"string"===i?e.writeStringField(1,t):"boolean"===i?e.writeBooleanField(7,t):"number"===i&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}c.exports=_,c.exports.fromVectorTileJs=_,c.exports.fromGeojsonVt=function(t,e){e=e||{};var i={};for(var r in t)i[r]=new g(t[r].features,e),i[r].name=r,i[r].version=e.version,i[r].extent=e.extent;return _({layers:i})},c.exports.GeoJSONWrapper=g;var S=t.g(c.exports);const A={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},M=Math.fround||(I=new Float32Array(1),t=>(I[0]=+t,I[0]));var I;class C{constructor(t){this.options=Object.assign(Object.create(A),t),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(t){const{log:e,minZoom:i,maxZoom:r}=this.options;e&&console.time("total time");const n=`prepare ${t.length} points`;e&&console.time(n),this.points=t;const o=[];for(let e=0;e<t.length;e++){const i=t[e];if(!i.geometry)continue;const[r,n]=i.geometry.coordinates,s=M(O(r)),a=M(D(n));o.push(s,a,1/0,e,-1,1),this.options.reduce&&o.push(0)}let s=this.trees[r+1]=this._createTree(o);e&&console.timeEnd(n);for(let t=r;t>=i;t--){const i=+Date.now();s=this.trees[t]=this._createTree(this._cluster(s,t)),e&&console.log("z%d: %d clusters in %dms",t,s.numItems,+Date.now()-i)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let i=((t[0]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,t[1]));let n=180===t[2]?180:((t[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)i=-180,n=180;else if(i>n){const t=this.getClusters([i,r,180,o],e),s=this.getClusters([-180,r,n,o],e);return t.concat(s)}const s=this.trees[this._limitZoom(e)],a=s.range(O(i),D(o),O(n),D(r)),l=s.data,c=[];for(const t of a){const e=this.stride*t;c.push(l[e+5]>1?P(l,e,this.clusterProps):this.points[l[e+3]])}return c}getChildren(t){const e=this._getOriginId(t),i=this._getOriginZoom(t),r="No cluster with the specified id.",n=this.trees[i];if(!n)throw new Error(r);const o=n.data;if(e*this.stride>=o.length)throw new Error(r);const s=this.options.radius/(this.options.extent*Math.pow(2,i-1)),a=n.within(o[e*this.stride],o[e*this.stride+1],s),l=[];for(const e of a){const i=e*this.stride;o[i+4]===t&&l.push(o[i+5]>1?P(o,i,this.clusterProps):this.points[o[i+3]])}if(0===l.length)throw new Error(r);return l}getLeaves(t,e,i){const r=[];return this._appendLeaves(r,t,e=e||10,i=i||0,0),r}getTile(t,e,i){const r=this.trees[this._limitZoom(t)],n=Math.pow(2,t),{extent:o,radius:s}=this.options,a=s/o,l=(i-a)/n,c=(i+1+a)/n,u={features:[]};return this._addTileFeatures(r.range((e-a)/n,l,(e+1+a)/n,c),r.data,e,i,n,u),0===e&&this._addTileFeatures(r.range(1-a/n,l,1,c),r.data,n,i,n,u),e===n-1&&this._addTileFeatures(r.range(0,l,a/n,c),r.data,-1,i,n,u),u.features.length?u:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const i=this.getChildren(t);if(e++,1!==i.length)break;t=i[0].properties.cluster_id}return e}_appendLeaves(t,e,i,r,n){const o=this.getChildren(e);for(const e of o){const o=e.properties;if(o&&o.cluster?n+o.point_count<=r?n+=o.point_count:n=this._appendLeaves(t,o.cluster_id,i,r,n):n<r?n++:t.push(e),t.length===i)break}return n}_createTree(e){const i=new t.K(e.length/this.stride|0,this.options.nodeSize,Float32Array);for(let t=0;t<e.length;t+=this.stride)i.add(e[t],e[t+1]);return i.finish(),i.data=e,i}_addTileFeatures(t,e,i,r,n,o){for(const s of t){const t=s*this.stride,a=e[t+5]>1;let l,c,u;if(a)l=R(e,t,this.clusterProps),c=e[t],u=e[t+1];else{const i=this.points[e[t+3]];l=i.properties;const[r,n]=i.geometry.coordinates;c=O(r),u=D(n)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*n-i)),Math.round(this.options.extent*(u*n-r))]],tags:l};let d;d=a||this.options.generateId?e[t+3]:this.points[e[t+3]].id,void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))}_cluster(t,e){const{radius:i,extent:r,reduce:n,minPoints:o}=this.options,s=i/(r*Math.pow(2,e)),a=t.data,l=[],c=this.stride;for(let i=0;i<a.length;i+=c){if(a[i+2]<=e)continue;a[i+2]=e;const r=a[i],u=a[i+1],h=t.within(a[i],a[i+1],s),d=a[i+5];let p=d;for(const t of h){const i=t*c;a[i+2]>e&&(p+=a[i+5])}if(p>d&&p>=o){let t,o=r*d,s=u*d,f=-1;const m=((i/c|0)<<5)+(e+1)+this.points.length;for(const r of h){const l=r*c;if(a[l+2]<=e)continue;a[l+2]=e;const u=a[l+5];o+=a[l]*u,s+=a[l+1]*u,a[l+4]=m,n&&(t||(t=this._map(a,i,!0),f=this.clusterProps.length,this.clusterProps.push(t)),n(t,this._map(a,l)))}a[i+4]=m,l.push(o/p,s/p,1/0,m,-1,p),n&&l.push(f)}else{for(let t=0;t<c;t++)l.push(a[i+t]);if(p>1)for(const t of h){const i=t*c;if(!(a[i+2]<=e)){a[i+2]=e;for(let t=0;t<c;t++)l.push(a[i+t])}}}}return l}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e,i){if(t[e+5]>1){const r=this.clusterProps[t[e+6]];return i?Object.assign({},r):r}const r=this.points[t[e+3]].properties,n=this.options.map(r);return i&&n===r?Object.assign({},n):n}}function P(t,e,i){return{type:"Feature",id:t[e+3],properties:R(t,e,i),geometry:{type:"Point",coordinates:[(r=t[e],360*(r-.5)),L(t[e+1])]}};var r}function R(t,e,i){const r=t[e+5],n=r>=1e4?Math.round(r/1e3)+"k":r>=1e3?Math.round(r/100)/10+"k":r,o=t[e+6],s=-1===o?{}:Object.assign({},i[o]);return Object.assign(s,{cluster:!0,cluster_id:t[e+3],point_count:r,point_count_abbreviated:n})}function O(t){return t/360+.5}function D(t){const e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function L(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}var k={exports:{}};k.exports=function(){function t(i,r,n,o){for(var s,a=o,l=n-r>>1,c=n-r,u=i[r],h=i[r+1],d=i[n],p=i[n+1],f=r+3;f<n;f+=3){var m=e(i[f],i[f+1],u,h,d,p);if(m>a)s=f,a=m;else if(m===a){var g=Math.abs(f-l);g<c&&(s=f,c=g)}}a>o&&(s-r>3&&t(i,r,s,o),i[s+2]=a,n-s>3&&t(i,s,n,o))}function e(t,e,i,r,n,o){var s=n-i,a=o-r;if(0!==s||0!==a){var l=((t-i)*s+(e-r)*a)/(s*s+a*a);l>1?(i=n,r=o):l>0&&(i+=s*l,r+=a*l)}return(s=t-i)*s+(a=e-r)*a}function i(t,e,i,n){var o={id:void 0===t?null:t,type:e,geometry:i,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,i=t.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)r(t,e);else if("Polygon"===i||"MultiLineString"===i)for(var n=0;n<e.length;n++)r(t,e[n]);else if("MultiPolygon"===i)for(n=0;n<e.length;n++)for(var o=0;o<e[n].length;o++)r(t,e[n][o])}(o),o}function r(t,e){for(var i=0;i<e.length;i+=3)t.minX=Math.min(t.minX,e[i]),t.minY=Math.min(t.minY,e[i+1]),t.maxX=Math.max(t.maxX,e[i]),t.maxY=Math.max(t.maxY,e[i+1])}function n(t,e,r,l){if(e.geometry){var c=e.geometry.coordinates,u=e.geometry.type,h=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),d=[],p=e.id;if(r.promoteId?p=e.properties[r.promoteId]:r.generateId&&(p=l||0),"Point"===u)o(c,d);else if("MultiPoint"===u)for(var f=0;f<c.length;f++)o(c[f],d);else if("LineString"===u)s(c,d,h,!1);else if("MultiLineString"===u){if(r.lineMetrics){for(f=0;f<c.length;f++)s(c[f],d=[],h,!1),t.push(i(p,"LineString",d,e.properties));return}a(c,d,h,!1)}else if("Polygon"===u)a(c,d,h,!0);else{if("MultiPolygon"!==u){if("GeometryCollection"===u){for(f=0;f<e.geometry.geometries.length;f++)n(t,{id:p,geometry:e.geometry.geometries[f],properties:e.properties},r,l);return}throw new Error("Input data is not a valid GeoJSON object.")}for(f=0;f<c.length;f++){var m=[];a(c[f],m,h,!0),d.push(m)}}t.push(i(p,u,d,e.properties))}}function o(t,e){e.push(l(t[0])),e.push(c(t[1])),e.push(0)}function s(e,i,r,n){for(var o,s,a=0,u=0;u<e.length;u++){var h=l(e[u][0]),d=c(e[u][1]);i.push(h),i.push(d),i.push(0),u>0&&(a+=n?(o*d-h*s)/2:Math.sqrt(Math.pow(h-o,2)+Math.pow(d-s,2))),o=h,s=d}var p=i.length-3;i[2]=1,t(i,0,p,r),i[p+2]=1,i.size=Math.abs(a),i.start=0,i.end=i.size}function a(t,e,i,r){for(var n=0;n<t.length;n++){var o=[];s(t[n],o,i,r),e.push(o)}}function l(t){return t/360+.5}function c(t){var e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function u(t,e,r,n,o,s,a,l){if(n/=e,s>=(r/=e)&&a<n)return t;if(a<r||s>=n)return null;for(var c=[],u=0;u<t.length;u++){var p=t[u],m=p.geometry,g=p.type,_=0===o?p.minX:p.minY,y=0===o?p.maxX:p.maxY;if(_>=r&&y<n)c.push(p);else if(!(y<r||_>=n)){var v=[];if("Point"===g||"MultiPoint"===g)h(m,v,r,n,o);else if("LineString"===g)d(m,v,r,n,o,!1,l.lineMetrics);else if("MultiLineString"===g)f(m,v,r,n,o,!1);else if("Polygon"===g)f(m,v,r,n,o,!0);else if("MultiPolygon"===g)for(var x=0;x<m.length;x++){var b=[];f(m[x],b,r,n,o,!0),b.length&&v.push(b)}if(v.length){if(l.lineMetrics&&"LineString"===g){for(x=0;x<v.length;x++)c.push(i(p.id,g,v[x],p.tags));continue}"LineString"!==g&&"MultiLineString"!==g||(1===v.length?(g="LineString",v=v[0]):g="MultiLineString"),"Point"!==g&&"MultiPoint"!==g||(g=3===v.length?"Point":"MultiPoint"),c.push(i(p.id,g,v,p.tags))}}}return c.length?c:null}function h(t,e,i,r,n){for(var o=0;o<t.length;o+=3){var s=t[o+n];s>=i&&s<=r&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function d(t,e,i,r,n,o,s){for(var a,l,c=p(t),u=0===n?g:_,h=t.start,d=0;d<t.length-3;d+=3){var f=t[d],y=t[d+1],v=t[d+2],x=t[d+3],b=t[d+4],w=0===n?f:y,T=0===n?x:b,E=!1;s&&(a=Math.sqrt(Math.pow(f-x,2)+Math.pow(y-b,2))),w<i?T>i&&(l=u(c,f,y,x,b,i),s&&(c.start=h+a*l)):w>r?T<r&&(l=u(c,f,y,x,b,r),s&&(c.start=h+a*l)):m(c,f,y,v),T<i&&w>=i&&(l=u(c,f,y,x,b,i),E=!0),T>r&&w<=r&&(l=u(c,f,y,x,b,r),E=!0),!o&&E&&(s&&(c.end=h+a*l),e.push(c),c=p(t)),s&&(h+=a)}var S=t.length-3;f=t[S],y=t[S+1],v=t[S+2],(w=0===n?f:y)>=i&&w<=r&&m(c,f,y,v),S=c.length-3,o&&S>=3&&(c[S]!==c[0]||c[S+1]!==c[1])&&m(c,c[0],c[1],c[2]),c.length&&e.push(c)}function p(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function f(t,e,i,r,n,o){for(var s=0;s<t.length;s++)d(t[s],e,i,r,n,o,!1)}function m(t,e,i,r){t.push(e),t.push(i),t.push(r)}function g(t,e,i,r,n,o){var s=(o-e)/(r-e);return t.push(o),t.push(i+(n-i)*s),t.push(1),s}function _(t,e,i,r,n,o){var s=(o-i)/(n-i);return t.push(e+(r-e)*s),t.push(o),t.push(1),s}function y(t,e){for(var r=[],n=0;n<t.length;n++){var o,s=t[n],a=s.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)o=v(s.geometry,e);else if("MultiLineString"===a||"Polygon"===a){o=[];for(var l=0;l<s.geometry.length;l++)o.push(v(s.geometry[l],e))}else if("MultiPolygon"===a)for(o=[],l=0;l<s.geometry.length;l++){for(var c=[],u=0;u<s.geometry[l].length;u++)c.push(v(s.geometry[l][u],e));o.push(c)}r.push(i(s.id,a,o,s.tags))}return r}function v(t,e){var i=[];i.size=t.size,void 0!==t.start&&(i.start=t.start,i.end=t.end);for(var r=0;r<t.length;r+=3)i.push(t[r]+e,t[r+1],t[r+2]);return i}function x(t,e){if(t.transformed)return t;var i,r,n,o=1<<t.z,s=t.x,a=t.y;for(i=0;i<t.features.length;i++){var l=t.features[i],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(r=0;r<c.length;r+=2)l.geometry.push(b(c[r],c[r+1],e,o,s,a));else for(r=0;r<c.length;r++){var h=[];for(n=0;n<c[r].length;n+=2)h.push(b(c[r][n],c[r][n+1],e,o,s,a));l.geometry.push(h)}}return t.transformed=!0,t}function b(t,e,i,r,n,o){return[Math.round(i*(t*r-n)),Math.round(i*(e*r-o))]}function w(t,e,i,r,n){for(var o=e===n.maxZoom?0:n.tolerance/((1<<e)*n.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:r,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<t.length;a++){s.numFeatures++,T(s,t[a],o,n);var l=t[a].minX,c=t[a].minY,u=t[a].maxX,h=t[a].maxY;l<s.minX&&(s.minX=l),c<s.minY&&(s.minY=c),u>s.maxX&&(s.maxX=u),h>s.maxY&&(s.maxY=h)}return s}function T(t,e,i,r){var n=e.geometry,o=e.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<n.length;a+=3)s.push(n[a]),s.push(n[a+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)E(s,n,t,i,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<n.length;a++)E(s,n[a],t,i,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var l=0;l<n.length;l++){var c=n[l];for(a=0;a<c.length;a++)E(s,c[a],t,i,!0,0===a)}if(s.length){var u=e.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in u={},e.tags)u[h]=e.tags[h];u.mapbox_clip_start=n.start/n.size,u.mapbox_clip_end=n.end/n.size}var d={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:u};null!==e.id&&(d.id=e.id),t.features.push(d)}}function E(t,e,i,r,n,o){var s=r*r;if(r>0&&e.size<(n?s:r))i.numPoints+=e.length/3;else{for(var a=[],l=0;l<e.length;l+=3)(0===r||e[l+2]>s)&&(i.numSimplified++,a.push(e[l]),a.push(e[l+1])),i.numPoints++;n&&function(t,e){for(var i=0,r=0,n=t.length,o=n-2;r<n;o=r,r+=2)i+=(t[r]-t[o])*(t[r+1]+t[o+1]);if(i>0===e)for(r=0,n=t.length;r<n/2;r+=2){var s=t[r],a=t[r+1];t[r]=t[n-2-r],t[r+1]=t[n-1-r],t[n-2-r]=s,t[n-1-r]=a}}(a,o),t.push(a)}}function S(t,e){var i=(e=this.options=function(t,e){for(var i in e)t[i]=e[i];return t}(Object.create(this.options),e)).debug;if(i&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(t,e){var i=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)n(i,t.features[r],e,r);else n(i,"Feature"===t.type?t:{geometry:t},e);return i}(t,e);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=function(t,e){var i=e.buffer/e.extent,r=t,n=u(t,1,-1-i,i,0,-1,2,e),o=u(t,1,1-i,2+i,0,-1,2,e);return(n||o)&&(r=u(t,1,-i,1+i,0,-1,2,e)||[],n&&(r=y(n,1).concat(r)),o&&(r=r.concat(y(o,-1)))),r}(r,e)).length&&this.splitTile(r,0,0,0),i&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function A(t,e,i){return 32*((1<<t)*i+e)+t}return S.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},S.prototype.splitTile=function(t,e,i,r,n,o,s){for(var a=[t,e,i,r],l=this.options,c=l.debug;a.length;){r=a.pop(),i=a.pop(),e=a.pop(),t=a.pop();var h=1<<e,d=A(e,i,r),p=this.tiles[d];if(!p&&(c>1&&console.time("creation"),p=this.tiles[d]=w(t,e,i,r,l),this.tileCoords.push({z:e,x:i,y:r}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,i,r,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+e;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=t,n){if(e===l.maxZoom||e===n)continue;var m=1<<n-e;if(i!==Math.floor(o/m)||r!==Math.floor(s/m))continue}else if(e===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==t.length){c>1&&console.time("clipping");var g,_,y,v,x,b,T=.5*l.buffer/l.extent,E=.5-T,S=.5+T,M=1+T;g=_=y=v=null,x=u(t,h,i-T,i+S,0,p.minX,p.maxX,l),b=u(t,h,i+E,i+M,0,p.minX,p.maxX,l),t=null,x&&(g=u(x,h,r-T,r+S,1,p.minY,p.maxY,l),_=u(x,h,r+E,r+M,1,p.minY,p.maxY,l),x=null),b&&(y=u(b,h,r-T,r+S,1,p.minY,p.maxY,l),v=u(b,h,r+E,r+M,1,p.minY,p.maxY,l),b=null),c>1&&console.timeEnd("clipping"),a.push(g||[],e+1,2*i,2*r),a.push(_||[],e+1,2*i,2*r+1),a.push(y||[],e+1,2*i+1,2*r),a.push(v||[],e+1,2*i+1,2*r+1)}}},S.prototype.getTile=function(t,e,i){var r=this.options,n=r.extent,o=r.debug;if(t<0||t>24)return null;var s=1<<t,a=A(t,e=(e%s+s)%s,i);if(this.tiles[a])return x(this.tiles[a],n);o>1&&console.log("drilling down to z%d-%d-%d",t,e,i);for(var l,c=t,u=e,h=i;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[A(c,u,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,u,h),o>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,t,e,i),o>1&&console.timeEnd("drilling down"),this.tiles[a]?x(this.tiles[a],n):null):null},function(t,e){return new S(t,e)}}();var B=t.g(k.exports);function F(e,i){const r=e.tileID.canonical;if(!this._geoJSONIndex)return i(null,null);const n=this._geoJSONIndex.getTile(r.z,r.x,r.y);if(!n)return i(null,null);const o=new class{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.E,this.length=e.length,this._features=e}feature(e){return new class{constructor(e){this._feature=e,this.extent=t.E,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){const e=[];for(const i of this._feature.geometry)e.push([new t.P(i[0],i[1])]);return e}{const e=[];for(const i of this._feature.geometry){const r=[];for(const e of i)r.push(new t.P(e[0],e[1]));e.push(r)}return e}}toGeoJSON(t,e,i){return l.call(this,t,e,i)}}(this._features[e])}}(n.features);let s=S(o);0===s.byteOffset&&s.byteLength===s.buffer.byteLength||(s=new Uint8Array(s)),i(null,{vectorTile:o,rawData:s.buffer})}class z extends t.d{constructor(t,e,i,r,n,o){super(t,e,i,r,F,o),n&&(this.loadGeoJSON=n)}loadData(e,i){const r=e&&e.request,n=r&&r.collectResourceTiming;this.loadGeoJSON(e,(o,s)=>{if(o||!s)return i(o);if("object"!=typeof s)return i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));{a(s,!0);try{if(e.filter){const i=t.e(e.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===i.result)throw new Error(i.value.map(t=>`${t.key}: ${t.message}`).join(", "));const r=s.features.filter(t=>i.value.evaluate({zoom:0},t));s={type:"FeatureCollection",features:r}}this._geoJSONIndex=e.cluster?new C(function({superclusterOptions:e,clusterProperties:i}){if(!i||!e)return e;const r={},n={},o={accumulated:null,zoom:0},s={properties:null},a=Object.keys(i);for(const e of a){const[o,s]=i[e],a=t.e(s),l=t.e("string"==typeof o?[o,["accumulated"],["get",e]]:o);r[e]=a.value,n[e]=l.value}return e.map=t=>{s.properties=t;const e={};for(const t of a)e[t]=r[t].evaluate(o,s);return e},e.reduce=(t,e)=>{s.properties=e;for(const e of a)o.accumulated=t[e],t[e]=n[e].evaluate(o,s)},e}(e)).load(s.features):B(s,e.geojsonVtOptions)}catch(o){return i(o)}this.loaded={};const l={};if(n){const i=t.f(r);i&&(l.resourceTiming={},l.resourceTiming[e.source]=JSON.parse(JSON.stringify(i)))}i(null,l)}})}reloadTile(t,e){const i=this.loaded;return i&&i[t.uid]?super.reloadTile(t,e):this.loadTile(t,e)}loadGeoJSON(e,i){if(e.request)t.h(e.request,i);else{if("string"!=typeof e.data)return i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));try{return i(null,JSON.parse(e.data))}catch(t){return i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}}getClusterChildren(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}}getClusterLeaves(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}}}class N{constructor(e,i){this.tileID=new t.O(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=e.projection,this.brightness=i}parse(e,i,r,n){this.status="parsing";const o=new t.O(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),s={},a=i.familiesBySource[r.source],l=new t.F(o,r.promoteId);return l.bucketLayerIDs=[],t.l(e).then(e=>{if(!e)return n(new Error("Could not parse tile"));const i=t.j(e,1/t.t(r.tileID.canonical)),c=e.json.extensionsUsed&&e.json.extensionsUsed.includes("MAPBOX_mesh_features"),u=new t.k(this.zoom,{brightness:this.brightness});for(const r in a)for(const n of a[r]){const r=n[0],a=e.json.extensionsUsed;r.recalculate(u,[]);const l=new t.T(i,o,a&&a.includes("MAPBOX_mesh_features"),this.brightness);c||(l.needsUpload=!0),s[r.fqid]=l,l.evaluate(r)}this.status="done",n(null,{buckets:s,featureIndex:l})}).catch(t=>n(new Error(t.message)))}}class U{constructor(t,e,i,r,n,o){this.actor=t,this.layerIndex=e,this.brightness=o,this.loading={},this.loaded={}}loadTile(e,i){const r=e.uid,n=this.loading[r]=new N(e,this.brightness);t.i(e.request,(t,o)=>{const s=!this.loading[r];return delete this.loading[r],s||t?(n.status="done",s||(this.loaded[r]=n),i(t)):o&&0!==o.byteLength?void n.parse(o,this.layerIndex,e,(t,e)=>{n.status="done",this.loaded=this.loaded||{},this.loaded[r]=n,t||!e?i(t):i(null,e)}):(n.status="done",this.loaded[r]=n,i())})}reloadTile(t,e){const i=this.loaded,r=t.uid;if(i&&i[r]){const n=i[r];n.projection=t.projection,n.brightness=t.brightness;const o=(i,r)=>{n.reloadCallback&&(delete n.reloadCallback,this.loadTile(t,e)),e(i,r)};"parsing"===n.status?n.reloadCallback=o:"done"===n.status&&this.loadTile(t,e)}}abortTile(t,e){const i=t.uid;this.loading[i]&&delete this.loading[i],e()}removeTile(t,e){const i=this.loaded,r=t.uid;i&&i[r]&&delete i[r],e()}}class G{constructor(e){this.self=e,this.actor=new t.A(e,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=t.m({name:"mercator"}),this.workerSourceTypes={vector:t.d,geojson:z,"batched-model":U},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(t,e)=>{if(this.workerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=e=>{if(t.n.isParsed())throw new Error("RTL text plugin already registered.");t.n.applyArabicShaping=e.applyArabicShaping,t.n.processBidirectionalText=e.processBidirectionalText,t.n.processStyledBidirectionalText=e.processStyledBidirectionalText}}clearCaches(t,e,i){delete this.layerIndexes[t],delete this.availableImages[t],delete this.workerSources[t],delete this.demWorkerSources[t],i()}checkIfReady(t,e,i){i()}setReferrer(t,e){this.referrer=e}spriteLoaded(e,{scope:i,isLoaded:r}){if(this.isSpriteLoaded[e]||(this.isSpriteLoaded[e]={}),this.isSpriteLoaded[e][i]=r,this.workerSources[e]&&this.workerSources[e][i])for(const n in this.workerSources[e][i]){const o=this.workerSources[e][i][n];for(const e in o)o[e]instanceof t.d&&(o[e].isSpriteLoaded=r,o[e].fire(new t.o("isSpriteLoaded")))}}setImages(t,{scope:e,images:i},r){if(this.availableImages[t]||(this.availableImages[t]={}),this.availableImages[t][e]=i,this.workerSources[t]&&this.workerSources[t][e]){for(const r in this.workerSources[t][e]){const n=this.workerSources[t][e][r];for(const t in n)n[t].availableImages=i}r()}else r()}setProjection(e,i){this.projections[e]=t.m(i)}setBrightness(t,e,i){this.brightness=e,i()}setLayers(t,e,i){this.getLayerIndex(t,e.scope).replace(e.layers,e.options),i()}updateLayers(t,e,i){this.getLayerIndex(t,e.scope).update(e.layers,e.removedIds,e.options),i()}loadTile(t,e,i){e.projection=this.projections[t]||this.defaultProjection,this.getWorkerSource(t,e.type,e.source,e.scope).loadTile(e,i)}loadDEMTile(t,e,i){this.getDEMWorkerSource(t,e.source,e.scope).loadTile(e,i)}reloadTile(t,e,i){e.projection=this.projections[t]||this.defaultProjection,this.getWorkerSource(t,e.type,e.source,e.scope).reloadTile(e,i)}abortTile(t,e,i){this.getWorkerSource(t,e.type,e.source,e.scope).abortTile(e,i)}removeTile(t,e,i){this.getWorkerSource(t,e.type,e.source,e.scope).removeTile(e,i)}removeSource(t,e,i){if(!(this.workerSources[t]&&this.workerSources[t][e.scope]&&this.workerSources[t][e.scope][e.type]&&this.workerSources[t][e.scope][e.type][e.source]))return;const r=this.workerSources[t][e.scope][e.type][e.source];delete this.workerSources[t][e.scope][e.type][e.source],void 0!==r.removeSource?r.removeSource(e,i):i()}loadWorkerSource(t,e,i){try{this.self.importScripts(e.url),i()}catch(t){i(t.toString())}}syncRTLPluginState(e,i,r){try{t.n.setState(i);const e=t.n.getPluginURL();if(t.n.isLoaded()&&!t.n.isParsed()&&null!=e){this.self.importScripts(e);const i=t.n.isParsed();r(i?void 0:new Error("RTL Text Plugin failed to import scripts from "+e),i)}}catch(t){r(t.toString())}}setDracoUrl(t,e){this.dracoUrl=e}getAvailableImages(t,e){this.availableImages[t]||(this.availableImages[t]={});let i=this.availableImages[t][e];return i||(i=[]),i}getLayerIndex(t,e){this.layerIndexes[t]||(this.layerIndexes[t]={});let i=this.layerIndexes[t][e];return i||(i=this.layerIndexes[t][e]=new r,i.scope=e),i}getWorkerSource(t,e,i,r){if(this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][r]||(this.workerSources[t][r]={}),this.workerSources[t][r][e]||(this.workerSources[t][r][e]={}),this.isSpriteLoaded[t]||(this.isSpriteLoaded[t]={}),!this.workerSources[t][r][e][i]){const n={send:(e,i,r,n,o,s)=>{this.actor.send(e,i,r,t,o,s)},scheduler:this.actor.scheduler};this.workerSources[t][r][e][i]=new this.workerSourceTypes[e](n,this.getLayerIndex(t,r),this.getAvailableImages(t,r),this.isSpriteLoaded[t][r],void 0,this.brightness)}return this.workerSources[t][r][e][i]}getDEMWorkerSource(t,e,i){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][i]||(this.demWorkerSources[t][i]={}),this.demWorkerSources[t][i][e]||(this.demWorkerSources[t][i][e]=new n),this.demWorkerSources[t][i][e]}enforceCacheSizeLimit(e,i){t.q(i)}getWorkerPerformanceMetrics(t,e,i){i(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new G(self)),G})),n(0,(function(t){return t.s})),r}()}).call(this,i("8oxB"))},"5oMp":function(t,e,i){"use strict";t.exports=function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}},"8UI6":function(t,e,i){"use strict";var r=Object.prototype.hasOwnProperty,n="~";function o(){}function s(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function a(t,e,i,r,o){if("function"!=typeof i)throw new TypeError("The listener must be a function");var a=new s(i,r||t,o),l=n?n+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],a]:t._events[l].push(a):(t._events[l]=a,t._eventsCount++),t}function l(t,e){0==--t._eventsCount?t._events=new o:delete t._events[e]}function c(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(n=!1)),c.prototype.eventNames=function(){var t,e,i=[];if(0===this._eventsCount)return i;for(e in t=this._events)r.call(t,e)&&i.push(n?e.slice(1):e);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},c.prototype.listeners=function(t){var e=n?n+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,o=i.length,s=new Array(o);r<o;r++)s[r]=i[r].fn;return s},c.prototype.listenerCount=function(t){var e=n?n+t:t,i=this._events[e];return i?i.fn?1:i.length:0},c.prototype.emit=function(t,e,i,r,o,s){var a=n?n+t:t;if(!this._events[a])return!1;var l,c,u=this._events[a],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,i),!0;case 4:return u.fn.call(u.context,e,i,r),!0;case 5:return u.fn.call(u.context,e,i,r,o),!0;case 6:return u.fn.call(u.context,e,i,r,o,s),!0}for(c=1,l=new Array(h-1);c<h;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var d,p=u.length;for(c=0;c<p;c++)switch(u[c].once&&this.removeListener(t,u[c].fn,void 0,!0),h){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,e);break;case 3:u[c].fn.call(u[c].context,e,i);break;case 4:u[c].fn.call(u[c].context,e,i,r);break;default:if(!l)for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];u[c].fn.apply(u[c].context,l)}}return!0},c.prototype.on=function(t,e,i){return a(this,t,e,i,!1)},c.prototype.once=function(t,e,i){return a(this,t,e,i,!0)},c.prototype.removeListener=function(t,e,i,r){var o=n?n+t:t;if(!this._events[o])return this;if(!e)return l(this,o),this;var s=this._events[o];if(s.fn)s.fn!==e||r&&!s.once||i&&s.context!==i||l(this,o);else{for(var a=0,c=[],u=s.length;a<u;a++)(s[a].fn!==e||r&&!s[a].once||i&&s[a].context!==i)&&c.push(s[a]);c.length?this._events[o]=1===c.length?c[0]:c:l(this,o)}return this},c.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&l(this,e)):(this._events=new o,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=n,c.EventEmitter=c,t.exports=c},"8oxB":function(t,e){var i,r,n=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(i===setTimeout)return setTimeout(t,0);if((i===o||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:o}catch(t){i=o}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(t){r=s}}();var l,c=[],u=!1,h=-1;function d(){u&&l&&(u=!1,l.length?c=l.concat(c):h=-1,c.length&&p())}function p(){if(!u){var t=a(d);u=!0;for(var e=c.length;e;){for(l=c,c=[];++h<e;)l&&l[h].run();h=-1,e=c.length}l=null,u=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function m(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];c.push(new f(t,e)),1!==c.length||u||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=m,n.addListener=m,n.once=m,n.off=m,n.removeListener=m,n.removeAllListeners=m,n.emit=m,n.prependListener=m,n.prependOnceListener=m,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},"9rSQ":function(t,e,i){"use strict";var r=i("xTJ+");function n(){this.handlers=[]}n.prototype.use=function(t,e,i){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1},n.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},n.prototype.forEach=function(t){r.forEach(this.handlers,(function(e){null!==e&&t(e)}))},t.exports=n},"9tPo":function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var i=e.protocol+"//"+e.host,r=i+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(t,e){var n,o=e.trim().replace(/^"(.*)"$/,(function(t,e){return e})).replace(/^'(.*)'$/,(function(t,e){return e}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?t:(n=0===o.indexOf("//")?o:0===o.indexOf("/")?i+o:r+o.replace(/^\.\//,""),"url("+JSON.stringify(n)+")")}))}},AM7I:function(t,e,i){"use strict";var r=SyntaxError,n=Function,o=TypeError,s=function(t){try{return n('"use strict"; return ('+t+").constructor;")()}catch(t){}},a=Object.getOwnPropertyDescriptor;if(a)try{a({},"")}catch(t){a=null}var l=function(){throw new o},c=a?function(){try{return l}catch(t){try{return a(arguments,"callee").get}catch(t){return l}}}():l,u=i("UVaH")(),h=i("CjYj")(),d=Object.getPrototypeOf||(h?function(t){return t.__proto__}:null),p={},f="undefined"!=typeof Uint8Array&&d?d(Uint8Array):void 0,m={"%AggregateError%":"undefined"==typeof AggregateError?void 0:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?void 0:ArrayBuffer,"%ArrayIteratorPrototype%":u&&d?d([][Symbol.iterator]()):void 0,"%AsyncFromSyncIteratorPrototype%":void 0,"%AsyncFunction%":p,"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":p,"%Atomics%":"undefined"==typeof Atomics?void 0:Atomics,"%BigInt%":"undefined"==typeof BigInt?void 0:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?void 0:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?void 0:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?void 0:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?void 0:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?void 0:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?void 0:FinalizationRegistry,"%Function%":n,"%GeneratorFunction%":p,"%Int8Array%":"undefined"==typeof Int8Array?void 0:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?void 0:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?void 0:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":u&&d?d(d([][Symbol.iterator]())):void 0,"%JSON%":"object"==typeof JSON?JSON:void 0,"%Map%":"undefined"==typeof Map?void 0:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&u&&d?d((new Map)[Symbol.iterator]()):void 0,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?void 0:Promise,"%Proxy%":"undefined"==typeof Proxy?void 0:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?void 0:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?void 0:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&u&&d?d((new Set)[Symbol.iterator]()):void 0,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?void 0:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":u&&d?d(""[Symbol.iterator]()):void 0,"%Symbol%":u?Symbol:void 0,"%SyntaxError%":r,"%ThrowTypeError%":c,"%TypedArray%":f,"%TypeError%":o,"%Uint8Array%":"undefined"==typeof Uint8Array?void 0:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?void 0:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?void 0:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?void 0:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?void 0:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?void 0:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?void 0:WeakSet};if(d)try{null.error}catch(t){var g=d(d(t));m["%Error.prototype%"]=g}var _={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},y=i("D3zA"),v=i("lnE3"),x=y.call(Function.call,Array.prototype.concat),b=y.call(Function.apply,Array.prototype.splice),w=y.call(Function.call,String.prototype.replace),T=y.call(Function.call,String.prototype.slice),E=y.call(Function.call,RegExp.prototype.exec),S=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,A=/\\(\\)?/g,M=function(t){var e=T(t,0,1),i=T(t,-1);if("%"===e&&"%"!==i)throw new r("invalid intrinsic syntax, expected closing `%`");if("%"===i&&"%"!==e)throw new r("invalid intrinsic syntax, expected opening `%`");var n=[];return w(t,S,(function(t,e,i,r){n[n.length]=i?w(r,A,"$1"):e||t})),n},I=function(t,e){var i,n=t;if(v(_,n)&&(n="%"+(i=_[n])[0]+"%"),v(m,n)){var a=m[n];if(a===p&&(a=function t(e){var i;if("%AsyncFunction%"===e)i=s("async function () {}");else if("%GeneratorFunction%"===e)i=s("function* () {}");else if("%AsyncGeneratorFunction%"===e)i=s("async function* () {}");else if("%AsyncGenerator%"===e){var r=t("%AsyncGeneratorFunction%");r&&(i=r.prototype)}else if("%AsyncIteratorPrototype%"===e){var n=t("%AsyncGenerator%");n&&d&&(i=d(n.prototype))}return m[e]=i,i}(n)),void 0===a&&!e)throw new o("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:a}}throw new r("intrinsic "+t+" does not exist!")};t.exports=function(t,e){if("string"!=typeof t||0===t.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new o('"allowMissing" argument must be a boolean');if(null===E(/^%?[^%]*%?$/,t))throw new r("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=M(t),n=i.length>0?i[0]:"",s=I("%"+n+"%",e),l=s.name,c=s.value,u=!1,h=s.alias;h&&(n=h[0],b(i,x([0,1],h)));for(var d=1,p=!0;d<i.length;d+=1){var f=i[d],g=T(f,0,1),_=T(f,-1);if(('"'===g||"'"===g||"`"===g||'"'===_||"'"===_||"`"===_)&&g!==_)throw new r("property names with quotes must have matching quotes");if("constructor"!==f&&p||(u=!0),v(m,l="%"+(n+="."+f)+"%"))c=m[l];else if(null!=c){if(!(f in c)){if(!e)throw new o("base intrinsic for "+t+" exists, but the property is not available.");return}if(a&&d+1>=i.length){var y=a(c,f);c=(p=!!y)&&"get"in y&&!("originalValue"in y.get)?y.get:c[f]}else p=v(c,f),c=c[f];p&&!u&&(m[l]=c)}}return c}},"B/eG":function(t,e,i){"use strict";(function(t){var r=i("/pFH"),n=i("+Nns"),o=i("oh6g"),s=setTimeout;function a(t){return Boolean(t&&void 0!==t.length)}function l(){}function c(t){if(!(this instanceof c))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],m(t,this)}function u(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,c._immediateFn((function(){var i=1===t._state?e.onFulfilled:e.onRejected;if(null!==i){var r;try{r=i(t._value)}catch(t){return void d(e.promise,t)}h(e.promise,r)}else(1===t._state?h:d)(e.promise,t._value)}))):t._deferreds.push(e)}function h(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var i=e.then;if(e instanceof c)return t._state=3,t._value=e,void p(t);if("function"==typeof i)return void m((r=i,n=e,function(){r.apply(n,arguments)}),t)}t._state=1,t._value=e,p(t)}catch(e){d(t,e)}var r,n}function d(t,e){t._state=2,t._value=e,p(t)}function p(t){2===t._state&&0===t._deferreds.length&&c._immediateFn((function(){t._handled||c._unhandledRejectionFn(t._value)}));for(var e=0,i=t._deferreds.length;e<i;e++)u(t,t._deferreds[e]);t._deferreds=null}function f(t,e,i){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=i}function m(t,e){var i=!1;try{t((function(t){i||(i=!0,h(e,t))}),(function(t){i||(i=!0,d(e,t))}))}catch(t){if(i)return;i=!0,d(e,t)}}c.prototype.catch=function(t){return this.then(null,t)},c.prototype.then=function(t,e){var i=new this.constructor(l);return u(this,new f(t,e,i)),i},c.prototype.finally=r.a,c.all=function(t){return new c((function(e,i){if(!a(t))return i(new TypeError("Promise.all accepts an array"));var r=Array.prototype.slice.call(t);if(0===r.length)return e([]);var n=r.length;function o(t,s){try{if(s&&("object"==typeof s||"function"==typeof s)){var a=s.then;if("function"==typeof a)return void a.call(s,(function(e){o(t,e)}),i)}r[t]=s,0==--n&&e(r)}catch(t){i(t)}}for(var s=0;s<r.length;s++)o(s,r[s])}))},c.any=o.a,c.allSettled=n.a,c.resolve=function(t){return t&&"object"==typeof t&&t.constructor===c?t:new c((function(e){e(t)}))},c.reject=function(t){return new c((function(e,i){i(t)}))},c.race=function(t){return new c((function(e,i){if(!a(t))return i(new TypeError("Promise.race accepts an array"));for(var r=0,n=t.length;r<n;r++)c.resolve(t[r]).then(e,i)}))},c._immediateFn="function"==typeof t&&function(e){t(e)}||function(t){s(t,0)},c._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)},e.a=c}).call(this,i("URgk").setImmediate)},BFHv:function(t,e,i){var r,n,o;!function(s){"use strict";n=[i("EVdn")],void 0===(o="function"==typeof(r=function(t){var e=-1,i=-1,r=function(t){return parseFloat(t)||0},n=function(e){var i=t(e),n=null,o=[];return i.each((function(){var e=t(this),i=e.offset().top-r(e.css("margin-top")),s=o.length>0?o[o.length-1]:null;null===s?o.push(e):Math.floor(Math.abs(n-i))<=1?o[o.length-1]=s.add(e):o.push(e),n=i})),o},o=function(e){var i={byRow:!0,property:"height",target:null,remove:!1};return"object"==typeof e?t.extend(i,e):("boolean"==typeof e?i.byRow=e:"remove"===e&&(i.remove=!0),i)},s=t.fn.matchHeight=function(e){var i=o(e);if(i.remove){var r=this;return this.css(i.property,""),t.each(s._groups,(function(t,e){e.elements=e.elements.not(r)})),this}return this.length<=1&&!i.target||(s._groups.push({elements:this,options:i}),s._apply(this,i)),this};s.version="0.7.2",s._groups=[],s._throttle=80,s._maintainScroll=!1,s._beforeUpdate=null,s._afterUpdate=null,s._rows=n,s._parse=r,s._parseOptions=o,s._apply=function(e,i){var a=o(i),l=t(e),c=[l],u=t(window).scrollTop(),h=t("html").outerHeight(!0),d=l.parents().filter(":hidden");return d.each((function(){var e=t(this);e.data("style-cache",e.attr("style"))})),d.css("display","block"),a.byRow&&!a.target&&(l.each((function(){var e=t(this),i=e.css("display");"inline-block"!==i&&"flex"!==i&&"inline-flex"!==i&&(i="block"),e.data("style-cache",e.attr("style")),e.css({display:i,"padding-top":"0","padding-bottom":"0","margin-top":"0","margin-bottom":"0","border-top-width":"0","border-bottom-width":"0",height:"100px",overflow:"hidden"})})),c=n(l),l.each((function(){var e=t(this);e.attr("style",e.data("style-cache")||"")}))),t.each(c,(function(e,i){var n=t(i),o=0;if(a.target)o=a.target.outerHeight(!1);else{if(a.byRow&&n.length<=1)return void n.css(a.property,"");n.each((function(){var e=t(this),i=e.attr("style"),r=e.css("display");"inline-block"!==r&&"flex"!==r&&"inline-flex"!==r&&(r="block");var n={display:r};n[a.property]="",e.css(n),e.outerHeight(!1)>o&&(o=e.outerHeight(!1)),i?e.attr("style",i):e.css("display","")}))}n.each((function(){var e=t(this),i=0;a.target&&e.is(a.target)||("border-box"!==e.css("box-sizing")&&(i+=r(e.css("border-top-width"))+r(e.css("border-bottom-width")),i+=r(e.css("padding-top"))+r(e.css("padding-bottom"))),e.css(a.property,o-i+"px"))}))})),d.each((function(){var e=t(this);e.attr("style",e.data("style-cache")||null)})),s._maintainScroll&&t(window).scrollTop(u/h*t("html").outerHeight(!0)),this},s._applyDataApi=function(){var e={};t("[data-match-height], [data-mh]").each((function(){var i=t(this),r=i.attr("data-mh")||i.attr("data-match-height");e[r]=r in e?e[r].add(i):i})),t.each(e,(function(){this.matchHeight(!0)}))};var a=function(e){s._beforeUpdate&&s._beforeUpdate(e,s._groups),t.each(s._groups,(function(){s._apply(this.elements,this.options)})),s._afterUpdate&&s._afterUpdate(e,s._groups)};s._update=function(r,n){if(n&&"resize"===n.type){var o=t(window).width();if(o===e)return;e=o}r?-1===i&&(i=setTimeout((function(){a(n),i=-1}),s._throttle)):a(n)},t(s._applyDataApi);var l=t.fn.on?"on":"bind";t(window)[l]("load",(function(t){s._update(!1,t)})),t(window)[l]("resize orientationchange",(function(t){s._update(!0,t)}))})?r.apply(e,n):r)||(t.exports=o)}()},CgaS:function(t,e,i){"use strict";var r=i("xTJ+"),n=i("MLWZ"),o=i("9rSQ"),s=i("UnBK"),a=i("SntB"),l=i("hIuj"),c=l.validators;function u(t){this.defaults=t,this.interceptors={request:new o,response:new o}}u.prototype.request=function(t){"string"==typeof t?(t=arguments[1]||{}).url=arguments[0]:t=t||{},(t=a(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var e=t.transitional;void 0!==e&&l.assertOptions(e,{silentJSONParsing:c.transitional(c.boolean,"1.0.0"),forcedJSONParsing:c.transitional(c.boolean,"1.0.0"),clarifyTimeoutError:c.transitional(c.boolean,"1.0.0")},!1);var i=[],r=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(r=r&&e.synchronous,i.unshift(e.fulfilled,e.rejected))}));var n,o=[];if(this.interceptors.response.forEach((function(t){o.push(t.fulfilled,t.rejected)})),!r){var u=[s,void 0];for(Array.prototype.unshift.apply(u,i),u=u.concat(o),n=Promise.resolve(t);u.length;)n=n.then(u.shift(),u.shift());return n}for(var h=t;i.length;){var d=i.shift(),p=i.shift();try{h=d(h)}catch(t){p(t);break}}try{n=s(h)}catch(t){return Promise.reject(t)}for(;o.length;)n=n.then(o.shift(),o.shift());return n},u.prototype.getUri=function(t){return t=a(this.defaults,t),n(t.url,t.params,t.paramsSerializer).replace(/^\?/,"")},r.forEach(["delete","get","head","options"],(function(t){u.prototype[t]=function(e,i){return this.request(a(i||{},{method:t,url:e,data:(i||{}).data}))}})),r.forEach(["post","put","patch"],(function(t){u.prototype[t]=function(e,i,r){return this.request(a(r||{},{method:t,url:e,data:i}))}})),t.exports=u},CjYj:function(t,e,i){"use strict";var r={foo:{}},n=Object;t.exports=function(){return{__proto__:r}.foo===r.foo&&!({__proto__:null}instanceof n)}},CxY0:function(t,e,i){"use strict";var r=i("GYWy");function n(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var o=/^([a-z0-9.+-]+:)/i,s=/:[0-9]*$/,a=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,l=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),c=["'"].concat(l),u=["%","/","?",";","#"].concat(c),h=["/","?","#"],d=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,f={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},g={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},_=i("Qyje");function y(t,e,i){if(t&&"object"==typeof t&&t instanceof n)return t;var r=new n;return r.parse(t,e,i),r}n.prototype.parse=function(t,e,i){if("string"!=typeof t)throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var n=t.indexOf("?"),s=-1!==n&&n<t.indexOf("#")?"?":"#",l=t.split(s);l[0]=l[0].replace(/\\/g,"/");var y=t=l.join(s);if(y=y.trim(),!i&&1===t.split("#").length){var v=a.exec(y);if(v)return this.path=y,this.href=y,this.pathname=v[1],v[2]?(this.search=v[2],this.query=e?_.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var x=o.exec(y);if(x){var b=(x=x[0]).toLowerCase();this.protocol=b,y=y.substr(x.length)}if(i||x||y.match(/^\/\/[^@/]+@[^@/]+/)){var w="//"===y.substr(0,2);!w||x&&m[x]||(y=y.substr(2),this.slashes=!0)}if(!m[x]&&(w||x&&!g[x])){for(var T,E,S=-1,A=0;A<h.length;A++){-1!==(M=y.indexOf(h[A]))&&(-1===S||M<S)&&(S=M)}-1!==(E=-1===S?y.lastIndexOf("@"):y.lastIndexOf("@",S))&&(T=y.slice(0,E),y=y.slice(E+1),this.auth=decodeURIComponent(T)),S=-1;for(A=0;A<u.length;A++){var M;-1!==(M=y.indexOf(u[A]))&&(-1===S||M<S)&&(S=M)}-1===S&&(S=y.length),this.host=y.slice(0,S),y=y.slice(S),this.parseHost(),this.hostname=this.hostname||"";var I="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!I)for(var C=this.hostname.split(/\./),P=(A=0,C.length);A<P;A++){var R=C[A];if(R&&!R.match(d)){for(var O="",D=0,L=R.length;D<L;D++)R.charCodeAt(D)>127?O+="x":O+=R[D];if(!O.match(d)){var k=C.slice(0,A),B=C.slice(A+1),F=R.match(p);F&&(k.push(F[1]),B.unshift(F[2])),B.length&&(y="/"+B.join(".")+y),this.hostname=k.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),I||(this.hostname=r.toASCII(this.hostname));var z=this.port?":"+this.port:"",N=this.hostname||"";this.host=N+z,this.href+=this.host,I&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==y[0]&&(y="/"+y))}if(!f[b])for(A=0,P=c.length;A<P;A++){var U=c[A];if(-1!==y.indexOf(U)){var G=encodeURIComponent(U);G===U&&(G=escape(U)),y=y.split(U).join(G)}}var j=y.indexOf("#");-1!==j&&(this.hash=y.substr(j),y=y.slice(0,j));var V=y.indexOf("?");if(-1!==V?(this.search=y.substr(V),this.query=y.substr(V+1),e&&(this.query=_.parse(this.query)),y=y.slice(0,V)):e&&(this.search="",this.query={}),y&&(this.pathname=y),g[b]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){z=this.pathname||"";var X=this.search||"";this.path=z+X}return this.href=this.format(),this},n.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",i=this.pathname||"",r=this.hash||"",n=!1,o="";this.host?n=t+this.host:this.hostname&&(n=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&"object"==typeof this.query&&Object.keys(this.query).length&&(o=_.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var s=this.search||o&&"?"+o||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||g[e])&&!1!==n?(n="//"+(n||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):n||(n=""),r&&"#"!==r.charAt(0)&&(r="#"+r),s&&"?"!==s.charAt(0)&&(s="?"+s),e+n+(i=i.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(s=s.replace("#","%23"))+r},n.prototype.resolve=function(t){return this.resolveObject(y(t,!1,!0)).format()},n.prototype.resolveObject=function(t){if("string"==typeof t){var e=new n;e.parse(t,!1,!0),t=e}for(var i=new n,r=Object.keys(this),o=0;o<r.length;o++){var s=r[o];i[s]=this[s]}if(i.hash=t.hash,""===t.href)return i.href=i.format(),i;if(t.slashes&&!t.protocol){for(var a=Object.keys(t),l=0;l<a.length;l++){var c=a[l];"protocol"!==c&&(i[c]=t[c])}return g[i.protocol]&&i.hostname&&!i.pathname&&(i.pathname="/",i.path=i.pathname),i.href=i.format(),i}if(t.protocol&&t.protocol!==i.protocol){if(!g[t.protocol]){for(var u=Object.keys(t),h=0;h<u.length;h++){var d=u[h];i[d]=t[d]}return i.href=i.format(),i}if(i.protocol=t.protocol,t.host||m[t.protocol])i.pathname=t.pathname;else{for(var p=(t.pathname||"").split("/");p.length&&!(t.host=p.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),i.pathname=p.join("/")}if(i.search=t.search,i.query=t.query,i.host=t.host||"",i.auth=t.auth,i.hostname=t.hostname||t.host,i.port=t.port,i.pathname||i.search){var f=i.pathname||"",_=i.search||"";i.path=f+_}return i.slashes=i.slashes||t.slashes,i.href=i.format(),i}var y=i.pathname&&"/"===i.pathname.charAt(0),v=t.host||t.pathname&&"/"===t.pathname.charAt(0),x=v||y||i.host&&t.pathname,b=x,w=i.pathname&&i.pathname.split("/")||[],T=(p=t.pathname&&t.pathname.split("/")||[],i.protocol&&!g[i.protocol]);if(T&&(i.hostname="",i.port=null,i.host&&(""===w[0]?w[0]=i.host:w.unshift(i.host)),i.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===p[0]?p[0]=t.host:p.unshift(t.host)),t.host=null),x=x&&(""===p[0]||""===w[0])),v)i.host=t.host||""===t.host?t.host:i.host,i.hostname=t.hostname||""===t.hostname?t.hostname:i.hostname,i.search=t.search,i.query=t.query,w=p;else if(p.length)w||(w=[]),w.pop(),w=w.concat(p),i.search=t.search,i.query=t.query;else if(null!=t.search){if(T)i.host=w.shift(),i.hostname=i.host,(I=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=I.shift(),i.hostname=I.shift(),i.host=i.hostname);return i.search=t.search,i.query=t.query,null===i.pathname&&null===i.search||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!w.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var E=w.slice(-1)[0],S=(i.host||t.host||w.length>1)&&("."===E||".."===E)||""===E,A=0,M=w.length;M>=0;M--)"."===(E=w[M])?w.splice(M,1):".."===E?(w.splice(M,1),A++):A&&(w.splice(M,1),A--);if(!x&&!b)for(;A--;A)w.unshift("..");!x||""===w[0]||w[0]&&"/"===w[0].charAt(0)||w.unshift(""),S&&"/"!==w.join("/").substr(-1)&&w.push("");var I,C=""===w[0]||w[0]&&"/"===w[0].charAt(0);T&&(i.hostname=C?"":w.length?w.shift():"",i.host=i.hostname,(I=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=I.shift(),i.hostname=I.shift(),i.host=i.hostname));return(x=x||i.host&&w.length)&&!C&&w.unshift(""),w.length>0?i.pathname=w.join("/"):(i.pathname=null,i.path=null),null===i.pathname&&null===i.search||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=t.auth||i.auth,i.slashes=i.slashes||t.slashes,i.href=i.format(),i},n.prototype.parseHost=function(){var t=this.host,e=s.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)},e.parse=y,e.resolve=function(t,e){return y(t,!1,!0).resolve(e)},e.resolveObject=function(t,e){return t?y(t,!1,!0).resolveObject(e):e},e.format=function(t){return"string"==typeof t&&(t=y(t)),t instanceof n?t.format():n.prototype.format.call(t)},e.Url=n},D3zA:function(t,e,i){"use strict";var r=i("aI7X");t.exports=Function.prototype.bind||r},DfZB:function(t,e,i){"use strict";t.exports=function(t){return function(e){return t.apply(null,e)}}},EVdn:function(t,e,i){var r;!function(e,i){"use strict";"object"==typeof t.exports?t.exports=e.document?i(e,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return i(t)}:i(e)}("undefined"!=typeof window?window:this,(function(i,n){"use strict";var o=[],s=Object.getPrototypeOf,a=o.slice,l=o.flat?function(t){return o.flat.call(t)}:function(t){return o.concat.apply([],t)},c=o.push,u=o.indexOf,h={},d=h.toString,p=h.hasOwnProperty,f=p.toString,m=f.call(Object),g={},_=function(t){return"function"==typeof t&&"number"!=typeof t.nodeType&&"function"!=typeof t.item},y=function(t){return null!=t&&t===t.window},v=i.document,x={type:!0,src:!0,nonce:!0,noModule:!0};function b(t,e,i){var r,n,o=(i=i||v).createElement("script");if(o.text=t,e)for(r in x)(n=e[r]||e.getAttribute&&e.getAttribute(r))&&o.setAttribute(r,n);i.head.appendChild(o).parentNode.removeChild(o)}function w(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?h[d.call(t)]||"object":typeof t}var T=/HTML$/i,E=function(t,e){return new E.fn.init(t,e)};function S(t){var e=!!t&&"length"in t&&t.length,i=w(t);return!_(t)&&!y(t)&&("array"===i||0===e||"number"==typeof e&&e>0&&e-1 in t)}function A(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()}E.fn=E.prototype={jquery:"3.7.1",constructor:E,length:0,toArray:function(){return a.call(this)},get:function(t){return null==t?a.call(this):t<0?this[t+this.length]:this[t]},pushStack:function(t){var e=E.merge(this.constructor(),t);return e.prevObject=this,e},each:function(t){return E.each(this,t)},map:function(t){return this.pushStack(E.map(this,(function(e,i){return t.call(e,i,e)})))},slice:function(){return this.pushStack(a.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(E.grep(this,(function(t,e){return(e+1)%2})))},odd:function(){return this.pushStack(E.grep(this,(function(t,e){return e%2})))},eq:function(t){var e=this.length,i=+t+(t<0?e:0);return this.pushStack(i>=0&&i<e?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:c,sort:o.sort,splice:o.splice},E.extend=E.fn.extend=function(){var t,e,i,r,n,o,s=arguments[0]||{},a=1,l=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[a]||{},a++),"object"==typeof s||_(s)||(s={}),a===l&&(s=this,a--);a<l;a++)if(null!=(t=arguments[a]))for(e in t)r=t[e],"__proto__"!==e&&s!==r&&(c&&r&&(E.isPlainObject(r)||(n=Array.isArray(r)))?(i=s[e],o=n&&!Array.isArray(i)?[]:n||E.isPlainObject(i)?i:{},n=!1,s[e]=E.extend(c,o,r)):void 0!==r&&(s[e]=r));return s},E.extend({expando:"jQuery"+("3.7.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isPlainObject:function(t){var e,i;return!(!t||"[object Object]"!==d.call(t))&&(!(e=s(t))||"function"==typeof(i=p.call(e,"constructor")&&e.constructor)&&f.call(i)===m)},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},globalEval:function(t,e,i){b(t,{nonce:e&&e.nonce},i)},each:function(t,e){var i,r=0;if(S(t))for(i=t.length;r<i&&!1!==e.call(t[r],r,t[r]);r++);else for(r in t)if(!1===e.call(t[r],r,t[r]))break;return t},text:function(t){var e,i="",r=0,n=t.nodeType;if(!n)for(;e=t[r++];)i+=E.text(e);return 1===n||11===n?t.textContent:9===n?t.documentElement.textContent:3===n||4===n?t.nodeValue:i},makeArray:function(t,e){var i=e||[];return null!=t&&(S(Object(t))?E.merge(i,"string"==typeof t?[t]:t):c.call(i,t)),i},inArray:function(t,e,i){return null==e?-1:u.call(e,t,i)},isXMLDoc:function(t){var e=t&&t.namespaceURI,i=t&&(t.ownerDocument||t).documentElement;return!T.test(e||i&&i.nodeName||"HTML")},merge:function(t,e){for(var i=+e.length,r=0,n=t.length;r<i;r++)t[n++]=e[r];return t.length=n,t},grep:function(t,e,i){for(var r=[],n=0,o=t.length,s=!i;n<o;n++)!e(t[n],n)!==s&&r.push(t[n]);return r},map:function(t,e,i){var r,n,o=0,s=[];if(S(t))for(r=t.length;o<r;o++)null!=(n=e(t[o],o,i))&&s.push(n);else for(o in t)null!=(n=e(t[o],o,i))&&s.push(n);return l(s)},guid:1,support:g}),"function"==typeof Symbol&&(E.fn[Symbol.iterator]=o[Symbol.iterator]),E.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(t,e){h["[object "+e+"]"]=e.toLowerCase()}));var M=o.pop,I=o.sort,C=o.splice,P="[\\x20\\t\\r\\n\\f]",R=new RegExp("^"+P+"+|((?:^|[^\\\\])(?:\\\\.)*)"+P+"+$","g");E.contains=function(t,e){var i=e&&e.parentNode;return t===i||!(!i||1!==i.nodeType||!(t.contains?t.contains(i):t.compareDocumentPosition&&16&t.compareDocumentPosition(i)))};var O=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function D(t,e){return e?"\0"===t?"":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t}E.escapeSelector=function(t){return(t+"").replace(O,D)};var L=v,k=c;!function(){var t,e,r,n,s,l,c,h,d,f,m=k,_=E.expando,y=0,v=0,x=tt(),b=tt(),w=tt(),T=tt(),S=function(t,e){return t===e&&(s=!0),0},O="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",D="(?:\\\\[\\da-fA-F]{1,6}"+P+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",B="\\["+P+"*("+D+")(?:"+P+"*([*^$|!~]?=)"+P+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+D+"))|)"+P+"*\\]",F=":("+D+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+B+")*)|.*)\\)|)",z=new RegExp(P+"+","g"),N=new RegExp("^"+P+"*,"+P+"*"),U=new RegExp("^"+P+"*([>+~]|"+P+")"+P+"*"),G=new RegExp(P+"|>"),j=new RegExp(F),V=new RegExp("^"+D+"$"),X={ID:new RegExp("^#("+D+")"),CLASS:new RegExp("^\\.("+D+")"),TAG:new RegExp("^("+D+"|[*])"),ATTR:new RegExp("^"+B),PSEUDO:new RegExp("^"+F),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+P+"*(even|odd|(([+-]|)(\\d*)n|)"+P+"*(?:([+-]|)"+P+"*(\\d+)|))"+P+"*\\)|)","i"),bool:new RegExp("^(?:"+O+")$","i"),needsContext:new RegExp("^"+P+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+P+"*((?:-\\d)?\\d*)"+P+"*\\)|)(?=[^-]|$)","i")},H=/^(?:input|select|textarea|button)$/i,q=/^h\d$/i,W=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,$=/[+~]/,Y=new RegExp("\\\\[\\da-fA-F]{1,6}"+P+"?|\\\\([^\\r\\n\\f])","g"),Z=function(t,e){var i="0x"+t.slice(1)-65536;return e||(i<0?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,1023&i|56320))},K=function(){lt()},J=dt((function(t){return!0===t.disabled&&A(t,"fieldset")}),{dir:"parentNode",next:"legend"});try{m.apply(o=a.call(L.childNodes),L.childNodes),o[L.childNodes.length].nodeType}catch(t){m={apply:function(t,e){k.apply(t,a.call(e))},call:function(t){k.apply(t,a.call(arguments,1))}}}function Q(t,e,i,r){var n,o,s,a,c,u,p,f=e&&e.ownerDocument,y=e?e.nodeType:9;if(i=i||[],"string"!=typeof t||!t||1!==y&&9!==y&&11!==y)return i;if(!r&&(lt(e),e=e||l,h)){if(11!==y&&(c=W.exec(t)))if(n=c[1]){if(9===y){if(!(s=e.getElementById(n)))return i;if(s.id===n)return m.call(i,s),i}else if(f&&(s=f.getElementById(n))&&Q.contains(e,s)&&s.id===n)return m.call(i,s),i}else{if(c[2])return m.apply(i,e.getElementsByTagName(t)),i;if((n=c[3])&&e.getElementsByClassName)return m.apply(i,e.getElementsByClassName(n)),i}if(!(T[t+" "]||d&&d.test(t))){if(p=t,f=e,1===y&&(G.test(t)||U.test(t))){for((f=$.test(t)&&at(e.parentNode)||e)==e&&g.scope||((a=e.getAttribute("id"))?a=E.escapeSelector(a):e.setAttribute("id",a=_)),o=(u=ut(t)).length;o--;)u[o]=(a?"#"+a:":scope")+" "+ht(u[o]);p=u.join(",")}try{return m.apply(i,f.querySelectorAll(p)),i}catch(e){T(t,!0)}finally{a===_&&e.removeAttribute("id")}}}return yt(t.replace(R,"$1"),e,i,r)}function tt(){var t=[];return function i(r,n){return t.push(r+" ")>e.cacheLength&&delete i[t.shift()],i[r+" "]=n}}function et(t){return t[_]=!0,t}function it(t){var e=l.createElement("fieldset");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function rt(t){return function(e){return A(e,"input")&&e.type===t}}function nt(t){return function(e){return(A(e,"input")||A(e,"button"))&&e.type===t}}function ot(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&J(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function st(t){return et((function(e){return e=+e,et((function(i,r){for(var n,o=t([],i.length,e),s=o.length;s--;)i[n=o[s]]&&(i[n]=!(r[n]=i[n]))}))}))}function at(t){return t&&void 0!==t.getElementsByTagName&&t}function lt(t){var i,r=t?t.ownerDocument||t:L;return r!=l&&9===r.nodeType&&r.documentElement?(c=(l=r).documentElement,h=!E.isXMLDoc(l),f=c.matches||c.webkitMatchesSelector||c.msMatchesSelector,c.msMatchesSelector&&L!=l&&(i=l.defaultView)&&i.top!==i&&i.addEventListener("unload",K),g.getById=it((function(t){return c.appendChild(t).id=E.expando,!l.getElementsByName||!l.getElementsByName(E.expando).length})),g.disconnectedMatch=it((function(t){return f.call(t,"*")})),g.scope=it((function(){return l.querySelectorAll(":scope")})),g.cssHas=it((function(){try{return l.querySelector(":has(*,:jqfake)"),!1}catch(t){return!0}})),g.getById?(e.filter.ID=function(t){var e=t.replace(Y,Z);return function(t){return t.getAttribute("id")===e}},e.find.ID=function(t,e){if(void 0!==e.getElementById&&h){var i=e.getElementById(t);return i?[i]:[]}}):(e.filter.ID=function(t){var e=t.replace(Y,Z);return function(t){var i=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return i&&i.value===e}},e.find.ID=function(t,e){if(void 0!==e.getElementById&&h){var i,r,n,o=e.getElementById(t);if(o){if((i=o.getAttributeNode("id"))&&i.value===t)return[o];for(n=e.getElementsByName(t),r=0;o=n[r++];)if((i=o.getAttributeNode("id"))&&i.value===t)return[o]}return[]}}),e.find.TAG=function(t,e){return void 0!==e.getElementsByTagName?e.getElementsByTagName(t):e.querySelectorAll(t)},e.find.CLASS=function(t,e){if(void 0!==e.getElementsByClassName&&h)return e.getElementsByClassName(t)},d=[],it((function(t){var e;c.appendChild(t).innerHTML="<a id='"+_+"' href='' disabled='disabled'></a><select id='"+_+"-\r\\' disabled='disabled'><option selected=''></option></select>",t.querySelectorAll("[selected]").length||d.push("\\["+P+"*(?:value|"+O+")"),t.querySelectorAll("[id~="+_+"-]").length||d.push("~="),t.querySelectorAll("a#"+_+"+*").length||d.push(".#.+[+~]"),t.querySelectorAll(":checked").length||d.push(":checked"),(e=l.createElement("input")).setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),c.appendChild(t).disabled=!0,2!==t.querySelectorAll(":disabled").length&&d.push(":enabled",":disabled"),(e=l.createElement("input")).setAttribute("name",""),t.appendChild(e),t.querySelectorAll("[name='']").length||d.push("\\["+P+"*name"+P+"*="+P+"*(?:''|\"\")")})),g.cssHas||d.push(":has"),d=d.length&&new RegExp(d.join("|")),S=function(t,e){if(t===e)return s=!0,0;var i=!t.compareDocumentPosition-!e.compareDocumentPosition;return i||(1&(i=(t.ownerDocument||t)==(e.ownerDocument||e)?t.compareDocumentPosition(e):1)||!g.sortDetached&&e.compareDocumentPosition(t)===i?t===l||t.ownerDocument==L&&Q.contains(L,t)?-1:e===l||e.ownerDocument==L&&Q.contains(L,e)?1:n?u.call(n,t)-u.call(n,e):0:4&i?-1:1)},l):l}for(t in Q.matches=function(t,e){return Q(t,null,null,e)},Q.matchesSelector=function(t,e){if(lt(t),h&&!T[e+" "]&&(!d||!d.test(e)))try{var i=f.call(t,e);if(i||g.disconnectedMatch||t.document&&11!==t.document.nodeType)return i}catch(t){T(e,!0)}return Q(e,l,null,[t]).length>0},Q.contains=function(t,e){return(t.ownerDocument||t)!=l&&lt(t),E.contains(t,e)},Q.attr=function(t,i){(t.ownerDocument||t)!=l&&lt(t);var r=e.attrHandle[i.toLowerCase()],n=r&&p.call(e.attrHandle,i.toLowerCase())?r(t,i,!h):void 0;return void 0!==n?n:t.getAttribute(i)},Q.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},E.uniqueSort=function(t){var e,i=[],r=0,o=0;if(s=!g.sortStable,n=!g.sortStable&&a.call(t,0),I.call(t,S),s){for(;e=t[o++];)e===t[o]&&(r=i.push(o));for(;r--;)C.call(t,i[r],1)}return n=null,t},E.fn.uniqueSort=function(){return this.pushStack(E.uniqueSort(a.apply(this)))},(e=E.expr={cacheLength:50,createPseudo:et,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(Y,Z),t[3]=(t[3]||t[4]||t[5]||"").replace(Y,Z),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||Q.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&Q.error(t[0]),t},PSEUDO:function(t){var e,i=!t[6]&&t[2];return X.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":i&&j.test(i)&&(e=ut(i,!0))&&(e=i.indexOf(")",i.length-e)-i.length)&&(t[0]=t[0].slice(0,e),t[2]=i.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(Y,Z).toLowerCase();return"*"===t?function(){return!0}:function(t){return A(t,e)}},CLASS:function(t){var e=x[t+" "];return e||(e=new RegExp("(^|"+P+")"+t+"("+P+"|$)"))&&x(t,(function(t){return e.test("string"==typeof t.className&&t.className||void 0!==t.getAttribute&&t.getAttribute("class")||"")}))},ATTR:function(t,e,i){return function(r){var n=Q.attr(r,t);return null==n?"!="===e:!e||(n+="","="===e?n===i:"!="===e?n!==i:"^="===e?i&&0===n.indexOf(i):"*="===e?i&&n.indexOf(i)>-1:"$="===e?i&&n.slice(-i.length)===i:"~="===e?(" "+n.replace(z," ")+" ").indexOf(i)>-1:"|="===e&&(n===i||n.slice(0,i.length+1)===i+"-"))}},CHILD:function(t,e,i,r,n){var o="nth"!==t.slice(0,3),s="last"!==t.slice(-4),a="of-type"===e;return 1===r&&0===n?function(t){return!!t.parentNode}:function(e,i,l){var c,u,h,d,p,f=o!==s?"nextSibling":"previousSibling",m=e.parentNode,g=a&&e.nodeName.toLowerCase(),v=!l&&!a,x=!1;if(m){if(o){for(;f;){for(h=e;h=h[f];)if(a?A(h,g):1===h.nodeType)return!1;p=f="only"===t&&!p&&"nextSibling"}return!0}if(p=[s?m.firstChild:m.lastChild],s&&v){for(x=(d=(c=(u=m[_]||(m[_]={}))[t]||[])[0]===y&&c[1])&&c[2],h=d&&m.childNodes[d];h=++d&&h&&h[f]||(x=d=0)||p.pop();)if(1===h.nodeType&&++x&&h===e){u[t]=[y,d,x];break}}else if(v&&(x=d=(c=(u=e[_]||(e[_]={}))[t]||[])[0]===y&&c[1]),!1===x)for(;(h=++d&&h&&h[f]||(x=d=0)||p.pop())&&(!(a?A(h,g):1===h.nodeType)||!++x||(v&&((u=h[_]||(h[_]={}))[t]=[y,x]),h!==e)););return(x-=n)===r||x%r==0&&x/r>=0}}},PSEUDO:function(t,i){var r,n=e.pseudos[t]||e.setFilters[t.toLowerCase()]||Q.error("unsupported pseudo: "+t);return n[_]?n(i):n.length>1?(r=[t,t,"",i],e.setFilters.hasOwnProperty(t.toLowerCase())?et((function(t,e){for(var r,o=n(t,i),s=o.length;s--;)t[r=u.call(t,o[s])]=!(e[r]=o[s])})):function(t){return n(t,0,r)}):n}},pseudos:{not:et((function(t){var e=[],i=[],r=_t(t.replace(R,"$1"));return r[_]?et((function(t,e,i,n){for(var o,s=r(t,null,n,[]),a=t.length;a--;)(o=s[a])&&(t[a]=!(e[a]=o))})):function(t,n,o){return e[0]=t,r(e,null,o,i),e[0]=null,!i.pop()}})),has:et((function(t){return function(e){return Q(t,e).length>0}})),contains:et((function(t){return t=t.replace(Y,Z),function(e){return(e.textContent||E.text(e)).indexOf(t)>-1}})),lang:et((function(t){return V.test(t||"")||Q.error("unsupported lang: "+t),t=t.replace(Y,Z).toLowerCase(),function(e){var i;do{if(i=h?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(i=i.toLowerCase())===t||0===i.indexOf(t+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}})),target:function(t){var e=i.location&&i.location.hash;return e&&e.slice(1)===t.id},root:function(t){return t===c},focus:function(t){return t===function(){try{return l.activeElement}catch(t){}}()&&l.hasFocus()&&!!(t.type||t.href||~t.tabIndex)},enabled:ot(!1),disabled:ot(!0),checked:function(t){return A(t,"input")&&!!t.checked||A(t,"option")&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!e.pseudos.empty(t)},header:function(t){return q.test(t.nodeName)},input:function(t){return H.test(t.nodeName)},button:function(t){return A(t,"input")&&"button"===t.type||A(t,"button")},text:function(t){var e;return A(t,"input")&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:st((function(){return[0]})),last:st((function(t,e){return[e-1]})),eq:st((function(t,e,i){return[i<0?i+e:i]})),even:st((function(t,e){for(var i=0;i<e;i+=2)t.push(i);return t})),odd:st((function(t,e){for(var i=1;i<e;i+=2)t.push(i);return t})),lt:st((function(t,e,i){var r;for(r=i<0?i+e:i>e?e:i;--r>=0;)t.push(r);return t})),gt:st((function(t,e,i){for(var r=i<0?i+e:i;++r<e;)t.push(r);return t}))}}).pseudos.nth=e.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})e.pseudos[t]=rt(t);for(t in{submit:!0,reset:!0})e.pseudos[t]=nt(t);function ct(){}function ut(t,i){var r,n,o,s,a,l,c,u=b[t+" "];if(u)return i?0:u.slice(0);for(a=t,l=[],c=e.preFilter;a;){for(s in r&&!(n=N.exec(a))||(n&&(a=a.slice(n[0].length)||a),l.push(o=[])),r=!1,(n=U.exec(a))&&(r=n.shift(),o.push({value:r,type:n[0].replace(R," ")}),a=a.slice(r.length)),e.filter)!(n=X[s].exec(a))||c[s]&&!(n=c[s](n))||(r=n.shift(),o.push({value:r,type:s,matches:n}),a=a.slice(r.length));if(!r)break}return i?a.length:a?Q.error(t):b(t,l).slice(0)}function ht(t){for(var e=0,i=t.length,r="";e<i;e++)r+=t[e].value;return r}function dt(t,e,i){var r=e.dir,n=e.next,o=n||r,s=i&&"parentNode"===o,a=v++;return e.first?function(e,i,n){for(;e=e[r];)if(1===e.nodeType||s)return t(e,i,n);return!1}:function(e,i,l){var c,u,h=[y,a];if(l){for(;e=e[r];)if((1===e.nodeType||s)&&t(e,i,l))return!0}else for(;e=e[r];)if(1===e.nodeType||s)if(u=e[_]||(e[_]={}),n&&A(e,n))e=e[r]||e;else{if((c=u[o])&&c[0]===y&&c[1]===a)return h[2]=c[2];if(u[o]=h,h[2]=t(e,i,l))return!0}return!1}}function pt(t){return t.length>1?function(e,i,r){for(var n=t.length;n--;)if(!t[n](e,i,r))return!1;return!0}:t[0]}function ft(t,e,i,r,n){for(var o,s=[],a=0,l=t.length,c=null!=e;a<l;a++)(o=t[a])&&(i&&!i(o,r,n)||(s.push(o),c&&e.push(a)));return s}function mt(t,e,i,r,n,o){return r&&!r[_]&&(r=mt(r)),n&&!n[_]&&(n=mt(n,o)),et((function(o,s,a,l){var c,h,d,p,f=[],g=[],_=s.length,y=o||function(t,e,i){for(var r=0,n=e.length;r<n;r++)Q(t,e[r],i);return i}(e||"*",a.nodeType?[a]:a,[]),v=!t||!o&&e?y:ft(y,f,t,a,l);if(i?i(v,p=n||(o?t:_||r)?[]:s,a,l):p=v,r)for(c=ft(p,g),r(c,[],a,l),h=c.length;h--;)(d=c[h])&&(p[g[h]]=!(v[g[h]]=d));if(o){if(n||t){if(n){for(c=[],h=p.length;h--;)(d=p[h])&&c.push(v[h]=d);n(null,p=[],c,l)}for(h=p.length;h--;)(d=p[h])&&(c=n?u.call(o,d):f[h])>-1&&(o[c]=!(s[c]=d))}}else p=ft(p===s?p.splice(_,p.length):p),n?n(null,s,p,l):m.apply(s,p)}))}function gt(t){for(var i,n,o,s=t.length,a=e.relative[t[0].type],l=a||e.relative[" "],c=a?1:0,h=dt((function(t){return t===i}),l,!0),d=dt((function(t){return u.call(i,t)>-1}),l,!0),p=[function(t,e,n){var o=!a&&(n||e!=r)||((i=e).nodeType?h(t,e,n):d(t,e,n));return i=null,o}];c<s;c++)if(n=e.relative[t[c].type])p=[dt(pt(p),n)];else{if((n=e.filter[t[c].type].apply(null,t[c].matches))[_]){for(o=++c;o<s&&!e.relative[t[o].type];o++);return mt(c>1&&pt(p),c>1&&ht(t.slice(0,c-1).concat({value:" "===t[c-2].type?"*":""})).replace(R,"$1"),n,c<o&&gt(t.slice(c,o)),o<s&&gt(t=t.slice(o)),o<s&&ht(t))}p.push(n)}return pt(p)}function _t(t,i){var n,o=[],s=[],a=w[t+" "];if(!a){for(i||(i=ut(t)),n=i.length;n--;)(a=gt(i[n]))[_]?o.push(a):s.push(a);(a=w(t,function(t,i){var n=i.length>0,o=t.length>0,s=function(s,a,c,u,d){var p,f,g,_=0,v="0",x=s&&[],b=[],w=r,T=s||o&&e.find.TAG("*",d),S=y+=null==w?1:Math.random()||.1,A=T.length;for(d&&(r=a==l||a||d);v!==A&&null!=(p=T[v]);v++){if(o&&p){for(f=0,a||p.ownerDocument==l||(lt(p),c=!h);g=t[f++];)if(g(p,a||l,c)){m.call(u,p);break}d&&(y=S)}n&&((p=!g&&p)&&_--,s&&x.push(p))}if(_+=v,n&&v!==_){for(f=0;g=i[f++];)g(x,b,a,c);if(s){if(_>0)for(;v--;)x[v]||b[v]||(b[v]=M.call(u));b=ft(b)}m.apply(u,b),d&&!s&&b.length>0&&_+i.length>1&&E.uniqueSort(u)}return d&&(y=S,r=w),x};return n?et(s):s}(s,o))).selector=t}return a}function yt(t,i,r,n){var o,s,a,l,c,u="function"==typeof t&&t,d=!n&&ut(t=u.selector||t);if(r=r||[],1===d.length){if((s=d[0]=d[0].slice(0)).length>2&&"ID"===(a=s[0]).type&&9===i.nodeType&&h&&e.relative[s[1].type]){if(!(i=(e.find.ID(a.matches[0].replace(Y,Z),i)||[])[0]))return r;u&&(i=i.parentNode),t=t.slice(s.shift().value.length)}for(o=X.needsContext.test(t)?0:s.length;o--&&(a=s[o],!e.relative[l=a.type]);)if((c=e.find[l])&&(n=c(a.matches[0].replace(Y,Z),$.test(s[0].type)&&at(i.parentNode)||i))){if(s.splice(o,1),!(t=n.length&&ht(s)))return m.apply(r,n),r;break}}return(u||_t(t,d))(n,i,!h,r,!i||$.test(t)&&at(i.parentNode)||i),r}ct.prototype=e.filters=e.pseudos,e.setFilters=new ct,g.sortStable=_.split("").sort(S).join("")===_,lt(),g.sortDetached=it((function(t){return 1&t.compareDocumentPosition(l.createElement("fieldset"))})),E.find=Q,E.expr[":"]=E.expr.pseudos,E.unique=E.uniqueSort,Q.compile=_t,Q.select=yt,Q.setDocument=lt,Q.tokenize=ut,Q.escape=E.escapeSelector,Q.getText=E.text,Q.isXML=E.isXMLDoc,Q.selectors=E.expr,Q.support=E.support,Q.uniqueSort=E.uniqueSort}();var B=function(t,e,i){for(var r=[],n=void 0!==i;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(n&&E(t).is(i))break;r.push(t)}return r},F=function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i},z=E.expr.match.needsContext,N=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function U(t,e,i){return _(e)?E.grep(t,(function(t,r){return!!e.call(t,r,t)!==i})):e.nodeType?E.grep(t,(function(t){return t===e!==i})):"string"!=typeof e?E.grep(t,(function(t){return u.call(e,t)>-1!==i})):E.filter(e,t,i)}E.filter=function(t,e,i){var r=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===r.nodeType?E.find.matchesSelector(r,t)?[r]:[]:E.find.matches(t,E.grep(e,(function(t){return 1===t.nodeType})))},E.fn.extend({find:function(t){var e,i,r=this.length,n=this;if("string"!=typeof t)return this.pushStack(E(t).filter((function(){for(e=0;e<r;e++)if(E.contains(n[e],this))return!0})));for(i=this.pushStack([]),e=0;e<r;e++)E.find(t,n[e],i);return r>1?E.uniqueSort(i):i},filter:function(t){return this.pushStack(U(this,t||[],!1))},not:function(t){return this.pushStack(U(this,t||[],!0))},is:function(t){return!!U(this,"string"==typeof t&&z.test(t)?E(t):t||[],!1).length}});var G,j=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(E.fn.init=function(t,e,i){var r,n;if(!t)return this;if(i=i||G,"string"==typeof t){if(!(r="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:j.exec(t))||!r[1]&&e)return!e||e.jquery?(e||i).find(t):this.constructor(e).find(t);if(r[1]){if(e=e instanceof E?e[0]:e,E.merge(this,E.parseHTML(r[1],e&&e.nodeType?e.ownerDocument||e:v,!0)),N.test(r[1])&&E.isPlainObject(e))for(r in e)_(this[r])?this[r](e[r]):this.attr(r,e[r]);return this}return(n=v.getElementById(r[2]))&&(this[0]=n,this.length=1),this}return t.nodeType?(this[0]=t,this.length=1,this):_(t)?void 0!==i.ready?i.ready(t):t(E):E.makeArray(t,this)}).prototype=E.fn,G=E(v);var V=/^(?:parents|prev(?:Until|All))/,X={children:!0,contents:!0,next:!0,prev:!0};function H(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}E.fn.extend({has:function(t){var e=E(t,this),i=e.length;return this.filter((function(){for(var t=0;t<i;t++)if(E.contains(this,e[t]))return!0}))},closest:function(t,e){var i,r=0,n=this.length,o=[],s="string"!=typeof t&&E(t);if(!z.test(t))for(;r<n;r++)for(i=this[r];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(s?s.index(i)>-1:1===i.nodeType&&E.find.matchesSelector(i,t))){o.push(i);break}return this.pushStack(o.length>1?E.uniqueSort(o):o)},index:function(t){return t?"string"==typeof t?u.call(E(t),this[0]):u.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(E.uniqueSort(E.merge(this.get(),E(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),E.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return B(t,"parentNode")},parentsUntil:function(t,e,i){return B(t,"parentNode",i)},next:function(t){return H(t,"nextSibling")},prev:function(t){return H(t,"previousSibling")},nextAll:function(t){return B(t,"nextSibling")},prevAll:function(t){return B(t,"previousSibling")},nextUntil:function(t,e,i){return B(t,"nextSibling",i)},prevUntil:function(t,e,i){return B(t,"previousSibling",i)},siblings:function(t){return F((t.parentNode||{}).firstChild,t)},children:function(t){return F(t.firstChild)},contents:function(t){return null!=t.contentDocument&&s(t.contentDocument)?t.contentDocument:(A(t,"template")&&(t=t.content||t),E.merge([],t.childNodes))}},(function(t,e){E.fn[t]=function(i,r){var n=E.map(this,e,i);return"Until"!==t.slice(-5)&&(r=i),r&&"string"==typeof r&&(n=E.filter(r,n)),this.length>1&&(X[t]||E.uniqueSort(n),V.test(t)&&n.reverse()),this.pushStack(n)}}));var q=/[^\x20\t\r\n\f]+/g;function W(t){return t}function $(t){throw t}function Y(t,e,i,r){var n;try{t&&_(n=t.promise)?n.call(t).done(e).fail(i):t&&_(n=t.then)?n.call(t,e,i):e.apply(void 0,[t].slice(r))}catch(t){i.apply(void 0,[t])}}E.Callbacks=function(t){t="string"==typeof t?function(t){var e={};return E.each(t.match(q)||[],(function(t,i){e[i]=!0})),e}(t):E.extend({},t);var e,i,r,n,o=[],s=[],a=-1,l=function(){for(n=n||t.once,r=e=!0;s.length;a=-1)for(i=s.shift();++a<o.length;)!1===o[a].apply(i[0],i[1])&&t.stopOnFalse&&(a=o.length,i=!1);t.memory||(i=!1),e=!1,n&&(o=i?[]:"")},c={add:function(){return o&&(i&&!e&&(a=o.length-1,s.push(i)),function e(i){E.each(i,(function(i,r){_(r)?t.unique&&c.has(r)||o.push(r):r&&r.length&&"string"!==w(r)&&e(r)}))}(arguments),i&&!e&&l()),this},remove:function(){return E.each(arguments,(function(t,e){for(var i;(i=E.inArray(e,o,i))>-1;)o.splice(i,1),i<=a&&a--})),this},has:function(t){return t?E.inArray(t,o)>-1:o.length>0},empty:function(){return o&&(o=[]),this},disable:function(){return n=s=[],o=i="",this},disabled:function(){return!o},lock:function(){return n=s=[],i||e||(o=i=""),this},locked:function(){return!!n},fireWith:function(t,i){return n||(i=[t,(i=i||[]).slice?i.slice():i],s.push(i),e||l()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!r}};return c},E.extend({Deferred:function(t){var e=[["notify","progress",E.Callbacks("memory"),E.Callbacks("memory"),2],["resolve","done",E.Callbacks("once memory"),E.Callbacks("once memory"),0,"resolved"],["reject","fail",E.Callbacks("once memory"),E.Callbacks("once memory"),1,"rejected"]],r="pending",n={state:function(){return r},always:function(){return o.done(arguments).fail(arguments),this},catch:function(t){return n.then(null,t)},pipe:function(){var t=arguments;return E.Deferred((function(i){E.each(e,(function(e,r){var n=_(t[r[4]])&&t[r[4]];o[r[1]]((function(){var t=n&&n.apply(this,arguments);t&&_(t.promise)?t.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[r[0]+"With"](this,n?[t]:arguments)}))})),t=null})).promise()},then:function(t,r,n){var o=0;function s(t,e,r,n){return function(){var a=this,l=arguments,c=function(){var i,c;if(!(t<o)){if((i=r.apply(a,l))===e.promise())throw new TypeError("Thenable self-resolution");c=i&&("object"==typeof i||"function"==typeof i)&&i.then,_(c)?n?c.call(i,s(o,e,W,n),s(o,e,$,n)):(o++,c.call(i,s(o,e,W,n),s(o,e,$,n),s(o,e,W,e.notifyWith))):(r!==W&&(a=void 0,l=[i]),(n||e.resolveWith)(a,l))}},u=n?c:function(){try{c()}catch(i){E.Deferred.exceptionHook&&E.Deferred.exceptionHook(i,u.error),t+1>=o&&(r!==$&&(a=void 0,l=[i]),e.rejectWith(a,l))}};t?u():(E.Deferred.getErrorHook?u.error=E.Deferred.getErrorHook():E.Deferred.getStackHook&&(u.error=E.Deferred.getStackHook()),i.setTimeout(u))}}return E.Deferred((function(i){e[0][3].add(s(0,i,_(n)?n:W,i.notifyWith)),e[1][3].add(s(0,i,_(t)?t:W)),e[2][3].add(s(0,i,_(r)?r:$))})).promise()},promise:function(t){return null!=t?E.extend(t,n):n}},o={};return E.each(e,(function(t,i){var s=i[2],a=i[5];n[i[1]]=s.add,a&&s.add((function(){r=a}),e[3-t][2].disable,e[3-t][3].disable,e[0][2].lock,e[0][3].lock),s.add(i[3].fire),o[i[0]]=function(){return o[i[0]+"With"](this===o?void 0:this,arguments),this},o[i[0]+"With"]=s.fireWith})),n.promise(o),t&&t.call(o,o),o},when:function(t){var e=arguments.length,i=e,r=Array(i),n=a.call(arguments),o=E.Deferred(),s=function(t){return function(i){r[t]=this,n[t]=arguments.length>1?a.call(arguments):i,--e||o.resolveWith(r,n)}};if(e<=1&&(Y(t,o.done(s(i)).resolve,o.reject,!e),"pending"===o.state()||_(n[i]&&n[i].then)))return o.then();for(;i--;)Y(n[i],s(i),o.reject);return o.promise()}});var Z=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;E.Deferred.exceptionHook=function(t,e){i.console&&i.console.warn&&t&&Z.test(t.name)&&i.console.warn("jQuery.Deferred exception: "+t.message,t.stack,e)},E.readyException=function(t){i.setTimeout((function(){throw t}))};var K=E.Deferred();function J(){v.removeEventListener("DOMContentLoaded",J),i.removeEventListener("load",J),E.ready()}E.fn.ready=function(t){return K.then(t).catch((function(t){E.readyException(t)})),this},E.extend({isReady:!1,readyWait:1,ready:function(t){(!0===t?--E.readyWait:E.isReady)||(E.isReady=!0,!0!==t&&--E.readyWait>0||K.resolveWith(v,[E]))}}),E.ready.then=K.then,"complete"===v.readyState||"loading"!==v.readyState&&!v.documentElement.doScroll?i.setTimeout(E.ready):(v.addEventListener("DOMContentLoaded",J),i.addEventListener("load",J));var Q=function(t,e,i,r,n,o,s){var a=0,l=t.length,c=null==i;if("object"===w(i))for(a in n=!0,i)Q(t,e,a,i[a],!0,o,s);else if(void 0!==r&&(n=!0,_(r)||(s=!0),c&&(s?(e.call(t,r),e=null):(c=e,e=function(t,e,i){return c.call(E(t),i)})),e))for(;a<l;a++)e(t[a],i,s?r:r.call(t[a],a,e(t[a],i)));return n?t:c?e.call(t):l?e(t[0],i):o},tt=/^-ms-/,et=/-([a-z])/g;function it(t,e){return e.toUpperCase()}function rt(t){return t.replace(tt,"ms-").replace(et,it)}var nt=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};function ot(){this.expando=E.expando+ot.uid++}ot.uid=1,ot.prototype={cache:function(t){var e=t[this.expando];return e||(e={},nt(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,i){var r,n=this.cache(t);if("string"==typeof e)n[rt(e)]=i;else for(r in e)n[rt(r)]=e[r];return n},get:function(t,e){return void 0===e?this.cache(t):t[this.expando]&&t[this.expando][rt(e)]},access:function(t,e,i){return void 0===e||e&&"string"==typeof e&&void 0===i?this.get(t,e):(this.set(t,e,i),void 0!==i?i:e)},remove:function(t,e){var i,r=t[this.expando];if(void 0!==r){if(void 0!==e){i=(e=Array.isArray(e)?e.map(rt):(e=rt(e))in r?[e]:e.match(q)||[]).length;for(;i--;)delete r[e[i]]}(void 0===e||E.isEmptyObject(r))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var e=t[this.expando];return void 0!==e&&!E.isEmptyObject(e)}};var st=new ot,at=new ot,lt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ct=/[A-Z]/g;function ut(t,e,i){var r;if(void 0===i&&1===t.nodeType)if(r="data-"+e.replace(ct,"-$&").toLowerCase(),"string"==typeof(i=t.getAttribute(r))){try{i=function(t){return"true"===t||"false"!==t&&("null"===t?null:t===+t+""?+t:lt.test(t)?JSON.parse(t):t)}(i)}catch(t){}at.set(t,e,i)}else i=void 0;return i}E.extend({hasData:function(t){return at.hasData(t)||st.hasData(t)},data:function(t,e,i){return at.access(t,e,i)},removeData:function(t,e){at.remove(t,e)},_data:function(t,e,i){return st.access(t,e,i)},_removeData:function(t,e){st.remove(t,e)}}),E.fn.extend({data:function(t,e){var i,r,n,o=this[0],s=o&&o.attributes;if(void 0===t){if(this.length&&(n=at.get(o),1===o.nodeType&&!st.get(o,"hasDataAttrs"))){for(i=s.length;i--;)s[i]&&0===(r=s[i].name).indexOf("data-")&&(r=rt(r.slice(5)),ut(o,r,n[r]));st.set(o,"hasDataAttrs",!0)}return n}return"object"==typeof t?this.each((function(){at.set(this,t)})):Q(this,(function(e){var i;if(o&&void 0===e)return void 0!==(i=at.get(o,t))||void 0!==(i=ut(o,t))?i:void 0;this.each((function(){at.set(this,t,e)}))}),null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each((function(){at.remove(this,t)}))}}),E.extend({queue:function(t,e,i){var r;if(t)return e=(e||"fx")+"queue",r=st.get(t,e),i&&(!r||Array.isArray(i)?r=st.access(t,e,E.makeArray(i)):r.push(i)),r||[]},dequeue:function(t,e){e=e||"fx";var i=E.queue(t,e),r=i.length,n=i.shift(),o=E._queueHooks(t,e);"inprogress"===n&&(n=i.shift(),r--),n&&("fx"===e&&i.unshift("inprogress"),delete o.stop,n.call(t,(function(){E.dequeue(t,e)}),o)),!r&&o&&o.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return st.get(t,i)||st.access(t,i,{empty:E.Callbacks("once memory").add((function(){st.remove(t,[e+"queue",i])}))})}}),E.fn.extend({queue:function(t,e){var i=2;return"string"!=typeof t&&(e=t,t="fx",i--),arguments.length<i?E.queue(this[0],t):void 0===e?this:this.each((function(){var i=E.queue(this,t,e);E._queueHooks(this,t),"fx"===t&&"inprogress"!==i[0]&&E.dequeue(this,t)}))},dequeue:function(t){return this.each((function(){E.dequeue(this,t)}))},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var i,r=1,n=E.Deferred(),o=this,s=this.length,a=function(){--r||n.resolveWith(o,[o])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";s--;)(i=st.get(o[s],t+"queueHooks"))&&i.empty&&(r++,i.empty.add(a));return a(),n.promise(e)}});var ht=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,dt=new RegExp("^(?:([+-])=|)("+ht+")([a-z%]*)$","i"),pt=["Top","Right","Bottom","Left"],ft=v.documentElement,mt=function(t){return E.contains(t.ownerDocument,t)},gt={composed:!0};ft.getRootNode&&(mt=function(t){return E.contains(t.ownerDocument,t)||t.getRootNode(gt)===t.ownerDocument});var _t=function(t,e){return"none"===(t=e||t).style.display||""===t.style.display&&mt(t)&&"none"===E.css(t,"display")};function yt(t,e,i,r){var n,o,s=20,a=r?function(){return r.cur()}:function(){return E.css(t,e,"")},l=a(),c=i&&i[3]||(E.cssNumber[e]?"":"px"),u=t.nodeType&&(E.cssNumber[e]||"px"!==c&&+l)&&dt.exec(E.css(t,e));if(u&&u[3]!==c){for(l/=2,c=c||u[3],u=+l||1;s--;)E.style(t,e,u+c),(1-o)*(1-(o=a()/l||.5))<=0&&(s=0),u/=o;u*=2,E.style(t,e,u+c),i=i||[]}return i&&(u=+u||+l||0,n=i[1]?u+(i[1]+1)*i[2]:+i[2],r&&(r.unit=c,r.start=u,r.end=n)),n}var vt={};function xt(t){var e,i=t.ownerDocument,r=t.nodeName,n=vt[r];return n||(e=i.body.appendChild(i.createElement(r)),n=E.css(e,"display"),e.parentNode.removeChild(e),"none"===n&&(n="block"),vt[r]=n,n)}function bt(t,e){for(var i,r,n=[],o=0,s=t.length;o<s;o++)(r=t[o]).style&&(i=r.style.display,e?("none"===i&&(n[o]=st.get(r,"display")||null,n[o]||(r.style.display="")),""===r.style.display&&_t(r)&&(n[o]=xt(r))):"none"!==i&&(n[o]="none",st.set(r,"display",i)));for(o=0;o<s;o++)null!=n[o]&&(t[o].style.display=n[o]);return t}E.fn.extend({show:function(){return bt(this,!0)},hide:function(){return bt(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each((function(){_t(this)?E(this).show():E(this).hide()}))}});var wt,Tt,Et=/^(?:checkbox|radio)$/i,St=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,At=/^$|^module$|\/(?:java|ecma)script/i;wt=v.createDocumentFragment().appendChild(v.createElement("div")),(Tt=v.createElement("input")).setAttribute("type","radio"),Tt.setAttribute("checked","checked"),Tt.setAttribute("name","t"),wt.appendChild(Tt),g.checkClone=wt.cloneNode(!0).cloneNode(!0).lastChild.checked,wt.innerHTML="<textarea>x</textarea>",g.noCloneChecked=!!wt.cloneNode(!0).lastChild.defaultValue,wt.innerHTML="<option></option>",g.option=!!wt.lastChild;var Mt={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function It(t,e){var i;return i=void 0!==t.getElementsByTagName?t.getElementsByTagName(e||"*"):void 0!==t.querySelectorAll?t.querySelectorAll(e||"*"):[],void 0===e||e&&A(t,e)?E.merge([t],i):i}function Ct(t,e){for(var i=0,r=t.length;i<r;i++)st.set(t[i],"globalEval",!e||st.get(e[i],"globalEval"))}Mt.tbody=Mt.tfoot=Mt.colgroup=Mt.caption=Mt.thead,Mt.th=Mt.td,g.option||(Mt.optgroup=Mt.option=[1,"<select multiple='multiple'>","</select>"]);var Pt=/<|&#?\w+;/;function Rt(t,e,i,r,n){for(var o,s,a,l,c,u,h=e.createDocumentFragment(),d=[],p=0,f=t.length;p<f;p++)if((o=t[p])||0===o)if("object"===w(o))E.merge(d,o.nodeType?[o]:o);else if(Pt.test(o)){for(s=s||h.appendChild(e.createElement("div")),a=(St.exec(o)||["",""])[1].toLowerCase(),l=Mt[a]||Mt._default,s.innerHTML=l[1]+E.htmlPrefilter(o)+l[2],u=l[0];u--;)s=s.lastChild;E.merge(d,s.childNodes),(s=h.firstChild).textContent=""}else d.push(e.createTextNode(o));for(h.textContent="",p=0;o=d[p++];)if(r&&E.inArray(o,r)>-1)n&&n.push(o);else if(c=mt(o),s=It(h.appendChild(o),"script"),c&&Ct(s),i)for(u=0;o=s[u++];)At.test(o.type||"")&&i.push(o);return h}var Ot=/^([^.]*)(?:\.(.+)|)/;function Dt(){return!0}function Lt(){return!1}function kt(t,e,i,r,n,o){var s,a;if("object"==typeof e){for(a in"string"!=typeof i&&(r=r||i,i=void 0),e)kt(t,a,i,r,e[a],o);return t}if(null==r&&null==n?(n=i,r=i=void 0):null==n&&("string"==typeof i?(n=r,r=void 0):(n=r,r=i,i=void 0)),!1===n)n=Lt;else if(!n)return t;return 1===o&&(s=n,(n=function(t){return E().off(t),s.apply(this,arguments)}).guid=s.guid||(s.guid=E.guid++)),t.each((function(){E.event.add(this,e,n,r,i)}))}function Bt(t,e,i){i?(st.set(t,e,!1),E.event.add(t,e,{namespace:!1,handler:function(t){var i,r=st.get(this,e);if(1&t.isTrigger&&this[e]){if(r)(E.event.special[e]||{}).delegateType&&t.stopPropagation();else if(r=a.call(arguments),st.set(this,e,r),this[e](),i=st.get(this,e),st.set(this,e,!1),r!==i)return t.stopImmediatePropagation(),t.preventDefault(),i}else r&&(st.set(this,e,E.event.trigger(r[0],r.slice(1),this)),t.stopPropagation(),t.isImmediatePropagationStopped=Dt)}})):void 0===st.get(t,e)&&E.event.add(t,e,Dt)}E.event={global:{},add:function(t,e,i,r,n){var o,s,a,l,c,u,h,d,p,f,m,g=st.get(t);if(nt(t))for(i.handler&&(i=(o=i).handler,n=o.selector),n&&E.find.matchesSelector(ft,n),i.guid||(i.guid=E.guid++),(l=g.events)||(l=g.events=Object.create(null)),(s=g.handle)||(s=g.handle=function(e){return void 0!==E&&E.event.triggered!==e.type?E.event.dispatch.apply(t,arguments):void 0}),c=(e=(e||"").match(q)||[""]).length;c--;)p=m=(a=Ot.exec(e[c])||[])[1],f=(a[2]||"").split(".").sort(),p&&(h=E.event.special[p]||{},p=(n?h.delegateType:h.bindType)||p,h=E.event.special[p]||{},u=E.extend({type:p,origType:m,data:r,handler:i,guid:i.guid,selector:n,needsContext:n&&E.expr.match.needsContext.test(n),namespace:f.join(".")},o),(d=l[p])||((d=l[p]=[]).delegateCount=0,h.setup&&!1!==h.setup.call(t,r,f,s)||t.addEventListener&&t.addEventListener(p,s)),h.add&&(h.add.call(t,u),u.handler.guid||(u.handler.guid=i.guid)),n?d.splice(d.delegateCount++,0,u):d.push(u),E.event.global[p]=!0)},remove:function(t,e,i,r,n){var o,s,a,l,c,u,h,d,p,f,m,g=st.hasData(t)&&st.get(t);if(g&&(l=g.events)){for(c=(e=(e||"").match(q)||[""]).length;c--;)if(p=m=(a=Ot.exec(e[c])||[])[1],f=(a[2]||"").split(".").sort(),p){for(h=E.event.special[p]||{},d=l[p=(r?h.delegateType:h.bindType)||p]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=o=d.length;o--;)u=d[o],!n&&m!==u.origType||i&&i.guid!==u.guid||a&&!a.test(u.namespace)||r&&r!==u.selector&&("**"!==r||!u.selector)||(d.splice(o,1),u.selector&&d.delegateCount--,h.remove&&h.remove.call(t,u));s&&!d.length&&(h.teardown&&!1!==h.teardown.call(t,f,g.handle)||E.removeEvent(t,p,g.handle),delete l[p])}else for(p in l)E.event.remove(t,p+e[c],i,r,!0);E.isEmptyObject(l)&&st.remove(t,"handle events")}},dispatch:function(t){var e,i,r,n,o,s,a=new Array(arguments.length),l=E.event.fix(t),c=(st.get(this,"events")||Object.create(null))[l.type]||[],u=E.event.special[l.type]||{};for(a[0]=l,e=1;e<arguments.length;e++)a[e]=arguments[e];if(l.delegateTarget=this,!u.preDispatch||!1!==u.preDispatch.call(this,l)){for(s=E.event.handlers.call(this,l,c),e=0;(n=s[e++])&&!l.isPropagationStopped();)for(l.currentTarget=n.elem,i=0;(o=n.handlers[i++])&&!l.isImmediatePropagationStopped();)l.rnamespace&&!1!==o.namespace&&!l.rnamespace.test(o.namespace)||(l.handleObj=o,l.data=o.data,void 0!==(r=((E.event.special[o.origType]||{}).handle||o.handler).apply(n.elem,a))&&!1===(l.result=r)&&(l.preventDefault(),l.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,l),l.result}},handlers:function(t,e){var i,r,n,o,s,a=[],l=e.delegateCount,c=t.target;if(l&&c.nodeType&&!("click"===t.type&&t.button>=1))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==t.type||!0!==c.disabled)){for(o=[],s={},i=0;i<l;i++)void 0===s[n=(r=e[i]).selector+" "]&&(s[n]=r.needsContext?E(n,this).index(c)>-1:E.find(n,this,null,[c]).length),s[n]&&o.push(r);o.length&&a.push({elem:c,handlers:o})}return c=this,l<e.length&&a.push({elem:c,handlers:e.slice(l)}),a},addProp:function(t,e){Object.defineProperty(E.Event.prototype,t,{enumerable:!0,configurable:!0,get:_(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(t){return t[E.expando]?t:new E.Event(t)},special:{load:{noBubble:!0},click:{setup:function(t){var e=this||t;return Et.test(e.type)&&e.click&&A(e,"input")&&Bt(e,"click",!0),!1},trigger:function(t){var e=this||t;return Et.test(e.type)&&e.click&&A(e,"input")&&Bt(e,"click"),!0},_default:function(t){var e=t.target;return Et.test(e.type)&&e.click&&A(e,"input")&&st.get(e,"click")||A(e,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},E.removeEvent=function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i)},E.Event=function(t,e){if(!(this instanceof E.Event))return new E.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&!1===t.returnValue?Dt:Lt,this.target=t.target&&3===t.target.nodeType?t.target.parentNode:t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,e&&E.extend(this,e),this.timeStamp=t&&t.timeStamp||Date.now(),this[E.expando]=!0},E.Event.prototype={constructor:E.Event,isDefaultPrevented:Lt,isPropagationStopped:Lt,isImmediatePropagationStopped:Lt,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=Dt,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=Dt,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=Dt,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},E.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},E.event.addProp),E.each({focus:"focusin",blur:"focusout"},(function(t,e){function i(t){if(v.documentMode){var i=st.get(this,"handle"),r=E.event.fix(t);r.type="focusin"===t.type?"focus":"blur",r.isSimulated=!0,i(t),r.target===r.currentTarget&&i(r)}else E.event.simulate(e,t.target,E.event.fix(t))}E.event.special[t]={setup:function(){var r;if(Bt(this,t,!0),!v.documentMode)return!1;(r=st.get(this,e))||this.addEventListener(e,i),st.set(this,e,(r||0)+1)},trigger:function(){return Bt(this,t),!0},teardown:function(){var t;if(!v.documentMode)return!1;(t=st.get(this,e)-1)?st.set(this,e,t):(this.removeEventListener(e,i),st.remove(this,e))},_default:function(e){return st.get(e.target,t)},delegateType:e},E.event.special[e]={setup:function(){var r=this.ownerDocument||this.document||this,n=v.documentMode?this:r,o=st.get(n,e);o||(v.documentMode?this.addEventListener(e,i):r.addEventListener(t,i,!0)),st.set(n,e,(o||0)+1)},teardown:function(){var r=this.ownerDocument||this.document||this,n=v.documentMode?this:r,o=st.get(n,e)-1;o?st.set(n,e,o):(v.documentMode?this.removeEventListener(e,i):r.removeEventListener(t,i,!0),st.remove(n,e))}}})),E.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(t,e){E.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,r=this,n=t.relatedTarget,o=t.handleObj;return n&&(n===r||E.contains(r,n))||(t.type=o.origType,i=o.handler.apply(this,arguments),t.type=e),i}}})),E.fn.extend({on:function(t,e,i,r){return kt(this,t,e,i,r)},one:function(t,e,i,r){return kt(this,t,e,i,r,1)},off:function(t,e,i){var r,n;if(t&&t.preventDefault&&t.handleObj)return r=t.handleObj,E(t.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof t){for(n in t)this.off(n,e,t[n]);return this}return!1!==e&&"function"!=typeof e||(i=e,e=void 0),!1===i&&(i=Lt),this.each((function(){E.event.remove(this,t,i,e)}))}});var Ft=/<script|<style|<link/i,zt=/checked\s*(?:[^=]|=\s*.checked.)/i,Nt=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Ut(t,e){return A(t,"table")&&A(11!==e.nodeType?e:e.firstChild,"tr")&&E(t).children("tbody")[0]||t}function Gt(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function jt(t){return"true/"===(t.type||"").slice(0,5)?t.type=t.type.slice(5):t.removeAttribute("type"),t}function Vt(t,e){var i,r,n,o,s,a;if(1===e.nodeType){if(st.hasData(t)&&(a=st.get(t).events))for(n in st.remove(e,"handle events"),a)for(i=0,r=a[n].length;i<r;i++)E.event.add(e,n,a[n][i]);at.hasData(t)&&(o=at.access(t),s=E.extend({},o),at.set(e,s))}}function Xt(t,e){var i=e.nodeName.toLowerCase();"input"===i&&Et.test(t.type)?e.checked=t.checked:"input"!==i&&"textarea"!==i||(e.defaultValue=t.defaultValue)}function Ht(t,e,i,r){e=l(e);var n,o,s,a,c,u,h=0,d=t.length,p=d-1,f=e[0],m=_(f);if(m||d>1&&"string"==typeof f&&!g.checkClone&&zt.test(f))return t.each((function(n){var o=t.eq(n);m&&(e[0]=f.call(this,n,o.html())),Ht(o,e,i,r)}));if(d&&(o=(n=Rt(e,t[0].ownerDocument,!1,t,r)).firstChild,1===n.childNodes.length&&(n=o),o||r)){for(a=(s=E.map(It(n,"script"),Gt)).length;h<d;h++)c=n,h!==p&&(c=E.clone(c,!0,!0),a&&E.merge(s,It(c,"script"))),i.call(t[h],c,h);if(a)for(u=s[s.length-1].ownerDocument,E.map(s,jt),h=0;h<a;h++)c=s[h],At.test(c.type||"")&&!st.access(c,"globalEval")&&E.contains(u,c)&&(c.src&&"module"!==(c.type||"").toLowerCase()?E._evalUrl&&!c.noModule&&E._evalUrl(c.src,{nonce:c.nonce||c.getAttribute("nonce")},u):b(c.textContent.replace(Nt,""),c,u))}return t}function qt(t,e,i){for(var r,n=e?E.filter(e,t):t,o=0;null!=(r=n[o]);o++)i||1!==r.nodeType||E.cleanData(It(r)),r.parentNode&&(i&&mt(r)&&Ct(It(r,"script")),r.parentNode.removeChild(r));return t}E.extend({htmlPrefilter:function(t){return t},clone:function(t,e,i){var r,n,o,s,a=t.cloneNode(!0),l=mt(t);if(!(g.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||E.isXMLDoc(t)))for(s=It(a),r=0,n=(o=It(t)).length;r<n;r++)Xt(o[r],s[r]);if(e)if(i)for(o=o||It(t),s=s||It(a),r=0,n=o.length;r<n;r++)Vt(o[r],s[r]);else Vt(t,a);return(s=It(a,"script")).length>0&&Ct(s,!l&&It(t,"script")),a},cleanData:function(t){for(var e,i,r,n=E.event.special,o=0;void 0!==(i=t[o]);o++)if(nt(i)){if(e=i[st.expando]){if(e.events)for(r in e.events)n[r]?E.event.remove(i,r):E.removeEvent(i,r,e.handle);i[st.expando]=void 0}i[at.expando]&&(i[at.expando]=void 0)}}}),E.fn.extend({detach:function(t){return qt(this,t,!0)},remove:function(t){return qt(this,t)},text:function(t){return Q(this,(function(t){return void 0===t?E.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)}))}),null,t,arguments.length)},append:function(){return Ht(this,arguments,(function(t){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Ut(this,t).appendChild(t)}))},prepend:function(){return Ht(this,arguments,(function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=Ut(this,t);e.insertBefore(t,e.firstChild)}}))},before:function(){return Ht(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this)}))},after:function(){return Ht(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)}))},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(E.cleanData(It(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map((function(){return E.clone(this,t,e)}))},html:function(t){return Q(this,(function(t){var e=this[0]||{},i=0,r=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!Ft.test(t)&&!Mt[(St.exec(t)||["",""])[1].toLowerCase()]){t=E.htmlPrefilter(t);try{for(;i<r;i++)1===(e=this[i]||{}).nodeType&&(E.cleanData(It(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)}),null,t,arguments.length)},replaceWith:function(){var t=[];return Ht(this,arguments,(function(e){var i=this.parentNode;E.inArray(this,t)<0&&(E.cleanData(It(this)),i&&i.replaceChild(e,this))}),t)}}),E.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(t,e){E.fn[t]=function(t){for(var i,r=[],n=E(t),o=n.length-1,s=0;s<=o;s++)i=s===o?this:this.clone(!0),E(n[s])[e](i),c.apply(r,i.get());return this.pushStack(r)}}));var Wt=new RegExp("^("+ht+")(?!px)[a-z%]+$","i"),$t=/^--/,Yt=function(t){var e=t.ownerDocument.defaultView;return e&&e.opener||(e=i),e.getComputedStyle(t)},Zt=function(t,e,i){var r,n,o={};for(n in e)o[n]=t.style[n],t.style[n]=e[n];for(n in r=i.call(t),e)t.style[n]=o[n];return r},Kt=new RegExp(pt.join("|"),"i");function Jt(t,e,i){var r,n,o,s,a=$t.test(e),l=t.style;return(i=i||Yt(t))&&(s=i.getPropertyValue(e)||i[e],a&&s&&(s=s.replace(R,"$1")||void 0),""!==s||mt(t)||(s=E.style(t,e)),!g.pixelBoxStyles()&&Wt.test(s)&&Kt.test(e)&&(r=l.width,n=l.minWidth,o=l.maxWidth,l.minWidth=l.maxWidth=l.width=s,s=i.width,l.width=r,l.minWidth=n,l.maxWidth=o)),void 0!==s?s+"":s}function Qt(t,e){return{get:function(){if(!t())return(this.get=e).apply(this,arguments);delete this.get}}}!function(){function t(){if(u){c.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",u.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",ft.appendChild(c).appendChild(u);var t=i.getComputedStyle(u);r="1%"!==t.top,l=12===e(t.marginLeft),u.style.right="60%",s=36===e(t.right),n=36===e(t.width),u.style.position="absolute",o=12===e(u.offsetWidth/3),ft.removeChild(c),u=null}}function e(t){return Math.round(parseFloat(t))}var r,n,o,s,a,l,c=v.createElement("div"),u=v.createElement("div");u.style&&(u.style.backgroundClip="content-box",u.cloneNode(!0).style.backgroundClip="",g.clearCloneStyle="content-box"===u.style.backgroundClip,E.extend(g,{boxSizingReliable:function(){return t(),n},pixelBoxStyles:function(){return t(),s},pixelPosition:function(){return t(),r},reliableMarginLeft:function(){return t(),l},scrollboxSize:function(){return t(),o},reliableTrDimensions:function(){var t,e,r,n;return null==a&&(t=v.createElement("table"),e=v.createElement("tr"),r=v.createElement("div"),t.style.cssText="position:absolute;left:-11111px;border-collapse:separate",e.style.cssText="box-sizing:content-box;border:1px solid",e.style.height="1px",r.style.height="9px",r.style.display="block",ft.appendChild(t).appendChild(e).appendChild(r),n=i.getComputedStyle(e),a=parseInt(n.height,10)+parseInt(n.borderTopWidth,10)+parseInt(n.borderBottomWidth,10)===e.offsetHeight,ft.removeChild(t)),a}}))}();var te=["Webkit","Moz","ms"],ee=v.createElement("div").style,ie={};function re(t){var e=E.cssProps[t]||ie[t];return e||(t in ee?t:ie[t]=function(t){for(var e=t[0].toUpperCase()+t.slice(1),i=te.length;i--;)if((t=te[i]+e)in ee)return t}(t)||t)}var ne=/^(none|table(?!-c[ea]).+)/,oe={position:"absolute",visibility:"hidden",display:"block"},se={letterSpacing:"0",fontWeight:"400"};function ae(t,e,i){var r=dt.exec(e);return r?Math.max(0,r[2]-(i||0))+(r[3]||"px"):e}function le(t,e,i,r,n,o){var s="width"===e?1:0,a=0,l=0,c=0;if(i===(r?"border":"content"))return 0;for(;s<4;s+=2)"margin"===i&&(c+=E.css(t,i+pt[s],!0,n)),r?("content"===i&&(l-=E.css(t,"padding"+pt[s],!0,n)),"margin"!==i&&(l-=E.css(t,"border"+pt[s]+"Width",!0,n))):(l+=E.css(t,"padding"+pt[s],!0,n),"padding"!==i?l+=E.css(t,"border"+pt[s]+"Width",!0,n):a+=E.css(t,"border"+pt[s]+"Width",!0,n));return!r&&o>=0&&(l+=Math.max(0,Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-o-l-a-.5))||0),l+c}function ce(t,e,i){var r=Yt(t),n=(!g.boxSizingReliable()||i)&&"border-box"===E.css(t,"boxSizing",!1,r),o=n,s=Jt(t,e,r),a="offset"+e[0].toUpperCase()+e.slice(1);if(Wt.test(s)){if(!i)return s;s="auto"}return(!g.boxSizingReliable()&&n||!g.reliableTrDimensions()&&A(t,"tr")||"auto"===s||!parseFloat(s)&&"inline"===E.css(t,"display",!1,r))&&t.getClientRects().length&&(n="border-box"===E.css(t,"boxSizing",!1,r),(o=a in t)&&(s=t[a])),(s=parseFloat(s)||0)+le(t,e,i||(n?"border":"content"),o,r,s)+"px"}function ue(t,e,i,r,n){return new ue.prototype.init(t,e,i,r,n)}E.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=Jt(t,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(t,e,i,r){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var n,o,s,a=rt(e),l=$t.test(e),c=t.style;if(l||(e=re(a)),s=E.cssHooks[e]||E.cssHooks[a],void 0===i)return s&&"get"in s&&void 0!==(n=s.get(t,!1,r))?n:c[e];"string"===(o=typeof i)&&(n=dt.exec(i))&&n[1]&&(i=yt(t,e,n),o="number"),null!=i&&i==i&&("number"!==o||l||(i+=n&&n[3]||(E.cssNumber[a]?"":"px")),g.clearCloneStyle||""!==i||0!==e.indexOf("background")||(c[e]="inherit"),s&&"set"in s&&void 0===(i=s.set(t,i,r))||(l?c.setProperty(e,i):c[e]=i))}},css:function(t,e,i,r){var n,o,s,a=rt(e);return $t.test(e)||(e=re(a)),(s=E.cssHooks[e]||E.cssHooks[a])&&"get"in s&&(n=s.get(t,!0,i)),void 0===n&&(n=Jt(t,e,r)),"normal"===n&&e in se&&(n=se[e]),""===i||i?(o=parseFloat(n),!0===i||isFinite(o)?o||0:n):n}}),E.each(["height","width"],(function(t,e){E.cssHooks[e]={get:function(t,i,r){if(i)return!ne.test(E.css(t,"display"))||t.getClientRects().length&&t.getBoundingClientRect().width?ce(t,e,r):Zt(t,oe,(function(){return ce(t,e,r)}))},set:function(t,i,r){var n,o=Yt(t),s=!g.scrollboxSize()&&"absolute"===o.position,a=(s||r)&&"border-box"===E.css(t,"boxSizing",!1,o),l=r?le(t,e,r,a,o):0;return a&&s&&(l-=Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-parseFloat(o[e])-le(t,e,"border",!1,o)-.5)),l&&(n=dt.exec(i))&&"px"!==(n[3]||"px")&&(t.style[e]=i,i=E.css(t,e)),ae(0,i,l)}}})),E.cssHooks.marginLeft=Qt(g.reliableMarginLeft,(function(t,e){if(e)return(parseFloat(Jt(t,"marginLeft"))||t.getBoundingClientRect().left-Zt(t,{marginLeft:0},(function(){return t.getBoundingClientRect().left})))+"px"})),E.each({margin:"",padding:"",border:"Width"},(function(t,e){E.cssHooks[t+e]={expand:function(i){for(var r=0,n={},o="string"==typeof i?i.split(" "):[i];r<4;r++)n[t+pt[r]+e]=o[r]||o[r-2]||o[0];return n}},"margin"!==t&&(E.cssHooks[t+e].set=ae)})),E.fn.extend({css:function(t,e){return Q(this,(function(t,e,i){var r,n,o={},s=0;if(Array.isArray(e)){for(r=Yt(t),n=e.length;s<n;s++)o[e[s]]=E.css(t,e[s],!1,r);return o}return void 0!==i?E.style(t,e,i):E.css(t,e)}),t,e,arguments.length>1)}}),E.Tween=ue,ue.prototype={constructor:ue,init:function(t,e,i,r,n,o){this.elem=t,this.prop=i,this.easing=n||E.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=r,this.unit=o||(E.cssNumber[i]?"":"px")},cur:function(){var t=ue.propHooks[this.prop];return t&&t.get?t.get(this):ue.propHooks._default.get(this)},run:function(t){var e,i=ue.propHooks[this.prop];return this.options.duration?this.pos=e=E.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):ue.propHooks._default.set(this),this}},ue.prototype.init.prototype=ue.prototype,ue.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=E.css(t.elem,t.prop,""))&&"auto"!==e?e:0},set:function(t){E.fx.step[t.prop]?E.fx.step[t.prop](t):1!==t.elem.nodeType||!E.cssHooks[t.prop]&&null==t.elem.style[re(t.prop)]?t.elem[t.prop]=t.now:E.style(t.elem,t.prop,t.now+t.unit)}}},ue.propHooks.scrollTop=ue.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},E.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},E.fx=ue.prototype.init,E.fx.step={};var he,de,pe=/^(?:toggle|show|hide)$/,fe=/queueHooks$/;function me(){de&&(!1===v.hidden&&i.requestAnimationFrame?i.requestAnimationFrame(me):i.setTimeout(me,E.fx.interval),E.fx.tick())}function ge(){return i.setTimeout((function(){he=void 0})),he=Date.now()}function _e(t,e){var i,r=0,n={height:t};for(e=e?1:0;r<4;r+=2-e)n["margin"+(i=pt[r])]=n["padding"+i]=t;return e&&(n.opacity=n.width=t),n}function ye(t,e,i){for(var r,n=(ve.tweeners[e]||[]).concat(ve.tweeners["*"]),o=0,s=n.length;o<s;o++)if(r=n[o].call(i,e,t))return r}function ve(t,e,i){var r,n,o=0,s=ve.prefilters.length,a=E.Deferred().always((function(){delete l.elem})),l=function(){if(n)return!1;for(var e=he||ge(),i=Math.max(0,c.startTime+c.duration-e),r=1-(i/c.duration||0),o=0,s=c.tweens.length;o<s;o++)c.tweens[o].run(r);return a.notifyWith(t,[c,r,i]),r<1&&s?i:(s||a.notifyWith(t,[c,1,0]),a.resolveWith(t,[c]),!1)},c=a.promise({elem:t,props:E.extend({},e),opts:E.extend(!0,{specialEasing:{},easing:E.easing._default},i),originalProperties:e,originalOptions:i,startTime:he||ge(),duration:i.duration,tweens:[],createTween:function(e,i){var r=E.Tween(t,c.opts,e,i,c.opts.specialEasing[e]||c.opts.easing);return c.tweens.push(r),r},stop:function(e){var i=0,r=e?c.tweens.length:0;if(n)return this;for(n=!0;i<r;i++)c.tweens[i].run(1);return e?(a.notifyWith(t,[c,1,0]),a.resolveWith(t,[c,e])):a.rejectWith(t,[c,e]),this}}),u=c.props;for(!function(t,e){var i,r,n,o,s;for(i in t)if(n=e[r=rt(i)],o=t[i],Array.isArray(o)&&(n=o[1],o=t[i]=o[0]),i!==r&&(t[r]=o,delete t[i]),(s=E.cssHooks[r])&&"expand"in s)for(i in o=s.expand(o),delete t[r],o)i in t||(t[i]=o[i],e[i]=n);else e[r]=n}(u,c.opts.specialEasing);o<s;o++)if(r=ve.prefilters[o].call(c,t,u,c.opts))return _(r.stop)&&(E._queueHooks(c.elem,c.opts.queue).stop=r.stop.bind(r)),r;return E.map(u,ye,c),_(c.opts.start)&&c.opts.start.call(t,c),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always),E.fx.timer(E.extend(l,{elem:t,anim:c,queue:c.opts.queue})),c}E.Animation=E.extend(ve,{tweeners:{"*":[function(t,e){var i=this.createTween(t,e);return yt(i.elem,t,dt.exec(e),i),i}]},tweener:function(t,e){_(t)?(e=t,t=["*"]):t=t.match(q);for(var i,r=0,n=t.length;r<n;r++)i=t[r],ve.tweeners[i]=ve.tweeners[i]||[],ve.tweeners[i].unshift(e)},prefilters:[function(t,e,i){var r,n,o,s,a,l,c,u,h="width"in e||"height"in e,d=this,p={},f=t.style,m=t.nodeType&&_t(t),g=st.get(t,"fxshow");for(r in i.queue||(null==(s=E._queueHooks(t,"fx")).unqueued&&(s.unqueued=0,a=s.empty.fire,s.empty.fire=function(){s.unqueued||a()}),s.unqueued++,d.always((function(){d.always((function(){s.unqueued--,E.queue(t,"fx").length||s.empty.fire()}))}))),e)if(n=e[r],pe.test(n)){if(delete e[r],o=o||"toggle"===n,n===(m?"hide":"show")){if("show"!==n||!g||void 0===g[r])continue;m=!0}p[r]=g&&g[r]||E.style(t,r)}if((l=!E.isEmptyObject(e))||!E.isEmptyObject(p))for(r in h&&1===t.nodeType&&(i.overflow=[f.overflow,f.overflowX,f.overflowY],null==(c=g&&g.display)&&(c=st.get(t,"display")),"none"===(u=E.css(t,"display"))&&(c?u=c:(bt([t],!0),c=t.style.display||c,u=E.css(t,"display"),bt([t]))),("inline"===u||"inline-block"===u&&null!=c)&&"none"===E.css(t,"float")&&(l||(d.done((function(){f.display=c})),null==c&&(u=f.display,c="none"===u?"":u)),f.display="inline-block")),i.overflow&&(f.overflow="hidden",d.always((function(){f.overflow=i.overflow[0],f.overflowX=i.overflow[1],f.overflowY=i.overflow[2]}))),l=!1,p)l||(g?"hidden"in g&&(m=g.hidden):g=st.access(t,"fxshow",{display:c}),o&&(g.hidden=!m),m&&bt([t],!0),d.done((function(){for(r in m||bt([t]),st.remove(t,"fxshow"),p)E.style(t,r,p[r])}))),l=ye(m?g[r]:0,r,d),r in g||(g[r]=l.start,m&&(l.end=l.start,l.start=0))}],prefilter:function(t,e){e?ve.prefilters.unshift(t):ve.prefilters.push(t)}}),E.speed=function(t,e,i){var r=t&&"object"==typeof t?E.extend({},t):{complete:i||!i&&e||_(t)&&t,duration:t,easing:i&&e||e&&!_(e)&&e};return E.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in E.fx.speeds?r.duration=E.fx.speeds[r.duration]:r.duration=E.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){_(r.old)&&r.old.call(this),r.queue&&E.dequeue(this,r.queue)},r},E.fn.extend({fadeTo:function(t,e,i,r){return this.filter(_t).css("opacity",0).show().end().animate({opacity:e},t,i,r)},animate:function(t,e,i,r){var n=E.isEmptyObject(t),o=E.speed(e,i,r),s=function(){var e=ve(this,E.extend({},t),o);(n||st.get(this,"finish"))&&e.stop(!0)};return s.finish=s,n||!1===o.queue?this.each(s):this.queue(o.queue,s)},stop:function(t,e,i){var r=function(t){var e=t.stop;delete t.stop,e(i)};return"string"!=typeof t&&(i=e,e=t,t=void 0),e&&this.queue(t||"fx",[]),this.each((function(){var e=!0,n=null!=t&&t+"queueHooks",o=E.timers,s=st.get(this);if(n)s[n]&&s[n].stop&&r(s[n]);else for(n in s)s[n]&&s[n].stop&&fe.test(n)&&r(s[n]);for(n=o.length;n--;)o[n].elem!==this||null!=t&&o[n].queue!==t||(o[n].anim.stop(i),e=!1,o.splice(n,1));!e&&i||E.dequeue(this,t)}))},finish:function(t){return!1!==t&&(t=t||"fx"),this.each((function(){var e,i=st.get(this),r=i[t+"queue"],n=i[t+"queueHooks"],o=E.timers,s=r?r.length:0;for(i.finish=!0,E.queue(this,t,[]),n&&n.stop&&n.stop.call(this,!0),e=o.length;e--;)o[e].elem===this&&o[e].queue===t&&(o[e].anim.stop(!0),o.splice(e,1));for(e=0;e<s;e++)r[e]&&r[e].finish&&r[e].finish.call(this);delete i.finish}))}}),E.each(["toggle","show","hide"],(function(t,e){var i=E.fn[e];E.fn[e]=function(t,r,n){return null==t||"boolean"==typeof t?i.apply(this,arguments):this.animate(_e(e,!0),t,r,n)}})),E.each({slideDown:_e("show"),slideUp:_e("hide"),slideToggle:_e("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(t,e){E.fn[t]=function(t,i,r){return this.animate(e,t,i,r)}})),E.timers=[],E.fx.tick=function(){var t,e=0,i=E.timers;for(he=Date.now();e<i.length;e++)(t=i[e])()||i[e]!==t||i.splice(e--,1);i.length||E.fx.stop(),he=void 0},E.fx.timer=function(t){E.timers.push(t),E.fx.start()},E.fx.interval=13,E.fx.start=function(){de||(de=!0,me())},E.fx.stop=function(){de=null},E.fx.speeds={slow:600,fast:200,_default:400},E.fn.delay=function(t,e){return t=E.fx&&E.fx.speeds[t]||t,e=e||"fx",this.queue(e,(function(e,r){var n=i.setTimeout(e,t);r.stop=function(){i.clearTimeout(n)}}))},function(){var t=v.createElement("input"),e=v.createElement("select").appendChild(v.createElement("option"));t.type="checkbox",g.checkOn=""!==t.value,g.optSelected=e.selected,(t=v.createElement("input")).value="t",t.type="radio",g.radioValue="t"===t.value}();var xe,be=E.expr.attrHandle;E.fn.extend({attr:function(t,e){return Q(this,E.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each((function(){E.removeAttr(this,t)}))}}),E.extend({attr:function(t,e,i){var r,n,o=t.nodeType;if(3!==o&&8!==o&&2!==o)return void 0===t.getAttribute?E.prop(t,e,i):(1===o&&E.isXMLDoc(t)||(n=E.attrHooks[e.toLowerCase()]||(E.expr.match.bool.test(e)?xe:void 0)),void 0!==i?null===i?void E.removeAttr(t,e):n&&"set"in n&&void 0!==(r=n.set(t,i,e))?r:(t.setAttribute(e,i+""),i):n&&"get"in n&&null!==(r=n.get(t,e))?r:null==(r=E.find.attr(t,e))?void 0:r)},attrHooks:{type:{set:function(t,e){if(!g.radioValue&&"radio"===e&&A(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}},removeAttr:function(t,e){var i,r=0,n=e&&e.match(q);if(n&&1===t.nodeType)for(;i=n[r++];)t.removeAttribute(i)}}),xe={set:function(t,e,i){return!1===e?E.removeAttr(t,i):t.setAttribute(i,i),i}},E.each(E.expr.match.bool.source.match(/\w+/g),(function(t,e){var i=be[e]||E.find.attr;be[e]=function(t,e,r){var n,o,s=e.toLowerCase();return r||(o=be[s],be[s]=n,n=null!=i(t,e,r)?s:null,be[s]=o),n}}));var we=/^(?:input|select|textarea|button)$/i,Te=/^(?:a|area)$/i;function Ee(t){return(t.match(q)||[]).join(" ")}function Se(t){return t.getAttribute&&t.getAttribute("class")||""}function Ae(t){return Array.isArray(t)?t:"string"==typeof t&&t.match(q)||[]}E.fn.extend({prop:function(t,e){return Q(this,E.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each((function(){delete this[E.propFix[t]||t]}))}}),E.extend({prop:function(t,e,i){var r,n,o=t.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&E.isXMLDoc(t)||(e=E.propFix[e]||e,n=E.propHooks[e]),void 0!==i?n&&"set"in n&&void 0!==(r=n.set(t,i,e))?r:t[e]=i:n&&"get"in n&&null!==(r=n.get(t,e))?r:t[e]},propHooks:{tabIndex:{get:function(t){var e=E.find.attr(t,"tabindex");return e?parseInt(e,10):we.test(t.nodeName)||Te.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),g.optSelected||(E.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),E.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){E.propFix[this.toLowerCase()]=this})),E.fn.extend({addClass:function(t){var e,i,r,n,o,s;return _(t)?this.each((function(e){E(this).addClass(t.call(this,e,Se(this)))})):(e=Ae(t)).length?this.each((function(){if(r=Se(this),i=1===this.nodeType&&" "+Ee(r)+" "){for(o=0;o<e.length;o++)n=e[o],i.indexOf(" "+n+" ")<0&&(i+=n+" ");s=Ee(i),r!==s&&this.setAttribute("class",s)}})):this},removeClass:function(t){var e,i,r,n,o,s;return _(t)?this.each((function(e){E(this).removeClass(t.call(this,e,Se(this)))})):arguments.length?(e=Ae(t)).length?this.each((function(){if(r=Se(this),i=1===this.nodeType&&" "+Ee(r)+" "){for(o=0;o<e.length;o++)for(n=e[o];i.indexOf(" "+n+" ")>-1;)i=i.replace(" "+n+" "," ");s=Ee(i),r!==s&&this.setAttribute("class",s)}})):this:this.attr("class","")},toggleClass:function(t,e){var i,r,n,o,s=typeof t,a="string"===s||Array.isArray(t);return _(t)?this.each((function(i){E(this).toggleClass(t.call(this,i,Se(this),e),e)})):"boolean"==typeof e&&a?e?this.addClass(t):this.removeClass(t):(i=Ae(t),this.each((function(){if(a)for(o=E(this),n=0;n<i.length;n++)r=i[n],o.hasClass(r)?o.removeClass(r):o.addClass(r);else void 0!==t&&"boolean"!==s||((r=Se(this))&&st.set(this,"__className__",r),this.setAttribute&&this.setAttribute("class",r||!1===t?"":st.get(this,"__className__")||""))})))},hasClass:function(t){var e,i,r=0;for(e=" "+t+" ";i=this[r++];)if(1===i.nodeType&&(" "+Ee(Se(i))+" ").indexOf(e)>-1)return!0;return!1}});var Me=/\r/g;E.fn.extend({val:function(t){var e,i,r,n=this[0];return arguments.length?(r=_(t),this.each((function(i){var n;1===this.nodeType&&(null==(n=r?t.call(this,i,E(this).val()):t)?n="":"number"==typeof n?n+="":Array.isArray(n)&&(n=E.map(n,(function(t){return null==t?"":t+""}))),(e=E.valHooks[this.type]||E.valHooks[this.nodeName.toLowerCase()])&&"set"in e&&void 0!==e.set(this,n,"value")||(this.value=n))}))):n?(e=E.valHooks[n.type]||E.valHooks[n.nodeName.toLowerCase()])&&"get"in e&&void 0!==(i=e.get(n,"value"))?i:"string"==typeof(i=n.value)?i.replace(Me,""):null==i?"":i:void 0}}),E.extend({valHooks:{option:{get:function(t){var e=E.find.attr(t,"value");return null!=e?e:Ee(E.text(t))}},select:{get:function(t){var e,i,r,n=t.options,o=t.selectedIndex,s="select-one"===t.type,a=s?null:[],l=s?o+1:n.length;for(r=o<0?l:s?o:0;r<l;r++)if(((i=n[r]).selected||r===o)&&!i.disabled&&(!i.parentNode.disabled||!A(i.parentNode,"optgroup"))){if(e=E(i).val(),s)return e;a.push(e)}return a},set:function(t,e){for(var i,r,n=t.options,o=E.makeArray(e),s=n.length;s--;)((r=n[s]).selected=E.inArray(E.valHooks.option.get(r),o)>-1)&&(i=!0);return i||(t.selectedIndex=-1),o}}}}),E.each(["radio","checkbox"],(function(){E.valHooks[this]={set:function(t,e){if(Array.isArray(e))return t.checked=E.inArray(E(t).val(),e)>-1}},g.checkOn||(E.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})}));var Ie=i.location,Ce={guid:Date.now()},Pe=/\?/;E.parseXML=function(t){var e,r;if(!t||"string"!=typeof t)return null;try{e=(new i.DOMParser).parseFromString(t,"text/xml")}catch(t){}return r=e&&e.getElementsByTagName("parsererror")[0],e&&!r||E.error("Invalid XML: "+(r?E.map(r.childNodes,(function(t){return t.textContent})).join("\n"):t)),e};var Re=/^(?:focusinfocus|focusoutblur)$/,Oe=function(t){t.stopPropagation()};E.extend(E.event,{trigger:function(t,e,r,n){var o,s,a,l,c,u,h,d,f=[r||v],m=p.call(t,"type")?t.type:t,g=p.call(t,"namespace")?t.namespace.split("."):[];if(s=d=a=r=r||v,3!==r.nodeType&&8!==r.nodeType&&!Re.test(m+E.event.triggered)&&(m.indexOf(".")>-1&&(g=m.split("."),m=g.shift(),g.sort()),c=m.indexOf(":")<0&&"on"+m,(t=t[E.expando]?t:new E.Event(m,"object"==typeof t&&t)).isTrigger=n?2:3,t.namespace=g.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=r),e=null==e?[t]:E.makeArray(e,[t]),h=E.event.special[m]||{},n||!h.trigger||!1!==h.trigger.apply(r,e))){if(!n&&!h.noBubble&&!y(r)){for(l=h.delegateType||m,Re.test(l+m)||(s=s.parentNode);s;s=s.parentNode)f.push(s),a=s;a===(r.ownerDocument||v)&&f.push(a.defaultView||a.parentWindow||i)}for(o=0;(s=f[o++])&&!t.isPropagationStopped();)d=s,t.type=o>1?l:h.bindType||m,(u=(st.get(s,"events")||Object.create(null))[t.type]&&st.get(s,"handle"))&&u.apply(s,e),(u=c&&s[c])&&u.apply&&nt(s)&&(t.result=u.apply(s,e),!1===t.result&&t.preventDefault());return t.type=m,n||t.isDefaultPrevented()||h._default&&!1!==h._default.apply(f.pop(),e)||!nt(r)||c&&_(r[m])&&!y(r)&&((a=r[c])&&(r[c]=null),E.event.triggered=m,t.isPropagationStopped()&&d.addEventListener(m,Oe),r[m](),t.isPropagationStopped()&&d.removeEventListener(m,Oe),E.event.triggered=void 0,a&&(r[c]=a)),t.result}},simulate:function(t,e,i){var r=E.extend(new E.Event,i,{type:t,isSimulated:!0});E.event.trigger(r,null,e)}}),E.fn.extend({trigger:function(t,e){return this.each((function(){E.event.trigger(t,e,this)}))},triggerHandler:function(t,e){var i=this[0];if(i)return E.event.trigger(t,e,i,!0)}});var De=/\[\]$/,Le=/\r?\n/g,ke=/^(?:submit|button|image|reset|file)$/i,Be=/^(?:input|select|textarea|keygen)/i;function Fe(t,e,i,r){var n;if(Array.isArray(e))E.each(e,(function(e,n){i||De.test(t)?r(t,n):Fe(t+"["+("object"==typeof n&&null!=n?e:"")+"]",n,i,r)}));else if(i||"object"!==w(e))r(t,e);else for(n in e)Fe(t+"["+n+"]",e[n],i,r)}E.param=function(t,e){var i,r=[],n=function(t,e){var i=_(e)?e():e;r[r.length]=encodeURIComponent(t)+"="+encodeURIComponent(null==i?"":i)};if(null==t)return"";if(Array.isArray(t)||t.jquery&&!E.isPlainObject(t))E.each(t,(function(){n(this.name,this.value)}));else for(i in t)Fe(i,t[i],e,n);return r.join("&")},E.fn.extend({serialize:function(){return E.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var t=E.prop(this,"elements");return t?E.makeArray(t):this})).filter((function(){var t=this.type;return this.name&&!E(this).is(":disabled")&&Be.test(this.nodeName)&&!ke.test(t)&&(this.checked||!Et.test(t))})).map((function(t,e){var i=E(this).val();return null==i?null:Array.isArray(i)?E.map(i,(function(t){return{name:e.name,value:t.replace(Le,"\r\n")}})):{name:e.name,value:i.replace(Le,"\r\n")}})).get()}});var ze=/%20/g,Ne=/#.*$/,Ue=/([?&])_=[^&]*/,Ge=/^(.*?):[ \t]*([^\r\n]*)$/gm,je=/^(?:GET|HEAD)$/,Ve=/^\/\//,Xe={},He={},qe="*/".concat("*"),We=v.createElement("a");function $e(t){return function(e,i){"string"!=typeof e&&(i=e,e="*");var r,n=0,o=e.toLowerCase().match(q)||[];if(_(i))for(;r=o[n++];)"+"===r[0]?(r=r.slice(1)||"*",(t[r]=t[r]||[]).unshift(i)):(t[r]=t[r]||[]).push(i)}}function Ye(t,e,i,r){var n={},o=t===He;function s(a){var l;return n[a]=!0,E.each(t[a]||[],(function(t,a){var c=a(e,i,r);return"string"!=typeof c||o||n[c]?o?!(l=c):void 0:(e.dataTypes.unshift(c),s(c),!1)})),l}return s(e.dataTypes[0])||!n["*"]&&s("*")}function Ze(t,e){var i,r,n=E.ajaxSettings.flatOptions||{};for(i in e)void 0!==e[i]&&((n[i]?t:r||(r={}))[i]=e[i]);return r&&E.extend(!0,t,r),t}We.href=Ie.href,E.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ie.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Ie.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":qe,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":E.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?Ze(Ze(t,E.ajaxSettings),e):Ze(E.ajaxSettings,t)},ajaxPrefilter:$e(Xe),ajaxTransport:$e(He),ajax:function(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};var r,n,o,s,a,l,c,u,h,d,p=E.ajaxSetup({},e),f=p.context||p,m=p.context&&(f.nodeType||f.jquery)?E(f):E.event,g=E.Deferred(),_=E.Callbacks("once memory"),y=p.statusCode||{},x={},b={},w="canceled",T={readyState:0,getResponseHeader:function(t){var e;if(c){if(!s)for(s={};e=Ge.exec(o);)s[e[1].toLowerCase()+" "]=(s[e[1].toLowerCase()+" "]||[]).concat(e[2]);e=s[t.toLowerCase()+" "]}return null==e?null:e.join(", ")},getAllResponseHeaders:function(){return c?o:null},setRequestHeader:function(t,e){return null==c&&(t=b[t.toLowerCase()]=b[t.toLowerCase()]||t,x[t]=e),this},overrideMimeType:function(t){return null==c&&(p.mimeType=t),this},statusCode:function(t){var e;if(t)if(c)T.always(t[T.status]);else for(e in t)y[e]=[y[e],t[e]];return this},abort:function(t){var e=t||w;return r&&r.abort(e),S(0,e),this}};if(g.promise(T),p.url=((t||p.url||Ie.href)+"").replace(Ve,Ie.protocol+"//"),p.type=e.method||e.type||p.method||p.type,p.dataTypes=(p.dataType||"*").toLowerCase().match(q)||[""],null==p.crossDomain){l=v.createElement("a");try{l.href=p.url,l.href=l.href,p.crossDomain=We.protocol+"//"+We.host!=l.protocol+"//"+l.host}catch(t){p.crossDomain=!0}}if(p.data&&p.processData&&"string"!=typeof p.data&&(p.data=E.param(p.data,p.traditional)),Ye(Xe,p,e,T),c)return T;for(h in(u=E.event&&p.global)&&0==E.active++&&E.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!je.test(p.type),n=p.url.replace(Ne,""),p.hasContent?p.data&&p.processData&&0===(p.contentType||"").indexOf("application/x-www-form-urlencoded")&&(p.data=p.data.replace(ze,"+")):(d=p.url.slice(n.length),p.data&&(p.processData||"string"==typeof p.data)&&(n+=(Pe.test(n)?"&":"?")+p.data,delete p.data),!1===p.cache&&(n=n.replace(Ue,"$1"),d=(Pe.test(n)?"&":"?")+"_="+Ce.guid+++d),p.url=n+d),p.ifModified&&(E.lastModified[n]&&T.setRequestHeader("If-Modified-Since",E.lastModified[n]),E.etag[n]&&T.setRequestHeader("If-None-Match",E.etag[n])),(p.data&&p.hasContent&&!1!==p.contentType||e.contentType)&&T.setRequestHeader("Content-Type",p.contentType),T.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+qe+"; q=0.01":""):p.accepts["*"]),p.headers)T.setRequestHeader(h,p.headers[h]);if(p.beforeSend&&(!1===p.beforeSend.call(f,T,p)||c))return T.abort();if(w="abort",_.add(p.complete),T.done(p.success),T.fail(p.error),r=Ye(He,p,e,T)){if(T.readyState=1,u&&m.trigger("ajaxSend",[T,p]),c)return T;p.async&&p.timeout>0&&(a=i.setTimeout((function(){T.abort("timeout")}),p.timeout));try{c=!1,r.send(x,S)}catch(t){if(c)throw t;S(-1,t)}}else S(-1,"No Transport");function S(t,e,s,l){var h,d,v,x,b,w=e;c||(c=!0,a&&i.clearTimeout(a),r=void 0,o=l||"",T.readyState=t>0?4:0,h=t>=200&&t<300||304===t,s&&(x=function(t,e,i){for(var r,n,o,s,a=t.contents,l=t.dataTypes;"*"===l[0];)l.shift(),void 0===r&&(r=t.mimeType||e.getResponseHeader("Content-Type"));if(r)for(n in a)if(a[n]&&a[n].test(r)){l.unshift(n);break}if(l[0]in i)o=l[0];else{for(n in i){if(!l[0]||t.converters[n+" "+l[0]]){o=n;break}s||(s=n)}o=o||s}if(o)return o!==l[0]&&l.unshift(o),i[o]}(p,T,s)),!h&&E.inArray("script",p.dataTypes)>-1&&E.inArray("json",p.dataTypes)<0&&(p.converters["text script"]=function(){}),x=function(t,e,i,r){var n,o,s,a,l,c={},u=t.dataTypes.slice();if(u[1])for(s in t.converters)c[s.toLowerCase()]=t.converters[s];for(o=u.shift();o;)if(t.responseFields[o]&&(i[t.responseFields[o]]=e),!l&&r&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),l=o,o=u.shift())if("*"===o)o=l;else if("*"!==l&&l!==o){if(!(s=c[l+" "+o]||c["* "+o]))for(n in c)if((a=n.split(" "))[1]===o&&(s=c[l+" "+a[0]]||c["* "+a[0]])){!0===s?s=c[n]:!0!==c[n]&&(o=a[0],u.unshift(a[1]));break}if(!0!==s)if(s&&t.throws)e=s(e);else try{e=s(e)}catch(t){return{state:"parsererror",error:s?t:"No conversion from "+l+" to "+o}}}return{state:"success",data:e}}(p,x,T,h),h?(p.ifModified&&((b=T.getResponseHeader("Last-Modified"))&&(E.lastModified[n]=b),(b=T.getResponseHeader("etag"))&&(E.etag[n]=b)),204===t||"HEAD"===p.type?w="nocontent":304===t?w="notmodified":(w=x.state,d=x.data,h=!(v=x.error))):(v=w,!t&&w||(w="error",t<0&&(t=0))),T.status=t,T.statusText=(e||w)+"",h?g.resolveWith(f,[d,w,T]):g.rejectWith(f,[T,w,v]),T.statusCode(y),y=void 0,u&&m.trigger(h?"ajaxSuccess":"ajaxError",[T,p,h?d:v]),_.fireWith(f,[T,w]),u&&(m.trigger("ajaxComplete",[T,p]),--E.active||E.event.trigger("ajaxStop")))}return T},getJSON:function(t,e,i){return E.get(t,e,i,"json")},getScript:function(t,e){return E.get(t,void 0,e,"script")}}),E.each(["get","post"],(function(t,e){E[e]=function(t,i,r,n){return _(i)&&(n=n||r,r=i,i=void 0),E.ajax(E.extend({url:t,type:e,dataType:n,data:i,success:r},E.isPlainObject(t)&&t))}})),E.ajaxPrefilter((function(t){var e;for(e in t.headers)"content-type"===e.toLowerCase()&&(t.contentType=t.headers[e]||"")})),E._evalUrl=function(t,e,i){return E.ajax({url:t,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(t){E.globalEval(t,e,i)}})},E.fn.extend({wrapAll:function(t){var e;return this[0]&&(_(t)&&(t=t.call(this[0])),e=E(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map((function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t})).append(this)),this},wrapInner:function(t){return _(t)?this.each((function(e){E(this).wrapInner(t.call(this,e))})):this.each((function(){var e=E(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)}))},wrap:function(t){var e=_(t);return this.each((function(i){E(this).wrapAll(e?t.call(this,i):t)}))},unwrap:function(t){return this.parent(t).not("body").each((function(){E(this).replaceWith(this.childNodes)})),this}}),E.expr.pseudos.hidden=function(t){return!E.expr.pseudos.visible(t)},E.expr.pseudos.visible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},E.ajaxSettings.xhr=function(){try{return new i.XMLHttpRequest}catch(t){}};var Ke={0:200,1223:204},Je=E.ajaxSettings.xhr();g.cors=!!Je&&"withCredentials"in Je,g.ajax=Je=!!Je,E.ajaxTransport((function(t){var e,r;if(g.cors||Je&&!t.crossDomain)return{send:function(n,o){var s,a=t.xhr();if(a.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(s in t.xhrFields)a[s]=t.xhrFields[s];for(s in t.mimeType&&a.overrideMimeType&&a.overrideMimeType(t.mimeType),t.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest"),n)a.setRequestHeader(s,n[s]);e=function(t){return function(){e&&(e=r=a.onload=a.onerror=a.onabort=a.ontimeout=a.onreadystatechange=null,"abort"===t?a.abort():"error"===t?"number"!=typeof a.status?o(0,"error"):o(a.status,a.statusText):o(Ke[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=e(),r=a.onerror=a.ontimeout=e("error"),void 0!==a.onabort?a.onabort=r:a.onreadystatechange=function(){4===a.readyState&&i.setTimeout((function(){e&&r()}))},e=e("abort");try{a.send(t.hasContent&&t.data||null)}catch(t){if(e)throw t}},abort:function(){e&&e()}}})),E.ajaxPrefilter((function(t){t.crossDomain&&(t.contents.script=!1)})),E.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return E.globalEval(t),t}}}),E.ajaxPrefilter("script",(function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")})),E.ajaxTransport("script",(function(t){var e,i;if(t.crossDomain||t.scriptAttrs)return{send:function(r,n){e=E("<script>").attr(t.scriptAttrs||{}).prop({charset:t.scriptCharset,src:t.url}).on("load error",i=function(t){e.remove(),i=null,t&&n("error"===t.type?404:200,t.type)}),v.head.appendChild(e[0])},abort:function(){i&&i()}}}));var Qe,ti=[],ei=/(=)\?(?=&|$)|\?\?/;E.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=ti.pop()||E.expando+"_"+Ce.guid++;return this[t]=!0,t}}),E.ajaxPrefilter("json jsonp",(function(t,e,r){var n,o,s,a=!1!==t.jsonp&&(ei.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&ei.test(t.data)&&"data");if(a||"jsonp"===t.dataTypes[0])return n=t.jsonpCallback=_(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,a?t[a]=t[a].replace(ei,"$1"+n):!1!==t.jsonp&&(t.url+=(Pe.test(t.url)?"&":"?")+t.jsonp+"="+n),t.converters["script json"]=function(){return s||E.error(n+" was not called"),s[0]},t.dataTypes[0]="json",o=i[n],i[n]=function(){s=arguments},r.always((function(){void 0===o?E(i).removeProp(n):i[n]=o,t[n]&&(t.jsonpCallback=e.jsonpCallback,ti.push(n)),s&&_(o)&&o(s[0]),s=o=void 0})),"script"})),g.createHTMLDocument=((Qe=v.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Qe.childNodes.length),E.parseHTML=function(t,e,i){return"string"!=typeof t?[]:("boolean"==typeof e&&(i=e,e=!1),e||(g.createHTMLDocument?((r=(e=v.implementation.createHTMLDocument("")).createElement("base")).href=v.location.href,e.head.appendChild(r)):e=v),o=!i&&[],(n=N.exec(t))?[e.createElement(n[1])]:(n=Rt([t],e,o),o&&o.length&&E(o).remove(),E.merge([],n.childNodes)));var r,n,o},E.fn.load=function(t,e,i){var r,n,o,s=this,a=t.indexOf(" ");return a>-1&&(r=Ee(t.slice(a)),t=t.slice(0,a)),_(e)?(i=e,e=void 0):e&&"object"==typeof e&&(n="POST"),s.length>0&&E.ajax({url:t,type:n||"GET",dataType:"html",data:e}).done((function(t){o=arguments,s.html(r?E("<div>").append(E.parseHTML(t)).find(r):t)})).always(i&&function(t,e){s.each((function(){i.apply(this,o||[t.responseText,e,t])}))}),this},E.expr.pseudos.animated=function(t){return E.grep(E.timers,(function(e){return t===e.elem})).length},E.offset={setOffset:function(t,e,i){var r,n,o,s,a,l,c=E.css(t,"position"),u=E(t),h={};"static"===c&&(t.style.position="relative"),a=u.offset(),o=E.css(t,"top"),l=E.css(t,"left"),("absolute"===c||"fixed"===c)&&(o+l).indexOf("auto")>-1?(s=(r=u.position()).top,n=r.left):(s=parseFloat(o)||0,n=parseFloat(l)||0),_(e)&&(e=e.call(t,i,E.extend({},a))),null!=e.top&&(h.top=e.top-a.top+s),null!=e.left&&(h.left=e.left-a.left+n),"using"in e?e.using.call(t,h):u.css(h)}},E.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each((function(e){E.offset.setOffset(this,t,e)}));var e,i,r=this[0];return r?r.getClientRects().length?(e=r.getBoundingClientRect(),i=r.ownerDocument.defaultView,{top:e.top+i.pageYOffset,left:e.left+i.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var t,e,i,r=this[0],n={top:0,left:0};if("fixed"===E.css(r,"position"))e=r.getBoundingClientRect();else{for(e=this.offset(),i=r.ownerDocument,t=r.offsetParent||i.documentElement;t&&(t===i.body||t===i.documentElement)&&"static"===E.css(t,"position");)t=t.parentNode;t&&t!==r&&1===t.nodeType&&((n=E(t).offset()).top+=E.css(t,"borderTopWidth",!0),n.left+=E.css(t,"borderLeftWidth",!0))}return{top:e.top-n.top-E.css(r,"marginTop",!0),left:e.left-n.left-E.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var t=this.offsetParent;t&&"static"===E.css(t,"position");)t=t.offsetParent;return t||ft}))}}),E.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(t,e){var i="pageYOffset"===e;E.fn[t]=function(r){return Q(this,(function(t,r,n){var o;if(y(t)?o=t:9===t.nodeType&&(o=t.defaultView),void 0===n)return o?o[e]:t[r];o?o.scrollTo(i?o.pageXOffset:n,i?n:o.pageYOffset):t[r]=n}),t,r,arguments.length)}})),E.each(["top","left"],(function(t,e){E.cssHooks[e]=Qt(g.pixelPosition,(function(t,i){if(i)return i=Jt(t,e),Wt.test(i)?E(t).position()[e]+"px":i}))})),E.each({Height:"height",Width:"width"},(function(t,e){E.each({padding:"inner"+t,content:e,"":"outer"+t},(function(i,r){E.fn[r]=function(n,o){var s=arguments.length&&(i||"boolean"!=typeof n),a=i||(!0===n||!0===o?"margin":"border");return Q(this,(function(e,i,n){var o;return y(e)?0===r.indexOf("outer")?e["inner"+t]:e.document.documentElement["client"+t]:9===e.nodeType?(o=e.documentElement,Math.max(e.body["scroll"+t],o["scroll"+t],e.body["offset"+t],o["offset"+t],o["client"+t])):void 0===n?E.css(e,i,a):E.style(e,i,n,a)}),e,s?n:void 0,s)}}))})),E.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(t,e){E.fn[e]=function(t){return this.on(e,t)}})),E.fn.extend({bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,r){return this.on(e,t,i,r)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)},hover:function(t,e){return this.on("mouseenter",t).on("mouseleave",e||t)}}),E.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(t,e){E.fn[e]=function(t,i){return arguments.length>0?this.on(e,null,t,i):this.trigger(e)}}));var ii=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;E.proxy=function(t,e){var i,r,n;if("string"==typeof e&&(i=t[e],e=t,t=i),_(t))return r=a.call(arguments,2),(n=function(){return t.apply(e||this,r.concat(a.call(arguments)))}).guid=t.guid=t.guid||E.guid++,n},E.holdReady=function(t){t?E.readyWait++:E.ready(!0)},E.isArray=Array.isArray,E.parseJSON=JSON.parse,E.nodeName=A,E.isFunction=_,E.isWindow=y,E.camelCase=rt,E.type=w,E.now=Date.now,E.isNumeric=function(t){var e=E.type(t);return("number"===e||"string"===e)&&!isNaN(t-parseFloat(t))},E.trim=function(t){return null==t?"":(t+"").replace(ii,"$1")},void 0===(r=function(){return E}.apply(e,[]))||(t.exports=r);var ri=i.jQuery,ni=i.$;return E.noConflict=function(t){return i.$===E&&(i.$=ni),t&&i.jQuery===E&&(i.jQuery=ri),E},void 0===n&&(i.jQuery=i.$=E),E}))},FpZJ:function(t,e,i){"use strict";t.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),i=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(i))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var r=Object.getOwnPropertySymbols(t);if(1!==r.length||r[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var n=Object.getOwnPropertyDescriptor(t,e);if(42!==n.value||!0!==n.enumerable)return!1}return!0}},GYWy:function(t,e,i){(function(t,r){var n;!function(o){e&&e.nodeType,t&&t.nodeType;var s="object"==typeof r&&r;s.global!==s&&s.window!==s&&s.self;var a,l=2147483647,c=/^xn--/,u=/[^\x20-\x7E]/,h=/[\x2E\u3002\uFF0E\uFF61]/g,d={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=Math.floor,f=String.fromCharCode;function m(t){throw new RangeError(d[t])}function g(t,e){for(var i=t.length,r=[];i--;)r[i]=e(t[i]);return r}function _(t,e){var i=t.split("@"),r="";return i.length>1&&(r=i[0]+"@",t=i[1]),r+g((t=t.replace(h,".")).split("."),e).join(".")}function y(t){for(var e,i,r=[],n=0,o=t.length;n<o;)(e=t.charCodeAt(n++))>=55296&&e<=56319&&n<o?56320==(64512&(i=t.charCodeAt(n++)))?r.push(((1023&e)<<10)+(1023&i)+65536):(r.push(e),n--):r.push(e);return r}function v(t){return g(t,(function(t){var e="";return t>65535&&(e+=f((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=f(t)})).join("")}function x(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function b(t,e,i){var r=0;for(t=i?p(t/700):t>>1,t+=p(t/e);t>455;r+=36)t=p(t/35);return p(r+36*t/(t+38))}function w(t){var e,i,r,n,o,s,a,c,u,h,d,f=[],g=t.length,_=0,y=128,x=72;for((i=t.lastIndexOf("-"))<0&&(i=0),r=0;r<i;++r)t.charCodeAt(r)>=128&&m("not-basic"),f.push(t.charCodeAt(r));for(n=i>0?i+1:0;n<g;){for(o=_,s=1,a=36;n>=g&&m("invalid-input"),((c=(d=t.charCodeAt(n++))-48<10?d-22:d-65<26?d-65:d-97<26?d-97:36)>=36||c>p((l-_)/s))&&m("overflow"),_+=c*s,!(c<(u=a<=x?1:a>=x+26?26:a-x));a+=36)s>p(l/(h=36-u))&&m("overflow"),s*=h;x=b(_-o,e=f.length+1,0==o),p(_/e)>l-y&&m("overflow"),y+=p(_/e),_%=e,f.splice(_++,0,y)}return v(f)}function T(t){var e,i,r,n,o,s,a,c,u,h,d,g,_,v,w,T=[];for(g=(t=y(t)).length,e=128,i=0,o=72,s=0;s<g;++s)(d=t[s])<128&&T.push(f(d));for(r=n=T.length,n&&T.push("-");r<g;){for(a=l,s=0;s<g;++s)(d=t[s])>=e&&d<a&&(a=d);for(a-e>p((l-i)/(_=r+1))&&m("overflow"),i+=(a-e)*_,e=a,s=0;s<g;++s)if((d=t[s])<e&&++i>l&&m("overflow"),d==e){for(c=i,u=36;!(c<(h=u<=o?1:u>=o+26?26:u-o));u+=36)w=c-h,v=36-h,T.push(f(x(h+w%v,0))),c=p(w/v);T.push(f(x(c,0))),o=b(i,_,r==n),i=0,++r}++i,++e}return T.join("")}a={version:"1.4.1",ucs2:{decode:y,encode:v},decode:w,encode:T,toASCII:function(t){return _(t,(function(t){return u.test(t)?"xn--"+T(t):t}))},toUnicode:function(t){return _(t,(function(t){return c.test(t)?w(t.slice(4).toLowerCase()):t}))}},void 0===(n=function(){return a}.call(e,i,e,t))||(t.exports=n)}()}).call(this,i("YuTi")(t),i("yLpj"))},HSsa:function(t,e,i){"use strict";t.exports=function(t,e){return function(){for(var i=new Array(arguments.length),r=0;r<i.length;r++)i[r]=arguments[r];return t.apply(e,i)}}},I1BE:function(t,e){t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i=function(t,e){var i=t[1]||"",r=t[3];if(!r)return i;if(e&&"function"==typeof btoa){var n=(s=r,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */"),o=r.sources.map((function(t){return"/*# sourceURL="+r.sourceRoot+t+" */"}));return[i].concat(o).concat([n]).join("\n")}var s;return[i].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+i+"}":i})).join("")},e.i=function(t,i){"string"==typeof t&&(t=[[null,t,""]]);for(var r={},n=0;n<this.length;n++){var o=this[n][0];"number"==typeof o&&(r[o]=!0)}for(n=0;n<t.length;n++){var s=t[n];"number"==typeof s[0]&&r[s[0]]||(i&&!s[2]?s[2]=i:i&&(s[2]="("+s[2]+") and ("+i+")"),e.push(s))}},e}},JEQr:function(t,e,i){"use strict";(function(e){var r=i("xTJ+"),n=i("yK9s"),o=i("OH9c"),s={"Content-Type":"application/x-www-form-urlencoded"};function a(t,e){!r.isUndefined(t)&&r.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var l,c={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==e&&"[object process]"===Object.prototype.toString.call(e))&&(l=i("tQ2B")),l),transformRequest:[function(t,e){return n(e,"Accept"),n(e,"Content-Type"),r.isFormData(t)||r.isArrayBuffer(t)||r.isBuffer(t)||r.isStream(t)||r.isFile(t)||r.isBlob(t)?t:r.isArrayBufferView(t)?t.buffer:r.isURLSearchParams(t)?(a(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):r.isObject(t)||e&&"application/json"===e["Content-Type"]?(a(e,"application/json"),function(t,e,i){if(r.isString(t))try{return(e||JSON.parse)(t),r.trim(t)}catch(t){if("SyntaxError"!==t.name)throw t}return(i||JSON.stringify)(t)}(t)):t}],transformResponse:[function(t){var e=this.transitional,i=e&&e.silentJSONParsing,n=e&&e.forcedJSONParsing,s=!i&&"json"===this.responseType;if(s||n&&r.isString(t)&&t.length)try{return JSON.parse(t)}catch(t){if(s){if("SyntaxError"===t.name)throw o(t,this,"E_JSON_PARSE");throw t}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(t){return t>=200&&t<300}};c.headers={common:{Accept:"application/json, text/plain, */*"}},r.forEach(["delete","get","head"],(function(t){c.headers[t]={}})),r.forEach(["post","put","patch"],(function(t){c.headers[t]=r.merge(s)})),t.exports=c}).call(this,i("8oxB"))},JxQ3:function(t,e,i){(function(e){var r="function"==typeof Map&&Map.prototype,n=Object.getOwnPropertyDescriptor&&r?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,o=r&&n&&"function"==typeof n.get?n.get:null,s=r&&Map.prototype.forEach,a="function"==typeof Set&&Set.prototype,l=Object.getOwnPropertyDescriptor&&a?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,c=a&&l&&"function"==typeof l.get?l.get:null,u=a&&Set.prototype.forEach,h="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,d="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,p="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,f=Boolean.prototype.valueOf,m=Object.prototype.toString,g=Function.prototype.toString,_=String.prototype.match,y=String.prototype.slice,v=String.prototype.replace,x=String.prototype.toUpperCase,b=String.prototype.toLowerCase,w=RegExp.prototype.test,T=Array.prototype.concat,E=Array.prototype.join,S=Array.prototype.slice,A=Math.floor,M="function"==typeof BigInt?BigInt.prototype.valueOf:null,I=Object.getOwnPropertySymbols,C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,P="function"==typeof Symbol&&"object"==typeof Symbol.iterator,R="function"==typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===P||"symbol")?Symbol.toStringTag:null,O=Object.prototype.propertyIsEnumerable,D=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null);function L(t,e){if(t===1/0||t===-1/0||t!=t||t&&t>-1e3&&t<1e3||w.call(/e/,e))return e;var i=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof t){var r=t<0?-A(-t):A(t);if(r!==t){var n=String(r),o=y.call(e,n.length+1);return v.call(n,i,"$&_")+"."+v.call(v.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return v.call(e,i,"$&_")}var k=i(1),B=k.custom,F=j(B)?B:null;function z(t,e,i){var r="double"===(i.quoteStyle||e)?'"':"'";return r+t+r}function N(t){return v.call(String(t),/"/g,"&quot;")}function U(t){return!("[object Array]"!==H(t)||R&&"object"==typeof t&&R in t)}function G(t){return!("[object RegExp]"!==H(t)||R&&"object"==typeof t&&R in t)}function j(t){if(P)return t&&"object"==typeof t&&t instanceof Symbol;if("symbol"==typeof t)return!0;if(!t||"object"!=typeof t||!C)return!1;try{return C.call(t),!0}catch(t){}return!1}t.exports=function t(i,r,n,a){var l=r||{};if(X(l,"quoteStyle")&&"single"!==l.quoteStyle&&"double"!==l.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(X(l,"maxStringLength")&&("number"==typeof l.maxStringLength?l.maxStringLength<0&&l.maxStringLength!==1/0:null!==l.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var m=!X(l,"customInspect")||l.customInspect;if("boolean"!=typeof m&&"symbol"!==m)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(X(l,"indent")&&null!==l.indent&&"\t"!==l.indent&&!(parseInt(l.indent,10)===l.indent&&l.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(X(l,"numericSeparator")&&"boolean"!=typeof l.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var x=l.numericSeparator;if(void 0===i)return"undefined";if(null===i)return"null";if("boolean"==typeof i)return i?"true":"false";if("string"==typeof i)return function t(e,i){if(e.length>i.maxStringLength){var r=e.length-i.maxStringLength,n="... "+r+" more character"+(r>1?"s":"");return t(y.call(e,0,i.maxStringLength),i)+n}return z(v.call(v.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,W),"single",i)}(i,l);if("number"==typeof i){if(0===i)return 1/0/i>0?"0":"-0";var w=String(i);return x?L(i,w):w}if("bigint"==typeof i){var A=String(i)+"n";return x?L(i,A):A}var I=void 0===l.depth?5:l.depth;if(void 0===n&&(n=0),n>=I&&I>0&&"object"==typeof i)return U(i)?"[Array]":"[Object]";var B=function(t,e){var i;if("\t"===t.indent)i="\t";else{if(!("number"==typeof t.indent&&t.indent>0))return null;i=E.call(Array(t.indent+1)," ")}return{base:i,prev:E.call(Array(e+1),i)}}(l,n);if(void 0===a)a=[];else if(q(a,i)>=0)return"[Circular]";function V(e,i,r){if(i&&(a=S.call(a)).push(i),r){var o={depth:l.depth};return X(l,"quoteStyle")&&(o.quoteStyle=l.quoteStyle),t(e,o,n+1,a)}return t(e,l,n+1,a)}if("function"==typeof i&&!G(i)){var Q=function(t){if(t.name)return t.name;var e=_.call(g.call(t),/^function\s*([\w$]+)/);if(e)return e[1];return null}(i),tt=J(i,V);return"[Function"+(Q?": "+Q:" (anonymous)")+"]"+(tt.length>0?" { "+E.call(tt,", ")+" }":"")}if(j(i)){var et=P?v.call(String(i),/^(Symbol\(.*\))_[^)]*$/,"$1"):C.call(i);return"object"!=typeof i||P?et:$(et)}if(function(t){if(!t||"object"!=typeof t)return!1;if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement)return!0;return"string"==typeof t.nodeName&&"function"==typeof t.getAttribute}(i)){for(var it="<"+b.call(String(i.nodeName)),rt=i.attributes||[],nt=0;nt<rt.length;nt++)it+=" "+rt[nt].name+"="+z(N(rt[nt].value),"double",l);return it+=">",i.childNodes&&i.childNodes.length&&(it+="..."),it+="</"+b.call(String(i.nodeName))+">"}if(U(i)){if(0===i.length)return"[]";var ot=J(i,V);return B&&!function(t){for(var e=0;e<t.length;e++)if(q(t[e],"\n")>=0)return!1;return!0}(ot)?"["+K(ot,B)+"]":"[ "+E.call(ot,", ")+" ]"}if(function(t){return!("[object Error]"!==H(t)||R&&"object"==typeof t&&R in t)}(i)){var st=J(i,V);return"cause"in Error.prototype||!("cause"in i)||O.call(i,"cause")?0===st.length?"["+String(i)+"]":"{ ["+String(i)+"] "+E.call(st,", ")+" }":"{ ["+String(i)+"] "+E.call(T.call("[cause]: "+V(i.cause),st),", ")+" }"}if("object"==typeof i&&m){if(F&&"function"==typeof i[F]&&k)return k(i,{depth:I-n});if("symbol"!==m&&"function"==typeof i.inspect)return i.inspect()}if(function(t){if(!o||!t||"object"!=typeof t)return!1;try{o.call(t);try{c.call(t)}catch(t){return!0}return t instanceof Map}catch(t){}return!1}(i)){var at=[];return s&&s.call(i,(function(t,e){at.push(V(e,i,!0)+" => "+V(t,i))})),Z("Map",o.call(i),at,B)}if(function(t){if(!c||!t||"object"!=typeof t)return!1;try{c.call(t);try{o.call(t)}catch(t){return!0}return t instanceof Set}catch(t){}return!1}(i)){var lt=[];return u&&u.call(i,(function(t){lt.push(V(t,i))})),Z("Set",c.call(i),lt,B)}if(function(t){if(!h||!t||"object"!=typeof t)return!1;try{h.call(t,h);try{d.call(t,d)}catch(t){return!0}return t instanceof WeakMap}catch(t){}return!1}(i))return Y("WeakMap");if(function(t){if(!d||!t||"object"!=typeof t)return!1;try{d.call(t,d);try{h.call(t,h)}catch(t){return!0}return t instanceof WeakSet}catch(t){}return!1}(i))return Y("WeakSet");if(function(t){if(!p||!t||"object"!=typeof t)return!1;try{return p.call(t),!0}catch(t){}return!1}(i))return Y("WeakRef");if(function(t){return!("[object Number]"!==H(t)||R&&"object"==typeof t&&R in t)}(i))return $(V(Number(i)));if(function(t){if(!t||"object"!=typeof t||!M)return!1;try{return M.call(t),!0}catch(t){}return!1}(i))return $(V(M.call(i)));if(function(t){return!("[object Boolean]"!==H(t)||R&&"object"==typeof t&&R in t)}(i))return $(f.call(i));if(function(t){return!("[object String]"!==H(t)||R&&"object"==typeof t&&R in t)}(i))return $(V(String(i)));if("undefined"!=typeof window&&i===window)return"{ [object Window] }";if(i===e)return"{ [object globalThis] }";if(!function(t){return!("[object Date]"!==H(t)||R&&"object"==typeof t&&R in t)}(i)&&!G(i)){var ct=J(i,V),ut=D?D(i)===Object.prototype:i instanceof Object||i.constructor===Object,ht=i instanceof Object?"":"null prototype",dt=!ut&&R&&Object(i)===i&&R in i?y.call(H(i),8,-1):ht?"Object":"",pt=(ut||"function"!=typeof i.constructor?"":i.constructor.name?i.constructor.name+" ":"")+(dt||ht?"["+E.call(T.call([],dt||[],ht||[]),": ")+"] ":"");return 0===ct.length?pt+"{}":B?pt+"{"+K(ct,B)+"}":pt+"{ "+E.call(ct,", ")+" }"}return String(i)};var V=Object.prototype.hasOwnProperty||function(t){return t in this};function X(t,e){return V.call(t,e)}function H(t){return m.call(t)}function q(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1}function W(t){var e=t.charCodeAt(0),i={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return i?"\\"+i:"\\x"+(e<16?"0":"")+x.call(e.toString(16))}function $(t){return"Object("+t+")"}function Y(t){return t+" { ? }"}function Z(t,e,i,r){return t+" ("+e+") {"+(r?K(i,r):E.call(i,", "))+"}"}function K(t,e){if(0===t.length)return"";var i="\n"+e.prev+e.base;return i+E.call(t,","+i)+"\n"+e.prev}function J(t,e){var i=U(t),r=[];if(i){r.length=t.length;for(var n=0;n<t.length;n++)r[n]=X(t,n)?e(t[n],t):""}var o,s="function"==typeof I?I(t):[];if(P){o={};for(var a=0;a<s.length;a++)o["$"+s[a]]=s[a]}for(var l in t)X(t,l)&&(i&&String(Number(l))===l&&l<t.length||P&&o["$"+l]instanceof Symbol||(w.call(/[^\w$]/,l)?r.push(e(l,t)+": "+e(t[l],t)):r.push(l+": "+e(t[l],t))));if("function"==typeof I)for(var c=0;c<s.length;c++)O.call(t,s[c])&&r.push("["+e(s[c])+"]: "+e(t[s[c]],t));return r}}).call(this,i("yLpj"))},Kqna:function(t,e,i){"use strict";var r=i("AM7I")("%Object.getOwnPropertyDescriptor%",!0);if(r)try{r([],"length")}catch(t){r=null}t.exports=r},LYNF:function(t,e,i){"use strict";var r=i("OH9c");t.exports=function(t,e,i,n,o){var s=new Error(t);return r(s,e,i,n,o)}},Lmem:function(t,e,i){"use strict";t.exports=function(t){return!(!t||!t.__CANCEL__)}},MLWZ:function(t,e,i){"use strict";var r=i("xTJ+");function n(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}t.exports=function(t,e,i){if(!e)return t;var o;if(i)o=i(e);else if(r.isURLSearchParams(e))o=e.toString();else{var s=[];r.forEach(e,(function(t,e){null!=t&&(r.isArray(t)?e+="[]":t=[t],r.forEach(t,(function(t){r.isDate(t)?t=t.toISOString():r.isObject(t)&&(t=JSON.stringify(t)),s.push(n(e)+"="+n(t))})))})),o=s.join("&")}if(o){var a=t.indexOf("#");-1!==a&&(t=t.slice(0,a)),t+=(-1===t.indexOf("?")?"?":"&")+o}return t}},MgzW:function(t,e,i){"use strict";var r=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function s(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},i=0;i<10;i++)e["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(t){r[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var i,a,l=s(t),c=1;c<arguments.length;c++){for(var u in i=Object(arguments[c]))n.call(i,u)&&(l[u]=i[u]);if(r){a=r(i);for(var h=0;h<a.length;h++)o.call(i,a[h])&&(l[a[h]]=i[a[h]])}}return l}},NlKh:function(t,e){},OH9c:function(t,e,i){"use strict";t.exports=function(t,e,i,r,n){return t.config=e,i&&(t.code=i),t.request=r,t.response=n,t.isAxiosError=!0,t.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},t}},OTTw:function(t,e,i){"use strict";var r=i("xTJ+");t.exports=r.isStandardBrowserEnv()?function(){var t,e=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");function n(t){var r=t;return e&&(i.setAttribute("href",r),r=i.href),i.setAttribute("href",r),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:"/"===i.pathname.charAt(0)?i.pathname:"/"+i.pathname}}return t=n(window.location.href),function(e){var i=r.isString(e)?n(e):e;return i.protocol===t.protocol&&i.host===t.host}}():function(){return!0}},PMrG:function(t,e,i){(t.exports=i("I1BE")(!1)).push([t.i,"/**\n * Swiper 11.0.6\n * Most modern mobile touch slider and framework with hardware accelerated transitions\n * https://swiperjs.com\n *\n * Copyright 2014-2024 Vladimir Kharlampidi\n *\n * Released under the MIT License\n *\n * Released on: February 5, 2024\n */\n\n/* FONT_START */\n@font-face {\n  font-family: 'swiper-icons';\n  src: url('data:application/font-woff;charset=utf-8;base64, d09GRgABAAAAAAZgABAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGRlRNAAAGRAAAABoAAAAci6qHkUdERUYAAAWgAAAAIwAAACQAYABXR1BPUwAABhQAAAAuAAAANuAY7+xHU1VCAAAFxAAAAFAAAABm2fPczU9TLzIAAAHcAAAASgAAAGBP9V5RY21hcAAAAkQAAACIAAABYt6F0cBjdnQgAAACzAAAAAQAAAAEABEBRGdhc3AAAAWYAAAACAAAAAj//wADZ2x5ZgAAAywAAADMAAAD2MHtryVoZWFkAAABbAAAADAAAAA2E2+eoWhoZWEAAAGcAAAAHwAAACQC9gDzaG10eAAAAigAAAAZAAAArgJkABFsb2NhAAAC0AAAAFoAAABaFQAUGG1heHAAAAG8AAAAHwAAACAAcABAbmFtZQAAA/gAAAE5AAACXvFdBwlwb3N0AAAFNAAAAGIAAACE5s74hXjaY2BkYGAAYpf5Hu/j+W2+MnAzMYDAzaX6QjD6/4//Bxj5GA8AuRwMYGkAPywL13jaY2BkYGA88P8Agx4j+/8fQDYfA1AEBWgDAIB2BOoAeNpjYGRgYNBh4GdgYgABEMnIABJzYNADCQAACWgAsQB42mNgYfzCOIGBlYGB0YcxjYGBwR1Kf2WQZGhhYGBiYGVmgAFGBiQQkOaawtDAoMBQxXjg/wEGPcYDDA4wNUA2CCgwsAAAO4EL6gAAeNpj2M0gyAACqxgGNWBkZ2D4/wMA+xkDdgAAAHjaY2BgYGaAYBkGRgYQiAHyGMF8FgYHIM3DwMHABGQrMOgyWDLEM1T9/w8UBfEMgLzE////P/5//f/V/xv+r4eaAAeMbAxwIUYmIMHEgKYAYjUcsDAwsLKxc3BycfPw8jEQA/gZBASFhEVExcQlJKWkZWTl5BUUlZRVVNXUNTQZBgMAAMR+E+gAEQFEAAAAKgAqACoANAA+AEgAUgBcAGYAcAB6AIQAjgCYAKIArAC2AMAAygDUAN4A6ADyAPwBBgEQARoBJAEuATgBQgFMAVYBYAFqAXQBfgGIAZIBnAGmAbIBzgHsAAB42u2NMQ6CUAyGW568x9AneYYgm4MJbhKFaExIOAVX8ApewSt4Bic4AfeAid3VOBixDxfPYEza5O+Xfi04YADggiUIULCuEJK8VhO4bSvpdnktHI5QCYtdi2sl8ZnXaHlqUrNKzdKcT8cjlq+rwZSvIVczNiezsfnP/uznmfPFBNODM2K7MTQ45YEAZqGP81AmGGcF3iPqOop0r1SPTaTbVkfUe4HXj97wYE+yNwWYxwWu4v1ugWHgo3S1XdZEVqWM7ET0cfnLGxWfkgR42o2PvWrDMBSFj/IHLaF0zKjRgdiVMwScNRAoWUoH78Y2icB/yIY09An6AH2Bdu/UB+yxopYshQiEvnvu0dURgDt8QeC8PDw7Fpji3fEA4z/PEJ6YOB5hKh4dj3EvXhxPqH/SKUY3rJ7srZ4FZnh1PMAtPhwP6fl2PMJMPDgeQ4rY8YT6Gzao0eAEA409DuggmTnFnOcSCiEiLMgxCiTI6Cq5DZUd3Qmp10vO0LaLTd2cjN4fOumlc7lUYbSQcZFkutRG7g6JKZKy0RmdLY680CDnEJ+UMkpFFe1RN7nxdVpXrC4aTtnaurOnYercZg2YVmLN/d/gczfEimrE/fs/bOuq29Zmn8tloORaXgZgGa78yO9/cnXm2BpaGvq25Dv9S4E9+5SIc9PqupJKhYFSSl47+Qcr1mYNAAAAeNptw0cKwkAAAMDZJA8Q7OUJvkLsPfZ6zFVERPy8qHh2YER+3i/BP83vIBLLySsoKimrqKqpa2hp6+jq6RsYGhmbmJqZSy0sraxtbO3sHRydnEMU4uR6yx7JJXveP7WrDycAAAAAAAH//wACeNpjYGRgYOABYhkgZgJCZgZNBkYGLQZtIJsFLMYAAAw3ALgAeNolizEKgDAQBCchRbC2sFER0YD6qVQiBCv/H9ezGI6Z5XBAw8CBK/m5iQQVauVbXLnOrMZv2oLdKFa8Pjuru2hJzGabmOSLzNMzvutpB3N42mNgZGBg4GKQYzBhYMxJLMlj4GBgAYow/P/PAJJhLM6sSoWKfWCAAwDAjgbRAAB42mNgYGBkAIIbCZo5IPrmUn0hGA0AO8EFTQAA');\n  font-weight: 400;\n  font-style: normal;\n}\n/* FONT_END */\n:root {\n  --swiper-theme-color: #007aff;\n  /*\n  --swiper-preloader-color: var(--swiper-theme-color);\n  --swiper-wrapper-transition-timing-function: initial;\n  */\n}\n:host {\n  position: relative;\n  display: block;\n  margin-left: auto;\n  margin-right: auto;\n  z-index: 1;\n}\n.swiper {\n  margin-left: auto;\n  margin-right: auto;\n  position: relative;\n  overflow: hidden;\n  list-style: none;\n  padding: 0;\n  /* Fix of Webkit flickering */\n  z-index: 1;\n  display: block;\n}\n.swiper-vertical > .swiper-wrapper {\n  flex-direction: column;\n}\n.swiper-wrapper {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  z-index: 1;\n  display: flex;\n  transition-property: transform;\n  transition-timing-function: var(--swiper-wrapper-transition-timing-function, initial);\n  box-sizing: content-box;\n}\n.swiper-android .swiper-slide,\n.swiper-ios .swiper-slide,\n.swiper-wrapper {\n  transform: translate3d(0px, 0, 0);\n}\n.swiper-horizontal {\n  touch-action: pan-y;\n}\n.swiper-vertical {\n  touch-action: pan-x;\n}\n.swiper-slide {\n  flex-shrink: 0;\n  width: 100%;\n  height: 100%;\n  position: relative;\n  transition-property: transform;\n  display: block;\n}\n.swiper-slide-invisible-blank {\n  visibility: hidden;\n}\n/* Auto Height */\n.swiper-autoheight,\n.swiper-autoheight .swiper-slide {\n  height: auto;\n}\n.swiper-autoheight .swiper-wrapper {\n  align-items: flex-start;\n  transition-property: transform, height;\n}\n.swiper-backface-hidden .swiper-slide {\n  transform: translateZ(0);\n  backface-visibility: hidden;\n}\n/* 3D Effects */\n.swiper-3d.swiper-css-mode .swiper-wrapper {\n  perspective: 1200px;\n}\n.swiper-3d .swiper-wrapper {\n  transform-style: preserve-3d;\n}\n.swiper-3d {\n  perspective: 1200px;\n}\n.swiper-3d .swiper-slide,\n.swiper-3d .swiper-cube-shadow {\n  transform-style: preserve-3d;\n}\n/* CSS Mode */\n.swiper-css-mode > .swiper-wrapper {\n  overflow: auto;\n  scrollbar-width: none;\n  /* For Firefox */\n  -ms-overflow-style: none;\n  /* For Internet Explorer and Edge */\n}\n.swiper-css-mode > .swiper-wrapper::-webkit-scrollbar {\n  display: none;\n}\n.swiper-css-mode > .swiper-wrapper > .swiper-slide {\n  scroll-snap-align: start start;\n}\n.swiper-css-mode.swiper-horizontal > .swiper-wrapper {\n  scroll-snap-type: x mandatory;\n}\n.swiper-css-mode.swiper-vertical > .swiper-wrapper {\n  scroll-snap-type: y mandatory;\n}\n.swiper-css-mode.swiper-free-mode > .swiper-wrapper {\n  scroll-snap-type: none;\n}\n.swiper-css-mode.swiper-free-mode > .swiper-wrapper > .swiper-slide {\n  scroll-snap-align: none;\n}\n.swiper-css-mode.swiper-centered > .swiper-wrapper::before {\n  content: '';\n  flex-shrink: 0;\n  order: 9999;\n}\n.swiper-css-mode.swiper-centered > .swiper-wrapper > .swiper-slide {\n  scroll-snap-align: center center;\n  scroll-snap-stop: always;\n}\n.swiper-css-mode.swiper-centered.swiper-horizontal > .swiper-wrapper > .swiper-slide:first-child {\n  margin-inline-start: var(--swiper-centered-offset-before);\n}\n.swiper-css-mode.swiper-centered.swiper-horizontal > .swiper-wrapper::before {\n  height: 100%;\n  min-height: 1px;\n  width: var(--swiper-centered-offset-after);\n}\n.swiper-css-mode.swiper-centered.swiper-vertical > .swiper-wrapper > .swiper-slide:first-child {\n  margin-block-start: var(--swiper-centered-offset-before);\n}\n.swiper-css-mode.swiper-centered.swiper-vertical > .swiper-wrapper::before {\n  width: 100%;\n  min-width: 1px;\n  height: var(--swiper-centered-offset-after);\n}\n/* Slide styles start */\n/* 3D Shadows */\n.swiper-3d .swiper-slide-shadow,\n.swiper-3d .swiper-slide-shadow-left,\n.swiper-3d .swiper-slide-shadow-right,\n.swiper-3d .swiper-slide-shadow-top,\n.swiper-3d .swiper-slide-shadow-bottom,\n.swiper-3d .swiper-slide-shadow,\n.swiper-3d .swiper-slide-shadow-left,\n.swiper-3d .swiper-slide-shadow-right,\n.swiper-3d .swiper-slide-shadow-top,\n.swiper-3d .swiper-slide-shadow-bottom {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  pointer-events: none;\n  z-index: 10;\n}\n.swiper-3d .swiper-slide-shadow {\n  background: rgba(0, 0, 0, 0.15);\n}\n.swiper-3d .swiper-slide-shadow-left {\n  background-image: linear-gradient(to left, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0));\n}\n.swiper-3d .swiper-slide-shadow-right {\n  background-image: linear-gradient(to right, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0));\n}\n.swiper-3d .swiper-slide-shadow-top {\n  background-image: linear-gradient(to top, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0));\n}\n.swiper-3d .swiper-slide-shadow-bottom {\n  background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0));\n}\n.swiper-lazy-preloader {\n  width: 42px;\n  height: 42px;\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  margin-left: -21px;\n  margin-top: -21px;\n  z-index: 10;\n  transform-origin: 50%;\n  box-sizing: border-box;\n  border: 4px solid var(--swiper-preloader-color, var(--swiper-theme-color));\n  border-radius: 50%;\n  border-top-color: transparent;\n}\n.swiper:not(.swiper-watch-progress) .swiper-lazy-preloader,\n.swiper-watch-progress .swiper-slide-visible .swiper-lazy-preloader {\n  animation: swiper-preloader-spin 1s infinite linear;\n}\n.swiper-lazy-preloader-white {\n  --swiper-preloader-color: #fff;\n}\n.swiper-lazy-preloader-black {\n  --swiper-preloader-color: #000;\n}\n@keyframes swiper-preloader-spin {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n}\n/* Slide styles end */\n.swiper-virtual .swiper-slide {\n  -webkit-backface-visibility: hidden;\n  transform: translateZ(0);\n}\n.swiper-virtual.swiper-css-mode .swiper-wrapper::after {\n  content: '';\n  position: absolute;\n  left: 0;\n  top: 0;\n  pointer-events: none;\n}\n.swiper-virtual.swiper-css-mode.swiper-horizontal .swiper-wrapper::after {\n  height: 1px;\n  width: var(--swiper-virtual-size);\n}\n.swiper-virtual.swiper-css-mode.swiper-vertical .swiper-wrapper::after {\n  width: 1px;\n  height: var(--swiper-virtual-size);\n}\n:root {\n  --swiper-navigation-size: 44px;\n  /*\n  --swiper-navigation-top-offset: 50%;\n  --swiper-navigation-sides-offset: 10px;\n  --swiper-navigation-color: var(--swiper-theme-color);\n  */\n}\n.swiper-button-prev,\n.swiper-button-next {\n  position: absolute;\n  top: var(--swiper-navigation-top-offset, 50%);\n  width: calc(var(--swiper-navigation-size) / 44 * 27);\n  height: var(--swiper-navigation-size);\n  margin-top: calc(0px - (var(--swiper-navigation-size) / 2));\n  z-index: 10;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: var(--swiper-navigation-color, var(--swiper-theme-color));\n}\n.swiper-button-prev.swiper-button-disabled,\n.swiper-button-next.swiper-button-disabled {\n  opacity: 0.35;\n  cursor: auto;\n  pointer-events: none;\n}\n.swiper-button-prev.swiper-button-hidden,\n.swiper-button-next.swiper-button-hidden {\n  opacity: 0;\n  cursor: auto;\n  pointer-events: none;\n}\n.swiper-navigation-disabled .swiper-button-prev,\n.swiper-navigation-disabled .swiper-button-next {\n  display: none !important;\n}\n.swiper-button-prev svg,\n.swiper-button-next svg {\n  width: 100%;\n  height: 100%;\n  -o-object-fit: contain;\n     object-fit: contain;\n  transform-origin: center;\n}\n.swiper-rtl .swiper-button-prev svg,\n.swiper-rtl .swiper-button-next svg {\n  transform: rotate(180deg);\n}\n.swiper-button-prev,\n.swiper-rtl .swiper-button-next {\n  left: var(--swiper-navigation-sides-offset, 10px);\n  right: auto;\n}\n.swiper-button-next,\n.swiper-rtl .swiper-button-prev {\n  right: var(--swiper-navigation-sides-offset, 10px);\n  left: auto;\n}\n.swiper-button-lock {\n  display: none;\n}\n/* Navigation font start */\n.swiper-button-prev:after,\n.swiper-button-next:after {\n  font-family: swiper-icons;\n  font-size: var(--swiper-navigation-size);\n  text-transform: none !important;\n  letter-spacing: 0;\n  font-variant: initial;\n  line-height: 1;\n}\n.swiper-button-prev:after,\n.swiper-rtl .swiper-button-next:after {\n  content: 'prev';\n}\n.swiper-button-next,\n.swiper-rtl .swiper-button-prev {\n  right: var(--swiper-navigation-sides-offset, 10px);\n  left: auto;\n}\n.swiper-button-next:after,\n.swiper-rtl .swiper-button-prev:after {\n  content: 'next';\n}\n/* Navigation font end */\n:root {\n  /*\n  --swiper-pagination-color: var(--swiper-theme-color);\n  --swiper-pagination-left: auto;\n  --swiper-pagination-right: 8px;\n  --swiper-pagination-bottom: 8px;\n  --swiper-pagination-top: auto;\n  --swiper-pagination-fraction-color: inherit;\n  --swiper-pagination-progressbar-bg-color: rgba(0,0,0,0.25);\n  --swiper-pagination-progressbar-size: 4px;\n  --swiper-pagination-bullet-size: 8px;\n  --swiper-pagination-bullet-width: 8px;\n  --swiper-pagination-bullet-height: 8px;\n  --swiper-pagination-bullet-border-radius: 50%;\n  --swiper-pagination-bullet-inactive-color: #000;\n  --swiper-pagination-bullet-inactive-opacity: 0.2;\n  --swiper-pagination-bullet-opacity: 1;\n  --swiper-pagination-bullet-horizontal-gap: 4px;\n  --swiper-pagination-bullet-vertical-gap: 6px;\n  */\n}\n.swiper-pagination {\n  position: absolute;\n  text-align: center;\n  transition: 300ms opacity;\n  transform: translate3d(0, 0, 0);\n  z-index: 10;\n}\n.swiper-pagination.swiper-pagination-hidden {\n  opacity: 0;\n}\n.swiper-pagination-disabled > .swiper-pagination,\n.swiper-pagination.swiper-pagination-disabled {\n  display: none !important;\n}\n/* Common Styles */\n.swiper-pagination-fraction,\n.swiper-pagination-custom,\n.swiper-horizontal > .swiper-pagination-bullets,\n.swiper-pagination-bullets.swiper-pagination-horizontal {\n  bottom: var(--swiper-pagination-bottom, 8px);\n  top: var(--swiper-pagination-top, auto);\n  left: 0;\n  width: 100%;\n}\n/* Bullets */\n.swiper-pagination-bullets-dynamic {\n  overflow: hidden;\n  font-size: 0;\n}\n.swiper-pagination-bullets-dynamic .swiper-pagination-bullet {\n  transform: scale(0.33);\n  position: relative;\n}\n.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active {\n  transform: scale(1);\n}\n.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-main {\n  transform: scale(1);\n}\n.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-prev {\n  transform: scale(0.66);\n}\n.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-prev-prev {\n  transform: scale(0.33);\n}\n.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-next {\n  transform: scale(0.66);\n}\n.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-next-next {\n  transform: scale(0.33);\n}\n.swiper-pagination-bullet {\n  width: var(--swiper-pagination-bullet-width, var(--swiper-pagination-bullet-size, 8px));\n  height: var(--swiper-pagination-bullet-height, var(--swiper-pagination-bullet-size, 8px));\n  display: inline-block;\n  border-radius: var(--swiper-pagination-bullet-border-radius, 50%);\n  background: var(--swiper-pagination-bullet-inactive-color, #000);\n  opacity: var(--swiper-pagination-bullet-inactive-opacity, 0.2);\n}\nbutton.swiper-pagination-bullet {\n  border: none;\n  margin: 0;\n  padding: 0;\n  box-shadow: none;\n  -webkit-appearance: none;\n          -moz-appearance: none;\n       appearance: none;\n}\n.swiper-pagination-clickable .swiper-pagination-bullet {\n  cursor: pointer;\n}\n.swiper-pagination-bullet:only-child {\n  display: none !important;\n}\n.swiper-pagination-bullet-active {\n  opacity: var(--swiper-pagination-bullet-opacity, 1);\n  background: var(--swiper-pagination-color, var(--swiper-theme-color));\n}\n.swiper-vertical > .swiper-pagination-bullets,\n.swiper-pagination-vertical.swiper-pagination-bullets {\n  right: var(--swiper-pagination-right, 8px);\n  left: var(--swiper-pagination-left, auto);\n  top: 50%;\n  transform: translate3d(0px, -50%, 0);\n}\n.swiper-vertical > .swiper-pagination-bullets .swiper-pagination-bullet,\n.swiper-pagination-vertical.swiper-pagination-bullets .swiper-pagination-bullet {\n  margin: var(--swiper-pagination-bullet-vertical-gap, 6px) 0;\n  display: block;\n}\n.swiper-vertical > .swiper-pagination-bullets.swiper-pagination-bullets-dynamic,\n.swiper-pagination-vertical.swiper-pagination-bullets.swiper-pagination-bullets-dynamic {\n  top: 50%;\n  transform: translateY(-50%);\n  width: 8px;\n}\n.swiper-vertical > .swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet,\n.swiper-pagination-vertical.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet {\n  display: inline-block;\n  transition: 200ms transform,\n        200ms top;\n}\n.swiper-horizontal > .swiper-pagination-bullets .swiper-pagination-bullet,\n.swiper-pagination-horizontal.swiper-pagination-bullets .swiper-pagination-bullet {\n  margin: 0 var(--swiper-pagination-bullet-horizontal-gap, 4px);\n}\n.swiper-horizontal > .swiper-pagination-bullets.swiper-pagination-bullets-dynamic,\n.swiper-pagination-horizontal.swiper-pagination-bullets.swiper-pagination-bullets-dynamic {\n  left: 50%;\n  transform: translateX(-50%);\n  white-space: nowrap;\n}\n.swiper-horizontal > .swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet,\n.swiper-pagination-horizontal.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet {\n  transition: 200ms transform,\n        200ms left;\n}\n.swiper-horizontal.swiper-rtl > .swiper-pagination-bullets-dynamic .swiper-pagination-bullet {\n  transition: 200ms transform,\n    200ms right;\n}\n/* Fraction */\n.swiper-pagination-fraction {\n  color: var(--swiper-pagination-fraction-color, inherit);\n}\n/* Progress */\n.swiper-pagination-progressbar {\n  background: var(--swiper-pagination-progressbar-bg-color, rgba(0, 0, 0, 0.25));\n  position: absolute;\n}\n.swiper-pagination-progressbar .swiper-pagination-progressbar-fill {\n  background: var(--swiper-pagination-color, var(--swiper-theme-color));\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  transform: scale(0);\n  transform-origin: left top;\n}\n.swiper-rtl .swiper-pagination-progressbar .swiper-pagination-progressbar-fill {\n  transform-origin: right top;\n}\n.swiper-horizontal > .swiper-pagination-progressbar,\n.swiper-pagination-progressbar.swiper-pagination-horizontal,\n.swiper-vertical > .swiper-pagination-progressbar.swiper-pagination-progressbar-opposite,\n.swiper-pagination-progressbar.swiper-pagination-vertical.swiper-pagination-progressbar-opposite {\n  width: 100%;\n  height: var(--swiper-pagination-progressbar-size, 4px);\n  left: 0;\n  top: 0;\n}\n.swiper-vertical > .swiper-pagination-progressbar,\n.swiper-pagination-progressbar.swiper-pagination-vertical,\n.swiper-horizontal > .swiper-pagination-progressbar.swiper-pagination-progressbar-opposite,\n.swiper-pagination-progressbar.swiper-pagination-horizontal.swiper-pagination-progressbar-opposite {\n  width: var(--swiper-pagination-progressbar-size, 4px);\n  height: 100%;\n  left: 0;\n  top: 0;\n}\n.swiper-pagination-lock {\n  display: none;\n}\n:root {\n  /*\n  --swiper-scrollbar-border-radius: 10px;\n  --swiper-scrollbar-top: auto;\n  --swiper-scrollbar-bottom: 4px;\n  --swiper-scrollbar-left: auto;\n  --swiper-scrollbar-right: 4px;\n  --swiper-scrollbar-sides-offset: 1%;\n  --swiper-scrollbar-bg-color: rgba(0, 0, 0, 0.1);\n  --swiper-scrollbar-drag-bg-color: rgba(0, 0, 0, 0.5);\n  --swiper-scrollbar-size: 4px;\n  */\n}\n.swiper-scrollbar {\n  border-radius: var(--swiper-scrollbar-border-radius, 10px);\n  position: relative;\n  touch-action: none;\n  background: var(--swiper-scrollbar-bg-color, rgba(0, 0, 0, 0.1));\n}\n.swiper-scrollbar-disabled > .swiper-scrollbar,\n.swiper-scrollbar.swiper-scrollbar-disabled {\n  display: none !important;\n}\n.swiper-horizontal > .swiper-scrollbar,\n.swiper-scrollbar.swiper-scrollbar-horizontal {\n  position: absolute;\n  left: var(--swiper-scrollbar-sides-offset, 1%);\n  bottom: var(--swiper-scrollbar-bottom, 4px);\n  top: var(--swiper-scrollbar-top, auto);\n  z-index: 50;\n  height: var(--swiper-scrollbar-size, 4px);\n  width: calc(100% - 2 * var(--swiper-scrollbar-sides-offset, 1%));\n}\n.swiper-vertical > .swiper-scrollbar,\n.swiper-scrollbar.swiper-scrollbar-vertical {\n  position: absolute;\n  left: var(--swiper-scrollbar-left, auto);\n  right: var(--swiper-scrollbar-right, 4px);\n  top: var(--swiper-scrollbar-sides-offset, 1%);\n  z-index: 50;\n  width: var(--swiper-scrollbar-size, 4px);\n  height: calc(100% - 2 * var(--swiper-scrollbar-sides-offset, 1%));\n}\n.swiper-scrollbar-drag {\n  height: 100%;\n  width: 100%;\n  position: relative;\n  background: var(--swiper-scrollbar-drag-bg-color, rgba(0, 0, 0, 0.5));\n  border-radius: var(--swiper-scrollbar-border-radius, 10px);\n  left: 0;\n  top: 0;\n}\n.swiper-scrollbar-cursor-drag {\n  cursor: move;\n}\n.swiper-scrollbar-lock {\n  display: none;\n}\n/* Zoom container styles start */\n.swiper-zoom-container {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  text-align: center;\n}\n.swiper-zoom-container > img,\n.swiper-zoom-container > svg,\n.swiper-zoom-container > canvas {\n  max-width: 100%;\n  max-height: 100%;\n  -o-object-fit: contain;\n     object-fit: contain;\n}\n/* Zoom container styles end */\n.swiper-slide-zoomed {\n  cursor: move;\n  touch-action: none;\n}\n/* a11y */\n.swiper .swiper-notification {\n  position: absolute;\n  left: 0;\n  top: 0;\n  pointer-events: none;\n  opacity: 0;\n  z-index: -1000;\n}\n.swiper-free-mode > .swiper-wrapper {\n  transition-timing-function: ease-out;\n  margin: 0 auto;\n}\n.swiper-grid > .swiper-wrapper {\n  flex-wrap: wrap;\n}\n.swiper-grid-column > .swiper-wrapper {\n  flex-wrap: wrap;\n  flex-direction: column;\n}\n.swiper-fade.swiper-free-mode .swiper-slide {\n  transition-timing-function: ease-out;\n}\n.swiper-fade .swiper-slide {\n  pointer-events: none;\n  transition-property: opacity;\n}\n.swiper-fade .swiper-slide .swiper-slide {\n  pointer-events: none;\n}\n.swiper-fade .swiper-slide-active {\n  pointer-events: auto;\n}\n.swiper-fade .swiper-slide-active .swiper-slide-active {\n  pointer-events: auto;\n}\n.swiper-cube {\n  overflow: visible;\n}\n.swiper-cube .swiper-slide {\n  pointer-events: none;\n  backface-visibility: hidden;\n  z-index: 1;\n  visibility: hidden;\n  transform-origin: 0 0;\n  width: 100%;\n  height: 100%;\n}\n.swiper-cube .swiper-slide .swiper-slide {\n  pointer-events: none;\n}\n.swiper-cube.swiper-rtl .swiper-slide {\n  transform-origin: 100% 0;\n}\n.swiper-cube .swiper-slide-active,\n.swiper-cube .swiper-slide-active .swiper-slide-active {\n  pointer-events: auto;\n}\n.swiper-cube .swiper-slide-active,\n.swiper-cube .swiper-slide-next,\n.swiper-cube .swiper-slide-prev {\n  pointer-events: auto;\n  visibility: visible;\n}\n.swiper-cube .swiper-cube-shadow {\n  position: absolute;\n  left: 0;\n  bottom: 0px;\n  width: 100%;\n  height: 100%;\n  opacity: 0.6;\n  z-index: 0;\n}\n.swiper-cube .swiper-cube-shadow:before {\n  content: '';\n  background: #000;\n  position: absolute;\n  left: 0;\n  top: 0;\n  bottom: 0;\n  right: 0;\n  filter: blur(50px);\n}\n.swiper-cube .swiper-slide-next + .swiper-slide {\n  pointer-events: auto;\n  visibility: visible;\n}\n/* Cube slide shadows start */\n.swiper-cube .swiper-slide-shadow-cube.swiper-slide-shadow-top,\n.swiper-cube .swiper-slide-shadow-cube.swiper-slide-shadow-bottom,\n.swiper-cube .swiper-slide-shadow-cube.swiper-slide-shadow-left,\n.swiper-cube .swiper-slide-shadow-cube.swiper-slide-shadow-right {\n  z-index: 0;\n  backface-visibility: hidden;\n}\n/* Cube slide shadows end */\n.swiper-flip {\n  overflow: visible;\n}\n.swiper-flip .swiper-slide {\n  pointer-events: none;\n  backface-visibility: hidden;\n  z-index: 1;\n}\n.swiper-flip .swiper-slide .swiper-slide {\n  pointer-events: none;\n}\n.swiper-flip .swiper-slide-active,\n.swiper-flip .swiper-slide-active .swiper-slide-active {\n  pointer-events: auto;\n}\n/* Flip slide shadows start */\n.swiper-flip .swiper-slide-shadow-flip.swiper-slide-shadow-top,\n.swiper-flip .swiper-slide-shadow-flip.swiper-slide-shadow-bottom,\n.swiper-flip .swiper-slide-shadow-flip.swiper-slide-shadow-left,\n.swiper-flip .swiper-slide-shadow-flip.swiper-slide-shadow-right {\n  z-index: 0;\n  backface-visibility: hidden;\n}\n/* Flip slide shadows end */\n.swiper-creative .swiper-slide {\n  backface-visibility: hidden;\n  overflow: hidden;\n  transition-property: transform, opacity, height;\n}\n.swiper-cards {\n  overflow: visible;\n}\n.swiper-cards .swiper-slide {\n  transform-origin: center bottom;\n  backface-visibility: hidden;\n  overflow: hidden;\n}\n",""])},PrET:function(t,e,i){"use strict";var r=i("D3zA"),n=i("AM7I"),o=i("0Ake"),s=n("%TypeError%"),a=n("%Function.prototype.apply%"),l=n("%Function.prototype.call%"),c=n("%Reflect.apply%",!0)||r.call(l,a),u=n("%Object.defineProperty%",!0),h=n("%Math.max%");if(u)try{u({},"a",{value:1})}catch(t){u=null}t.exports=function(t){if("function"!=typeof t)throw new s("a function is required");var e=c(r,l,arguments);return o(e,1+h(0,t.length-(arguments.length-1)),!0)};var d=function(){return c(r,a,arguments)};u?u(t.exports,"apply",{value:d}):t.exports.apply=d},QSc6:function(t,e,i){"use strict";var r=i("VAJa"),n=i("0jNN"),o=i("sxOR"),s=Object.prototype.hasOwnProperty,a={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},l=Array.isArray,c=Array.prototype.push,u=function(t,e){c.apply(t,l(e)?e:[e])},h=Date.prototype.toISOString,d=o.default,p={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:n.encode,encodeValuesOnly:!1,format:d,formatter:o.formatters[d],indices:!1,serializeDate:function(t){return h.call(t)},skipNulls:!1,strictNullHandling:!1},f={},m=function t(e,i,o,s,a,c,h,d,m,g,_,y,v,x,b,w){for(var T,E=e,S=w,A=0,M=!1;void 0!==(S=S.get(f))&&!M;){var I=S.get(e);if(A+=1,void 0!==I){if(I===A)throw new RangeError("Cyclic object value");M=!0}void 0===S.get(f)&&(A=0)}if("function"==typeof d?E=d(i,E):E instanceof Date?E=_(E):"comma"===o&&l(E)&&(E=n.maybeMap(E,(function(t){return t instanceof Date?_(t):t}))),null===E){if(a)return h&&!x?h(i,p.encoder,b,"key",y):i;E=""}if("string"==typeof(T=E)||"number"==typeof T||"boolean"==typeof T||"symbol"==typeof T||"bigint"==typeof T||n.isBuffer(E))return h?[v(x?i:h(i,p.encoder,b,"key",y))+"="+v(h(E,p.encoder,b,"value",y))]:[v(i)+"="+v(String(E))];var C,P=[];if(void 0===E)return P;if("comma"===o&&l(E))x&&h&&(E=n.maybeMap(E,h)),C=[{value:E.length>0?E.join(",")||null:void 0}];else if(l(d))C=d;else{var R=Object.keys(E);C=m?R.sort(m):R}for(var O=s&&l(E)&&1===E.length?i+"[]":i,D=0;D<C.length;++D){var L=C[D],k="object"==typeof L&&void 0!==L.value?L.value:E[L];if(!c||null!==k){var B=l(E)?"function"==typeof o?o(O,L):O:O+(g?"."+L:"["+L+"]");w.set(e,A);var F=r();F.set(f,w),u(P,t(k,B,o,s,a,c,"comma"===o&&x&&l(E)?null:h,d,m,g,_,y,v,x,b,F))}}return P};t.exports=function(t,e){var i,n=t,c=function(t){if(!t)return p;if(null!==t.encoder&&void 0!==t.encoder&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||p.charset;if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=o.default;if(void 0!==t.format){if(!s.call(o.formatters,t.format))throw new TypeError("Unknown format option provided.");i=t.format}var r=o.formatters[i],n=p.filter;return("function"==typeof t.filter||l(t.filter))&&(n=t.filter),{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:p.addQueryPrefix,allowDots:void 0===t.allowDots?p.allowDots:!!t.allowDots,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:p.charsetSentinel,delimiter:void 0===t.delimiter?p.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:p.encode,encoder:"function"==typeof t.encoder?t.encoder:p.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:p.encodeValuesOnly,filter:n,format:i,formatter:r,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:p.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:p.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:p.strictNullHandling}}(e);"function"==typeof c.filter?n=(0,c.filter)("",n):l(c.filter)&&(i=c.filter);var h,d=[];if("object"!=typeof n||null===n)return"";h=e&&e.arrayFormat in a?e.arrayFormat:e&&"indices"in e?e.indices?"indices":"repeat":"indices";var f=a[h];if(e&&"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var g="comma"===f&&e&&e.commaRoundTrip;i||(i=Object.keys(n)),c.sort&&i.sort(c.sort);for(var _=r(),y=0;y<i.length;++y){var v=i[y];c.skipNulls&&null===n[v]||u(d,m(n[v],v,f,g,c.strictNullHandling,c.skipNulls,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.format,c.formatter,c.encodeValuesOnly,c.charset,_))}var x=d.join(c.delimiter),b=!0===c.addQueryPrefix?"?":"";return c.charsetSentinel&&("iso-8859-1"===c.charset?b+="utf8=%26%2310003%3B&":b+="utf8=%E2%9C%93&"),x.length>0?b+x:""}},Qyje:function(t,e,i){"use strict";var r=i("QSc6"),n=i("nmq7"),o=i("sxOR");t.exports={formats:o,parse:n,stringify:r}},"Rn+g":function(t,e,i){"use strict";var r=i("LYNF");t.exports=function(t,e,i){var n=i.config.validateStatus;i.status&&n&&!n(i.status)?e(r("Request failed with status code "+i.status,i.config,null,i.request,i)):t(i)}},SgzI:function(t){t.exports=JSON.parse('{"name":"axios","version":"0.21.4","description":"Promise based HTTP client for the browser and node.js","main":"index.js","scripts":{"test":"grunt test","start":"node ./sandbox/server.js","build":"NODE_ENV=production grunt build","preversion":"npm test","version":"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json","postversion":"git push && git push --tags","examples":"node ./examples/server.js","coveralls":"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js","fix":"eslint --fix lib/**/*.js"},"repository":{"type":"git","url":"https://github.com/axios/axios.git"},"keywords":["xhr","http","ajax","promise","node"],"author":"Matt Zabriskie","license":"MIT","bugs":{"url":"https://github.com/axios/axios/issues"},"homepage":"https://axios-http.com","devDependencies":{"coveralls":"^3.0.0","es6-promise":"^4.2.4","grunt":"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1","karma":"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2","minimist":"^1.2.0","mocha":"^8.2.1","sinon":"^4.5.0","terser-webpack-plugin":"^4.2.3","typescript":"^4.0.5","url-search-params":"^0.10.0","webpack":"^4.44.2","webpack-dev-server":"^3.11.0"},"browser":{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},"jsdelivr":"dist/axios.min.js","unpkg":"dist/axios.min.js","typings":"./index.d.ts","dependencies":{"follow-redirects":"^1.14.0"},"bundlesize":[{"path":"./dist/axios.min.js","threshold":"5kB"}]}')},SntB:function(t,e,i){"use strict";var r=i("xTJ+");t.exports=function(t,e){e=e||{};var i={},n=["url","method","data"],o=["headers","auth","proxy","params"],s=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],a=["validateStatus"];function l(t,e){return r.isPlainObject(t)&&r.isPlainObject(e)?r.merge(t,e):r.isPlainObject(e)?r.merge({},e):r.isArray(e)?e.slice():e}function c(n){r.isUndefined(e[n])?r.isUndefined(t[n])||(i[n]=l(void 0,t[n])):i[n]=l(t[n],e[n])}r.forEach(n,(function(t){r.isUndefined(e[t])||(i[t]=l(void 0,e[t]))})),r.forEach(o,c),r.forEach(s,(function(n){r.isUndefined(e[n])?r.isUndefined(t[n])||(i[n]=l(void 0,t[n])):i[n]=l(void 0,e[n])})),r.forEach(a,(function(r){r in e?i[r]=l(t[r],e[r]):r in t&&(i[r]=l(void 0,t[r]))}));var u=n.concat(o).concat(s).concat(a),h=Object.keys(t).concat(Object.keys(e)).filter((function(t){return-1===u.indexOf(t)}));return r.forEach(h,c),i}},URgk:function(t,e,i){(function(t){var r=void 0!==t&&t||"undefined"!=typeof self&&self||window,n=Function.prototype.apply;function o(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new o(n.call(setTimeout,r,arguments),clearTimeout)},e.setInterval=function(){return new o(n.call(setInterval,r,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(r,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout((function(){t._onTimeout&&t._onTimeout()}),e))},i("YBdB"),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,i("yLpj"))},UVaH:function(t,e,i){"use strict";var r="undefined"!=typeof Symbol&&Symbol,n=i("FpZJ");t.exports=function(){return"function"==typeof r&&("function"==typeof Symbol&&("symbol"==typeof r("foo")&&("symbol"==typeof Symbol("bar")&&n())))}},UnBK:function(t,e,i){"use strict";var r=i("xTJ+"),n=i("xAGQ"),o=i("Lmem"),s=i("JEQr");function a(t){t.cancelToken&&t.cancelToken.throwIfRequested()}t.exports=function(t){return a(t),t.headers=t.headers||{},t.data=n.call(t,t.data,t.headers,t.transformRequest),t.headers=r.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),r.forEach(["delete","get","head","post","put","patch","common"],(function(e){delete t.headers[e]})),(t.adapter||s.adapter)(t).then((function(e){return a(t),e.data=n.call(t,e.data,e.headers,t.transformResponse),e}),(function(e){return o(e)||(a(t),e&&e.response&&(e.response.data=n.call(t,e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)}))}},VAJa:function(t,e,i){"use strict";var r=i("AM7I"),n=i("VF6F"),o=i("JxQ3"),s=r("%TypeError%"),a=r("%WeakMap%",!0),l=r("%Map%",!0),c=n("WeakMap.prototype.get",!0),u=n("WeakMap.prototype.set",!0),h=n("WeakMap.prototype.has",!0),d=n("Map.prototype.get",!0),p=n("Map.prototype.set",!0),f=n("Map.prototype.has",!0),m=function(t,e){for(var i,r=t;null!==(i=r.next);r=i)if(i.key===e)return r.next=i.next,i.next=t.next,t.next=i,i};t.exports=function(){var t,e,i,r={assert:function(t){if(!r.has(t))throw new s("Side channel does not contain "+o(t))},get:function(r){if(a&&r&&("object"==typeof r||"function"==typeof r)){if(t)return c(t,r)}else if(l){if(e)return d(e,r)}else if(i)return function(t,e){var i=m(t,e);return i&&i.value}(i,r)},has:function(r){if(a&&r&&("object"==typeof r||"function"==typeof r)){if(t)return h(t,r)}else if(l){if(e)return f(e,r)}else if(i)return function(t,e){return!!m(t,e)}(i,r);return!1},set:function(r,n){a&&r&&("object"==typeof r||"function"==typeof r)?(t||(t=new a),u(t,r,n)):l?(e||(e=new l),p(e,r,n)):(i||(i={key:{},next:null}),function(t,e,i){var r=m(t,e);r?r.value=i:t.next={key:e,next:t.next,value:i}}(i,r,n))}};return r}},VF6F:function(t,e,i){"use strict";var r=i("AM7I"),n=i("PrET"),o=n(r("String.prototype.indexOf"));t.exports=function(t,e){var i=r(t,!!e);return"function"==typeof i&&o(t,".prototype.")>-1?n(i):i}},VmRL:function(t,e,i){"use strict";function r(t,e,i){i=i||2;var r,o,a,l,c,u,p,f=e&&e.length,g=f?e[0]*i:t.length,_=n(t,0,g,i,!0),y=[];if(!_||_.next===_.prev)return y;if(f&&(_=function(t,e,i,r){var o,s,a,l,c,u=[];for(o=0,s=e.length;o<s;o++)a=e[o]*r,l=o<s-1?e[o+1]*r:t.length,(c=n(t,a,l,r,!1))===c.next&&(c.steiner=!0),u.push(m(c));for(u.sort(h),o=0;o<u.length;o++)i=d(u[o],i);return i}(t,e,_,i)),t.length>80*i){r=a=t[0],o=l=t[1];for(var v=i;v<g;v+=i)(c=t[v])<r&&(r=c),(u=t[v+1])<o&&(o=u),c>a&&(a=c),u>l&&(l=u);p=0!==(p=Math.max(a-r,l-o))?32767/p:0}return s(_,y,i,r,o,p,0),y}function n(t,e,i,r,n){var o,s;if(n===I(t,e,i,r)>0)for(o=e;o<i;o+=r)s=S(o,t[o],t[o+1],s);else for(o=i-r;o>=e;o-=r)s=S(o,t[o],t[o+1],s);return s&&v(s,s.next)&&(A(s),s=s.next),s}function o(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!v(r,r.next)&&0!==y(r.prev,r,r.next))r=r.next;else{if(A(r),(r=e=r.prev)===r.next)break;i=!0}}while(i||r!==e);return e}function s(t,e,i,r,n,h,d){if(t){!d&&h&&function(t,e,i,r){var n=t;do{0===n.z&&(n.z=f(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,i,r,n,o,s,a,l,c=1;do{for(i=t,t=null,o=null,s=0;i;){for(s++,r=i,a=0,e=0;e<c&&(a++,r=r.nextZ);e++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,l--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;i=r}o.nextZ=null,c*=2}while(s>1)}(n)}(t,r,n,h);for(var p,m,g=t;t.prev!==t.next;)if(p=t.prev,m=t.next,h?l(t,r,n,h):a(t))e.push(p.i/i|0),e.push(t.i/i|0),e.push(m.i/i|0),A(t),t=m.next,g=m.next;else if((t=m)===g){d?1===d?s(t=c(o(t),e,i),e,i,r,n,h,2):2===d&&u(t,e,i,r,n,h):s(o(t),e,i,r,n,h,1);break}}}function a(t){var e=t.prev,i=t,r=t.next;if(y(e,i,r)>=0)return!1;for(var n=e.x,o=i.x,s=r.x,a=e.y,l=i.y,c=r.y,u=n<o?n<s?n:s:o<s?o:s,h=a<l?a<c?a:c:l<c?l:c,d=n>o?n>s?n:s:o>s?o:s,p=a>l?a>c?a:c:l>c?l:c,f=r.next;f!==e;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&g(n,a,o,l,s,c,f.x,f.y)&&y(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function l(t,e,i,r){var n=t.prev,o=t,s=t.next;if(y(n,o,s)>=0)return!1;for(var a=n.x,l=o.x,c=s.x,u=n.y,h=o.y,d=s.y,p=a<l?a<c?a:c:l<c?l:c,m=u<h?u<d?u:d:h<d?h:d,_=a>l?a>c?a:c:l>c?l:c,v=u>h?u>d?u:d:h>d?h:d,x=f(p,m,e,i,r),b=f(_,v,e,i,r),w=t.prevZ,T=t.nextZ;w&&w.z>=x&&T&&T.z<=b;){if(w.x>=p&&w.x<=_&&w.y>=m&&w.y<=v&&w!==n&&w!==s&&g(a,u,l,h,c,d,w.x,w.y)&&y(w.prev,w,w.next)>=0)return!1;if(w=w.prevZ,T.x>=p&&T.x<=_&&T.y>=m&&T.y<=v&&T!==n&&T!==s&&g(a,u,l,h,c,d,T.x,T.y)&&y(T.prev,T,T.next)>=0)return!1;T=T.nextZ}for(;w&&w.z>=x;){if(w.x>=p&&w.x<=_&&w.y>=m&&w.y<=v&&w!==n&&w!==s&&g(a,u,l,h,c,d,w.x,w.y)&&y(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;T&&T.z<=b;){if(T.x>=p&&T.x<=_&&T.y>=m&&T.y<=v&&T!==n&&T!==s&&g(a,u,l,h,c,d,T.x,T.y)&&y(T.prev,T,T.next)>=0)return!1;T=T.nextZ}return!0}function c(t,e,i){var r=t;do{var n=r.prev,s=r.next.next;!v(n,s)&&x(n,r,r.next,s)&&T(n,s)&&T(s,n)&&(e.push(n.i/i|0),e.push(r.i/i|0),e.push(s.i/i|0),A(r),A(r.next),r=t=s),r=r.next}while(r!==t);return o(r)}function u(t,e,i,r,n,a){var l=t;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&_(l,c)){var u=E(l,c);return l=o(l,l.next),u=o(u,u.next),s(l,e,i,r,n,a,0),void s(u,e,i,r,n,a,0)}c=c.next}l=l.next}while(l!==t)}function h(t,e){return t.x-e.x}function d(t,e){var i=function(t,e){var i,r=e,n=t.x,o=t.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>s&&(s=a,i=r.x<r.next.x?r:r.next,a===n))return i}r=r.next}while(r!==e);if(!i)return null;var l,c=i,u=i.x,h=i.y,d=1/0;r=i;do{n>=r.x&&r.x>=u&&n!==r.x&&g(o<h?n:s,o,u,h,o<h?s:n,o,r.x,r.y)&&(l=Math.abs(o-r.y)/(n-r.x),T(r,t)&&(l<d||l===d&&(r.x>i.x||r.x===i.x&&p(i,r)))&&(i=r,d=l)),r=r.next}while(r!==c);return i}(t,e);if(!i)return e;var r=E(i,t);return o(r,r.next),o(i,i.next)}function p(t,e){return y(t.prev,t,e.prev)<0&&y(e.next,t,t.next)<0}function f(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function m(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function g(t,e,i,r,n,o,s,a){return(n-s)*(e-a)>=(t-s)*(o-a)&&(t-s)*(r-a)>=(i-s)*(e-a)&&(i-s)*(o-a)>=(n-s)*(r-a)}function _(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&x(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(T(t,e)&&T(e,t)&&function(t,e){var i=t,r=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}(t,e)&&(y(t.prev,t,e.prev)||y(t,e.prev,e))||v(t,e)&&y(t.prev,t,t.next)>0&&y(e.prev,e,e.next)>0)}function y(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function v(t,e){return t.x===e.x&&t.y===e.y}function x(t,e,i,r){var n=w(y(t,e,i)),o=w(y(t,e,r)),s=w(y(i,r,t)),a=w(y(i,r,e));return n!==o&&s!==a||(!(0!==n||!b(t,i,e))||(!(0!==o||!b(t,r,e))||(!(0!==s||!b(i,t,r))||!(0!==a||!b(i,e,r)))))}function b(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function w(t){return t>0?1:t<0?-1:0}function T(t,e){return y(t.prev,t,t.next)<0?y(t,e,t.next)>=0&&y(t,t.prev,e)>=0:y(t,e,t.prev)<0||y(t,t.next,e)<0}function E(t,e){var i=new M(t.i,t.x,t.y),r=new M(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function S(t,e,i,r){var n=new M(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function A(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function M(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function I(t,e,i,r){for(var n=0,o=e,s=i-r;o<i;o+=r)n+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return n}t.exports=r,t.exports.default=r,r.deviation=function(t,e,i,r){var n=e&&e.length,o=n?e[0]*i:t.length,s=Math.abs(I(t,0,o,i));if(n)for(var a=0,l=e.length;a<l;a++){var c=e[a]*i,u=a<l-1?e[a+1]*i:t.length;s-=Math.abs(I(t,c,u,i))}var h=0;for(a=0;a<r.length;a+=3){var d=r[a]*i,p=r[a+1]*i,f=r[a+2]*i;h+=Math.abs((t[d]-t[f])*(t[p+1]-t[d+1])-(t[d]-t[p])*(t[f+1]-t[d+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},r.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,n=0;n<t.length;n++){for(var o=0;o<t[n].length;o++)for(var s=0;s<e;s++)i.vertices.push(t[n][o][s]);n>0&&(r+=t[n-1].length,i.holes.push(r))}return i}},XwJu:function(t,e,i){"use strict";t.exports=function(t){return"object"==typeof t&&!0===t.isAxiosError}},YBdB:function(t,e,i){(function(t,e){!function(t,i){"use strict";if(!t.setImmediate){var r,n,o,s,a,l=1,c={},u=!1,h=t.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(t);d=d&&d.setTimeout?d:t,"[object process]"==={}.toString.call(t.process)?r=function(t){e.nextTick((function(){f(t)}))}:!function(){if(t.postMessage&&!t.importScripts){var e=!0,i=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=i,e}}()?t.MessageChannel?((o=new MessageChannel).port1.onmessage=function(t){f(t.data)},r=function(t){o.port2.postMessage(t)}):h&&"onreadystatechange"in h.createElement("script")?(n=h.documentElement,r=function(t){var e=h.createElement("script");e.onreadystatechange=function(){f(t),e.onreadystatechange=null,n.removeChild(e),e=null},n.appendChild(e)}):r=function(t){setTimeout(f,0,t)}:(s="setImmediate$"+Math.random()+"$",a=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(s)&&f(+e.data.slice(s.length))},t.addEventListener?t.addEventListener("message",a,!1):t.attachEvent("onmessage",a),r=function(e){t.postMessage(s+e,"*")}),d.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),i=0;i<e.length;i++)e[i]=arguments[i+1];var n={callback:t,args:e};return c[l]=n,r(l),l++},d.clearImmediate=p}function p(t){delete c[t]}function f(t){if(u)setTimeout(f,0,t);else{var e=c[t];if(e){u=!0;try{!function(t){var e=t.callback,i=t.args;switch(i.length){case 0:e();break;case 1:e(i[0]);break;case 2:e(i[0],i[1]);break;case 3:e(i[0],i[1],i[2]);break;default:e.apply(void 0,i)}}(e)}finally{p(t),u=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,i("yLpj"),i("8oxB"))},YuTi:function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},ZLCw:function(t,e,i){"use strict";var r=i("AM7I")("%Object.defineProperty%",!0),n=function(){if(r)try{return r({},"a",{value:1}),!0}catch(t){return!1}return!1};n.hasArrayLengthDefineBug=function(){if(!n())return null;try{return 1!==r([],"length",{value:1}).length}catch(t){return!0}},t.exports=n},"aET+":function(t,e,i){var r,n,o={},s=(r=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===n&&(n=r.apply(this,arguments)),n}),a=function(t,e){return e?e.querySelector(t):document.querySelector(t)},l=function(t){var e={};return function(t,i){if("function"==typeof t)return t();if(void 0===e[t]){var r=a.call(this,t,i);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(t){r=null}e[t]=r}return e[t]}}(),c=null,u=0,h=[],d=i("9tPo");function p(t,e){for(var i=0;i<t.length;i++){var r=t[i],n=o[r.id];if(n){n.refs++;for(var s=0;s<n.parts.length;s++)n.parts[s](r.parts[s]);for(;s<r.parts.length;s++)n.parts.push(v(r.parts[s],e))}else{var a=[];for(s=0;s<r.parts.length;s++)a.push(v(r.parts[s],e));o[r.id]={id:r.id,refs:1,parts:a}}}}function f(t,e){for(var i=[],r={},n=0;n<t.length;n++){var o=t[n],s=e.base?o[0]+e.base:o[0],a={css:o[1],media:o[2],sourceMap:o[3]};r[s]?r[s].parts.push(a):i.push(r[s]={id:s,parts:[a]})}return i}function m(t,e){var i=l(t.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=h[h.length-1];if("top"===t.insertAt)r?r.nextSibling?i.insertBefore(e,r.nextSibling):i.appendChild(e):i.insertBefore(e,i.firstChild),h.push(e);else if("bottom"===t.insertAt)i.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var n=l(t.insertAt.before,i);i.insertBefore(e,n)}}function g(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=h.indexOf(t);e>=0&&h.splice(e,1)}function _(t){var e=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var r=function(){0;return i.nc}();r&&(t.attrs.nonce=r)}return y(e,t.attrs),m(t,e),e}function y(t,e){Object.keys(e).forEach((function(i){t.setAttribute(i,e[i])}))}function v(t,e){var i,r,n,o;if(e.transform&&t.css){if(!(o="function"==typeof e.transform?e.transform(t.css):e.transform.default(t.css)))return function(){};t.css=o}if(e.singleton){var s=u++;i=c||(c=_(e)),r=w.bind(null,i,s,!1),n=w.bind(null,i,s,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",y(e,t.attrs),m(t,e),e}(e),r=E.bind(null,i,e),n=function(){g(i),i.href&&URL.revokeObjectURL(i.href)}):(i=_(e),r=T.bind(null,i),n=function(){g(i)});return r(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;r(t=e)}else n()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=s()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var i=f(t,e);return p(i,e),function(t){for(var r=[],n=0;n<i.length;n++){var s=i[n];(a=o[s.id]).refs--,r.push(a)}t&&p(f(t,e),e);for(n=0;n<r.length;n++){var a;if(0===(a=r[n]).refs){for(var l=0;l<a.parts.length;l++)a.parts[l]();delete o[a.id]}}}};var x,b=(x=[],function(t,e){return x[t]=e,x.filter(Boolean).join("\n")});function w(t,e,i,r){var n=i?"":r.css;if(t.styleSheet)t.styleSheet.cssText=b(e,n);else{var o=document.createTextNode(n),s=t.childNodes;s[e]&&t.removeChild(s[e]),s.length?t.insertBefore(o,s[e]):t.appendChild(o)}}function T(t,e){var i=e.css,r=e.media;if(r&&t.setAttribute("media",r),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}function E(t,e,i){var r=i.css,n=i.sourceMap,o=void 0===e.convertToAbsoluteUrls&&n;(e.convertToAbsoluteUrls||o)&&(r=d(r)),n&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */");var s=new Blob([r],{type:"text/css"}),a=t.href;t.href=URL.createObjectURL(s),a&&URL.revokeObjectURL(a)}},aI7X:function(t,e,i){"use strict";var r="Function.prototype.bind called on incompatible ",n=Object.prototype.toString,o=Math.max,s=function(t,e){for(var i=[],r=0;r<t.length;r+=1)i[r]=t[r];for(var n=0;n<e.length;n+=1)i[n+t.length]=e[n];return i},a=function(t,e){for(var i=[],r=e||0,n=0;r<t.length;r+=1,n+=1)i[n]=t[r];return i},l=function(t,e){for(var i="",r=0;r<t.length;r+=1)i+=t[r],r+1<t.length&&(i+=e);return i};t.exports=function(t){var e=this;if("function"!=typeof e||"[object Function]"!==n.apply(e))throw new TypeError(r+e);for(var i,c=a(arguments,1),u=function(){if(this instanceof i){var r=e.apply(this,s(c,arguments));return Object(r)===r?r:this}return e.apply(t,s(c,arguments))},h=o(0,e.length-c.length),d=[],p=0;p<h;p++)d[p]="$"+p;if(i=Function("binder","return function ("+l(d,",")+"){ return binder.apply(this,arguments); }")(u),e.prototype){var f=function(){};f.prototype=e.prototype,i.prototype=new f,f.prototype=null}return i}},dlst:function(t,e){},eZIG:function(t,e,i){"use strict";var r=i("ZLCw")(),n=i("AM7I"),o=r&&n("%Object.defineProperty%",!0);if(o)try{o({},"a",{value:1})}catch(t){o=!1}var s=n("%SyntaxError%"),a=n("%TypeError%"),l=i("Kqna");t.exports=function(t,e,i){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new a("`obj` must be an object or a function`");if("string"!=typeof e&&"symbol"!=typeof e)throw new a("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new a("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new a("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new a("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new a("`loose`, if provided, must be a boolean");var r=arguments.length>3?arguments[3]:null,n=arguments.length>4?arguments[4]:null,c=arguments.length>5?arguments[5]:null,u=arguments.length>6&&arguments[6],h=!!l&&l(t,e);if(o)o(t,e,{configurable:null===c&&h?h.configurable:!c,enumerable:null===r&&h?h.enumerable:!r,value:i,writable:null===n&&h?h.writable:!n});else{if(!u&&(r||n||c))throw new s("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");t[e]=i}}},endd:function(t,e,i){"use strict";function r(t){this.message=t}r.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},r.prototype.__CANCEL__=!0,t.exports=r},eqyj:function(t,e,i){"use strict";var r=i("xTJ+");t.exports=r.isStandardBrowserEnv()?{write:function(t,e,i,n,o,s){var a=[];a.push(t+"="+encodeURIComponent(e)),r.isNumber(i)&&a.push("expires="+new Date(i).toGMTString()),r.isString(n)&&a.push("path="+n),r.isString(o)&&a.push("domain="+o),!0===s&&a.push("secure"),document.cookie=a.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},g7np:function(t,e,i){"use strict";var r=i("2SVd"),n=i("5oMp");t.exports=function(t,e){return t&&!r(e)?n(t,e):e}},hIuj:function(t,e,i){"use strict";var r=i("SgzI"),n={};["object","boolean","number","function","string","symbol"].forEach((function(t,e){n[t]=function(i){return typeof i===t||"a"+(e<1?"n ":" ")+t}}));var o={},s=r.version.split(".");function a(t,e){for(var i=e?e.split("."):s,r=t.split("."),n=0;n<3;n++){if(i[n]>r[n])return!0;if(i[n]<r[n])return!1}return!1}n.transitional=function(t,e,i){var n=e&&a(e);function s(t,e){return"[Axios v"+r.version+"] Transitional option '"+t+"'"+e+(i?". "+i:"")}return function(i,r,a){if(!1===t)throw new Error(s(r," has been removed in "+e));return n&&!o[r]&&(o[r]=!0,console.warn(s(r," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(i,r,a)}},t.exports={isOlderVersion:a,assertOptions:function(t,e,i){if("object"!=typeof t)throw new TypeError("options must be an object");for(var r=Object.keys(t),n=r.length;n-- >0;){var o=r[n],s=e[o];if(s){var a=t[o],l=void 0===a||s(a,o,t);if(!0!==l)throw new TypeError("option "+o+" must be "+l)}else if(!0!==i)throw Error("Unknown option "+o)}},validators:n}},"jfS+":function(t,e,i){"use strict";var r=i("endd");function n(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var e;this.promise=new Promise((function(t){e=t}));var i=this;t((function(t){i.reason||(i.reason=new r(t),e(i.reason))}))}n.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},n.source=function(){var t;return{token:new n((function(e){t=e})),cancel:t}},t.exports=n},lLqN:function(t,e,i){"use strict";var r,n={DEBUG:!1,LIB_VERSION:"2.48.1"};if("undefined"==typeof window){var o={hostname:""};r={navigator:{userAgent:""},document:{location:o,referrer:""},screen:{width:0,height:0},location:o}}else r=window;var s,a,l,c,u,h,d,p,f,m,g,_=Array.prototype,y=Function.prototype,v=Object.prototype,x=_.slice,b=v.toString,w=v.hasOwnProperty,T=r.console,E=r.navigator,S=r.document,A=r.opera,M=r.screen,I=E.userAgent,C=y.bind,P=_.forEach,R=_.indexOf,O=_.map,D=Array.isArray,L={},k={trim:function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},B={log:function(){if(n.DEBUG&&!k.isUndefined(T)&&T)try{T.log.apply(T,arguments)}catch(t){k.each(arguments,(function(t){T.log(t)}))}},warn:function(){if(n.DEBUG&&!k.isUndefined(T)&&T){var t=["Mixpanel warning:"].concat(k.toArray(arguments));try{T.warn.apply(T,t)}catch(e){k.each(t,(function(t){T.warn(t)}))}}},error:function(){if(n.DEBUG&&!k.isUndefined(T)&&T){var t=["Mixpanel error:"].concat(k.toArray(arguments));try{T.error.apply(T,t)}catch(e){k.each(t,(function(t){T.error(t)}))}}},critical:function(){if(!k.isUndefined(T)&&T){var t=["Mixpanel error:"].concat(k.toArray(arguments));try{T.error.apply(T,t)}catch(e){k.each(t,(function(t){T.error(t)}))}}}},F=function(t,e){return function(){return arguments[0]="["+e+"] "+arguments[0],t.apply(B,arguments)}},z=function(t){return{log:F(B.log,t),error:F(B.error,t),critical:F(B.critical,t)}};k.bind=function(t,e){var i,r;if(C&&t.bind===C)return C.apply(t,x.call(arguments,1));if(!k.isFunction(t))throw new TypeError;return i=x.call(arguments,2),r=function(){if(!(this instanceof r))return t.apply(e,i.concat(x.call(arguments)));var n={};n.prototype=t.prototype;var o=new n;n.prototype=null;var s=t.apply(o,i.concat(x.call(arguments)));return Object(s)===s?s:o}},k.each=function(t,e,i){if(null!=t)if(P&&t.forEach===P)t.forEach(e,i);else if(t.length===+t.length){for(var r=0,n=t.length;r<n;r++)if(r in t&&e.call(i,t[r],r,t)===L)return}else for(var o in t)if(w.call(t,o)&&e.call(i,t[o],o,t)===L)return},k.extend=function(t){return k.each(x.call(arguments,1),(function(e){for(var i in e)void 0!==e[i]&&(t[i]=e[i])})),t},k.isArray=D||function(t){return"[object Array]"===b.call(t)},k.isFunction=function(t){try{return/^\s*\bfunction\b/.test(t)}catch(t){return!1}},k.isArguments=function(t){return!(!t||!w.call(t,"callee"))},k.toArray=function(t){return t?t.toArray?t.toArray():k.isArray(t)||k.isArguments(t)?x.call(t):k.values(t):[]},k.map=function(t,e,i){if(O&&t.map===O)return t.map(e,i);var r=[];return k.each(t,(function(t){r.push(e.call(i,t))})),r},k.keys=function(t){var e=[];return null===t||k.each(t,(function(t,i){e[e.length]=i})),e},k.values=function(t){var e=[];return null===t||k.each(t,(function(t){e[e.length]=t})),e},k.include=function(t,e){var i=!1;return null===t?i:R&&t.indexOf===R?-1!=t.indexOf(e):(k.each(t,(function(t){if(i||(i=t===e))return L})),i)},k.includes=function(t,e){return-1!==t.indexOf(e)},k.inherit=function(t,e){return t.prototype=new e,t.prototype.constructor=t,t.superclass=e.prototype,t},k.isObject=function(t){return t===Object(t)&&!k.isArray(t)},k.isEmptyObject=function(t){if(k.isObject(t)){for(var e in t)if(w.call(t,e))return!1;return!0}return!1},k.isUndefined=function(t){return void 0===t},k.isString=function(t){return"[object String]"==b.call(t)},k.isDate=function(t){return"[object Date]"==b.call(t)},k.isNumber=function(t){return"[object Number]"==b.call(t)},k.isElement=function(t){return!(!t||1!==t.nodeType)},k.encodeDates=function(t){return k.each(t,(function(e,i){k.isDate(e)?t[i]=k.formatDate(e):k.isObject(e)&&(t[i]=k.encodeDates(e))})),t},k.timestamp=function(){return Date.now=Date.now||function(){return+new Date},Date.now()},k.formatDate=function(t){function e(t){return t<10?"0"+t:t}return t.getUTCFullYear()+"-"+e(t.getUTCMonth()+1)+"-"+e(t.getUTCDate())+"T"+e(t.getUTCHours())+":"+e(t.getUTCMinutes())+":"+e(t.getUTCSeconds())},k.strip_empty_properties=function(t){var e={};return k.each(t,(function(t,i){k.isString(t)&&t.length>0&&(e[i]=t)})),e},k.truncate=function(t,e){var i;return"string"==typeof t?i=t.slice(0,e):k.isArray(t)?(i=[],k.each(t,(function(t){i.push(k.truncate(t,e))}))):k.isObject(t)?(i={},k.each(t,(function(t,r){i[r]=k.truncate(t,e)}))):i=t,i},k.JSONEncode=function(t){var e=function(t){var e=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,i={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return e.lastIndex=0,e.test(t)?'"'+t.replace(e,(function(t){var e=i[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)}))+'"':'"'+t+'"'},i=function(t,r){var n="",o=0,s="",a="",l=0,c=n,u=[],h=r[t];switch(h&&"object"==typeof h&&"function"==typeof h.toJSON&&(h=h.toJSON(t)),typeof h){case"string":return e(h);case"number":return isFinite(h)?String(h):"null";case"boolean":case"null":return String(h);case"object":if(!h)return"null";if(n+="    ",u=[],"[object Array]"===b.apply(h)){for(l=h.length,o=0;o<l;o+=1)u[o]=i(o,h)||"null";return a=0===u.length?"[]":n?"[\n"+n+u.join(",\n"+n)+"\n"+c+"]":"["+u.join(",")+"]",n=c,a}for(s in h)w.call(h,s)&&(a=i(s,h))&&u.push(e(s)+(n?": ":":")+a);return a=0===u.length?"{}":n?"{"+u.join(",")+c+"}":"{"+u.join(",")+"}",n=c,a}};return i("",{"":t})},k.JSONDecode=(u={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},h=function(t){var e=new SyntaxError(t);throw e.at=s,e.text=l,e},d=function(t){return t&&t!==a&&h("Expected '"+t+"' instead of '"+a+"'"),a=l.charAt(s),s+=1,a},p=function(){var t,e="";for("-"===a&&(e="-",d("-"));a>="0"&&a<="9";)e+=a,d();if("."===a)for(e+=".";d()&&a>="0"&&a<="9";)e+=a;if("e"===a||"E"===a)for(e+=a,d(),"-"!==a&&"+"!==a||(e+=a,d());a>="0"&&a<="9";)e+=a,d();if(t=+e,isFinite(t))return t;h("Bad number")},f=function(){var t,e,i,r="";if('"'===a)for(;d();){if('"'===a)return d(),r;if("\\"===a)if(d(),"u"===a){for(i=0,e=0;e<4&&(t=parseInt(d(),16),isFinite(t));e+=1)i=16*i+t;r+=String.fromCharCode(i)}else{if("string"!=typeof u[a])break;r+=u[a]}else r+=a}h("Bad string")},m=function(){for(;a&&a<=" ";)d()},c=function(){switch(m(),a){case"{":return function(){var t,e={};if("{"===a){if(d("{"),m(),"}"===a)return d("}"),e;for(;a;){if(t=f(),m(),d(":"),Object.hasOwnProperty.call(e,t)&&h('Duplicate key "'+t+'"'),e[t]=c(),m(),"}"===a)return d("}"),e;d(","),m()}}h("Bad object")}();case"[":return function(){var t=[];if("["===a){if(d("["),m(),"]"===a)return d("]"),t;for(;a;){if(t.push(c()),m(),"]"===a)return d("]"),t;d(","),m()}}h("Bad array")}();case'"':return f();case"-":return p();default:return a>="0"&&a<="9"?p():function(){switch(a){case"t":return d("t"),d("r"),d("u"),d("e"),!0;case"f":return d("f"),d("a"),d("l"),d("s"),d("e"),!1;case"n":return d("n"),d("u"),d("l"),d("l"),null}h('Unexpected "'+a+'"')}()}},function(t){var e;return l=t,s=0,a=" ",e=c(),m(),a&&h("Syntax error"),e}),k.base64Encode=function(t){var e,i,r,n,o,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a=0,l=0,c="",u=[];if(!t)return t;t=k.utf8Encode(t);do{e=(o=t.charCodeAt(a++)<<16|t.charCodeAt(a++)<<8|t.charCodeAt(a++))>>18&63,i=o>>12&63,r=o>>6&63,n=63&o,u[l++]=s.charAt(e)+s.charAt(i)+s.charAt(r)+s.charAt(n)}while(a<t.length);switch(c=u.join(""),t.length%3){case 1:c=c.slice(0,-2)+"==";break;case 2:c=c.slice(0,-1)+"="}return c},k.utf8Encode=function(t){var e,i,r,n,o="";for(e=i=0,r=(t=(t+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n")).length,n=0;n<r;n++){var s=t.charCodeAt(n),a=null;s<128?i++:a=s>127&&s<2048?String.fromCharCode(s>>6|192,63&s|128):String.fromCharCode(s>>12|224,s>>6&63|128,63&s|128),null!==a&&(i>e&&(o+=t.substring(e,i)),o+=a,e=i=n+1)}return i>e&&(o+=t.substring(e,t.length)),o},k.UUID=(g=function(){var t,e=1*new Date;if(r.performance&&r.performance.now)t=r.performance.now();else for(t=0;e==1*new Date;)t++;return e.toString(16)+Math.floor(t).toString(16)},function(){var t=(M.height*M.width).toString(16);return g()+"-"+Math.random().toString(16).replace(".","")+"-"+function(){var t,e,i=I,r=[],n=0;function o(t,e){var i,n=0;for(i=0;i<e.length;i++)n|=r[i]<<8*i;return t^n}for(t=0;t<i.length;t++)e=i.charCodeAt(t),r.unshift(255&e),r.length>=4&&(n=o(n,r),r=[]);return r.length>0&&(n=o(n,r)),n.toString(16)}()+"-"+t+"-"+g()});var N=["ahrefsbot","baiduspider","bingbot","bingpreview","chrome-lighthouse","facebookexternal","petalbot","pinterest","screaming frog","yahoo! slurp","yandexbot","adsbot-google","apis-google","duplexweb-google","feedfetcher-google","google favicon","google web preview","google-read-aloud","googlebot","googleweblight","mediapartners-google","storebot-google"];k.isBlockedUA=function(t){var e;for(t=t.toLowerCase(),e=0;e<N.length;e++)if(-1!==t.indexOf(N[e]))return!0;return!1},k.HTTPBuildQuery=function(t,e){var i,r,n=[];return k.isUndefined(e)&&(e="&"),k.each(t,(function(t,e){i=encodeURIComponent(t.toString()),r=encodeURIComponent(e),n[n.length]=r+"="+i})),n.join(e)},k.getQueryParam=function(t,e){e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);if(null===i||i&&"string"!=typeof i[1]&&i[1].length)return"";var r=i[1];try{r=decodeURIComponent(r)}catch(t){B.error("Skipping decoding for malformed query param: "+r)}return r.replace(/\+/g," ")},k.cookie={get:function(t){for(var e=t+"=",i=S.cookie.split(";"),r=0;r<i.length;r++){for(var n=i[r];" "==n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(e))return decodeURIComponent(n.substring(e.length,n.length))}return null},parse:function(t){var e;try{e=k.JSONDecode(k.cookie.get(t))||{}}catch(t){}return e},set_seconds:function(t,e,i,r,n,o,s){var a="",l="",c="";if(s)a="; domain="+s;else if(r){var u=$(S.location.hostname);a=u?"; domain=."+u:""}if(i){var h=new Date;h.setTime(h.getTime()+1e3*i),l="; expires="+h.toGMTString()}o&&(n=!0,c="; SameSite=None"),n&&(c+="; secure"),S.cookie=t+"="+encodeURIComponent(e)+l+"; path=/"+a+c},set:function(t,e,i,r,n,o,s){var a="",l="",c="";if(s)a="; domain="+s;else if(r){var u=$(S.location.hostname);a=u?"; domain=."+u:""}if(i){var h=new Date;h.setTime(h.getTime()+24*i*60*60*1e3),l="; expires="+h.toGMTString()}o&&(n=!0,c="; SameSite=None"),n&&(c+="; secure");var d=t+"="+encodeURIComponent(e)+l+"; path=/"+a+c;return S.cookie=d,d},remove:function(t,e,i){k.cookie.set(t,"",-1,e,!1,!1,i)}};var U=null,G=function(t,e){if(null!==U&&!e)return U;var i=!0;try{t=t||window.localStorage;var r="__mplss_"+H(8);t.setItem(r,"xyz"),"xyz"!==t.getItem(r)&&(i=!1),t.removeItem(r)}catch(t){i=!1}return U=i,i};k.localStorage={is_supported:function(t){var e=G(null,t);return e||B.error("localStorage unsupported; falling back to cookie store"),e},error:function(t){B.error("localStorage error: "+t)},get:function(t){try{return window.localStorage.getItem(t)}catch(t){k.localStorage.error(t)}return null},parse:function(t){try{return k.JSONDecode(k.localStorage.get(t))||{}}catch(t){}return null},set:function(t,e){try{window.localStorage.setItem(t,e)}catch(t){k.localStorage.error(t)}},remove:function(t){try{window.localStorage.removeItem(t)}catch(t){k.localStorage.error(t)}}},k.register_event=function(){function t(e){return e&&(e.preventDefault=t.preventDefault,e.stopPropagation=t.stopPropagation),e}return t.preventDefault=function(){this.returnValue=!1},t.stopPropagation=function(){this.cancelBubble=!0},function(e,i,r,n,o){if(e)if(e.addEventListener&&!n)e.addEventListener(i,r,!!o);else{var s="on"+i,a=e[s];e[s]=function(e,i,r){return function(n){if(n=n||t(window.event)){var o,s,a=!0;return k.isFunction(r)&&(o=r(n)),s=i.call(e,n),!1!==o&&!1!==s||(a=!1),a}}}(e,r,a)}else B.error("No valid element provided to register_event")}}();var j=new RegExp('^(\\w*)\\[(\\w+)([=~\\|\\^\\$\\*]?)=?"?([^\\]"]*)"?\\]$');k.dom_query=function(){function t(t){return t.all?t.all:t.getElementsByTagName("*")}var e=/[\t\r\n]/g;function i(t,i){var r=" "+i+" ";return(" "+t.className+" ").replace(e," ").indexOf(r)>=0}function r(e){if(!S.getElementsByTagName)return[];var r,n,o,s,a,l,c,u,h,d,p=e.split(" "),f=[S];for(l=0;l<p.length;l++)if((r=p[l].replace(/^\s+/,"").replace(/\s+$/,"")).indexOf("#")>-1){o=(n=r.split("#"))[0];var m=n[1],g=S.getElementById(m);if(!g||o&&g.nodeName.toLowerCase()!=o)return[];f=[g]}else if(r.indexOf(".")>-1){o=(n=r.split("."))[0];var _=n[1];for(o||(o="*"),s=[],a=0,c=0;c<f.length;c++)for(h="*"==o?t(f[c]):f[c].getElementsByTagName(o),u=0;u<h.length;u++)s[a++]=h[u];for(f=[],d=0,c=0;c<s.length;c++)s[c].className&&k.isString(s[c].className)&&i(s[c],_)&&(f[d++]=s[c])}else{var y=r.match(j);if(y){o=y[1];var v,x=y[2],b=y[3],w=y[4];for(o||(o="*"),s=[],a=0,c=0;c<f.length;c++)for(h="*"==o?t(f[c]):f[c].getElementsByTagName(o),u=0;u<h.length;u++)s[a++]=h[u];switch(f=[],d=0,b){case"=":v=function(t){return t.getAttribute(x)==w};break;case"~":v=function(t){return t.getAttribute(x).match(new RegExp("\\b"+w+"\\b"))};break;case"|":v=function(t){return t.getAttribute(x).match(new RegExp("^"+w+"-?"))};break;case"^":v=function(t){return 0===t.getAttribute(x).indexOf(w)};break;case"$":v=function(t){return t.getAttribute(x).lastIndexOf(w)==t.getAttribute(x).length-w.length};break;case"*":v=function(t){return t.getAttribute(x).indexOf(w)>-1};break;default:v=function(t){return t.getAttribute(x)}}for(f=[],d=0,c=0;c<s.length;c++)v(s[c])&&(f[d++]=s[c])}else{for(o=r,s=[],a=0,c=0;c<f.length;c++)for(h=f[c].getElementsByTagName(o),u=0;u<h.length;u++)s[a++]=h[u];f=s}}return f}return function(t){return k.isElement(t)?[t]:k.isObject(t)&&!k.isUndefined(t.length)?t:r.call(this,t)}}();var V=["utm_source","utm_medium","utm_campaign","utm_content","utm_term"],X=["dclid","fbclid","gclid","ko_click_id","li_fat_id","msclkid","ttclid","twclid","wbraid"];k.info={campaignParams:function(t){var e="",i={};return k.each(V,(function(r){(e=k.getQueryParam(S.URL,r)).length?i[r]=e:void 0!==t&&(i[r]=t)})),i},clickParams:function(){var t="",e={};return k.each(X,(function(i){(t=k.getQueryParam(S.URL,i)).length&&(e[i]=t)})),e},marketingParams:function(){return k.extend(k.info.campaignParams(),k.info.clickParams())},searchEngine:function(t){return 0===t.search("https?://(.*)google.([^/?]*)")?"google":0===t.search("https?://(.*)bing.com")?"bing":0===t.search("https?://(.*)yahoo.com")?"yahoo":0===t.search("https?://(.*)duckduckgo.com")?"duckduckgo":null},searchInfo:function(t){var e=k.info.searchEngine(t),i="yahoo"!=e?"q":"p",r={};if(null!==e){r.$search_engine=e;var n=k.getQueryParam(t,i);n.length&&(r.mp_keyword=n)}return r},browser:function(t,e,i){return e=e||"",i||k.includes(t," OPR/")?k.includes(t,"Mini")?"Opera Mini":"Opera":/(BlackBerry|PlayBook|BB10)/i.test(t)?"BlackBerry":k.includes(t,"IEMobile")||k.includes(t,"WPDesktop")?"Internet Explorer Mobile":k.includes(t,"SamsungBrowser/")?"Samsung Internet":k.includes(t,"Edge")||k.includes(t,"Edg/")?"Microsoft Edge":k.includes(t,"FBIOS")?"Facebook Mobile":k.includes(t,"Chrome")?"Chrome":k.includes(t,"CriOS")?"Chrome iOS":k.includes(t,"UCWEB")||k.includes(t,"UCBrowser")?"UC Browser":k.includes(t,"FxiOS")?"Firefox iOS":k.includes(e,"Apple")?k.includes(t,"Mobile")?"Mobile Safari":"Safari":k.includes(t,"Android")?"Android Mobile":k.includes(t,"Konqueror")?"Konqueror":k.includes(t,"Firefox")?"Firefox":k.includes(t,"MSIE")||k.includes(t,"Trident/")?"Internet Explorer":k.includes(t,"Gecko")?"Mozilla":""},browserVersion:function(t,e,i){var r={"Internet Explorer Mobile":/rv:(\d+(\.\d+)?)/,"Microsoft Edge":/Edge?\/(\d+(\.\d+)?)/,Chrome:/Chrome\/(\d+(\.\d+)?)/,"Chrome iOS":/CriOS\/(\d+(\.\d+)?)/,"UC Browser":/(UCBrowser|UCWEB)\/(\d+(\.\d+)?)/,Safari:/Version\/(\d+(\.\d+)?)/,"Mobile Safari":/Version\/(\d+(\.\d+)?)/,Opera:/(Opera|OPR)\/(\d+(\.\d+)?)/,Firefox:/Firefox\/(\d+(\.\d+)?)/,"Firefox iOS":/FxiOS\/(\d+(\.\d+)?)/,Konqueror:/Konqueror:(\d+(\.\d+)?)/,BlackBerry:/BlackBerry (\d+(\.\d+)?)/,"Android Mobile":/android\s(\d+(\.\d+)?)/,"Samsung Internet":/SamsungBrowser\/(\d+(\.\d+)?)/,"Internet Explorer":/(rv:|MSIE )(\d+(\.\d+)?)/,Mozilla:/rv:(\d+(\.\d+)?)/}[k.info.browser(t,e,i)];if(void 0===r)return null;var n=t.match(r);return n?parseFloat(n[n.length-2]):null},os:function(){var t=I;return/Windows/i.test(t)?/Phone/.test(t)||/WPDesktop/.test(t)?"Windows Phone":"Windows":/(iPhone|iPad|iPod)/.test(t)?"iOS":/Android/.test(t)?"Android":/(BlackBerry|PlayBook|BB10)/i.test(t)?"BlackBerry":/Mac/i.test(t)?"Mac OS X":/Linux/.test(t)?"Linux":/CrOS/.test(t)?"Chrome OS":""},device:function(t){return/Windows Phone/i.test(t)||/WPDesktop/.test(t)?"Windows Phone":/iPad/.test(t)?"iPad":/iPod/.test(t)?"iPod Touch":/iPhone/.test(t)?"iPhone":/(BlackBerry|PlayBook|BB10)/i.test(t)?"BlackBerry":/Android/.test(t)?"Android":""},referringDomain:function(t){var e=t.split("/");return e.length>=3?e[2]:""},properties:function(){return k.extend(k.strip_empty_properties({$os:k.info.os(),$browser:k.info.browser(I,E.vendor,A),$referrer:S.referrer,$referring_domain:k.info.referringDomain(S.referrer),$device:k.info.device(I)}),{$current_url:r.location.href,$browser_version:k.info.browserVersion(I,E.vendor,A),$screen_height:M.height,$screen_width:M.width,mp_lib:"web",$lib_version:n.LIB_VERSION,$insert_id:H(),time:k.timestamp()/1e3})},people_properties:function(){return k.extend(k.strip_empty_properties({$os:k.info.os(),$browser:k.info.browser(I,E.vendor,A)}),{$browser_version:k.info.browserVersion(I,E.vendor,A)})},mpPageViewProperties:function(){return k.strip_empty_properties({current_page_title:S.title,current_domain:r.location.hostname,current_url_path:r.location.pathname,current_url_protocol:r.location.protocol,current_url_search:r.location.search})}};var H=function(t){var e=Math.random().toString(36).substring(2,10)+Math.random().toString(36).substring(2,10);return t?e.substring(0,t):e},q=/[a-z0-9][a-z0-9-]*\.[a-z]+$/i,W=/[a-z0-9][a-z0-9-]+\.[a-z.]{2,6}$/i,$=function(t){var e=W,i=t.split("."),r=i[i.length-1];(r.length>4||"com"===r||"org"===r)&&(e=q);var n=t.match(e);return n?n[0]:""},Y=null,Z=null;"undefined"!=typeof JSON&&(Y=JSON.stringify,Z=JSON.parse),Y=Y||k.JSONEncode,Z=Z||k.JSONDecode,k.toArray=k.toArray,k.isObject=k.isObject,k.JSONEncode=k.JSONEncode,k.JSONDecode=k.JSONDecode,k.isBlockedUA=k.isBlockedUA,k.isEmptyObject=k.isEmptyObject,k.info=k.info,k.info.device=k.info.device,k.info.browser=k.info.browser,k.info.browserVersion=k.info.browserVersion,k.info.properties=k.info.properties;var K=function(){};K.prototype.create_properties=function(){},K.prototype.event_handler=function(){},K.prototype.after_track_handler=function(){},K.prototype.init=function(t){return this.mp=t,this},K.prototype.track=function(t,e,i,r){var n=this,o=k.dom_query(t);if(0!==o.length)return k.each(o,(function(t){k.register_event(t,this.override_event,(function(t){var o={},s=n.create_properties(i,this),a=n.mp.get_config("track_links_timeout");n.event_handler(t,this,o),window.setTimeout(n.track_callback(r,s,o,!0),a),n.mp.track(e,s,n.track_callback(r,s,o))}))}),this),!0;B.error("The DOM query ("+t+") returned 0 elements")},K.prototype.track_callback=function(t,e,i,r){r=r||!1;var n=this;return function(){i.callback_fired||(i.callback_fired=!0,t&&!1===t(r,e)||n.after_track_handler(e,i,r))}},K.prototype.create_properties=function(t,e){return"function"==typeof t?t(e):k.extend({},t)};var J=function(){this.override_event="click"};k.inherit(J,K),J.prototype.create_properties=function(t,e){var i=J.superclass.create_properties.apply(this,arguments);return e.href&&(i.url=e.href),i},J.prototype.event_handler=function(t,e,i){i.new_tab=2===t.which||t.metaKey||t.ctrlKey||"_blank"===e.target,i.href=e.href,i.new_tab||t.preventDefault()},J.prototype.after_track_handler=function(t,e){e.new_tab||setTimeout((function(){window.location=e.href}),0)};var Q=function(){this.override_event="submit"};k.inherit(Q,K),Q.prototype.event_handler=function(t,e,i){i.element=e,t.preventDefault()},Q.prototype.after_track_handler=function(t,e){setTimeout((function(){e.element.submit()}),0)};var tt=z("lock"),et=function(t,e){e=e||{},this.storageKey=t,this.storage=e.storage||window.localStorage,this.pollIntervalMS=e.pollIntervalMS||100,this.timeoutMS=e.timeoutMS||2e3};et.prototype.withLock=function(t,e,i){i||"function"==typeof e||(i=e,e=null);var r=i||(new Date).getTime()+"|"+Math.random(),n=(new Date).getTime(),o=this.storageKey,s=this.pollIntervalMS,a=this.timeoutMS,l=this.storage,c=o+":X",u=o+":Y",h=o+":Z",d=function(t){e&&e(t)},p=function(t){if((new Date).getTime()-n>a)return tt.error("Timeout waiting for mutex on "+o+"; clearing lock. ["+r+"]"),l.removeItem(h),l.removeItem(u),void g();setTimeout((function(){try{t()}catch(t){d(t)}}),s*(Math.random()+.1))},f=function(t,e){t()?e():p((function(){f(t,e)}))},m=function(){var t=l.getItem(u);if(t&&t!==r)return!1;if(l.setItem(u,r),l.getItem(u)===r)return!0;if(!G(l,!0))throw new Error("localStorage support dropped while acquiring lock");return!1},g=function(){l.setItem(c,r),f(m,(function(){l.getItem(c)!==r?p((function(){l.getItem(u)===r?f((function(){return!l.getItem(h)}),_):g()})):_()}))},_=function(){l.setItem(h,"1");try{t()}finally{l.removeItem(h),l.getItem(u)===r&&l.removeItem(u),l.getItem(c)===r&&l.removeItem(c)}};try{if(!G(l,!0))throw new Error("localStorage support check failed");g()}catch(t){d(t)}};var it=z("batch"),rt=function(t,e){e=e||{},this.storageKey=t,this.storage=e.storage||window.localStorage,this.reportError=e.errorReporter||k.bind(it.error,it),this.lock=new et(t,{storage:this.storage}),this.pid=e.pid||null,this.memQueue=[]};rt.prototype.enqueue=function(t,e,i){var r={id:H(),flushAfter:(new Date).getTime()+2*e,payload:t};this.lock.withLock(k.bind((function(){var e;try{var n=this.readFromStorage();n.push(r),(e=this.saveToStorage(n))&&this.memQueue.push(r)}catch(i){this.reportError("Error enqueueing item",t),e=!1}i&&i(e)}),this),k.bind((function(t){this.reportError("Error acquiring storage lock",t),i&&i(!1)}),this),this.pid)},rt.prototype.fillBatch=function(t){var e=this.memQueue.slice(0,t);if(e.length<t){var i=this.readFromStorage();if(i.length){var r={};k.each(e,(function(t){r[t.id]=!0}));for(var n=0;n<i.length;n++){var o=i[n];if((new Date).getTime()>o.flushAfter&&!r[o.id]&&(o.orphaned=!0,e.push(o),e.length>=t))break}}}return e};var nt=function(t,e){var i=[];return k.each(t,(function(t){t.id&&!e[t.id]&&i.push(t)})),i};rt.prototype.removeItemsByID=function(t,e){var i={};k.each(t,(function(t){i[t]=!0})),this.memQueue=nt(this.memQueue,i);var r=k.bind((function(){var e;try{var r=this.readFromStorage();if(r=nt(r,i),e=this.saveToStorage(r)){r=this.readFromStorage();for(var n=0;n<r.length;n++){var o=r[n];if(o.id&&i[o.id])return this.reportError("Item not removed from storage"),!1}}}catch(i){this.reportError("Error removing items",t),e=!1}return e}),this);this.lock.withLock((function(){var t=r();e&&e(t)}),k.bind((function(t){var i=!1;if(this.reportError("Error acquiring storage lock",t),!G(this.storage,!0)&&!(i=r()))try{this.storage.removeItem(this.storageKey)}catch(t){this.reportError("Error clearing queue",t)}e&&e(i)}),this),this.pid)};var ot=function(t,e){var i=[];return k.each(t,(function(t){var r=t.id;if(r in e){var n=e[r];null!==n&&(t.payload=n,i.push(t))}else i.push(t)})),i};rt.prototype.updatePayloads=function(t,e){this.memQueue=ot(this.memQueue,t),this.lock.withLock(k.bind((function(){var i;try{var r=this.readFromStorage();r=ot(r,t),i=this.saveToStorage(r)}catch(e){this.reportError("Error updating items",t),i=!1}e&&e(i)}),this),k.bind((function(t){this.reportError("Error acquiring storage lock",t),e&&e(!1)}),this),this.pid)},rt.prototype.readFromStorage=function(){var t;try{(t=this.storage.getItem(this.storageKey))&&(t=Z(t),k.isArray(t)||(this.reportError("Invalid storage entry:",t),t=null))}catch(e){this.reportError("Error retrieving queue",e),t=null}return t||[]},rt.prototype.saveToStorage=function(t){try{return this.storage.setItem(this.storageKey,Y(t)),!0}catch(t){return this.reportError("Error saving queue",t),!1}},rt.prototype.clear=function(){this.memQueue=[],this.storage.removeItem(this.storageKey)};var st=z("batch"),at=function(t,e){this.errorReporter=e.errorReporter,this.queue=new rt(t,{errorReporter:k.bind(this.reportError,this),storage:e.storage}),this.libConfig=e.libConfig,this.sendRequest=e.sendRequestFunc,this.beforeSendHook=e.beforeSendHook,this.stopAllBatching=e.stopAllBatchingFunc,this.batchSize=this.libConfig.batch_size,this.flushInterval=this.libConfig.batch_flush_interval_ms,this.stopped=!this.libConfig.batch_autostart,this.consecutiveRemovalFailures=0,this.itemIdsSentSuccessfully={}};at.prototype.enqueue=function(t,e){this.queue.enqueue(t,this.flushInterval,e)},at.prototype.start=function(){this.stopped=!1,this.consecutiveRemovalFailures=0,this.flush()},at.prototype.stop=function(){this.stopped=!0,this.timeoutID&&(clearTimeout(this.timeoutID),this.timeoutID=null)},at.prototype.clear=function(){this.queue.clear()},at.prototype.resetBatchSize=function(){this.batchSize=this.libConfig.batch_size},at.prototype.resetFlush=function(){this.scheduleFlush(this.libConfig.batch_flush_interval_ms)},at.prototype.scheduleFlush=function(t){this.flushInterval=t,this.stopped||(this.timeoutID=setTimeout(k.bind(this.flush,this),this.flushInterval))},at.prototype.flush=function(t){try{if(this.requestInProgress)return void st.log("Flush: Request already in progress");t=t||{};var e=this.libConfig.batch_request_timeout_ms,i=(new Date).getTime(),r=this.batchSize,o=this.queue.fillBatch(r),s=[],a={};if(k.each(o,(function(t){var e=t.payload;if(this.beforeSendHook&&!t.orphaned&&(e=this.beforeSendHook(e)),e){e.event&&e.properties&&(e.properties=k.extend({},e.properties,{mp_sent_by_lib_version:n.LIB_VERSION}));var i=!0,r=t.id;r?(this.itemIdsSentSuccessfully[r]||0)>5&&(this.reportError("[dupe] item ID sent too many times, not sending",{item:t,batchSize:o.length,timesSent:this.itemIdsSentSuccessfully[r]}),i=!1):this.reportError("[dupe] found item with no ID",{item:t}),i&&s.push(e)}a[t.id]=e}),this),s.length<1)return void this.resetFlush();this.requestInProgress=!0;var l=k.bind((function(n){this.requestInProgress=!1;try{var s=!1;if(t.unloading)this.queue.updatePayloads(a);else if(k.isObject(n)&&"timeout"===n.error&&(new Date).getTime()-i>=e)this.reportError("Network timeout; retrying"),this.flush();else if(k.isObject(n)&&n.xhr_req&&(n.xhr_req.status>=500||429===n.xhr_req.status||"timeout"===n.error)){var l=2*this.flushInterval,c=n.xhr_req.responseHeaders;if(c){var u=c["Retry-After"];u&&(l=1e3*parseInt(u,10)||l)}l=Math.min(6e5,l),this.reportError("Error; retry in "+l+" ms"),this.scheduleFlush(l)}else if(k.isObject(n)&&n.xhr_req&&413===n.xhr_req.status)if(o.length>1){var h=Math.max(1,Math.floor(r/2));this.batchSize=Math.min(this.batchSize,h,o.length-1),this.reportError("413 response; reducing batch size to "+this.batchSize),this.resetFlush()}else this.reportError("Single-event request too large; dropping",o),this.resetBatchSize(),s=!0;else s=!0;s&&(this.queue.removeItemsByID(k.map(o,(function(t){return t.id})),k.bind((function(t){t?(this.consecutiveRemovalFailures=0,this.flush()):(this.reportError("Failed to remove items from queue"),++this.consecutiveRemovalFailures>5?(this.reportError("Too many queue failures; disabling batching system."),this.stopAllBatching()):this.resetFlush())}),this)),k.each(o,k.bind((function(t){var e=t.id;e?(this.itemIdsSentSuccessfully[e]=this.itemIdsSentSuccessfully[e]||0,this.itemIdsSentSuccessfully[e]++,this.itemIdsSentSuccessfully[e]>5&&this.reportError("[dupe] item ID sent too many times",{item:t,batchSize:o.length,timesSent:this.itemIdsSentSuccessfully[e]})):this.reportError("[dupe] found item with no ID while removing",{item:t})}),this)))}catch(t){this.reportError("Error handling API response",t),this.resetFlush()}}),this),c={method:"POST",verbose:!0,ignore_json_errors:!0,timeout_ms:e};t.unloading&&(c.transport="sendBeacon"),st.log("MIXPANEL REQUEST:",s),this.sendRequest(s,c,l)}catch(t){this.reportError("Error flushing request queue",t),this.resetFlush()}},at.prototype.reportError=function(t,e){if(st.error.apply(st.error,arguments),this.errorReporter)try{e instanceof Error||(e=new Error(t)),this.errorReporter(t,e)}catch(e){st.error(e)}};function lt(t,e){vt(!0,t,e)}function ct(t,e){vt(!1,t,e)}function ut(t,e){return"1"===yt(t,e)}function ht(t,e){if(function(t){if(t&&t.ignoreDnt)return!1;var e=t&&t.window||r,i=e.navigator||{},n=!1;return k.each([i.doNotTrack,i.msDoNotTrack,e.doNotTrack],(function(t){k.includes([!0,1,"1","yes"],t)&&(n=!0)})),n}(e))return B.warn('This browser has "Do Not Track" enabled. This will prevent the Mixpanel SDK from sending any data. To ignore the "Do Not Track" browser setting, initialize the Mixpanel instance with the config "ignore_dnt: true"'),!0;var i="0"===yt(t,e);return i&&B.warn("You are opted out of Mixpanel tracking. This will prevent the Mixpanel SDK from sending any data."),i}function dt(t){return xt(t,(function(t){return this.get_config(t)}))}function pt(t){return xt(t,(function(t){return this._get_config(t)}))}function ft(t){return xt(t,(function(t){return this._get_config(t)}))}function mt(t,e){gt(e=e||{}).remove(_t(t,e),!!e.crossSubdomainCookie,e.cookieDomain)}function gt(t){return"localStorage"===(t=t||{}).persistenceType?k.localStorage:k.cookie}function _t(t,e){return((e=e||{}).persistencePrefix||"__mp_opt_in_out_")+t}function yt(t,e){return gt(e).get(_t(t,e))}function vt(t,e,i){k.isString(e)&&e.length?(gt(i=i||{}).set(_t(e,i),t?1:0,k.isNumber(i.cookieExpiration)?i.cookieExpiration:null,!!i.crossSubdomainCookie,!!i.secureCookie,!!i.crossSiteCookie,i.cookieDomain),i.track&&t&&i.track(i.trackEventName||"$opt_in",i.trackProperties,{send_immediately:!0})):B.error("gdpr."+(t?"optIn":"optOut")+" called with an invalid token")}function xt(t,e){return function(){var i=!1;try{var r=e.call(this,"token"),n=e.call(this,"ignore_dnt"),o=e.call(this,"opt_out_tracking_persistence_type"),s=e.call(this,"opt_out_tracking_cookie_prefix"),a=e.call(this,"window");r&&(i=ht(r,{ignoreDnt:n,persistenceType:o,persistencePrefix:s,window:a}))}catch(t){B.error("Unexpected error when checking tracking opt-out status: "+t)}if(!i)return t.apply(this,arguments);var l=arguments[arguments.length-1];"function"==typeof l&&l(0)}}var bt={set_action:function(t,e){var i={},r={};return k.isObject(t)?k.each(t,(function(t,e){this._is_reserved_property(e)||(r[e]=t)}),this):r[t]=e,i.$set=r,i},unset_action:function(t){var e={},i=[];return k.isArray(t)||(t=[t]),k.each(t,(function(t){this._is_reserved_property(t)||i.push(t)}),this),e.$unset=i,e},set_once_action:function(t,e){var i={},r={};return k.isObject(t)?k.each(t,(function(t,e){this._is_reserved_property(e)||(r[e]=t)}),this):r[t]=e,i.$set_once=r,i},union_action:function(t,e){var i={},r={};return k.isObject(t)?k.each(t,(function(t,e){this._is_reserved_property(e)||(r[e]=k.isArray(t)?t:[t])}),this):r[t]=k.isArray(e)?e:[e],i.$union=r,i},append_action:function(t,e){var i={},r={};return k.isObject(t)?k.each(t,(function(t,e){this._is_reserved_property(e)||(r[e]=t)}),this):r[t]=e,i.$append=r,i},remove_action:function(t,e){var i={},r={};return k.isObject(t)?k.each(t,(function(t,e){this._is_reserved_property(e)||(r[e]=t)}),this):r[t]=e,i.$remove=r,i},delete_action:function(){var t={$delete:""};return t}},wt=function(){};k.extend(wt.prototype,bt),wt.prototype._init=function(t,e,i){this._mixpanel=t,this._group_key=e,this._group_id=i},wt.prototype.set=ft((function(t,e,i){var r=this.set_action(t,e);return k.isObject(t)&&(i=e),this._send_request(r,i)})),wt.prototype.set_once=ft((function(t,e,i){var r=this.set_once_action(t,e);return k.isObject(t)&&(i=e),this._send_request(r,i)})),wt.prototype.unset=ft((function(t,e){var i=this.unset_action(t);return this._send_request(i,e)})),wt.prototype.union=ft((function(t,e,i){k.isObject(t)&&(i=e);var r=this.union_action(t,e);return this._send_request(r,i)})),wt.prototype.delete=ft((function(t){var e=this.delete_action();return this._send_request(e,t)})),wt.prototype.remove=ft((function(t,e,i){var r=this.remove_action(t,e);return this._send_request(r,i)})),wt.prototype._send_request=function(t,e){t.$group_key=this._group_key,t.$group_id=this._group_id,t.$token=this._get_config("token");var i=k.encodeDates(t);return this._mixpanel._track_or_batch({type:"groups",data:i,endpoint:this._get_config("api_host")+"/"+this._get_config("api_routes").groups,batcher:this._mixpanel.request_batchers.groups},e)},wt.prototype._is_reserved_property=function(t){return"$group_key"===t||"$group_id"===t},wt.prototype._get_config=function(t){return this._mixpanel.get_config(t)},wt.prototype.toString=function(){return this._mixpanel.toString()+".group."+this._group_key+"."+this._group_id},wt.prototype.remove=wt.prototype.remove,wt.prototype.set=wt.prototype.set,wt.prototype.set_once=wt.prototype.set_once,wt.prototype.union=wt.prototype.union,wt.prototype.unset=wt.prototype.unset,wt.prototype.toString=wt.prototype.toString;var Tt=function(){};k.extend(Tt.prototype,bt),Tt.prototype._init=function(t){this._mixpanel=t},Tt.prototype.set=pt((function(t,e,i){var r=this.set_action(t,e);return k.isObject(t)&&(i=e),this._get_config("save_referrer")&&this._mixpanel.persistence.update_referrer_info(document.referrer),r.$set=k.extend({},k.info.people_properties(),this._mixpanel.persistence.get_referrer_info(),r.$set),this._send_request(r,i)})),Tt.prototype.set_once=pt((function(t,e,i){var r=this.set_once_action(t,e);return k.isObject(t)&&(i=e),this._send_request(r,i)})),Tt.prototype.unset=pt((function(t,e){var i=this.unset_action(t);return this._send_request(i,e)})),Tt.prototype.increment=pt((function(t,e,i){var r={},n={};return k.isObject(t)?(k.each(t,(function(t,e){if(!this._is_reserved_property(e)){if(isNaN(parseFloat(t)))return void B.error("Invalid increment value passed to mixpanel.people.increment - must be a number");n[e]=t}}),this),i=e):(k.isUndefined(e)&&(e=1),n[t]=e),r.$add=n,this._send_request(r,i)})),Tt.prototype.append=pt((function(t,e,i){k.isObject(t)&&(i=e);var r=this.append_action(t,e);return this._send_request(r,i)})),Tt.prototype.remove=pt((function(t,e,i){k.isObject(t)&&(i=e);var r=this.remove_action(t,e);return this._send_request(r,i)})),Tt.prototype.union=pt((function(t,e,i){k.isObject(t)&&(i=e);var r=this.union_action(t,e);return this._send_request(r,i)})),Tt.prototype.track_charge=pt((function(t,e,i){if(k.isNumber(t)||(t=parseFloat(t),!isNaN(t)))return this.append("$transactions",k.extend({$amount:t},e),i);B.error("Invalid value passed to mixpanel.people.track_charge - must be a number")})),Tt.prototype.clear_charges=function(t){return this.set("$transactions",[],t)},Tt.prototype.delete_user=function(){if(this._identify_called()){var t={$delete:this._mixpanel.get_distinct_id()};return this._send_request(t)}B.error("mixpanel.people.delete_user() requires you to call identify() first")},Tt.prototype.toString=function(){return this._mixpanel.toString()+".people"},Tt.prototype._send_request=function(t,e){t.$token=this._get_config("token"),t.$distinct_id=this._mixpanel.get_distinct_id();var i=this._mixpanel.get_property("$device_id"),r=this._mixpanel.get_property("$user_id"),n=this._mixpanel.get_property("$had_persisted_distinct_id");i&&(t.$device_id=i),r&&(t.$user_id=r),n&&(t.$had_persisted_distinct_id=n);var o=k.encodeDates(t);return this._identify_called()?this._mixpanel._track_or_batch({type:"people",data:o,endpoint:this._get_config("api_host")+"/"+this._get_config("api_routes").engage,batcher:this._mixpanel.request_batchers.people},e):(this._enqueue(t),k.isUndefined(e)||(this._get_config("verbose")?e({status:-1,error:null}):e(-1)),k.truncate(o,255))},Tt.prototype._get_config=function(t){return this._mixpanel.get_config(t)},Tt.prototype._identify_called=function(){return!0===this._mixpanel._flags.identify_called},Tt.prototype._enqueue=function(t){"$set"in t?this._mixpanel.persistence._add_to_people_queue("$set",t):"$set_once"in t?this._mixpanel.persistence._add_to_people_queue("$set_once",t):"$unset"in t?this._mixpanel.persistence._add_to_people_queue("$unset",t):"$add"in t?this._mixpanel.persistence._add_to_people_queue("$add",t):"$append"in t?this._mixpanel.persistence._add_to_people_queue("$append",t):"$remove"in t?this._mixpanel.persistence._add_to_people_queue("$remove",t):"$union"in t?this._mixpanel.persistence._add_to_people_queue("$union",t):B.error("Invalid call to _enqueue():",t)},Tt.prototype._flush_one_queue=function(t,e,i,r){var n=this,o=k.extend({},this._mixpanel.persistence.load_queue(t)),s=o;k.isUndefined(o)||!k.isObject(o)||k.isEmptyObject(o)||(n._mixpanel.persistence._pop_from_people_queue(t,o),n._mixpanel.persistence.save(),r&&(s=r(o)),e.call(n,s,(function(e,r){0===e&&n._mixpanel.persistence._add_to_people_queue(t,o),k.isUndefined(i)||i(e,r)})))},Tt.prototype._flush=function(t,e,i,r,n,o,s){var a=this;this._flush_one_queue("$set",this.set,t),this._flush_one_queue("$set_once",this.set_once,r),this._flush_one_queue("$unset",this.unset,o,(function(t){return k.keys(t)})),this._flush_one_queue("$add",this.increment,e),this._flush_one_queue("$union",this.union,n);var l=this._mixpanel.persistence.load_queue("$append");if(!k.isUndefined(l)&&k.isArray(l)&&l.length)for(var c,u=function(t,e){0===t&&a._mixpanel.persistence._add_to_people_queue("$append",c),k.isUndefined(i)||i(t,e)},h=l.length-1;h>=0;h--)l=this._mixpanel.persistence.load_queue("$append"),c=l.pop(),a._mixpanel.persistence.save(),k.isEmptyObject(c)||a.append(c,u);var d=this._mixpanel.persistence.load_queue("$remove");if(!k.isUndefined(d)&&k.isArray(d)&&d.length)for(var p,f=function(t,e){0===t&&a._mixpanel.persistence._add_to_people_queue("$remove",p),k.isUndefined(s)||s(t,e)},m=d.length-1;m>=0;m--)d=this._mixpanel.persistence.load_queue("$remove"),p=d.pop(),a._mixpanel.persistence.save(),k.isEmptyObject(p)||a.remove(p,f)},Tt.prototype._is_reserved_property=function(t){return"$distinct_id"===t||"$token"===t||"$device_id"===t||"$user_id"===t||"$had_persisted_distinct_id"===t},Tt.prototype.set=Tt.prototype.set,Tt.prototype.set_once=Tt.prototype.set_once,Tt.prototype.unset=Tt.prototype.unset,Tt.prototype.increment=Tt.prototype.increment,Tt.prototype.append=Tt.prototype.append,Tt.prototype.remove=Tt.prototype.remove,Tt.prototype.union=Tt.prototype.union,Tt.prototype.track_charge=Tt.prototype.track_charge,Tt.prototype.clear_charges=Tt.prototype.clear_charges,Tt.prototype.delete_user=Tt.prototype.delete_user,Tt.prototype.toString=Tt.prototype.toString;var Et,St,At=["__mps","__mpso","__mpus","__mpa","__mpap","__mpr","__mpu","$people_distinct_id","__alias","__timers"],Mt=function(t){this.props={},this.campaign_params_saved=!1,t.persistence_name?this.name="mp_"+t.persistence_name:this.name="mp_"+t.token+"_mixpanel";var e=t.persistence;"cookie"!==e&&"localStorage"!==e&&(B.critical("Unknown persistence type "+e+"; falling back to cookie"),e=t.persistence="cookie"),"localStorage"===e&&k.localStorage.is_supported()?this.storage=k.localStorage:this.storage=k.cookie,this.load(),this.update_config(t),this.upgrade(t),this.save()};Mt.prototype.properties=function(){var t={};return this.load(),k.each(this.props,(function(e,i){k.include(At,i)||(t[i]=e)})),t},Mt.prototype.load=function(){if(!this.disabled){var t=this.storage.parse(this.name);t&&(this.props=k.extend({},t))}},Mt.prototype.upgrade=function(t){var e,i,r=t.upgrade;r&&(e="mp_super_properties","string"==typeof r&&(e=r),i=this.storage.parse(e),this.storage.remove(e),this.storage.remove(e,!0),i&&(this.props=k.extend(this.props,i.all,i.events))),t.cookie_name||"mixpanel"===t.name||(e="mp_"+t.token+"_"+t.name,(i=this.storage.parse(e))&&(this.storage.remove(e),this.storage.remove(e,!0),this.register_once(i))),this.storage===k.localStorage&&(i=k.cookie.parse(this.name),k.cookie.remove(this.name),k.cookie.remove(this.name,!0),i&&this.register_once(i))},Mt.prototype.save=function(){this.disabled||this.storage.set(this.name,k.JSONEncode(this.props),this.expire_days,this.cross_subdomain,this.secure,this.cross_site,this.cookie_domain)},Mt.prototype.load_prop=function(t){return this.load(),this.props[t]},Mt.prototype.remove=function(){this.storage.remove(this.name,!1,this.cookie_domain),this.storage.remove(this.name,!0,this.cookie_domain)},Mt.prototype.clear=function(){this.remove(),this.props={}},Mt.prototype.register_once=function(t,e,i){return!!k.isObject(t)&&(void 0===e&&(e="None"),this.expire_days=void 0===i?this.default_expiry:i,this.load(),k.each(t,(function(t,i){this.props.hasOwnProperty(i)&&this.props[i]!==e||(this.props[i]=t)}),this),this.save(),!0)},Mt.prototype.register=function(t,e){return!!k.isObject(t)&&(this.expire_days=void 0===e?this.default_expiry:e,this.load(),k.extend(this.props,t),this.save(),!0)},Mt.prototype.unregister=function(t){this.load(),t in this.props&&(delete this.props[t],this.save())},Mt.prototype.update_search_keyword=function(t){this.register(k.info.searchInfo(t))},Mt.prototype.update_referrer_info=function(t){this.register_once({$initial_referrer:t||"$direct",$initial_referring_domain:k.info.referringDomain(t)||"$direct"},"")},Mt.prototype.get_referrer_info=function(){return k.strip_empty_properties({$initial_referrer:this.props.$initial_referrer,$initial_referring_domain:this.props.$initial_referring_domain})},Mt.prototype.update_config=function(t){this.default_expiry=this.expire_days=t.cookie_expiration,this.set_disabled(t.disable_persistence),this.set_cookie_domain(t.cookie_domain),this.set_cross_site(t.cross_site_cookie),this.set_cross_subdomain(t.cross_subdomain_cookie),this.set_secure(t.secure_cookie)},Mt.prototype.set_disabled=function(t){this.disabled=t,this.disabled?this.remove():this.save()},Mt.prototype.set_cookie_domain=function(t){t!==this.cookie_domain&&(this.remove(),this.cookie_domain=t,this.save())},Mt.prototype.set_cross_site=function(t){t!==this.cross_site&&(this.cross_site=t,this.remove(),this.save())},Mt.prototype.set_cross_subdomain=function(t){t!==this.cross_subdomain&&(this.cross_subdomain=t,this.remove(),this.save())},Mt.prototype.get_cross_subdomain=function(){return this.cross_subdomain},Mt.prototype.set_secure=function(t){t!==this.secure&&(this.secure=!!t,this.remove(),this.save())},Mt.prototype._add_to_people_queue=function(t,e){var i=this._get_queue_key(t),r=e[t],n=this._get_or_create_queue("$set"),o=this._get_or_create_queue("$set_once"),s=this._get_or_create_queue("$unset"),a=this._get_or_create_queue("$add"),l=this._get_or_create_queue("$union"),c=this._get_or_create_queue("$remove",[]),u=this._get_or_create_queue("$append",[]);"__mps"===i?(k.extend(n,r),this._pop_from_people_queue("$add",r),this._pop_from_people_queue("$union",r),this._pop_from_people_queue("$unset",r)):"__mpso"===i?(k.each(r,(function(t,e){e in o||(o[e]=t)})),this._pop_from_people_queue("$unset",r)):"__mpus"===i?k.each(r,(function(t){k.each([n,o,a,l],(function(e){t in e&&delete e[t]})),k.each(u,(function(e){t in e&&delete e[t]})),s[t]=!0})):"__mpa"===i?(k.each(r,(function(t,e){e in n?n[e]+=t:(e in a||(a[e]=0),a[e]+=t)}),this),this._pop_from_people_queue("$unset",r)):"__mpu"===i?(k.each(r,(function(t,e){k.isArray(t)&&(e in l||(l[e]=[]),l[e]=l[e].concat(t))})),this._pop_from_people_queue("$unset",r)):"__mpr"===i?(c.push(r),this._pop_from_people_queue("$append",r)):"__mpap"===i&&(u.push(r),this._pop_from_people_queue("$unset",r)),B.log("MIXPANEL PEOPLE REQUEST (QUEUED, PENDING IDENTIFY):"),B.log(e),this.save()},Mt.prototype._pop_from_people_queue=function(t,e){var i=this.props[this._get_queue_key(t)];k.isUndefined(i)||k.each(e,(function(e,r){"$append"===t||"$remove"===t?k.each(i,(function(t){t[r]===e&&delete t[r]})):delete i[r]}),this)},Mt.prototype.load_queue=function(t){return this.load_prop(this._get_queue_key(t))},Mt.prototype._get_queue_key=function(t){return"$set"===t?"__mps":"$set_once"===t?"__mpso":"$unset"===t?"__mpus":"$add"===t?"__mpa":"$append"===t?"__mpap":"$remove"===t?"__mpr":"$union"===t?"__mpu":void B.error("Invalid queue:",t)},Mt.prototype._get_or_create_queue=function(t,e){var i=this._get_queue_key(t);return e=k.isUndefined(e)?{}:e,this.props[i]||(this.props[i]=e)},Mt.prototype.set_event_timer=function(t,e){var i=this.load_prop("__timers")||{};i[t]=e,this.props.__timers=i,this.save()},Mt.prototype.remove_event_timer=function(t){var e=(this.load_prop("__timers")||{})[t];return k.isUndefined(e)||(delete this.props.__timers[t],this.save()),e};var It=function(t){return t},Ct=function(){},Pt=r.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,Rt=!Pt&&-1===I.indexOf("MSIE")&&-1===I.indexOf("Mozilla"),Ot=null;E.sendBeacon&&(Ot=function(){return E.sendBeacon.apply(E,arguments)});var Dt={track:"track/",engage:"engage/",groups:"groups/"},Lt={api_host:"https://api-js.mixpanel.com",api_routes:Dt,api_method:"POST",api_transport:"XHR",api_payload_format:"base64",app_host:"https://mixpanel.com",cdn:"https://cdn.mxpnl.com",cross_site_cookie:!1,cross_subdomain_cookie:!0,error_reporter:Ct,persistence:"cookie",persistence_name:"",cookie_domain:"",cookie_name:"",loaded:Ct,track_marketing:!0,track_pageview:!1,skip_first_touch_marketing:!1,store_google:!0,save_referrer:!0,test:!1,verbose:!1,img:!1,debug:!1,track_links_timeout:300,cookie_expiration:365,upgrade:!1,disable_persistence:!1,disable_cookie:!1,secure_cookie:!1,ip:!0,opt_out_tracking_by_default:!1,opt_out_persistence_by_default:!1,opt_out_tracking_persistence_type:"localStorage",opt_out_tracking_cookie_prefix:null,property_blacklist:[],xhr_headers:{},ignore_dnt:!1,batch_requests:!0,batch_size:50,batch_flush_interval_ms:5e3,batch_request_timeout_ms:9e4,batch_autostart:!0,hooks:{}},kt=!1,Bt=function(){},Ft=function(t,e,i){var r,o="mixpanel"===i?St:St[i];if(o&&0===Et)r=o;else{if(o&&!k.isArray(o))return void B.error("You have already initialized "+i);r=new Bt}if(r._cached_groups={},r._init(t,e,i),r.people=new Tt,r.people._init(r),!r.get_config("skip_first_touch_marketing")){var s=k.info.campaignParams(null),a={},l=!1;k.each(s,(function(t,e){a["initial_"+e]=t,t&&(l=!0)})),l&&r.people.set_once(a)}return n.DEBUG=n.DEBUG||r.get_config("debug"),!k.isUndefined(o)&&k.isArray(o)&&(r._execute_array.call(r.people,o.people),r._execute_array(o)),r};Bt.prototype.init=function(t,e,i){if(k.isUndefined(i))this.report_error("You must name your new library: init(token, config, name)");else{if("mixpanel"!==i){var r=Ft(t,e,i);return St[i]=r,r._loaded(),r}this.report_error("You must initialize the main mixpanel object right after you include the Mixpanel js snippet")}},Bt.prototype._init=function(t,e,i){e=e||{},this.__loaded=!0,this.config={};var n={};"api_payload_format"in e||(e.api_host||Lt.api_host).match(/\.mixpanel\.com/)&&(n.api_payload_format="json");if(this.set_config(k.extend({},Lt,n,e,{name:i,token:t,callback_fn:("mixpanel"===i?i:"mixpanel."+i)+"._jsc"})),this._jsc=Ct,this.__dom_loaded_queue=[],this.__request_queue=[],this.__disabled_events=[],this._flags={disable_all_events:!1,identify_called:!1},this.request_batchers={},this._batch_requests=this.get_config("batch_requests"),this._batch_requests)if(k.localStorage.is_supported(!0)&&Pt){if(this.init_batchers(),Ot&&r.addEventListener){var o=k.bind((function(){this.request_batchers.events.stopped||this.request_batchers.events.flush({unloading:!0})}),this);r.addEventListener("pagehide",(function(t){t.persisted&&o()})),r.addEventListener("visibilitychange",(function(){"hidden"===S.visibilityState&&o()}))}}else this._batch_requests=!1,B.log("Turning off Mixpanel request-queueing; needs XHR and localStorage support"),k.each(this.get_batcher_configs(),(function(t){B.log("Clearing batch queue "+t.queue_key),k.localStorage.remove(t.queue_key)}));this.persistence=this.cookie=new Mt(this.config),this.unpersisted_superprops={},this._gdpr_init();var s=k.UUID();this.get_distinct_id()||this.register_once({distinct_id:"$device:"+s,$device_id:s},""),this.get_config("track_pageview")&&this.track_pageview()},Bt.prototype._loaded=function(){this.get_config("loaded")(this),this._set_default_superprops()},Bt.prototype._set_default_superprops=function(){this.persistence.update_search_keyword(S.referrer),this.get_config("store_google")&&this.register(k.info.campaignParams()),this.get_config("save_referrer")&&this.persistence.update_referrer_info(S.referrer)},Bt.prototype._dom_loaded=function(){k.each(this.__dom_loaded_queue,(function(t){this._track_dom.apply(this,t)}),this),this.has_opted_out_tracking()||k.each(this.__request_queue,(function(t){this._send_request.apply(this,t)}),this),delete this.__dom_loaded_queue,delete this.__request_queue},Bt.prototype._track_dom=function(t,e){if(this.get_config("img"))return this.report_error("You can't use DOM tracking functions with img = true."),!1;if(!kt)return this.__dom_loaded_queue.push([t,e]),!1;var i=(new t).init(this);return i.track.apply(i,e)},Bt.prototype._prepare_callback=function(t,e){if(k.isUndefined(t))return null;if(Pt){return function(i){t(i,e)}}var i=this._jsc,r=""+Math.floor(1e8*Math.random()),n=this.get_config("callback_fn")+"["+r+"]";return i[r]=function(n){delete i[r],t(n,e)},n},Bt.prototype._send_request=function(t,e,i,r){var n=!0;if(Rt)return this.__request_queue.push(arguments),n;var o={method:this.get_config("api_method"),transport:this.get_config("api_transport"),verbose:this.get_config("verbose")},s=null;r||!k.isFunction(i)&&"string"!=typeof i||(r=i,i=null),i=k.extend(o,i||{}),Pt||(i.method="GET");var a="POST"===i.method,l=Ot&&a&&"sendbeacon"===i.transport.toLowerCase(),c=i.verbose;e.verbose&&(c=!0),this.get_config("test")&&(e.test=1),c&&(e.verbose=1),this.get_config("img")&&(e.img=1),Pt||(r?e.callback=r:(c||this.get_config("test"))&&(e.callback="(function(){})")),e.ip=this.get_config("ip")?1:0,e._=(new Date).getTime().toString(),a&&(s="data="+encodeURIComponent(e.data),delete e.data),t+="?"+k.HTTPBuildQuery(e);var u=this;if("img"in e){var h=S.createElement("img");h.src=t,S.body.appendChild(h)}else if(l){try{n=Ot(t,s)}catch(t){u.report_error(t),n=!1}try{r&&r(n?1:0)}catch(t){u.report_error(t)}}else if(Pt)try{var d=new XMLHttpRequest;d.open(i.method,t,!0);var p=this.get_config("xhr_headers");if(a&&(p["Content-Type"]="application/x-www-form-urlencoded"),k.each(p,(function(t,e){d.setRequestHeader(e,t)})),i.timeout_ms&&void 0!==d.timeout){d.timeout=i.timeout_ms;var f=(new Date).getTime()}d.withCredentials=!0,d.onreadystatechange=function(){var t;if(4===d.readyState)if(200===d.status){if(r)if(c){var e;try{e=k.JSONDecode(d.responseText)}catch(t){if(u.report_error(t),!i.ignore_json_errors)return;e=d.responseText}r(e)}else r(Number(d.responseText))}else t=d.timeout&&!d.status&&(new Date).getTime()-f>=d.timeout?"timeout":"Bad HTTP status: "+d.status+" "+d.statusText,u.report_error(t),r&&r(c?{status:0,error:t,xhr_req:d}:0)},d.send(s)}catch(t){u.report_error(t),n=!1}else{var m=S.createElement("script");m.type="text/javascript",m.async=!0,m.defer=!0,m.src=t;var g=S.getElementsByTagName("script")[0];g.parentNode.insertBefore(m,g)}return n},Bt.prototype._execute_array=function(t){var e,i=[],r=[],n=[];k.each(t,(function(t){t&&(e=t[0],k.isArray(e)?n.push(t):"function"==typeof t?t.call(this):k.isArray(t)&&"alias"===e?i.push(t):k.isArray(t)&&-1!==e.indexOf("track")&&"function"==typeof this[e]?n.push(t):r.push(t))}),this);var o=function(t,e){k.each(t,(function(t){if(k.isArray(t[0])){var i=e;k.each(t,(function(t){i=i[t[0]].apply(i,t.slice(1))}))}else this[t[0]].apply(this,t.slice(1))}),e)};o(i,this),o(r,this),o(n,this)},Bt.prototype.are_batchers_initialized=function(){return!!this.request_batchers.events},Bt.prototype.get_batcher_configs=function(){var t="__mpq_"+this.get_config("token"),e=this.get_config("api_routes");return this._batcher_configs=this._batcher_configs||{events:{type:"events",endpoint:"/"+e.track,queue_key:t+"_ev"},people:{type:"people",endpoint:"/"+e.engage,queue_key:t+"_pp"},groups:{type:"groups",endpoint:"/"+e.groups,queue_key:t+"_gr"}},this._batcher_configs},Bt.prototype.init_batchers=function(){if(!this.are_batchers_initialized()){var t=k.bind((function(t){return new at(t.queue_key,{libConfig:this.config,sendRequestFunc:k.bind((function(e,i,r){this._send_request(this.get_config("api_host")+t.endpoint,this._encode_data_for_request(e),i,this._prepare_callback(r,e))}),this),beforeSendHook:k.bind((function(e){return this._run_hook("before_send_"+t.type,e)}),this),errorReporter:this.get_config("error_reporter"),stopAllBatchingFunc:k.bind(this.stop_batch_senders,this)})}),this),e=this.get_batcher_configs();this.request_batchers={events:t(e.events),people:t(e.people),groups:t(e.groups)}}this.get_config("batch_autostart")&&this.start_batch_senders()},Bt.prototype.start_batch_senders=function(){this._batchers_were_started=!0,this.are_batchers_initialized()&&(this._batch_requests=!0,k.each(this.request_batchers,(function(t){t.start()})))},Bt.prototype.stop_batch_senders=function(){this._batch_requests=!1,k.each(this.request_batchers,(function(t){t.stop(),t.clear()}))},Bt.prototype.push=function(t){this._execute_array([t])},Bt.prototype.disable=function(t){void 0===t?this._flags.disable_all_events=!0:this.__disabled_events=this.__disabled_events.concat(t)},Bt.prototype._encode_data_for_request=function(t){var e=k.JSONEncode(t);return"base64"===this.get_config("api_payload_format")&&(e=k.base64Encode(e)),{data:e}},Bt.prototype._track_or_batch=function(t,e){var i=k.truncate(t.data,255),r=t.endpoint,n=t.batcher,o=t.should_send_immediately,s=t.send_request_options||{};e=e||Ct;var a=!0,l=k.bind((function(){return s.skip_hooks||(i=this._run_hook("before_send_"+t.type,i)),i?(B.log("MIXPANEL REQUEST:"),B.log(i),this._send_request(r,this._encode_data_for_request(i),s,this._prepare_callback(e,i))):null}),this);return this._batch_requests&&!o?n.enqueue(i,(function(t){t?e(1,i):l()})):a=l(),a&&i},Bt.prototype.track=dt((function(t,e,i,r){r||"function"!=typeof i||(r=i,i=null);var n=(i=i||{}).transport;n&&(i.transport=n);var o=i.send_immediately;if("function"!=typeof r&&(r=Ct),k.isUndefined(t))this.report_error("No event name provided to mixpanel.track");else{if(!this._event_is_disabled(t)){(e=k.extend({},e)).token=this.get_config("token");var s=this.persistence.remove_event_timer(t);if(!k.isUndefined(s)){var a=(new Date).getTime()-s;e.$duration=parseFloat((a/1e3).toFixed(3))}this._set_default_superprops();var l=this.get_config("track_marketing")?k.info.marketingParams():{};e=k.extend({},k.info.properties(),l,this.persistence.properties(),this.unpersisted_superprops,e);var c=this.get_config("property_blacklist");k.isArray(c)?k.each(c,(function(t){delete e[t]})):this.report_error("Invalid value for property_blacklist config: "+c);var u={event:t,properties:e};return this._track_or_batch({type:"events",data:u,endpoint:this.get_config("api_host")+"/"+this.get_config("api_routes").track,batcher:this.request_batchers.events,should_send_immediately:o,send_request_options:i},r)}r(0)}})),Bt.prototype.set_group=dt((function(t,e,i){k.isArray(e)||(e=[e]);var r={};return r[t]=e,this.register(r),this.people.set(t,e,i)})),Bt.prototype.add_group=dt((function(t,e,i){var r=this.get_property(t),n={};return void 0===r?(n[t]=[e],this.register(n)):-1===r.indexOf(e)&&(r.push(e),n[t]=r,this.register(n)),this.people.union(t,e,i)})),Bt.prototype.remove_group=dt((function(t,e,i){var r=this.get_property(t);if(void 0!==r){var n=r.indexOf(e);n>-1&&(r.splice(n,1),this.register({group_key:r})),0===r.length&&this.unregister(t)}return this.people.remove(t,e,i)})),Bt.prototype.track_with_groups=dt((function(t,e,i,r){var n=k.extend({},e||{});return k.each(i,(function(t,e){null!=t&&(n[e]=t)})),this.track(t,n,r)})),Bt.prototype._create_map_key=function(t,e){return t+"_"+JSON.stringify(e)},Bt.prototype._remove_group_from_cache=function(t,e){delete this._cached_groups[this._create_map_key(t,e)]},Bt.prototype.get_group=function(t,e){var i=this._create_map_key(t,e),r=this._cached_groups[i];return void 0!==r&&r._group_key===t&&r._group_id===e||((r=new wt)._init(this,t,e),this._cached_groups[i]=r),r},Bt.prototype.track_pageview=dt((function(t,e){"object"!=typeof t&&(t={});var i=(e=e||{}).event_name||"$mp_web_page_view",r=k.extend(k.info.mpPageViewProperties(),k.info.campaignParams(),k.info.clickParams()),n=k.extend({},r,t);return this.track(i,n)})),Bt.prototype.track_links=function(){return this._track_dom.call(this,J,arguments)},Bt.prototype.track_forms=function(){return this._track_dom.call(this,Q,arguments)},Bt.prototype.time_event=function(t){k.isUndefined(t)?this.report_error("No event name provided to mixpanel.time_event"):this._event_is_disabled(t)||this.persistence.set_event_timer(t,(new Date).getTime())};var zt={persistent:!0},Nt=function(t){var e;return e=k.isObject(t)?t:k.isUndefined(t)?{}:{days:t},k.extend({},zt,e)};Bt.prototype.register=function(t,e){var i=Nt(e);i.persistent?this.persistence.register(t,i.days):k.extend(this.unpersisted_superprops,t)},Bt.prototype.register_once=function(t,e,i){var r=Nt(i);r.persistent?this.persistence.register_once(t,e,r.days):(void 0===e&&(e="None"),k.each(t,(function(t,i){this.unpersisted_superprops.hasOwnProperty(i)&&this.unpersisted_superprops[i]!==e||(this.unpersisted_superprops[i]=t)}),this))},Bt.prototype.unregister=function(t,e){(e=Nt(e)).persistent?this.persistence.unregister(t):delete this.unpersisted_superprops[t]},Bt.prototype._register_single=function(t,e){var i={};i[t]=e,this.register(i)},Bt.prototype.identify=function(t,e,i,r,n,o,s,a){var l=this.get_distinct_id();if(t&&l!==t){if("string"==typeof t&&0===t.indexOf("$device:"))return this.report_error("distinct_id cannot have $device: prefix"),-1;this.register({$user_id:t})}if(!this.get_property("$device_id")){var c=l;this.register_once({$had_persisted_distinct_id:!0,$device_id:c},"")}t!==l&&t!==this.get_property("__alias")&&(this.unregister("__alias"),this.register({distinct_id:t})),this._flags.identify_called=!0,this.people._flush(e,i,r,n,o,s,a),t!==l&&this.track("$identify",{distinct_id:t,$anon_distinct_id:l},{skip_hooks:!0})},Bt.prototype.reset=function(){this.persistence.clear(),this._flags.identify_called=!1;var t=k.UUID();this.register_once({distinct_id:"$device:"+t,$device_id:t},"")},Bt.prototype.get_distinct_id=function(){return this.get_property("distinct_id")},Bt.prototype.alias=function(t,e){if(t===this.get_property("$people_distinct_id"))return this.report_error("Attempting to create alias for existing People user - aborting."),-2;var i=this;return k.isUndefined(e)&&(e=this.get_distinct_id()),t!==e?(this._register_single("__alias",t),this.track("$create_alias",{alias:t,distinct_id:e},{skip_hooks:!0},(function(){i.identify(t)}))):(this.report_error("alias matches current distinct_id - skipping api call."),this.identify(t),-1)},Bt.prototype.name_tag=function(t){this._register_single("mp_name_tag",t)},Bt.prototype.set_config=function(t){k.isObject(t)&&(k.extend(this.config,t),t.batch_size&&k.each(this.request_batchers,(function(t){t.resetBatchSize()})),this.get_config("persistence_name")||(this.config.persistence_name=this.config.cookie_name),this.get_config("disable_persistence")||(this.config.disable_persistence=this.config.disable_cookie),this.persistence&&this.persistence.update_config(this.config),n.DEBUG=n.DEBUG||this.get_config("debug"))},Bt.prototype.get_config=function(t){return this.config[t]},Bt.prototype._run_hook=function(t){var e=(this.config.hooks[t]||It).apply(this,x.call(arguments,1));return void 0===e&&(this.report_error(t+" hook did not return a value"),e=null),e},Bt.prototype.get_property=function(t){return this.persistence.load_prop([t])},Bt.prototype.toString=function(){var t=this.get_config("name");return"mixpanel"!==t&&(t="mixpanel."+t),t},Bt.prototype._event_is_disabled=function(t){return k.isBlockedUA(I)||this._flags.disable_all_events||k.include(this.__disabled_events,t)},Bt.prototype._gdpr_init=function(){"localStorage"===this.get_config("opt_out_tracking_persistence_type")&&k.localStorage.is_supported()&&(!this.has_opted_in_tracking()&&this.has_opted_in_tracking({persistence_type:"cookie"})&&this.opt_in_tracking({enable_persistence:!1}),!this.has_opted_out_tracking()&&this.has_opted_out_tracking({persistence_type:"cookie"})&&this.opt_out_tracking({clear_persistence:!1}),this.clear_opt_in_out_tracking({persistence_type:"cookie",enable_persistence:!1})),this.has_opted_out_tracking()?this._gdpr_update_persistence({clear_persistence:!0}):this.has_opted_in_tracking()||!this.get_config("opt_out_tracking_by_default")&&!k.cookie.get("mp_optout")||(k.cookie.remove("mp_optout"),this.opt_out_tracking({clear_persistence:this.get_config("opt_out_persistence_by_default")}))},Bt.prototype._gdpr_update_persistence=function(t){var e;if(t&&t.clear_persistence)e=!0;else{if(!t||!t.enable_persistence)return;e=!1}this.get_config("disable_persistence")||this.persistence.disabled===e||this.persistence.set_disabled(e),e?this.stop_batch_senders():this._batchers_were_started&&this.start_batch_senders()},Bt.prototype._gdpr_call_func=function(t,e){return e=k.extend({track:k.bind(this.track,this),persistence_type:this.get_config("opt_out_tracking_persistence_type"),cookie_prefix:this.get_config("opt_out_tracking_cookie_prefix"),cookie_expiration:this.get_config("cookie_expiration"),cross_site_cookie:this.get_config("cross_site_cookie"),cross_subdomain_cookie:this.get_config("cross_subdomain_cookie"),cookie_domain:this.get_config("cookie_domain"),secure_cookie:this.get_config("secure_cookie"),ignore_dnt:this.get_config("ignore_dnt")},e),k.localStorage.is_supported()||(e.persistence_type="cookie"),t(this.get_config("token"),{track:e.track,trackEventName:e.track_event_name,trackProperties:e.track_properties,persistenceType:e.persistence_type,persistencePrefix:e.cookie_prefix,cookieDomain:e.cookie_domain,cookieExpiration:e.cookie_expiration,crossSiteCookie:e.cross_site_cookie,crossSubdomainCookie:e.cross_subdomain_cookie,secureCookie:e.secure_cookie,ignoreDnt:e.ignore_dnt})},Bt.prototype.opt_in_tracking=function(t){t=k.extend({enable_persistence:!0},t),this._gdpr_call_func(lt,t),this._gdpr_update_persistence(t)},Bt.prototype.opt_out_tracking=function(t){(t=k.extend({clear_persistence:!0,delete_user:!0},t)).delete_user&&this.people&&this.people._identify_called()&&(this.people.delete_user(),this.people.clear_charges()),this._gdpr_call_func(ct,t),this._gdpr_update_persistence(t)},Bt.prototype.has_opted_in_tracking=function(t){return this._gdpr_call_func(ut,t)},Bt.prototype.has_opted_out_tracking=function(t){return this._gdpr_call_func(ht,t)},Bt.prototype.clear_opt_in_out_tracking=function(t){t=k.extend({enable_persistence:!0},t),this._gdpr_call_func(mt,t),this._gdpr_update_persistence(t)},Bt.prototype.report_error=function(t,e){B.error.apply(B.error,arguments);try{e||t instanceof Error||(t=new Error(t)),this.get_config("error_reporter")(t,e)}catch(e){B.error(e)}},Bt.prototype.init=Bt.prototype.init,Bt.prototype.reset=Bt.prototype.reset,Bt.prototype.disable=Bt.prototype.disable,Bt.prototype.time_event=Bt.prototype.time_event,Bt.prototype.track=Bt.prototype.track,Bt.prototype.track_links=Bt.prototype.track_links,Bt.prototype.track_forms=Bt.prototype.track_forms,Bt.prototype.track_pageview=Bt.prototype.track_pageview,Bt.prototype.register=Bt.prototype.register,Bt.prototype.register_once=Bt.prototype.register_once,Bt.prototype.unregister=Bt.prototype.unregister,Bt.prototype.identify=Bt.prototype.identify,Bt.prototype.alias=Bt.prototype.alias,Bt.prototype.name_tag=Bt.prototype.name_tag,Bt.prototype.set_config=Bt.prototype.set_config,Bt.prototype.get_config=Bt.prototype.get_config,Bt.prototype.get_property=Bt.prototype.get_property,Bt.prototype.get_distinct_id=Bt.prototype.get_distinct_id,Bt.prototype.toString=Bt.prototype.toString,Bt.prototype.opt_out_tracking=Bt.prototype.opt_out_tracking,Bt.prototype.opt_in_tracking=Bt.prototype.opt_in_tracking,Bt.prototype.has_opted_out_tracking=Bt.prototype.has_opted_out_tracking,Bt.prototype.has_opted_in_tracking=Bt.prototype.has_opted_in_tracking,Bt.prototype.clear_opt_in_out_tracking=Bt.prototype.clear_opt_in_out_tracking,Bt.prototype.get_group=Bt.prototype.get_group,Bt.prototype.set_group=Bt.prototype.set_group,Bt.prototype.add_group=Bt.prototype.add_group,Bt.prototype.remove_group=Bt.prototype.remove_group,Bt.prototype.track_with_groups=Bt.prototype.track_with_groups,Bt.prototype.start_batch_senders=Bt.prototype.start_batch_senders,Bt.prototype.stop_batch_senders=Bt.prototype.stop_batch_senders,Bt.prototype.DEFAULT_API_ROUTES=Dt,Mt.prototype.properties=Mt.prototype.properties,Mt.prototype.update_search_keyword=Mt.prototype.update_search_keyword,Mt.prototype.update_referrer_info=Mt.prototype.update_referrer_info,Mt.prototype.get_cross_subdomain=Mt.prototype.get_cross_subdomain,Mt.prototype.clear=Mt.prototype.clear;var Ut={},Gt=function(){St.init=function(t,e,i){if(i)return St[i]||(St[i]=Ut[i]=Ft(t,e,i),St[i]._loaded()),St[i];var n=St;Ut.mixpanel?n=Ut.mixpanel:t&&((n=Ft(t,e,"mixpanel"))._loaded(),Ut.mixpanel=n),St=n,1===Et&&(r.mixpanel=St),k.each(Ut,(function(t,e){"mixpanel"!==e&&(St[e]=t)})),St._=k}};var jt=(Et=0,St=new Bt,Gt(),St.init(),function(){function t(){t.done||(t.done=!0,kt=!0,Rt=!1,k.each(Ut,(function(t){t._dom_loaded()})))}if(S.addEventListener)"complete"===S.readyState?t():S.addEventListener("DOMContentLoaded",t,!1);else if(S.attachEvent){S.attachEvent("onreadystatechange",t);var e=!1;try{e=null===r.frameElement}catch(t){}S.documentElement.doScroll&&e&&function e(){try{S.documentElement.doScroll("left")}catch(t){return void setTimeout(e,1)}t()}()}k.register_event(r,"load",t,!0)}(),St);t.exports=jt},lnE3:function(t,e,i){"use strict";var r=Function.prototype.call,n=Object.prototype.hasOwnProperty,o=i("D3zA");t.exports=o.call(r,n)},mPeE:function(t,e){},ng4s:function(t,e,i){"use strict";i.r(e);var r=i("EVdn"),n=i.n(r);function o(t){return null!==t&&"object"==typeof t&&"constructor"in t&&t.constructor===Object}function s(t,e){void 0===t&&(t={}),void 0===e&&(e={}),Object.keys(e).forEach(i=>{void 0===t[i]?t[i]=e[i]:o(e[i])&&o(t[i])&&Object.keys(e[i]).length>0&&s(t[i],e[i])})}window.$=window.jQuery=n.a,window.axios=i("vDqi");const a={body:{},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector:()=>null,querySelectorAll:()=>[],getElementById:()=>null,createEvent:()=>({initEvent(){}}),createElement:()=>({children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName:()=>[]}),createElementNS:()=>({}),importNode:()=>null,location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""}};function l(){const t="undefined"!=typeof document?document:{};return s(t,a),t}const c={document:a,navigator:{userAgent:""},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""},history:{replaceState(){},pushState(){},go(){},back(){}},CustomEvent:function(){return this},addEventListener(){},removeEventListener(){},getComputedStyle:()=>({getPropertyValue:()=>""}),Image(){},Date(){},screen:{},setTimeout(){},clearTimeout(){},matchMedia:()=>({}),requestAnimationFrame:t=>"undefined"==typeof setTimeout?(t(),null):setTimeout(t,0),cancelAnimationFrame(t){"undefined"!=typeof setTimeout&&clearTimeout(t)}};function u(){const t="undefined"!=typeof window?window:{};return s(t,c),t}function h(t){return void 0===t&&(t=""),t.trim().split(" ").filter(t=>!!t.trim())}function d(t,e){return void 0===e&&(e=0),setTimeout(t,e)}function p(){return Date.now()}function f(t,e){void 0===e&&(e="x");const i=u();let r,n,o;const s=function(t){const e=u();let i;return e.getComputedStyle&&(i=e.getComputedStyle(t,null)),!i&&t.currentStyle&&(i=t.currentStyle),i||(i=t.style),i}(t);return i.WebKitCSSMatrix?(n=s.transform||s.webkitTransform,n.split(",").length>6&&(n=n.split(", ").map(t=>t.replace(",",".")).join(", ")),o=new i.WebKitCSSMatrix("none"===n?"":n)):(o=s.MozTransform||s.OTransform||s.MsTransform||s.msTransform||s.transform||s.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),r=o.toString().split(",")),"x"===e&&(n=i.WebKitCSSMatrix?o.m41:16===r.length?parseFloat(r[12]):parseFloat(r[4])),"y"===e&&(n=i.WebKitCSSMatrix?o.m42:16===r.length?parseFloat(r[13]):parseFloat(r[5])),n||0}function m(t){return"object"==typeof t&&null!==t&&t.constructor&&"Object"===Object.prototype.toString.call(t).slice(8,-1)}function g(t){return"undefined"!=typeof window&&void 0!==window.HTMLElement?t instanceof HTMLElement:t&&(1===t.nodeType||11===t.nodeType)}function _(){const t=Object(arguments.length<=0?void 0:arguments[0]),e=["__proto__","constructor","prototype"];for(let i=1;i<arguments.length;i+=1){const r=i<0||arguments.length<=i?void 0:arguments[i];if(null!=r&&!g(r)){const i=Object.keys(Object(r)).filter(t=>e.indexOf(t)<0);for(let e=0,n=i.length;e<n;e+=1){const n=i[e],o=Object.getOwnPropertyDescriptor(r,n);void 0!==o&&o.enumerable&&(m(t[n])&&m(r[n])?r[n].__swiper__?t[n]=r[n]:_(t[n],r[n]):!m(t[n])&&m(r[n])?(t[n]={},r[n].__swiper__?t[n]=r[n]:_(t[n],r[n])):t[n]=r[n])}}}return t}function y(t,e,i){t.style.setProperty(e,i)}function v(t){let{swiper:e,targetPosition:i,side:r}=t;const n=u(),o=-e.translate;let s,a=null;const l=e.params.speed;e.wrapperEl.style.scrollSnapType="none",n.cancelAnimationFrame(e.cssModeFrameID);const c=i>o?"next":"prev",h=(t,e)=>"next"===c&&t>=e||"prev"===c&&t<=e,d=()=>{s=(new Date).getTime(),null===a&&(a=s);const t=Math.max(Math.min((s-a)/l,1),0),c=.5-Math.cos(t*Math.PI)/2;let u=o+c*(i-o);if(h(u,i)&&(u=i),e.wrapperEl.scrollTo({[r]:u}),h(u,i))return e.wrapperEl.style.overflow="hidden",e.wrapperEl.style.scrollSnapType="",setTimeout(()=>{e.wrapperEl.style.overflow="",e.wrapperEl.scrollTo({[r]:u})}),void n.cancelAnimationFrame(e.cssModeFrameID);e.cssModeFrameID=n.requestAnimationFrame(d)};d()}function x(t){return t.querySelector(".swiper-slide-transform")||t.shadowRoot&&t.shadowRoot.querySelector(".swiper-slide-transform")||t}function b(t,e){return void 0===e&&(e=""),[...t.children].filter(t=>t.matches(e))}function w(t){try{return void console.warn(t)}catch(t){}}function T(t,e){void 0===e&&(e=[]);const i=document.createElement(t);return i.classList.add(...Array.isArray(e)?e:h(e)),i}function E(t){const e=u(),i=l(),r=t.getBoundingClientRect(),n=i.body,o=t.clientTop||n.clientTop||0,s=t.clientLeft||n.clientLeft||0,a=t===e?e.scrollY:t.scrollTop,c=t===e?e.scrollX:t.scrollLeft;return{top:r.top+a-o,left:r.left+c-s}}function S(t,e){return u().getComputedStyle(t,null).getPropertyValue(e)}function A(t){let e,i=t;if(i){for(e=0;null!==(i=i.previousSibling);)1===i.nodeType&&(e+=1);return e}}function M(t,e){const i=[];let r=t.parentElement;for(;r;)e?r.matches(e)&&i.push(r):i.push(r),r=r.parentElement;return i}function I(t,e){e&&t.addEventListener("transitionend",(function i(r){r.target===t&&(e.call(t,r),t.removeEventListener("transitionend",i))}))}function C(t,e,i){const r=u();return i?t["width"===e?"offsetWidth":"offsetHeight"]+parseFloat(r.getComputedStyle(t,null).getPropertyValue("width"===e?"margin-right":"margin-top"))+parseFloat(r.getComputedStyle(t,null).getPropertyValue("width"===e?"margin-left":"margin-bottom")):t.offsetWidth}function P(t){return(Array.isArray(t)?t:[t]).filter(t=>!!t)}let R,O,D;function L(){return R||(R=function(){const t=u(),e=l();return{smoothScroll:e.documentElement&&e.documentElement.style&&"scrollBehavior"in e.documentElement.style,touch:!!("ontouchstart"in t||t.DocumentTouch&&e instanceof t.DocumentTouch)}}()),R}function k(t){return void 0===t&&(t={}),O||(O=function(t){let{userAgent:e}=void 0===t?{}:t;const i=L(),r=u(),n=r.navigator.platform,o=e||r.navigator.userAgent,s={ios:!1,android:!1},a=r.screen.width,l=r.screen.height,c=o.match(/(Android);?[\s\/]+([\d.]+)?/);let h=o.match(/(iPad).*OS\s([\d_]+)/);const d=o.match(/(iPod)(.*OS\s([\d_]+))?/),p=!h&&o.match(/(iPhone\sOS|iOS)\s([\d_]+)/),f="Win32"===n;let m="MacIntel"===n;return!h&&m&&i.touch&&["1024x1366","1366x1024","834x1194","1194x834","834x1112","1112x834","768x1024","1024x768","820x1180","1180x820","810x1080","1080x810"].indexOf(`${a}x${l}`)>=0&&(h=o.match(/(Version)\/([\d.]+)/),h||(h=[0,1,"13_0_0"]),m=!1),c&&!f&&(s.os="android",s.android=!0),(h||p||d)&&(s.os="ios",s.ios=!0),s}(t)),O}function B(){return D||(D=function(){const t=u(),e=k();let i=!1;function r(){const e=t.navigator.userAgent.toLowerCase();return e.indexOf("safari")>=0&&e.indexOf("chrome")<0&&e.indexOf("android")<0}if(r()){const e=String(t.navigator.userAgent);if(e.includes("Version/")){const[t,r]=e.split("Version/")[1].split(" ")[0].split(".").map(t=>Number(t));i=t<16||16===t&&r<2}}const n=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(t.navigator.userAgent),o=r();return{isSafari:i||o,needPerspectiveFix:i,need3dFix:o||n&&e.ios,isWebView:n}}()),D}const F=(t,e)=>{if(!t||t.destroyed||!t.params)return;const i=e.closest(t.isElement?"swiper-slide":"."+t.params.slideClass);if(i){let e=i.querySelector("."+t.params.lazyPreloaderClass);!e&&t.isElement&&(i.shadowRoot?e=i.shadowRoot.querySelector("."+t.params.lazyPreloaderClass):requestAnimationFrame(()=>{i.shadowRoot&&(e=i.shadowRoot.querySelector("."+t.params.lazyPreloaderClass),e&&e.remove())})),e&&e.remove()}},z=(t,e)=>{if(!t.slides[e])return;const i=t.slides[e].querySelector('[loading="lazy"]');i&&i.removeAttribute("loading")},N=t=>{if(!t||t.destroyed||!t.params)return;let e=t.params.lazyPreloadPrevNext;const i=t.slides.length;if(!i||!e||e<0)return;e=Math.min(e,i);const r="auto"===t.params.slidesPerView?t.slidesPerViewDynamic():Math.ceil(t.params.slidesPerView),n=t.activeIndex;if(t.params.grid&&t.params.grid.rows>1){const i=n,o=[i-e];return o.push(...Array.from({length:e}).map((t,e)=>i+r+e)),void t.slides.forEach((e,i)=>{o.includes(e.column)&&z(t,i)})}const o=n+r-1;if(t.params.rewind||t.params.loop)for(let r=n-e;r<=o+e;r+=1){const e=(r%i+i)%i;(e<n||e>o)&&z(t,e)}else for(let r=Math.max(n-e,0);r<=Math.min(o+e,i-1);r+=1)r!==n&&(r>o||r<n)&&z(t,r)};function U(t){let{swiper:e,runCallbacks:i,direction:r,step:n}=t;const{activeIndex:o,previousIndex:s}=e;let a=r;if(a||(a=o>s?"next":o<s?"prev":"reset"),e.emit("transition"+n),i&&o!==s){if("reset"===a)return void e.emit("slideResetTransition"+n);e.emit("slideChangeTransition"+n),"next"===a?e.emit("slideNextTransition"+n):e.emit("slidePrevTransition"+n)}}function G(t,e,i){const r=u(),{params:n}=t,o=n.edgeSwipeDetection,s=n.edgeSwipeThreshold;return!o||!(i<=s||i>=r.innerWidth-s)||"prevent"===o&&(e.preventDefault(),!0)}function j(t){const e=this,i=l();let r=t;r.originalEvent&&(r=r.originalEvent);const n=e.touchEventsData;if("pointerdown"===r.type){if(null!==n.pointerId&&n.pointerId!==r.pointerId)return;n.pointerId=r.pointerId}else"touchstart"===r.type&&1===r.targetTouches.length&&(n.touchId=r.targetTouches[0].identifier);if("touchstart"===r.type)return void G(e,r,r.targetTouches[0].pageX);const{params:o,touches:s,enabled:a}=e;if(!a)return;if(!o.simulateTouch&&"mouse"===r.pointerType)return;if(e.animating&&o.preventInteractionOnTransition)return;!e.animating&&o.cssMode&&o.loop&&e.loopFix();let c=r.target;if("wrapper"===o.touchEventsTarget&&!e.wrapperEl.contains(c))return;if("which"in r&&3===r.which)return;if("button"in r&&r.button>0)return;if(n.isTouched&&n.isMoved)return;const h=!!o.noSwipingClass&&""!==o.noSwipingClass,d=r.composedPath?r.composedPath():r.path;h&&r.target&&r.target.shadowRoot&&d&&(c=d[0]);const f=o.noSwipingSelector?o.noSwipingSelector:"."+o.noSwipingClass,m=!(!r.target||!r.target.shadowRoot);if(o.noSwiping&&(m?function(t,e){return void 0===e&&(e=this),function e(i){if(!i||i===l()||i===u())return null;i.assignedSlot&&(i=i.assignedSlot);const r=i.closest(t);return r||i.getRootNode?r||e(i.getRootNode().host):null}(e)}(f,c):c.closest(f)))return void(e.allowClick=!0);if(o.swipeHandler&&!c.closest(o.swipeHandler))return;s.currentX=r.pageX,s.currentY=r.pageY;const g=s.currentX,_=s.currentY;if(!G(e,r,g))return;Object.assign(n,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),s.startX=g,s.startY=_,n.touchStartTime=p(),e.allowClick=!0,e.updateSize(),e.swipeDirection=void 0,o.threshold>0&&(n.allowThresholdMove=!1);let y=!0;c.matches(n.focusableElements)&&(y=!1,"SELECT"===c.nodeName&&(n.isTouched=!1)),i.activeElement&&i.activeElement.matches(n.focusableElements)&&i.activeElement!==c&&i.activeElement.blur();const v=y&&e.allowTouchMove&&o.touchStartPreventDefault;!o.touchStartForcePreventDefault&&!v||c.isContentEditable||r.preventDefault(),o.freeMode&&o.freeMode.enabled&&e.freeMode&&e.animating&&!o.cssMode&&e.freeMode.onTouchStart(),e.emit("touchStart",r)}function V(t){const e=l(),i=this,r=i.touchEventsData,{params:n,touches:o,rtlTranslate:s,enabled:a}=i;if(!a)return;if(!n.simulateTouch&&"mouse"===t.pointerType)return;let c,u=t;if(u.originalEvent&&(u=u.originalEvent),"pointermove"===u.type){if(null!==r.touchId)return;if(u.pointerId!==r.pointerId)return}if("touchmove"===u.type){if(c=[...u.changedTouches].filter(t=>t.identifier===r.touchId)[0],!c||c.identifier!==r.touchId)return}else c=u;if(!r.isTouched)return void(r.startMoving&&r.isScrolling&&i.emit("touchMoveOpposite",u));const h=c.pageX,d=c.pageY;if(u.preventedByNestedSwiper)return o.startX=h,void(o.startY=d);if(!i.allowTouchMove)return u.target.matches(r.focusableElements)||(i.allowClick=!1),void(r.isTouched&&(Object.assign(o,{startX:h,startY:d,currentX:h,currentY:d}),r.touchStartTime=p()));if(n.touchReleaseOnEdges&&!n.loop)if(i.isVertical()){if(d<o.startY&&i.translate<=i.maxTranslate()||d>o.startY&&i.translate>=i.minTranslate())return r.isTouched=!1,void(r.isMoved=!1)}else if(h<o.startX&&i.translate<=i.maxTranslate()||h>o.startX&&i.translate>=i.minTranslate())return;if(e.activeElement&&u.target===e.activeElement&&u.target.matches(r.focusableElements))return r.isMoved=!0,void(i.allowClick=!1);r.allowTouchCallbacks&&i.emit("touchMove",u),o.previousX=o.currentX,o.previousY=o.currentY,o.currentX=h,o.currentY=d;const f=o.currentX-o.startX,m=o.currentY-o.startY;if(i.params.threshold&&Math.sqrt(f**2+m**2)<i.params.threshold)return;if(void 0===r.isScrolling){let t;i.isHorizontal()&&o.currentY===o.startY||i.isVertical()&&o.currentX===o.startX?r.isScrolling=!1:f*f+m*m>=25&&(t=180*Math.atan2(Math.abs(m),Math.abs(f))/Math.PI,r.isScrolling=i.isHorizontal()?t>n.touchAngle:90-t>n.touchAngle)}if(r.isScrolling&&i.emit("touchMoveOpposite",u),void 0===r.startMoving&&(o.currentX===o.startX&&o.currentY===o.startY||(r.startMoving=!0)),r.isScrolling)return void(r.isTouched=!1);if(!r.startMoving)return;i.allowClick=!1,!n.cssMode&&u.cancelable&&u.preventDefault(),n.touchMoveStopPropagation&&!n.nested&&u.stopPropagation();let g=i.isHorizontal()?f:m,_=i.isHorizontal()?o.currentX-o.previousX:o.currentY-o.previousY;n.oneWayMovement&&(g=Math.abs(g)*(s?1:-1),_=Math.abs(_)*(s?1:-1)),o.diff=g,g*=n.touchRatio,s&&(g=-g,_=-_);const y=i.touchesDirection;i.swipeDirection=g>0?"prev":"next",i.touchesDirection=_>0?"prev":"next";const v=i.params.loop&&!n.cssMode,x="next"===i.touchesDirection&&i.allowSlideNext||"prev"===i.touchesDirection&&i.allowSlidePrev;if(!r.isMoved){if(v&&x&&i.loopFix({direction:i.swipeDirection}),r.startTranslate=i.getTranslate(),i.setTransition(0),i.animating){const t=new window.CustomEvent("transitionend",{bubbles:!0,cancelable:!0});i.wrapperEl.dispatchEvent(t)}r.allowMomentumBounce=!1,!n.grabCursor||!0!==i.allowSlideNext&&!0!==i.allowSlidePrev||i.setGrabCursor(!0),i.emit("sliderFirstMove",u)}if((new Date).getTime(),r.isMoved&&r.allowThresholdMove&&y!==i.touchesDirection&&v&&x&&Math.abs(g)>=1)return Object.assign(o,{startX:h,startY:d,currentX:h,currentY:d,startTranslate:r.currentTranslate}),r.loopSwapReset=!0,void(r.startTranslate=r.currentTranslate);i.emit("sliderMove",u),r.isMoved=!0,r.currentTranslate=g+r.startTranslate;let b=!0,w=n.resistanceRatio;if(n.touchReleaseOnEdges&&(w=0),g>0?(v&&x&&r.allowThresholdMove&&r.currentTranslate>(n.centeredSlides?i.minTranslate()-i.slidesSizesGrid[i.activeIndex+1]:i.minTranslate())&&i.loopFix({direction:"prev",setTranslate:!0,activeSlideIndex:0}),r.currentTranslate>i.minTranslate()&&(b=!1,n.resistance&&(r.currentTranslate=i.minTranslate()-1+(-i.minTranslate()+r.startTranslate+g)**w))):g<0&&(v&&x&&r.allowThresholdMove&&r.currentTranslate<(n.centeredSlides?i.maxTranslate()+i.slidesSizesGrid[i.slidesSizesGrid.length-1]:i.maxTranslate())&&i.loopFix({direction:"next",setTranslate:!0,activeSlideIndex:i.slides.length-("auto"===n.slidesPerView?i.slidesPerViewDynamic():Math.ceil(parseFloat(n.slidesPerView,10)))}),r.currentTranslate<i.maxTranslate()&&(b=!1,n.resistance&&(r.currentTranslate=i.maxTranslate()+1-(i.maxTranslate()-r.startTranslate-g)**w))),b&&(u.preventedByNestedSwiper=!0),!i.allowSlideNext&&"next"===i.swipeDirection&&r.currentTranslate<r.startTranslate&&(r.currentTranslate=r.startTranslate),!i.allowSlidePrev&&"prev"===i.swipeDirection&&r.currentTranslate>r.startTranslate&&(r.currentTranslate=r.startTranslate),i.allowSlidePrev||i.allowSlideNext||(r.currentTranslate=r.startTranslate),n.threshold>0){if(!(Math.abs(g)>n.threshold||r.allowThresholdMove))return void(r.currentTranslate=r.startTranslate);if(!r.allowThresholdMove)return r.allowThresholdMove=!0,o.startX=o.currentX,o.startY=o.currentY,r.currentTranslate=r.startTranslate,void(o.diff=i.isHorizontal()?o.currentX-o.startX:o.currentY-o.startY)}n.followFinger&&!n.cssMode&&((n.freeMode&&n.freeMode.enabled&&i.freeMode||n.watchSlidesProgress)&&(i.updateActiveIndex(),i.updateSlidesClasses()),n.freeMode&&n.freeMode.enabled&&i.freeMode&&i.freeMode.onTouchMove(),i.updateProgress(r.currentTranslate),i.setTranslate(r.currentTranslate))}function X(t){const e=this,i=e.touchEventsData;let r,n=t;n.originalEvent&&(n=n.originalEvent);if("touchend"===n.type||"touchcancel"===n.type){if(r=[...n.changedTouches].filter(t=>t.identifier===i.touchId)[0],!r||r.identifier!==i.touchId)return}else{if(null!==i.touchId)return;if(n.pointerId!==i.pointerId)return;r=n}if(["pointercancel","pointerout","pointerleave","contextmenu"].includes(n.type)){if(!(["pointercancel","contextmenu"].includes(n.type)&&(e.browser.isSafari||e.browser.isWebView)))return}i.pointerId=null,i.touchId=null;const{params:o,touches:s,rtlTranslate:a,slidesGrid:l,enabled:c}=e;if(!c)return;if(!o.simulateTouch&&"mouse"===n.pointerType)return;if(i.allowTouchCallbacks&&e.emit("touchEnd",n),i.allowTouchCallbacks=!1,!i.isTouched)return i.isMoved&&o.grabCursor&&e.setGrabCursor(!1),i.isMoved=!1,void(i.startMoving=!1);o.grabCursor&&i.isMoved&&i.isTouched&&(!0===e.allowSlideNext||!0===e.allowSlidePrev)&&e.setGrabCursor(!1);const u=p(),h=u-i.touchStartTime;if(e.allowClick){const t=n.path||n.composedPath&&n.composedPath();e.updateClickedSlide(t&&t[0]||n.target,t),e.emit("tap click",n),h<300&&u-i.lastClickTime<300&&e.emit("doubleTap doubleClick",n)}if(i.lastClickTime=p(),d(()=>{e.destroyed||(e.allowClick=!0)}),!i.isTouched||!i.isMoved||!e.swipeDirection||0===s.diff&&!i.loopSwapReset||i.currentTranslate===i.startTranslate&&!i.loopSwapReset)return i.isTouched=!1,i.isMoved=!1,void(i.startMoving=!1);let f;if(i.isTouched=!1,i.isMoved=!1,i.startMoving=!1,f=o.followFinger?a?e.translate:-e.translate:-i.currentTranslate,o.cssMode)return;if(o.freeMode&&o.freeMode.enabled)return void e.freeMode.onTouchEnd({currentPos:f});const m=f>=-e.maxTranslate()&&!e.params.loop;let g=0,_=e.slidesSizesGrid[0];for(let t=0;t<l.length;t+=t<o.slidesPerGroupSkip?1:o.slidesPerGroup){const e=t<o.slidesPerGroupSkip-1?1:o.slidesPerGroup;void 0!==l[t+e]?(m||f>=l[t]&&f<l[t+e])&&(g=t,_=l[t+e]-l[t]):(m||f>=l[t])&&(g=t,_=l[l.length-1]-l[l.length-2])}let y=null,v=null;o.rewind&&(e.isBeginning?v=o.virtual&&o.virtual.enabled&&e.virtual?e.virtual.slides.length-1:e.slides.length-1:e.isEnd&&(y=0));const x=(f-l[g])/_,b=g<o.slidesPerGroupSkip-1?1:o.slidesPerGroup;if(h>o.longSwipesMs){if(!o.longSwipes)return void e.slideTo(e.activeIndex);"next"===e.swipeDirection&&(x>=o.longSwipesRatio?e.slideTo(o.rewind&&e.isEnd?y:g+b):e.slideTo(g)),"prev"===e.swipeDirection&&(x>1-o.longSwipesRatio?e.slideTo(g+b):null!==v&&x<0&&Math.abs(x)>o.longSwipesRatio?e.slideTo(v):e.slideTo(g))}else{if(!o.shortSwipes)return void e.slideTo(e.activeIndex);e.navigation&&(n.target===e.navigation.nextEl||n.target===e.navigation.prevEl)?n.target===e.navigation.nextEl?e.slideTo(g+b):e.slideTo(g):("next"===e.swipeDirection&&e.slideTo(null!==y?y:g+b),"prev"===e.swipeDirection&&e.slideTo(null!==v?v:g))}}function H(){const t=this,{params:e,el:i}=t;if(i&&0===i.offsetWidth)return;e.breakpoints&&t.setBreakpoint();const{allowSlideNext:r,allowSlidePrev:n,snapGrid:o}=t,s=t.virtual&&t.params.virtual.enabled;t.allowSlideNext=!0,t.allowSlidePrev=!0,t.updateSize(),t.updateSlides(),t.updateSlidesClasses();const a=s&&e.loop;!("auto"===e.slidesPerView||e.slidesPerView>1)||!t.isEnd||t.isBeginning||t.params.centeredSlides||a?t.params.loop&&!s?t.slideToLoop(t.realIndex,0,!1,!0):t.slideTo(t.activeIndex,0,!1,!0):t.slideTo(t.slides.length-1,0,!1,!0),t.autoplay&&t.autoplay.running&&t.autoplay.paused&&(clearTimeout(t.autoplay.resizeTimeout),t.autoplay.resizeTimeout=setTimeout(()=>{t.autoplay&&t.autoplay.running&&t.autoplay.paused&&t.autoplay.resume()},500)),t.allowSlidePrev=n,t.allowSlideNext=r,t.params.watchOverflow&&o!==t.snapGrid&&t.checkOverflow()}function q(t){const e=this;e.enabled&&(e.allowClick||(e.params.preventClicks&&t.preventDefault(),e.params.preventClicksPropagation&&e.animating&&(t.stopPropagation(),t.stopImmediatePropagation())))}function W(){const t=this,{wrapperEl:e,rtlTranslate:i,enabled:r}=t;if(!r)return;let n;t.previousTranslate=t.translate,t.isHorizontal()?t.translate=-e.scrollLeft:t.translate=-e.scrollTop,0===t.translate&&(t.translate=0),t.updateActiveIndex(),t.updateSlidesClasses();const o=t.maxTranslate()-t.minTranslate();n=0===o?0:(t.translate-t.minTranslate())/o,n!==t.progress&&t.updateProgress(i?-t.translate:t.translate),t.emit("setTranslate",t.translate,!1)}function Y(t){F(this,t.target),this.params.cssMode||"auto"!==this.params.slidesPerView&&!this.params.autoHeight||this.update()}function Z(){const t=this;t.documentTouchHandlerProceeded||(t.documentTouchHandlerProceeded=!0,t.params.touchReleaseOnEdges&&(t.el.style.touchAction="auto"))}const K=(t,e)=>{const i=l(),{params:r,el:n,wrapperEl:o,device:s}=t,a=!!r.nested,c="on"===e?"addEventListener":"removeEventListener",u=e;i[c]("touchstart",t.onDocumentTouchStart,{passive:!1,capture:a}),n[c]("touchstart",t.onTouchStart,{passive:!1}),n[c]("pointerdown",t.onTouchStart,{passive:!1}),i[c]("touchmove",t.onTouchMove,{passive:!1,capture:a}),i[c]("pointermove",t.onTouchMove,{passive:!1,capture:a}),i[c]("touchend",t.onTouchEnd,{passive:!0}),i[c]("pointerup",t.onTouchEnd,{passive:!0}),i[c]("pointercancel",t.onTouchEnd,{passive:!0}),i[c]("touchcancel",t.onTouchEnd,{passive:!0}),i[c]("pointerout",t.onTouchEnd,{passive:!0}),i[c]("pointerleave",t.onTouchEnd,{passive:!0}),i[c]("contextmenu",t.onTouchEnd,{passive:!0}),(r.preventClicks||r.preventClicksPropagation)&&n[c]("click",t.onClick,!0),r.cssMode&&o[c]("scroll",t.onScroll),r.updateOnWindowResize?t[u](s.ios||s.android?"resize orientationchange observerUpdate":"resize observerUpdate",H,!0):t[u]("observerUpdate",H,!0),n[c]("load",t.onLoad,{capture:!0})};const J=(t,e)=>t.grid&&e.grid&&e.grid.rows>1;var Q={init:!0,direction:"horizontal",oneWayMovement:!1,swiperElementNodeName:"SWIPER-CONTAINER",touchEventsTarget:"wrapper",initialSlide:0,speed:300,cssMode:!1,updateOnWindowResize:!0,resizeObserver:!0,nested:!1,createElements:!1,eventsPrefix:"swiper",enabled:!0,focusableElements:"input, select, option, textarea, button, video, label",width:null,height:null,preventInteractionOnTransition:!1,userAgent:null,url:null,edgeSwipeDetection:!1,edgeSwipeThreshold:20,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",breakpoints:void 0,breakpointsBase:"window",spaceBetween:0,slidesPerView:1,slidesPerGroup:1,slidesPerGroupSkip:0,slidesPerGroupAuto:!1,centeredSlides:!1,centeredSlidesBounds:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,normalizeSlideIndex:!0,centerInsufficientSlides:!1,watchOverflow:!0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,allowTouchMove:!0,threshold:5,touchMoveStopPropagation:!1,touchStartPreventDefault:!0,touchStartForcePreventDefault:!1,touchReleaseOnEdges:!1,uniqueNavElements:!0,resistance:!0,resistanceRatio:.85,watchSlidesProgress:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,loop:!1,loopAddBlankSlides:!0,loopAdditionalSlides:0,loopPreventsSliding:!0,rewind:!1,allowSlidePrev:!0,allowSlideNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",noSwipingSelector:null,passiveListeners:!0,maxBackfaceHiddenSlides:10,containerModifierClass:"swiper-",slideClass:"swiper-slide",slideBlankClass:"swiper-slide-blank",slideActiveClass:"swiper-slide-active",slideVisibleClass:"swiper-slide-visible",slideFullyVisibleClass:"swiper-slide-fully-visible",slideNextClass:"swiper-slide-next",slidePrevClass:"swiper-slide-prev",wrapperClass:"swiper-wrapper",lazyPreloaderClass:"swiper-lazy-preloader",lazyPreloadPrevNext:0,runCallbacksOnInit:!0,_emitClasses:!1};function tt(t,e){return function(i){void 0===i&&(i={});const r=Object.keys(i)[0],n=i[r];"object"==typeof n&&null!==n?(!0===t[r]&&(t[r]={enabled:!0}),"navigation"===r&&t[r]&&t[r].enabled&&!t[r].prevEl&&!t[r].nextEl&&(t[r].auto=!0),["pagination","scrollbar"].indexOf(r)>=0&&t[r]&&t[r].enabled&&!t[r].el&&(t[r].auto=!0),r in t&&"enabled"in n?("object"!=typeof t[r]||"enabled"in t[r]||(t[r].enabled=!0),t[r]||(t[r]={enabled:!1}),_(e,i)):_(e,i)):_(e,i)}}const et={eventsEmitter:{on(t,e,i){const r=this;if(!r.eventsListeners||r.destroyed)return r;if("function"!=typeof e)return r;const n=i?"unshift":"push";return t.split(" ").forEach(t=>{r.eventsListeners[t]||(r.eventsListeners[t]=[]),r.eventsListeners[t][n](e)}),r},once(t,e,i){const r=this;if(!r.eventsListeners||r.destroyed)return r;if("function"!=typeof e)return r;function n(){r.off(t,n),n.__emitterProxy&&delete n.__emitterProxy;for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];e.apply(r,o)}return n.__emitterProxy=e,r.on(t,n,i)},onAny(t,e){const i=this;if(!i.eventsListeners||i.destroyed)return i;if("function"!=typeof t)return i;const r=e?"unshift":"push";return i.eventsAnyListeners.indexOf(t)<0&&i.eventsAnyListeners[r](t),i},offAny(t){const e=this;if(!e.eventsListeners||e.destroyed)return e;if(!e.eventsAnyListeners)return e;const i=e.eventsAnyListeners.indexOf(t);return i>=0&&e.eventsAnyListeners.splice(i,1),e},off(t,e){const i=this;return!i.eventsListeners||i.destroyed?i:i.eventsListeners?(t.split(" ").forEach(t=>{void 0===e?i.eventsListeners[t]=[]:i.eventsListeners[t]&&i.eventsListeners[t].forEach((r,n)=>{(r===e||r.__emitterProxy&&r.__emitterProxy===e)&&i.eventsListeners[t].splice(n,1)})}),i):i},emit(){const t=this;if(!t.eventsListeners||t.destroyed)return t;if(!t.eventsListeners)return t;let e,i,r;for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];"string"==typeof o[0]||Array.isArray(o[0])?(e=o[0],i=o.slice(1,o.length),r=t):(e=o[0].events,i=o[0].data,r=o[0].context||t),i.unshift(r);return(Array.isArray(e)?e:e.split(" ")).forEach(e=>{t.eventsAnyListeners&&t.eventsAnyListeners.length&&t.eventsAnyListeners.forEach(t=>{t.apply(r,[e,...i])}),t.eventsListeners&&t.eventsListeners[e]&&t.eventsListeners[e].forEach(t=>{t.apply(r,i)})}),t}},update:{updateSize:function(){const t=this;let e,i;const r=t.el;e=void 0!==t.params.width&&null!==t.params.width?t.params.width:r.clientWidth,i=void 0!==t.params.height&&null!==t.params.height?t.params.height:r.clientHeight,0===e&&t.isHorizontal()||0===i&&t.isVertical()||(e=e-parseInt(S(r,"padding-left")||0,10)-parseInt(S(r,"padding-right")||0,10),i=i-parseInt(S(r,"padding-top")||0,10)-parseInt(S(r,"padding-bottom")||0,10),Number.isNaN(e)&&(e=0),Number.isNaN(i)&&(i=0),Object.assign(t,{width:e,height:i,size:t.isHorizontal()?e:i}))},updateSlides:function(){const t=this;function e(e,i){return parseFloat(e.getPropertyValue(t.getDirectionLabel(i))||0)}const i=t.params,{wrapperEl:r,slidesEl:n,size:o,rtlTranslate:s,wrongRTL:a}=t,l=t.virtual&&i.virtual.enabled,c=l?t.virtual.slides.length:t.slides.length,u=b(n,`.${t.params.slideClass}, swiper-slide`),h=l?t.virtual.slides.length:u.length;let d=[];const p=[],f=[];let m=i.slidesOffsetBefore;"function"==typeof m&&(m=i.slidesOffsetBefore.call(t));let g=i.slidesOffsetAfter;"function"==typeof g&&(g=i.slidesOffsetAfter.call(t));const _=t.snapGrid.length,v=t.slidesGrid.length;let x=i.spaceBetween,w=-m,T=0,E=0;if(void 0===o)return;"string"==typeof x&&x.indexOf("%")>=0?x=parseFloat(x.replace("%",""))/100*o:"string"==typeof x&&(x=parseFloat(x)),t.virtualSize=-x,u.forEach(t=>{s?t.style.marginLeft="":t.style.marginRight="",t.style.marginBottom="",t.style.marginTop=""}),i.centeredSlides&&i.cssMode&&(y(r,"--swiper-centered-offset-before",""),y(r,"--swiper-centered-offset-after",""));const A=i.grid&&i.grid.rows>1&&t.grid;let M;A?t.grid.initSlides(u):t.grid&&t.grid.unsetSlides();const I="auto"===i.slidesPerView&&i.breakpoints&&Object.keys(i.breakpoints).filter(t=>void 0!==i.breakpoints[t].slidesPerView).length>0;for(let r=0;r<h;r+=1){let n;if(M=0,u[r]&&(n=u[r]),A&&t.grid.updateSlide(r,n,u),!u[r]||"none"!==S(n,"display")){if("auto"===i.slidesPerView){I&&(u[r].style[t.getDirectionLabel("width")]="");const o=getComputedStyle(n),s=n.style.transform,a=n.style.webkitTransform;if(s&&(n.style.transform="none"),a&&(n.style.webkitTransform="none"),i.roundLengths)M=t.isHorizontal()?C(n,"width",!0):C(n,"height",!0);else{const t=e(o,"width"),i=e(o,"padding-left"),r=e(o,"padding-right"),s=e(o,"margin-left"),a=e(o,"margin-right"),l=o.getPropertyValue("box-sizing");if(l&&"border-box"===l)M=t+s+a;else{const{clientWidth:e,offsetWidth:o}=n;M=t+i+r+s+a+(o-e)}}s&&(n.style.transform=s),a&&(n.style.webkitTransform=a),i.roundLengths&&(M=Math.floor(M))}else M=(o-(i.slidesPerView-1)*x)/i.slidesPerView,i.roundLengths&&(M=Math.floor(M)),u[r]&&(u[r].style[t.getDirectionLabel("width")]=M+"px");u[r]&&(u[r].swiperSlideSize=M),f.push(M),i.centeredSlides?(w=w+M/2+T/2+x,0===T&&0!==r&&(w=w-o/2-x),0===r&&(w=w-o/2-x),Math.abs(w)<.001&&(w=0),i.roundLengths&&(w=Math.floor(w)),E%i.slidesPerGroup==0&&d.push(w),p.push(w)):(i.roundLengths&&(w=Math.floor(w)),(E-Math.min(t.params.slidesPerGroupSkip,E))%t.params.slidesPerGroup==0&&d.push(w),p.push(w),w=w+M+x),t.virtualSize+=M+x,T=M,E+=1}}if(t.virtualSize=Math.max(t.virtualSize,o)+g,s&&a&&("slide"===i.effect||"coverflow"===i.effect)&&(r.style.width=t.virtualSize+x+"px"),i.setWrapperSize&&(r.style[t.getDirectionLabel("width")]=t.virtualSize+x+"px"),A&&t.grid.updateWrapperSize(M,d),!i.centeredSlides){const e=[];for(let r=0;r<d.length;r+=1){let n=d[r];i.roundLengths&&(n=Math.floor(n)),d[r]<=t.virtualSize-o&&e.push(n)}d=e,Math.floor(t.virtualSize-o)-Math.floor(d[d.length-1])>1&&d.push(t.virtualSize-o)}if(l&&i.loop){const e=f[0]+x;if(i.slidesPerGroup>1){const r=Math.ceil((t.virtual.slidesBefore+t.virtual.slidesAfter)/i.slidesPerGroup),n=e*i.slidesPerGroup;for(let t=0;t<r;t+=1)d.push(d[d.length-1]+n)}for(let r=0;r<t.virtual.slidesBefore+t.virtual.slidesAfter;r+=1)1===i.slidesPerGroup&&d.push(d[d.length-1]+e),p.push(p[p.length-1]+e),t.virtualSize+=e}if(0===d.length&&(d=[0]),0!==x){const e=t.isHorizontal()&&s?"marginLeft":t.getDirectionLabel("marginRight");u.filter((t,e)=>!(i.cssMode&&!i.loop)||e!==u.length-1).forEach(t=>{t.style[e]=x+"px"})}if(i.centeredSlides&&i.centeredSlidesBounds){let t=0;f.forEach(e=>{t+=e+(x||0)}),t-=x;const e=t-o;d=d.map(t=>t<=0?-m:t>e?e+g:t)}if(i.centerInsufficientSlides){let t=0;if(f.forEach(e=>{t+=e+(x||0)}),t-=x,t<o){const e=(o-t)/2;d.forEach((t,i)=>{d[i]=t-e}),p.forEach((t,i)=>{p[i]=t+e})}}if(Object.assign(t,{slides:u,snapGrid:d,slidesGrid:p,slidesSizesGrid:f}),i.centeredSlides&&i.cssMode&&!i.centeredSlidesBounds){y(r,"--swiper-centered-offset-before",-d[0]+"px"),y(r,"--swiper-centered-offset-after",t.size/2-f[f.length-1]/2+"px");const e=-t.snapGrid[0],i=-t.slidesGrid[0];t.snapGrid=t.snapGrid.map(t=>t+e),t.slidesGrid=t.slidesGrid.map(t=>t+i)}if(h!==c&&t.emit("slidesLengthChange"),d.length!==_&&(t.params.watchOverflow&&t.checkOverflow(),t.emit("snapGridLengthChange")),p.length!==v&&t.emit("slidesGridLengthChange"),i.watchSlidesProgress&&t.updateSlidesOffset(),t.emit("slidesUpdated"),!(l||i.cssMode||"slide"!==i.effect&&"fade"!==i.effect)){const e=i.containerModifierClass+"backface-hidden",r=t.el.classList.contains(e);h<=i.maxBackfaceHiddenSlides?r||t.el.classList.add(e):r&&t.el.classList.remove(e)}},updateAutoHeight:function(t){const e=this,i=[],r=e.virtual&&e.params.virtual.enabled;let n,o=0;"number"==typeof t?e.setTransition(t):!0===t&&e.setTransition(e.params.speed);const s=t=>r?e.slides[e.getSlideIndexByData(t)]:e.slides[t];if("auto"!==e.params.slidesPerView&&e.params.slidesPerView>1)if(e.params.centeredSlides)(e.visibleSlides||[]).forEach(t=>{i.push(t)});else for(n=0;n<Math.ceil(e.params.slidesPerView);n+=1){const t=e.activeIndex+n;if(t>e.slides.length&&!r)break;i.push(s(t))}else i.push(s(e.activeIndex));for(n=0;n<i.length;n+=1)if(void 0!==i[n]){const t=i[n].offsetHeight;o=t>o?t:o}(o||0===o)&&(e.wrapperEl.style.height=o+"px")},updateSlidesOffset:function(){const t=this,e=t.slides,i=t.isElement?t.isHorizontal()?t.wrapperEl.offsetLeft:t.wrapperEl.offsetTop:0;for(let r=0;r<e.length;r+=1)e[r].swiperSlideOffset=(t.isHorizontal()?e[r].offsetLeft:e[r].offsetTop)-i-t.cssOverflowAdjustment()},updateSlidesProgress:function(t){void 0===t&&(t=this&&this.translate||0);const e=this,i=e.params,{slides:r,rtlTranslate:n,snapGrid:o}=e;if(0===r.length)return;void 0===r[0].swiperSlideOffset&&e.updateSlidesOffset();let s=-t;n&&(s=t),r.forEach(t=>{t.classList.remove(i.slideVisibleClass,i.slideFullyVisibleClass)}),e.visibleSlidesIndexes=[],e.visibleSlides=[];let a=i.spaceBetween;"string"==typeof a&&a.indexOf("%")>=0?a=parseFloat(a.replace("%",""))/100*e.size:"string"==typeof a&&(a=parseFloat(a));for(let t=0;t<r.length;t+=1){const l=r[t];let c=l.swiperSlideOffset;i.cssMode&&i.centeredSlides&&(c-=r[0].swiperSlideOffset);const u=(s+(i.centeredSlides?e.minTranslate():0)-c)/(l.swiperSlideSize+a),h=(s-o[0]+(i.centeredSlides?e.minTranslate():0)-c)/(l.swiperSlideSize+a),d=-(s-c),p=d+e.slidesSizesGrid[t],f=d>=0&&d<=e.size-e.slidesSizesGrid[t];(d>=0&&d<e.size-1||p>1&&p<=e.size||d<=0&&p>=e.size)&&(e.visibleSlides.push(l),e.visibleSlidesIndexes.push(t),r[t].classList.add(i.slideVisibleClass)),f&&r[t].classList.add(i.slideFullyVisibleClass),l.progress=n?-u:u,l.originalProgress=n?-h:h}},updateProgress:function(t){const e=this;if(void 0===t){const i=e.rtlTranslate?-1:1;t=e&&e.translate&&e.translate*i||0}const i=e.params,r=e.maxTranslate()-e.minTranslate();let{progress:n,isBeginning:o,isEnd:s,progressLoop:a}=e;const l=o,c=s;if(0===r)n=0,o=!0,s=!0;else{n=(t-e.minTranslate())/r;const i=Math.abs(t-e.minTranslate())<1,a=Math.abs(t-e.maxTranslate())<1;o=i||n<=0,s=a||n>=1,i&&(n=0),a&&(n=1)}if(i.loop){const i=e.getSlideIndexByData(0),r=e.getSlideIndexByData(e.slides.length-1),n=e.slidesGrid[i],o=e.slidesGrid[r],s=e.slidesGrid[e.slidesGrid.length-1],l=Math.abs(t);a=l>=n?(l-n)/s:(l+s-o)/s,a>1&&(a-=1)}Object.assign(e,{progress:n,progressLoop:a,isBeginning:o,isEnd:s}),(i.watchSlidesProgress||i.centeredSlides&&i.autoHeight)&&e.updateSlidesProgress(t),o&&!l&&e.emit("reachBeginning toEdge"),s&&!c&&e.emit("reachEnd toEdge"),(l&&!o||c&&!s)&&e.emit("fromEdge"),e.emit("progress",n)},updateSlidesClasses:function(){const t=this,{slides:e,params:i,slidesEl:r,activeIndex:n}=t,o=t.virtual&&i.virtual.enabled,s=t.grid&&i.grid&&i.grid.rows>1,a=t=>b(r,`.${i.slideClass}${t}, swiper-slide${t}`)[0];let l,c,u;if(e.forEach(t=>{t.classList.remove(i.slideActiveClass,i.slideNextClass,i.slidePrevClass)}),o)if(i.loop){let e=n-t.virtual.slidesBefore;e<0&&(e=t.virtual.slides.length+e),e>=t.virtual.slides.length&&(e-=t.virtual.slides.length),l=a(`[data-swiper-slide-index="${e}"]`)}else l=a(`[data-swiper-slide-index="${n}"]`);else s?(l=e.filter(t=>t.column===n)[0],u=e.filter(t=>t.column===n+1)[0],c=e.filter(t=>t.column===n-1)[0]):l=e[n];l&&(l.classList.add(i.slideActiveClass),s?(u&&u.classList.add(i.slideNextClass),c&&c.classList.add(i.slidePrevClass)):(u=function(t,e){const i=[];for(;t.nextElementSibling;){const r=t.nextElementSibling;e?r.matches(e)&&i.push(r):i.push(r),t=r}return i}(l,`.${i.slideClass}, swiper-slide`)[0],i.loop&&!u&&(u=e[0]),u&&u.classList.add(i.slideNextClass),c=function(t,e){const i=[];for(;t.previousElementSibling;){const r=t.previousElementSibling;e?r.matches(e)&&i.push(r):i.push(r),t=r}return i}(l,`.${i.slideClass}, swiper-slide`)[0],i.loop&&0===!c&&(c=e[e.length-1]),c&&c.classList.add(i.slidePrevClass))),t.emitSlidesClasses()},updateActiveIndex:function(t){const e=this,i=e.rtlTranslate?e.translate:-e.translate,{snapGrid:r,params:n,activeIndex:o,realIndex:s,snapIndex:a}=e;let l,c=t;const u=t=>{let i=t-e.virtual.slidesBefore;return i<0&&(i=e.virtual.slides.length+i),i>=e.virtual.slides.length&&(i-=e.virtual.slides.length),i};if(void 0===c&&(c=function(t){const{slidesGrid:e,params:i}=t,r=t.rtlTranslate?t.translate:-t.translate;let n;for(let t=0;t<e.length;t+=1)void 0!==e[t+1]?r>=e[t]&&r<e[t+1]-(e[t+1]-e[t])/2?n=t:r>=e[t]&&r<e[t+1]&&(n=t+1):r>=e[t]&&(n=t);return i.normalizeSlideIndex&&(n<0||void 0===n)&&(n=0),n}(e)),r.indexOf(i)>=0)l=r.indexOf(i);else{const t=Math.min(n.slidesPerGroupSkip,c);l=t+Math.floor((c-t)/n.slidesPerGroup)}if(l>=r.length&&(l=r.length-1),c===o&&!e.params.loop)return void(l!==a&&(e.snapIndex=l,e.emit("snapIndexChange")));if(c===o&&e.params.loop&&e.virtual&&e.params.virtual.enabled)return void(e.realIndex=u(c));const h=e.grid&&n.grid&&n.grid.rows>1;let d;if(e.virtual&&n.virtual.enabled&&n.loop)d=u(c);else if(h){const t=e.slides.filter(t=>t.column===c)[0];let i=parseInt(t.getAttribute("data-swiper-slide-index"),10);Number.isNaN(i)&&(i=Math.max(e.slides.indexOf(t),0)),d=Math.floor(i/n.grid.rows)}else if(e.slides[c]){const t=e.slides[c].getAttribute("data-swiper-slide-index");d=t?parseInt(t,10):c}else d=c;Object.assign(e,{previousSnapIndex:a,snapIndex:l,previousRealIndex:s,realIndex:d,previousIndex:o,activeIndex:c}),e.initialized&&N(e),e.emit("activeIndexChange"),e.emit("snapIndexChange"),(e.initialized||e.params.runCallbacksOnInit)&&(s!==d&&e.emit("realIndexChange"),e.emit("slideChange"))},updateClickedSlide:function(t,e){const i=this,r=i.params;let n=t.closest(`.${r.slideClass}, swiper-slide`);!n&&i.isElement&&e&&e.length>1&&e.includes(t)&&[...e.slice(e.indexOf(t)+1,e.length)].forEach(t=>{!n&&t.matches&&t.matches(`.${r.slideClass}, swiper-slide`)&&(n=t)});let o,s=!1;if(n)for(let t=0;t<i.slides.length;t+=1)if(i.slides[t]===n){s=!0,o=t;break}if(!n||!s)return i.clickedSlide=void 0,void(i.clickedIndex=void 0);i.clickedSlide=n,i.virtual&&i.params.virtual.enabled?i.clickedIndex=parseInt(n.getAttribute("data-swiper-slide-index"),10):i.clickedIndex=o,r.slideToClickedSlide&&void 0!==i.clickedIndex&&i.clickedIndex!==i.activeIndex&&i.slideToClickedSlide()}},translate:{getTranslate:function(t){void 0===t&&(t=this.isHorizontal()?"x":"y");const{params:e,rtlTranslate:i,translate:r,wrapperEl:n}=this;if(e.virtualTranslate)return i?-r:r;if(e.cssMode)return r;let o=f(n,t);return o+=this.cssOverflowAdjustment(),i&&(o=-o),o||0},setTranslate:function(t,e){const i=this,{rtlTranslate:r,params:n,wrapperEl:o,progress:s}=i;let a,l=0,c=0;i.isHorizontal()?l=r?-t:t:c=t,n.roundLengths&&(l=Math.floor(l),c=Math.floor(c)),i.previousTranslate=i.translate,i.translate=i.isHorizontal()?l:c,n.cssMode?o[i.isHorizontal()?"scrollLeft":"scrollTop"]=i.isHorizontal()?-l:-c:n.virtualTranslate||(i.isHorizontal()?l-=i.cssOverflowAdjustment():c-=i.cssOverflowAdjustment(),o.style.transform=`translate3d(${l}px, ${c}px, 0px)`);const u=i.maxTranslate()-i.minTranslate();a=0===u?0:(t-i.minTranslate())/u,a!==s&&i.updateProgress(t),i.emit("setTranslate",i.translate,e)},minTranslate:function(){return-this.snapGrid[0]},maxTranslate:function(){return-this.snapGrid[this.snapGrid.length-1]},translateTo:function(t,e,i,r,n){void 0===t&&(t=0),void 0===e&&(e=this.params.speed),void 0===i&&(i=!0),void 0===r&&(r=!0);const o=this,{params:s,wrapperEl:a}=o;if(o.animating&&s.preventInteractionOnTransition)return!1;const l=o.minTranslate(),c=o.maxTranslate();let u;if(u=r&&t>l?l:r&&t<c?c:t,o.updateProgress(u),s.cssMode){const t=o.isHorizontal();if(0===e)a[t?"scrollLeft":"scrollTop"]=-u;else{if(!o.support.smoothScroll)return v({swiper:o,targetPosition:-u,side:t?"left":"top"}),!0;a.scrollTo({[t?"left":"top"]:-u,behavior:"smooth"})}return!0}return 0===e?(o.setTransition(0),o.setTranslate(u),i&&(o.emit("beforeTransitionStart",e,n),o.emit("transitionEnd"))):(o.setTransition(e),o.setTranslate(u),i&&(o.emit("beforeTransitionStart",e,n),o.emit("transitionStart")),o.animating||(o.animating=!0,o.onTranslateToWrapperTransitionEnd||(o.onTranslateToWrapperTransitionEnd=function(t){o&&!o.destroyed&&t.target===this&&(o.wrapperEl.removeEventListener("transitionend",o.onTranslateToWrapperTransitionEnd),o.onTranslateToWrapperTransitionEnd=null,delete o.onTranslateToWrapperTransitionEnd,i&&o.emit("transitionEnd"))}),o.wrapperEl.addEventListener("transitionend",o.onTranslateToWrapperTransitionEnd))),!0}},transition:{setTransition:function(t,e){const i=this;i.params.cssMode||(i.wrapperEl.style.transitionDuration=t+"ms",i.wrapperEl.style.transitionDelay=0===t?"0ms":""),i.emit("setTransition",t,e)},transitionStart:function(t,e){void 0===t&&(t=!0);const i=this,{params:r}=i;r.cssMode||(r.autoHeight&&i.updateAutoHeight(),U({swiper:i,runCallbacks:t,direction:e,step:"Start"}))},transitionEnd:function(t,e){void 0===t&&(t=!0);const{params:i}=this;this.animating=!1,i.cssMode||(this.setTransition(0),U({swiper:this,runCallbacks:t,direction:e,step:"End"}))}},slide:{slideTo:function(t,e,i,r,n){void 0===t&&(t=0),void 0===e&&(e=this.params.speed),void 0===i&&(i=!0),"string"==typeof t&&(t=parseInt(t,10));const o=this;let s=t;s<0&&(s=0);const{params:a,snapGrid:l,slidesGrid:c,previousIndex:u,activeIndex:h,rtlTranslate:d,wrapperEl:p,enabled:f}=o;if(o.animating&&a.preventInteractionOnTransition||!f&&!r&&!n||o.destroyed)return!1;const m=Math.min(o.params.slidesPerGroupSkip,s);let g=m+Math.floor((s-m)/o.params.slidesPerGroup);g>=l.length&&(g=l.length-1);const _=-l[g];if(a.normalizeSlideIndex)for(let t=0;t<c.length;t+=1){const e=-Math.floor(100*_),i=Math.floor(100*c[t]),r=Math.floor(100*c[t+1]);void 0!==c[t+1]?e>=i&&e<r-(r-i)/2?s=t:e>=i&&e<r&&(s=t+1):e>=i&&(s=t)}if(o.initialized&&s!==h){if(!o.allowSlideNext&&(d?_>o.translate&&_>o.minTranslate():_<o.translate&&_<o.minTranslate()))return!1;if(!o.allowSlidePrev&&_>o.translate&&_>o.maxTranslate()&&(h||0)!==s)return!1}let y;if(s!==(u||0)&&i&&o.emit("beforeSlideChangeStart"),o.updateProgress(_),y=s>h?"next":s<h?"prev":"reset",d&&-_===o.translate||!d&&_===o.translate)return o.updateActiveIndex(s),a.autoHeight&&o.updateAutoHeight(),o.updateSlidesClasses(),"slide"!==a.effect&&o.setTranslate(_),"reset"!==y&&(o.transitionStart(i,y),o.transitionEnd(i,y)),!1;if(a.cssMode){const t=o.isHorizontal(),i=d?_:-_;if(0===e){const e=o.virtual&&o.params.virtual.enabled;e&&(o.wrapperEl.style.scrollSnapType="none",o._immediateVirtual=!0),e&&!o._cssModeVirtualInitialSet&&o.params.initialSlide>0?(o._cssModeVirtualInitialSet=!0,requestAnimationFrame(()=>{p[t?"scrollLeft":"scrollTop"]=i})):p[t?"scrollLeft":"scrollTop"]=i,e&&requestAnimationFrame(()=>{o.wrapperEl.style.scrollSnapType="",o._immediateVirtual=!1})}else{if(!o.support.smoothScroll)return v({swiper:o,targetPosition:i,side:t?"left":"top"}),!0;p.scrollTo({[t?"left":"top"]:i,behavior:"smooth"})}return!0}return o.setTransition(e),o.setTranslate(_),o.updateActiveIndex(s),o.updateSlidesClasses(),o.emit("beforeTransitionStart",e,r),o.transitionStart(i,y),0===e?o.transitionEnd(i,y):o.animating||(o.animating=!0,o.onSlideToWrapperTransitionEnd||(o.onSlideToWrapperTransitionEnd=function(t){o&&!o.destroyed&&t.target===this&&(o.wrapperEl.removeEventListener("transitionend",o.onSlideToWrapperTransitionEnd),o.onSlideToWrapperTransitionEnd=null,delete o.onSlideToWrapperTransitionEnd,o.transitionEnd(i,y))}),o.wrapperEl.addEventListener("transitionend",o.onSlideToWrapperTransitionEnd)),!0},slideToLoop:function(t,e,i,r){if(void 0===t&&(t=0),void 0===e&&(e=this.params.speed),void 0===i&&(i=!0),"string"==typeof t){t=parseInt(t,10)}const n=this;if(n.destroyed)return;const o=n.grid&&n.params.grid&&n.params.grid.rows>1;let s=t;if(n.params.loop)if(n.virtual&&n.params.virtual.enabled)s+=n.virtual.slidesBefore;else{let t;if(o){const e=s*n.params.grid.rows;t=n.slides.filter(t=>1*t.getAttribute("data-swiper-slide-index")===e)[0].column}else t=n.getSlideIndexByData(s);const e=o?Math.ceil(n.slides.length/n.params.grid.rows):n.slides.length,{centeredSlides:i}=n.params;let r=n.params.slidesPerView;"auto"===r?r=n.slidesPerViewDynamic():(r=Math.ceil(parseFloat(n.params.slidesPerView,10)),i&&r%2==0&&(r+=1));let a=e-t<r;if(i&&(a=a||t<Math.ceil(r/2)),a){const r=i?t<n.activeIndex?"prev":"next":t-n.activeIndex-1<n.params.slidesPerView?"next":"prev";n.loopFix({direction:r,slideTo:!0,activeSlideIndex:"next"===r?t+1:t-e+1,slideRealIndex:"next"===r?n.realIndex:void 0})}if(o){const t=s*n.params.grid.rows;s=n.slides.filter(e=>1*e.getAttribute("data-swiper-slide-index")===t)[0].column}else s=n.getSlideIndexByData(s)}return requestAnimationFrame(()=>{n.slideTo(s,e,i,r)}),n},slideNext:function(t,e,i){void 0===t&&(t=this.params.speed),void 0===e&&(e=!0);const r=this,{enabled:n,params:o,animating:s}=r;if(!n||r.destroyed)return r;let a=o.slidesPerGroup;"auto"===o.slidesPerView&&1===o.slidesPerGroup&&o.slidesPerGroupAuto&&(a=Math.max(r.slidesPerViewDynamic("current",!0),1));const l=r.activeIndex<o.slidesPerGroupSkip?1:a,c=r.virtual&&o.virtual.enabled;if(o.loop){if(s&&!c&&o.loopPreventsSliding)return!1;if(r.loopFix({direction:"next"}),r._clientLeft=r.wrapperEl.clientLeft,r.activeIndex===r.slides.length-1&&o.cssMode)return requestAnimationFrame(()=>{r.slideTo(r.activeIndex+l,t,e,i)}),!0}return o.rewind&&r.isEnd?r.slideTo(0,t,e,i):r.slideTo(r.activeIndex+l,t,e,i)},slidePrev:function(t,e,i){void 0===t&&(t=this.params.speed),void 0===e&&(e=!0);const r=this,{params:n,snapGrid:o,slidesGrid:s,rtlTranslate:a,enabled:l,animating:c}=r;if(!l||r.destroyed)return r;const u=r.virtual&&n.virtual.enabled;if(n.loop){if(c&&!u&&n.loopPreventsSliding)return!1;r.loopFix({direction:"prev"}),r._clientLeft=r.wrapperEl.clientLeft}function h(t){return t<0?-Math.floor(Math.abs(t)):Math.floor(t)}const d=h(a?r.translate:-r.translate),p=o.map(t=>h(t));let f=o[p.indexOf(d)-1];if(void 0===f&&n.cssMode){let t;o.forEach((e,i)=>{d>=e&&(t=i)}),void 0!==t&&(f=o[t>0?t-1:t])}let m=0;if(void 0!==f&&(m=s.indexOf(f),m<0&&(m=r.activeIndex-1),"auto"===n.slidesPerView&&1===n.slidesPerGroup&&n.slidesPerGroupAuto&&(m=m-r.slidesPerViewDynamic("previous",!0)+1,m=Math.max(m,0))),n.rewind&&r.isBeginning){const n=r.params.virtual&&r.params.virtual.enabled&&r.virtual?r.virtual.slides.length-1:r.slides.length-1;return r.slideTo(n,t,e,i)}return n.loop&&0===r.activeIndex&&n.cssMode?(requestAnimationFrame(()=>{r.slideTo(m,t,e,i)}),!0):r.slideTo(m,t,e,i)},slideReset:function(t,e,i){if(void 0===t&&(t=this.params.speed),void 0===e&&(e=!0),!this.destroyed)return this.slideTo(this.activeIndex,t,e,i)},slideToClosest:function(t,e,i,r){void 0===t&&(t=this.params.speed),void 0===e&&(e=!0),void 0===r&&(r=.5);const n=this;if(n.destroyed)return;let o=n.activeIndex;const s=Math.min(n.params.slidesPerGroupSkip,o),a=s+Math.floor((o-s)/n.params.slidesPerGroup),l=n.rtlTranslate?n.translate:-n.translate;if(l>=n.snapGrid[a]){const t=n.snapGrid[a];l-t>(n.snapGrid[a+1]-t)*r&&(o+=n.params.slidesPerGroup)}else{const t=n.snapGrid[a-1];l-t<=(n.snapGrid[a]-t)*r&&(o-=n.params.slidesPerGroup)}return o=Math.max(o,0),o=Math.min(o,n.slidesGrid.length-1),n.slideTo(o,t,e,i)},slideToClickedSlide:function(){const t=this;if(t.destroyed)return;const{params:e,slidesEl:i}=t,r="auto"===e.slidesPerView?t.slidesPerViewDynamic():e.slidesPerView;let n,o=t.clickedIndex;const s=t.isElement?"swiper-slide":"."+e.slideClass;if(e.loop){if(t.animating)return;n=parseInt(t.clickedSlide.getAttribute("data-swiper-slide-index"),10),e.centeredSlides?o<t.loopedSlides-r/2||o>t.slides.length-t.loopedSlides+r/2?(t.loopFix(),o=t.getSlideIndex(b(i,`${s}[data-swiper-slide-index="${n}"]`)[0]),d(()=>{t.slideTo(o)})):t.slideTo(o):o>t.slides.length-r?(t.loopFix(),o=t.getSlideIndex(b(i,`${s}[data-swiper-slide-index="${n}"]`)[0]),d(()=>{t.slideTo(o)})):t.slideTo(o)}else t.slideTo(o)}},loop:{loopCreate:function(t){const e=this,{params:i,slidesEl:r}=e;if(!i.loop||e.virtual&&e.params.virtual.enabled)return;const n=()=>{b(r,`.${i.slideClass}, swiper-slide`).forEach((t,e)=>{t.setAttribute("data-swiper-slide-index",e)})},o=e.grid&&i.grid&&i.grid.rows>1,s=i.slidesPerGroup*(o?i.grid.rows:1),a=e.slides.length%s!=0,l=o&&e.slides.length%i.grid.rows!=0,c=t=>{for(let r=0;r<t;r+=1){const t=e.isElement?T("swiper-slide",[i.slideBlankClass]):T("div",[i.slideClass,i.slideBlankClass]);e.slidesEl.append(t)}};if(a){if(i.loopAddBlankSlides){c(s-e.slides.length%s),e.recalcSlides(),e.updateSlides()}else w("Swiper Loop Warning: The number of slides is not even to slidesPerGroup, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)");n()}else if(l){if(i.loopAddBlankSlides){c(i.grid.rows-e.slides.length%i.grid.rows),e.recalcSlides(),e.updateSlides()}else w("Swiper Loop Warning: The number of slides is not even to grid.rows, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)");n()}else n();e.loopFix({slideRealIndex:t,direction:i.centeredSlides?void 0:"next"})},loopFix:function(t){let{slideRealIndex:e,slideTo:i=!0,direction:r,setTranslate:n,activeSlideIndex:o,byController:s,byMousewheel:a}=void 0===t?{}:t;const l=this;if(!l.params.loop)return;l.emit("beforeLoopFix");const{slides:c,allowSlidePrev:u,allowSlideNext:h,slidesEl:d,params:p}=l,{centeredSlides:f}=p;if(l.allowSlidePrev=!0,l.allowSlideNext=!0,l.virtual&&p.virtual.enabled)return i&&(p.centeredSlides||0!==l.snapIndex?p.centeredSlides&&l.snapIndex<p.slidesPerView?l.slideTo(l.virtual.slides.length+l.snapIndex,0,!1,!0):l.snapIndex===l.snapGrid.length-1&&l.slideTo(l.virtual.slidesBefore,0,!1,!0):l.slideTo(l.virtual.slides.length,0,!1,!0)),l.allowSlidePrev=u,l.allowSlideNext=h,void l.emit("loopFix");let m=p.slidesPerView;"auto"===m?m=l.slidesPerViewDynamic():(m=Math.ceil(parseFloat(p.slidesPerView,10)),f&&m%2==0&&(m+=1));const g=p.slidesPerGroupAuto?m:p.slidesPerGroup;let _=g;_%g!=0&&(_+=g-_%g),_+=p.loopAdditionalSlides,l.loopedSlides=_;const y=l.grid&&p.grid&&p.grid.rows>1;c.length<m+_?w("Swiper Loop Warning: The number of slides is not enough for loop mode, it will be disabled and not function properly. You need to add more slides (or make duplicates) or lower the values of slidesPerView and slidesPerGroup parameters"):y&&"row"===p.grid.fill&&w("Swiper Loop Warning: Loop mode is not compatible with grid.fill = `row`");const v=[],x=[];let b=l.activeIndex;void 0===o?o=l.getSlideIndex(c.filter(t=>t.classList.contains(p.slideActiveClass))[0]):b=o;const T="next"===r||!r,E="prev"===r||!r;let S=0,A=0;const M=y?Math.ceil(c.length/p.grid.rows):c.length,I=(y?c[o].column:o)+(f&&void 0===n?-m/2+.5:0);if(I<_){S=Math.max(_-I,g);for(let t=0;t<_-I;t+=1){const e=t-Math.floor(t/M)*M;if(y){const t=M-e-1;for(let e=c.length-1;e>=0;e-=1)c[e].column===t&&v.push(e)}else v.push(M-e-1)}}else if(I+m>M-_){A=Math.max(I-(M-2*_),g);for(let t=0;t<A;t+=1){const e=t-Math.floor(t/M)*M;y?c.forEach((t,i)=>{t.column===e&&x.push(i)}):x.push(e)}}if(l.__preventObserver__=!0,requestAnimationFrame(()=>{l.__preventObserver__=!1}),E&&v.forEach(t=>{c[t].swiperLoopMoveDOM=!0,d.prepend(c[t]),c[t].swiperLoopMoveDOM=!1}),T&&x.forEach(t=>{c[t].swiperLoopMoveDOM=!0,d.append(c[t]),c[t].swiperLoopMoveDOM=!1}),l.recalcSlides(),"auto"===p.slidesPerView?l.updateSlides():y&&(v.length>0&&E||x.length>0&&T)&&l.slides.forEach((t,e)=>{l.grid.updateSlide(e,t,l.slides)}),p.watchSlidesProgress&&l.updateSlidesOffset(),i)if(v.length>0&&E){if(void 0===e){const t=l.slidesGrid[b],e=l.slidesGrid[b+S]-t;a?l.setTranslate(l.translate-e):(l.slideTo(b+S,0,!1,!0),n&&(l.touchEventsData.startTranslate=l.touchEventsData.startTranslate-e,l.touchEventsData.currentTranslate=l.touchEventsData.currentTranslate-e))}else if(n){const t=y?v.length/p.grid.rows:v.length;l.slideTo(l.activeIndex+t,0,!1,!0),l.touchEventsData.currentTranslate=l.translate}}else if(x.length>0&&T)if(void 0===e){const t=l.slidesGrid[b],e=l.slidesGrid[b-A]-t;a?l.setTranslate(l.translate-e):(l.slideTo(b-A,0,!1,!0),n&&(l.touchEventsData.startTranslate=l.touchEventsData.startTranslate-e,l.touchEventsData.currentTranslate=l.touchEventsData.currentTranslate-e))}else{const t=y?x.length/p.grid.rows:x.length;l.slideTo(l.activeIndex-t,0,!1,!0)}if(l.allowSlidePrev=u,l.allowSlideNext=h,l.controller&&l.controller.control&&!s){const t={slideRealIndex:e,direction:r,setTranslate:n,activeSlideIndex:o,byController:!0};Array.isArray(l.controller.control)?l.controller.control.forEach(e=>{!e.destroyed&&e.params.loop&&e.loopFix({...t,slideTo:e.params.slidesPerView===p.slidesPerView&&i})}):l.controller.control instanceof l.constructor&&l.controller.control.params.loop&&l.controller.control.loopFix({...t,slideTo:l.controller.control.params.slidesPerView===p.slidesPerView&&i})}l.emit("loopFix")},loopDestroy:function(){const{params:t,slidesEl:e}=this;if(!t.loop||this.virtual&&this.params.virtual.enabled)return;this.recalcSlides();const i=[];this.slides.forEach(t=>{const e=void 0===t.swiperSlideIndex?1*t.getAttribute("data-swiper-slide-index"):t.swiperSlideIndex;i[e]=t}),this.slides.forEach(t=>{t.removeAttribute("data-swiper-slide-index")}),i.forEach(t=>{e.append(t)}),this.recalcSlides(),this.slideTo(this.realIndex,0)}},grabCursor:{setGrabCursor:function(t){const e=this;if(!e.params.simulateTouch||e.params.watchOverflow&&e.isLocked||e.params.cssMode)return;const i="container"===e.params.touchEventsTarget?e.el:e.wrapperEl;e.isElement&&(e.__preventObserver__=!0),i.style.cursor="move",i.style.cursor=t?"grabbing":"grab",e.isElement&&requestAnimationFrame(()=>{e.__preventObserver__=!1})},unsetGrabCursor:function(){const t=this;t.params.watchOverflow&&t.isLocked||t.params.cssMode||(t.isElement&&(t.__preventObserver__=!0),t["container"===t.params.touchEventsTarget?"el":"wrapperEl"].style.cursor="",t.isElement&&requestAnimationFrame(()=>{t.__preventObserver__=!1}))}},events:{attachEvents:function(){const t=this,{params:e}=t;t.onTouchStart=j.bind(t),t.onTouchMove=V.bind(t),t.onTouchEnd=X.bind(t),t.onDocumentTouchStart=Z.bind(t),e.cssMode&&(t.onScroll=W.bind(t)),t.onClick=q.bind(t),t.onLoad=Y.bind(t),K(t,"on")},detachEvents:function(){K(this,"off")}},breakpoints:{setBreakpoint:function(){const t=this,{realIndex:e,initialized:i,params:r,el:n}=t,o=r.breakpoints;if(!o||o&&0===Object.keys(o).length)return;const s=t.getBreakpoint(o,t.params.breakpointsBase,t.el);if(!s||t.currentBreakpoint===s)return;const a=(s in o?o[s]:void 0)||t.originalParams,l=J(t,r),c=J(t,a),u=r.enabled;l&&!c?(n.classList.remove(r.containerModifierClass+"grid",r.containerModifierClass+"grid-column"),t.emitContainerClasses()):!l&&c&&(n.classList.add(r.containerModifierClass+"grid"),(a.grid.fill&&"column"===a.grid.fill||!a.grid.fill&&"column"===r.grid.fill)&&n.classList.add(r.containerModifierClass+"grid-column"),t.emitContainerClasses()),["navigation","pagination","scrollbar"].forEach(e=>{if(void 0===a[e])return;const i=r[e]&&r[e].enabled,n=a[e]&&a[e].enabled;i&&!n&&t[e].disable(),!i&&n&&t[e].enable()});const h=a.direction&&a.direction!==r.direction,d=r.loop&&(a.slidesPerView!==r.slidesPerView||h),p=r.loop;h&&i&&t.changeDirection(),_(t.params,a);const f=t.params.enabled,m=t.params.loop;Object.assign(t,{allowTouchMove:t.params.allowTouchMove,allowSlideNext:t.params.allowSlideNext,allowSlidePrev:t.params.allowSlidePrev}),u&&!f?t.disable():!u&&f&&t.enable(),t.currentBreakpoint=s,t.emit("_beforeBreakpoint",a),i&&(d?(t.loopDestroy(),t.loopCreate(e),t.updateSlides()):!p&&m?(t.loopCreate(e),t.updateSlides()):p&&!m&&t.loopDestroy()),t.emit("breakpoint",a)},getBreakpoint:function(t,e,i){if(void 0===e&&(e="window"),!t||"container"===e&&!i)return;let r=!1;const n=u(),o="window"===e?n.innerHeight:i.clientHeight,s=Object.keys(t).map(t=>{if("string"==typeof t&&0===t.indexOf("@")){const e=parseFloat(t.substr(1));return{value:o*e,point:t}}return{value:t,point:t}});s.sort((t,e)=>parseInt(t.value,10)-parseInt(e.value,10));for(let t=0;t<s.length;t+=1){const{point:o,value:a}=s[t];"window"===e?n.matchMedia(`(min-width: ${a}px)`).matches&&(r=o):a<=i.clientWidth&&(r=o)}return r||"max"}},checkOverflow:{checkOverflow:function(){const t=this,{isLocked:e,params:i}=t,{slidesOffsetBefore:r}=i;if(r){const e=t.slides.length-1,i=t.slidesGrid[e]+t.slidesSizesGrid[e]+2*r;t.isLocked=t.size>i}else t.isLocked=1===t.snapGrid.length;!0===i.allowSlideNext&&(t.allowSlideNext=!t.isLocked),!0===i.allowSlidePrev&&(t.allowSlidePrev=!t.isLocked),e&&e!==t.isLocked&&(t.isEnd=!1),e!==t.isLocked&&t.emit(t.isLocked?"lock":"unlock")}},classes:{addClasses:function(){const{classNames:t,params:e,rtl:i,el:r,device:n}=this,o=function(t,e){const i=[];return t.forEach(t=>{"object"==typeof t?Object.keys(t).forEach(r=>{t[r]&&i.push(e+r)}):"string"==typeof t&&i.push(e+t)}),i}(["initialized",e.direction,{"free-mode":this.params.freeMode&&e.freeMode.enabled},{autoheight:e.autoHeight},{rtl:i},{grid:e.grid&&e.grid.rows>1},{"grid-column":e.grid&&e.grid.rows>1&&"column"===e.grid.fill},{android:n.android},{ios:n.ios},{"css-mode":e.cssMode},{centered:e.cssMode&&e.centeredSlides},{"watch-progress":e.watchSlidesProgress}],e.containerModifierClass);t.push(...o),r.classList.add(...t),this.emitContainerClasses()},removeClasses:function(){const{el:t,classNames:e}=this;t.classList.remove(...e),this.emitContainerClasses()}}},it={};class rt{constructor(){let t,e;for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];1===r.length&&r[0].constructor&&"Object"===Object.prototype.toString.call(r[0]).slice(8,-1)?e=r[0]:[t,e]=r,e||(e={}),e=_({},e),t&&!e.el&&(e.el=t);const o=l();if(e.el&&"string"==typeof e.el&&o.querySelectorAll(e.el).length>1){const t=[];return o.querySelectorAll(e.el).forEach(i=>{const r=_({},e,{el:i});t.push(new rt(r))}),t}const s=this;s.__swiper__=!0,s.support=L(),s.device=k({userAgent:e.userAgent}),s.browser=B(),s.eventsListeners={},s.eventsAnyListeners=[],s.modules=[...s.__modules__],e.modules&&Array.isArray(e.modules)&&s.modules.push(...e.modules);const a={};s.modules.forEach(t=>{t({params:e,swiper:s,extendParams:tt(e,a),on:s.on.bind(s),once:s.once.bind(s),off:s.off.bind(s),emit:s.emit.bind(s)})});const c=_({},Q,a);return s.params=_({},c,it,e),s.originalParams=_({},s.params),s.passedParams=_({},e),s.params&&s.params.on&&Object.keys(s.params.on).forEach(t=>{s.on(t,s.params.on[t])}),s.params&&s.params.onAny&&s.onAny(s.params.onAny),Object.assign(s,{enabled:s.params.enabled,el:t,classNames:[],slides:[],slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal:()=>"horizontal"===s.params.direction,isVertical:()=>"vertical"===s.params.direction,activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,previousTranslate:0,progress:0,velocity:0,animating:!1,cssOverflowAdjustment(){return Math.trunc(this.translate/2**23)*2**23},allowSlideNext:s.params.allowSlideNext,allowSlidePrev:s.params.allowSlidePrev,touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,focusableElements:s.params.focusableElements,lastClickTime:0,clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,startMoving:void 0,pointerId:null,touchId:null},allowClick:!0,allowTouchMove:s.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),s.emit("_swiper"),s.params.init&&s.init(),s}getDirectionLabel(t){return this.isHorizontal()?t:{width:"height","margin-top":"margin-left","margin-bottom ":"margin-right","margin-left":"margin-top","margin-right":"margin-bottom","padding-left":"padding-top","padding-right":"padding-bottom",marginRight:"marginBottom"}[t]}getSlideIndex(t){const{slidesEl:e,params:i}=this,r=A(b(e,`.${i.slideClass}, swiper-slide`)[0]);return A(t)-r}getSlideIndexByData(t){return this.getSlideIndex(this.slides.filter(e=>1*e.getAttribute("data-swiper-slide-index")===t)[0])}recalcSlides(){const{slidesEl:t,params:e}=this;this.slides=b(t,`.${e.slideClass}, swiper-slide`)}enable(){const t=this;t.enabled||(t.enabled=!0,t.params.grabCursor&&t.setGrabCursor(),t.emit("enable"))}disable(){const t=this;t.enabled&&(t.enabled=!1,t.params.grabCursor&&t.unsetGrabCursor(),t.emit("disable"))}setProgress(t,e){t=Math.min(Math.max(t,0),1);const i=this.minTranslate(),r=(this.maxTranslate()-i)*t+i;this.translateTo(r,void 0===e?0:e),this.updateActiveIndex(),this.updateSlidesClasses()}emitContainerClasses(){const t=this;if(!t.params._emitClasses||!t.el)return;const e=t.el.className.split(" ").filter(e=>0===e.indexOf("swiper")||0===e.indexOf(t.params.containerModifierClass));t.emit("_containerClasses",e.join(" "))}getSlideClasses(t){const e=this;return e.destroyed?"":t.className.split(" ").filter(t=>0===t.indexOf("swiper-slide")||0===t.indexOf(e.params.slideClass)).join(" ")}emitSlidesClasses(){const t=this;if(!t.params._emitClasses||!t.el)return;const e=[];t.slides.forEach(i=>{const r=t.getSlideClasses(i);e.push({slideEl:i,classNames:r}),t.emit("_slideClass",i,r)}),t.emit("_slideClasses",e)}slidesPerViewDynamic(t,e){void 0===t&&(t="current"),void 0===e&&(e=!1);const{params:i,slides:r,slidesGrid:n,slidesSizesGrid:o,size:s,activeIndex:a}=this;let l=1;if("number"==typeof i.slidesPerView)return i.slidesPerView;if(i.centeredSlides){let t,e=r[a]?Math.ceil(r[a].swiperSlideSize):0;for(let i=a+1;i<r.length;i+=1)r[i]&&!t&&(e+=Math.ceil(r[i].swiperSlideSize),l+=1,e>s&&(t=!0));for(let i=a-1;i>=0;i-=1)r[i]&&!t&&(e+=r[i].swiperSlideSize,l+=1,e>s&&(t=!0))}else if("current"===t)for(let t=a+1;t<r.length;t+=1){(e?n[t]+o[t]-n[a]<s:n[t]-n[a]<s)&&(l+=1)}else for(let t=a-1;t>=0;t-=1){n[a]-n[t]<s&&(l+=1)}return l}update(){const t=this;if(!t||t.destroyed)return;const{snapGrid:e,params:i}=t;function r(){const e=t.rtlTranslate?-1*t.translate:t.translate,i=Math.min(Math.max(e,t.maxTranslate()),t.minTranslate());t.setTranslate(i),t.updateActiveIndex(),t.updateSlidesClasses()}let n;if(i.breakpoints&&t.setBreakpoint(),[...t.el.querySelectorAll('[loading="lazy"]')].forEach(e=>{e.complete&&F(t,e)}),t.updateSize(),t.updateSlides(),t.updateProgress(),t.updateSlidesClasses(),i.freeMode&&i.freeMode.enabled&&!i.cssMode)r(),i.autoHeight&&t.updateAutoHeight();else{if(("auto"===i.slidesPerView||i.slidesPerView>1)&&t.isEnd&&!i.centeredSlides){const e=t.virtual&&i.virtual.enabled?t.virtual.slides:t.slides;n=t.slideTo(e.length-1,0,!1,!0)}else n=t.slideTo(t.activeIndex,0,!1,!0);n||r()}i.watchOverflow&&e!==t.snapGrid&&t.checkOverflow(),t.emit("update")}changeDirection(t,e){void 0===e&&(e=!0);const i=this,r=i.params.direction;return t||(t="horizontal"===r?"vertical":"horizontal"),t===r||"horizontal"!==t&&"vertical"!==t||(i.el.classList.remove(`${i.params.containerModifierClass}${r}`),i.el.classList.add(`${i.params.containerModifierClass}${t}`),i.emitContainerClasses(),i.params.direction=t,i.slides.forEach(e=>{"vertical"===t?e.style.width="":e.style.height=""}),i.emit("changeDirection"),e&&i.update()),i}changeLanguageDirection(t){const e=this;e.rtl&&"rtl"===t||!e.rtl&&"ltr"===t||(e.rtl="rtl"===t,e.rtlTranslate="horizontal"===e.params.direction&&e.rtl,e.rtl?(e.el.classList.add(e.params.containerModifierClass+"rtl"),e.el.dir="rtl"):(e.el.classList.remove(e.params.containerModifierClass+"rtl"),e.el.dir="ltr"),e.update())}mount(t){const e=this;if(e.mounted)return!0;let i=t||e.params.el;if("string"==typeof i&&(i=document.querySelector(i)),!i)return!1;i.swiper=e,i.parentNode&&i.parentNode.host&&i.parentNode.host.nodeName===e.params.swiperElementNodeName.toUpperCase()&&(e.isElement=!0);const r=()=>"."+(e.params.wrapperClass||"").trim().split(" ").join(".");let n=(()=>{if(i&&i.shadowRoot&&i.shadowRoot.querySelector){return i.shadowRoot.querySelector(r())}return b(i,r())[0]})();return!n&&e.params.createElements&&(n=T("div",e.params.wrapperClass),i.append(n),b(i,"."+e.params.slideClass).forEach(t=>{n.append(t)})),Object.assign(e,{el:i,wrapperEl:n,slidesEl:e.isElement&&!i.parentNode.host.slideSlots?i.parentNode.host:n,hostEl:e.isElement?i.parentNode.host:i,mounted:!0,rtl:"rtl"===i.dir.toLowerCase()||"rtl"===S(i,"direction"),rtlTranslate:"horizontal"===e.params.direction&&("rtl"===i.dir.toLowerCase()||"rtl"===S(i,"direction")),wrongRTL:"-webkit-box"===S(n,"display")}),!0}init(t){const e=this;if(e.initialized)return e;if(!1===e.mount(t))return e;e.emit("beforeInit"),e.params.breakpoints&&e.setBreakpoint(),e.addClasses(),e.updateSize(),e.updateSlides(),e.params.watchOverflow&&e.checkOverflow(),e.params.grabCursor&&e.enabled&&e.setGrabCursor(),e.params.loop&&e.virtual&&e.params.virtual.enabled?e.slideTo(e.params.initialSlide+e.virtual.slidesBefore,0,e.params.runCallbacksOnInit,!1,!0):e.slideTo(e.params.initialSlide,0,e.params.runCallbacksOnInit,!1,!0),e.params.loop&&e.loopCreate(),e.attachEvents();const i=[...e.el.querySelectorAll('[loading="lazy"]')];return e.isElement&&i.push(...e.hostEl.querySelectorAll('[loading="lazy"]')),i.forEach(t=>{t.complete?F(e,t):t.addEventListener("load",t=>{F(e,t.target)})}),N(e),e.initialized=!0,N(e),e.emit("init"),e.emit("afterInit"),e}destroy(t,e){void 0===t&&(t=!0),void 0===e&&(e=!0);const i=this,{params:r,el:n,wrapperEl:o,slides:s}=i;return void 0===i.params||i.destroyed||(i.emit("beforeDestroy"),i.initialized=!1,i.detachEvents(),r.loop&&i.loopDestroy(),e&&(i.removeClasses(),n.removeAttribute("style"),o.removeAttribute("style"),s&&s.length&&s.forEach(t=>{t.classList.remove(r.slideVisibleClass,r.slideFullyVisibleClass,r.slideActiveClass,r.slideNextClass,r.slidePrevClass),t.removeAttribute("style"),t.removeAttribute("data-swiper-slide-index")})),i.emit("destroy"),Object.keys(i.eventsListeners).forEach(t=>{i.off(t)}),!1!==t&&(i.el.swiper=null,function(t){const e=t;Object.keys(e).forEach(t=>{try{e[t]=null}catch(t){}try{delete e[t]}catch(t){}})}(i)),i.destroyed=!0),null}static extendDefaults(t){_(it,t)}static get extendedDefaults(){return it}static get defaults(){return Q}static installModule(t){rt.prototype.__modules__||(rt.prototype.__modules__=[]);const e=rt.prototype.__modules__;"function"==typeof t&&e.indexOf(t)<0&&e.push(t)}static use(t){return Array.isArray(t)?(t.forEach(t=>rt.installModule(t)),rt):(rt.installModule(t),rt)}}function nt(t,e,i,r){return t.params.createElements&&Object.keys(r).forEach(n=>{if(!i[n]&&!0===i.auto){let o=b(t.el,"."+r[n])[0];o||(o=T("div",r[n]),o.className=r[n],t.el.append(o)),i[n]=o,e[n]=o}}),i}function ot(t){return void 0===t&&(t=""),"."+t.trim().replace(/([\.:!+\/])/g,"\\$1").replace(/ /g,".")}function st(t){const e=this,{params:i,slidesEl:r}=e;i.loop&&e.loopDestroy();const n=t=>{if("string"==typeof t){const e=document.createElement("div");e.innerHTML=t,r.append(e.children[0]),e.innerHTML=""}else r.append(t)};if("object"==typeof t&&"length"in t)for(let e=0;e<t.length;e+=1)t[e]&&n(t[e]);else n(t);e.recalcSlides(),i.loop&&e.loopCreate(),i.observer&&!e.isElement||e.update()}function at(t){const e=this,{params:i,activeIndex:r,slidesEl:n}=e;i.loop&&e.loopDestroy();let o=r+1;const s=t=>{if("string"==typeof t){const e=document.createElement("div");e.innerHTML=t,n.prepend(e.children[0]),e.innerHTML=""}else n.prepend(t)};if("object"==typeof t&&"length"in t){for(let e=0;e<t.length;e+=1)t[e]&&s(t[e]);o=r+t.length}else s(t);e.recalcSlides(),i.loop&&e.loopCreate(),i.observer&&!e.isElement||e.update(),e.slideTo(o,0,!1)}function lt(t,e){const i=this,{params:r,activeIndex:n,slidesEl:o}=i;let s=n;r.loop&&(s-=i.loopedSlides,i.loopDestroy(),i.recalcSlides());const a=i.slides.length;if(t<=0)return void i.prependSlide(e);if(t>=a)return void i.appendSlide(e);let l=s>t?s+1:s;const c=[];for(let e=a-1;e>=t;e-=1){const t=i.slides[e];t.remove(),c.unshift(t)}if("object"==typeof e&&"length"in e){for(let t=0;t<e.length;t+=1)e[t]&&o.append(e[t]);l=s>t?s+e.length:s}else o.append(e);for(let t=0;t<c.length;t+=1)o.append(c[t]);i.recalcSlides(),r.loop&&i.loopCreate(),r.observer&&!i.isElement||i.update(),r.loop?i.slideTo(l+i.loopedSlides,0,!1):i.slideTo(l,0,!1)}function ct(t){const e=this,{params:i,activeIndex:r}=e;let n=r;i.loop&&(n-=e.loopedSlides,e.loopDestroy());let o,s=n;if("object"==typeof t&&"length"in t){for(let i=0;i<t.length;i+=1)o=t[i],e.slides[o]&&e.slides[o].remove(),o<s&&(s-=1);s=Math.max(s,0)}else o=t,e.slides[o]&&e.slides[o].remove(),o<s&&(s-=1),s=Math.max(s,0);e.recalcSlides(),i.loop&&e.loopCreate(),i.observer&&!e.isElement||e.update(),i.loop?e.slideTo(s+e.loopedSlides,0,!1):e.slideTo(s,0,!1)}function ut(){const t=this,e=[];for(let i=0;i<t.slides.length;i+=1)e.push(i);t.removeSlide(e)}function ht(t){const{effect:e,swiper:i,on:r,setTranslate:n,setTransition:o,overwriteParams:s,perspective:a,recreateShadows:l,getEffectParams:c}=t;let u;r("beforeInit",()=>{if(i.params.effect!==e)return;i.classNames.push(`${i.params.containerModifierClass}${e}`),a&&a()&&i.classNames.push(i.params.containerModifierClass+"3d");const t=s?s():{};Object.assign(i.params,t),Object.assign(i.originalParams,t)}),r("setTranslate",()=>{i.params.effect===e&&n()}),r("setTransition",(t,r)=>{i.params.effect===e&&o(r)}),r("transitionEnd",()=>{if(i.params.effect===e&&l){if(!c||!c().slideShadows)return;i.slides.forEach(t=>{t.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(t=>t.remove())}),l()}}),r("virtualUpdate",()=>{i.params.effect===e&&(i.slides.length||(u=!0),requestAnimationFrame(()=>{u&&i.slides&&i.slides.length&&(n(),u=!1)}))})}function dt(t,e){const i=x(e);return i!==e&&(i.style.backfaceVisibility="hidden",i.style["-webkit-backface-visibility"]="hidden"),i}function pt(t){let{swiper:e,duration:i,transformElements:r,allSlides:n}=t;const{activeIndex:o}=e;if(e.params.virtualTranslate&&0!==i){let t,i=!1;t=n?r:r.filter(t=>{const i=t.classList.contains("swiper-slide-transform")?(t=>{if(!t.parentElement){return e.slides.filter(e=>e.shadowRoot&&e.shadowRoot===t.parentNode)[0]}return t.parentElement})(t):t;return e.getSlideIndex(i)===o}),t.forEach(t=>{I(t,()=>{if(i)return;if(!e||e.destroyed)return;i=!0,e.animating=!1;const t=new window.CustomEvent("transitionend",{bubbles:!0,cancelable:!0});e.wrapperEl.dispatchEvent(t)})})}}function ft(t,e,i){const r=`swiper-slide-shadow${i?"-"+i:""}${t?" swiper-slide-shadow-"+t:""}`,n=x(e);let o=n.querySelector("."+r.split(" ").join("."));return o||(o=T("div",r.split(" ")),n.append(o)),o}Object.keys(et).forEach(t=>{Object.keys(et[t]).forEach(e=>{rt.prototype[e]=et[t][e]})}),rt.use([function(t){let{swiper:e,on:i,emit:r}=t;const n=u();let o=null,s=null;const a=()=>{e&&!e.destroyed&&e.initialized&&(r("beforeResize"),r("resize"))},l=()=>{e&&!e.destroyed&&e.initialized&&r("orientationchange")};i("init",()=>{e.params.resizeObserver&&void 0!==n.ResizeObserver?e&&!e.destroyed&&e.initialized&&(o=new ResizeObserver(t=>{s=n.requestAnimationFrame(()=>{const{width:i,height:r}=e;let n=i,o=r;t.forEach(t=>{let{contentBoxSize:i,contentRect:r,target:s}=t;s&&s!==e.el||(n=r?r.width:(i[0]||i).inlineSize,o=r?r.height:(i[0]||i).blockSize)}),n===i&&o===r||a()})}),o.observe(e.el)):(n.addEventListener("resize",a),n.addEventListener("orientationchange",l))}),i("destroy",()=>{s&&n.cancelAnimationFrame(s),o&&o.unobserve&&e.el&&(o.unobserve(e.el),o=null),n.removeEventListener("resize",a),n.removeEventListener("orientationchange",l)})},function(t){let{swiper:e,extendParams:i,on:r,emit:n}=t;const o=[],s=u(),a=function(t,i){void 0===i&&(i={});const r=new(s.MutationObserver||s.WebkitMutationObserver)(t=>{if(e.__preventObserver__)return;if(1===t.length)return void n("observerUpdate",t[0]);const i=function(){n("observerUpdate",t[0])};s.requestAnimationFrame?s.requestAnimationFrame(i):s.setTimeout(i,0)});r.observe(t,{attributes:void 0===i.attributes||i.attributes,childList:void 0===i.childList||i.childList,characterData:void 0===i.characterData||i.characterData}),o.push(r)};i({observer:!1,observeParents:!1,observeSlideChildren:!1}),r("init",()=>{if(e.params.observer){if(e.params.observeParents){const t=M(e.hostEl);for(let e=0;e<t.length;e+=1)a(t[e])}a(e.hostEl,{childList:e.params.observeSlideChildren}),a(e.wrapperEl,{attributes:!1})}}),r("destroy",()=>{o.forEach(t=>{t.disconnect()}),o.splice(0,o.length)})}]);const mt=[function(t){let e,{swiper:i,extendParams:r,on:n,emit:o}=t;r({virtual:{enabled:!1,slides:[],cache:!0,renderSlide:null,renderExternal:null,renderExternalUpdate:!0,addSlidesBefore:0,addSlidesAfter:0}});const s=l();i.virtual={cache:{},from:void 0,to:void 0,slides:[],offset:0,slidesGrid:[]};const a=s.createElement("div");function c(t,e){const r=i.params.virtual;if(r.cache&&i.virtual.cache[e])return i.virtual.cache[e];let n;return r.renderSlide?(n=r.renderSlide.call(i,t,e),"string"==typeof n&&(a.innerHTML=n,n=a.children[0])):n=i.isElement?T("swiper-slide"):T("div",i.params.slideClass),n.setAttribute("data-swiper-slide-index",e),r.renderSlide||(n.innerHTML=t),r.cache&&(i.virtual.cache[e]=n),n}function u(t){const{slidesPerView:e,slidesPerGroup:r,centeredSlides:n,loop:s}=i.params,{addSlidesBefore:a,addSlidesAfter:l}=i.params.virtual,{from:u,to:h,slides:d,slidesGrid:p,offset:f}=i.virtual;i.params.cssMode||i.updateActiveIndex();const m=i.activeIndex||0;let g,_,y;g=i.rtlTranslate?"right":i.isHorizontal()?"left":"top",n?(_=Math.floor(e/2)+r+l,y=Math.floor(e/2)+r+a):(_=e+(r-1)+l,y=(s?e:r)+a);let v=m-y,x=m+_;s||(v=Math.max(v,0),x=Math.min(x,d.length-1));let w=(i.slidesGrid[v]||0)-(i.slidesGrid[0]||0);function T(){i.updateSlides(),i.updateProgress(),i.updateSlidesClasses(),o("virtualUpdate")}if(s&&m>=y?(v-=y,n||(w+=i.slidesGrid[0])):s&&m<y&&(v=-y,n&&(w+=i.slidesGrid[0])),Object.assign(i.virtual,{from:v,to:x,offset:w,slidesGrid:i.slidesGrid,slidesBefore:y,slidesAfter:_}),u===v&&h===x&&!t)return i.slidesGrid!==p&&w!==f&&i.slides.forEach(t=>{t.style[g]=w-Math.abs(i.cssOverflowAdjustment())+"px"}),i.updateProgress(),void o("virtualUpdate");if(i.params.virtual.renderExternal)return i.params.virtual.renderExternal.call(i,{offset:w,from:v,to:x,slides:function(){const t=[];for(let e=v;e<=x;e+=1)t.push(d[e]);return t}()}),void(i.params.virtual.renderExternalUpdate?T():o("virtualUpdate"));const E=[],S=[],A=t=>{let e=t;return t<0?e=d.length+t:e>=d.length&&(e-=d.length),e};if(t)i.slides.filter(t=>t.matches(`.${i.params.slideClass}, swiper-slide`)).forEach(t=>{t.remove()});else for(let t=u;t<=h;t+=1)if(t<v||t>x){const e=A(t);i.slides.filter(t=>t.matches(`.${i.params.slideClass}[data-swiper-slide-index="${e}"], swiper-slide[data-swiper-slide-index="${e}"]`)).forEach(t=>{t.remove()})}const M=s?-d.length:0,I=s?2*d.length:d.length;for(let e=M;e<I;e+=1)if(e>=v&&e<=x){const i=A(e);void 0===h||t?S.push(i):(e>h&&S.push(i),e<u&&E.push(i))}if(S.forEach(t=>{i.slidesEl.append(c(d[t],t))}),s)for(let t=E.length-1;t>=0;t-=1){const e=E[t];i.slidesEl.prepend(c(d[e],e))}else E.sort((t,e)=>e-t),E.forEach(t=>{i.slidesEl.prepend(c(d[t],t))});b(i.slidesEl,".swiper-slide, swiper-slide").forEach(t=>{t.style[g]=w-Math.abs(i.cssOverflowAdjustment())+"px"}),T()}n("beforeInit",()=>{if(!i.params.virtual.enabled)return;let t;if(void 0===i.passedParams.virtual.slides){const e=[...i.slidesEl.children].filter(t=>t.matches(`.${i.params.slideClass}, swiper-slide`));e&&e.length&&(i.virtual.slides=[...e],t=!0,e.forEach((t,e)=>{t.setAttribute("data-swiper-slide-index",e),i.virtual.cache[e]=t,t.remove()}))}t||(i.virtual.slides=i.params.virtual.slides),i.classNames.push(i.params.containerModifierClass+"virtual"),i.params.watchSlidesProgress=!0,i.originalParams.watchSlidesProgress=!0,u()}),n("setTranslate",()=>{i.params.virtual.enabled&&(i.params.cssMode&&!i._immediateVirtual?(clearTimeout(e),e=setTimeout(()=>{u()},100)):u())}),n("init update resize",()=>{i.params.virtual.enabled&&i.params.cssMode&&y(i.wrapperEl,"--swiper-virtual-size",i.virtualSize+"px")}),Object.assign(i.virtual,{appendSlide:function(t){if("object"==typeof t&&"length"in t)for(let e=0;e<t.length;e+=1)t[e]&&i.virtual.slides.push(t[e]);else i.virtual.slides.push(t);u(!0)},prependSlide:function(t){const e=i.activeIndex;let r=e+1,n=1;if(Array.isArray(t)){for(let e=0;e<t.length;e+=1)t[e]&&i.virtual.slides.unshift(t[e]);r=e+t.length,n=t.length}else i.virtual.slides.unshift(t);if(i.params.virtual.cache){const t=i.virtual.cache,e={};Object.keys(t).forEach(i=>{const r=t[i],o=r.getAttribute("data-swiper-slide-index");o&&r.setAttribute("data-swiper-slide-index",parseInt(o,10)+n),e[parseInt(i,10)+n]=r}),i.virtual.cache=e}u(!0),i.slideTo(r,0)},removeSlide:function(t){if(null==t)return;let e=i.activeIndex;if(Array.isArray(t))for(let r=t.length-1;r>=0;r-=1)i.params.virtual.cache&&(delete i.virtual.cache[t[r]],Object.keys(i.virtual.cache).forEach(e=>{e>t&&(i.virtual.cache[e-1]=i.virtual.cache[e],i.virtual.cache[e-1].setAttribute("data-swiper-slide-index",e-1),delete i.virtual.cache[e])})),i.virtual.slides.splice(t[r],1),t[r]<e&&(e-=1),e=Math.max(e,0);else i.params.virtual.cache&&(delete i.virtual.cache[t],Object.keys(i.virtual.cache).forEach(e=>{e>t&&(i.virtual.cache[e-1]=i.virtual.cache[e],i.virtual.cache[e-1].setAttribute("data-swiper-slide-index",e-1),delete i.virtual.cache[e])})),i.virtual.slides.splice(t,1),t<e&&(e-=1),e=Math.max(e,0);u(!0),i.slideTo(e,0)},removeAllSlides:function(){i.virtual.slides=[],i.params.virtual.cache&&(i.virtual.cache={}),u(!0),i.slideTo(0,0)},update:u})},function(t){let{swiper:e,extendParams:i,on:r,emit:n}=t;const o=l(),s=u();function a(t){if(!e.enabled)return;const{rtlTranslate:i}=e;let r=t;r.originalEvent&&(r=r.originalEvent);const a=r.keyCode||r.charCode,l=e.params.keyboard.pageUpDown,c=l&&33===a,u=l&&34===a,h=37===a,d=39===a,p=38===a,f=40===a;if(!e.allowSlideNext&&(e.isHorizontal()&&d||e.isVertical()&&f||u))return!1;if(!e.allowSlidePrev&&(e.isHorizontal()&&h||e.isVertical()&&p||c))return!1;if(!(r.shiftKey||r.altKey||r.ctrlKey||r.metaKey||o.activeElement&&o.activeElement.nodeName&&("input"===o.activeElement.nodeName.toLowerCase()||"textarea"===o.activeElement.nodeName.toLowerCase()))){if(e.params.keyboard.onlyInViewport&&(c||u||h||d||p||f)){let t=!1;if(M(e.el,`.${e.params.slideClass}, swiper-slide`).length>0&&0===M(e.el,"."+e.params.slideActiveClass).length)return;const r=e.el,n=r.clientWidth,o=r.clientHeight,a=s.innerWidth,l=s.innerHeight,c=E(r);i&&(c.left-=r.scrollLeft);const u=[[c.left,c.top],[c.left+n,c.top],[c.left,c.top+o],[c.left+n,c.top+o]];for(let e=0;e<u.length;e+=1){const i=u[e];if(i[0]>=0&&i[0]<=a&&i[1]>=0&&i[1]<=l){if(0===i[0]&&0===i[1])continue;t=!0}}if(!t)return}e.isHorizontal()?((c||u||h||d)&&(r.preventDefault?r.preventDefault():r.returnValue=!1),((u||d)&&!i||(c||h)&&i)&&e.slideNext(),((c||h)&&!i||(u||d)&&i)&&e.slidePrev()):((c||u||p||f)&&(r.preventDefault?r.preventDefault():r.returnValue=!1),(u||f)&&e.slideNext(),(c||p)&&e.slidePrev()),n("keyPress",a)}}function c(){e.keyboard.enabled||(o.addEventListener("keydown",a),e.keyboard.enabled=!0)}function h(){e.keyboard.enabled&&(o.removeEventListener("keydown",a),e.keyboard.enabled=!1)}e.keyboard={enabled:!1},i({keyboard:{enabled:!1,onlyInViewport:!0,pageUpDown:!0}}),r("init",()=>{e.params.keyboard.enabled&&c()}),r("destroy",()=>{e.keyboard.enabled&&h()}),Object.assign(e.keyboard,{enable:c,disable:h})},function(t){let{swiper:e,extendParams:i,on:r,emit:n}=t;const o=u();let s;i({mousewheel:{enabled:!1,releaseOnEdges:!1,invert:!1,forceToAxis:!1,sensitivity:1,eventsTarget:"container",thresholdDelta:null,thresholdTime:null,noMousewheelClass:"swiper-no-mousewheel"}}),e.mousewheel={enabled:!1};let a,l=p();const c=[];function h(){e.enabled&&(e.mouseEntered=!0)}function f(){e.enabled&&(e.mouseEntered=!1)}function m(t){return!(e.params.mousewheel.thresholdDelta&&t.delta<e.params.mousewheel.thresholdDelta)&&(!(e.params.mousewheel.thresholdTime&&p()-l<e.params.mousewheel.thresholdTime)&&(t.delta>=6&&p()-l<60||(t.direction<0?e.isEnd&&!e.params.loop||e.animating||(e.slideNext(),n("scroll",t.raw)):e.isBeginning&&!e.params.loop||e.animating||(e.slidePrev(),n("scroll",t.raw)),l=(new o.Date).getTime(),!1)))}function g(t){let i=t,r=!0;if(!e.enabled)return;if(t.target.closest("."+e.params.mousewheel.noMousewheelClass))return;const o=e.params.mousewheel;e.params.cssMode&&i.preventDefault();let l=e.el;"container"!==e.params.mousewheel.eventsTarget&&(l=document.querySelector(e.params.mousewheel.eventsTarget));const u=l&&l.contains(i.target);if(!e.mouseEntered&&!u&&!o.releaseOnEdges)return!0;i.originalEvent&&(i=i.originalEvent);let h=0;const f=e.rtlTranslate?-1:1,g=function(t){let e=0,i=0,r=0,n=0;return"detail"in t&&(i=t.detail),"wheelDelta"in t&&(i=-t.wheelDelta/120),"wheelDeltaY"in t&&(i=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=i,i=0),r=10*e,n=10*i,"deltaY"in t&&(n=t.deltaY),"deltaX"in t&&(r=t.deltaX),t.shiftKey&&!r&&(r=n,n=0),(r||n)&&t.deltaMode&&(1===t.deltaMode?(r*=40,n*=40):(r*=800,n*=800)),r&&!e&&(e=r<1?-1:1),n&&!i&&(i=n<1?-1:1),{spinX:e,spinY:i,pixelX:r,pixelY:n}}(i);if(o.forceToAxis)if(e.isHorizontal()){if(!(Math.abs(g.pixelX)>Math.abs(g.pixelY)))return!0;h=-g.pixelX*f}else{if(!(Math.abs(g.pixelY)>Math.abs(g.pixelX)))return!0;h=-g.pixelY}else h=Math.abs(g.pixelX)>Math.abs(g.pixelY)?-g.pixelX*f:-g.pixelY;if(0===h)return!0;o.invert&&(h=-h);let _=e.getTranslate()+h*o.sensitivity;if(_>=e.minTranslate()&&(_=e.minTranslate()),_<=e.maxTranslate()&&(_=e.maxTranslate()),r=!!e.params.loop||!(_===e.minTranslate()||_===e.maxTranslate()),r&&e.params.nested&&i.stopPropagation(),e.params.freeMode&&e.params.freeMode.enabled){const t={time:p(),delta:Math.abs(h),direction:Math.sign(h)},r=a&&t.time<a.time+500&&t.delta<=a.delta&&t.direction===a.direction;if(!r){a=void 0;let l=e.getTranslate()+h*o.sensitivity;const u=e.isBeginning,p=e.isEnd;if(l>=e.minTranslate()&&(l=e.minTranslate()),l<=e.maxTranslate()&&(l=e.maxTranslate()),e.setTransition(0),e.setTranslate(l),e.updateProgress(),e.updateActiveIndex(),e.updateSlidesClasses(),(!u&&e.isBeginning||!p&&e.isEnd)&&e.updateSlidesClasses(),e.params.loop&&e.loopFix({direction:t.direction<0?"next":"prev",byMousewheel:!0}),e.params.freeMode.sticky){clearTimeout(s),s=void 0,c.length>=15&&c.shift();const i=c.length?c[c.length-1]:void 0,r=c[0];if(c.push(t),i&&(t.delta>i.delta||t.direction!==i.direction))c.splice(0);else if(c.length>=15&&t.time-r.time<500&&r.delta-t.delta>=1&&t.delta<=6){const i=h>0?.8:.2;a=t,c.splice(0),s=d(()=>{e.slideToClosest(e.params.speed,!0,void 0,i)},0)}s||(s=d(()=>{a=t,c.splice(0),e.slideToClosest(e.params.speed,!0,void 0,.5)},500))}if(r||n("scroll",i),e.params.autoplay&&e.params.autoplayDisableOnInteraction&&e.autoplay.stop(),o.releaseOnEdges&&(l===e.minTranslate()||l===e.maxTranslate()))return!0}}else{const i={time:p(),delta:Math.abs(h),direction:Math.sign(h),raw:t};c.length>=2&&c.shift();const r=c.length?c[c.length-1]:void 0;if(c.push(i),r?(i.direction!==r.direction||i.delta>r.delta||i.time>r.time+150)&&m(i):m(i),function(t){const i=e.params.mousewheel;if(t.direction<0){if(e.isEnd&&!e.params.loop&&i.releaseOnEdges)return!0}else if(e.isBeginning&&!e.params.loop&&i.releaseOnEdges)return!0;return!1}(i))return!0}return i.preventDefault?i.preventDefault():i.returnValue=!1,!1}function _(t){let i=e.el;"container"!==e.params.mousewheel.eventsTarget&&(i=document.querySelector(e.params.mousewheel.eventsTarget)),i[t]("mouseenter",h),i[t]("mouseleave",f),i[t]("wheel",g)}function y(){return e.params.cssMode?(e.wrapperEl.removeEventListener("wheel",g),!0):!e.mousewheel.enabled&&(_("addEventListener"),e.mousewheel.enabled=!0,!0)}function v(){return e.params.cssMode?(e.wrapperEl.addEventListener(event,g),!0):!!e.mousewheel.enabled&&(_("removeEventListener"),e.mousewheel.enabled=!1,!0)}r("init",()=>{!e.params.mousewheel.enabled&&e.params.cssMode&&v(),e.params.mousewheel.enabled&&y()}),r("destroy",()=>{e.params.cssMode&&y(),e.mousewheel.enabled&&v()}),Object.assign(e.mousewheel,{enable:y,disable:v})},function(t){let{swiper:e,extendParams:i,on:r,emit:n}=t;function o(t){let i;return t&&"string"==typeof t&&e.isElement&&(i=e.el.querySelector(t),i)?i:(t&&("string"==typeof t&&(i=[...document.querySelectorAll(t)]),e.params.uniqueNavElements&&"string"==typeof t&&i.length>1&&1===e.el.querySelectorAll(t).length&&(i=e.el.querySelector(t))),t&&!i?t:i)}function s(t,i){const r=e.params.navigation;(t=P(t)).forEach(t=>{t&&(t.classList[i?"add":"remove"](...r.disabledClass.split(" ")),"BUTTON"===t.tagName&&(t.disabled=i),e.params.watchOverflow&&e.enabled&&t.classList[e.isLocked?"add":"remove"](r.lockClass))})}function a(){const{nextEl:t,prevEl:i}=e.navigation;if(e.params.loop)return s(i,!1),void s(t,!1);s(i,e.isBeginning&&!e.params.rewind),s(t,e.isEnd&&!e.params.rewind)}function l(t){t.preventDefault(),(!e.isBeginning||e.params.loop||e.params.rewind)&&(e.slidePrev(),n("navigationPrev"))}function c(t){t.preventDefault(),(!e.isEnd||e.params.loop||e.params.rewind)&&(e.slideNext(),n("navigationNext"))}function u(){const t=e.params.navigation;if(e.params.navigation=nt(e,e.originalParams.navigation,e.params.navigation,{nextEl:"swiper-button-next",prevEl:"swiper-button-prev"}),!t.nextEl&&!t.prevEl)return;let i=o(t.nextEl),r=o(t.prevEl);Object.assign(e.navigation,{nextEl:i,prevEl:r}),i=P(i),r=P(r);const n=(i,r)=>{i&&i.addEventListener("click","next"===r?c:l),!e.enabled&&i&&i.classList.add(...t.lockClass.split(" "))};i.forEach(t=>n(t,"next")),r.forEach(t=>n(t,"prev"))}function h(){let{nextEl:t,prevEl:i}=e.navigation;t=P(t),i=P(i);const r=(t,i)=>{t.removeEventListener("click","next"===i?c:l),t.classList.remove(...e.params.navigation.disabledClass.split(" "))};t.forEach(t=>r(t,"next")),i.forEach(t=>r(t,"prev"))}i({navigation:{nextEl:null,prevEl:null,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock",navigationDisabledClass:"swiper-navigation-disabled"}}),e.navigation={nextEl:null,prevEl:null},r("init",()=>{!1===e.params.navigation.enabled?d():(u(),a())}),r("toEdge fromEdge lock unlock",()=>{a()}),r("destroy",()=>{h()}),r("enable disable",()=>{let{nextEl:t,prevEl:i}=e.navigation;t=P(t),i=P(i),e.enabled?a():[...t,...i].filter(t=>!!t).forEach(t=>t.classList.add(e.params.navigation.lockClass))}),r("click",(t,i)=>{let{nextEl:r,prevEl:o}=e.navigation;r=P(r),o=P(o);const s=i.target;if(e.params.navigation.hideOnClick&&!o.includes(s)&&!r.includes(s)){if(e.pagination&&e.params.pagination&&e.params.pagination.clickable&&(e.pagination.el===s||e.pagination.el.contains(s)))return;let t;r.length?t=r[0].classList.contains(e.params.navigation.hiddenClass):o.length&&(t=o[0].classList.contains(e.params.navigation.hiddenClass)),n(!0===t?"navigationShow":"navigationHide"),[...r,...o].filter(t=>!!t).forEach(t=>t.classList.toggle(e.params.navigation.hiddenClass))}});const d=()=>{e.el.classList.add(...e.params.navigation.navigationDisabledClass.split(" ")),h()};Object.assign(e.navigation,{enable:()=>{e.el.classList.remove(...e.params.navigation.navigationDisabledClass.split(" ")),u(),a()},disable:d,update:a,init:u,destroy:h})},function(t){let{swiper:e,extendParams:i,on:r,emit:n}=t;const o="swiper-pagination";let s;i({pagination:{el:null,bulletElement:"span",clickable:!1,hideOnClick:!1,renderBullet:null,renderProgressbar:null,renderFraction:null,renderCustom:null,progressbarOpposite:!1,type:"bullets",dynamicBullets:!1,dynamicMainBullets:1,formatFractionCurrent:t=>t,formatFractionTotal:t=>t,bulletClass:o+"-bullet",bulletActiveClass:o+"-bullet-active",modifierClass:o+"-",currentClass:o+"-current",totalClass:o+"-total",hiddenClass:o+"-hidden",progressbarFillClass:o+"-progressbar-fill",progressbarOppositeClass:o+"-progressbar-opposite",clickableClass:o+"-clickable",lockClass:o+"-lock",horizontalClass:o+"-horizontal",verticalClass:o+"-vertical",paginationDisabledClass:o+"-disabled"}}),e.pagination={el:null,bullets:[]};let a=0;function l(){return!e.params.pagination.el||!e.pagination.el||Array.isArray(e.pagination.el)&&0===e.pagination.el.length}function c(t,i){const{bulletActiveClass:r}=e.params.pagination;t&&(t=t[("prev"===i?"previous":"next")+"ElementSibling"])&&(t.classList.add(`${r}-${i}`),(t=t[("prev"===i?"previous":"next")+"ElementSibling"])&&t.classList.add(`${r}-${i}-${i}`))}function u(t){const i=t.target.closest(ot(e.params.pagination.bulletClass));if(!i)return;t.preventDefault();const r=A(i)*e.params.slidesPerGroup;if(e.params.loop){if(e.realIndex===r)return;e.slideToLoop(r)}else e.slideTo(r)}function h(){const t=e.rtl,i=e.params.pagination;if(l())return;let r,o,u=e.pagination.el;u=P(u);const h=e.virtual&&e.params.virtual.enabled?e.virtual.slides.length:e.slides.length,d=e.params.loop?Math.ceil(h/e.params.slidesPerGroup):e.snapGrid.length;if(e.params.loop?(o=e.previousRealIndex||0,r=e.params.slidesPerGroup>1?Math.floor(e.realIndex/e.params.slidesPerGroup):e.realIndex):void 0!==e.snapIndex?(r=e.snapIndex,o=e.previousSnapIndex):(o=e.previousIndex||0,r=e.activeIndex||0),"bullets"===i.type&&e.pagination.bullets&&e.pagination.bullets.length>0){const n=e.pagination.bullets;let l,h,d;if(i.dynamicBullets&&(s=C(n[0],e.isHorizontal()?"width":"height",!0),u.forEach(t=>{t.style[e.isHorizontal()?"width":"height"]=s*(i.dynamicMainBullets+4)+"px"}),i.dynamicMainBullets>1&&void 0!==o&&(a+=r-(o||0),a>i.dynamicMainBullets-1?a=i.dynamicMainBullets-1:a<0&&(a=0)),l=Math.max(r-a,0),h=l+(Math.min(n.length,i.dynamicMainBullets)-1),d=(h+l)/2),n.forEach(t=>{const e=[...["","-next","-next-next","-prev","-prev-prev","-main"].map(t=>`${i.bulletActiveClass}${t}`)].map(t=>"string"==typeof t&&t.includes(" ")?t.split(" "):t).flat();t.classList.remove(...e)}),u.length>1)n.forEach(t=>{const n=A(t);n===r?t.classList.add(...i.bulletActiveClass.split(" ")):e.isElement&&t.setAttribute("part","bullet"),i.dynamicBullets&&(n>=l&&n<=h&&t.classList.add(...(i.bulletActiveClass+"-main").split(" ")),n===l&&c(t,"prev"),n===h&&c(t,"next"))});else{const t=n[r];if(t&&t.classList.add(...i.bulletActiveClass.split(" ")),e.isElement&&n.forEach((t,e)=>{t.setAttribute("part",e===r?"bullet-active":"bullet")}),i.dynamicBullets){const t=n[l],e=n[h];for(let t=l;t<=h;t+=1)n[t]&&n[t].classList.add(...(i.bulletActiveClass+"-main").split(" "));c(t,"prev"),c(e,"next")}}if(i.dynamicBullets){const r=Math.min(n.length,i.dynamicMainBullets+4),o=(s*r-s)/2-d*s,a=t?"right":"left";n.forEach(t=>{t.style[e.isHorizontal()?a:"top"]=o+"px"})}}u.forEach((t,o)=>{if("fraction"===i.type&&(t.querySelectorAll(ot(i.currentClass)).forEach(t=>{t.textContent=i.formatFractionCurrent(r+1)}),t.querySelectorAll(ot(i.totalClass)).forEach(t=>{t.textContent=i.formatFractionTotal(d)})),"progressbar"===i.type){let n;n=i.progressbarOpposite?e.isHorizontal()?"vertical":"horizontal":e.isHorizontal()?"horizontal":"vertical";const o=(r+1)/d;let s=1,a=1;"horizontal"===n?s=o:a=o,t.querySelectorAll(ot(i.progressbarFillClass)).forEach(t=>{t.style.transform=`translate3d(0,0,0) scaleX(${s}) scaleY(${a})`,t.style.transitionDuration=e.params.speed+"ms"})}"custom"===i.type&&i.renderCustom?(t.innerHTML=i.renderCustom(e,r+1,d),0===o&&n("paginationRender",t)):(0===o&&n("paginationRender",t),n("paginationUpdate",t)),e.params.watchOverflow&&e.enabled&&t.classList[e.isLocked?"add":"remove"](i.lockClass)})}function d(){const t=e.params.pagination;if(l())return;const i=e.virtual&&e.params.virtual.enabled?e.virtual.slides.length:e.grid&&e.params.grid.rows>1?e.slides.length/Math.ceil(e.params.grid.rows):e.slides.length;let r=e.pagination.el;r=P(r);let o="";if("bullets"===t.type){let r=e.params.loop?Math.ceil(i/e.params.slidesPerGroup):e.snapGrid.length;e.params.freeMode&&e.params.freeMode.enabled&&r>i&&(r=i);for(let i=0;i<r;i+=1)t.renderBullet?o+=t.renderBullet.call(e,i,t.bulletClass):o+=`<${t.bulletElement} ${e.isElement?'part="bullet"':""} class="${t.bulletClass}"></${t.bulletElement}>`}"fraction"===t.type&&(o=t.renderFraction?t.renderFraction.call(e,t.currentClass,t.totalClass):`<span class="${t.currentClass}"></span> / <span class="${t.totalClass}"></span>`),"progressbar"===t.type&&(o=t.renderProgressbar?t.renderProgressbar.call(e,t.progressbarFillClass):`<span class="${t.progressbarFillClass}"></span>`),e.pagination.bullets=[],r.forEach(i=>{"custom"!==t.type&&(i.innerHTML=o||""),"bullets"===t.type&&e.pagination.bullets.push(...i.querySelectorAll(ot(t.bulletClass)))}),"custom"!==t.type&&n("paginationRender",r[0])}function p(){e.params.pagination=nt(e,e.originalParams.pagination,e.params.pagination,{el:"swiper-pagination"});const t=e.params.pagination;if(!t.el)return;let i;"string"==typeof t.el&&e.isElement&&(i=e.el.querySelector(t.el)),i||"string"!=typeof t.el||(i=[...document.querySelectorAll(t.el)]),i||(i=t.el),i&&0!==i.length&&(e.params.uniqueNavElements&&"string"==typeof t.el&&Array.isArray(i)&&i.length>1&&(i=[...e.el.querySelectorAll(t.el)],i.length>1&&(i=i.filter(t=>M(t,".swiper")[0]===e.el)[0])),Array.isArray(i)&&1===i.length&&(i=i[0]),Object.assign(e.pagination,{el:i}),i=P(i),i.forEach(i=>{"bullets"===t.type&&t.clickable&&i.classList.add(...(t.clickableClass||"").split(" ")),i.classList.add(t.modifierClass+t.type),i.classList.add(e.isHorizontal()?t.horizontalClass:t.verticalClass),"bullets"===t.type&&t.dynamicBullets&&(i.classList.add(`${t.modifierClass}${t.type}-dynamic`),a=0,t.dynamicMainBullets<1&&(t.dynamicMainBullets=1)),"progressbar"===t.type&&t.progressbarOpposite&&i.classList.add(t.progressbarOppositeClass),t.clickable&&i.addEventListener("click",u),e.enabled||i.classList.add(t.lockClass)}))}function f(){const t=e.params.pagination;if(l())return;let i=e.pagination.el;i&&(i=P(i),i.forEach(i=>{i.classList.remove(t.hiddenClass),i.classList.remove(t.modifierClass+t.type),i.classList.remove(e.isHorizontal()?t.horizontalClass:t.verticalClass),t.clickable&&(i.classList.remove(...(t.clickableClass||"").split(" ")),i.removeEventListener("click",u))})),e.pagination.bullets&&e.pagination.bullets.forEach(e=>e.classList.remove(...t.bulletActiveClass.split(" ")))}r("changeDirection",()=>{if(!e.pagination||!e.pagination.el)return;const t=e.params.pagination;let{el:i}=e.pagination;i=P(i),i.forEach(i=>{i.classList.remove(t.horizontalClass,t.verticalClass),i.classList.add(e.isHorizontal()?t.horizontalClass:t.verticalClass)})}),r("init",()=>{!1===e.params.pagination.enabled?m():(p(),d(),h())}),r("activeIndexChange",()=>{void 0===e.snapIndex&&h()}),r("snapIndexChange",()=>{h()}),r("snapGridLengthChange",()=>{d(),h()}),r("destroy",()=>{f()}),r("enable disable",()=>{let{el:t}=e.pagination;t&&(t=P(t),t.forEach(t=>t.classList[e.enabled?"remove":"add"](e.params.pagination.lockClass)))}),r("lock unlock",()=>{h()}),r("click",(t,i)=>{const r=i.target,o=P(e.pagination.el);if(e.params.pagination.el&&e.params.pagination.hideOnClick&&o&&o.length>0&&!r.classList.contains(e.params.pagination.bulletClass)){if(e.navigation&&(e.navigation.nextEl&&r===e.navigation.nextEl||e.navigation.prevEl&&r===e.navigation.prevEl))return;const t=o[0].classList.contains(e.params.pagination.hiddenClass);n(!0===t?"paginationShow":"paginationHide"),o.forEach(t=>t.classList.toggle(e.params.pagination.hiddenClass))}});const m=()=>{e.el.classList.add(e.params.pagination.paginationDisabledClass);let{el:t}=e.pagination;t&&(t=P(t),t.forEach(t=>t.classList.add(e.params.pagination.paginationDisabledClass))),f()};Object.assign(e.pagination,{enable:()=>{e.el.classList.remove(e.params.pagination.paginationDisabledClass);let{el:t}=e.pagination;t&&(t=P(t),t.forEach(t=>t.classList.remove(e.params.pagination.paginationDisabledClass))),p(),d(),h()},disable:m,render:d,update:h,init:p,destroy:f})},function(t){let{swiper:e,extendParams:i,on:r,emit:n}=t;const o=l();let s,a,c,u,p=!1,f=null,m=null;function g(){if(!e.params.scrollbar.el||!e.scrollbar.el)return;const{scrollbar:t,rtlTranslate:i}=e,{dragEl:r,el:n}=t,o=e.params.scrollbar,s=e.params.loop?e.progressLoop:e.progress;let l=a,u=(c-a)*s;i?(u=-u,u>0?(l=a-u,u=0):-u+a>c&&(l=c+u)):u<0?(l=a+u,u=0):u+a>c&&(l=c-u),e.isHorizontal()?(r.style.transform=`translate3d(${u}px, 0, 0)`,r.style.width=l+"px"):(r.style.transform=`translate3d(0px, ${u}px, 0)`,r.style.height=l+"px"),o.hide&&(clearTimeout(f),n.style.opacity=1,f=setTimeout(()=>{n.style.opacity=0,n.style.transitionDuration="400ms"},1e3))}function _(){if(!e.params.scrollbar.el||!e.scrollbar.el)return;const{scrollbar:t}=e,{dragEl:i,el:r}=t;i.style.width="",i.style.height="",c=e.isHorizontal()?r.offsetWidth:r.offsetHeight,u=e.size/(e.virtualSize+e.params.slidesOffsetBefore-(e.params.centeredSlides?e.snapGrid[0]:0)),a="auto"===e.params.scrollbar.dragSize?c*u:parseInt(e.params.scrollbar.dragSize,10),e.isHorizontal()?i.style.width=a+"px":i.style.height=a+"px",r.style.display=u>=1?"none":"",e.params.scrollbar.hide&&(r.style.opacity=0),e.params.watchOverflow&&e.enabled&&t.el.classList[e.isLocked?"add":"remove"](e.params.scrollbar.lockClass)}function y(t){return e.isHorizontal()?t.clientX:t.clientY}function v(t){const{scrollbar:i,rtlTranslate:r}=e,{el:n}=i;let o;o=(y(t)-E(n)[e.isHorizontal()?"left":"top"]-(null!==s?s:a/2))/(c-a),o=Math.max(Math.min(o,1),0),r&&(o=1-o);const l=e.minTranslate()+(e.maxTranslate()-e.minTranslate())*o;e.updateProgress(l),e.setTranslate(l),e.updateActiveIndex(),e.updateSlidesClasses()}function x(t){const i=e.params.scrollbar,{scrollbar:r,wrapperEl:o}=e,{el:a,dragEl:l}=r;p=!0,s=t.target===l?y(t)-t.target.getBoundingClientRect()[e.isHorizontal()?"left":"top"]:null,t.preventDefault(),t.stopPropagation(),o.style.transitionDuration="100ms",l.style.transitionDuration="100ms",v(t),clearTimeout(m),a.style.transitionDuration="0ms",i.hide&&(a.style.opacity=1),e.params.cssMode&&(e.wrapperEl.style["scroll-snap-type"]="none"),n("scrollbarDragStart",t)}function b(t){const{scrollbar:i,wrapperEl:r}=e,{el:o,dragEl:s}=i;p&&(t.preventDefault?t.preventDefault():t.returnValue=!1,v(t),r.style.transitionDuration="0ms",o.style.transitionDuration="0ms",s.style.transitionDuration="0ms",n("scrollbarDragMove",t))}function w(t){const i=e.params.scrollbar,{scrollbar:r,wrapperEl:o}=e,{el:s}=r;p&&(p=!1,e.params.cssMode&&(e.wrapperEl.style["scroll-snap-type"]="",o.style.transitionDuration=""),i.hide&&(clearTimeout(m),m=d(()=>{s.style.opacity=0,s.style.transitionDuration="400ms"},1e3)),n("scrollbarDragEnd",t),i.snapOnRelease&&e.slideToClosest())}function S(t){const{scrollbar:i,params:r}=e,n=i.el;if(!n)return;const s=n,a=!!r.passiveListeners&&{passive:!1,capture:!1},l=!!r.passiveListeners&&{passive:!0,capture:!1};if(!s)return;const c="on"===t?"addEventListener":"removeEventListener";s[c]("pointerdown",x,a),o[c]("pointermove",b,a),o[c]("pointerup",w,l)}function A(){const{scrollbar:t,el:i}=e;e.params.scrollbar=nt(e,e.originalParams.scrollbar,e.params.scrollbar,{el:"swiper-scrollbar"});const r=e.params.scrollbar;if(!r.el)return;let n,s;if("string"==typeof r.el&&e.isElement&&(n=e.el.querySelector(r.el)),n||"string"!=typeof r.el)n||(n=r.el);else if(n=o.querySelectorAll(r.el),!n.length)return;e.params.uniqueNavElements&&"string"==typeof r.el&&n.length>1&&1===i.querySelectorAll(r.el).length&&(n=i.querySelector(r.el)),n.length>0&&(n=n[0]),n.classList.add(e.isHorizontal()?r.horizontalClass:r.verticalClass),n&&(s=n.querySelector(ot(e.params.scrollbar.dragClass)),s||(s=T("div",e.params.scrollbar.dragClass),n.append(s))),Object.assign(t,{el:n,dragEl:s}),r.draggable&&e.params.scrollbar.el&&e.scrollbar.el&&S("on"),n&&n.classList[e.enabled?"remove":"add"](...h(e.params.scrollbar.lockClass))}function M(){const t=e.params.scrollbar,i=e.scrollbar.el;i&&i.classList.remove(...h(e.isHorizontal()?t.horizontalClass:t.verticalClass)),e.params.scrollbar.el&&e.scrollbar.el&&S("off")}i({scrollbar:{el:null,dragSize:"auto",hide:!1,draggable:!1,snapOnRelease:!0,lockClass:"swiper-scrollbar-lock",dragClass:"swiper-scrollbar-drag",scrollbarDisabledClass:"swiper-scrollbar-disabled",horizontalClass:"swiper-scrollbar-horizontal",verticalClass:"swiper-scrollbar-vertical"}}),e.scrollbar={el:null,dragEl:null},r("changeDirection",()=>{if(!e.scrollbar||!e.scrollbar.el)return;const t=e.params.scrollbar;let{el:i}=e.scrollbar;i=P(i),i.forEach(i=>{i.classList.remove(t.horizontalClass,t.verticalClass),i.classList.add(e.isHorizontal()?t.horizontalClass:t.verticalClass)})}),r("init",()=>{!1===e.params.scrollbar.enabled?I():(A(),_(),g())}),r("update resize observerUpdate lock unlock changeDirection",()=>{_()}),r("setTranslate",()=>{g()}),r("setTransition",(t,i)=>{!function(t){e.params.scrollbar.el&&e.scrollbar.el&&(e.scrollbar.dragEl.style.transitionDuration=t+"ms")}(i)}),r("enable disable",()=>{const{el:t}=e.scrollbar;t&&t.classList[e.enabled?"remove":"add"](...h(e.params.scrollbar.lockClass))}),r("destroy",()=>{M()});const I=()=>{e.el.classList.add(...h(e.params.scrollbar.scrollbarDisabledClass)),e.scrollbar.el&&e.scrollbar.el.classList.add(...h(e.params.scrollbar.scrollbarDisabledClass)),M()};Object.assign(e.scrollbar,{enable:()=>{e.el.classList.remove(...h(e.params.scrollbar.scrollbarDisabledClass)),e.scrollbar.el&&e.scrollbar.el.classList.remove(...h(e.params.scrollbar.scrollbarDisabledClass)),A(),_(),g()},disable:I,updateSize:_,setTranslate:g,init:A,destroy:M})},function(t){let{swiper:e,extendParams:i,on:r}=t;i({parallax:{enabled:!1}});const n="[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y], [data-swiper-parallax-opacity], [data-swiper-parallax-scale]",o=(t,i)=>{const{rtl:r}=e,n=r?-1:1,o=t.getAttribute("data-swiper-parallax")||"0";let s=t.getAttribute("data-swiper-parallax-x"),a=t.getAttribute("data-swiper-parallax-y");const l=t.getAttribute("data-swiper-parallax-scale"),c=t.getAttribute("data-swiper-parallax-opacity"),u=t.getAttribute("data-swiper-parallax-rotate");if(s||a?(s=s||"0",a=a||"0"):e.isHorizontal()?(s=o,a="0"):(a=o,s="0"),s=s.indexOf("%")>=0?parseInt(s,10)*i*n+"%":s*i*n+"px",a=a.indexOf("%")>=0?parseInt(a,10)*i+"%":a*i+"px",null!=c){const e=c-(c-1)*(1-Math.abs(i));t.style.opacity=e}let h=`translate3d(${s}, ${a}, 0px)`;if(null!=l){h+=` scale(${l-(l-1)*(1-Math.abs(i))})`}if(u&&null!=u){h+=` rotate(${u*i*-1}deg)`}t.style.transform=h},s=()=>{const{el:t,slides:i,progress:r,snapGrid:s,isElement:a}=e,l=b(t,n);e.isElement&&l.push(...b(e.hostEl,n)),l.forEach(t=>{o(t,r)}),i.forEach((t,i)=>{let a=t.progress;e.params.slidesPerGroup>1&&"auto"!==e.params.slidesPerView&&(a+=Math.ceil(i/2)-r*(s.length-1)),a=Math.min(Math.max(a,-1),1),t.querySelectorAll(n+", [data-swiper-parallax-rotate]").forEach(t=>{o(t,a)})})};r("beforeInit",()=>{e.params.parallax.enabled&&(e.params.watchSlidesProgress=!0,e.originalParams.watchSlidesProgress=!0)}),r("init",()=>{e.params.parallax.enabled&&s()}),r("setTranslate",()=>{e.params.parallax.enabled&&s()}),r("setTransition",(t,i)=>{e.params.parallax.enabled&&function(t){void 0===t&&(t=e.params.speed);const{el:i,hostEl:r}=e,o=[...i.querySelectorAll(n)];e.isElement&&o.push(...r.querySelectorAll(n)),o.forEach(e=>{let i=parseInt(e.getAttribute("data-swiper-parallax-duration"),10)||t;0===t&&(i=0),e.style.transitionDuration=i+"ms"})}(i)})},function(t){let{swiper:e,extendParams:i,on:r,emit:n}=t;const o=u();i({zoom:{enabled:!1,maxRatio:3,minRatio:1,toggle:!0,containerClass:"swiper-zoom-container",zoomedSlideClass:"swiper-slide-zoomed"}}),e.zoom={enabled:!1};let s,a,l=1,c=!1;const h=[],d={originX:0,originY:0,slideEl:void 0,slideWidth:void 0,slideHeight:void 0,imageEl:void 0,imageWrapEl:void 0,maxRatio:3},p={isTouched:void 0,isMoved:void 0,currentX:void 0,currentY:void 0,minX:void 0,minY:void 0,maxX:void 0,maxY:void 0,width:void 0,height:void 0,startX:void 0,startY:void 0,touchesStart:{},touchesCurrent:{}},m={x:void 0,y:void 0,prevPositionX:void 0,prevPositionY:void 0,prevTime:void 0};let g=1;function _(){if(h.length<2)return 1;const t=h[0].pageX,e=h[0].pageY,i=h[1].pageX,r=h[1].pageY;return Math.sqrt((i-t)**2+(r-e)**2)}function y(t){const i=e.isElement?"swiper-slide":"."+e.params.slideClass;return!!t.target.matches(i)||e.slides.filter(e=>e.contains(t.target)).length>0}function v(t){if("mouse"===t.pointerType&&h.splice(0,h.length),!y(t))return;const i=e.params.zoom;if(s=!1,a=!1,h.push(t),!(h.length<2)){if(s=!0,d.scaleStart=_(),!d.slideEl){d.slideEl=t.target.closest(`.${e.params.slideClass}, swiper-slide`),d.slideEl||(d.slideEl=e.slides[e.activeIndex]);let r=d.slideEl.querySelector("."+i.containerClass);if(r&&(r=r.querySelectorAll("picture, img, svg, canvas, .swiper-zoom-target")[0]),d.imageEl=r,d.imageWrapEl=r?M(d.imageEl,"."+i.containerClass)[0]:void 0,!d.imageWrapEl)return void(d.imageEl=void 0);d.maxRatio=d.imageWrapEl.getAttribute("data-swiper-zoom")||i.maxRatio}if(d.imageEl){const[t,e]=function(){if(h.length<2)return{x:null,y:null};const t=d.imageEl.getBoundingClientRect();return[(h[0].pageX+(h[1].pageX-h[0].pageX)/2-t.x-o.scrollX)/l,(h[0].pageY+(h[1].pageY-h[0].pageY)/2-t.y-o.scrollY)/l]}();d.originX=t,d.originY=e,d.imageEl.style.transitionDuration="0ms"}c=!0}}function x(t){if(!y(t))return;const i=e.params.zoom,r=e.zoom,n=h.findIndex(e=>e.pointerId===t.pointerId);n>=0&&(h[n]=t),h.length<2||(a=!0,d.scaleMove=_(),d.imageEl&&(r.scale=d.scaleMove/d.scaleStart*l,r.scale>d.maxRatio&&(r.scale=d.maxRatio-1+(r.scale-d.maxRatio+1)**.5),r.scale<i.minRatio&&(r.scale=i.minRatio+1-(i.minRatio-r.scale+1)**.5),d.imageEl.style.transform=`translate3d(0,0,0) scale(${r.scale})`))}function w(t){if(!y(t))return;if("mouse"===t.pointerType&&"pointerout"===t.type)return;const i=e.params.zoom,r=e.zoom,n=h.findIndex(e=>e.pointerId===t.pointerId);n>=0&&h.splice(n,1),s&&a&&(s=!1,a=!1,d.imageEl&&(r.scale=Math.max(Math.min(r.scale,d.maxRatio),i.minRatio),d.imageEl.style.transitionDuration=e.params.speed+"ms",d.imageEl.style.transform=`translate3d(0,0,0) scale(${r.scale})`,l=r.scale,c=!1,r.scale>1&&d.slideEl?d.slideEl.classList.add(""+i.zoomedSlideClass):r.scale<=1&&d.slideEl&&d.slideEl.classList.remove(""+i.zoomedSlideClass),1===r.scale&&(d.originX=0,d.originY=0,d.slideEl=void 0)))}function T(t){if(!y(t)||!function(t){const i="."+e.params.zoom.containerClass;return!!t.target.matches(i)||[...e.hostEl.querySelectorAll(i)].filter(e=>e.contains(t.target)).length>0}(t))return;const i=e.zoom;if(!d.imageEl)return;if(!p.isTouched||!d.slideEl)return;p.isMoved||(p.width=d.imageEl.offsetWidth,p.height=d.imageEl.offsetHeight,p.startX=f(d.imageWrapEl,"x")||0,p.startY=f(d.imageWrapEl,"y")||0,d.slideWidth=d.slideEl.offsetWidth,d.slideHeight=d.slideEl.offsetHeight,d.imageWrapEl.style.transitionDuration="0ms");const r=p.width*i.scale,n=p.height*i.scale;if(r<d.slideWidth&&n<d.slideHeight)return;p.minX=Math.min(d.slideWidth/2-r/2,0),p.maxX=-p.minX,p.minY=Math.min(d.slideHeight/2-n/2,0),p.maxY=-p.minY,p.touchesCurrent.x=h.length>0?h[0].pageX:t.pageX,p.touchesCurrent.y=h.length>0?h[0].pageY:t.pageY;if(Math.max(Math.abs(p.touchesCurrent.x-p.touchesStart.x),Math.abs(p.touchesCurrent.y-p.touchesStart.y))>5&&(e.allowClick=!1),!p.isMoved&&!c){if(e.isHorizontal()&&(Math.floor(p.minX)===Math.floor(p.startX)&&p.touchesCurrent.x<p.touchesStart.x||Math.floor(p.maxX)===Math.floor(p.startX)&&p.touchesCurrent.x>p.touchesStart.x))return void(p.isTouched=!1);if(!e.isHorizontal()&&(Math.floor(p.minY)===Math.floor(p.startY)&&p.touchesCurrent.y<p.touchesStart.y||Math.floor(p.maxY)===Math.floor(p.startY)&&p.touchesCurrent.y>p.touchesStart.y))return void(p.isTouched=!1)}t.cancelable&&t.preventDefault(),t.stopPropagation(),p.isMoved=!0;const o=(i.scale-l)/(d.maxRatio-e.params.zoom.minRatio),{originX:s,originY:a}=d;p.currentX=p.touchesCurrent.x-p.touchesStart.x+p.startX+o*(p.width-2*s),p.currentY=p.touchesCurrent.y-p.touchesStart.y+p.startY+o*(p.height-2*a),p.currentX<p.minX&&(p.currentX=p.minX+1-(p.minX-p.currentX+1)**.8),p.currentX>p.maxX&&(p.currentX=p.maxX-1+(p.currentX-p.maxX+1)**.8),p.currentY<p.minY&&(p.currentY=p.minY+1-(p.minY-p.currentY+1)**.8),p.currentY>p.maxY&&(p.currentY=p.maxY-1+(p.currentY-p.maxY+1)**.8),m.prevPositionX||(m.prevPositionX=p.touchesCurrent.x),m.prevPositionY||(m.prevPositionY=p.touchesCurrent.y),m.prevTime||(m.prevTime=Date.now()),m.x=(p.touchesCurrent.x-m.prevPositionX)/(Date.now()-m.prevTime)/2,m.y=(p.touchesCurrent.y-m.prevPositionY)/(Date.now()-m.prevTime)/2,Math.abs(p.touchesCurrent.x-m.prevPositionX)<2&&(m.x=0),Math.abs(p.touchesCurrent.y-m.prevPositionY)<2&&(m.y=0),m.prevPositionX=p.touchesCurrent.x,m.prevPositionY=p.touchesCurrent.y,m.prevTime=Date.now(),d.imageWrapEl.style.transform=`translate3d(${p.currentX}px, ${p.currentY}px,0)`}function S(){const t=e.zoom;d.slideEl&&e.activeIndex!==e.slides.indexOf(d.slideEl)&&(d.imageEl&&(d.imageEl.style.transform="translate3d(0,0,0) scale(1)"),d.imageWrapEl&&(d.imageWrapEl.style.transform="translate3d(0,0,0)"),d.slideEl.classList.remove(""+e.params.zoom.zoomedSlideClass),t.scale=1,l=1,d.slideEl=void 0,d.imageEl=void 0,d.imageWrapEl=void 0,d.originX=0,d.originY=0)}function A(t){const i=e.zoom,r=e.params.zoom;if(!d.slideEl){t&&t.target&&(d.slideEl=t.target.closest(`.${e.params.slideClass}, swiper-slide`)),d.slideEl||(e.params.virtual&&e.params.virtual.enabled&&e.virtual?d.slideEl=b(e.slidesEl,"."+e.params.slideActiveClass)[0]:d.slideEl=e.slides[e.activeIndex]);let i=d.slideEl.querySelector("."+r.containerClass);i&&(i=i.querySelectorAll("picture, img, svg, canvas, .swiper-zoom-target")[0]),d.imageEl=i,d.imageWrapEl=i?M(d.imageEl,"."+r.containerClass)[0]:void 0}if(!d.imageEl||!d.imageWrapEl)return;let n,s,a,c,u,h,f,m,g,_,y,v,x,w,T,S,A,I;e.params.cssMode&&(e.wrapperEl.style.overflow="hidden",e.wrapperEl.style.touchAction="none"),d.slideEl.classList.add(""+r.zoomedSlideClass),void 0===p.touchesStart.x&&t?(n=t.pageX,s=t.pageY):(n=p.touchesStart.x,s=p.touchesStart.y);const C="number"==typeof t?t:null;1===l&&C&&(n=void 0,s=void 0),i.scale=C||d.imageWrapEl.getAttribute("data-swiper-zoom")||r.maxRatio,l=C||d.imageWrapEl.getAttribute("data-swiper-zoom")||r.maxRatio,!t||1===l&&C?(f=0,m=0):(A=d.slideEl.offsetWidth,I=d.slideEl.offsetHeight,a=E(d.slideEl).left+o.scrollX,c=E(d.slideEl).top+o.scrollY,u=a+A/2-n,h=c+I/2-s,g=d.imageEl.offsetWidth,_=d.imageEl.offsetHeight,y=g*i.scale,v=_*i.scale,x=Math.min(A/2-y/2,0),w=Math.min(I/2-v/2,0),T=-x,S=-w,f=u*i.scale,m=h*i.scale,f<x&&(f=x),f>T&&(f=T),m<w&&(m=w),m>S&&(m=S)),C&&1===i.scale&&(d.originX=0,d.originY=0),d.imageWrapEl.style.transitionDuration="300ms",d.imageWrapEl.style.transform=`translate3d(${f}px, ${m}px,0)`,d.imageEl.style.transitionDuration="300ms",d.imageEl.style.transform=`translate3d(0,0,0) scale(${i.scale})`}function I(){const t=e.zoom,i=e.params.zoom;if(!d.slideEl){e.params.virtual&&e.params.virtual.enabled&&e.virtual?d.slideEl=b(e.slidesEl,"."+e.params.slideActiveClass)[0]:d.slideEl=e.slides[e.activeIndex];let t=d.slideEl.querySelector("."+i.containerClass);t&&(t=t.querySelectorAll("picture, img, svg, canvas, .swiper-zoom-target")[0]),d.imageEl=t,d.imageWrapEl=t?M(d.imageEl,"."+i.containerClass)[0]:void 0}d.imageEl&&d.imageWrapEl&&(e.params.cssMode&&(e.wrapperEl.style.overflow="",e.wrapperEl.style.touchAction=""),t.scale=1,l=1,d.imageWrapEl.style.transitionDuration="300ms",d.imageWrapEl.style.transform="translate3d(0,0,0)",d.imageEl.style.transitionDuration="300ms",d.imageEl.style.transform="translate3d(0,0,0) scale(1)",d.slideEl.classList.remove(""+i.zoomedSlideClass),d.slideEl=void 0,d.originX=0,d.originY=0)}function C(t){const i=e.zoom;i.scale&&1!==i.scale?I():A(t)}function P(){return{passiveListener:!!e.params.passiveListeners&&{passive:!0,capture:!1},activeListenerWithCapture:!e.params.passiveListeners||{passive:!1,capture:!0}}}function R(){const t=e.zoom;if(t.enabled)return;t.enabled=!0;const{passiveListener:i,activeListenerWithCapture:r}=P();e.wrapperEl.addEventListener("pointerdown",v,i),e.wrapperEl.addEventListener("pointermove",x,r),["pointerup","pointercancel","pointerout"].forEach(t=>{e.wrapperEl.addEventListener(t,w,i)}),e.wrapperEl.addEventListener("pointermove",T,r)}function O(){const t=e.zoom;if(!t.enabled)return;t.enabled=!1;const{passiveListener:i,activeListenerWithCapture:r}=P();e.wrapperEl.removeEventListener("pointerdown",v,i),e.wrapperEl.removeEventListener("pointermove",x,r),["pointerup","pointercancel","pointerout"].forEach(t=>{e.wrapperEl.removeEventListener(t,w,i)}),e.wrapperEl.removeEventListener("pointermove",T,r)}Object.defineProperty(e.zoom,"scale",{get:()=>g,set(t){if(g!==t){const e=d.imageEl,i=d.slideEl;n("zoomChange",t,e,i)}g=t}}),r("init",()=>{e.params.zoom.enabled&&R()}),r("destroy",()=>{O()}),r("touchStart",(t,i)=>{e.zoom.enabled&&function(t){const i=e.device;if(!d.imageEl)return;if(p.isTouched)return;i.android&&t.cancelable&&t.preventDefault(),p.isTouched=!0;const r=h.length>0?h[0]:t;p.touchesStart.x=r.pageX,p.touchesStart.y=r.pageY}(i)}),r("touchEnd",(t,i)=>{e.zoom.enabled&&function(){const t=e.zoom;if(!d.imageEl)return;if(!p.isTouched||!p.isMoved)return p.isTouched=!1,void(p.isMoved=!1);p.isTouched=!1,p.isMoved=!1;let i=300,r=300;const n=m.x*i,o=p.currentX+n,s=m.y*r,a=p.currentY+s;0!==m.x&&(i=Math.abs((o-p.currentX)/m.x)),0!==m.y&&(r=Math.abs((a-p.currentY)/m.y));const l=Math.max(i,r);p.currentX=o,p.currentY=a;const c=p.width*t.scale,u=p.height*t.scale;p.minX=Math.min(d.slideWidth/2-c/2,0),p.maxX=-p.minX,p.minY=Math.min(d.slideHeight/2-u/2,0),p.maxY=-p.minY,p.currentX=Math.max(Math.min(p.currentX,p.maxX),p.minX),p.currentY=Math.max(Math.min(p.currentY,p.maxY),p.minY),d.imageWrapEl.style.transitionDuration=l+"ms",d.imageWrapEl.style.transform=`translate3d(${p.currentX}px, ${p.currentY}px,0)`}()}),r("doubleTap",(t,i)=>{!e.animating&&e.params.zoom.enabled&&e.zoom.enabled&&e.params.zoom.toggle&&C(i)}),r("transitionEnd",()=>{e.zoom.enabled&&e.params.zoom.enabled&&S()}),r("slideChange",()=>{e.zoom.enabled&&e.params.zoom.enabled&&e.params.cssMode&&S()}),Object.assign(e.zoom,{enable:R,disable:O,in:A,out:I,toggle:C})},function(t){let{swiper:e,extendParams:i,on:r}=t;function n(t,e){const i=function(){let t,e,i;return(r,n)=>{for(e=-1,t=r.length;t-e>1;)i=t+e>>1,r[i]<=n?e=i:t=i;return t}}();let r,n;return this.x=t,this.y=e,this.lastIndex=t.length-1,this.interpolate=function(t){return t?(n=i(this.x,t),r=n-1,(t-this.x[r])*(this.y[n]-this.y[r])/(this.x[n]-this.x[r])+this.y[r]):0},this}function o(){e.controller.control&&e.controller.spline&&(e.controller.spline=void 0,delete e.controller.spline)}i({controller:{control:void 0,inverse:!1,by:"slide"}}),e.controller={control:void 0},r("beforeInit",()=>{if("undefined"!=typeof window&&("string"==typeof e.params.controller.control||e.params.controller.control instanceof HTMLElement)){const t=document.querySelector(e.params.controller.control);if(t&&t.swiper)e.controller.control=t.swiper;else if(t){const i=r=>{e.controller.control=r.detail[0],e.update(),t.removeEventListener("init",i)};t.addEventListener("init",i)}}else e.controller.control=e.params.controller.control}),r("update",()=>{o()}),r("resize",()=>{o()}),r("observerUpdate",()=>{o()}),r("setTranslate",(t,i,r)=>{e.controller.control&&!e.controller.control.destroyed&&e.controller.setTranslate(i,r)}),r("setTransition",(t,i,r)=>{e.controller.control&&!e.controller.control.destroyed&&e.controller.setTransition(i,r)}),Object.assign(e.controller,{setTranslate:function(t,i){const r=e.controller.control;let o,s;const a=e.constructor;function l(t){if(t.destroyed)return;const i=e.rtlTranslate?-e.translate:e.translate;"slide"===e.params.controller.by&&(!function(t){e.controller.spline=e.params.loop?new n(e.slidesGrid,t.slidesGrid):new n(e.snapGrid,t.snapGrid)}(t),s=-e.controller.spline.interpolate(-i)),s&&"container"!==e.params.controller.by||(o=(t.maxTranslate()-t.minTranslate())/(e.maxTranslate()-e.minTranslate()),!Number.isNaN(o)&&Number.isFinite(o)||(o=1),s=(i-e.minTranslate())*o+t.minTranslate()),e.params.controller.inverse&&(s=t.maxTranslate()-s),t.updateProgress(s),t.setTranslate(s,e),t.updateActiveIndex(),t.updateSlidesClasses()}if(Array.isArray(r))for(let t=0;t<r.length;t+=1)r[t]!==i&&r[t]instanceof a&&l(r[t]);else r instanceof a&&i!==r&&l(r)},setTransition:function(t,i){const r=e.constructor,n=e.controller.control;let o;function s(i){i.destroyed||(i.setTransition(t,e),0!==t&&(i.transitionStart(),i.params.autoHeight&&d(()=>{i.updateAutoHeight()}),I(i.wrapperEl,()=>{n&&i.transitionEnd()})))}if(Array.isArray(n))for(o=0;o<n.length;o+=1)n[o]!==i&&n[o]instanceof r&&s(n[o]);else n instanceof r&&i!==n&&s(n)}})},function(t){let{swiper:e,extendParams:i,on:r}=t;i({a11y:{enabled:!0,notificationClass:"swiper-notification",prevSlideMessage:"Previous slide",nextSlideMessage:"Next slide",firstSlideMessage:"This is the first slide",lastSlideMessage:"This is the last slide",paginationBulletMessage:"Go to slide {{index}}",slideLabelMessage:"{{index}} / {{slidesLength}}",containerMessage:null,containerRoleDescriptionMessage:null,itemRoleDescriptionMessage:null,slideRole:"group",id:null}}),e.a11y={clicked:!1};let n=null;function o(t){const e=n;0!==e.length&&(e.innerHTML="",e.innerHTML=t)}function s(t){(t=P(t)).forEach(t=>{t.setAttribute("tabIndex","0")})}function a(t){(t=P(t)).forEach(t=>{t.setAttribute("tabIndex","-1")})}function l(t,e){(t=P(t)).forEach(t=>{t.setAttribute("role",e)})}function c(t,e){(t=P(t)).forEach(t=>{t.setAttribute("aria-roledescription",e)})}function u(t,e){(t=P(t)).forEach(t=>{t.setAttribute("aria-label",e)})}function h(t){(t=P(t)).forEach(t=>{t.setAttribute("aria-disabled",!0)})}function d(t){(t=P(t)).forEach(t=>{t.setAttribute("aria-disabled",!1)})}function p(t){if(13!==t.keyCode&&32!==t.keyCode)return;const i=e.params.a11y,r=t.target;e.pagination&&e.pagination.el&&(r===e.pagination.el||e.pagination.el.contains(t.target))&&!t.target.matches(ot(e.params.pagination.bulletClass))||(e.navigation&&e.navigation.nextEl&&r===e.navigation.nextEl&&(e.isEnd&&!e.params.loop||e.slideNext(),e.isEnd?o(i.lastSlideMessage):o(i.nextSlideMessage)),e.navigation&&e.navigation.prevEl&&r===e.navigation.prevEl&&(e.isBeginning&&!e.params.loop||e.slidePrev(),e.isBeginning?o(i.firstSlideMessage):o(i.prevSlideMessage)),e.pagination&&r.matches(ot(e.params.pagination.bulletClass))&&r.click())}function f(){return e.pagination&&e.pagination.bullets&&e.pagination.bullets.length}function m(){return f()&&e.params.pagination.clickable}const g=(t,e,i)=>{s(t),"BUTTON"!==t.tagName&&(l(t,"button"),t.addEventListener("keydown",p)),u(t,i),function(t,e){(t=P(t)).forEach(t=>{t.setAttribute("aria-controls",e)})}(t,e)},_=()=>{e.a11y.clicked=!0},y=()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{e.destroyed||(e.a11y.clicked=!1)})})},v=t=>{if(e.a11y.clicked)return;const i=t.target.closest(`.${e.params.slideClass}, swiper-slide`);if(!i||!e.slides.includes(i))return;const r=e.slides.indexOf(i)===e.activeIndex,n=e.params.watchSlidesProgress&&e.visibleSlides&&e.visibleSlides.includes(i);r||n||t.sourceCapabilities&&t.sourceCapabilities.firesTouchEvents||(e.isHorizontal()?e.el.scrollLeft=0:e.el.scrollTop=0,e.slideTo(e.slides.indexOf(i),0))},x=()=>{const t=e.params.a11y;t.itemRoleDescriptionMessage&&c(e.slides,t.itemRoleDescriptionMessage),t.slideRole&&l(e.slides,t.slideRole);const i=e.slides.length;t.slideLabelMessage&&e.slides.forEach((r,n)=>{const o=e.params.loop?parseInt(r.getAttribute("data-swiper-slide-index"),10):n;u(r,t.slideLabelMessage.replace(/\{\{index\}\}/,o+1).replace(/\{\{slidesLength\}\}/,i))})},b=()=>{const t=e.params.a11y;e.el.append(n);const i=e.el;t.containerRoleDescriptionMessage&&c(i,t.containerRoleDescriptionMessage),t.containerMessage&&u(i,t.containerMessage);const r=e.wrapperEl,o=t.id||r.getAttribute("id")||"swiper-wrapper-"+(void 0===(s=16)&&(s=16),"x".repeat(s).replace(/x/g,()=>Math.round(16*Math.random()).toString(16)));var s;const a=e.params.autoplay&&e.params.autoplay.enabled?"off":"polite";var l;l=o,P(r).forEach(t=>{t.setAttribute("id",l)}),function(t,e){(t=P(t)).forEach(t=>{t.setAttribute("aria-live",e)})}(r,a),x();let{nextEl:h,prevEl:d}=e.navigation?e.navigation:{};if(h=P(h),d=P(d),h&&h.forEach(e=>g(e,o,t.nextSlideMessage)),d&&d.forEach(e=>g(e,o,t.prevSlideMessage)),m()){P(e.pagination.el).forEach(t=>{t.addEventListener("keydown",p)})}e.el.addEventListener("focus",v,!0),e.el.addEventListener("pointerdown",_,!0),e.el.addEventListener("pointerup",y,!0)};r("beforeInit",()=>{n=T("span",e.params.a11y.notificationClass),n.setAttribute("aria-live","assertive"),n.setAttribute("aria-atomic","true")}),r("afterInit",()=>{e.params.a11y.enabled&&b()}),r("slidesLengthChange snapGridLengthChange slidesGridLengthChange",()=>{e.params.a11y.enabled&&x()}),r("fromEdge toEdge afterInit lock unlock",()=>{e.params.a11y.enabled&&function(){if(e.params.loop||e.params.rewind||!e.navigation)return;const{nextEl:t,prevEl:i}=e.navigation;i&&(e.isBeginning?(h(i),a(i)):(d(i),s(i))),t&&(e.isEnd?(h(t),a(t)):(d(t),s(t)))}()}),r("paginationUpdate",()=>{e.params.a11y.enabled&&function(){const t=e.params.a11y;f()&&e.pagination.bullets.forEach(i=>{e.params.pagination.clickable&&(s(i),e.params.pagination.renderBullet||(l(i,"button"),u(i,t.paginationBulletMessage.replace(/\{\{index\}\}/,A(i)+1)))),i.matches(ot(e.params.pagination.bulletActiveClass))?i.setAttribute("aria-current","true"):i.removeAttribute("aria-current")})}()}),r("destroy",()=>{e.params.a11y.enabled&&function(){n&&n.remove();let{nextEl:t,prevEl:i}=e.navigation?e.navigation:{};if(t=P(t),i=P(i),t&&t.forEach(t=>t.removeEventListener("keydown",p)),i&&i.forEach(t=>t.removeEventListener("keydown",p)),m()){P(e.pagination.el).forEach(t=>{t.removeEventListener("keydown",p)})}e.el.removeEventListener("focus",v,!0),e.el.removeEventListener("pointerdown",_,!0),e.el.removeEventListener("pointerup",y,!0)}()})},function(t){let{swiper:e,extendParams:i,on:r}=t;i({history:{enabled:!1,root:"",replaceState:!1,key:"slides",keepQuery:!1}});let n=!1,o={};const s=t=>t.toString().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/^-+/,"").replace(/-+$/,""),a=t=>{const e=u();let i;i=t?new URL(t):e.location;const r=i.pathname.slice(1).split("/").filter(t=>""!==t),n=r.length;return{key:r[n-2],value:r[n-1]}},l=(t,i)=>{const r=u();if(!n||!e.params.history.enabled)return;let o;o=e.params.url?new URL(e.params.url):r.location;const a=e.slides[i];let l=s(a.getAttribute("data-history"));if(e.params.history.root.length>0){let i=e.params.history.root;"/"===i[i.length-1]&&(i=i.slice(0,i.length-1)),l=`${i}/${t?t+"/":""}${l}`}else o.pathname.includes(t)||(l=`${t?t+"/":""}${l}`);e.params.history.keepQuery&&(l+=o.search);const c=r.history.state;c&&c.value===l||(e.params.history.replaceState?r.history.replaceState({value:l},null,l):r.history.pushState({value:l},null,l))},c=(t,i,r)=>{if(i)for(let n=0,o=e.slides.length;n<o;n+=1){const o=e.slides[n];if(s(o.getAttribute("data-history"))===i){const i=e.getSlideIndex(o);e.slideTo(i,t,r)}}else e.slideTo(0,t,r)},h=()=>{o=a(e.params.url),c(e.params.speed,o.value,!1)};r("init",()=>{e.params.history.enabled&&(()=>{const t=u();if(e.params.history){if(!t.history||!t.history.pushState)return e.params.history.enabled=!1,void(e.params.hashNavigation.enabled=!0);n=!0,o=a(e.params.url),o.key||o.value?(c(0,o.value,e.params.runCallbacksOnInit),e.params.history.replaceState||t.addEventListener("popstate",h)):e.params.history.replaceState||t.addEventListener("popstate",h)}})()}),r("destroy",()=>{e.params.history.enabled&&(()=>{const t=u();e.params.history.replaceState||t.removeEventListener("popstate",h)})()}),r("transitionEnd _freeModeNoMomentumRelease",()=>{n&&l(e.params.history.key,e.activeIndex)}),r("slideChange",()=>{n&&e.params.cssMode&&l(e.params.history.key,e.activeIndex)})},function(t){let{swiper:e,extendParams:i,emit:r,on:n}=t,o=!1;const s=l(),a=u();i({hashNavigation:{enabled:!1,replaceState:!1,watchState:!1,getSlideIndex(t,i){if(e.virtual&&e.params.virtual.enabled){const t=e.slides.filter(t=>t.getAttribute("data-hash")===i)[0];if(!t)return 0;return parseInt(t.getAttribute("data-swiper-slide-index"),10)}return e.getSlideIndex(b(e.slidesEl,`.${e.params.slideClass}[data-hash="${i}"], swiper-slide[data-hash="${i}"]`)[0])}}});const c=()=>{r("hashChange");const t=s.location.hash.replace("#",""),i=e.virtual&&e.params.virtual.enabled?e.slidesEl.querySelector(`[data-swiper-slide-index="${e.activeIndex}"]`):e.slides[e.activeIndex];if(t!==(i?i.getAttribute("data-hash"):"")){const i=e.params.hashNavigation.getSlideIndex(e,t);if(void 0===i||Number.isNaN(i))return;e.slideTo(i)}},h=()=>{if(!o||!e.params.hashNavigation.enabled)return;const t=e.virtual&&e.params.virtual.enabled?e.slidesEl.querySelector(`[data-swiper-slide-index="${e.activeIndex}"]`):e.slides[e.activeIndex],i=t?t.getAttribute("data-hash")||t.getAttribute("data-history"):"";e.params.hashNavigation.replaceState&&a.history&&a.history.replaceState?(a.history.replaceState(null,null,"#"+i||""),r("hashSet")):(s.location.hash=i||"",r("hashSet"))};n("init",()=>{e.params.hashNavigation.enabled&&(()=>{if(!e.params.hashNavigation.enabled||e.params.history&&e.params.history.enabled)return;o=!0;const t=s.location.hash.replace("#","");if(t){const i=0,r=e.params.hashNavigation.getSlideIndex(e,t);e.slideTo(r||0,i,e.params.runCallbacksOnInit,!0)}e.params.hashNavigation.watchState&&a.addEventListener("hashchange",c)})()}),n("destroy",()=>{e.params.hashNavigation.enabled&&e.params.hashNavigation.watchState&&a.removeEventListener("hashchange",c)}),n("transitionEnd _freeModeNoMomentumRelease",()=>{o&&h()}),n("slideChange",()=>{o&&e.params.cssMode&&h()})},function(t){let e,i,{swiper:r,extendParams:n,on:o,emit:s,params:a}=t;r.autoplay={running:!1,paused:!1,timeLeft:0},n({autoplay:{enabled:!1,delay:3e3,waitForTransition:!0,disableOnInteraction:!1,stopOnLastSlide:!1,reverseDirection:!1,pauseOnMouseEnter:!1}});let c,u,h,d,p,f,m,g,_=a&&a.autoplay?a.autoplay.delay:3e3,y=a&&a.autoplay?a.autoplay.delay:3e3,v=(new Date).getTime();function x(t){r&&!r.destroyed&&r.wrapperEl&&t.target===r.wrapperEl&&(r.wrapperEl.removeEventListener("transitionend",x),g||A())}const b=()=>{if(r.destroyed||!r.autoplay.running)return;r.autoplay.paused?u=!0:u&&(y=c,u=!1);const t=r.autoplay.paused?c:v+y-(new Date).getTime();r.autoplay.timeLeft=t,s("autoplayTimeLeft",t,t/_),i=requestAnimationFrame(()=>{b()})},w=t=>{if(r.destroyed||!r.autoplay.running)return;cancelAnimationFrame(i),b();let n=void 0===t?r.params.autoplay.delay:t;_=r.params.autoplay.delay,y=r.params.autoplay.delay;const o=(()=>{let t;if(t=r.virtual&&r.params.virtual.enabled?r.slides.filter(t=>t.classList.contains("swiper-slide-active"))[0]:r.slides[r.activeIndex],!t)return;return parseInt(t.getAttribute("data-swiper-autoplay"),10)})();!Number.isNaN(o)&&o>0&&void 0===t&&(n=o,_=o,y=o),c=n;const a=r.params.speed,l=()=>{r&&!r.destroyed&&(r.params.autoplay.reverseDirection?!r.isBeginning||r.params.loop||r.params.rewind?(r.slidePrev(a,!0,!0),s("autoplay")):r.params.autoplay.stopOnLastSlide||(r.slideTo(r.slides.length-1,a,!0,!0),s("autoplay")):!r.isEnd||r.params.loop||r.params.rewind?(r.slideNext(a,!0,!0),s("autoplay")):r.params.autoplay.stopOnLastSlide||(r.slideTo(0,a,!0,!0),s("autoplay")),r.params.cssMode&&(v=(new Date).getTime(),requestAnimationFrame(()=>{w()})))};return n>0?(clearTimeout(e),e=setTimeout(()=>{l()},n)):requestAnimationFrame(()=>{l()}),n},T=()=>{v=(new Date).getTime(),r.autoplay.running=!0,w(),s("autoplayStart")},E=()=>{r.autoplay.running=!1,clearTimeout(e),cancelAnimationFrame(i),s("autoplayStop")},S=(t,i)=>{if(r.destroyed||!r.autoplay.running)return;clearTimeout(e),t||(m=!0);const n=()=>{s("autoplayPause"),r.params.autoplay.waitForTransition?r.wrapperEl.addEventListener("transitionend",x):A()};if(r.autoplay.paused=!0,i)return f&&(c=r.params.autoplay.delay),f=!1,void n();const o=c||r.params.autoplay.delay;c=o-((new Date).getTime()-v),r.isEnd&&c<0&&!r.params.loop||(c<0&&(c=0),n())},A=()=>{r.isEnd&&c<0&&!r.params.loop||r.destroyed||!r.autoplay.running||(v=(new Date).getTime(),m?(m=!1,w(c)):w(),r.autoplay.paused=!1,s("autoplayResume"))},M=()=>{if(r.destroyed||!r.autoplay.running)return;const t=l();"hidden"===t.visibilityState&&(m=!0,S(!0)),"visible"===t.visibilityState&&A()},I=t=>{"mouse"===t.pointerType&&(m=!0,g=!0,r.animating||r.autoplay.paused||S(!0))},C=t=>{"mouse"===t.pointerType&&(g=!1,r.autoplay.paused&&A())};o("init",()=>{r.params.autoplay.enabled&&(r.params.autoplay.pauseOnMouseEnter&&(r.el.addEventListener("pointerenter",I),r.el.addEventListener("pointerleave",C)),l().addEventListener("visibilitychange",M),T())}),o("destroy",()=>{r.el.removeEventListener("pointerenter",I),r.el.removeEventListener("pointerleave",C),l().removeEventListener("visibilitychange",M),r.autoplay.running&&E()}),o("_freeModeStaticRelease",()=>{(d||m)&&A()}),o("_freeModeNoMomentumRelease",()=>{r.params.autoplay.disableOnInteraction?E():S(!0,!0)}),o("beforeTransitionStart",(t,e,i)=>{!r.destroyed&&r.autoplay.running&&(i||!r.params.autoplay.disableOnInteraction?S(!0,!0):E())}),o("sliderFirstMove",()=>{!r.destroyed&&r.autoplay.running&&(r.params.autoplay.disableOnInteraction?E():(h=!0,d=!1,m=!1,p=setTimeout(()=>{m=!0,d=!0,S(!0)},200)))}),o("touchEnd",()=>{if(!r.destroyed&&r.autoplay.running&&h){if(clearTimeout(p),clearTimeout(e),r.params.autoplay.disableOnInteraction)return d=!1,void(h=!1);d&&r.params.cssMode&&A(),d=!1,h=!1}}),o("slideChange",()=>{!r.destroyed&&r.autoplay.running&&(f=!0)}),Object.assign(r.autoplay,{start:T,stop:E,pause:S,resume:A})},function(t){let{swiper:e,extendParams:i,on:r}=t;i({thumbs:{swiper:null,multipleActiveThumbs:!0,autoScrollOffset:0,slideThumbActiveClass:"swiper-slide-thumb-active",thumbsContainerClass:"swiper-thumbs"}});let n=!1,o=!1;function s(){const t=e.thumbs.swiper;if(!t||t.destroyed)return;const i=t.clickedIndex,r=t.clickedSlide;if(r&&r.classList.contains(e.params.thumbs.slideThumbActiveClass))return;if(null==i)return;let n;n=t.params.loop?parseInt(t.clickedSlide.getAttribute("data-swiper-slide-index"),10):i,e.params.loop?e.slideToLoop(n):e.slideTo(n)}function a(){const{thumbs:t}=e.params;if(n)return!1;n=!0;const i=e.constructor;if(t.swiper instanceof i)e.thumbs.swiper=t.swiper,Object.assign(e.thumbs.swiper.originalParams,{watchSlidesProgress:!0,slideToClickedSlide:!1}),Object.assign(e.thumbs.swiper.params,{watchSlidesProgress:!0,slideToClickedSlide:!1}),e.thumbs.swiper.update();else if(m(t.swiper)){const r=Object.assign({},t.swiper);Object.assign(r,{watchSlidesProgress:!0,slideToClickedSlide:!1}),e.thumbs.swiper=new i(r),o=!0}return e.thumbs.swiper.el.classList.add(e.params.thumbs.thumbsContainerClass),e.thumbs.swiper.on("tap",s),!0}function c(t){const i=e.thumbs.swiper;if(!i||i.destroyed)return;const r="auto"===i.params.slidesPerView?i.slidesPerViewDynamic():i.params.slidesPerView;let n=1;const o=e.params.thumbs.slideThumbActiveClass;if(e.params.slidesPerView>1&&!e.params.centeredSlides&&(n=e.params.slidesPerView),e.params.thumbs.multipleActiveThumbs||(n=1),n=Math.floor(n),i.slides.forEach(t=>t.classList.remove(o)),i.params.loop||i.params.virtual&&i.params.virtual.enabled)for(let t=0;t<n;t+=1)b(i.slidesEl,`[data-swiper-slide-index="${e.realIndex+t}"]`).forEach(t=>{t.classList.add(o)});else for(let t=0;t<n;t+=1)i.slides[e.realIndex+t]&&i.slides[e.realIndex+t].classList.add(o);const s=e.params.thumbs.autoScrollOffset,a=s&&!i.params.loop;if(e.realIndex!==i.realIndex||a){const n=i.activeIndex;let o,l;if(i.params.loop){const t=i.slides.filter(t=>t.getAttribute("data-swiper-slide-index")===""+e.realIndex)[0];o=i.slides.indexOf(t),l=e.activeIndex>e.previousIndex?"next":"prev"}else o=e.realIndex,l=o>e.previousIndex?"next":"prev";a&&(o+="next"===l?s:-1*s),i.visibleSlidesIndexes&&i.visibleSlidesIndexes.indexOf(o)<0&&(i.params.centeredSlides?o=o>n?o-Math.floor(r/2)+1:o+Math.floor(r/2)-1:o>n&&i.params.slidesPerGroup,i.slideTo(o,t?0:void 0))}}e.thumbs={swiper:null},r("beforeInit",()=>{const{thumbs:t}=e.params;if(t&&t.swiper)if("string"==typeof t.swiper||t.swiper instanceof HTMLElement){const i=l(),r=()=>{const r="string"==typeof t.swiper?i.querySelector(t.swiper):t.swiper;if(r&&r.swiper)t.swiper=r.swiper,a(),c(!0);else if(r){const i=n=>{t.swiper=n.detail[0],r.removeEventListener("init",i),a(),c(!0),t.swiper.update(),e.update()};r.addEventListener("init",i)}return r},n=()=>{if(e.destroyed)return;r()||requestAnimationFrame(n)};requestAnimationFrame(n)}else a(),c(!0)}),r("slideChange update resize observerUpdate",()=>{c()}),r("setTransition",(t,i)=>{const r=e.thumbs.swiper;r&&!r.destroyed&&r.setTransition(i)}),r("beforeDestroy",()=>{const t=e.thumbs.swiper;t&&!t.destroyed&&o&&t.destroy()}),Object.assign(e.thumbs,{init:a,update:c})},function(t){let{swiper:e,extendParams:i,emit:r,once:n}=t;i({freeMode:{enabled:!1,momentum:!0,momentumRatio:1,momentumBounce:!0,momentumBounceRatio:1,momentumVelocityRatio:1,sticky:!1,minimumVelocity:.02}}),Object.assign(e,{freeMode:{onTouchStart:function(){if(e.params.cssMode)return;const t=e.getTranslate();e.setTranslate(t),e.setTransition(0),e.touchEventsData.velocities.length=0,e.freeMode.onTouchEnd({currentPos:e.rtl?e.translate:-e.translate})},onTouchMove:function(){if(e.params.cssMode)return;const{touchEventsData:t,touches:i}=e;0===t.velocities.length&&t.velocities.push({position:i[e.isHorizontal()?"startX":"startY"],time:t.touchStartTime}),t.velocities.push({position:i[e.isHorizontal()?"currentX":"currentY"],time:p()})},onTouchEnd:function(t){let{currentPos:i}=t;if(e.params.cssMode)return;const{params:o,wrapperEl:s,rtlTranslate:a,snapGrid:l,touchEventsData:c}=e,u=p()-c.touchStartTime;if(i<-e.minTranslate())e.slideTo(e.activeIndex);else if(i>-e.maxTranslate())e.slides.length<l.length?e.slideTo(l.length-1):e.slideTo(e.slides.length-1);else{if(o.freeMode.momentum){if(c.velocities.length>1){const t=c.velocities.pop(),i=c.velocities.pop(),r=t.position-i.position,n=t.time-i.time;e.velocity=r/n,e.velocity/=2,Math.abs(e.velocity)<o.freeMode.minimumVelocity&&(e.velocity=0),(n>150||p()-t.time>300)&&(e.velocity=0)}else e.velocity=0;e.velocity*=o.freeMode.momentumVelocityRatio,c.velocities.length=0;let t=1e3*o.freeMode.momentumRatio;const i=e.velocity*t;let u=e.translate+i;a&&(u=-u);let h,d=!1;const f=20*Math.abs(e.velocity)*o.freeMode.momentumBounceRatio;let m;if(u<e.maxTranslate())o.freeMode.momentumBounce?(u+e.maxTranslate()<-f&&(u=e.maxTranslate()-f),h=e.maxTranslate(),d=!0,c.allowMomentumBounce=!0):u=e.maxTranslate(),o.loop&&o.centeredSlides&&(m=!0);else if(u>e.minTranslate())o.freeMode.momentumBounce?(u-e.minTranslate()>f&&(u=e.minTranslate()+f),h=e.minTranslate(),d=!0,c.allowMomentumBounce=!0):u=e.minTranslate(),o.loop&&o.centeredSlides&&(m=!0);else if(o.freeMode.sticky){let t;for(let e=0;e<l.length;e+=1)if(l[e]>-u){t=e;break}u=Math.abs(l[t]-u)<Math.abs(l[t-1]-u)||"next"===e.swipeDirection?l[t]:l[t-1],u=-u}if(m&&n("transitionEnd",()=>{e.loopFix()}),0!==e.velocity){if(t=a?Math.abs((-u-e.translate)/e.velocity):Math.abs((u-e.translate)/e.velocity),o.freeMode.sticky){const i=Math.abs((a?-u:u)-e.translate),r=e.slidesSizesGrid[e.activeIndex];t=i<r?o.speed:i<2*r?1.5*o.speed:2.5*o.speed}}else if(o.freeMode.sticky)return void e.slideToClosest();o.freeMode.momentumBounce&&d?(e.updateProgress(h),e.setTransition(t),e.setTranslate(u),e.transitionStart(!0,e.swipeDirection),e.animating=!0,I(s,()=>{e&&!e.destroyed&&c.allowMomentumBounce&&(r("momentumBounce"),e.setTransition(o.speed),setTimeout(()=>{e.setTranslate(h),I(s,()=>{e&&!e.destroyed&&e.transitionEnd()})},0))})):e.velocity?(r("_freeModeNoMomentumRelease"),e.updateProgress(u),e.setTransition(t),e.setTranslate(u),e.transitionStart(!0,e.swipeDirection),e.animating||(e.animating=!0,I(s,()=>{e&&!e.destroyed&&e.transitionEnd()}))):e.updateProgress(u),e.updateActiveIndex(),e.updateSlidesClasses()}else{if(o.freeMode.sticky)return void e.slideToClosest();o.freeMode&&r("_freeModeNoMomentumRelease")}(!o.freeMode.momentum||u>=o.longSwipesMs)&&(r("_freeModeStaticRelease"),e.updateProgress(),e.updateActiveIndex(),e.updateSlidesClasses())}}}})},function(t){let e,i,r,n,{swiper:o,extendParams:s,on:a}=t;s({grid:{rows:1,fill:"column"}});const l=()=>{let t=o.params.spaceBetween;return"string"==typeof t&&t.indexOf("%")>=0?t=parseFloat(t.replace("%",""))/100*o.size:"string"==typeof t&&(t=parseFloat(t)),t};a("init",()=>{n=o.params.grid&&o.params.grid.rows>1}),a("update",()=>{const{params:t,el:e}=o,i=t.grid&&t.grid.rows>1;n&&!i?(e.classList.remove(t.containerModifierClass+"grid",t.containerModifierClass+"grid-column"),r=1,o.emitContainerClasses()):!n&&i&&(e.classList.add(t.containerModifierClass+"grid"),"column"===t.grid.fill&&e.classList.add(t.containerModifierClass+"grid-column"),o.emitContainerClasses()),n=i}),o.grid={initSlides:t=>{const{slidesPerView:n}=o.params,{rows:s,fill:a}=o.params.grid,l=o.virtual&&o.params.virtual.enabled?o.virtual.slides.length:t.length;r=Math.floor(l/s),e=Math.floor(l/s)===l/s?l:Math.ceil(l/s)*s,"auto"!==n&&"row"===a&&(e=Math.max(e,n*s)),i=e/s},unsetSlides:()=>{o.slides&&o.slides.forEach(t=>{t.swiperSlideGridSet&&(t.style.height="",t.style[o.getDirectionLabel("margin-top")]="")})},updateSlide:(t,n,s)=>{const{slidesPerGroup:a}=o.params,c=l(),{rows:u,fill:h}=o.params.grid,d=o.virtual&&o.params.virtual.enabled?o.virtual.slides.length:s.length;let p,f,m;if("row"===h&&a>1){const i=Math.floor(t/(a*u)),r=t-u*a*i,o=0===i?a:Math.min(Math.ceil((d-i*u*a)/u),a);m=Math.floor(r/o),f=r-m*o+i*a,p=f+m*e/u,n.style.order=p}else"column"===h?(f=Math.floor(t/u),m=t-f*u,(f>r||f===r&&m===u-1)&&(m+=1,m>=u&&(m=0,f+=1))):(m=Math.floor(t/i),f=t-m*i);n.row=m,n.column=f,n.style.height=`calc((100% - ${(u-1)*c}px) / ${u})`,n.style[o.getDirectionLabel("margin-top")]=0!==m?c&&c+"px":"",n.swiperSlideGridSet=!0},updateWrapperSize:(t,i)=>{const{centeredSlides:r,roundLengths:n}=o.params,s=l(),{rows:a}=o.params.grid;if(o.virtualSize=(t+s)*e,o.virtualSize=Math.ceil(o.virtualSize/a)-s,o.params.cssMode||(o.wrapperEl.style[o.getDirectionLabel("width")]=o.virtualSize+s+"px"),r){const t=[];for(let e=0;e<i.length;e+=1){let r=i[e];n&&(r=Math.floor(r)),i[e]<o.virtualSize+i[0]&&t.push(r)}i.splice(0,i.length),i.push(...t)}}}},function(t){let{swiper:e}=t;Object.assign(e,{appendSlide:st.bind(e),prependSlide:at.bind(e),addSlide:lt.bind(e),removeSlide:ct.bind(e),removeAllSlides:ut.bind(e)})},function(t){let{swiper:e,extendParams:i,on:r}=t;i({fadeEffect:{crossFade:!1}}),ht({effect:"fade",swiper:e,on:r,setTranslate:()=>{const{slides:t}=e;e.params.fadeEffect;for(let i=0;i<t.length;i+=1){const t=e.slides[i];let r=-t.swiperSlideOffset;e.params.virtualTranslate||(r-=e.translate);let n=0;e.isHorizontal()||(n=r,r=0);const o=e.params.fadeEffect.crossFade?Math.max(1-Math.abs(t.progress),0):1+Math.min(Math.max(t.progress,-1),0),s=dt(0,t);s.style.opacity=o,s.style.transform=`translate3d(${r}px, ${n}px, 0px)`}},setTransition:t=>{const i=e.slides.map(t=>x(t));i.forEach(e=>{e.style.transitionDuration=t+"ms"}),pt({swiper:e,duration:t,transformElements:i,allSlides:!0})},overwriteParams:()=>({slidesPerView:1,slidesPerGroup:1,watchSlidesProgress:!0,spaceBetween:0,virtualTranslate:!e.params.cssMode})})},function(t){let{swiper:e,extendParams:i,on:r}=t;i({cubeEffect:{slideShadows:!0,shadow:!0,shadowOffset:20,shadowScale:.94}});const n=(t,e,i)=>{let r=i?t.querySelector(".swiper-slide-shadow-left"):t.querySelector(".swiper-slide-shadow-top"),n=i?t.querySelector(".swiper-slide-shadow-right"):t.querySelector(".swiper-slide-shadow-bottom");r||(r=T("div",("swiper-slide-shadow-cube swiper-slide-shadow-"+(i?"left":"top")).split(" ")),t.append(r)),n||(n=T("div",("swiper-slide-shadow-cube swiper-slide-shadow-"+(i?"right":"bottom")).split(" ")),t.append(n)),r&&(r.style.opacity=Math.max(-e,0)),n&&(n.style.opacity=Math.max(e,0))};ht({effect:"cube",swiper:e,on:r,setTranslate:()=>{const{el:t,wrapperEl:i,slides:r,width:o,height:s,rtlTranslate:a,size:l,browser:c}=e,u=e.params.cubeEffect,h=e.isHorizontal(),d=e.virtual&&e.params.virtual.enabled;let p,f=0;u.shadow&&(h?(p=e.wrapperEl.querySelector(".swiper-cube-shadow"),p||(p=T("div","swiper-cube-shadow"),e.wrapperEl.append(p)),p.style.height=o+"px"):(p=t.querySelector(".swiper-cube-shadow"),p||(p=T("div","swiper-cube-shadow"),t.append(p))));for(let t=0;t<r.length;t+=1){const i=r[t];let o=t;d&&(o=parseInt(i.getAttribute("data-swiper-slide-index"),10));let s=90*o,c=Math.floor(s/360);a&&(s=-s,c=Math.floor(-s/360));const p=Math.max(Math.min(i.progress,1),-1);let m=0,g=0,_=0;o%4==0?(m=4*-c*l,_=0):(o-1)%4==0?(m=0,_=4*-c*l):(o-2)%4==0?(m=l+4*c*l,_=l):(o-3)%4==0&&(m=-l,_=3*l+4*l*c),a&&(m=-m),h||(g=m,m=0);const y=`rotateX(${h?0:-s}deg) rotateY(${h?s:0}deg) translate3d(${m}px, ${g}px, ${_}px)`;p<=1&&p>-1&&(f=90*o+90*p,a&&(f=90*-o-90*p),e.browser&&e.browser.need3dFix&&Math.abs(f)/90%2==1&&(f+=.001)),i.style.transform=y,u.slideShadows&&n(i,p,h)}if(i.style.transformOrigin=`50% 50% -${l/2}px`,i.style["-webkit-transform-origin"]=`50% 50% -${l/2}px`,u.shadow)if(h)p.style.transform=`translate3d(0px, ${o/2+u.shadowOffset}px, ${-o/2}px) rotateX(89.99deg) rotateZ(0deg) scale(${u.shadowScale})`;else{const t=Math.abs(f)-90*Math.floor(Math.abs(f)/90),e=1.5-(Math.sin(2*t*Math.PI/360)/2+Math.cos(2*t*Math.PI/360)/2),i=u.shadowScale,r=u.shadowScale/e,n=u.shadowOffset;p.style.transform=`scale3d(${i}, 1, ${r}) translate3d(0px, ${s/2+n}px, ${-s/2/r}px) rotateX(-89.99deg)`}const m=(c.isSafari||c.isWebView)&&c.needPerspectiveFix?-l/2:0;i.style.transform=`translate3d(0px,0,${m}px) rotateX(${e.isHorizontal()?0:f}deg) rotateY(${e.isHorizontal()?-f:0}deg)`,i.style.setProperty("--swiper-cube-translate-z",m+"px")},setTransition:t=>{const{el:i,slides:r}=e;if(r.forEach(e=>{e.style.transitionDuration=t+"ms",e.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(e=>{e.style.transitionDuration=t+"ms"})}),e.params.cubeEffect.shadow&&!e.isHorizontal()){const e=i.querySelector(".swiper-cube-shadow");e&&(e.style.transitionDuration=t+"ms")}},recreateShadows:()=>{const t=e.isHorizontal();e.slides.forEach(e=>{const i=Math.max(Math.min(e.progress,1),-1);n(e,i,t)})},getEffectParams:()=>e.params.cubeEffect,perspective:()=>!0,overwriteParams:()=>({slidesPerView:1,slidesPerGroup:1,watchSlidesProgress:!0,resistanceRatio:0,spaceBetween:0,centeredSlides:!1,virtualTranslate:!0})})},function(t){let{swiper:e,extendParams:i,on:r}=t;i({flipEffect:{slideShadows:!0,limitRotation:!0}});const n=(t,i)=>{let r=e.isHorizontal()?t.querySelector(".swiper-slide-shadow-left"):t.querySelector(".swiper-slide-shadow-top"),n=e.isHorizontal()?t.querySelector(".swiper-slide-shadow-right"):t.querySelector(".swiper-slide-shadow-bottom");r||(r=ft("flip",t,e.isHorizontal()?"left":"top")),n||(n=ft("flip",t,e.isHorizontal()?"right":"bottom")),r&&(r.style.opacity=Math.max(-i,0)),n&&(n.style.opacity=Math.max(i,0))};ht({effect:"flip",swiper:e,on:r,setTranslate:()=>{const{slides:t,rtlTranslate:i}=e,r=e.params.flipEffect;for(let o=0;o<t.length;o+=1){const s=t[o];let a=s.progress;e.params.flipEffect.limitRotation&&(a=Math.max(Math.min(s.progress,1),-1));const l=s.swiperSlideOffset;let c=-180*a,u=0,h=e.params.cssMode?-l-e.translate:-l,d=0;e.isHorizontal()?i&&(c=-c):(d=h,h=0,u=-c,c=0),e.browser&&e.browser.need3dFix&&(Math.abs(c)/90%2==1&&(c+=.001),Math.abs(u)/90%2==1&&(u+=.001)),s.style.zIndex=-Math.abs(Math.round(a))+t.length,r.slideShadows&&n(s,a);const p=`translate3d(${h}px, ${d}px, 0px) rotateX(${u}deg) rotateY(${c}deg)`;dt(0,s).style.transform=p}},setTransition:t=>{const i=e.slides.map(t=>x(t));i.forEach(e=>{e.style.transitionDuration=t+"ms",e.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(e=>{e.style.transitionDuration=t+"ms"})}),pt({swiper:e,duration:t,transformElements:i})},recreateShadows:()=>{e.params.flipEffect,e.slides.forEach(t=>{let i=t.progress;e.params.flipEffect.limitRotation&&(i=Math.max(Math.min(t.progress,1),-1)),n(t,i)})},getEffectParams:()=>e.params.flipEffect,perspective:()=>!0,overwriteParams:()=>({slidesPerView:1,slidesPerGroup:1,watchSlidesProgress:!0,spaceBetween:0,virtualTranslate:!e.params.cssMode})})},function(t){let{swiper:e,extendParams:i,on:r}=t;i({coverflowEffect:{rotate:50,stretch:0,depth:100,scale:1,modifier:1,slideShadows:!0}}),ht({effect:"coverflow",swiper:e,on:r,setTranslate:()=>{const{width:t,height:i,slides:r,slidesSizesGrid:n}=e,o=e.params.coverflowEffect,s=e.isHorizontal(),a=e.translate,l=s?t/2-a:i/2-a,c=s?o.rotate:-o.rotate,u=o.depth;for(let t=0,i=r.length;t<i;t+=1){const i=r[t],a=n[t],h=(l-i.swiperSlideOffset-a/2)/a,d="function"==typeof o.modifier?o.modifier(h):h*o.modifier;let p=s?c*d:0,f=s?0:c*d,m=-u*Math.abs(d),g=o.stretch;"string"==typeof g&&-1!==g.indexOf("%")&&(g=parseFloat(o.stretch)/100*a);let _=s?0:g*d,y=s?g*d:0,v=1-(1-o.scale)*Math.abs(d);Math.abs(y)<.001&&(y=0),Math.abs(_)<.001&&(_=0),Math.abs(m)<.001&&(m=0),Math.abs(p)<.001&&(p=0),Math.abs(f)<.001&&(f=0),Math.abs(v)<.001&&(v=0),e.browser&&e.browser.need3dFix&&(Math.abs(p)/90%2==1&&(p+=.001),Math.abs(f)/90%2==1&&(f+=.001));const x=`translate3d(${y}px,${_}px,${m}px)  rotateX(${f}deg) rotateY(${p}deg) scale(${v})`;if(dt(0,i).style.transform=x,i.style.zIndex=1-Math.abs(Math.round(d)),o.slideShadows){let t=s?i.querySelector(".swiper-slide-shadow-left"):i.querySelector(".swiper-slide-shadow-top"),e=s?i.querySelector(".swiper-slide-shadow-right"):i.querySelector(".swiper-slide-shadow-bottom");t||(t=ft("coverflow",i,s?"left":"top")),e||(e=ft("coverflow",i,s?"right":"bottom")),t&&(t.style.opacity=d>0?d:0),e&&(e.style.opacity=-d>0?-d:0)}}},setTransition:t=>{e.slides.map(t=>x(t)).forEach(e=>{e.style.transitionDuration=t+"ms",e.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(e=>{e.style.transitionDuration=t+"ms"})})},perspective:()=>!0,overwriteParams:()=>({watchSlidesProgress:!0})})},function(t){let{swiper:e,extendParams:i,on:r}=t;i({creativeEffect:{limitProgress:1,shadowPerProgress:!1,progressMultiplier:1,perspective:!0,prev:{translate:[0,0,0],rotate:[0,0,0],opacity:1,scale:1},next:{translate:[0,0,0],rotate:[0,0,0],opacity:1,scale:1}}});const n=t=>"string"==typeof t?t:t+"px";ht({effect:"creative",swiper:e,on:r,setTranslate:()=>{const{slides:t,wrapperEl:i,slidesSizesGrid:r}=e,o=e.params.creativeEffect,{progressMultiplier:s}=o,a=e.params.centeredSlides;if(a){const t=r[0]/2-e.params.slidesOffsetBefore||0;i.style.transform=`translateX(calc(50% - ${t}px))`}for(let i=0;i<t.length;i+=1){const r=t[i],l=r.progress,c=Math.min(Math.max(r.progress,-o.limitProgress),o.limitProgress);let u=c;a||(u=Math.min(Math.max(r.originalProgress,-o.limitProgress),o.limitProgress));const h=r.swiperSlideOffset,d=[e.params.cssMode?-h-e.translate:-h,0,0],p=[0,0,0];let f=!1;e.isHorizontal()||(d[1]=d[0],d[0]=0);let m={translate:[0,0,0],rotate:[0,0,0],scale:1,opacity:1};c<0?(m=o.next,f=!0):c>0&&(m=o.prev,f=!0),d.forEach((t,e)=>{d[e]=`calc(${t}px + (${n(m.translate[e])} * ${Math.abs(c*s)}))`}),p.forEach((t,i)=>{let r=m.rotate[i]*Math.abs(c*s);e.browser&&e.browser.need3dFix&&Math.abs(r)/90%2==1&&(r+=.001),p[i]=r}),r.style.zIndex=-Math.abs(Math.round(l))+t.length;const g=d.join(", "),_=`rotateX(${p[0]}deg) rotateY(${p[1]}deg) rotateZ(${p[2]}deg)`,y=u<0?`scale(${1+(1-m.scale)*u*s})`:`scale(${1-(1-m.scale)*u*s})`,v=u<0?1+(1-m.opacity)*u*s:1-(1-m.opacity)*u*s,x=`translate3d(${g}) ${_} ${y}`;if(f&&m.shadow||!f){let t=r.querySelector(".swiper-slide-shadow");if(!t&&m.shadow&&(t=ft("creative",r)),t){const e=o.shadowPerProgress?c*(1/o.limitProgress):c;t.style.opacity=Math.min(Math.max(Math.abs(e),0),1)}}const b=dt(0,r);b.style.transform=x,b.style.opacity=v,m.origin&&(b.style.transformOrigin=m.origin)}},setTransition:t=>{const i=e.slides.map(t=>x(t));i.forEach(e=>{e.style.transitionDuration=t+"ms",e.querySelectorAll(".swiper-slide-shadow").forEach(e=>{e.style.transitionDuration=t+"ms"})}),pt({swiper:e,duration:t,transformElements:i,allSlides:!0})},perspective:()=>e.params.creativeEffect.perspective,overwriteParams:()=>({watchSlidesProgress:!0,virtualTranslate:!e.params.cssMode})})},function(t){let{swiper:e,extendParams:i,on:r}=t;i({cardsEffect:{slideShadows:!0,rotate:!0,perSlideRotate:2,perSlideOffset:8}}),ht({effect:"cards",swiper:e,on:r,setTranslate:()=>{const{slides:t,activeIndex:i,rtlTranslate:r}=e,n=e.params.cardsEffect,{startTranslate:o,isTouched:s}=e.touchEventsData,a=r?-e.translate:e.translate;for(let l=0;l<t.length;l+=1){const c=t[l],u=c.progress,h=Math.min(Math.max(u,-4),4);let d=c.swiperSlideOffset;e.params.centeredSlides&&!e.params.cssMode&&(e.wrapperEl.style.transform=`translateX(${e.minTranslate()}px)`),e.params.centeredSlides&&e.params.cssMode&&(d-=t[0].swiperSlideOffset);let p=e.params.cssMode?-d-e.translate:-d,f=0;const m=-100*Math.abs(h);let g=1,_=-n.perSlideRotate*h,y=n.perSlideOffset-.75*Math.abs(h);const v=e.virtual&&e.params.virtual.enabled?e.virtual.from+l:l,x=(v===i||v===i-1)&&h>0&&h<1&&(s||e.params.cssMode)&&a<o,b=(v===i||v===i+1)&&h<0&&h>-1&&(s||e.params.cssMode)&&a>o;if(x||b){const t=(1-Math.abs((Math.abs(h)-.5)/.5))**.5;_+=-28*h*t,g+=-.5*t,y+=96*t,f=-25*t*Math.abs(h)+"%"}if(h<0?p=`calc(${p}px ${r?"-":"+"} (${y*Math.abs(h)}%))`:h>0?p=`calc(${p}px ${r?"-":"+"} (-${y*Math.abs(h)}%))`:p+="px",!e.isHorizontal()){const t=f;f=p,p=t}const w=h<0?""+(1+(1-g)*h):""+(1-(1-g)*h),T=`\n        translate3d(${p}, ${f}, ${m}px)\n        rotateZ(${n.rotate?r?-_:_:0}deg)\n        scale(${w})\n      `;if(n.slideShadows){let t=c.querySelector(".swiper-slide-shadow");t||(t=ft("cards",c)),t&&(t.style.opacity=Math.min(Math.max((Math.abs(h)-.5)/.5,0),1))}c.style.zIndex=-Math.abs(Math.round(u))+t.length;dt(0,c).style.transform=T}},setTransition:t=>{const i=e.slides.map(t=>x(t));i.forEach(e=>{e.style.transitionDuration=t+"ms",e.querySelectorAll(".swiper-slide-shadow").forEach(e=>{e.style.transitionDuration=t+"ms"})}),pt({swiper:e,duration:t,transformElements:i})},perspective:()=>!0,overwriteParams:()=>({watchSlidesProgress:!0,virtualTranslate:!e.params.cssMode})})}];rt.use(mt);i("u+OR");function gt(t){return(gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,yt(r.key),r)}}function yt(t){var e=function(t,e){if("object"!=gt(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!=gt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==gt(e)?e:String(e)}var vt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i,r;return e=t,r=[{key:"init",value:function(){var t=this;this.uid="video-embed",this.modalUid="modal-container",$('<div id="'.concat(this.modalUid,'"/>')).appendTo("body"),$(".watch-video").on("click",(function(e){e.preventDefault(),t.setVideoSource(e.currentTarget),t.launchModal(!0)}))}},{key:"setVideoSource",value:function(t){this.item=$(t),this.videoID=this.item.data("source"),this.type=this.item.data("type")}},{key:"launchModal",value:function(t){this.setTop(),$("#".concat(this.modalUid)).html(this.modalHTML()),$("body").addClass("modal-open modal-video-open"),"youtube"==this.type&&this.setupYoutube(t),"vimeo"==this.type&&this.setupVimeo(t),"wistia"==this.type&&this.setupWistia(t),this.setupCloseEvent()}},{key:"setupYoutube",value:function(t){return new YT.Player(this.uid,{width:"100%",height:"100%",videoId:this.videoID,playerVars:{autoplay:t?1:0,mute:1}})}},{key:"setupVimeo",value:function(t){new Vimeo.Player(this.uid,{id:this.videoID,width:"100%",muted:!1,playsinline:!0,autoplay:t})}},{key:"setupWistia",value:function(t){window._wq=window._wq||[],_wq.push({id:this.videoID,options:{autoPlay:t,controlsVisibleOnLoad:!0,endVideoBehavior:"default",playerColor:"#f25a54"}})}},{key:"setupCloseEvent",value:function(){var t=this;jQuery(".modal .close").click((function(e){return $("body").removeClass("modal-open modal-video-open"),$("#".concat(t.modalUid)).html(""),t.resetTop(),!1}))}},{key:"modalHTML",value:function(){switch(this.type){case"upload":this.videoContainer="\n          <video autoplay controls>\n            <source id='mp4' src=\"".concat(this.videoID,"\" type='video/mp4' />\n          </video>\n        ");break;case"wistia":this.videoContainer='<div class="wistia_embed wistia_async_'.concat(this.videoID,'"></div>');break;default:this.videoContainer='<div id="'.concat(this.uid,'"></div>')}return'\n\t\t\t<div class="modal in" id="modal-video">\n        <div class="video-container">\n          <div class="video-wrap">\n            <div class="bg-modal close"></div>\n            <div class="video-frame with-background">\n              <a href="#" class="modal-close close"></a>\n              '.concat(this.videoContainer,"\n            </div>\n          </div>\n        </div>\n      </div>\n\t\t")}},{key:"setTop",value:function(){var t=document.documentElement.style.getPropertyValue("--scroll-y");document.body.style.top="-".concat(t)}},{key:"resetTop",value:function(){var t=document.body,e=t.style.top;t.style.top="",window.scrollTo(0,-1*parseInt(e||"0"))}}],(i=null)&&_t(e.prototype,i),r&&_t(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();var xt=function(t,e,i){var r;return function(){var n=arguments;i=i||this,clearTimeout(r),r=setTimeout((function(){r=null,t.apply(i,n)}),e)}},bt=function(t,e,i){return(1-i)*t+i*e},wt=function(t,e,i){t.hasClass("active")||(0===t.closest(e).find("[data-more].active").length?jQuery("html, body").animate({scrollTop:t.offset().top-i},800):setTimeout((function(){jQuery("html, body").animate({scrollTop:t.offset().top-i},800)}),350))},Tt=(i("BFHv"),function(){var t=$(".nav-opener");$(".nav-panel").find("a");t.click((function(){$("body").toggleClass("nav-active")})),$(".nav li").each((function(){var t=$(this),e=t.find("ul"),i=t.find("a").eq(0);e.length&&(t.addClass("hasdrop"),i.length&&i.addClass("hasdrop-a").attr({"data-more":"","data-outside":""}))}))}),Et=function(){$('a[href^="#"]:not([href="#"])').click((function(t){t.preventDefault();var e=$("#header").outerHeight(),i=$(this).attr("href"),r=$(i);if(r.length){var n=r.offset().top-e;$("html, body").animate({scrollTop:n},1e3)}}))},St=function(){var t=$(window),e=$("#header"),i=function(){t.scrollTop()>0?e.addClass("sticky"):e.removeClass("sticky")};i(),t.on("scroll",i)},At=function(){$("[data-more]").next().hide(),$("[data-more].active").next().show();$(".accordion .active").siblings(".slide").find("video:not(video.accordion-video)").get(0);$("[data-more]").click((function(t){var e=$("#header").outerHeight();t.preventDefault(),$(".accordion video").each((function(){this.pause()})),$(".shared-video video").each((function(){this.play()})),"ac"===$(this).data("more")&&(wt($(this),"#wrapper",e),window.location.hash=$(this).find(".btn").attr("href")),$(this).closest("[data-accordion]").length&&window.innerWidth<1023&&wt($(this),"[data-accordion]",e),($(this).closest("[data-accordion]").length||"ac"===$(this).data("more"))&&($(this).parent().siblings().find("[data-more]").removeClass("active"),$(this).parent().siblings().find("[data-more]").next().slideUp(350)),$(this).closest('[data-accordion="one"]').length?window.innerWidth<1e3?$(this).hasClass("active")?$(this).removeClass("active").next().slideUp(350):$(this).addClass("active").next().slideToggle(350):$(this).addClass("active").next().slideDown(350):$(this).hasClass("active")?$(this).removeClass("active").next().slideUp(350):$(this).addClass("active").next().slideToggle(350),Ut($(".accordion .active").siblings(".slide").find("source-data")),$(".accordion .active").siblings(".slide").find("video").get(0).play(),Gt()})),$("[data-outside]").next().find("a:not(.hasdrop-a):not([data-more])").click((function(){$("[data-outside]").removeClass("active").next("").slideUp(350)})),$("[data-outside]").click((function(t){$("[data-outside]").not(this).removeClass("active").next().slideUp(350)})),$("html").on("click touchstart pointerdown MSPointerDown",(function(t){var e=$(t.target);e.closest("[data-outside]").length||e.closest("[data-outside] + *").length||setTimeout((function(){$("[data-outside]").removeClass("active").next().slideUp(350)}),350),e.closest("[data-outside-1]").length||e.closest("[data-outside-1] + *").length||setTimeout((function(){$("[data-outside-1]").removeClass("active").next().slideUp(350)}),350)})),$(".js-slide .link-close").click((function(t){t.preventDefault();var e=$(this).parents(".js-slide"),i=e.prev().offset().top;jQuery("html, body").animate({scrollTop:i},800),setTimeout((function(){e.slideUp(350),e.prev().removeClass("active")}),350)}));var t=window.location.hash;$('[data-more="ac"] [href="'.concat(t,'"]')).closest('[data-more="ac"]').addClass("active").next().slideDown();var e=!1;function i(){if($(window).width()>1339&&!e){var t=$(".accordion-section .container").height();$(".accordion-section .container .img-hold").height(t),e=!0}}i(),$(window).resize((function(){e||i()}))},Mt=function(){$("[data-select]").each((function(){var t=$(this),e=t.next(),i=e.find("a");t.attr({"data-outside":"","data-more":""}),i.on("click",(function(i){i.preventDefault(),t.text($(this).text()),e.slideUp(200),t.removeClass("active").addClass("selected"),e.find("li").removeClass("active"),$(this).parent().addClass("active")})),e.children().hasClass("active")&&t.text($(this).next().find(".active a").text()).addClass("selected")}))},It=function(){$("[data-tab]").click((function(t){t.preventDefault();var e=$(this).attr("data-tab");$(this).parent().siblings().find("[data-tab]").removeClass("active"),$("#"+e).siblings().removeClass("active"),$(this).addClass("active"),$("#"+e).addClass("active")})),$("#"+$("[data-tab].active").data("tab")).addClass("active")},Ct=function(){var t=document.querySelectorAll(".tab-slider [data-nav]"),e=new rt(".tab-slider",{effect:"fade",autoplay:!1,autoHeight:!0,pagination:{el:".swiper-pagination",clickable:!0,renderBullet:function(e,i,r){return'<span class="'+i+'">'+$(t[e]).data("nav")+"</span>"}},on:{init:function(){$(".tab-slider .img video").each((function(){this.pause()}));var t=$(".tab-slider .swiper-slide-active .img video");t.length>0&&t[0].play()},slideChange:function(){e.activeIndex;var t=$(".tab-slider .swiper-slide-visible .img video");$(".tab-slider .img video").each((function(){this.pause()})),t.length>0&&t[0].play()}}});new rt(".featured-article-slider",{slidesPerView:1,loop:!1,spaceBetween:24,centeredSlides:!0,autoplay:!1,breakpoints:{640:{slidesPerView:2,centeredSlides:!1},1024:{slidesPerView:3,centeredSlides:!1},1350:{slidesPerView:4,spaceBetween:40,centeredSlides:!1}}}),new rt(".project-slider",{slidesPerView:"auto",spaceBetween:24,loop:!0,centeredSlides:!0,autoplay:!1,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},breakpoints:{1440:{spaceBetween:40}}});$(".interest-slider").each((function(t,e){var i=$(e).closest(".interests"),r=$(e).closest(".swiper-wrapper");new rt(e,{slidesPerView:"auto",spaceBetween:18,watchOverflow:!0,loop:!1,centeredSlides:!0,autoplay:!1,navigation:{nextEl:i.find(".swiper-button-next")[0],prevEl:i.find(".swiper-button-prev")[0]},breakpoints:{768:{centeredSlides:!1},1024:{centeredSlides:!1},1350:{centeredSlides:!1}}});i.on("resize",(function(){e.classList.toggle(".slider-active",r.size>i.size)}))}));var i,r=!1;function n(){window.innerWidth>=768?r||(r=!0,i=new rt(".three-cols-slider",{slidesPerView:3,spaceBetween:20,breakpoints:{1280:{spaceBetween:40}}})):r&&(i.destroy(),r=!1)}n(),window.addEventListener("resize",n),document.querySelectorAll(".mission-slider").length&&document.querySelectorAll(".mission-slider").forEach((function(t){var e=t.querySelectorAll(".swiper-slide");new rt(t,{slidesPerView:"auto",spaceBetween:34,loop:!0,freemode:!0,autoplay:!1,centeredSlides:!0,loopedSlides:5*e.length,breakpoints:{1024:{spaceBetween:40,centeredSlides:!1}},on:{init:function(){for(var t=[],e=1;e<=3;e++){var i=this.slides[this.slides.length-e];t.push(i)}this.prependSlide(t)}}})}))},Pt=function(){var t=function(){var t=window.innerHeight||document.documentElement.clientHeight,e=document.documentElement.clientWidth;document.documentElement.style.setProperty("--vh",t+"px"),document.documentElement.style.setProperty("--vw",e+"px"),document.documentElement.style.setProperty("--scroll-y","".concat(window.scrollY,"px"))};t(),$(window).on("resize orientationChange scroll",t)},Rt=function(){$(".btn-play").on("click",(function(t){t.preventDefault();var e=$(this).closest(".video").find("video")[0];e.controls=!0,e.play(),$(this).hide()}))},Ot=function(){$(".superscript").on("click",(function(t){t.preventDefault();var e=$(this).attr("href"),i=$("#"+e);if(i.length){var r=i.offset().top-110;$("html, body").animate({scrollTop:r},1e3)}}))},Dt=function(){var t=$(".filter-nav a.btn").first();if(t.length>0){var e=t.attr("class").match(/form(\d+)/)[1];$(".filter-nav a.btn").addClass("btn-secondary"),t.removeClass("btn-secondary"),t.addClass("is-action"),$(".form"+e).show(),$(".filter-nav").on("click","a.btn",(function(t){if($(this).is("[data-link]")){var e=$(this).attr("href");"_blank"===$(this).attr("target")?window.open(e):window.location.href=e}else{t.preventDefault();var i=$(this).attr("class").match(/form(\d+)/)[1];$(this).toggleClass("is-action btn-secondary"),$(".filter-nav a.btn").not(this).removeClass("is-action").addClass("btn-secondary"),$(".form").slideUp("slow"),setTimeout((function(){$(".form"+i).slideDown("slow")}),600)}}))}},Lt=function(){$(".tabset ul li a").click((function(t){t.preventDefault(),$(".tabset ul li").removeClass("active"),$(this).closest("li").addClass("active");var e=$(this).data("filter");$(".member-list.tabs").removeClass("active"),$('.member-list.tabs[data-category="'+e+'"]').addClass("active")}))},kt=function(){$(".featured-resources .list a").click((function(t){t.preventDefault();var e=$(this).data("filter");$(".featured-resources .cols-group").hide(),$(".featured-resources .cols-group."+e).show()}))},Bt=function(){function t(){$("body").removeClass("modal-active"),$(".modal").removeClass("show")}$("[data-modal]").on("click",(function(t){return $("body").addClass("modal-active"),$(".modal").removeClass("show"),$($(this).attr("href")).addClass("show").find(".col-r").animate({scrollTop:$(".col-r")},0),!1})),$(".modal .close").click((function(e){e.preventDefault(),t()})),$(document).keyup((function(e){27===e.keyCode&&t();var i=$(".modal.show");39===e.keyCode&&i.next().hasClass("modal")&&($(i).removeClass("show"),$(i).next(".modal").addClass("show")),37===e.keyCode&&i.prev().hasClass("modal")&&($(i).removeClass("show"),$(i).prev(".modal").addClass("show"))})),$("html").on("click touchstart pointerdown MSPointerDown",(function(e){var i=$(e.target);i.closest(".modal-box").length||i.closest("[data-player]").length||t()}))},Ft=function(){var t=$(".check-quote");'"'===t.text().charAt(0)&&t.addClass("true")},zt=function(){$(".card-resources .card-content").matchHeight(),$(".card-resources .card-content h3").matchHeight()},Nt=function(){function t(){$(".accordion .first source-data").add("source-data").not(".accordion .rest source-data").each((function(){var t,e,i,r,n,o=$(this).closest("video");t=o,e=$(t).offset().top-80,i=e+$(t).outerHeight(),r=$(window).scrollTop(),n=r+$(window).height(),i>r&&e<n&&Ut(this)}))}t(),$(window).on("scroll resize",t),Gt()};function Ut(t){var e=$("source-data").data("src"),i=$("source-data").data("type"),r=$("<source></source>").attr("src",e).attr("type",i);$(t).replaceWith(r)}function Gt(){$(".accordion .active").siblings(".slide").find("video").on("loadedmetadata",(function(){var t=$(this).get(0);t.videoWidth/t.videoHeight>1?$(this).closest(".slide").find(".img").addClass("horizontal"):$(this).closest(".slide").find(".img").addClass("vertical")}))}var jt=function(){$(window).on("load",(function(){setTimeout((function(){$(".hs-fieldtype-text").each((function(){var t=$(this).find("input").attr("value");void 0!==t&&""!==t.trim()&&$(this).find("label").remove()}))}),300)}))},Vt=function(){$(".gaia-block-button:not(.gaia-cta)").on("click",(function(t){t.preventDefault();var e=$(".gaia-section .foreground").outerHeight();$("#onemind-widget").height(e),$(".gaia-section .foreground").fadeOut(300,(function(){$("#onemind-widget").fadeIn(300)}))})),$("body").on("click",'a[href="#chapter-1"]',(function(t){$(this).closest(".filter-nav").length>0||(t.preventDefault(),console.log("clicked"),Storylane.Play({type:"popup",demo_type:"image",width:1920,height:1080,scale:"0.95",demo_url:"https://pachama.storylane.io/demo/3nbspghszxcl?embed=popup&chapter=1",padding_bottom:"calc(56.25% + 25px)"}))})),$("body").on("click",'a[href="#chapter-2"]',(function(t){$(this).closest(".filter-nav").length>0||(t.preventDefault(),console.log("clicked"),Storylane.Play({type:"popup",demo_type:"image",width:1920,height:1080,scale:"0.95",demo_url:"https://pachama.storylane.io/demo/7dctxpnmjc0m?embed=popup&chapter=2",padding_bottom:"calc(56.25% + 25px)"}))})),$("body").on("click",'a[href="#chapter-3"]',(function(t){$(this).closest(".filter-nav").length>0||(t.preventDefault(),console.log("clicked"),Storylane.Play({type:"popup",demo_type:"image",width:1920,height:1080,scale:"0.95",demo_url:"https://pachama.storylane.io/demo/uskhyuhnfona?embed=popup&chapter=3",padding_bottom:"calc(56.25% + 25px)"}))}))},Xt=function(){function t(t,e){/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?window.open(t,e):window.open(t,"","width=550,height=400,resizable=yes,scrollbars=yes,top=200,left=200")}$(document).ready((function(){var e=window.location.href;$("a.x").on("click",(function(i){i.preventDefault();var r=$(this).attr("data-handles"),n=r?"by ".concat(r," via @PachamaInc"):"by @PachamaInc";t("https://x.com/intent/tweet?text="+encodeURIComponent(e+" "+n),"_blank")})),$("a.fb").on("click",(function(i){i.preventDefault(),t("https://www.facebook.com/sharer/sharer.php?u="+e,"_blank")})),$("a.li").on("click",(function(i){i.preventDefault(),t("https://www.linkedin.com/sharing/share-offsite/?url="+e,"_blank")})),$("a.share-link").on("click",(function(t){t.preventDefault(),function(t,e){var i=document.createElement("input");i.setAttribute("value",t),e.appendChild(i),i.select();var r=document.execCommand("copy");e.removeChild(i)}(e,t.currentTarget),t.target.classList.add("active"),setTimeout((function(){t.target.classList.remove("active")}),2e3)}))}))},Ht=function(){$(".latest-resources .filter-nav .list a").click((function(t){t.preventDefault();var e=$(this).closest(".latest-resources"),i=e.data("show-tags");i=i?"true":"false";var r=e.find(".filter-nav").data("technical"),n=e.find(".filter-nav").data("limit"),o=e.find(".filter-nav").data("type"),s=$(this).data("filter"),a=e.data("categories-order")||"",l=window.location.pathname+"?category="+s+"&type="+o;n||history.pushState({path:l},"",l);var c=$("#ajax-resources-nonce").val();e.find(".nav-row .label").hide(),e.find(".foot .label").hide(),e.find("#loader").show(),e.find(".cols-group").hide(),$.ajax({type:"post",dataType:"json",url:wp_ajax.ajaxurl,data:{action:"post_filter",category:s,nonce:c,technical:r,limit:n,type:o,display_tags:i,categories_order:a},success:function(t){var i=""!==t.html?t.html:'<div class="no-result">No results</div>';e.find(".cols-group").empty().append(i),t.post_count<13?e.find(".foot .btn").hide():e.find(".foot .btn").show();var r=e.find(".cols-group .col").length;e.find(".nav-row .label").show(),e.find(".foot .label").show();var n="insights"===o?"Showing ".concat(r," of ").concat(t.post_count," solutions"):"Showing ".concat(r," of ").concat(t.post_count," articles");e.find(".label").text(n),e.find("#loader").hide(),e.find(".cols-group").show()},error:function(t){e.find(".foot .label").show(),e.find(".nav-row .label").show(),e.find("#loader").hide(),e.find(".cols-group").show()}})}))},qt=function(){$(".latest-resources").each((function(){$(this).data("current-page",1)})),$(".latest-resources .filter-nav .list a").on("click",(function(t){$(this).closest(".latest-resources").data("current-page",1)})),$(document).on("click",".latest-resources .foot .btn",(function(t){if(t.preventDefault(),$(this).hasClass("loading"))return!1;var e=$(this).closest(".latest-resources"),i=e.data("current-page")||1,r=e.find(".filter-nav .list li.active a").data("filter");r||(r="all");var n=e.find(".filter-nav").data("technical"),o=e.find(".filter-nav").data("type"),s=e.data("show-tags")?"true":"false",a=$("#ajax-resources-nonce").val(),l=e.data("categories-order")||"";!function(t,e,i,r,n,o,s,a){t.find(".foot .btn").addClass("loading"),$.ajax({type:"post",dataType:"json",url:wp_ajax.ajaxurl,data:{action:"post_filter",category:e,page:i,nonce:r,technical:n,type:o,display_tags:s,categories_order:a},success:function(e){t.find(".foot .btn").removeClass("loading");var i=""!==e.html?e.html:'<div class="no-result">No results</div>';e.page?(t.find(".cols-group").append(i),t.data("current-page",e.page)):(t.find(".cols-group").empty().append(i),t.data("current-page",1));var r=t.find(".cols-group .col").length;e.post_count<13||r>=e.post_count?t.find(".foot .btn").hide():t.find(".foot .btn").show();var n="insights"===o?"Showing ".concat(r," of ").concat(e.post_count," solutions"):"Showing ".concat(r," of ").concat(e.post_count," articles");t.find(".label").text(n)},error:function(e){t.find(".foot .btn").removeClass("loading")}})}(e,r,i,a,n,o,s,l)}))},Wt=function(){var t=$t("category"),e=$t("type"),i=$("#ajax-resources-nonce").val();$(".latest-resources #loader").hide(),i&&t&&$(".latest-resources").each((function(){var r=$(this),n=r.find(".filter-nav").data("type");if(!e||e===n){var o=r.find('.list a[data-filter="'+t+'"]');if(o.length){o.parent("li").siblings().removeClass("active"),o.parent("li").addClass("active");var s=r.find(".select-opener");s.length&&s.text(o.text());var a=r.find(".filter-nav").data("technical"),l=r.find(".filter-nav").data("limit"),c=r.data("show-tags");c=c?"true":"false";var u=r.data("categories-order")||"";!function(t,e,i,r,n,o,s,a){t.find("#loader").show(),t.find(".cols-group").hide(),$.ajax({type:"post",dataType:"json",url:wp_ajax.ajaxurl,data:{action:"post_filter",category:e,nonce:o,technical:i,type:r,limit:n,display_tags:s,categories_order:a},success:function(e){var i=""!==e.html?e.html:'<div class="no-result">No results</div>';t.find(".cols-group").empty().append(i),e.post_count<13?t.find(".foot .btn").hide():t.find(".foot .btn").show();var n=t.find(".cols-group .col").length,o="insights"===r?"Showing ".concat(n," of ").concat(e.post_count," solutions"):"Showing ".concat(n," of ").concat(e.post_count," articles");t.find(".label").text(o),t.find("#loader").hide(),t.find(".cols-group").show(),t.data("current-page",1),function(t){if(t.length){var e=t.offset().top-100;$("html, body").animate({scrollTop:e},{duration:"slow",easing:"swing"})}}(t)},error:function(e){t.find("#loader").hide(),t.find(".cols-group").show()}})}(r,t,a,n,l,i,c,u)}}}))};function $t(t){var e=new URLSearchParams(window.location.search).get(t);return null===e?null:decodeURIComponent(e)}function Yt(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return Zt(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Zt(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw o}}}}function Zt(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}var Kt,Jt,Qt,te=i("lLqN");te.init("47ee158d71d066e8a2b44a15412a6999",{autocapture:!0});var ee=function(){if(le()){var t=$("h1").first().text();te.track("Blog Post Viewed",{blog_name:t})}ie()&&te.track("Homepage Viewed"),re()&&te.track("Technology Page Viewed"),ne()&&te.track("Invest In Nature Page Viewed"),oe()&&te.track("Our Mission Page Viewed"),ae()&&te.track("Resources Page Viewed"),se()&&te.track("Supplier Landing Page Viewed"),ce()&&te.track("Project Design Landing Page Viewed"),ue()&&te.track("Land Suitability Landing Page Viewed"),$(".contact-sales-button").on("click",(function(){te.track("Contact Sales CTA Button Clicked",{cta_text:$(this).text()})})),$(".project-creation").on("click",(function(){te.track("Project Creation CTA Clicked",{cta_text:$(this).text(),cta_location:$(this).data("location")})})),$(".asses-now-land").on("click",(function(){te.track("Land suitability landing CTA clicked",{cta_text:$(this).text(),cta_location:$(this).data("location")})}));var e={childList:!0,subtree:!0},i=function(t,e){var i,r=Yt(t);try{for(r.s();!(i=r.n()).done;){if("childList"===i.value.type&&!document.getElementById(Qt))return te.track(Jt,Kt),e.disconnect(),Kt={},Jt="",void(Qt="")}}catch(t){r.e(t)}finally{r.f()}};function r(){new MutationObserver(i).observe(document.body,e)}$(document).on("submit","#hsForm_a5c98945-bc3b-4ded-aade-3db4a11654be",(function(){var t=$(this).find('input[name="firstname"]').val(),e=$(this).find('input[name="lastname"]').val(),i=$(this).find('input[name="email"]').val(),n=$(this).find('input[name="company"]').val(),o=$(this).find('input[type=radio][name="what_is_your_primary_need___new_"]').val(),s=$(this).find('input[name="recent_user_intention"]').val(),a=$(this).find('input[name="recent_conversion_type"]').val(),l=$(document).find("title").text();Kt={general_form_name:t+" "+e,general_form_email:i,general_form_company:n,general_form_primary_need:o,general_form_page:l,general_form_user_intention:s,general_form_conversion_type:a},Jt="General Inquiries Form Submitted",Qt="hsForm_a5c98945-bc3b-4ded-aade-3db4a11654be",r()})),$(document).on("submit","#hsForm_c6745501-5bfc-43bf-ae9a-fd51844ddf8d",(function(){var t=$(this).find('input[name="firstname"]').val(),e=$(this).find('input[name="lastname"]').val(),i=$(this).find('input[name="email"]').val(),n=$(this).find('input[name="country_drop_down"]').val(),o=$(this).find('input[name="recent_user_intention"]').val(),s=$(this).find('input[name="recent_conversion_type"]').val();Kt={supplier_form_name:t+" "+e,supplier_form_email:i,supplier_form_project_location:n,supplier_form_user_intention:o,supplier_form_conversion_type:s},Jt="Supplier Form Submitted",Qt="hsForm_c6745501-5bfc-43bf-ae9a-fd51844ddf8d",r()})),$(document).on("submit","#hsForm_61215ce7-ce82-4260-ba97-3ef8c97c83b1",(function(){var t=$(this).find('input[name="firstname"]').val(),e=$(this).find('input[name="lastname"]').val(),i=$(this).find('input[name="email"]').val(),n=$(this).find('input[name="demand_purchase_quantity"]').val(),o=$(this).find('input[name="recent_user_intention"]').val(),s=$(this).find('input[name="recent_conversion_type"]').val();Kt={invest_form_name:t+" "+e,invest_form_email:i,invest_form_type:"Purchase certified carbon credits",invest_form_looking_to:"",invest_form_purchase_quantity:n,invest_form_user_intention:o,invest_form_conversion_type:s},Jt="General Inquiries Form Submitted",Qt="hsForm_61215ce7-ce82-4260-ba97-3ef8c97c83b1",r()})),$(document).on("submit","#hsForm_80acf45b-3800-4772-84cf-f40357987b58",(function(){var t=$(this).find('input[name="firstname"]').val(),e=$(this).find('input[name="lastname"]').val(),i=$(this).find('input[name="email"]').val(),n=$(this).find('input[name="originals_when_do_you_need_credits"]').val(),o=$(this).find('input[name="demand_purchase_quantity"]').val(),s=$(this).find('input[name="recent_user_intention"]').val(),a=$(this).find('input[name="recent_conversion_type"]').val();Qt="hsForm_80acf45b-3800-4772-84cf-f40357987b58",Kt={invest_form_name:t+" "+e,invest_form_email:i,invest_form_type:"Start a forest carbon project",invest_form_looking_to:n,invest_form_purchase_quantity:o,invest_form_user_intention:s,invest_form_conversion_type:a},Jt="Project Investing Form Submitted",r()})),$(document).on("submit",".hbspt-form",(function(){var t=$(this).find('input[name="recent_conversion_type"]').val();if("Download"===t){var e=$(this).find('input[name="email"]').val(),i=$(this).find('input[name="mixpanel_download_filename"]').val(),r=$(this).find('input[name="recent_user_intention"]').val();Kt={work_email:e,file_name:i,user_intention:r,conversion_type:t},Jt="Marketing Site File Downloaded"}})),$(document).on("submit","#hsForm_56d264bf-9bcb-4b41-8b5a-b0a847307ff6",(function(){var t=$(this).find('input[name="email"]').val();Qt="hsForm_56d264bf-9bcb-4b41-8b5a-b0a847307ff6",Kt={demo_email:t},Jt="Product Demo Viewed"})),$(window).on("beforeunload",(function(){(Kt&&"Marketing Site File Downloaded"===Jt||Kt&&"Product Demo Viewed"===Jt&&"hsForm_56d264bf-9bcb-4b41-8b5a-b0a847307ff6"===Qt)&&te.track(Jt,Kt)})),$(document).on("submit",".hbspt-form",(function(){Qt=$(this).find("form").attr("id");var t=$(this).find('input[name="recent_conversion_type"]').val();if("Webinar Signup"===t){console.log("webinar check success");var e=$(this).find('input[name="firstname"]').val(),i=$(this).find('input[name="lastname"]').val(),n=$(this).find('input[name="email"]').val(),o=$(this).find('input[name="company"]').val(),s=$(this).find('input[name="recent_user_intention"]').val(),a=$(this).find('input[name="webinar_name"]').val(),l=$(this).find('input[name="webinar_datetime"]').val();Kt={webinar_form_name:e+" "+i,webinar_form_email:n,webinar_form_company:o,webinar_name:a,webinar_datetime:l,webinar_form_user_intention:s,webinar_form_conversion_type:t},Jt="Webinar Signup Completed",r()}})),$(document).on("submit","#hsForm_514e9b25-5907-43be-b309-2349ad71e64e",(function(){var t={subscription_email:$(this).find('input[name="email"]').val()};te.track("Newsletter Subscribed",t)}))},ie=function(){return document.body.classList.contains("home")},re=function(){return document.body.classList.contains("technology")},ne=function(){return document.body.classList.contains("enterprise")},oe=function(){return document.body.classList.contains("about")},se=function(){return document.body.classList.contains("partner")},ae=function(){return document.body.classList.contains("blog")},le=function(){return document.body.classList.contains("blog-post")},ce=function(){return document.body.classList.contains("website-project")},ue=function(){return document.body.classList.contains("land-suitability")};function he(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function de(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var pe,fe,me,ge,_e,ye,ve,xe,be,we,Te,Ee,Se,Ae,Me,Ie={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Ce={duration:.5,overwrite:!1,delay:0},Pe=1e8,Re=2*Math.PI,Oe=Re/4,De=0,Le=Math.sqrt,ke=Math.cos,Be=Math.sin,Fe=function(t){return"string"==typeof t},ze=function(t){return"function"==typeof t},Ne=function(t){return"number"==typeof t},Ue=function(t){return void 0===t},Ge=function(t){return"object"==typeof t},je=function(t){return!1!==t},Ve=function(){return"undefined"!=typeof window},Xe=function(t){return ze(t)||Fe(t)},He="function"==typeof ArrayBuffer&&ArrayBuffer.isView||function(){},qe=Array.isArray,We=/(?:-?\.?\d|\.)+/gi,$e=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Ye=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Ze=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,Ke=/[+-]=-?[.\d]+/,Je=/[^,'"\[\]\s]+/gi,Qe=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,ti={},ei={},ii=function(t){return(ei=Ri(t,ti))&&Rn},ri=function(t,e){return console.warn("Invalid property",t,"set to",e,"Missing plugin? gsap.registerPlugin()")},ni=function(t,e){return!e&&console.warn(t)},oi=function(t,e){return t&&(ti[t]=e)&&ei&&(ei[t]=e)||ti},si=function(){return 0},ai={suppressEvents:!0,isStart:!0,kill:!1},li={suppressEvents:!0,kill:!1},ci={suppressEvents:!0},ui={},hi=[],di={},pi={},fi={},mi=30,gi=[],_i="",yi=function(t){var e,i,r=t[0];if(Ge(r)||ze(r)||(t=[t]),!(e=(r._gsap||{}).harness)){for(i=gi.length;i--&&!gi[i].targetTest(r););e=gi[i]}for(i=t.length;i--;)t[i]&&(t[i]._gsap||(t[i]._gsap=new Xr(t[i],e)))||t.splice(i,1);return t},vi=function(t){return t._gsap||yi(lr(t))[0]._gsap},xi=function(t,e,i){return(i=t[e])&&ze(i)?t[e]():Ue(i)&&t.getAttribute&&t.getAttribute(e)||i},bi=function(t,e){return(t=t.split(",")).forEach(e)||t},wi=function(t){return Math.round(1e5*t)/1e5||0},Ti=function(t){return Math.round(1e7*t)/1e7||0},Ei=function(t,e){var i=e.charAt(0),r=parseFloat(e.substr(2));return t=parseFloat(t),"+"===i?t+r:"-"===i?t-r:"*"===i?t*r:t/r},Si=function(t,e){for(var i=e.length,r=0;t.indexOf(e[r])<0&&++r<i;);return r<i},Ai=function(){var t,e,i=hi.length,r=hi.slice(0);for(di={},hi.length=0,t=0;t<i;t++)(e=r[t])&&e._lazy&&(e.render(e._lazy[0],e._lazy[1],!0)._lazy=0)},Mi=function(t,e,i,r){hi.length&&!fe&&Ai(),t.render(e,i,r||fe&&e<0&&(t._initted||t._startAt)),hi.length&&!fe&&Ai()},Ii=function(t){var e=parseFloat(t);return(e||0===e)&&(t+"").match(Je).length<2?e:Fe(t)?t.trim():t},Ci=function(t){return t},Pi=function(t,e){for(var i in e)i in t||(t[i]=e[i]);return t},Ri=function(t,e){for(var i in e)t[i]=e[i];return t},Oi=function t(e,i){for(var r in i)"__proto__"!==r&&"constructor"!==r&&"prototype"!==r&&(e[r]=Ge(i[r])?t(e[r]||(e[r]={}),i[r]):i[r]);return e},Di=function(t,e){var i,r={};for(i in t)i in e||(r[i]=t[i]);return r},Li=function(t){var e,i=t.parent||ge,r=t.keyframes?(e=qe(t.keyframes),function(t,i){for(var r in i)r in t||"duration"===r&&e||"ease"===r||(t[r]=i[r])}):Pi;if(je(t.inherit))for(;i;)r(t,i.vars.defaults),i=i.parent||i._dp;return t},ki=function(t,e,i,r,n){void 0===i&&(i="_first"),void 0===r&&(r="_last");var o,s=t[r];if(n)for(o=e[n];s&&s[n]>o;)s=s._prev;return s?(e._next=s._next,s._next=e):(e._next=t[i],t[i]=e),e._next?e._next._prev=e:t[r]=e,e._prev=s,e.parent=e._dp=t,e},Bi=function(t,e,i,r){void 0===i&&(i="_first"),void 0===r&&(r="_last");var n=e._prev,o=e._next;n?n._next=o:t[i]===e&&(t[i]=o),o?o._prev=n:t[r]===e&&(t[r]=n),e._next=e._prev=e.parent=null},Fi=function(t,e){t.parent&&(!e||t.parent.autoRemoveChildren)&&t.parent.remove&&t.parent.remove(t),t._act=0},zi=function(t,e){if(t&&(!e||e._end>t._dur||e._start<0))for(var i=t;i;)i._dirty=1,i=i.parent;return t},Ni=function(t){for(var e=t.parent;e&&e.parent;)e._dirty=1,e.totalDuration(),e=e.parent;return t},Ui=function(t,e,i,r){return t._startAt&&(fe?t._startAt.revert(li):t.vars.immediateRender&&!t.vars.autoRevert||t._startAt.render(e,!0,r))},Gi=function(t){return t._repeat?ji(t._tTime,t=t.duration()+t._rDelay)*t:0},ji=function(t,e){var i=Math.floor(t/=e);return t&&i===t?i-1:i},Vi=function(t,e){return(t-e._start)*e._ts+(e._ts>=0?0:e._dirty?e.totalDuration():e._tDur)},Xi=function(t){return t._end=Ti(t._start+(t._tDur/Math.abs(t._ts||t._rts||1e-8)||0))},Hi=function(t,e){var i=t._dp;return i&&i.smoothChildTiming&&t._ts&&(t._start=Ti(i._time-(t._ts>0?e/t._ts:((t._dirty?t.totalDuration():t._tDur)-e)/-t._ts)),Xi(t),i._dirty||zi(i,t)),t},qi=function(t,e){var i;if((e._time||!e._dur&&e._initted||e._start<t._time&&(e._dur||!e.add))&&(i=Vi(t.rawTime(),e),(!e._dur||rr(0,e.totalDuration(),i)-e._tTime>1e-8)&&e.render(i,!0)),zi(t,e)._dp&&t._initted&&t._time>=t._dur&&t._ts){if(t._dur<t.duration())for(i=t;i._dp;)i.rawTime()>=0&&i.totalTime(i._tTime),i=i._dp;t._zTime=-1e-8}},Wi=function(t,e,i,r){return e.parent&&Fi(e),e._start=Ti((Ne(i)?i:i||t!==ge?tr(t,i,e):t._time)+e._delay),e._end=Ti(e._start+(e.totalDuration()/Math.abs(e.timeScale())||0)),ki(t,e,"_first","_last",t._sort?"_start":0),Zi(e)||(t._recent=e),r||qi(t,e),t._ts<0&&Hi(t,t._tTime),t},$i=function(t,e){return(ti.ScrollTrigger||ri("scrollTrigger",e))&&ti.ScrollTrigger.create(e,t)},Yi=function(t,e,i,r,n){return Jr(t,e,n),t._initted?!i&&t._pt&&!fe&&(t._dur&&!1!==t.vars.lazy||!t._dur&&t.vars.lazy)&&be!==Rr.frame?(hi.push(t),t._lazy=[n,r],1):void 0:1},Zi=function(t){var e=t.data;return"isFromStart"===e||"isStart"===e},Ki=function(t,e,i,r){var n=t._repeat,o=Ti(e)||0,s=t._tTime/t._tDur;return s&&!r&&(t._time*=o/t._dur),t._dur=o,t._tDur=n?n<0?1e10:Ti(o*(n+1)+t._rDelay*n):o,s>0&&!r&&Hi(t,t._tTime=t._tDur*s),t.parent&&Xi(t),i||zi(t.parent,t),t},Ji=function(t){return t instanceof qr?zi(t):Ki(t,t._dur)},Qi={_start:0,endTime:si,totalDuration:si},tr=function t(e,i,r){var n,o,s,a=e.labels,l=e._recent||Qi,c=e.duration()>=Pe?l.endTime(!1):e._dur;return Fe(i)&&(isNaN(i)||i in a)?(o=i.charAt(0),s="%"===i.substr(-1),n=i.indexOf("="),"<"===o||">"===o?(n>=0&&(i=i.replace(/=/,"")),("<"===o?l._start:l.endTime(l._repeat>=0))+(parseFloat(i.substr(1))||0)*(s?(n<0?l:r).totalDuration()/100:1)):n<0?(i in a||(a[i]=c),a[i]):(o=parseFloat(i.charAt(n-1)+i.substr(n+1)),s&&r&&(o=o/100*(qe(r)?r[0]:r).totalDuration()),n>1?t(e,i.substr(0,n-1),r)+o:c+o)):null==i?c:+i},er=function(t,e,i){var r,n,o=Ne(e[1]),s=(o?2:1)+(t<2?0:1),a=e[s];if(o&&(a.duration=e[1]),a.parent=i,t){for(r=a,n=i;n&&!("immediateRender"in r);)r=n.vars.defaults||{},n=je(n.vars.inherit)&&n.parent;a.immediateRender=je(r.immediateRender),t<2?a.runBackwards=1:a.startAt=e[s-1]}return new nn(e[0],a,e[s+1])},ir=function(t,e){return t||0===t?e(t):e},rr=function(t,e,i){return i<t?t:i>e?e:i},nr=function(t,e){return Fe(t)&&(e=Qe.exec(t))?e[1]:""},or=[].slice,sr=function(t,e){return t&&Ge(t)&&"length"in t&&(!e&&!t.length||t.length-1 in t&&Ge(t[0]))&&!t.nodeType&&t!==_e},ar=function(t,e,i){return void 0===i&&(i=[]),t.forEach((function(t){var r;return Fe(t)&&!e||sr(t,1)?(r=i).push.apply(r,lr(t)):i.push(t)}))||i},lr=function(t,e,i){return me&&!e&&me.selector?me.selector(t):!Fe(t)||i||!ye&&Or()?qe(t)?ar(t,i):sr(t)?or.call(t,0):t?[t]:[]:or.call((e||ve).querySelectorAll(t),0)},cr=function(t){return t=lr(t)[0]||ni("Invalid scope")||{},function(e){var i=t.current||t.nativeElement||t;return lr(e,i.querySelectorAll?i:i===t?ni("Invalid scope")||ve.createElement("div"):t)}},ur=function(t){return t.sort((function(){return.5-Math.random()}))},hr=function(t){if(ze(t))return t;var e=Ge(t)?t:{each:t},i=Nr(e.ease),r=e.from||0,n=parseFloat(e.base)||0,o={},s=r>0&&r<1,a=isNaN(r)||s,l=e.axis,c=r,u=r;return Fe(r)?c=u={center:.5,edges:.5,end:1}[r]||0:!s&&a&&(c=r[0],u=r[1]),function(t,s,h){var d,p,f,m,g,_,y,v,x,b=(h||e).length,w=o[b];if(!w){if(!(x="auto"===e.grid?0:(e.grid||[1,Pe])[1])){for(y=-Pe;y<(y=h[x++].getBoundingClientRect().left)&&x<b;);x<b&&x--}for(w=o[b]=[],d=a?Math.min(x,b)*c-.5:r%x,p=x===Pe?0:a?b*u/x-.5:r/x|0,y=0,v=Pe,_=0;_<b;_++)f=_%x-d,m=p-(_/x|0),w[_]=g=l?Math.abs("y"===l?m:f):Le(f*f+m*m),g>y&&(y=g),g<v&&(v=g);"random"===r&&ur(w),w.max=y-v,w.min=v,w.v=b=(parseFloat(e.amount)||parseFloat(e.each)*(x>b?b-1:l?"y"===l?b/x:x:Math.max(x,b/x))||0)*("edges"===r?-1:1),w.b=b<0?n-b:n,w.u=nr(e.amount||e.each)||0,i=i&&b<0?Fr(i):i}return b=(w[t]-w.min)/w.max||0,Ti(w.b+(i?i(b):b)*w.v)+w.u}},dr=function(t){var e=Math.pow(10,((t+"").split(".")[1]||"").length);return function(i){var r=Ti(Math.round(parseFloat(i)/t)*t*e);return(r-r%1)/e+(Ne(i)?0:nr(i))}},pr=function(t,e){var i,r,n=qe(t);return!n&&Ge(t)&&(i=n=t.radius||Pe,t.values?(t=lr(t.values),(r=!Ne(t[0]))&&(i*=i)):t=dr(t.increment)),ir(e,n?ze(t)?function(e){return r=t(e),Math.abs(r-e)<=i?r:e}:function(e){for(var n,o,s=parseFloat(r?e.x:e),a=parseFloat(r?e.y:0),l=Pe,c=0,u=t.length;u--;)(n=r?(n=t[u].x-s)*n+(o=t[u].y-a)*o:Math.abs(t[u]-s))<l&&(l=n,c=u);return c=!i||l<=i?t[c]:e,r||c===e||Ne(e)?c:c+nr(e)}:dr(t))},fr=function(t,e,i,r){return ir(qe(t)?!e:!0===i?!!(i=0):!r,(function(){return qe(t)?t[~~(Math.random()*t.length)]:(i=i||1e-5)&&(r=i<1?Math.pow(10,(i+"").length-2):1)&&Math.floor(Math.round((t-i/2+Math.random()*(e-t+.99*i))/i)*i*r)/r}))},mr=function(t,e,i){return ir(i,(function(i){return t[~~e(i)]}))},gr=function(t){for(var e,i,r,n,o=0,s="";~(e=t.indexOf("random(",o));)r=t.indexOf(")",e),n="["===t.charAt(e+7),i=t.substr(e+7,r-e-7).match(n?Je:We),s+=t.substr(o,e-o)+fr(n?i:+i[0],n?0:+i[1],+i[2]||1e-5),o=r+1;return s+t.substr(o,t.length-o)},_r=function(t,e,i,r,n){var o=e-t,s=r-i;return ir(n,(function(e){return i+((e-t)/o*s||0)}))},yr=function(t,e,i){var r,n,o,s=t.labels,a=Pe;for(r in s)(n=s[r]-e)<0==!!i&&n&&a>(n=Math.abs(n))&&(o=r,a=n);return o},vr=function(t,e,i){var r,n,o,s=t.vars,a=s[e],l=me,c=t._ctx;if(a)return r=s[e+"Params"],n=s.callbackScope||t,i&&hi.length&&Ai(),c&&(me=c),o=r?a.apply(n,r):a.call(n),me=l,o},xr=function(t){return Fi(t),t.scrollTrigger&&t.scrollTrigger.kill(!!fe),t.progress()<1&&vr(t,"onInterrupt"),t},br=[],wr=function(t){if(t)if(t=!t.name&&t.default||t,Ve()||t.headless){var e=t.name,i=ze(t),r=e&&!i&&t.init?function(){this._props=[]}:t,n={init:si,render:pn,add:Zr,kill:mn,modifier:fn,rawVars:0},o={targetTest:0,get:0,getSetter:cn,aliases:{},register:0};if(Or(),t!==r){if(pi[e])return;Pi(r,Pi(Di(t,n),o)),Ri(r.prototype,Ri(n,Di(t,o))),pi[r.prop=e]=r,t.targetTest&&(gi.push(r),ui[e]=1),e=("css"===e?"CSS":e.charAt(0).toUpperCase()+e.substr(1))+"Plugin"}oi(e,r),t.register&&t.register(Rn,r,yn)}else br.push(t)},Tr={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},Er=function(t,e,i){return 255*(6*(t+=t<0?1:t>1?-1:0)<1?e+(i-e)*t*6:t<.5?i:3*t<2?e+(i-e)*(2/3-t)*6:e)+.5|0},Sr=function(t,e,i){var r,n,o,s,a,l,c,u,h,d,p=t?Ne(t)?[t>>16,t>>8&255,255&t]:0:Tr.black;if(!p){if(","===t.substr(-1)&&(t=t.substr(0,t.length-1)),Tr[t])p=Tr[t];else if("#"===t.charAt(0)){if(t.length<6&&(r=t.charAt(1),n=t.charAt(2),o=t.charAt(3),t="#"+r+r+n+n+o+o+(5===t.length?t.charAt(4)+t.charAt(4):"")),9===t.length)return[(p=parseInt(t.substr(1,6),16))>>16,p>>8&255,255&p,parseInt(t.substr(7),16)/255];p=[(t=parseInt(t.substr(1),16))>>16,t>>8&255,255&t]}else if("hsl"===t.substr(0,3))if(p=d=t.match(We),e){if(~t.indexOf("="))return p=t.match($e),i&&p.length<4&&(p[3]=1),p}else s=+p[0]%360/360,a=+p[1]/100,r=2*(l=+p[2]/100)-(n=l<=.5?l*(a+1):l+a-l*a),p.length>3&&(p[3]*=1),p[0]=Er(s+1/3,r,n),p[1]=Er(s,r,n),p[2]=Er(s-1/3,r,n);else p=t.match(We)||Tr.transparent;p=p.map(Number)}return e&&!d&&(r=p[0]/255,n=p[1]/255,o=p[2]/255,l=((c=Math.max(r,n,o))+(u=Math.min(r,n,o)))/2,c===u?s=a=0:(h=c-u,a=l>.5?h/(2-c-u):h/(c+u),s=c===r?(n-o)/h+(n<o?6:0):c===n?(o-r)/h+2:(r-n)/h+4,s*=60),p[0]=~~(s+.5),p[1]=~~(100*a+.5),p[2]=~~(100*l+.5)),i&&p.length<4&&(p[3]=1),p},Ar=function(t){var e=[],i=[],r=-1;return t.split(Ir).forEach((function(t){var n=t.match(Ye)||[];e.push.apply(e,n),i.push(r+=n.length+1)})),e.c=i,e},Mr=function(t,e,i){var r,n,o,s,a="",l=(t+a).match(Ir),c=e?"hsla(":"rgba(",u=0;if(!l)return t;if(l=l.map((function(t){return(t=Sr(t,e,1))&&c+(e?t[0]+","+t[1]+"%,"+t[2]+"%,"+t[3]:t.join(","))+")"})),i&&(o=Ar(t),(r=i.c).join(a)!==o.c.join(a)))for(s=(n=t.replace(Ir,"1").split(Ye)).length-1;u<s;u++)a+=n[u]+(~r.indexOf(u)?l.shift()||c+"0,0,0,0)":(o.length?o:l.length?l:i).shift());if(!n)for(s=(n=t.split(Ir)).length-1;u<s;u++)a+=n[u]+l[u];return a+n[s]},Ir=function(){var t,e="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(t in Tr)e+="|"+t+"\\b";return new RegExp(e+")","gi")}(),Cr=/hsl[a]?\(/,Pr=function(t){var e,i=t.join(" ");if(Ir.lastIndex=0,Ir.test(i))return e=Cr.test(i),t[1]=Mr(t[1],e),t[0]=Mr(t[0],e,Ar(t[1])),!0},Rr=function(){var t,e,i,r,n,o,s=Date.now,a=500,l=33,c=s(),u=c,h=1e3/240,d=h,p=[],f=function i(f){var m,g,_,y,v=s()-u,x=!0===f;if((v>a||v<0)&&(c+=v-l),((m=(_=(u+=v)-c)-d)>0||x)&&(y=++r.frame,n=_-1e3*r.time,r.time=_/=1e3,d+=m+(m>=h?4:h-m),g=1),x||(t=e(i)),g)for(o=0;o<p.length;o++)p[o](_,n,y,f)};return r={time:0,frame:0,tick:function(){f(!0)},deltaRatio:function(t){return n/(1e3/(t||60))},wake:function(){xe&&(!ye&&Ve()&&(_e=ye=window,ve=_e.document||{},ti.gsap=Rn,(_e.gsapVersions||(_e.gsapVersions=[])).push(Rn.version),ii(ei||_e.GreenSockGlobals||!_e.gsap&&_e||{}),br.forEach(wr)),i="undefined"!=typeof requestAnimationFrame&&requestAnimationFrame,t&&r.sleep(),e=i||function(t){return setTimeout(t,d-1e3*r.time+1|0)},Te=1,f(2))},sleep:function(){(i?cancelAnimationFrame:clearTimeout)(t),Te=0,e=si},lagSmoothing:function(t,e){a=t||1/0,l=Math.min(e||33,a)},fps:function(t){h=1e3/(t||240),d=1e3*r.time+h},add:function(t,e,i){var n=e?function(e,i,o,s){t(e,i,o,s),r.remove(n)}:t;return r.remove(t),p[i?"unshift":"push"](n),Or(),n},remove:function(t,e){~(e=p.indexOf(t))&&p.splice(e,1)&&o>=e&&o--},_listeners:p}}(),Or=function(){return!Te&&Rr.wake()},Dr={},Lr=/^[\d.\-M][\d.\-,\s]/,kr=/["']/g,Br=function(t){for(var e,i,r,n={},o=t.substr(1,t.length-3).split(":"),s=o[0],a=1,l=o.length;a<l;a++)i=o[a],e=a!==l-1?i.lastIndexOf(","):i.length,r=i.substr(0,e),n[s]=isNaN(r)?r.replace(kr,"").trim():+r,s=i.substr(e+1).trim();return n},Fr=function(t){return function(e){return 1-t(1-e)}},zr=function t(e,i){for(var r,n=e._first;n;)n instanceof qr?t(n,i):!n.vars.yoyoEase||n._yoyo&&n._repeat||n._yoyo===i||(n.timeline?t(n.timeline,i):(r=n._ease,n._ease=n._yEase,n._yEase=r,n._yoyo=i)),n=n._next},Nr=function(t,e){return t&&(ze(t)?t:Dr[t]||function(t){var e,i,r,n,o=(t+"").split("("),s=Dr[o[0]];return s&&o.length>1&&s.config?s.config.apply(null,~t.indexOf("{")?[Br(o[1])]:(e=t,i=e.indexOf("(")+1,r=e.indexOf(")"),n=e.indexOf("(",i),e.substring(i,~n&&n<r?e.indexOf(")",r+1):r)).split(",").map(Ii)):Dr._CE&&Lr.test(t)?Dr._CE("",t):s}(t))||e},Ur=function(t,e,i,r){void 0===i&&(i=function(t){return 1-e(1-t)}),void 0===r&&(r=function(t){return t<.5?e(2*t)/2:1-e(2*(1-t))/2});var n,o={easeIn:e,easeOut:i,easeInOut:r};return bi(t,(function(t){for(var e in Dr[t]=ti[t]=o,Dr[n=t.toLowerCase()]=i,o)Dr[n+("easeIn"===e?".in":"easeOut"===e?".out":".inOut")]=Dr[t+"."+e]=o[e]})),o},Gr=function(t){return function(e){return e<.5?(1-t(1-2*e))/2:.5+t(2*(e-.5))/2}},jr=function t(e,i,r){var n=i>=1?i:1,o=(r||(e?.3:.45))/(i<1?i:1),s=o/Re*(Math.asin(1/n)||0),a=function(t){return 1===t?1:n*Math.pow(2,-10*t)*Be((t-s)*o)+1},l="out"===e?a:"in"===e?function(t){return 1-a(1-t)}:Gr(a);return o=Re/o,l.config=function(i,r){return t(e,i,r)},l},Vr=function t(e,i){void 0===i&&(i=1.70158);var r=function(t){return t?--t*t*((i+1)*t+i)+1:0},n="out"===e?r:"in"===e?function(t){return 1-r(1-t)}:Gr(r);return n.config=function(i){return t(e,i)},n};bi("Linear,Quad,Cubic,Quart,Quint,Strong",(function(t,e){var i=e<5?e+1:e;Ur(t+",Power"+(i-1),e?function(t){return Math.pow(t,i)}:function(t){return t},(function(t){return 1-Math.pow(1-t,i)}),(function(t){return t<.5?Math.pow(2*t,i)/2:1-Math.pow(2*(1-t),i)/2}))})),Dr.Linear.easeNone=Dr.none=Dr.Linear.easeIn,Ur("Elastic",jr("in"),jr("out"),jr()),Ee=7.5625,Ae=1/(Se=2.75),Ur("Bounce",(function(t){return 1-Me(1-t)}),Me=function(t){return t<Ae?Ee*t*t:t<.7272727272727273?Ee*Math.pow(t-1.5/Se,2)+.75:t<.9090909090909092?Ee*(t-=2.25/Se)*t+.9375:Ee*Math.pow(t-2.625/Se,2)+.984375}),Ur("Expo",(function(t){return t?Math.pow(2,10*(t-1)):0})),Ur("Circ",(function(t){return-(Le(1-t*t)-1)})),Ur("Sine",(function(t){return 1===t?1:1-ke(t*Oe)})),Ur("Back",Vr("in"),Vr("out"),Vr()),Dr.SteppedEase=Dr.steps=ti.SteppedEase={config:function(t,e){void 0===t&&(t=1);var i=1/t,r=t+(e?0:1),n=e?1:0;return function(t){return((r*rr(0,1-1e-8,t)|0)+n)*i}}},Ce.ease=Dr["quad.out"],bi("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",(function(t){return _i+=t+","+t+"Params,"}));var Xr=function(t,e){this.id=De++,t._gsap=this,this.target=t,this.harness=e,this.get=e?e.get:xi,this.set=e?e.getSetter:cn},Hr=function(){function t(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,Ki(this,+t.duration,1,1),this.data=t.data,me&&(this._ctx=me,me.data.push(this)),Te||Rr.wake()}var e=t.prototype;return e.delay=function(t){return t||0===t?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+t-this._delay),this._delay=t,this):this._delay},e.duration=function(t){return arguments.length?this.totalDuration(this._repeat>0?t+(t+this._rDelay)*this._repeat:t):this.totalDuration()&&this._dur},e.totalDuration=function(t){return arguments.length?(this._dirty=0,Ki(this,this._repeat<0?t:(t-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(t,e){if(Or(),!arguments.length)return this._tTime;var i=this._dp;if(i&&i.smoothChildTiming&&this._ts){for(Hi(this,t),!i._dp||i.parent||qi(i,this);i&&i.parent;)i.parent._time!==i._start+(i._ts>=0?i._tTime/i._ts:(i.totalDuration()-i._tTime)/-i._ts)&&i.totalTime(i._tTime,!0),i=i.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&t<this._tDur||this._ts<0&&t>0||!this._tDur&&!t)&&Wi(this._dp,this,this._start-this._delay)}return(this._tTime!==t||!this._dur&&!e||this._initted&&1e-8===Math.abs(this._zTime)||!t&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=t),Mi(this,t,e)),this},e.time=function(t,e){return arguments.length?this.totalTime(Math.min(this.totalDuration(),t+Gi(this))%(this._dur+this._rDelay)||(t?this._dur:0),e):this._time},e.totalProgress=function(t,e){return arguments.length?this.totalTime(this.totalDuration()*t,e):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>0?1:0},e.progress=function(t,e){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?t:1-t)+Gi(this),e):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(t,e){var i=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(t-1)*i,e):this._repeat?ji(this._tTime,i)+1:1},e.timeScale=function(t,e){if(!arguments.length)return-1e-8===this._rts?0:this._rts;if(this._rts===t)return this;var i=this.parent&&this._ts?Vi(this.parent._time,this):this._tTime;return this._rts=+t||0,this._ts=this._ps||-1e-8===t?0:this._rts,this.totalTime(rr(-Math.abs(this._delay),this._tDur,i),!1!==e),Xi(this),Ni(this)},e.paused=function(t){return arguments.length?(this._ps!==t&&(this._ps=t,t?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Or(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&1e-8!==Math.abs(this._zTime)&&(this._tTime-=1e-8)))),this):this._ps},e.startTime=function(t){if(arguments.length){this._start=t;var e=this.parent||this._dp;return e&&(e._sort||!this.parent)&&Wi(e,this,t-this._delay),this}return this._start},e.endTime=function(t){return this._start+(je(t)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(t){var e=this.parent||this._dp;return e?t&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Vi(e.rawTime(t),this):this._tTime:this._tTime},e.revert=function(t){void 0===t&&(t=ci);var e=fe;return fe=t,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(t),this.totalTime(-.01,t.suppressEvents)),"nested"!==this.data&&!1!==t.kill&&this.kill(),fe=e,this},e.globalTime=function(t){for(var e=this,i=arguments.length?t:e.rawTime();e;)i=e._start+i/(Math.abs(e._ts)||1),e=e._dp;return!this.parent&&this._sat?this._sat.globalTime(t):i},e.repeat=function(t){return arguments.length?(this._repeat=t===1/0?-2:t,Ji(this)):-2===this._repeat?1/0:this._repeat},e.repeatDelay=function(t){if(arguments.length){var e=this._time;return this._rDelay=t,Ji(this),e?this.time(e):this}return this._rDelay},e.yoyo=function(t){return arguments.length?(this._yoyo=t,this):this._yoyo},e.seek=function(t,e){return this.totalTime(tr(this,t),je(e))},e.restart=function(t,e){return this.play().totalTime(t?-this._delay:0,je(e))},e.play=function(t,e){return null!=t&&this.seek(t,e),this.reversed(!1).paused(!1)},e.reverse=function(t,e){return null!=t&&this.seek(t||this.totalDuration(),e),this.reversed(!0).paused(!1)},e.pause=function(t,e){return null!=t&&this.seek(t,e),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(t){return arguments.length?(!!t!==this.reversed()&&this.timeScale(-this._rts||(t?-1e-8:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},e.isActive=function(){var t,e=this.parent||this._dp,i=this._start;return!(e&&!(this._ts&&this._initted&&e.isActive()&&(t=e.rawTime(!0))>=i&&t<this.endTime(!0)-1e-8))},e.eventCallback=function(t,e,i){var r=this.vars;return arguments.length>1?(e?(r[t]=e,i&&(r[t+"Params"]=i),"onUpdate"===t&&(this._onUpdate=e)):delete r[t],this):r[t]},e.then=function(t){var e=this;return new Promise((function(i){var r=ze(t)?t:Ci,n=function(){var t=e.then;e.then=null,ze(r)&&(r=r(e))&&(r.then||r===e)&&(e.then=t),i(r),e.then=t};e._initted&&1===e.totalProgress()&&e._ts>=0||!e._tTime&&e._ts<0?n():e._prom=n}))},e.kill=function(){xr(this)},t}();Pi(Hr.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var qr=function(t){function e(e,i){var r;return void 0===e&&(e={}),(r=t.call(this,e)||this).labels={},r.smoothChildTiming=!!e.smoothChildTiming,r.autoRemoveChildren=!!e.autoRemoveChildren,r._sort=je(e.sortChildren),ge&&Wi(e.parent||ge,he(r),i),e.reversed&&r.reverse(),e.paused&&r.paused(!0),e.scrollTrigger&&$i(he(r),e.scrollTrigger),r}de(e,t);var i=e.prototype;return i.to=function(t,e,i){return er(0,arguments,this),this},i.from=function(t,e,i){return er(1,arguments,this),this},i.fromTo=function(t,e,i,r){return er(2,arguments,this),this},i.set=function(t,e,i){return e.duration=0,e.parent=this,Li(e).repeatDelay||(e.repeat=0),e.immediateRender=!!e.immediateRender,new nn(t,e,tr(this,i),1),this},i.call=function(t,e,i){return Wi(this,nn.delayedCall(0,t,e),i)},i.staggerTo=function(t,e,i,r,n,o,s){return i.duration=e,i.stagger=i.stagger||r,i.onComplete=o,i.onCompleteParams=s,i.parent=this,new nn(t,i,tr(this,n)),this},i.staggerFrom=function(t,e,i,r,n,o,s){return i.runBackwards=1,Li(i).immediateRender=je(i.immediateRender),this.staggerTo(t,e,i,r,n,o,s)},i.staggerFromTo=function(t,e,i,r,n,o,s,a){return r.startAt=i,Li(r).immediateRender=je(r.immediateRender),this.staggerTo(t,e,r,n,o,s,a)},i.render=function(t,e,i){var r,n,o,s,a,l,c,u,h,d,p,f,m=this._time,g=this._dirty?this.totalDuration():this._tDur,_=this._dur,y=t<=0?0:Ti(t),v=this._zTime<0!=t<0&&(this._initted||!_);if(this!==ge&&y>g&&t>=0&&(y=g),y!==this._tTime||i||v){if(m!==this._time&&_&&(y+=this._time-m,t+=this._time-m),r=y,h=this._start,l=!(u=this._ts),v&&(_||(m=this._zTime),(t||!e)&&(this._zTime=t)),this._repeat){if(p=this._yoyo,a=_+this._rDelay,this._repeat<-1&&t<0)return this.totalTime(100*a+t,e,i);if(r=Ti(y%a),y===g?(s=this._repeat,r=_):((s=~~(y/a))&&s===y/a&&(r=_,s--),r>_&&(r=_)),d=ji(this._tTime,a),!m&&this._tTime&&d!==s&&this._tTime-d*a-this._dur<=0&&(d=s),p&&1&s&&(r=_-r,f=1),s!==d&&!this._lock){var x=p&&1&d,b=x===(p&&1&s);if(s<d&&(x=!x),m=x?0:y%_?_:y,this._lock=1,this.render(m||(f?0:Ti(s*a)),e,!_)._lock=0,this._tTime=y,!e&&this.parent&&vr(this,"onRepeat"),this.vars.repeatRefresh&&!f&&(this.invalidate()._lock=1),m&&m!==this._time||l!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(_=this._dur,g=this._tDur,b&&(this._lock=2,m=x?_:-1e-4,this.render(m,!0),this.vars.repeatRefresh&&!f&&this.invalidate()),this._lock=0,!this._ts&&!l)return this;zr(this,f)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(c=function(t,e,i){var r;if(i>e)for(r=t._first;r&&r._start<=i;){if("isPause"===r.data&&r._start>e)return r;r=r._next}else for(r=t._last;r&&r._start>=i;){if("isPause"===r.data&&r._start<e)return r;r=r._prev}}(this,Ti(m),Ti(r)))&&(y-=r-(r=c._start)),this._tTime=y,this._time=r,this._act=!u,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=t,m=0),!m&&r&&!e&&!s&&(vr(this,"onStart"),this._tTime!==y))return this;if(r>=m&&t>=0)for(n=this._first;n;){if(o=n._next,(n._act||r>=n._start)&&n._ts&&c!==n){if(n.parent!==this)return this.render(t,e,i);if(n.render(n._ts>0?(r-n._start)*n._ts:(n._dirty?n.totalDuration():n._tDur)+(r-n._start)*n._ts,e,i),r!==this._time||!this._ts&&!l){c=0,o&&(y+=this._zTime=-1e-8);break}}n=o}else{n=this._last;for(var w=t<0?t:r;n;){if(o=n._prev,(n._act||w<=n._end)&&n._ts&&c!==n){if(n.parent!==this)return this.render(t,e,i);if(n.render(n._ts>0?(w-n._start)*n._ts:(n._dirty?n.totalDuration():n._tDur)+(w-n._start)*n._ts,e,i||fe&&(n._initted||n._startAt)),r!==this._time||!this._ts&&!l){c=0,o&&(y+=this._zTime=w?-1e-8:1e-8);break}}n=o}}if(c&&!e&&(this.pause(),c.render(r>=m?0:-1e-8)._zTime=r>=m?1:-1,this._ts))return this._start=h,Xi(this),this.render(t,e,i);this._onUpdate&&!e&&vr(this,"onUpdate",!0),(y===g&&this._tTime>=this.totalDuration()||!y&&m)&&(h!==this._start&&Math.abs(u)===Math.abs(this._ts)||this._lock||((t||!_)&&(y===g&&this._ts>0||!y&&this._ts<0)&&Fi(this,1),e||t<0&&!m||!y&&!m&&g||(vr(this,y===g&&t>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(y<g&&this.timeScale()>0)&&this._prom())))}return this},i.add=function(t,e){var i=this;if(Ne(e)||(e=tr(this,e,t)),!(t instanceof Hr)){if(qe(t))return t.forEach((function(t){return i.add(t,e)})),this;if(Fe(t))return this.addLabel(t,e);if(!ze(t))return this;t=nn.delayedCall(0,t)}return this!==t?Wi(this,t,e):this},i.getChildren=function(t,e,i,r){void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===i&&(i=!0),void 0===r&&(r=-Pe);for(var n=[],o=this._first;o;)o._start>=r&&(o instanceof nn?e&&n.push(o):(i&&n.push(o),t&&n.push.apply(n,o.getChildren(!0,e,i)))),o=o._next;return n},i.getById=function(t){for(var e=this.getChildren(1,1,1),i=e.length;i--;)if(e[i].vars.id===t)return e[i]},i.remove=function(t){return Fe(t)?this.removeLabel(t):ze(t)?this.killTweensOf(t):(Bi(this,t),t===this._recent&&(this._recent=this._last),zi(this))},i.totalTime=function(e,i){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Ti(Rr.time-(this._ts>0?e/this._ts:(this.totalDuration()-e)/-this._ts))),t.prototype.totalTime.call(this,e,i),this._forcing=0,this):this._tTime},i.addLabel=function(t,e){return this.labels[t]=tr(this,e),this},i.removeLabel=function(t){return delete this.labels[t],this},i.addPause=function(t,e,i){var r=nn.delayedCall(0,e||si,i);return r.data="isPause",this._hasPause=1,Wi(this,r,tr(this,t))},i.removePause=function(t){var e=this._first;for(t=tr(this,t);e;)e._start===t&&"isPause"===e.data&&Fi(e),e=e._next},i.killTweensOf=function(t,e,i){for(var r=this.getTweensOf(t,i),n=r.length;n--;)Wr!==r[n]&&r[n].kill(t,e);return this},i.getTweensOf=function(t,e){for(var i,r=[],n=lr(t),o=this._first,s=Ne(e);o;)o instanceof nn?Si(o._targets,n)&&(s?(!Wr||o._initted&&o._ts)&&o.globalTime(0)<=e&&o.globalTime(o.totalDuration())>e:!e||o.isActive())&&r.push(o):(i=o.getTweensOf(n,e)).length&&r.push.apply(r,i),o=o._next;return r},i.tweenTo=function(t,e){e=e||{};var i,r=this,n=tr(r,t),o=e,s=o.startAt,a=o.onStart,l=o.onStartParams,c=o.immediateRender,u=nn.to(r,Pi({ease:e.ease||"none",lazy:!1,immediateRender:!1,time:n,overwrite:"auto",duration:e.duration||Math.abs((n-(s&&"time"in s?s.time:r._time))/r.timeScale())||1e-8,onStart:function(){if(r.pause(),!i){var t=e.duration||Math.abs((n-(s&&"time"in s?s.time:r._time))/r.timeScale());u._dur!==t&&Ki(u,t,0,1).render(u._time,!0,!0),i=1}a&&a.apply(u,l||[])}},e));return c?u.render(0):u},i.tweenFromTo=function(t,e,i){return this.tweenTo(e,Pi({startAt:{time:tr(this,t)}},i))},i.recent=function(){return this._recent},i.nextLabel=function(t){return void 0===t&&(t=this._time),yr(this,tr(this,t))},i.previousLabel=function(t){return void 0===t&&(t=this._time),yr(this,tr(this,t),1)},i.currentLabel=function(t){return arguments.length?this.seek(t,!0):this.previousLabel(this._time+1e-8)},i.shiftChildren=function(t,e,i){void 0===i&&(i=0);for(var r,n=this._first,o=this.labels;n;)n._start>=i&&(n._start+=t,n._end+=t),n=n._next;if(e)for(r in o)o[r]>=i&&(o[r]+=t);return zi(this)},i.invalidate=function(e){var i=this._first;for(this._lock=0;i;)i.invalidate(e),i=i._next;return t.prototype.invalidate.call(this,e)},i.clear=function(t){void 0===t&&(t=!0);for(var e,i=this._first;i;)e=i._next,this.remove(i),i=e;return this._dp&&(this._time=this._tTime=this._pTime=0),t&&(this.labels={}),zi(this)},i.totalDuration=function(t){var e,i,r,n=0,o=this,s=o._last,a=Pe;if(arguments.length)return o.timeScale((o._repeat<0?o.duration():o.totalDuration())/(o.reversed()?-t:t));if(o._dirty){for(r=o.parent;s;)e=s._prev,s._dirty&&s.totalDuration(),(i=s._start)>a&&o._sort&&s._ts&&!o._lock?(o._lock=1,Wi(o,s,i-s._delay,1)._lock=0):a=i,i<0&&s._ts&&(n-=i,(!r&&!o._dp||r&&r.smoothChildTiming)&&(o._start+=i/o._ts,o._time-=i,o._tTime-=i),o.shiftChildren(-i,!1,-Infinity),a=0),s._end>n&&s._ts&&(n=s._end),s=e;Ki(o,o===ge&&o._time>n?o._time:n,1,1),o._dirty=0}return o._tDur},e.updateRoot=function(t){if(ge._ts&&(Mi(ge,Vi(t,ge)),be=Rr.frame),Rr.frame>=mi){mi+=Ie.autoSleep||120;var e=ge._first;if((!e||!e._ts)&&Ie.autoSleep&&Rr._listeners.length<2){for(;e&&!e._ts;)e=e._next;e||Rr.sleep()}}},e}(Hr);Pi(qr.prototype,{_lock:0,_hasPause:0,_forcing:0});var Wr,$r,Yr=function(t,e,i,r,n,o,s){var a,l,c,u,h,d,p,f,m=new yn(this._pt,t,e,0,1,dn,null,n),g=0,_=0;for(m.b=i,m.e=r,i+="",(p=~(r+="").indexOf("random("))&&(r=gr(r)),o&&(o(f=[i,r],t,e),i=f[0],r=f[1]),l=i.match(Ze)||[];a=Ze.exec(r);)u=a[0],h=r.substring(g,a.index),c?c=(c+1)%5:"rgba("===h.substr(-5)&&(c=1),u!==l[_++]&&(d=parseFloat(l[_-1])||0,m._pt={_next:m._pt,p:h||1===_?h:",",s:d,c:"="===u.charAt(1)?Ei(d,u)-d:parseFloat(u)-d,m:c&&c<4?Math.round:0},g=Ze.lastIndex);return m.c=g<r.length?r.substring(g,r.length):"",m.fp=s,(Ke.test(r)||p)&&(m.e=0),this._pt=m,m},Zr=function(t,e,i,r,n,o,s,a,l,c){ze(r)&&(r=r(n||0,t,o));var u,h=t[e],d="get"!==i?i:ze(h)?l?t[e.indexOf("set")||!ze(t["get"+e.substr(3)])?e:"get"+e.substr(3)](l):t[e]():h,p=ze(h)?l?an:sn:on;if(Fe(r)&&(~r.indexOf("random(")&&(r=gr(r)),"="===r.charAt(1)&&((u=Ei(d,r)+(nr(d)||0))||0===u)&&(r=u)),!c||d!==r||$r)return isNaN(d*r)||""===r?(!h&&!(e in t)&&ri(e,r),Yr.call(this,t,e,d,r,p,a||Ie.stringFilter,l)):(u=new yn(this._pt,t,e,+d||0,r-(d||0),"boolean"==typeof h?hn:un,0,p),l&&(u.fp=l),s&&u.modifier(s,this,t),this._pt=u)},Kr=function(t,e,i,r,n,o){var s,a,l,c;if(pi[t]&&!1!==(s=new pi[t]).init(n,s.rawVars?e[t]:function(t,e,i,r,n){if(ze(t)&&(t=tn(t,n,e,i,r)),!Ge(t)||t.style&&t.nodeType||qe(t)||He(t))return Fe(t)?tn(t,n,e,i,r):t;var o,s={};for(o in t)s[o]=tn(t[o],n,e,i,r);return s}(e[t],r,n,o,i),i,r,o)&&(i._pt=a=new yn(i._pt,n,t,0,1,s.render,s,0,s.priority),i!==we))for(l=i._ptLookup[i._targets.indexOf(n)],c=s._props.length;c--;)l[s._props[c]]=a;return s},Jr=function t(e,i,r){var n,o,s,a,l,c,u,h,d,p,f,m,g,_=e.vars,y=_.ease,v=_.startAt,x=_.immediateRender,b=_.lazy,w=_.onUpdate,T=_.runBackwards,E=_.yoyoEase,S=_.keyframes,A=_.autoRevert,M=e._dur,I=e._startAt,C=e._targets,P=e.parent,R=P&&"nested"===P.data?P.vars.targets:C,O="auto"===e._overwrite&&!pe,D=e.timeline;if(D&&(!S||!y)&&(y="none"),e._ease=Nr(y,Ce.ease),e._yEase=E?Fr(Nr(!0===E?y:E,Ce.ease)):0,E&&e._yoyo&&!e._repeat&&(E=e._yEase,e._yEase=e._ease,e._ease=E),e._from=!D&&!!_.runBackwards,!D||S&&!_.stagger){if(m=(h=C[0]?vi(C[0]).harness:0)&&_[h.prop],n=Di(_,ui),I&&(I._zTime<0&&I.progress(1),i<0&&T&&x&&!A?I.render(-1,!0):I.revert(T&&M?li:ai),I._lazy=0),v){if(Fi(e._startAt=nn.set(C,Pi({data:"isStart",overwrite:!1,parent:P,immediateRender:!0,lazy:!I&&je(b),startAt:null,delay:0,onUpdate:w&&function(){return vr(e,"onUpdate")},stagger:0},v))),e._startAt._dp=0,e._startAt._sat=e,i<0&&(fe||!x&&!A)&&e._startAt.revert(li),x&&M&&i<=0&&r<=0)return void(i&&(e._zTime=i))}else if(T&&M&&!I)if(i&&(x=!1),s=Pi({overwrite:!1,data:"isFromStart",lazy:x&&!I&&je(b),immediateRender:x,stagger:0,parent:P},n),m&&(s[h.prop]=m),Fi(e._startAt=nn.set(C,s)),e._startAt._dp=0,e._startAt._sat=e,i<0&&(fe?e._startAt.revert(li):e._startAt.render(-1,!0)),e._zTime=i,x){if(!i)return}else t(e._startAt,1e-8,1e-8);for(e._pt=e._ptCache=0,b=M&&je(b)||b&&!M,o=0;o<C.length;o++){if(u=(l=C[o])._gsap||yi(C)[o]._gsap,e._ptLookup[o]=p={},di[u.id]&&hi.length&&Ai(),f=R===C?o:R.indexOf(l),h&&!1!==(d=new h).init(l,m||n,e,f,R)&&(e._pt=a=new yn(e._pt,l,d.name,0,1,d.render,d,0,d.priority),d._props.forEach((function(t){p[t]=a})),d.priority&&(c=1)),!h||m)for(s in n)pi[s]&&(d=Kr(s,n,e,f,l,R))?d.priority&&(c=1):p[s]=a=Zr.call(e,l,s,"get",n[s],f,R,0,_.stringFilter);e._op&&e._op[o]&&e.kill(l,e._op[o]),O&&e._pt&&(Wr=e,ge.killTweensOf(l,p,e.globalTime(i)),g=!e.parent,Wr=0),e._pt&&b&&(di[u.id]=1)}c&&_n(e),e._onInit&&e._onInit(e)}e._onUpdate=w,e._initted=(!e._op||e._pt)&&!g,S&&i<=0&&D.render(Pe,!0,!0)},Qr=function(t,e,i,r){var n,o,s=e.ease||r||"power1.inOut";if(qe(e))o=i[t]||(i[t]=[]),e.forEach((function(t,i){return o.push({t:i/(e.length-1)*100,v:t,e:s})}));else for(n in e)o=i[n]||(i[n]=[]),"ease"===n||o.push({t:parseFloat(t),v:e[n],e:s})},tn=function(t,e,i,r,n){return ze(t)?t.call(e,i,r,n):Fe(t)&&~t.indexOf("random(")?gr(t):t},en=_i+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",rn={};bi(en+",id,stagger,delay,duration,paused,scrollTrigger",(function(t){return rn[t]=1}));var nn=function(t){function e(e,i,r,n){var o;"number"==typeof i&&(r.duration=i,i=r,r=null);var s,a,l,c,u,h,d,p,f=(o=t.call(this,n?i:Li(i))||this).vars,m=f.duration,g=f.delay,_=f.immediateRender,y=f.stagger,v=f.overwrite,x=f.keyframes,b=f.defaults,w=f.scrollTrigger,T=f.yoyoEase,E=i.parent||ge,S=(qe(e)||He(e)?Ne(e[0]):"length"in i)?[e]:lr(e);if(o._targets=S.length?yi(S):ni("GSAP target "+e+" not found. https://gsap.com",!Ie.nullTargetWarn)||[],o._ptLookup=[],o._overwrite=v,x||y||Xe(m)||Xe(g)){if(i=o.vars,(s=o.timeline=new qr({data:"nested",defaults:b||{},targets:E&&"nested"===E.data?E.vars.targets:S})).kill(),s.parent=s._dp=he(o),s._start=0,y||Xe(m)||Xe(g)){if(c=S.length,d=y&&hr(y),Ge(y))for(u in y)~en.indexOf(u)&&(p||(p={}),p[u]=y[u]);for(a=0;a<c;a++)(l=Di(i,rn)).stagger=0,T&&(l.yoyoEase=T),p&&Ri(l,p),h=S[a],l.duration=+tn(m,he(o),a,h,S),l.delay=(+tn(g,he(o),a,h,S)||0)-o._delay,!y&&1===c&&l.delay&&(o._delay=g=l.delay,o._start+=g,l.delay=0),s.to(h,l,d?d(a,h,S):0),s._ease=Dr.none;s.duration()?m=g=0:o.timeline=0}else if(x){Li(Pi(s.vars.defaults,{ease:"none"})),s._ease=Nr(x.ease||i.ease||"none");var A,M,I,C=0;if(qe(x))x.forEach((function(t){return s.to(S,t,">")})),s.duration();else{for(u in l={},x)"ease"===u||"easeEach"===u||Qr(u,x[u],l,x.easeEach);for(u in l)for(A=l[u].sort((function(t,e){return t.t-e.t})),C=0,a=0;a<A.length;a++)(I={ease:(M=A[a]).e,duration:(M.t-(a?A[a-1].t:0))/100*m})[u]=M.v,s.to(S,I,C),C+=I.duration;s.duration()<m&&s.to({},{duration:m-s.duration()})}}m||o.duration(m=s.duration())}else o.timeline=0;return!0!==v||pe||(Wr=he(o),ge.killTweensOf(S),Wr=0),Wi(E,he(o),r),i.reversed&&o.reverse(),i.paused&&o.paused(!0),(_||!m&&!x&&o._start===Ti(E._time)&&je(_)&&function t(e){return!e||e._ts&&t(e.parent)}(he(o))&&"nested"!==E.data)&&(o._tTime=-1e-8,o.render(Math.max(0,-g)||0)),w&&$i(he(o),w),o}de(e,t);var i=e.prototype;return i.render=function(t,e,i){var r,n,o,s,a,l,c,u,h,d=this._time,p=this._tDur,f=this._dur,m=t<0,g=t>p-1e-8&&!m?p:t<1e-8?0:t;if(f){if(g!==this._tTime||!t||i||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==m){if(r=g,u=this.timeline,this._repeat){if(s=f+this._rDelay,this._repeat<-1&&m)return this.totalTime(100*s+t,e,i);if(r=Ti(g%s),g===p?(o=this._repeat,r=f):((o=~~(g/s))&&o===Ti(g/s)&&(r=f,o--),r>f&&(r=f)),(l=this._yoyo&&1&o)&&(h=this._yEase,r=f-r),a=ji(this._tTime,s),r===d&&!i&&this._initted&&o===a)return this._tTime=g,this;o!==a&&(u&&this._yEase&&zr(u,l),this.vars.repeatRefresh&&!l&&!this._lock&&this._time!==s&&this._initted&&(this._lock=i=1,this.render(Ti(s*o),!0).invalidate()._lock=0))}if(!this._initted){if(Yi(this,m?t:r,i,e,g))return this._tTime=0,this;if(!(d===this._time||i&&this.vars.repeatRefresh&&o!==a))return this;if(f!==this._dur)return this.render(t,e,i)}if(this._tTime=g,this._time=r,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=c=(h||this._ease)(r/f),this._from&&(this.ratio=c=1-c),r&&!d&&!e&&!o&&(vr(this,"onStart"),this._tTime!==g))return this;for(n=this._pt;n;)n.r(c,n.d),n=n._next;u&&u.render(t<0?t:u._dur*u._ease(r/this._dur),e,i)||this._startAt&&(this._zTime=t),this._onUpdate&&!e&&(m&&Ui(this,t,0,i),vr(this,"onUpdate")),this._repeat&&o!==a&&this.vars.onRepeat&&!e&&this.parent&&vr(this,"onRepeat"),g!==this._tDur&&g||this._tTime!==g||(m&&!this._onUpdate&&Ui(this,t,0,!0),(t||!f)&&(g===this._tDur&&this._ts>0||!g&&this._ts<0)&&Fi(this,1),e||m&&!d||!(g||d||l)||(vr(this,g===p?"onComplete":"onReverseComplete",!0),this._prom&&!(g<p&&this.timeScale()>0)&&this._prom()))}}else!function(t,e,i,r){var n,o,s,a=t.ratio,l=e<0||!e&&(!t._start&&function t(e){var i=e.parent;return i&&i._ts&&i._initted&&!i._lock&&(i.rawTime()<0||t(i))}(t)&&(t._initted||!Zi(t))||(t._ts<0||t._dp._ts<0)&&!Zi(t))?0:1,c=t._rDelay,u=0;if(c&&t._repeat&&(u=rr(0,t._tDur,e),o=ji(u,c),t._yoyo&&1&o&&(l=1-l),o!==ji(t._tTime,c)&&(a=1-l,t.vars.repeatRefresh&&t._initted&&t.invalidate())),l!==a||fe||r||1e-8===t._zTime||!e&&t._zTime){if(!t._initted&&Yi(t,e,r,i,u))return;for(s=t._zTime,t._zTime=e||(i?1e-8:0),i||(i=e&&!s),t.ratio=l,t._from&&(l=1-l),t._time=0,t._tTime=u,n=t._pt;n;)n.r(l,n.d),n=n._next;e<0&&Ui(t,e,0,!0),t._onUpdate&&!i&&vr(t,"onUpdate"),u&&t._repeat&&!i&&t.parent&&vr(t,"onRepeat"),(e>=t._tDur||e<0)&&t.ratio===l&&(l&&Fi(t,1),i||fe||(vr(t,l?"onComplete":"onReverseComplete",!0),t._prom&&t._prom()))}else t._zTime||(t._zTime=e)}(this,t,e,i);return this},i.targets=function(){return this._targets},i.invalidate=function(e){return(!e||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(e),t.prototype.invalidate.call(this,e)},i.resetTo=function(t,e,i,r,n){Te||Rr.wake(),this._ts||this.play();var o=Math.min(this._dur,(this._dp._time-this._start)*this._ts);return this._initted||Jr(this,o),function(t,e,i,r,n,o,s,a){var l,c,u,h,d=(t._pt&&t._ptCache||(t._ptCache={}))[e];if(!d)for(d=t._ptCache[e]=[],u=t._ptLookup,h=t._targets.length;h--;){if((l=u[h][e])&&l.d&&l.d._pt)for(l=l.d._pt;l&&l.p!==e&&l.fp!==e;)l=l._next;if(!l)return $r=1,t.vars[e]="+=0",Jr(t,s),$r=0,a?ni(e+" not eligible for reset"):1;d.push(l)}for(h=d.length;h--;)(l=(c=d[h])._pt||c).s=!r&&0!==r||n?l.s+(r||0)+o*l.c:r,l.c=i-l.s,c.e&&(c.e=wi(i)+nr(c.e)),c.b&&(c.b=l.s+nr(c.b))}(this,t,e,i,r,this._ease(o/this._dur),o,n)?this.resetTo(t,e,i,r,1):(Hi(this,0),this.parent||ki(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},i.kill=function(t,e){if(void 0===e&&(e="all"),!(t||e&&"all"!==e))return this._lazy=this._pt=0,this.parent?xr(this):this;if(this.timeline){var i=this.timeline.totalDuration();return this.timeline.killTweensOf(t,e,Wr&&!0!==Wr.vars.overwrite)._first||xr(this),this.parent&&i!==this.timeline.totalDuration()&&Ki(this,this._dur*this.timeline._tDur/i,0,1),this}var r,n,o,s,a,l,c,u=this._targets,h=t?lr(t):u,d=this._ptLookup,p=this._pt;if((!e||"all"===e)&&function(t,e){for(var i=t.length,r=i===e.length;r&&i--&&t[i]===e[i];);return i<0}(u,h))return"all"===e&&(this._pt=0),xr(this);for(r=this._op=this._op||[],"all"!==e&&(Fe(e)&&(a={},bi(e,(function(t){return a[t]=1})),e=a),e=function(t,e){var i,r,n,o,s=t[0]?vi(t[0]).harness:0,a=s&&s.aliases;if(!a)return e;for(r in i=Ri({},e),a)if(r in i)for(n=(o=a[r].split(",")).length;n--;)i[o[n]]=i[r];return i}(u,e)),c=u.length;c--;)if(~h.indexOf(u[c]))for(a in n=d[c],"all"===e?(r[c]=e,s=n,o={}):(o=r[c]=r[c]||{},s=e),s)(l=n&&n[a])&&("kill"in l.d&&!0!==l.d.kill(a)||Bi(this,l,"_pt"),delete n[a]),"all"!==o&&(o[a]=1);return this._initted&&!this._pt&&p&&xr(this),this},e.to=function(t,i){return new e(t,i,arguments[2])},e.from=function(t,e){return er(1,arguments)},e.delayedCall=function(t,i,r,n){return new e(i,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:t,onComplete:i,onReverseComplete:i,onCompleteParams:r,onReverseCompleteParams:r,callbackScope:n})},e.fromTo=function(t,e,i){return er(2,arguments)},e.set=function(t,i){return i.duration=0,i.repeatDelay||(i.repeat=0),new e(t,i)},e.killTweensOf=function(t,e,i){return ge.killTweensOf(t,e,i)},e}(Hr);Pi(nn.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),bi("staggerTo,staggerFrom,staggerFromTo",(function(t){nn[t]=function(){var e=new qr,i=or.call(arguments,0);return i.splice("staggerFromTo"===t?5:4,0,0),e[t].apply(e,i)}}));var on=function(t,e,i){return t[e]=i},sn=function(t,e,i){return t[e](i)},an=function(t,e,i,r){return t[e](r.fp,i)},ln=function(t,e,i){return t.setAttribute(e,i)},cn=function(t,e){return ze(t[e])?sn:Ue(t[e])&&t.setAttribute?ln:on},un=function(t,e){return e.set(e.t,e.p,Math.round(1e6*(e.s+e.c*t))/1e6,e)},hn=function(t,e){return e.set(e.t,e.p,!!(e.s+e.c*t),e)},dn=function(t,e){var i=e._pt,r="";if(!t&&e.b)r=e.b;else if(1===t&&e.e)r=e.e;else{for(;i;)r=i.p+(i.m?i.m(i.s+i.c*t):Math.round(1e4*(i.s+i.c*t))/1e4)+r,i=i._next;r+=e.c}e.set(e.t,e.p,r,e)},pn=function(t,e){for(var i=e._pt;i;)i.r(t,i.d),i=i._next},fn=function(t,e,i,r){for(var n,o=this._pt;o;)n=o._next,o.p===r&&o.modifier(t,e,i),o=n},mn=function(t){for(var e,i,r=this._pt;r;)i=r._next,r.p===t&&!r.op||r.op===t?Bi(this,r,"_pt"):r.dep||(e=1),r=i;return!e},gn=function(t,e,i,r){r.mSet(t,e,r.m.call(r.tween,i,r.mt),r)},_n=function(t){for(var e,i,r,n,o=t._pt;o;){for(e=o._next,i=r;i&&i.pr>o.pr;)i=i._next;(o._prev=i?i._prev:n)?o._prev._next=o:r=o,(o._next=i)?i._prev=o:n=o,o=e}t._pt=r},yn=function(){function t(t,e,i,r,n,o,s,a,l){this.t=e,this.s=r,this.c=n,this.p=i,this.r=o||un,this.d=s||this,this.set=a||on,this.pr=l||0,this._next=t,t&&(t._prev=this)}return t.prototype.modifier=function(t,e,i){this.mSet=this.mSet||this.set,this.set=gn,this.m=t,this.mt=i,this.tween=e},t}();bi(_i+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",(function(t){return ui[t]=1})),ti.TweenMax=ti.TweenLite=nn,ti.TimelineLite=ti.TimelineMax=qr,ge=new qr({sortChildren:!1,defaults:Ce,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),Ie.stringFilter=Pr;var vn=[],xn={},bn=[],wn=0,Tn=0,En=function(t){return(xn[t]||bn).map((function(t){return t()}))},Sn=function(){var t=Date.now(),e=[];t-wn>2&&(En("matchMediaInit"),vn.forEach((function(t){var i,r,n,o,s=t.queries,a=t.conditions;for(r in s)(i=_e.matchMedia(s[r]).matches)&&(n=1),i!==a[r]&&(a[r]=i,o=1);o&&(t.revert(),n&&e.push(t))})),En("matchMediaRevert"),e.forEach((function(t){return t.onMatch(t,(function(e){return t.add(null,e)}))})),wn=t,En("matchMedia"))},An=function(){function t(t,e){this.selector=e&&cr(e),this.data=[],this._r=[],this.isReverted=!1,this.id=Tn++,t&&this.add(t)}var e=t.prototype;return e.add=function(t,e,i){ze(t)&&(i=e,e=t,t=ze);var r=this,n=function(){var t,n=me,o=r.selector;return n&&n!==r&&n.data.push(r),i&&(r.selector=cr(i)),me=r,t=e.apply(r,arguments),ze(t)&&r._r.push(t),me=n,r.selector=o,r.isReverted=!1,t};return r.last=n,t===ze?n(r,(function(t){return r.add(null,t)})):t?r[t]=n:n},e.ignore=function(t){var e=me;me=null,t(this),me=e},e.getTweens=function(){var e=[];return this.data.forEach((function(i){return i instanceof t?e.push.apply(e,i.getTweens()):i instanceof nn&&!(i.parent&&"nested"===i.parent.data)&&e.push(i)})),e},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(t,e){var i=this;if(t?function(){for(var e,r=i.getTweens(),n=i.data.length;n--;)"isFlip"===(e=i.data[n]).data&&(e.revert(),e.getChildren(!0,!0,!1).forEach((function(t){return r.splice(r.indexOf(t),1)})));for(r.map((function(t){return{g:t._dur||t._delay||t._sat&&!t._sat.vars.immediateRender?t.globalTime(0):-1/0,t:t}})).sort((function(t,e){return e.g-t.g||-1/0})).forEach((function(e){return e.t.revert(t)})),n=i.data.length;n--;)(e=i.data[n])instanceof qr?"nested"!==e.data&&(e.scrollTrigger&&e.scrollTrigger.revert(),e.kill()):!(e instanceof nn)&&e.revert&&e.revert(t);i._r.forEach((function(e){return e(t,i)})),i.isReverted=!0}():this.data.forEach((function(t){return t.kill&&t.kill()})),this.clear(),e)for(var r=vn.length;r--;)vn[r].id===this.id&&vn.splice(r,1)},e.revert=function(t){this.kill(t||{})},t}(),Mn=function(){function t(t){this.contexts=[],this.scope=t,me&&me.data.push(this)}var e=t.prototype;return e.add=function(t,e,i){Ge(t)||(t={matches:t});var r,n,o,s=new An(0,i||this.scope),a=s.conditions={};for(n in me&&!s.selector&&(s.selector=me.selector),this.contexts.push(s),e=s.add("onMatch",e),s.queries=t,t)"all"===n?o=1:(r=_e.matchMedia(t[n]))&&(vn.indexOf(s)<0&&vn.push(s),(a[n]=r.matches)&&(o=1),r.addListener?r.addListener(Sn):r.addEventListener("change",Sn));return o&&e(s,(function(t){return s.add(null,t)})),this},e.revert=function(t){this.kill(t||{})},e.kill=function(t){this.contexts.forEach((function(e){return e.kill(t,!0)}))},t}(),In={registerPlugin:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e.forEach((function(t){return wr(t)}))},timeline:function(t){return new qr(t)},getTweensOf:function(t,e){return ge.getTweensOf(t,e)},getProperty:function(t,e,i,r){Fe(t)&&(t=lr(t)[0]);var n=vi(t||{}).get,o=i?Ci:Ii;return"native"===i&&(i=""),t?e?o((pi[e]&&pi[e].get||n)(t,e,i,r)):function(e,i,r){return o((pi[e]&&pi[e].get||n)(t,e,i,r))}:t},quickSetter:function(t,e,i){if((t=lr(t)).length>1){var r=t.map((function(t){return Rn.quickSetter(t,e,i)})),n=r.length;return function(t){for(var e=n;e--;)r[e](t)}}t=t[0]||{};var o=pi[e],s=vi(t),a=s.harness&&(s.harness.aliases||{})[e]||e,l=o?function(e){var r=new o;we._pt=0,r.init(t,i?e+i:e,we,0,[t]),r.render(1,r),we._pt&&pn(1,we)}:s.set(t,a);return o?l:function(e){return l(t,a,i?e+i:e,s,1)}},quickTo:function(t,e,i){var r,n=Rn.to(t,Ri(((r={})[e]="+=0.1",r.paused=!0,r),i||{})),o=function(t,i,r){return n.resetTo(e,t,i,r)};return o.tween=n,o},isTweening:function(t){return ge.getTweensOf(t,!0).length>0},defaults:function(t){return t&&t.ease&&(t.ease=Nr(t.ease,Ce.ease)),Oi(Ce,t||{})},config:function(t){return Oi(Ie,t||{})},registerEffect:function(t){var e=t.name,i=t.effect,r=t.plugins,n=t.defaults,o=t.extendTimeline;(r||"").split(",").forEach((function(t){return t&&!pi[t]&&!ti[t]&&ni(e+" effect requires "+t+" plugin.")})),fi[e]=function(t,e,r){return i(lr(t),Pi(e||{},n),r)},o&&(qr.prototype[e]=function(t,i,r){return this.add(fi[e](t,Ge(i)?i:(r=i)&&{},this),r)})},registerEase:function(t,e){Dr[t]=Nr(e)},parseEase:function(t,e){return arguments.length?Nr(t,e):Dr},getById:function(t){return ge.getById(t)},exportRoot:function(t,e){void 0===t&&(t={});var i,r,n=new qr(t);for(n.smoothChildTiming=je(t.smoothChildTiming),ge.remove(n),n._dp=0,n._time=n._tTime=ge._time,i=ge._first;i;)r=i._next,!e&&!i._dur&&i instanceof nn&&i.vars.onComplete===i._targets[0]||Wi(n,i,i._start-i._delay),i=r;return Wi(ge,n,0),n},context:function(t,e){return t?new An(t,e):me},matchMedia:function(t){return new Mn(t)},matchMediaRefresh:function(){return vn.forEach((function(t){var e,i,r=t.conditions;for(i in r)r[i]&&(r[i]=!1,e=1);e&&t.revert()}))||Sn()},addEventListener:function(t,e){var i=xn[t]||(xn[t]=[]);~i.indexOf(e)||i.push(e)},removeEventListener:function(t,e){var i=xn[t],r=i&&i.indexOf(e);r>=0&&i.splice(r,1)},utils:{wrap:function t(e,i,r){var n=i-e;return qe(e)?mr(e,t(0,e.length),i):ir(r,(function(t){return(n+(t-e)%n)%n+e}))},wrapYoyo:function t(e,i,r){var n=i-e,o=2*n;return qe(e)?mr(e,t(0,e.length-1),i):ir(r,(function(t){return e+((t=(o+(t-e)%o)%o||0)>n?o-t:t)}))},distribute:hr,random:fr,snap:pr,normalize:function(t,e,i){return _r(t,e,0,1,i)},getUnit:nr,clamp:function(t,e,i){return ir(i,(function(i){return rr(t,e,i)}))},splitColor:Sr,toArray:lr,selector:cr,mapRange:_r,pipe:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return function(t){return e.reduce((function(t,e){return e(t)}),t)}},unitize:function(t,e){return function(i){return t(parseFloat(i))+(e||nr(i))}},interpolate:function t(e,i,r,n){var o=isNaN(e+i)?0:function(t){return(1-t)*e+t*i};if(!o){var s,a,l,c,u,h=Fe(e),d={};if(!0===r&&(n=1)&&(r=null),h)e={p:e},i={p:i};else if(qe(e)&&!qe(i)){for(l=[],c=e.length,u=c-2,a=1;a<c;a++)l.push(t(e[a-1],e[a]));c--,o=function(t){t*=c;var e=Math.min(u,~~t);return l[e](t-e)},r=i}else n||(e=Ri(qe(e)?[]:{},e));if(!l){for(s in i)Zr.call(d,e,s,"get",i[s]);o=function(t){return pn(t,d)||(h?e.p:e)}}}return ir(r,o)},shuffle:ur},install:ii,effects:fi,ticker:Rr,updateRoot:qr.updateRoot,plugins:pi,globalTimeline:ge,core:{PropTween:yn,globals:oi,Tween:nn,Timeline:qr,Animation:Hr,getCache:vi,_removeLinkedListItem:Bi,reverting:function(){return fe},context:function(t){return t&&me&&(me.data.push(t),t._ctx=me),me},suppressOverwrites:function(t){return pe=t}}};bi("to,from,fromTo,delayedCall,set,killTweensOf",(function(t){return In[t]=nn[t]})),Rr.add(qr.updateRoot),we=In.to({},{duration:0});var Cn=function(t,e){for(var i=t._pt;i&&i.p!==e&&i.op!==e&&i.fp!==e;)i=i._next;return i},Pn=function(t,e){return{name:t,rawVars:1,init:function(t,i,r){r._onInit=function(t){var r,n;if(Fe(i)&&(r={},bi(i,(function(t){return r[t]=1})),i=r),e){for(n in r={},i)r[n]=e(i[n]);i=r}!function(t,e){var i,r,n,o=t._targets;for(i in e)for(r=o.length;r--;)(n=t._ptLookup[r][i])&&(n=n.d)&&(n._pt&&(n=Cn(n,i)),n&&n.modifier&&n.modifier(e[i],t,o[r],i))}(t,i)}}}},Rn=In.registerPlugin({name:"attr",init:function(t,e,i,r,n){var o,s,a;for(o in this.tween=i,e)a=t.getAttribute(o)||"",(s=this.add(t,"setAttribute",(a||0)+"",e[o],r,n,0,0,o)).op=o,s.b=a,this._props.push(o)},render:function(t,e){for(var i=e._pt;i;)fe?i.set(i.t,i.p,i.b,i):i.r(t,i.d),i=i._next}},{name:"endArray",init:function(t,e){for(var i=e.length;i--;)this.add(t,i,t[i]||0,e[i],0,0,0,0,0,1)}},Pn("roundProps",dr),Pn("modifiers"),Pn("snap",pr))||In;nn.version=qr.version=Rn.version="3.12.5",xe=1,Ve()&&Or();Dr.Power0,Dr.Power1,Dr.Power2,Dr.Power3,Dr.Power4,Dr.Linear,Dr.Quad,Dr.Cubic,Dr.Quart,Dr.Quint,Dr.Strong,Dr.Elastic,Dr.Back,Dr.SteppedEase,Dr.Bounce,Dr.Sine,Dr.Expo,Dr.Circ;var On,Dn,Ln,kn,Bn,Fn,zn,Nn,Un={},Gn=180/Math.PI,jn=Math.PI/180,Vn=Math.atan2,Xn=/([A-Z])/g,Hn=/(left|right|width|margin|padding|x)/i,qn=/[\s,\(]\S/,Wn={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},$n=function(t,e){return e.set(e.t,e.p,Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)},Yn=function(t,e){return e.set(e.t,e.p,1===t?e.e:Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)},Zn=function(t,e){return e.set(e.t,e.p,t?Math.round(1e4*(e.s+e.c*t))/1e4+e.u:e.b,e)},Kn=function(t,e){var i=e.s+e.c*t;e.set(e.t,e.p,~~(i+(i<0?-.5:.5))+e.u,e)},Jn=function(t,e){return e.set(e.t,e.p,t?e.e:e.b,e)},Qn=function(t,e){return e.set(e.t,e.p,1!==t?e.b:e.e,e)},to=function(t,e,i){return t.style[e]=i},eo=function(t,e,i){return t.style.setProperty(e,i)},io=function(t,e,i){return t._gsap[e]=i},ro=function(t,e,i){return t._gsap.scaleX=t._gsap.scaleY=i},no=function(t,e,i,r,n){var o=t._gsap;o.scaleX=o.scaleY=i,o.renderTransform(n,o)},oo=function(t,e,i,r,n){var o=t._gsap;o[e]=i,o.renderTransform(n,o)},so="transform",ao=so+"Origin",lo=function t(e,i){var r=this,n=this.target,o=n.style,s=n._gsap;if(e in Un&&o){if(this.tfm=this.tfm||{},"transform"===e)return Wn.transform.split(",").forEach((function(e){return t.call(r,e,i)}));if(~(e=Wn[e]||e).indexOf(",")?e.split(",").forEach((function(t){return r.tfm[t]=Mo(n,t)})):this.tfm[e]=s.x?s[e]:Mo(n,e),e===ao&&(this.tfm.zOrigin=s.zOrigin),this.props.indexOf(so)>=0)return;s.svg&&(this.svgo=n.getAttribute("data-svg-origin"),this.props.push(ao,i,"")),e=so}(o||i)&&this.props.push(e,i,o[e])},co=function(t){t.translate&&(t.removeProperty("translate"),t.removeProperty("scale"),t.removeProperty("rotate"))},uo=function(){var t,e,i=this.props,r=this.target,n=r.style,o=r._gsap;for(t=0;t<i.length;t+=3)i[t+1]?r[i[t]]=i[t+2]:i[t+2]?n[i[t]]=i[t+2]:n.removeProperty("--"===i[t].substr(0,2)?i[t]:i[t].replace(Xn,"-$1").toLowerCase());if(this.tfm){for(e in this.tfm)o[e]=this.tfm[e];o.svg&&(o.renderTransform(),r.setAttribute("data-svg-origin",this.svgo||"")),(t=zn())&&t.isStart||n[so]||(co(n),o.zOrigin&&n[ao]&&(n[ao]+=" "+o.zOrigin+"px",o.zOrigin=0,o.renderTransform()),o.uncache=1)}},ho=function(t,e){var i={target:t,props:[],revert:uo,save:lo};return t._gsap||Rn.core.getCache(t),e&&e.split(",").forEach((function(t){return i.save(t)})),i},po=function(t,e){var i=Dn.createElementNS?Dn.createElementNS((e||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),t):Dn.createElement(t);return i&&i.style?i:Dn.createElement(t)},fo=function t(e,i,r){var n=getComputedStyle(e);return n[i]||n.getPropertyValue(i.replace(Xn,"-$1").toLowerCase())||n.getPropertyValue(i)||!r&&t(e,go(i)||i,1)||""},mo="O,Moz,ms,Ms,Webkit".split(","),go=function(t,e,i){var r=(e||Bn).style,n=5;if(t in r&&!i)return t;for(t=t.charAt(0).toUpperCase()+t.substr(1);n--&&!(mo[n]+t in r););return n<0?null:(3===n?"ms":n>=0?mo[n]:"")+t},_o=function(){"undefined"!=typeof window&&window.document&&(On=window,Dn=On.document,Ln=Dn.documentElement,Bn=po("div")||{style:{}},po("div"),so=go(so),ao=so+"Origin",Bn.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",Nn=!!go("perspective"),zn=Rn.core.reverting,kn=1)},yo=function t(e){var i,r=po("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),n=this.parentNode,o=this.nextSibling,s=this.style.cssText;if(Ln.appendChild(r),r.appendChild(this),this.style.display="block",e)try{i=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=t}catch(t){}else this._gsapBBox&&(i=this._gsapBBox());return n&&(o?n.insertBefore(this,o):n.appendChild(this)),Ln.removeChild(r),this.style.cssText=s,i},vo=function(t,e){for(var i=e.length;i--;)if(t.hasAttribute(e[i]))return t.getAttribute(e[i])},xo=function(t){var e;try{e=t.getBBox()}catch(i){e=yo.call(t,!0)}return e&&(e.width||e.height)||t.getBBox===yo||(e=yo.call(t,!0)),!e||e.width||e.x||e.y?e:{x:+vo(t,["x","cx","x1"])||0,y:+vo(t,["y","cy","y1"])||0,width:0,height:0}},bo=function(t){return!(!t.getCTM||t.parentNode&&!t.ownerSVGElement||!xo(t))},wo=function(t,e){if(e){var i,r=t.style;e in Un&&e!==ao&&(e=so),r.removeProperty?("ms"!==(i=e.substr(0,2))&&"webkit"!==e.substr(0,6)||(e="-"+e),r.removeProperty("--"===i?e:e.replace(Xn,"-$1").toLowerCase())):r.removeAttribute(e)}},To=function(t,e,i,r,n,o){var s=new yn(t._pt,e,i,0,1,o?Qn:Jn);return t._pt=s,s.b=r,s.e=n,t._props.push(i),s},Eo={deg:1,rad:1,turn:1},So={grid:1,flex:1},Ao=function t(e,i,r,n){var o,s,a,l,c=parseFloat(r)||0,u=(r+"").trim().substr((c+"").length)||"px",h=Bn.style,d=Hn.test(i),p="svg"===e.tagName.toLowerCase(),f=(p?"client":"offset")+(d?"Width":"Height"),m="px"===n,g="%"===n;if(n===u||!c||Eo[n]||Eo[u])return c;if("px"!==u&&!m&&(c=t(e,i,r,"px")),l=e.getCTM&&bo(e),(g||"%"===u)&&(Un[i]||~i.indexOf("adius")))return o=l?e.getBBox()[d?"width":"height"]:e[f],wi(g?c/o*100:c/100*o);if(h[d?"width":"height"]=100+(m?u:n),s=~i.indexOf("adius")||"em"===n&&e.appendChild&&!p?e:e.parentNode,l&&(s=(e.ownerSVGElement||{}).parentNode),s&&s!==Dn&&s.appendChild||(s=Dn.body),(a=s._gsap)&&g&&a.width&&d&&a.time===Rr.time&&!a.uncache)return wi(c/a.width*100);if(!g||"height"!==i&&"width"!==i)(g||"%"===u)&&!So[fo(s,"display")]&&(h.position=fo(e,"position")),s===e&&(h.position="static"),s.appendChild(Bn),o=Bn[f],s.removeChild(Bn),h.position="absolute";else{var _=e.style[i];e.style[i]=100+n,o=e[f],_?e.style[i]=_:wo(e,i)}return d&&g&&((a=vi(s)).time=Rr.time,a.width=s[f]),wi(m?o*c/100:o&&c?100/o*c:0)},Mo=function(t,e,i,r){var n;return kn||_o(),e in Wn&&"transform"!==e&&~(e=Wn[e]).indexOf(",")&&(e=e.split(",")[0]),Un[e]&&"transform"!==e?(n=zo(t,r),n="transformOrigin"!==e?n[e]:n.svg?n.origin:No(fo(t,ao))+" "+n.zOrigin+"px"):(!(n=t.style[e])||"auto"===n||r||~(n+"").indexOf("calc("))&&(n=Ro[e]&&Ro[e](t,e,i)||fo(t,e)||xi(t,e)||("opacity"===e?1:0)),i&&!~(n+"").trim().indexOf(" ")?Ao(t,e,n,i)+i:n},Io=function(t,e,i,r){if(!i||"none"===i){var n=go(e,t,1),o=n&&fo(t,n,1);o&&o!==i?(e=n,i=o):"borderColor"===e&&(i=fo(t,"borderTopColor"))}var s,a,l,c,u,h,d,p,f,m,g,_=new yn(this._pt,t.style,e,0,1,dn),y=0,v=0;if(_.b=i,_.e=r,i+="","auto"===(r+="")&&(h=t.style[e],t.style[e]=r,r=fo(t,e)||r,h?t.style[e]=h:wo(t,e)),Pr(s=[i,r]),r=s[1],l=(i=s[0]).match(Ye)||[],(r.match(Ye)||[]).length){for(;a=Ye.exec(r);)d=a[0],f=r.substring(y,a.index),u?u=(u+1)%5:"rgba("!==f.substr(-5)&&"hsla("!==f.substr(-5)||(u=1),d!==(h=l[v++]||"")&&(c=parseFloat(h)||0,g=h.substr((c+"").length),"="===d.charAt(1)&&(d=Ei(c,d)+g),p=parseFloat(d),m=d.substr((p+"").length),y=Ye.lastIndex-m.length,m||(m=m||Ie.units[e]||g,y===r.length&&(r+=m,_.e+=m)),g!==m&&(c=Ao(t,e,h,m)||0),_._pt={_next:_._pt,p:f||1===v?f:",",s:c,c:p-c,m:u&&u<4||"zIndex"===e?Math.round:0});_.c=y<r.length?r.substring(y,r.length):""}else _.r="display"===e&&"none"===r?Qn:Jn;return Ke.test(r)&&(_.e=0),this._pt=_,_},Co={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},Po=function(t,e){if(e.tween&&e.tween._time===e.tween._dur){var i,r,n,o=e.t,s=o.style,a=e.u,l=o._gsap;if("all"===a||!0===a)s.cssText="",r=1;else for(n=(a=a.split(",")).length;--n>-1;)i=a[n],Un[i]&&(r=1,i="transformOrigin"===i?ao:so),wo(o,i);r&&(wo(o,so),l&&(l.svg&&o.removeAttribute("transform"),zo(o,1),l.uncache=1,co(s)))}},Ro={clearProps:function(t,e,i,r,n){if("isFromStart"!==n.data){var o=t._pt=new yn(t._pt,e,i,0,0,Po);return o.u=r,o.pr=-10,o.tween=n,t._props.push(i),1}}},Oo=[1,0,0,1,0,0],Do={},Lo=function(t){return"matrix(1, 0, 0, 1, 0, 0)"===t||"none"===t||!t},ko=function(t){var e=fo(t,so);return Lo(e)?Oo:e.substr(7).match($e).map(wi)},Bo=function(t,e){var i,r,n,o,s=t._gsap||vi(t),a=t.style,l=ko(t);return s.svg&&t.getAttribute("transform")?"1,0,0,1,0,0"===(l=[(n=t.transform.baseVal.consolidate().matrix).a,n.b,n.c,n.d,n.e,n.f]).join(",")?Oo:l:(l!==Oo||t.offsetParent||t===Ln||s.svg||(n=a.display,a.display="block",(i=t.parentNode)&&t.offsetParent||(o=1,r=t.nextElementSibling,Ln.appendChild(t)),l=ko(t),n?a.display=n:wo(t,"display"),o&&(r?i.insertBefore(t,r):i?i.appendChild(t):Ln.removeChild(t))),e&&l.length>6?[l[0],l[1],l[4],l[5],l[12],l[13]]:l)},Fo=function(t,e,i,r,n,o){var s,a,l,c=t._gsap,u=n||Bo(t,!0),h=c.xOrigin||0,d=c.yOrigin||0,p=c.xOffset||0,f=c.yOffset||0,m=u[0],g=u[1],_=u[2],y=u[3],v=u[4],x=u[5],b=e.split(" "),w=parseFloat(b[0])||0,T=parseFloat(b[1])||0;i?u!==Oo&&(a=m*y-g*_)&&(l=w*(-g/a)+T*(m/a)-(m*x-g*v)/a,w=w*(y/a)+T*(-_/a)+(_*x-y*v)/a,T=l):(w=(s=xo(t)).x+(~b[0].indexOf("%")?w/100*s.width:w),T=s.y+(~(b[1]||b[0]).indexOf("%")?T/100*s.height:T)),r||!1!==r&&c.smooth?(v=w-h,x=T-d,c.xOffset=p+(v*m+x*_)-v,c.yOffset=f+(v*g+x*y)-x):c.xOffset=c.yOffset=0,c.xOrigin=w,c.yOrigin=T,c.smooth=!!r,c.origin=e,c.originIsAbsolute=!!i,t.style[ao]="0px 0px",o&&(To(o,c,"xOrigin",h,w),To(o,c,"yOrigin",d,T),To(o,c,"xOffset",p,c.xOffset),To(o,c,"yOffset",f,c.yOffset)),t.setAttribute("data-svg-origin",w+" "+T)},zo=function(t,e){var i=t._gsap||new Xr(t);if("x"in i&&!e&&!i.uncache)return i;var r,n,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,x,b,w,T,E,S,A,M,I,C,P,R,O,D,L,k=t.style,B=i.scaleX<0,F=getComputedStyle(t),z=fo(t,ao)||"0";return r=n=o=l=c=u=h=d=p=0,s=a=1,i.svg=!(!t.getCTM||!bo(t)),F.translate&&("none"===F.translate&&"none"===F.scale&&"none"===F.rotate||(k[so]=("none"!==F.translate?"translate3d("+(F.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+("none"!==F.rotate?"rotate("+F.rotate+") ":"")+("none"!==F.scale?"scale("+F.scale.split(" ").join(",")+") ":"")+("none"!==F[so]?F[so]:"")),k.scale=k.rotate=k.translate="none"),g=Bo(t,i.svg),i.svg&&(i.uncache?(M=t.getBBox(),z=i.xOrigin-M.x+"px "+(i.yOrigin-M.y)+"px",A=""):A=!e&&t.getAttribute("data-svg-origin"),Fo(t,A||z,!!A||i.originIsAbsolute,!1!==i.smooth,g)),f=i.xOrigin||0,m=i.yOrigin||0,g!==Oo&&(x=g[0],b=g[1],w=g[2],T=g[3],r=E=g[4],n=S=g[5],6===g.length?(s=Math.sqrt(x*x+b*b),a=Math.sqrt(T*T+w*w),l=x||b?Vn(b,x)*Gn:0,(h=w||T?Vn(w,T)*Gn+l:0)&&(a*=Math.abs(Math.cos(h*jn))),i.svg&&(r-=f-(f*x+m*w),n-=m-(f*b+m*T))):(L=g[6],O=g[7],C=g[8],P=g[9],R=g[10],D=g[11],r=g[12],n=g[13],o=g[14],c=(_=Vn(L,R))*Gn,_&&(A=E*(y=Math.cos(-_))+C*(v=Math.sin(-_)),M=S*y+P*v,I=L*y+R*v,C=E*-v+C*y,P=S*-v+P*y,R=L*-v+R*y,D=O*-v+D*y,E=A,S=M,L=I),u=(_=Vn(-w,R))*Gn,_&&(y=Math.cos(-_),D=T*(v=Math.sin(-_))+D*y,x=A=x*y-C*v,b=M=b*y-P*v,w=I=w*y-R*v),l=(_=Vn(b,x))*Gn,_&&(A=x*(y=Math.cos(_))+b*(v=Math.sin(_)),M=E*y+S*v,b=b*y-x*v,S=S*y-E*v,x=A,E=M),c&&Math.abs(c)+Math.abs(l)>359.9&&(c=l=0,u=180-u),s=wi(Math.sqrt(x*x+b*b+w*w)),a=wi(Math.sqrt(S*S+L*L)),_=Vn(E,S),h=Math.abs(_)>2e-4?_*Gn:0,p=D?1/(D<0?-D:D):0),i.svg&&(A=t.getAttribute("transform"),i.forceCSS=t.setAttribute("transform","")||!Lo(fo(t,so)),A&&t.setAttribute("transform",A))),Math.abs(h)>90&&Math.abs(h)<270&&(B?(s*=-1,h+=l<=0?180:-180,l+=l<=0?180:-180):(a*=-1,h+=h<=0?180:-180)),e=e||i.uncache,i.x=r-((i.xPercent=r&&(!e&&i.xPercent||(Math.round(t.offsetWidth/2)===Math.round(-r)?-50:0)))?t.offsetWidth*i.xPercent/100:0)+"px",i.y=n-((i.yPercent=n&&(!e&&i.yPercent||(Math.round(t.offsetHeight/2)===Math.round(-n)?-50:0)))?t.offsetHeight*i.yPercent/100:0)+"px",i.z=o+"px",i.scaleX=wi(s),i.scaleY=wi(a),i.rotation=wi(l)+"deg",i.rotationX=wi(c)+"deg",i.rotationY=wi(u)+"deg",i.skewX=h+"deg",i.skewY=d+"deg",i.transformPerspective=p+"px",(i.zOrigin=parseFloat(z.split(" ")[2])||!e&&i.zOrigin||0)&&(k[ao]=No(z)),i.xOffset=i.yOffset=0,i.force3D=Ie.force3D,i.renderTransform=i.svg?Vo:Nn?jo:Go,i.uncache=0,i},No=function(t){return(t=t.split(" "))[0]+" "+t[1]},Uo=function(t,e,i){var r=nr(e);return wi(parseFloat(e)+parseFloat(Ao(t,"x",i+"px",r)))+r},Go=function(t,e){e.z="0px",e.rotationY=e.rotationX="0deg",e.force3D=0,jo(t,e)},jo=function(t,e){var i=e||this,r=i.xPercent,n=i.yPercent,o=i.x,s=i.y,a=i.z,l=i.rotation,c=i.rotationY,u=i.rotationX,h=i.skewX,d=i.skewY,p=i.scaleX,f=i.scaleY,m=i.transformPerspective,g=i.force3D,_=i.target,y=i.zOrigin,v="",x="auto"===g&&t&&1!==t||!0===g;if(y&&("0deg"!==u||"0deg"!==c)){var b,w=parseFloat(c)*jn,T=Math.sin(w),E=Math.cos(w);w=parseFloat(u)*jn,b=Math.cos(w),o=Uo(_,o,T*b*-y),s=Uo(_,s,-Math.sin(w)*-y),a=Uo(_,a,E*b*-y+y)}"0px"!==m&&(v+="perspective("+m+") "),(r||n)&&(v+="translate("+r+"%, "+n+"%) "),(x||"0px"!==o||"0px"!==s||"0px"!==a)&&(v+="0px"!==a||x?"translate3d("+o+", "+s+", "+a+") ":"translate("+o+", "+s+") "),"0deg"!==l&&(v+="rotate("+l+") "),"0deg"!==c&&(v+="rotateY("+c+") "),"0deg"!==u&&(v+="rotateX("+u+") "),"0deg"===h&&"0deg"===d||(v+="skew("+h+", "+d+") "),1===p&&1===f||(v+="scale("+p+", "+f+") "),_.style[so]=v||"translate(0, 0)"},Vo=function(t,e){var i,r,n,o,s,a=e||this,l=a.xPercent,c=a.yPercent,u=a.x,h=a.y,d=a.rotation,p=a.skewX,f=a.skewY,m=a.scaleX,g=a.scaleY,_=a.target,y=a.xOrigin,v=a.yOrigin,x=a.xOffset,b=a.yOffset,w=a.forceCSS,T=parseFloat(u),E=parseFloat(h);d=parseFloat(d),p=parseFloat(p),(f=parseFloat(f))&&(p+=f=parseFloat(f),d+=f),d||p?(d*=jn,p*=jn,i=Math.cos(d)*m,r=Math.sin(d)*m,n=Math.sin(d-p)*-g,o=Math.cos(d-p)*g,p&&(f*=jn,s=Math.tan(p-f),n*=s=Math.sqrt(1+s*s),o*=s,f&&(s=Math.tan(f),i*=s=Math.sqrt(1+s*s),r*=s)),i=wi(i),r=wi(r),n=wi(n),o=wi(o)):(i=m,o=g,r=n=0),(T&&!~(u+"").indexOf("px")||E&&!~(h+"").indexOf("px"))&&(T=Ao(_,"x",u,"px"),E=Ao(_,"y",h,"px")),(y||v||x||b)&&(T=wi(T+y-(y*i+v*n)+x),E=wi(E+v-(y*r+v*o)+b)),(l||c)&&(s=_.getBBox(),T=wi(T+l/100*s.width),E=wi(E+c/100*s.height)),s="matrix("+i+","+r+","+n+","+o+","+T+","+E+")",_.setAttribute("transform",s),w&&(_.style[so]=s)},Xo=function(t,e,i,r,n){var o,s,a=Fe(n),l=parseFloat(n)*(a&&~n.indexOf("rad")?Gn:1)-r,c=r+l+"deg";return a&&("short"===(o=n.split("_")[1])&&(l%=360)!==l%180&&(l+=l<0?360:-360),"cw"===o&&l<0?l=(l+36e9)%360-360*~~(l/360):"ccw"===o&&l>0&&(l=(l-36e9)%360-360*~~(l/360))),t._pt=s=new yn(t._pt,e,i,r,l,Yn),s.e=c,s.u="deg",t._props.push(i),s},Ho=function(t,e){for(var i in e)t[i]=e[i];return t},qo=function(t,e,i){var r,n,o,s,a,l,c,u=Ho({},i._gsap),h=i.style;for(n in u.svg?(o=i.getAttribute("transform"),i.setAttribute("transform",""),h[so]=e,r=zo(i,1),wo(i,so),i.setAttribute("transform",o)):(o=getComputedStyle(i)[so],h[so]=e,r=zo(i,1),h[so]=o),Un)(o=u[n])!==(s=r[n])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(n)<0&&(a=nr(o)!==(c=nr(s))?Ao(i,n,o,c):parseFloat(o),l=parseFloat(s),t._pt=new yn(t._pt,r,n,a,l-a,$n),t._pt.u=c||0,t._props.push(n));Ho(r,u)};bi("padding,margin,Width,Radius",(function(t,e){var i="Top",r="Right",n="Bottom",o="Left",s=(e<3?[i,r,n,o]:[i+o,i+r,n+r,n+o]).map((function(i){return e<2?t+i:"border"+i+t}));Ro[e>1?"border"+t:t]=function(t,e,i,r,n){var o,a;if(arguments.length<4)return o=s.map((function(e){return Mo(t,e,i)})),5===(a=o.join(" ")).split(o[0]).length?o[0]:a;o=(r+"").split(" "),a={},s.forEach((function(t,e){return a[t]=o[e]=o[e]||o[(e-1)/2|0]})),t.init(e,a,n)}}));var Wo,$o,Yo={name:"css",register:_o,targetTest:function(t){return t.style&&t.nodeType},init:function(t,e,i,r,n){var o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,x,b,w,T,E,S=this._props,A=t.style,M=i.vars.startAt;for(h in kn||_o(),this.styles=this.styles||ho(t),x=this.styles.props,this.tween=i,e)if("autoRound"!==h&&(s=e[h],!pi[h]||!Kr(h,e,i,r,t,n)))if(c=typeof s,u=Ro[h],"function"===c&&(c=typeof(s=s.call(i,r,t,n))),"string"===c&&~s.indexOf("random(")&&(s=gr(s)),u)u(this,t,h,s,i)&&(v=1);else if("--"===h.substr(0,2))o=(getComputedStyle(t).getPropertyValue(h)+"").trim(),s+="",Ir.lastIndex=0,Ir.test(o)||(d=nr(o),p=nr(s)),p?d!==p&&(o=Ao(t,h,o,p)+p):d&&(s+=d),this.add(A,"setProperty",o,s,r,n,0,0,h),S.push(h),x.push(h,0,A[h]);else if("undefined"!==c){if(M&&h in M?(o="function"==typeof M[h]?M[h].call(i,r,t,n):M[h],Fe(o)&&~o.indexOf("random(")&&(o=gr(o)),nr(o+"")||"auto"===o||(o+=Ie.units[h]||nr(Mo(t,h))||""),"="===(o+"").charAt(1)&&(o=Mo(t,h))):o=Mo(t,h),l=parseFloat(o),(f="string"===c&&"="===s.charAt(1)&&s.substr(0,2))&&(s=s.substr(2)),a=parseFloat(s),h in Wn&&("autoAlpha"===h&&(1===l&&"hidden"===Mo(t,"visibility")&&a&&(l=0),x.push("visibility",0,A.visibility),To(this,A,"visibility",l?"inherit":"hidden",a?"inherit":"hidden",!a)),"scale"!==h&&"transform"!==h&&~(h=Wn[h]).indexOf(",")&&(h=h.split(",")[0])),m=h in Un)if(this.styles.save(h),g||((_=t._gsap).renderTransform&&!e.parseTransform||zo(t,e.parseTransform),y=!1!==e.smoothOrigin&&_.smooth,(g=this._pt=new yn(this._pt,A,so,0,1,_.renderTransform,_,0,-1)).dep=1),"scale"===h)this._pt=new yn(this._pt,_,"scaleY",_.scaleY,(f?Ei(_.scaleY,f+a):a)-_.scaleY||0,$n),this._pt.u=0,S.push("scaleY",h),h+="X";else{if("transformOrigin"===h){x.push(ao,0,A[ao]),w=void 0,T=void 0,E=void 0,w=(b=s).split(" "),T=w[0],E=w[1]||"50%","top"!==T&&"bottom"!==T&&"left"!==E&&"right"!==E||(b=T,T=E,E=b),w[0]=Co[T]||T,w[1]=Co[E]||E,s=w.join(" "),_.svg?Fo(t,s,0,y,0,this):((p=parseFloat(s.split(" ")[2])||0)!==_.zOrigin&&To(this,_,"zOrigin",_.zOrigin,p),To(this,A,h,No(o),No(s)));continue}if("svgOrigin"===h){Fo(t,s,1,y,0,this);continue}if(h in Do){Xo(this,_,h,l,f?Ei(l,f+s):s);continue}if("smoothOrigin"===h){To(this,_,"smooth",_.smooth,s);continue}if("force3D"===h){_[h]=s;continue}if("transform"===h){qo(this,s,t);continue}}else h in A||(h=go(h)||h);if(m||(a||0===a)&&(l||0===l)&&!qn.test(s)&&h in A)a||(a=0),(d=(o+"").substr((l+"").length))!==(p=nr(s)||(h in Ie.units?Ie.units[h]:d))&&(l=Ao(t,h,o,p)),this._pt=new yn(this._pt,m?_:A,h,l,(f?Ei(l,f+a):a)-l,m||"px"!==p&&"zIndex"!==h||!1===e.autoRound?$n:Kn),this._pt.u=p||0,d!==p&&"%"!==p&&(this._pt.b=o,this._pt.r=Zn);else if(h in A)Io.call(this,t,h,o,f?f+s:s);else if(h in t)this.add(t,h,o||t[h],f?f+s:s,r,n);else if("parseTransform"!==h){ri(h,s);continue}m||(h in A?x.push(h,0,A[h]):x.push(h,1,o||t[h])),S.push(h)}v&&_n(this)},render:function(t,e){if(e.tween._time||!zn())for(var i=e._pt;i;)i.r(t,i.d),i=i._next;else e.styles.revert()},get:Mo,aliases:Wn,getSetter:function(t,e,i){var r=Wn[e];return r&&r.indexOf(",")<0&&(e=r),e in Un&&e!==ao&&(t._gsap.x||Mo(t,"x"))?i&&Fn===i?"scale"===e?ro:io:(Fn=i||{})&&("scale"===e?no:oo):t.style&&!Ue(t.style[e])?to:~e.indexOf("-")?eo:cn(t,e)},core:{_removeProperty:wo,_getMatrix:Bo}};Rn.utils.checkPrefix=go,Rn.core.getStyleSaver=ho,$o=bi("x,y,z,scale,scaleX,scaleY,xPercent,yPercent,"+(Wo="rotation,rotationX,rotationY,skewX,skewY")+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",(function(t){Un[t]=1})),bi(Wo,(function(t){Ie.units[t]="deg",Do[t]=1})),Wn[$o[13]]="x,y,z,scale,scaleX,scaleY,xPercent,yPercent,"+Wo,bi("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",(function(t){var e=t.split(":");Wn[e[1]]=$o[e[0]]})),bi("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",(function(t){Ie.units[t]="px"})),Rn.registerPlugin(Yo);var Zo=Rn.registerPlugin(Yo)||Rn;Zo.core.Tween;function Ko(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Jo,Qo,ts,es,is,rs,ns,os,ss,as,ls,cs,us,hs=function(){return Jo||"undefined"!=typeof window&&(Jo=window.gsap)&&Jo.registerPlugin&&Jo},ds=1,ps=[],fs=[],ms=[],gs=Date.now,_s=function(t,e){return e},ys=function(t,e){return~ms.indexOf(t)&&ms[ms.indexOf(t)+1][e]},vs=function(t){return!!~as.indexOf(t)},xs=function(t,e,i,r,n){return t.addEventListener(e,i,{passive:!1!==r,capture:!!n})},bs=function(t,e,i,r){return t.removeEventListener(e,i,!!r)},ws=function(){return ls&&ls.isPressed||fs.cache++},Ts=function(t,e){var i=function i(r){if(r||0===r){ds&&(ts.history.scrollRestoration="manual");var n=ls&&ls.isPressed;r=i.v=Math.round(r)||(ls&&ls.iOS?1:0),t(r),i.cacheID=fs.cache,n&&_s("ss",r)}else(e||fs.cache!==i.cacheID||_s("ref"))&&(i.cacheID=fs.cache,i.v=t());return i.v+i.offset};return i.offset=0,t&&i},Es={s:"scrollLeft",p:"left",p2:"Left",os:"right",os2:"Right",d:"width",d2:"Width",a:"x",sc:Ts((function(t){return arguments.length?ts.scrollTo(t,Ss.sc()):ts.pageXOffset||es.scrollLeft||is.scrollLeft||rs.scrollLeft||0}))},Ss={s:"scrollTop",p:"top",p2:"Top",os:"bottom",os2:"Bottom",d:"height",d2:"Height",a:"y",op:Es,sc:Ts((function(t){return arguments.length?ts.scrollTo(Es.sc(),t):ts.pageYOffset||es.scrollTop||is.scrollTop||rs.scrollTop||0}))},As=function(t,e){return(e&&e._ctx&&e._ctx.selector||Jo.utils.toArray)(t)[0]||("string"==typeof t&&!1!==Jo.config().nullTargetWarn?console.warn("Element not found:",t):null)},Ms=function(t,e){var i=e.s,r=e.sc;vs(t)&&(t=es.scrollingElement||is);var n=fs.indexOf(t),o=r===Ss.sc?1:2;!~n&&(n=fs.push(t)-1),fs[n+o]||xs(t,"scroll",ws);var s=fs[n+o],a=s||(fs[n+o]=Ts(ys(t,i),!0)||(vs(t)?r:Ts((function(e){return arguments.length?t[i]=e:t[i]}))));return a.target=t,s||(a.smooth="smooth"===Jo.getProperty(t,"scrollBehavior")),a},Is=function(t,e,i){var r=t,n=t,o=gs(),s=o,a=e||50,l=Math.max(500,3*a),c=function(t,e){var l=gs();e||l-o>a?(n=r,r=t,s=o,o=l):i?r+=t:r=n+(t-n)/(l-s)*(o-s)};return{update:c,reset:function(){n=r=i?0:r,s=o=0},getVelocity:function(t){var e=s,a=n,u=gs();return(t||0===t)&&t!==r&&c(t),o===s||u-s>l?0:(r+(i?a:-a))/((i?u:o)-e)*1e3}}},Cs=function(t,e){return e&&!t._gsapAllow&&t.preventDefault(),t.changedTouches?t.changedTouches[0]:t},Ps=function(t){var e=Math.max.apply(Math,t),i=Math.min.apply(Math,t);return Math.abs(e)>=Math.abs(i)?e:i},Rs=function(){var t,e,i,r;(ss=Jo.core.globals().ScrollTrigger)&&ss.core&&(t=ss.core,e=t.bridge||{},i=t._scrollers,r=t._proxies,i.push.apply(i,fs),r.push.apply(r,ms),fs=i,ms=r,_s=function(t,i){return e[t](i)})},Os=function(t){return Jo=t||hs(),!Qo&&Jo&&"undefined"!=typeof document&&document.body&&(ts=window,es=document,is=es.documentElement,rs=es.body,as=[ts,es,is,rs],Jo.utils.clamp,us=Jo.core.context||function(){},os="onpointerenter"in rs?"pointer":"mouse",ns=Ds.isTouch=ts.matchMedia&&ts.matchMedia("(hover: none), (pointer: coarse)").matches?1:"ontouchstart"in ts||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?2:0,cs=Ds.eventTypes=("ontouchstart"in is?"touchstart,touchmove,touchcancel,touchend":"onpointerdown"in is?"pointerdown,pointermove,pointercancel,pointerup":"mousedown,mousemove,mouseup,mouseup").split(","),setTimeout((function(){return ds=0}),500),Rs(),Qo=1),Qo};Es.op=Ss,fs.cache=0;var Ds=function(){function t(t){this.init(t)}var e,i,r;return t.prototype.init=function(t){Qo||Os(Jo)||console.warn("Please gsap.registerPlugin(Observer)"),ss||Rs();var e=t.tolerance,i=t.dragMinimum,r=t.type,n=t.target,o=t.lineHeight,s=t.debounce,a=t.preventDefault,l=t.onStop,c=t.onStopDelay,u=t.ignore,h=t.wheelSpeed,d=t.event,p=t.onDragStart,f=t.onDragEnd,m=t.onDrag,g=t.onPress,_=t.onRelease,y=t.onRight,v=t.onLeft,x=t.onUp,b=t.onDown,w=t.onChangeX,T=t.onChangeY,E=t.onChange,S=t.onToggleX,A=t.onToggleY,M=t.onHover,I=t.onHoverEnd,C=t.onMove,P=t.ignoreCheck,R=t.isNormalizer,O=t.onGestureStart,D=t.onGestureEnd,L=t.onWheel,k=t.onEnable,B=t.onDisable,F=t.onClick,z=t.scrollSpeed,N=t.capture,U=t.allowClicks,G=t.lockAxis,j=t.onLockAxis;this.target=n=As(n)||is,this.vars=t,u&&(u=Jo.utils.toArray(u)),e=e||1e-9,i=i||0,h=h||1,z=z||1,r=r||"wheel,touch,pointer",s=!1!==s,o||(o=parseFloat(ts.getComputedStyle(rs).lineHeight)||22);var V,X,H,q,W,$,Y,Z=this,K=0,J=0,Q=t.passive||!a,tt=Ms(n,Es),et=Ms(n,Ss),it=tt(),rt=et(),nt=~r.indexOf("touch")&&!~r.indexOf("pointer")&&"pointerdown"===cs[0],ot=vs(n),st=n.ownerDocument||es,at=[0,0,0],lt=[0,0,0],ct=0,ut=function(){return ct=gs()},ht=function(t,e){return(Z.event=t)&&u&&~u.indexOf(t.target)||e&&nt&&"touch"!==t.pointerType||P&&P(t,e)},dt=function(){var t=Z.deltaX=Ps(at),i=Z.deltaY=Ps(lt),r=Math.abs(t)>=e,n=Math.abs(i)>=e;E&&(r||n)&&E(Z,t,i,at,lt),r&&(y&&Z.deltaX>0&&y(Z),v&&Z.deltaX<0&&v(Z),w&&w(Z),S&&Z.deltaX<0!=K<0&&S(Z),K=Z.deltaX,at[0]=at[1]=at[2]=0),n&&(b&&Z.deltaY>0&&b(Z),x&&Z.deltaY<0&&x(Z),T&&T(Z),A&&Z.deltaY<0!=J<0&&A(Z),J=Z.deltaY,lt[0]=lt[1]=lt[2]=0),(q||H)&&(C&&C(Z),H&&(m(Z),H=!1),q=!1),$&&!($=!1)&&j&&j(Z),W&&(L(Z),W=!1),V=0},pt=function(t,e,i){at[i]+=t,lt[i]+=e,Z._vx.update(t),Z._vy.update(e),s?V||(V=requestAnimationFrame(dt)):dt()},ft=function(t,e){G&&!Y&&(Z.axis=Y=Math.abs(t)>Math.abs(e)?"x":"y",$=!0),"y"!==Y&&(at[2]+=t,Z._vx.update(t,!0)),"x"!==Y&&(lt[2]+=e,Z._vy.update(e,!0)),s?V||(V=requestAnimationFrame(dt)):dt()},mt=function(t){if(!ht(t,1)){var e=(t=Cs(t,a)).clientX,r=t.clientY,n=e-Z.x,o=r-Z.y,s=Z.isDragging;Z.x=e,Z.y=r,(s||Math.abs(Z.startX-e)>=i||Math.abs(Z.startY-r)>=i)&&(m&&(H=!0),s||(Z.isDragging=!0),ft(n,o),s||p&&p(Z))}},gt=Z.onPress=function(t){ht(t,1)||t&&t.button||(Z.axis=Y=null,X.pause(),Z.isPressed=!0,t=Cs(t),K=J=0,Z.startX=Z.x=t.clientX,Z.startY=Z.y=t.clientY,Z._vx.reset(),Z._vy.reset(),xs(R?n:st,cs[1],mt,Q,!0),Z.deltaX=Z.deltaY=0,g&&g(Z))},_t=Z.onRelease=function(t){if(!ht(t,1)){bs(R?n:st,cs[1],mt,!0);var e=!isNaN(Z.y-Z.startY),i=Z.isDragging,r=i&&(Math.abs(Z.x-Z.startX)>3||Math.abs(Z.y-Z.startY)>3),o=Cs(t);!r&&e&&(Z._vx.reset(),Z._vy.reset(),a&&U&&Jo.delayedCall(.08,(function(){if(gs()-ct>300&&!t.defaultPrevented)if(t.target.click)t.target.click();else if(st.createEvent){var e=st.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,ts,1,o.screenX,o.screenY,o.clientX,o.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(e)}}))),Z.isDragging=Z.isGesturing=Z.isPressed=!1,l&&i&&!R&&X.restart(!0),f&&i&&f(Z),_&&_(Z,r)}},yt=function(t){return t.touches&&t.touches.length>1&&(Z.isGesturing=!0)&&O(t,Z.isDragging)},vt=function(){return(Z.isGesturing=!1)||D(Z)},xt=function(t){if(!ht(t)){var e=tt(),i=et();pt((e-it)*z,(i-rt)*z,1),it=e,rt=i,l&&X.restart(!0)}},bt=function(t){if(!ht(t)){t=Cs(t,a),L&&(W=!0);var e=(1===t.deltaMode?o:2===t.deltaMode?ts.innerHeight:1)*h;pt(t.deltaX*e,t.deltaY*e,0),l&&!R&&X.restart(!0)}},wt=function(t){if(!ht(t)){var e=t.clientX,i=t.clientY,r=e-Z.x,n=i-Z.y;Z.x=e,Z.y=i,q=!0,l&&X.restart(!0),(r||n)&&ft(r,n)}},Tt=function(t){Z.event=t,M(Z)},Et=function(t){Z.event=t,I(Z)},St=function(t){return ht(t)||Cs(t,a)&&F(Z)};X=Z._dc=Jo.delayedCall(c||.25,(function(){Z._vx.reset(),Z._vy.reset(),X.pause(),l&&l(Z)})).pause(),Z.deltaX=Z.deltaY=0,Z._vx=Is(0,50,!0),Z._vy=Is(0,50,!0),Z.scrollX=tt,Z.scrollY=et,Z.isDragging=Z.isGesturing=Z.isPressed=!1,us(this),Z.enable=function(t){return Z.isEnabled||(xs(ot?st:n,"scroll",ws),r.indexOf("scroll")>=0&&xs(ot?st:n,"scroll",xt,Q,N),r.indexOf("wheel")>=0&&xs(n,"wheel",bt,Q,N),(r.indexOf("touch")>=0&&ns||r.indexOf("pointer")>=0)&&(xs(n,cs[0],gt,Q,N),xs(st,cs[2],_t),xs(st,cs[3],_t),U&&xs(n,"click",ut,!0,!0),F&&xs(n,"click",St),O&&xs(st,"gesturestart",yt),D&&xs(st,"gestureend",vt),M&&xs(n,os+"enter",Tt),I&&xs(n,os+"leave",Et),C&&xs(n,os+"move",wt)),Z.isEnabled=!0,t&&t.type&&gt(t),k&&k(Z)),Z},Z.disable=function(){Z.isEnabled&&(ps.filter((function(t){return t!==Z&&vs(t.target)})).length||bs(ot?st:n,"scroll",ws),Z.isPressed&&(Z._vx.reset(),Z._vy.reset(),bs(R?n:st,cs[1],mt,!0)),bs(ot?st:n,"scroll",xt,N),bs(n,"wheel",bt,N),bs(n,cs[0],gt,N),bs(st,cs[2],_t),bs(st,cs[3],_t),bs(n,"click",ut,!0),bs(n,"click",St),bs(st,"gesturestart",yt),bs(st,"gestureend",vt),bs(n,os+"enter",Tt),bs(n,os+"leave",Et),bs(n,os+"move",wt),Z.isEnabled=Z.isPressed=Z.isDragging=!1,B&&B(Z))},Z.kill=Z.revert=function(){Z.disable();var t=ps.indexOf(Z);t>=0&&ps.splice(t,1),ls===Z&&(ls=0)},ps.push(Z),R&&vs(n)&&(ls=Z),Z.enable(d)},e=t,(i=[{key:"velocityX",get:function(){return this._vx.getVelocity()}},{key:"velocityY",get:function(){return this._vy.getVelocity()}}])&&Ko(e.prototype,i),r&&Ko(e,r),t}();Ds.version="3.12.5",Ds.create=function(t){return new Ds(t)},Ds.register=Os,Ds.getAll=function(){return ps.slice()},Ds.getById=function(t){return ps.filter((function(e){return e.vars.id===t}))[0]},hs()&&Jo.registerPlugin(Ds);var Ls,ks,Bs,Fs,zs,Ns,Us,Gs,js,Vs,Xs,Hs,qs,Ws,$s,Ys,Zs,Ks,Js,Qs,ta,ea,ia,ra,na,oa,sa,aa,la,ca,ua,ha,da,pa,fa,ma,ga,_a,ya=1,va=Date.now,xa=va(),ba=0,wa=0,Ta=function(t,e,i){var r=Ba(t)&&("clamp("===t.substr(0,6)||t.indexOf("max")>-1);return i["_"+e+"Clamp"]=r,r?t.substr(6,t.length-7):t},Ea=function(t,e){return!e||Ba(t)&&"clamp("===t.substr(0,6)?t:"clamp("+t+")"},Sa=function(){return Ws=1},Aa=function(){return Ws=0},Ma=function(t){return t},Ia=function(t){return Math.round(1e5*t)/1e5||0},Ca=function(){return"undefined"!=typeof window},Pa=function(){return Ls||Ca()&&(Ls=window.gsap)&&Ls.registerPlugin&&Ls},Ra=function(t){return!!~Us.indexOf(t)},Oa=function(t){return("Height"===t?ua:Bs["inner"+t])||zs["client"+t]||Ns["client"+t]},Da=function(t){return ys(t,"getBoundingClientRect")||(Ra(t)?function(){return Ll.width=Bs.innerWidth,Ll.height=ua,Ll}:function(){return Wa(t)})},La=function(t,e){var i=e.s,r=e.d2,n=e.d,o=e.a;return Math.max(0,(i="scroll"+r)&&(o=ys(t,i))?o()-Da(t)()[n]:Ra(t)?(zs[i]||Ns[i])-Oa(r):t[i]-t["offset"+r])},ka=function(t,e){for(var i=0;i<Js.length;i+=3)(!e||~e.indexOf(Js[i+1]))&&t(Js[i],Js[i+1],Js[i+2])},Ba=function(t){return"string"==typeof t},Fa=function(t){return"function"==typeof t},za=function(t){return"number"==typeof t},Na=function(t){return"object"==typeof t},Ua=function(t,e,i){return t&&t.progress(e?0:1)&&i&&t.pause()},Ga=function(t,e){if(t.enabled){var i=t._ctx?t._ctx.add((function(){return e(t)})):e(t);i&&i.totalTime&&(t.callbackAnimation=i)}},ja=Math.abs,Va="padding",Xa="px",Ha=function(t){return Bs.getComputedStyle(t)},qa=function(t,e){for(var i in e)i in t||(t[i]=e[i]);return t},Wa=function(t,e){var i=e&&"matrix(1, 0, 0, 1, 0, 0)"!==Ha(t)[$s]&&Ls.to(t,{x:0,y:0,xPercent:0,yPercent:0,rotation:0,rotationX:0,rotationY:0,scale:1,skewX:0,skewY:0}).progress(1),r=t.getBoundingClientRect();return i&&i.progress(0).kill(),r},$a=function(t,e){var i=e.d2;return t["offset"+i]||t["client"+i]||0},Ya=function(t){var e,i=[],r=t.labels,n=t.duration();for(e in r)i.push(r[e]/n);return i},Za=function(t){var e=Ls.utils.snap(t),i=Array.isArray(t)&&t.slice(0).sort((function(t,e){return t-e}));return i?function(t,r,n){var o;if(void 0===n&&(n=.001),!r)return e(t);if(r>0){for(t-=n,o=0;o<i.length;o++)if(i[o]>=t)return i[o];return i[o-1]}for(o=i.length,t+=n;o--;)if(i[o]<=t)return i[o];return i[0]}:function(i,r,n){void 0===n&&(n=.001);var o=e(i);return!r||Math.abs(o-i)<n||o-i<0==r<0?o:e(r<0?i-t:i+t)}},Ka=function(t,e,i,r){return i.split(",").forEach((function(i){return t(e,i,r)}))},Ja=function(t,e,i,r,n){return t.addEventListener(e,i,{passive:!r,capture:!!n})},Qa=function(t,e,i,r){return t.removeEventListener(e,i,!!r)},tl=function(t,e,i){(i=i&&i.wheelHandler)&&(t(e,"wheel",i),t(e,"touchmove",i))},el={startColor:"green",endColor:"red",indent:0,fontSize:"16px",fontWeight:"normal"},il={toggleActions:"play",anticipatePin:0},rl={top:0,left:0,center:.5,bottom:1,right:1},nl=function(t,e){if(Ba(t)){var i=t.indexOf("="),r=~i?+(t.charAt(i-1)+1)*parseFloat(t.substr(i+1)):0;~i&&(t.indexOf("%")>i&&(r*=e/100),t=t.substr(0,i-1)),t=r+(t in rl?rl[t]*e:~t.indexOf("%")?parseFloat(t)*e/100:parseFloat(t)||0)}return t},ol=function(t,e,i,r,n,o,s,a){var l=n.startColor,c=n.endColor,u=n.fontSize,h=n.indent,d=n.fontWeight,p=Fs.createElement("div"),f=Ra(i)||"fixed"===ys(i,"pinType"),m=-1!==t.indexOf("scroller"),g=f?Ns:i,_=-1!==t.indexOf("start"),y=_?l:c,v="border-color:"+y+";font-size:"+u+";color:"+y+";font-weight:"+d+";pointer-events:none;white-space:nowrap;font-family:sans-serif,Arial;z-index:1000;padding:4px 8px;border-width:0;border-style:solid;";return v+="position:"+((m||a)&&f?"fixed;":"absolute;"),(m||a||!f)&&(v+=(r===Ss?"right":"bottom")+":"+(o+parseFloat(h))+"px;"),s&&(v+="box-sizing:border-box;text-align:left;width:"+s.offsetWidth+"px;"),p._isStart=_,p.setAttribute("class","gsap-marker-"+t+(e?" marker-"+e:"")),p.style.cssText=v,p.innerText=e||0===e?t+"-"+e:t,g.children[0]?g.insertBefore(p,g.children[0]):g.appendChild(p),p._offset=p["offset"+r.op.d2],sl(p,0,r,_),p},sl=function(t,e,i,r){var n={display:"block"},o=i[r?"os2":"p2"],s=i[r?"p2":"os2"];t._isFlipped=r,n[i.a+"Percent"]=r?-100:0,n[i.a]=r?"1px":0,n["border"+o+"Width"]=1,n["border"+s+"Width"]=0,n[i.p]=e+"px",Ls.set(t,n)},al=[],ll={},cl=function(){return va()-ba>34&&(fa||(fa=requestAnimationFrame(Ml)))},ul=function(){(!ia||!ia.isPressed||ia.startX>Ns.clientWidth)&&(fs.cache++,ia?fa||(fa=requestAnimationFrame(Ml)):Ml(),ba||gl("scrollStart"),ba=va())},hl=function(){oa=Bs.innerWidth,na=Bs.innerHeight},dl=function(){fs.cache++,!qs&&!ea&&!Fs.fullscreenElement&&!Fs.webkitFullscreenElement&&(!ra||oa!==Bs.innerWidth||Math.abs(Bs.innerHeight-na)>.25*Bs.innerHeight)&&Gs.restart(!0)},pl={},fl=[],ml=function t(){return Qa(Gl,"scrollEnd",t)||El(!0)},gl=function(t){return pl[t]&&pl[t].map((function(t){return t()}))||fl},_l=[],yl=function(t){for(var e=0;e<_l.length;e+=5)(!t||_l[e+4]&&_l[e+4].query===t)&&(_l[e].style.cssText=_l[e+1],_l[e].getBBox&&_l[e].setAttribute("transform",_l[e+2]||""),_l[e+3].uncache=1)},vl=function(t,e){var i;for(Ys=0;Ys<al.length;Ys++)!(i=al[Ys])||e&&i._ctx!==e||(t?i.kill(1):i.revert(!0,!0));ha=!0,e&&yl(e),e||gl("revert")},xl=function(t,e){fs.cache++,(e||!ma)&&fs.forEach((function(t){return Fa(t)&&t.cacheID++&&(t.rec=0)})),Ba(t)&&(Bs.history.scrollRestoration=la=t)},bl=0,wl=function(){Ns.appendChild(ca),ua=!ia&&ca.offsetHeight||Bs.innerHeight,Ns.removeChild(ca)},Tl=function(t){return js(".gsap-marker-start, .gsap-marker-end, .gsap-marker-scroller-start, .gsap-marker-scroller-end").forEach((function(e){return e.style.display=t?"none":"block"}))},El=function(t,e){if(!ba||t||ha){wl(),ma=Gl.isRefreshing=!0,fs.forEach((function(t){return Fa(t)&&++t.cacheID&&(t.rec=t())}));var i=gl("refreshInit");Qs&&Gl.sort(),e||vl(),fs.forEach((function(t){Fa(t)&&(t.smooth&&(t.target.style.scrollBehavior="auto"),t(0))})),al.slice(0).forEach((function(t){return t.refresh()})),ha=!1,al.forEach((function(t){if(t._subPinOffset&&t.pin){var e=t.vars.horizontal?"offsetWidth":"offsetHeight",i=t.pin[e];t.revert(!0,1),t.adjustPinSpacing(t.pin[e]-i),t.refresh()}})),da=1,Tl(!0),al.forEach((function(t){var e=La(t.scroller,t._dir),i="max"===t.vars.end||t._endClamp&&t.end>e,r=t._startClamp&&t.start>=e;(i||r)&&t.setPositions(r?e-1:t.start,i?Math.max(r?e:t.start+1,e):t.end,!0)})),Tl(!1),da=0,i.forEach((function(t){return t&&t.render&&t.render(-1)})),fs.forEach((function(t){Fa(t)&&(t.smooth&&requestAnimationFrame((function(){return t.target.style.scrollBehavior="smooth"})),t.rec&&t(t.rec))})),xl(la,1),Gs.pause(),bl++,ma=2,Ml(2),al.forEach((function(t){return Fa(t.vars.onRefresh)&&t.vars.onRefresh(t)})),ma=Gl.isRefreshing=!1,gl("refresh")}else Ja(Gl,"scrollEnd",ml)},Sl=0,Al=1,Ml=function(t){if(2===t||!ma&&!ha){Gl.isUpdating=!0,_a&&_a.update(0);var e=al.length,i=va(),r=i-xa>=50,n=e&&al[0].scroll();if(Al=Sl>n?-1:1,ma||(Sl=n),r&&(ba&&!Ws&&i-ba>200&&(ba=0,gl("scrollEnd")),Xs=xa,xa=i),Al<0){for(Ys=e;Ys-- >0;)al[Ys]&&al[Ys].update(0,r);Al=1}else for(Ys=0;Ys<e;Ys++)al[Ys]&&al[Ys].update(0,r);Gl.isUpdating=!1}fa=0},Il=["left","top","bottom","right","marginBottom","marginRight","marginTop","marginLeft","display","flexShrink","float","zIndex","gridColumnStart","gridColumnEnd","gridRowStart","gridRowEnd","gridArea","justifySelf","alignSelf","placeSelf","order"],Cl=Il.concat(["width","height","boxSizing","maxWidth","maxHeight","position","margin",Va,Va+"Top",Va+"Right",Va+"Bottom",Va+"Left"]),Pl=function(t,e,i,r){if(!t._gsap.swappedIn){for(var n,o=Il.length,s=e.style,a=t.style;o--;)s[n=Il[o]]=i[n];s.position="absolute"===i.position?"absolute":"relative","inline"===i.display&&(s.display="inline-block"),a.bottom=a.right="auto",s.flexBasis=i.flexBasis||"auto",s.overflow="visible",s.boxSizing="border-box",s.width=$a(t,Es)+Xa,s.height=$a(t,Ss)+Xa,s[Va]=a.margin=a.top=a.left="0",Ol(r),a.width=a.maxWidth=i.width,a.height=a.maxHeight=i.height,a[Va]=i[Va],t.parentNode!==e&&(t.parentNode.insertBefore(e,t),e.appendChild(t)),t._gsap.swappedIn=!0}},Rl=/([A-Z])/g,Ol=function(t){if(t){var e,i,r=t.t.style,n=t.length,o=0;for((t.t._gsap||Ls.core.getCache(t.t)).uncache=1;o<n;o+=2)i=t[o+1],e=t[o],i?r[e]=i:r[e]&&r.removeProperty(e.replace(Rl,"-$1").toLowerCase())}},Dl=function(t){for(var e=Cl.length,i=t.style,r=[],n=0;n<e;n++)r.push(Cl[n],i[Cl[n]]);return r.t=t,r},Ll={left:0,top:0},kl=function(t,e,i,r,n,o,s,a,l,c,u,h,d,p){Fa(t)&&(t=t(a)),Ba(t)&&"max"===t.substr(0,3)&&(t=h+("="===t.charAt(4)?nl("0"+t.substr(3),i):0));var f,m,g,_=d?d.time():0;if(d&&d.seek(0),isNaN(t)||(t=+t),za(t))d&&(t=Ls.utils.mapRange(d.scrollTrigger.start,d.scrollTrigger.end,0,h,t)),s&&sl(s,i,r,!0);else{Fa(e)&&(e=e(a));var y,v,x,b,w=(t||"0").split(" ");g=As(e,a)||Ns,(y=Wa(g)||{})&&(y.left||y.top)||"none"!==Ha(g).display||(b=g.style.display,g.style.display="block",y=Wa(g),b?g.style.display=b:g.style.removeProperty("display")),v=nl(w[0],y[r.d]),x=nl(w[1]||"0",i),t=y[r.p]-l[r.p]-c+v+n-x,s&&sl(s,x,r,i-x<20||s._isStart&&x>20),i-=i-x}if(p&&(a[p]=t||-.001,t<0&&(t=0)),o){var T=t+i,E=o._isStart;f="scroll"+r.d2,sl(o,T,r,E&&T>20||!E&&(u?Math.max(Ns[f],zs[f]):o.parentNode[f])<=T+1),u&&(l=Wa(s),u&&(o.style[r.op.p]=l[r.op.p]-r.op.m-o._offset+Xa))}return d&&g&&(f=Wa(g),d.seek(h),m=Wa(g),d._caScrollDist=f[r.p]-m[r.p],t=t/d._caScrollDist*h),d&&d.seek(_),d?t:Math.round(t)},Bl=/(webkit|moz|length|cssText|inset)/i,Fl=function(t,e,i,r){if(t.parentNode!==e){var n,o,s=t.style;if(e===Ns){for(n in t._stOrig=s.cssText,o=Ha(t))+n||Bl.test(n)||!o[n]||"string"!=typeof s[n]||"0"===n||(s[n]=o[n]);s.top=i,s.left=r}else s.cssText=t._stOrig;Ls.core.getCache(t).uncache=1,e.appendChild(t)}},zl=function(t,e,i){var r=e,n=r;return function(e){var o=Math.round(t());return o!==r&&o!==n&&Math.abs(o-r)>3&&Math.abs(o-n)>3&&(e=o,i&&i()),n=r,r=e,e}},Nl=function(t,e,i){var r={};r[e.p]="+="+i,Ls.set(t,r)},Ul=function(t,e){var i=Ms(t,e),r="_scroll"+e.p2,n=function e(n,o,s,a,l){var c=e.tween,u=o.onComplete,h={};s=s||i();var d=zl(i,s,(function(){c.kill(),e.tween=0}));return l=a&&l||0,a=a||n-s,c&&c.kill(),o[r]=n,o.inherit=!1,o.modifiers=h,h[r]=function(){return d(s+a*c.ratio+l*c.ratio*c.ratio)},o.onUpdate=function(){fs.cache++,e.tween&&Ml()},o.onComplete=function(){e.tween=0,u&&u.call(c)},c=e.tween=Ls.to(t,o)};return t[r]=i,i.wheelHandler=function(){return n.tween&&n.tween.kill()&&(n.tween=0)},Ja(t,"wheel",i.wheelHandler),Gl.isTouch&&Ja(t,"touchmove",i.wheelHandler),n},Gl=function(){function t(e,i){ks||t.register(Ls)||console.warn("Please gsap.registerPlugin(ScrollTrigger)"),aa(this),this.init(e,i)}return t.prototype.init=function(e,i){if(this.progress=this.start=0,this.vars&&this.kill(!0,!0),wa){var r,n,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,x,b,w,T,E,S,A,M,I,C,P,R,O,D,L,k,B,F,z,N,U,G,j,V,X,H=e=qa(Ba(e)||za(e)||e.nodeType?{trigger:e}:e,il),q=H.onUpdate,W=H.toggleClass,$=H.id,Y=H.onToggle,Z=H.onRefresh,K=H.scrub,J=H.trigger,Q=H.pin,tt=H.pinSpacing,et=H.invalidateOnRefresh,it=H.anticipatePin,rt=H.onScrubComplete,nt=H.onSnapComplete,ot=H.once,st=H.snap,at=H.pinReparent,lt=H.pinSpacer,ct=H.containerAnimation,ut=H.fastScrollEnd,ht=H.preventOverlaps,dt=e.horizontal||e.containerAnimation&&!1!==e.horizontal?Es:Ss,pt=!K&&0!==K,ft=As(e.scroller||Bs),mt=Ls.core.getCache(ft),gt=Ra(ft),_t="fixed"===("pinType"in e?e.pinType:ys(ft,"pinType")||gt&&"fixed"),yt=[e.onEnter,e.onLeave,e.onEnterBack,e.onLeaveBack],vt=pt&&e.toggleActions.split(" "),xt="markers"in e?e.markers:il.markers,bt=gt?0:parseFloat(Ha(ft)["border"+dt.p2+"Width"])||0,wt=this,Tt=e.onRefreshInit&&function(){return e.onRefreshInit(wt)},Et=function(t,e,i){var r=i.d,n=i.d2,o=i.a;return(o=ys(t,"getBoundingClientRect"))?function(){return o()[r]}:function(){return(e?Oa(n):t["client"+n])||0}}(ft,gt,dt),St=function(t,e){return!e||~ms.indexOf(t)?Da(t):function(){return Ll}}(ft,gt),At=0,Mt=0,It=0,Ct=Ms(ft,dt);if(wt._startClamp=wt._endClamp=!1,wt._dir=dt,it*=45,wt.scroller=ft,wt.scroll=ct?ct.time.bind(ct):Ct,s=Ct(),wt.vars=e,i=i||e.animation,"refreshPriority"in e&&(Qs=1,-9999===e.refreshPriority&&(_a=wt)),mt.tweenScroll=mt.tweenScroll||{top:Ul(ft,Ss),left:Ul(ft,Es)},wt.tweenTo=r=mt.tweenScroll[dt.p],wt.scrubDuration=function(t){(k=za(t)&&t)?L?L.duration(t):L=Ls.to(i,{ease:"expo",totalProgress:"+=0",inherit:!1,duration:k,paused:!0,onComplete:function(){return rt&&rt(wt)}}):(L&&L.progress(1).kill(),L=0)},i&&(i.vars.lazy=!1,i._initted&&!wt.isReverted||!1!==i.vars.immediateRender&&!1!==e.immediateRender&&i.duration()&&i.render(0,!0,!0),wt.animation=i.pause(),i.scrollTrigger=wt,wt.scrubDuration(K),O=0,$||($=i.vars.id)),st&&(Na(st)&&!st.push||(st={snapTo:st}),"scrollBehavior"in Ns.style&&Ls.set(gt?[Ns,zs]:ft,{scrollBehavior:"auto"}),fs.forEach((function(t){return Fa(t)&&t.target===(gt?Fs.scrollingElement||zs:ft)&&(t.smooth=!1)})),o=Fa(st.snapTo)?st.snapTo:"labels"===st.snapTo?function(t){return function(e){return Ls.utils.snap(Ya(t),e)}}(i):"labelsDirectional"===st.snapTo?(j=i,function(t,e){return Za(Ya(j))(t,e.direction)}):!1!==st.directional?function(t,e){return Za(st.snapTo)(t,va()-Mt<500?0:e.direction)}:Ls.utils.snap(st.snapTo),B=st.duration||{min:.1,max:2},B=Na(B)?Vs(B.min,B.max):Vs(B,B),F=Ls.delayedCall(st.delay||k/2||.1,(function(){var t=Ct(),e=va()-Mt<500,n=r.tween;if(!(e||Math.abs(wt.getVelocity())<10)||n||Ws||At===t)wt.isActive&&At!==t&&F.restart(!0);else{var s,a,u=(t-l)/g,h=i&&!pt?i.totalProgress():u,d=e?0:(h-D)/(va()-Xs)*1e3||0,p=Ls.utils.clamp(-u,1-u,ja(d/2)*d/.185),f=u+(!1===st.inertia?0:p),m=st,_=m.onStart,y=m.onInterrupt,v=m.onComplete;if(s=o(f,wt),za(s)||(s=f),a=Math.round(l+s*g),t<=c&&t>=l&&a!==t){if(n&&!n._initted&&n.data<=ja(a-t))return;!1===st.inertia&&(p=s-u),r(a,{duration:B(ja(.185*Math.max(ja(f-h),ja(s-h))/d/.05||0)),ease:st.ease||"power3",data:ja(a-t),onInterrupt:function(){return F.restart(!0)&&y&&y(wt)},onComplete:function(){wt.update(),At=Ct(),i&&(L?L.resetTo("totalProgress",s,i._tTime/i._tDur):i.progress(s)),O=D=i&&!pt?i.totalProgress():wt.progress,nt&&nt(wt),v&&v(wt)}},t,p*g,a-t-p*g),_&&_(wt,r.tween)}}})).pause()),$&&(ll[$]=wt),(G=(J=wt.trigger=As(J||!0!==Q&&Q))&&J._gsap&&J._gsap.stRevert)&&(G=G(wt)),Q=!0===Q?J:As(Q),Ba(W)&&(W={targets:J,className:W}),Q&&(!1===tt||"margin"===tt||(tt=!(!tt&&Q.parentNode&&Q.parentNode.style&&"flex"===Ha(Q.parentNode).display)&&Va),wt.pin=Q,(n=Ls.core.getCache(Q)).spacer?_=n.pinState:(lt&&((lt=As(lt))&&!lt.nodeType&&(lt=lt.current||lt.nativeElement),n.spacerIsNative=!!lt,lt&&(n.spacerState=Dl(lt))),n.spacer=x=lt||Fs.createElement("div"),x.classList.add("pin-spacer"),$&&x.classList.add("pin-spacer-"+$),n.pinState=_=Dl(Q)),!1!==e.force3D&&Ls.set(Q,{force3D:!0}),wt.spacer=x=n.spacer,R=Ha(Q),A=R[tt+dt.os2],w=Ls.getProperty(Q),T=Ls.quickSetter(Q,dt.a,Xa),Pl(Q,x,R),v=Dl(Q)),xt){f=Na(xt)?qa(xt,el):el,d=ol("scroller-start",$,ft,dt,f,0),p=ol("scroller-end",$,ft,dt,f,0,d),b=d["offset"+dt.op.d2];var Pt=As(ys(ft,"content")||ft);u=this.markerStart=ol("start",$,Pt,dt,f,b,0,ct),h=this.markerEnd=ol("end",$,Pt,dt,f,b,0,ct),ct&&(U=Ls.quickSetter([u,h],dt.a,Xa)),_t||ms.length&&!0===ys(ft,"fixedMarkers")||(X=Ha(V=gt?Ns:ft).position,V.style.position="absolute"===X||"fixed"===X?X:"relative",Ls.set([d,p],{force3D:!0}),I=Ls.quickSetter(d,dt.a,Xa),P=Ls.quickSetter(p,dt.a,Xa))}if(ct){var Rt=ct.vars.onUpdate,Ot=ct.vars.onUpdateParams;ct.eventCallback("onUpdate",(function(){wt.update(0,0,1),Rt&&Rt.apply(ct,Ot||[])}))}if(wt.previous=function(){return al[al.indexOf(wt)-1]},wt.next=function(){return al[al.indexOf(wt)+1]},wt.revert=function(t,e){if(!e)return wt.kill(!0);var r=!1!==t||!wt.enabled,n=qs;r!==wt.isReverted&&(r&&(z=Math.max(Ct(),wt.scroll.rec||0),It=wt.progress,N=i&&i.progress()),u&&[u,h,d,p].forEach((function(t){return t.style.display=r?"none":"block"})),r&&(qs=wt,wt.update(r)),!Q||at&&wt.isActive||(r?function(t,e,i){Ol(i);var r=t._gsap;if(r.spacerIsNative)Ol(r.spacerState);else if(t._gsap.swappedIn){var n=e.parentNode;n&&(n.insertBefore(t,e),n.removeChild(e))}t._gsap.swappedIn=!1}(Q,x,_):Pl(Q,x,Ha(Q),M)),r||wt.update(r),qs=n,wt.isReverted=r)},wt.refresh=function(n,o,f,b){if(!qs&&wt.enabled||o)if(Q&&n&&ba)Ja(t,"scrollEnd",ml);else{!ma&&Tt&&Tt(wt),qs=wt,r.tween&&!f&&(r.tween.kill(),r.tween=0),L&&L.pause(),et&&i&&i.revert({kill:!1}).invalidate(),wt.isReverted||wt.revert(!0,!0),wt._subPinOffset=!1;var T,A,I,P,R,O,D,k,B,U,G,j,V,X=Et(),H=St(),q=ct?ct.duration():La(ft,dt),W=g<=.01,$=0,Y=b||0,K=Na(f)?f.end:e.end,it=e.endTrigger||J,rt=Na(f)?f.start:e.start||(0!==e.start&&J?Q?"0 0":"0 100%":0),nt=wt.pinnedContainer=e.pinnedContainer&&As(e.pinnedContainer,wt),ot=J&&Math.max(0,al.indexOf(wt))||0,st=ot;for(xt&&Na(f)&&(j=Ls.getProperty(d,dt.p),V=Ls.getProperty(p,dt.p));st--;)(O=al[st]).end||O.refresh(0,1)||(qs=wt),!(D=O.pin)||D!==J&&D!==Q&&D!==nt||O.isReverted||(U||(U=[]),U.unshift(O),O.revert(!0,!0)),O!==al[st]&&(ot--,st--);for(Fa(rt)&&(rt=rt(wt)),rt=Ta(rt,"start",wt),l=kl(rt,J,X,dt,Ct(),u,d,wt,H,bt,_t,q,ct,wt._startClamp&&"_startClamp")||(Q?-.001:0),Fa(K)&&(K=K(wt)),Ba(K)&&!K.indexOf("+=")&&(~K.indexOf(" ")?K=(Ba(rt)?rt.split(" ")[0]:"")+K:($=nl(K.substr(2),X),K=Ba(rt)?rt:(ct?Ls.utils.mapRange(0,ct.duration(),ct.scrollTrigger.start,ct.scrollTrigger.end,l):l)+$,it=J)),K=Ta(K,"end",wt),c=Math.max(l,kl(K||(it?"100% 0":q),it,X,dt,Ct()+$,h,p,wt,H,bt,_t,q,ct,wt._endClamp&&"_endClamp"))||-.001,$=0,st=ot;st--;)(D=(O=al[st]).pin)&&O.start-O._pinPush<=l&&!ct&&O.end>0&&(T=O.end-(wt._startClamp?Math.max(0,O.start):O.start),(D===J&&O.start-O._pinPush<l||D===nt)&&isNaN(rt)&&($+=T*(1-O.progress)),D===Q&&(Y+=T));if(l+=$,c+=$,wt._startClamp&&(wt._startClamp+=$),wt._endClamp&&!ma&&(wt._endClamp=c||-.001,c=Math.min(c,La(ft,dt))),g=c-l||(l-=.01)&&.001,W&&(It=Ls.utils.clamp(0,1,Ls.utils.normalize(l,c,z))),wt._pinPush=Y,u&&$&&((T={})[dt.a]="+="+$,nt&&(T[dt.p]="-="+Ct()),Ls.set([u,h],T)),!Q||da&&wt.end>=La(ft,dt)){if(J&&Ct()&&!ct)for(A=J.parentNode;A&&A!==Ns;)A._pinOffset&&(l-=A._pinOffset,c-=A._pinOffset),A=A.parentNode}else T=Ha(Q),P=dt===Ss,I=Ct(),E=parseFloat(w(dt.a))+Y,!q&&c>1&&(G={style:G=(gt?Fs.scrollingElement||zs:ft).style,value:G["overflow"+dt.a.toUpperCase()]},gt&&"scroll"!==Ha(Ns)["overflow"+dt.a.toUpperCase()]&&(G.style["overflow"+dt.a.toUpperCase()]="scroll")),Pl(Q,x,T),v=Dl(Q),A=Wa(Q,!0),k=_t&&Ms(ft,P?Es:Ss)(),tt?((M=[tt+dt.os2,g+Y+Xa]).t=x,(st=tt===Va?$a(Q,dt)+g+Y:0)&&(M.push(dt.d,st+Xa),"auto"!==x.style.flexBasis&&(x.style.flexBasis=st+Xa)),Ol(M),nt&&al.forEach((function(t){t.pin===nt&&!1!==t.vars.pinSpacing&&(t._subPinOffset=!0)})),_t&&Ct(z)):(st=$a(Q,dt))&&"auto"!==x.style.flexBasis&&(x.style.flexBasis=st+Xa),_t&&((R={top:A.top+(P?I-l:k)+Xa,left:A.left+(P?k:I-l)+Xa,boxSizing:"border-box",position:"fixed"}).width=R.maxWidth=Math.ceil(A.width)+Xa,R.height=R.maxHeight=Math.ceil(A.height)+Xa,R.margin=R.marginTop=R.marginRight=R.marginBottom=R.marginLeft="0",R[Va]=T[Va],R[Va+"Top"]=T[Va+"Top"],R[Va+"Right"]=T[Va+"Right"],R[Va+"Bottom"]=T[Va+"Bottom"],R[Va+"Left"]=T[Va+"Left"],y=function(t,e,i){for(var r,n=[],o=t.length,s=i?8:0;s<o;s+=2)r=t[s],n.push(r,r in e?e[r]:t[s+1]);return n.t=t.t,n}(_,R,at),ma&&Ct(0)),i?(B=i._initted,ta(1),i.render(i.duration(),!0,!0),S=w(dt.a)-E+g+Y,C=Math.abs(g-S)>1,_t&&C&&y.splice(y.length-2,2),i.render(0,!0,!0),B||i.invalidate(!0),i.parent||i.totalTime(i.totalTime()),ta(0)):S=g,G&&(G.value?G.style["overflow"+dt.a.toUpperCase()]=G.value:G.style.removeProperty("overflow-"+dt.a));U&&U.forEach((function(t){return t.revert(!1,!0)})),wt.start=l,wt.end=c,s=a=ma?z:Ct(),ct||ma||(s<z&&Ct(z),wt.scroll.rec=0),wt.revert(!1,!0),Mt=va(),F&&(At=-1,F.restart(!0)),qs=0,i&&pt&&(i._initted||N)&&i.progress()!==N&&i.progress(N||0,!0).render(i.time(),!0,!0),(W||It!==wt.progress||ct||et)&&(i&&!pt&&i.totalProgress(ct&&l<-.001&&!It?Ls.utils.normalize(l,c,0):It,!0),wt.progress=W||(s-l)/g===It?0:It),Q&&tt&&(x._pinOffset=Math.round(wt.progress*S)),L&&L.invalidate(),isNaN(j)||(j-=Ls.getProperty(d,dt.p),V-=Ls.getProperty(p,dt.p),Nl(d,dt,j),Nl(u,dt,j-(b||0)),Nl(p,dt,V),Nl(h,dt,V-(b||0))),W&&!ma&&wt.update(),!Z||ma||m||(m=!0,Z(wt),m=!1)}},wt.getVelocity=function(){return(Ct()-a)/(va()-Xs)*1e3||0},wt.endAnimation=function(){Ua(wt.callbackAnimation),i&&(L?L.progress(1):i.paused()?pt||Ua(i,wt.direction<0,1):Ua(i,i.reversed()))},wt.labelToScroll=function(t){return i&&i.labels&&(l||wt.refresh()||l)+i.labels[t]/i.duration()*g||0},wt.getTrailing=function(t){var e=al.indexOf(wt),i=wt.direction>0?al.slice(0,e).reverse():al.slice(e+1);return(Ba(t)?i.filter((function(e){return e.vars.preventOverlaps===t})):i).filter((function(t){return wt.direction>0?t.end<=l:t.start>=c}))},wt.update=function(t,e,n){if(!ct||n||t){var o,u,h,p,f,m,_,b=!0===ma?z:wt.scroll(),w=t?0:(b-l)/g,M=w<0?0:w>1?1:w||0,R=wt.progress;if(e&&(a=s,s=ct?Ct():b,st&&(D=O,O=i&&!pt?i.totalProgress():M)),it&&Q&&!qs&&!ya&&ba&&(!M&&l<b+(b-a)/(va()-Xs)*it?M=1e-4:1===M&&c>b+(b-a)/(va()-Xs)*it&&(M=.9999)),M!==R&&wt.enabled){if(p=(f=(o=wt.isActive=!!M&&M<1)!==(!!R&&R<1))||!!M!=!!R,wt.direction=M>R?1:-1,wt.progress=M,p&&!qs&&(u=M&&!R?0:1===M?1:1===R?2:3,pt&&(h=!f&&"none"!==vt[u+1]&&vt[u+1]||vt[u],_=i&&("complete"===h||"reset"===h||h in i))),ht&&(f||_)&&(_||K||!i)&&(Fa(ht)?ht(wt):wt.getTrailing(ht).forEach((function(t){return t.endAnimation()}))),pt||(!L||qs||ya?i&&i.totalProgress(M,!(!qs||!Mt&&!t)):(L._dp._time-L._start!==L._time&&L.render(L._dp._time-L._start),L.resetTo?L.resetTo("totalProgress",M,i._tTime/i._tDur):(L.vars.totalProgress=M,L.invalidate().restart()))),Q)if(t&&tt&&(x.style[tt+dt.os2]=A),_t){if(p){if(m=!t&&M>R&&c+1>b&&b+1>=La(ft,dt),at)if(t||!o&&!m)Fl(Q,x);else{var k=Wa(Q,!0),B=b-l;Fl(Q,Ns,k.top+(dt===Ss?B:0)+Xa,k.left+(dt===Ss?0:B)+Xa)}Ol(o||m?y:v),C&&M<1&&o||T(E+(1!==M||m?0:S))}}else T(Ia(E+S*M));st&&!r.tween&&!qs&&!ya&&F.restart(!0),W&&(f||ot&&M&&(M<1||!pa))&&js(W.targets).forEach((function(t){return t.classList[o||ot?"add":"remove"](W.className)})),q&&!pt&&!t&&q(wt),p&&!qs?(pt&&(_&&("complete"===h?i.pause().totalProgress(1):"reset"===h?i.restart(!0).pause():"restart"===h?i.restart(!0):i[h]()),q&&q(wt)),!f&&pa||(Y&&f&&Ga(wt,Y),yt[u]&&Ga(wt,yt[u]),ot&&(1===M?wt.kill(!1,1):yt[u]=0),f||yt[u=1===M?1:3]&&Ga(wt,yt[u])),ut&&!o&&Math.abs(wt.getVelocity())>(za(ut)?ut:2500)&&(Ua(wt.callbackAnimation),L?L.progress(1):Ua(i,"reverse"===h?1:!M,1))):pt&&q&&!qs&&q(wt)}if(P){var N=ct?b/ct.duration()*(ct._caScrollDist||0):b;I(N+(d._isFlipped?1:0)),P(N)}U&&U(-b/ct.duration()*(ct._caScrollDist||0))}},wt.enable=function(e,i){wt.enabled||(wt.enabled=!0,Ja(ft,"resize",dl),gt||Ja(ft,"scroll",ul),Tt&&Ja(t,"refreshInit",Tt),!1!==e&&(wt.progress=It=0,s=a=At=Ct()),!1!==i&&wt.refresh())},wt.getTween=function(t){return t&&r?r.tween:L},wt.setPositions=function(t,e,i,r){if(ct){var n=ct.scrollTrigger,o=ct.duration(),s=n.end-n.start;t=n.start+s*t/o,e=n.start+s*e/o}wt.refresh(!1,!1,{start:Ea(t,i&&!!wt._startClamp),end:Ea(e,i&&!!wt._endClamp)},r),wt.update()},wt.adjustPinSpacing=function(t){if(M&&t){var e=M.indexOf(dt.d)+1;M[e]=parseFloat(M[e])+t+Xa,M[1]=parseFloat(M[1])+t+Xa,Ol(M)}},wt.disable=function(e,i){if(wt.enabled&&(!1!==e&&wt.revert(!0,!0),wt.enabled=wt.isActive=!1,i||L&&L.pause(),z=0,n&&(n.uncache=1),Tt&&Qa(t,"refreshInit",Tt),F&&(F.pause(),r.tween&&r.tween.kill()&&(r.tween=0)),!gt)){for(var o=al.length;o--;)if(al[o].scroller===ft&&al[o]!==wt)return;Qa(ft,"resize",dl),gt||Qa(ft,"scroll",ul)}},wt.kill=function(t,r){wt.disable(t,r),L&&!r&&L.kill(),$&&delete ll[$];var o=al.indexOf(wt);o>=0&&al.splice(o,1),o===Ys&&Al>0&&Ys--,o=0,al.forEach((function(t){return t.scroller===wt.scroller&&(o=1)})),o||ma||(wt.scroll.rec=0),i&&(i.scrollTrigger=null,t&&i.revert({kill:!1}),r||i.kill()),u&&[u,h,d,p].forEach((function(t){return t.parentNode&&t.parentNode.removeChild(t)})),_a===wt&&(_a=0),Q&&(n&&(n.uncache=1),o=0,al.forEach((function(t){return t.pin===Q&&o++})),o||(n.spacer=0)),e.onKill&&e.onKill(wt)},al.push(wt),wt.enable(!1,!1),G&&G(wt),i&&i.add&&!g){var Dt=wt.update;wt.update=function(){wt.update=Dt,l||c||wt.refresh()},Ls.delayedCall(.01,wt.update),g=.01,l=c=0}else wt.refresh();Q&&function(){if(ga!==bl){var t=ga=bl;requestAnimationFrame((function(){return t===bl&&El(!0)}))}}()}else this.update=this.refresh=this.kill=Ma},t.register=function(e){return ks||(Ls=e||Pa(),Ca()&&window.document&&t.enable(),ks=wa),ks},t.defaults=function(t){if(t)for(var e in t)il[e]=t[e];return il},t.disable=function(t,e){wa=0,al.forEach((function(i){return i[e?"kill":"disable"](t)})),Qa(Bs,"wheel",ul),Qa(Fs,"scroll",ul),clearInterval(Hs),Qa(Fs,"touchcancel",Ma),Qa(Ns,"touchstart",Ma),Ka(Qa,Fs,"pointerdown,touchstart,mousedown",Sa),Ka(Qa,Fs,"pointerup,touchend,mouseup",Aa),Gs.kill(),ka(Qa);for(var i=0;i<fs.length;i+=3)tl(Qa,fs[i],fs[i+1]),tl(Qa,fs[i],fs[i+2])},t.enable=function(){if(Bs=window,Fs=document,zs=Fs.documentElement,Ns=Fs.body,Ls&&(js=Ls.utils.toArray,Vs=Ls.utils.clamp,aa=Ls.core.context||Ma,ta=Ls.core.suppressOverwrites||Ma,la=Bs.history.scrollRestoration||"auto",Sl=Bs.pageYOffset,Ls.core.globals("ScrollTrigger",t),Ns)){wa=1,(ca=document.createElement("div")).style.height="100vh",ca.style.position="absolute",wl(),function t(){return wa&&requestAnimationFrame(t)}(),Ds.register(Ls),t.isTouch=Ds.isTouch,sa=Ds.isTouch&&/(iPad|iPhone|iPod|Mac)/g.test(navigator.userAgent),ra=1===Ds.isTouch,Ja(Bs,"wheel",ul),Us=[Bs,Fs,zs,Ns],Ls.matchMedia?(t.matchMedia=function(t){var e,i=Ls.matchMedia();for(e in t)i.add(e,t[e]);return i},Ls.addEventListener("matchMediaInit",(function(){return vl()})),Ls.addEventListener("matchMediaRevert",(function(){return yl()})),Ls.addEventListener("matchMedia",(function(){El(0,1),gl("matchMedia")})),Ls.matchMedia("(orientation: portrait)",(function(){return hl(),hl}))):console.warn("Requires GSAP 3.11.0 or later"),hl(),Ja(Fs,"scroll",ul);var e,i,r=Ns.style,n=r.borderTopStyle,o=Ls.core.Animation.prototype;for(o.revert||Object.defineProperty(o,"revert",{value:function(){return this.time(-.01,!0)}}),r.borderTopStyle="solid",e=Wa(Ns),Ss.m=Math.round(e.top+Ss.sc())||0,Es.m=Math.round(e.left+Es.sc())||0,n?r.borderTopStyle=n:r.removeProperty("border-top-style"),Hs=setInterval(cl,250),Ls.delayedCall(.5,(function(){return ya=0})),Ja(Fs,"touchcancel",Ma),Ja(Ns,"touchstart",Ma),Ka(Ja,Fs,"pointerdown,touchstart,mousedown",Sa),Ka(Ja,Fs,"pointerup,touchend,mouseup",Aa),$s=Ls.utils.checkPrefix("transform"),Cl.push($s),ks=va(),Gs=Ls.delayedCall(.2,El).pause(),Js=[Fs,"visibilitychange",function(){var t=Bs.innerWidth,e=Bs.innerHeight;Fs.hidden?(Zs=t,Ks=e):Zs===t&&Ks===e||dl()},Fs,"DOMContentLoaded",El,Bs,"load",El,Bs,"resize",dl],ka(Ja),al.forEach((function(t){return t.enable(0,1)})),i=0;i<fs.length;i+=3)tl(Qa,fs[i],fs[i+1]),tl(Qa,fs[i],fs[i+2])}},t.config=function(e){"limitCallbacks"in e&&(pa=!!e.limitCallbacks);var i=e.syncInterval;i&&clearInterval(Hs)||(Hs=i)&&setInterval(cl,i),"ignoreMobileResize"in e&&(ra=1===t.isTouch&&e.ignoreMobileResize),"autoRefreshEvents"in e&&(ka(Qa)||ka(Ja,e.autoRefreshEvents||"none"),ea=-1===(e.autoRefreshEvents+"").indexOf("resize"))},t.scrollerProxy=function(t,e){var i=As(t),r=fs.indexOf(i),n=Ra(i);~r&&fs.splice(r,n?6:2),e&&(n?ms.unshift(Bs,e,Ns,e,zs,e):ms.unshift(i,e))},t.clearMatchMedia=function(t){al.forEach((function(e){return e._ctx&&e._ctx.query===t&&e._ctx.kill(!0,!0)}))},t.isInViewport=function(t,e,i){var r=(Ba(t)?As(t):t).getBoundingClientRect(),n=r[i?"width":"height"]*e||0;return i?r.right-n>0&&r.left+n<Bs.innerWidth:r.bottom-n>0&&r.top+n<Bs.innerHeight},t.positionInViewport=function(t,e,i){Ba(t)&&(t=As(t));var r=t.getBoundingClientRect(),n=r[i?"width":"height"],o=null==e?n/2:e in rl?rl[e]*n:~e.indexOf("%")?parseFloat(e)*n/100:parseFloat(e)||0;return i?(r.left+o)/Bs.innerWidth:(r.top+o)/Bs.innerHeight},t.killAll=function(t){if(al.slice(0).forEach((function(t){return"ScrollSmoother"!==t.vars.id&&t.kill()})),!0!==t){var e=pl.killAll||[];pl={},e.forEach((function(t){return t()}))}},t}();Gl.version="3.12.5",Gl.saveStyles=function(t){return t?js(t).forEach((function(t){if(t&&t.style){var e=_l.indexOf(t);e>=0&&_l.splice(e,5),_l.push(t,t.style.cssText,t.getBBox&&t.getAttribute("transform"),Ls.core.getCache(t),aa())}})):_l},Gl.revert=function(t,e){return vl(!t,e)},Gl.create=function(t,e){return new Gl(t,e)},Gl.refresh=function(t){return t?dl():(ks||Gl.register())&&El(!0)},Gl.update=function(t){return++fs.cache&&Ml(!0===t?2:0)},Gl.clearScrollMemory=xl,Gl.maxScroll=function(t,e){return La(t,e?Es:Ss)},Gl.getScrollFunc=function(t,e){return Ms(As(t),e?Es:Ss)},Gl.getById=function(t){return ll[t]},Gl.getAll=function(){return al.filter((function(t){return"ScrollSmoother"!==t.vars.id}))},Gl.isScrolling=function(){return!!ba},Gl.snapDirectional=Za,Gl.addEventListener=function(t,e){var i=pl[t]||(pl[t]=[]);~i.indexOf(e)||i.push(e)},Gl.removeEventListener=function(t,e){var i=pl[t],r=i&&i.indexOf(e);r>=0&&i.splice(r,1)},Gl.batch=function(t,e){var i,r=[],n={},o=e.interval||.016,s=e.batchMax||1e9,a=function(t,e){var i=[],r=[],n=Ls.delayedCall(o,(function(){e(i,r),i=[],r=[]})).pause();return function(t){i.length||n.restart(!0),i.push(t.trigger),r.push(t),s<=i.length&&n.progress(1)}};for(i in e)n[i]="on"===i.substr(0,2)&&Fa(e[i])&&"onRefreshInit"!==i?a(0,e[i]):e[i];return Fa(s)&&(s=s(),Ja(Gl,"refresh",(function(){return s=e.batchMax()}))),js(t).forEach((function(t){var e={};for(i in n)e[i]=n[i];e.trigger=t,r.push(Gl.create(e))})),r};var jl,Vl=function(t,e,i,r){return e>r?t(r):e<0&&t(0),i>r?(r-e)/(i-e):i<0?e/(e-i):1},Xl=function t(e,i){!0===i?e.style.removeProperty("touch-action"):e.style.touchAction=!0===i?"auto":i?"pan-"+i+(Ds.isTouch?" pinch-zoom":""):"none",e===zs&&t(Ns,i)},Hl={auto:1,scroll:1},ql=function(t){var e,i=t.event,r=t.target,n=t.axis,o=(i.changedTouches?i.changedTouches[0]:i).target,s=o._gsap||Ls.core.getCache(o),a=va();if(!s._isScrollT||a-s._isScrollT>2e3){for(;o&&o!==Ns&&(o.scrollHeight<=o.clientHeight&&o.scrollWidth<=o.clientWidth||!Hl[(e=Ha(o)).overflowY]&&!Hl[e.overflowX]);)o=o.parentNode;s._isScroll=o&&o!==r&&!Ra(o)&&(Hl[(e=Ha(o)).overflowY]||Hl[e.overflowX]),s._isScrollT=a}(s._isScroll||"x"===n)&&(i.stopPropagation(),i._gsapAllow=!0)},Wl=function(t,e,i,r){return Ds.create({target:t,capture:!0,debounce:!1,lockAxis:!0,type:e,onWheel:r=r&&ql,onPress:r,onDrag:r,onScroll:r,onEnable:function(){return i&&Ja(Fs,Ds.eventTypes[0],Yl,!1,!0)},onDisable:function(){return Qa(Fs,Ds.eventTypes[0],Yl,!0)}})},$l=/(input|label|select|textarea)/i,Yl=function(t){var e=$l.test(t.target.tagName);(e||jl)&&(t._gsapAllow=!0,jl=e)},Zl=function(t){Na(t)||(t={}),t.preventDefault=t.isNormalizer=t.allowClicks=!0,t.type||(t.type="wheel,touch"),t.debounce=!!t.debounce,t.id=t.id||"normalizer";var e,i,r,n,o,s,a,l,c=t,u=c.normalizeScrollX,h=c.momentum,d=c.allowNestedScroll,p=c.onRelease,f=As(t.target)||zs,m=Ls.core.globals().ScrollSmoother,g=m&&m.get(),_=sa&&(t.content&&As(t.content)||g&&!1!==t.content&&!g.smooth()&&g.content()),y=Ms(f,Ss),v=Ms(f,Es),x=1,b=(Ds.isTouch&&Bs.visualViewport?Bs.visualViewport.scale*Bs.visualViewport.width:Bs.outerWidth)/Bs.innerWidth,w=0,T=Fa(h)?function(){return h(e)}:function(){return h||2.8},E=Wl(f,t.type,!0,d),S=function(){return n=!1},A=Ma,M=Ma,I=function(){i=La(f,Ss),M=Vs(sa?1:0,i),u&&(A=Vs(0,La(f,Es))),r=bl},C=function(){_._gsap.y=Ia(parseFloat(_._gsap.y)+y.offset)+"px",_.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+parseFloat(_._gsap.y)+", 0, 1)",y.offset=y.cacheID=0},P=function(){I(),o.isActive()&&o.vars.scrollY>i&&(y()>i?o.progress(1)&&y(i):o.resetTo("scrollY",i))};return _&&Ls.set(_,{y:"+=0"}),t.ignoreCheck=function(t){return sa&&"touchmove"===t.type&&function(){if(n){requestAnimationFrame(S);var t=Ia(e.deltaY/2),i=M(y.v-t);if(_&&i!==y.v+y.offset){y.offset=i-y.v;var r=Ia((parseFloat(_&&_._gsap.y)||0)-y.offset);_.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+r+", 0, 1)",_._gsap.y=r+"px",y.cacheID=fs.cache,Ml()}return!0}y.offset&&C(),n=!0}()||x>1.05&&"touchstart"!==t.type||e.isGesturing||t.touches&&t.touches.length>1},t.onPress=function(){n=!1;var t=x;x=Ia((Bs.visualViewport&&Bs.visualViewport.scale||1)/b),o.pause(),t!==x&&Xl(f,x>1.01||!u&&"x"),s=v(),a=y(),I(),r=bl},t.onRelease=t.onGestureStart=function(t,e){if(y.offset&&C(),e){fs.cache++;var r,n,s=T();u&&(n=(r=v())+.05*s*-t.velocityX/.227,s*=Vl(v,r,n,La(f,Es)),o.vars.scrollX=A(n)),n=(r=y())+.05*s*-t.velocityY/.227,s*=Vl(y,r,n,La(f,Ss)),o.vars.scrollY=M(n),o.invalidate().duration(s).play(.01),(sa&&o.vars.scrollY>=i||r>=i-1)&&Ls.to({},{onUpdate:P,duration:s})}else l.restart(!0);p&&p(t)},t.onWheel=function(){o._ts&&o.pause(),va()-w>1e3&&(r=0,w=va())},t.onChange=function(t,e,i,n,o){if(bl!==r&&I(),e&&u&&v(A(n[2]===e?s+(t.startX-t.x):v()+e-n[1])),i){y.offset&&C();var l=o[2]===i,c=l?a+t.startY-t.y:y()+i-o[1],h=M(c);l&&c!==h&&(a+=h-c),y(h)}(i||e)&&Ml()},t.onEnable=function(){Xl(f,!u&&"x"),Gl.addEventListener("refresh",P),Ja(Bs,"resize",P),y.smooth&&(y.target.style.scrollBehavior="auto",y.smooth=v.smooth=!1),E.enable()},t.onDisable=function(){Xl(f,!0),Qa(Bs,"resize",P),Gl.removeEventListener("refresh",P),E.kill()},t.lockAxis=!1!==t.lockAxis,(e=new Ds(t)).iOS=sa,sa&&!y()&&y(1),sa&&Ls.ticker.add(Ma),l=e._dc,o=Ls.to(e,{ease:"power4",paused:!0,inherit:!1,scrollX:u?"+=0.1":"+=0",scrollY:"+=0.1",modifiers:{scrollY:zl(y,y(),(function(){return o.pause()}))},onUpdate:Ml,onComplete:l.vars.onComplete}),e};function Kl(t){return(Kl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Jl(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ql(r.key),r)}}function Ql(t){var e=function(t,e){if("object"!=Kl(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!=Kl(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Kl(e)?e:String(e)}Gl.sort=function(t){return al.sort(t||function(t,e){return-1e6*(t.vars.refreshPriority||0)+t.start-(e.start+-1e6*(e.vars.refreshPriority||0))})},Gl.observe=function(t){return new Ds(t)},Gl.normalizeScroll=function(t){if(void 0===t)return ia;if(!0===t&&ia)return ia.enable();if(!1===t)return ia&&ia.kill(),void(ia=t);var e=t instanceof Ds?t:Zl(t);return ia&&ia.target===e.target&&ia.kill(),Ra(e.target)&&(ia=e),e},Gl.core={_getVelocityProp:Is,_inputObserver:Wl,_scrollers:fs,_proxies:ms,bridge:{ss:function(){ba||gl("scrollStart"),ba=va()},ref:function(){return qs}}},Pa()&&Ls.registerPlugin(Gl),Zo.registerPlugin(Gl);var tc=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.el=e,this.init()}var e,i,r;return e=t,(i=[{key:"init",value:function(){this.secondaryImage=this.el.querySelector(".image-secondary"),this.scroller=this.el.querySelector(".hero-scroll-animation--scroller"),this.secondaryImage&&this.scroller&&(this.initBinds(),this.initEvents(),this.initScene())}},{key:"initEvents",value:function(){window.addEventListener("resize",xt(this.onResize,100))}},{key:"initBinds",value:function(){this.render=this.render.bind(this),this.onResize=this.onResize.bind(this)}},{key:"initScene",value:function(){this.maxFPS=60,this.lastFrameTime=0,this.frameDuration=1e3/this.maxFPS,this.currentWidth=window.innerWidth,this.currentScrollProgress=0,this.neededScrollProgress=0,this.scrollProgressThreshold=.001,this.scrollProgressSpeed=.2,this.isPinable=this.scroller.classList.contains("pin-section"),this.setupScroll(),this.render()}},{key:"render",value:function(t){t-this.lastFrameTime<this.frameDuration||(this.lastFrameTime=t,this.neededScrollProgress!==this.currentScrollProgress&&(this.currentScrollProgress=this.currentScrollProgress+(this.neededScrollProgress-this.currentScrollProgress)*this.scrollProgressSpeed,Math.abs(this.currentScrollProgress-this.neededScrollProgress)<this.scrollProgressThreshold&&(this.currentScrollProgress=this.neededScrollProgress),this.updateScrollAnimation(this.currentScrollProgress))),requestAnimationFrame(this.render)}},{key:"setupScroll",value:function(){var t=this;this.scrollTrigger=Gl.create({trigger:this.el,start:function(){return t.isPinable?"top top":"top 20%"},end:function(){return t.isPinable?"bottom bottom":"bottom 50%"},scrub:!0,invalidateOnRefresh:!0,onUpdate:function(e){t.neededScrollProgress=e.progress}}),this.updateScrollAnimation(0)}},{key:"updateScrollAnimation",value:function(){this.secondaryImage.style.opacity=this.currentScrollProgress}},{key:"onResize",value:function(){this.currentWidth!==window.innerWidth&&(this.currentWidth=window.innerWidth,this.scrollTrigger.refresh())}}])&&Jl(e.prototype,i),r&&Jl(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),ec=i("B/eG"),ic=i("MgzW"),rc=i.n(ic);self.Promise||(self.Promise=ec.a),Object.assign||(Object.assign=rc.a);if(Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!self.performance||!self.performance.now){var nc=Date.now();self.performance||(self.performance={}),self.performance.now=function(){return Date.now()-nc}}for(var oc=Date.now(),sc=["ms","moz","webkit","o"],ac=0;ac<sc.length&&!self.requestAnimationFrame;++ac){var lc=sc[ac];self.requestAnimationFrame=self[lc+"RequestAnimationFrame"],self.cancelAnimationFrame=self[lc+"CancelAnimationFrame"]||self[lc+"CancelRequestAnimationFrame"]}self.requestAnimationFrame||(self.requestAnimationFrame=function(t){if("function"!=typeof t)throw new TypeError(t+"is not a function");var e=Date.now(),i=16+oc-e;return i<0&&(i=0),oc=e,self.setTimeout((function(){oc=Date.now(),t(performance.now())}),i)}),self.cancelAnimationFrame||(self.cancelAnimationFrame=function(t){return clearTimeout(t)}),Math.sign||(Math.sign=function(t){return 0===(t=Number(t))||isNaN(t)?t:t>0?1:-1}),Number.isInteger||(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),self.ArrayBuffer||(self.ArrayBuffer=Array),self.Float32Array||(self.Float32Array=Array),self.Uint32Array||(self.Uint32Array=Array),self.Uint16Array||(self.Uint16Array=Array),self.Uint8Array||(self.Uint8Array=Array),self.Int32Array||(self.Int32Array=Array);var cc=/iPhone/i,uc=/iPod/i,hc=/iPad/i,dc=/\biOS-universal(?:.+)Mac\b/i,pc=/\bAndroid(?:.+)Mobile\b/i,fc=/Android/i,mc=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,gc=/Silk/i,_c=/Windows Phone/i,yc=/\bWindows(?:.+)ARM\b/i,vc=/BlackBerry/i,xc=/BB10/i,bc=/Opera Mini/i,wc=/\b(CriOS|Chrome)(?:.+)Mobile/i,Tc=/Mobile(?:.+)Firefox\b/i,Ec=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};var Sc,Ac,Mc,Ic,Cc,Pc,Rc,Oc,Dc,Lc,kc,Bc,Fc,zc,Nc,Uc,Gc,jc,Vc,Xc=function(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var i=e.userAgent,r=i.split("[FBAN");void 0!==r[1]&&(i=r[0]),void 0!==(r=i.split("Twitter"))[1]&&(i=r[0]);var n=function(t){return function(e){return e.test(t)}}(i),o={apple:{phone:n(cc)&&!n(_c),ipod:n(uc),tablet:!n(cc)&&(n(hc)||Ec(e))&&!n(_c),universal:n(dc),device:(n(cc)||n(uc)||n(hc)||n(dc)||Ec(e))&&!n(_c)},amazon:{phone:n(mc),tablet:!n(mc)&&n(gc),device:n(mc)||n(gc)},android:{phone:!n(_c)&&n(mc)||!n(_c)&&n(pc),tablet:!n(_c)&&!n(mc)&&!n(pc)&&(n(gc)||n(fc)),device:!n(_c)&&(n(mc)||n(gc)||n(pc)||n(fc))||n(/\bokhttp\b/i)},windows:{phone:n(_c),tablet:n(yc),device:n(_c)||n(yc)},other:{blackberry:n(vc),blackberry10:n(xc),opera:n(bc),firefox:n(Tc),chrome:n(wc),device:n(vc)||n(xc)||n(bc)||n(Tc)||n(wc)},any:!1,phone:!1,tablet:!1};return o.any=o.apple.device||o.android.device||o.windows.device||o.other.device,o.phone=o.apple.phone||o.android.phone||o.windows.phone,o.tablet=o.apple.tablet||o.android.tablet||o.windows.tablet,o}(self.navigator);!function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}(Sc||(Sc={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(Ac||(Ac={})),function(t){t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL"}(Mc||(Mc={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}(Ic||(Ic={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Cc||(Cc={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(Pc||(Pc={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(Rc||(Rc={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(Oc||(Oc={})),function(t){t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT"}(Dc||(Dc={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(Lc||(Lc={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(kc||(kc={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL"}(Bc||(Bc={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}(Fc||(Fc={})),function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT"}(zc||(zc={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(Nc||(Nc={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(Uc||(Uc={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}(Gc||(Gc={})),function(t){t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH"}(jc||(jc={})),function(t){t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"}(Vc||(Vc={}));var Hc,qc,Wc,$c,Yc,Zc,Kc,Jc,Qc,tu,eu,iu,ru,nu,ou,su,au,lu,cu,uu={MIPMAP_TEXTURES:Bc.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,FILTER_MULTISAMPLE:jc.NONE,SPRITE_MAX_TEXTURES:function(t){var e=!0;if(Xc.tablet||Xc.phone){var i;if(Xc.apple.device)if(i=navigator.userAgent.match(/OS (\d+)_(\d+)?/))parseInt(i[1],10)<11&&(e=!1);if(Xc.android.device)if(i=navigator.userAgent.match(/Android\s([0-9.]*)/))parseInt(i[1],10)<7&&(e=!1)}return e?t:4}(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1},GC_MODE:Nc.AUTO,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:kc.CLAMP,SCALE_MODE:Lc.LINEAR,PRECISION_VERTEX:Uc.HIGH,PRECISION_FRAGMENT:Xc.apple.device?Uc.HIGH:Uc.MEDIUM,CAN_UPLOAD_SAME_BUFFER:!Xc.apple.device,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},hu=i("8UI6"),du=i.n(hu),pu=i("VmRL"),fu=i.n(pu),mu=i("CxY0");!function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}(Hc||(Hc={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(qc||(qc={})),function(t){t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL"}(Wc||(Wc={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}($c||($c={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Yc||(Yc={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(Zc||(Zc={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(Kc||(Kc={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(Jc||(Jc={})),function(t){t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT"}(Qc||(Qc={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(tu||(tu={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(eu||(eu={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL"}(iu||(iu={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}(ru||(ru={})),function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT"}(nu||(nu={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(ou||(ou={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(su||(su={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}(au||(au={})),function(t){t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH"}(lu||(lu={})),function(t){t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"}(cu||(cu={}));var gu={parse:mu.parse,format:mu.format,resolve:mu.resolve};uu.RETINA_PREFIX=/@([0-9\.]+)x/,uu.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var _u,yu=!1;var vu={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function xu(t,e){return void 0===e&&(e=[]),e[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(255&t)/255,e}function bu(t){var e=t.toString(16);return"#"+(e="000000".substr(0,6-e.length)+e)}function wu(t){return"string"==typeof t&&"#"===(t=vu[t.toLowerCase()]||t)[0]&&(t=t.substr(1)),parseInt(t,16)}var Tu=function(){for(var t=[],e=[],i=0;i<32;i++)t[i]=i,e[i]=i;t[$c.NORMAL_NPM]=$c.NORMAL,t[$c.ADD_NPM]=$c.ADD,t[$c.SCREEN_NPM]=$c.SCREEN,e[$c.NORMAL]=$c.NORMAL_NPM,e[$c.ADD]=$c.ADD_NPM,e[$c.SCREEN]=$c.SCREEN_NPM;var r=[];return r.push(e),r.push(t),r}();function Eu(t,e){return Tu[e?1:0][t]}function Su(t,e){if(1===e)return(255*e<<24)+t;if(0===e)return 0;var i=t>>16&255,r=t>>8&255,n=255&t;return(255*e<<24)+((i=i*e+.5|0)<<16)+((r=r*e+.5|0)<<8)+(n=n*e+.5|0)}function Au(t,e,i,r){return(i=i||new Float32Array(4))[0]=(t>>16&255)/255,i[1]=(t>>8&255)/255,i[2]=(255&t)/255,(r||void 0===r)&&(i[0]*=e,i[1]*=e,i[2]*=e),i[3]=e,i}function Mu(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}Float32Array,Uint32Array,Int32Array,Uint8Array;function Iu(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1}function Cu(t){return!(t&t-1||!t)}function Pu(t){var e=(t>65535?1:0)<<4,i=((t>>>=e)>255?1:0)<<3;return e|=i,e|=i=((t>>>=i)>15?1:0)<<2,(e|=i=((t>>>=i)>3?1:0)<<1)|(t>>>=i)>>1}function Ru(t,e,i){var r,n=t.length;if(!(e>=n||0===i)){var o=n-(i=e+i>n?n-e:i);for(r=e;r<o;++r)t[r]=t[r+i];t.length=o}}function Ou(t){return 0===t?0:t<0?-1:1}var Du=0;function Lu(){return++Du}var ku={};function Bu(t,e,i){if(void 0===i&&(i=3),!ku[e]){var r=(new Error).stack;void 0===r?console.warn("PixiJS Deprecation Warning: ",e+"\nDeprecated since v"+t):(r=r.split("\n").splice(i).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",e+"\nDeprecated since v"+t),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",e+"\nDeprecated since v"+t),console.warn(r))),ku[e]=!0}}var Fu={},zu=Object.create(null),Nu=Object.create(null);var Uu=function(){function t(t,e,i){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=i||uu.RESOLUTION,this.resize(t,e)}return t.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.resize=function(t,e){this.canvas.width=Math.round(t*this.resolution),this.canvas.height=Math.round(e*this.resolution)},t.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(t.prototype,"width",{get:function(){return this.canvas.width},set:function(t){this.canvas.width=Math.round(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.canvas.height},set:function(t){this.canvas.height=Math.round(t)},enumerable:!1,configurable:!0}),t}();var Gu;function ju(t,e){var i=uu.RETINA_PREFIX.exec(t);return i?parseFloat(i[1]):void 0!==e?e:1}var Vu,Xu=2*Math.PI,Hu=180/Math.PI,qu=Math.PI/180;!function(t){t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC"}(Vu||(Vu={}));var Wu=function(){function t(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(r),this.type=Vu.RECT}return Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(t,"EMPTY",{get:function(){return new t(0,0,0,0)},enumerable:!1,configurable:!0}),t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},t.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},t.prototype.contains=function(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height)},t.prototype.pad=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this},t.prototype.fit=function(t){var e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),r=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=r,this.height=Math.max(n-r,0),this},t.prototype.ceil=function(t,e){void 0===t&&(t=1),void 0===e&&(e=.001);var i=Math.ceil((this.x+this.width-e)*t)/t,r=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=r-this.y,this},t.prototype.enlarge=function(t){var e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),r=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=r,this.height=n-r,this},t.prototype.toString=function(){return"[@pixi/math:Rectangle x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},t}(),$u=function(){function t(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.x=t,this.y=e,this.radius=i,this.type=Vu.CIRC}return t.prototype.clone=function(){return new t(this.x,this.y,this.radius)},t.prototype.contains=function(t,e){if(this.radius<=0)return!1;var i=this.radius*this.radius,r=this.x-t,n=this.y-e;return(r*=r)+(n*=n)<=i},t.prototype.getBounds=function(){return new Wu(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},t.prototype.toString=function(){return"[@pixi/math:Circle x="+this.x+" y="+this.y+" radius="+this.radius+"]"},t}(),Yu=function(){function t(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.x=t,this.y=e,this.width=i,this.height=r,this.type=Vu.ELIP}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=(t-this.x)/this.width,r=(e-this.y)/this.height;return(i*=i)+(r*=r)<=1},t.prototype.getBounds=function(){return new Wu(this.x-this.width,this.y-this.height,this.width,this.height)},t.prototype.toString=function(){return"[@pixi/math:Ellipse x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},t}(),Zu=function(){function t(){for(var t=arguments,e=[],i=0;i<arguments.length;i++)e[i]=t[i];var r=Array.isArray(e[0])?e[0]:e;if("number"!=typeof r[0]){for(var n=[],o=0,s=r.length;o<s;o++)n.push(r[o].x,r[o].y);r=n}this.points=r,this.type=Vu.POLY,this.closeStroke=!0}return t.prototype.clone=function(){var e=new t(this.points.slice());return e.closeStroke=this.closeStroke,e},t.prototype.contains=function(t,e){for(var i=!1,r=this.points.length/2,n=0,o=r-1;n<r;o=n++){var s=this.points[2*n],a=this.points[2*n+1],l=this.points[2*o],c=this.points[2*o+1];a>e!=c>e&&t<(e-a)/(c-a)*(l-s)+s&&(i=!i)}return i},t.prototype.toString=function(){return"[@pixi/math:PolygoncloseStroke="+this.closeStroke+"points="+this.points.reduce((function(t,e){return t+", "+e}),"")+"]"},t}(),Ku=function(){function t(t,e,i,r,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=20),this.x=t,this.y=e,this.width=i,this.height=r,this.radius=n,this.type=Vu.RREC}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height,this.radius)},t.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){if(e>=this.y+this.radius&&e<=this.y+this.height-this.radius||t>=this.x+this.radius&&t<=this.x+this.width-this.radius)return!0;var i=t-(this.x+this.radius),r=e-(this.y+this.radius),n=this.radius*this.radius;if(i*i+r*r<=n)return!0;if((i=t-(this.x+this.width-this.radius))*i+r*r<=n)return!0;if(i*i+(r=e-(this.y+this.height-this.radius))*r<=n)return!0;if((i=t-(this.x+this.radius))*i+r*r<=n)return!0}return!1},t.prototype.toString=function(){return"[@pixi/math:RoundedRectangle x="+this.x+" y="+this.y+"width="+this.width+" height="+this.height+" radius="+this.radius+"]"},t}(),Ju=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=0,this.y=0,this.x=t,this.y=e}return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copyFrom=function(t){return this.set(t.x,t.y),this},t.prototype.copyTo=function(t){return t.set(this.x,this.y),t},t.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},t.prototype.set=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e,this},t.prototype.toString=function(){return"[@pixi/math:Point x="+this.x+" y="+this.y+"]"},t}(),Qu=function(){function t(t,e,i,r){void 0===i&&(i=0),void 0===r&&(r=0),this._x=i,this._y=r,this.cb=t,this.scope=e}return t.prototype.clone=function(e,i){return void 0===e&&(e=this.cb),void 0===i&&(i=this.scope),new t(e,i,this._x,this._y)},t.prototype.set=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this._x===t&&this._y===e||(this._x=t,this._y=e,this.cb.call(this.scope)),this},t.prototype.copyFrom=function(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this},t.prototype.copyTo=function(t){return t.set(this._x,this._y),t},t.prototype.equals=function(t){return t.x===this._x&&t.y===this._y},t.prototype.toString=function(){return"[@pixi/math:ObservablePoint x=0 y=0 scope="+this.scope+"]"},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),t}(),th=function(){function t(t,e,i,r,n,o){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===n&&(n=0),void 0===o&&(o=0),this.array=null,this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=o}return t.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},t.prototype.set=function(t,e,i,r,n,o){return this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=o,this},t.prototype.toArray=function(t,e){this.array||(this.array=new Float32Array(9));var i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i},t.prototype.apply=function(t,e){e=e||new Ju;var i=t.x,r=t.y;return e.x=this.a*i+this.c*r+this.tx,e.y=this.b*i+this.d*r+this.ty,e},t.prototype.applyInverse=function(t,e){e=e||new Ju;var i=1/(this.a*this.d+this.c*-this.b),r=t.x,n=t.y;return e.x=this.d*i*r+-this.c*i*n+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*n+-this.b*i*r+(-this.ty*this.a+this.tx*this.b)*i,e},t.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},t.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},t.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),r=this.a,n=this.c,o=this.tx;return this.a=r*e-this.b*i,this.b=r*i+this.b*e,this.c=n*e-this.d*i,this.d=n*i+this.d*e,this.tx=o*e-this.ty*i,this.ty=o*i+this.ty*e,this},t.prototype.append=function(t){var e=this.a,i=this.b,r=this.c,n=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*i+t.b*n,this.c=t.c*e+t.d*r,this.d=t.c*i+t.d*n,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*i+t.ty*n+this.ty,this},t.prototype.setTransform=function(t,e,i,r,n,o,s,a,l){return this.a=Math.cos(s+l)*n,this.b=Math.sin(s+l)*n,this.c=-Math.sin(s-a)*o,this.d=Math.cos(s-a)*o,this.tx=t-(i*this.a+r*this.c),this.ty=e-(i*this.b+r*this.d),this},t.prototype.prepend=function(t){var e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var i=this.a,r=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},t.prototype.decompose=function(t){var e=this.a,i=this.b,r=this.c,n=this.d,o=t.pivot,s=-Math.atan2(-r,n),a=Math.atan2(i,e),l=Math.abs(s+a);return l<1e-5||Math.abs(Xu-l)<1e-5?(t.rotation=a,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=s,t.skew.y=a),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(r*r+n*n),t.position.x=this.tx+(o.x*e+o.y*r),t.position.y=this.ty+(o.x*i+o.y*n),t},t.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,r=this.d,n=this.tx,o=t*r-e*i;return this.a=r/o,this.b=-e/o,this.c=-i/o,this.d=t/o,this.tx=(i*this.ty-r*n)/o,this.ty=-(t*this.ty-e*n)/o,this},t.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},t.prototype.clone=function(){var e=new t;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},t.prototype.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},t.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},t.prototype.toString=function(){return"[@pixi/math:Matrix a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+"]"},Object.defineProperty(t,"IDENTITY",{get:function(){return new t},enumerable:!1,configurable:!0}),Object.defineProperty(t,"TEMP_MATRIX",{get:function(){return new t},enumerable:!1,configurable:!0}),t}(),eh=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],ih=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],rh=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],nh=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],oh=[],sh=[],ah=Math.sign;!function(){for(var t=0;t<16;t++){var e=[];oh.push(e);for(var i=0;i<16;i++)for(var r=ah(eh[t]*eh[i]+rh[t]*ih[i]),n=ah(ih[t]*eh[i]+nh[t]*ih[i]),o=ah(eh[t]*rh[i]+rh[t]*nh[i]),s=ah(ih[t]*rh[i]+nh[t]*nh[i]),a=0;a<16;a++)if(eh[a]===r&&ih[a]===n&&rh[a]===o&&nh[a]===s){e.push(a);break}}for(t=0;t<16;t++){var l=new th;l.set(eh[t],ih[t],rh[t],nh[t],0,0),sh.push(l)}}();var lh={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(t){return eh[t]},uY:function(t){return ih[t]},vX:function(t){return rh[t]},vY:function(t){return nh[t]},inv:function(t){return 8&t?15&t:7&-t},add:function(t,e){return oh[t][e]},sub:function(t,e){return oh[t][lh.inv(e)]},rotate180:function(t){return 4^t},isVertical:function(t){return 2==(3&t)},byDirection:function(t,e){return 2*Math.abs(t)<=Math.abs(e)?e>=0?lh.S:lh.N:2*Math.abs(e)<=Math.abs(t)?t>0?lh.E:lh.W:e>0?t>0?lh.SE:lh.SW:t>0?lh.NE:lh.NW},matrixAppendRotationInv:function(t,e,i,r){void 0===i&&(i=0),void 0===r&&(r=0);var n=sh[lh.inv(e)];n.tx=i,n.ty=r,t.append(n)}},ch=function(){function t(){this.worldTransform=new th,this.localTransform=new th,this.position=new Qu(this.onChange,this,0,0),this.scale=new Qu(this.onChange,this,1,1),this.pivot=new Qu(this.onChange,this,0,0),this.skew=new Qu(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}return t.prototype.onChange=function(){this._localID++},t.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},t.prototype.toString=function(){return"[@pixi/math:Transform position=("+this.position.x+", "+this.position.y+") rotation="+this.rotation+" scale=("+this.scale.x+", "+this.scale.y+") skew=("+this.skew.x+", "+this.skew.y+") ]"},t.prototype.updateLocalTransform=function(){var t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)},t.prototype.updateTransform=function(t){var e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){var i=t.worldTransform,r=this.worldTransform;r.a=e.a*i.a+e.b*i.c,r.b=e.a*i.b+e.b*i.d,r.c=e.c*i.a+e.d*i.c,r.d=e.c*i.b+e.d*i.d,r.tx=e.tx*i.a+e.ty*i.c+i.tx,r.ty=e.tx*i.b+e.ty*i.d+i.ty,this._parentID=t._worldID,this._worldID++}},t.prototype.setFromMatrix=function(t){t.decompose(this),this._localID++},Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())},enumerable:!1,configurable:!0}),t.IDENTITY=new t,t}();uu.SORTABLE_CHILDREN=!1;var uh=function(){function t(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}return t.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},t.prototype.clear=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},t.prototype.getRectangle=function(t){return this.minX>this.maxX||this.minY>this.maxY?Wu.EMPTY:((t=t||new Wu(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)},t.prototype.addPoint=function(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)},t.prototype.addPointMatrix=function(t,e){var i=t.a,r=t.b,n=t.c,o=t.d,s=t.tx,a=t.ty,l=i*e.x+n*e.y+s,c=r*e.x+o*e.y+a;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,c),this.maxY=Math.max(this.maxY,c)},t.prototype.addQuad=function(t){var e=this.minX,i=this.minY,r=this.maxX,n=this.maxY,o=t[0],s=t[1];e=o<e?o:e,i=s<i?s:i,r=o>r?o:r,n=s>n?s:n,e=(o=t[2])<e?o:e,i=(s=t[3])<i?s:i,r=o>r?o:r,n=s>n?s:n,e=(o=t[4])<e?o:e,i=(s=t[5])<i?s:i,r=o>r?o:r,n=s>n?s:n,e=(o=t[6])<e?o:e,i=(s=t[7])<i?s:i,r=o>r?o:r,n=s>n?s:n,this.minX=e,this.minY=i,this.maxX=r,this.maxY=n},t.prototype.addFrame=function(t,e,i,r,n){this.addFrameMatrix(t.worldTransform,e,i,r,n)},t.prototype.addFrameMatrix=function(t,e,i,r,n){var o=t.a,s=t.b,a=t.c,l=t.d,c=t.tx,u=t.ty,h=this.minX,d=this.minY,p=this.maxX,f=this.maxY,m=o*e+a*i+c,g=s*e+l*i+u;h=m<h?m:h,d=g<d?g:d,p=m>p?m:p,f=g>f?g:f,h=(m=o*r+a*i+c)<h?m:h,d=(g=s*r+l*i+u)<d?g:d,p=m>p?m:p,f=g>f?g:f,h=(m=o*e+a*n+c)<h?m:h,d=(g=s*e+l*n+u)<d?g:d,p=m>p?m:p,f=g>f?g:f,h=(m=o*r+a*n+c)<h?m:h,d=(g=s*r+l*n+u)<d?g:d,p=m>p?m:p,f=g>f?g:f,this.minX=h,this.minY=d,this.maxX=p,this.maxY=f},t.prototype.addVertexData=function(t,e,i){for(var r=this.minX,n=this.minY,o=this.maxX,s=this.maxY,a=e;a<i;a+=2){var l=t[a],c=t[a+1];r=l<r?l:r,n=c<n?c:n,o=l>o?l:o,s=c>s?c:s}this.minX=r,this.minY=n,this.maxX=o,this.maxY=s},t.prototype.addVertices=function(t,e,i,r){this.addVerticesMatrix(t.worldTransform,e,i,r)},t.prototype.addVerticesMatrix=function(t,e,i,r,n,o){void 0===n&&(n=0),void 0===o&&(o=n);for(var s=t.a,a=t.b,l=t.c,c=t.d,u=t.tx,h=t.ty,d=this.minX,p=this.minY,f=this.maxX,m=this.maxY,g=i;g<r;g+=2){var _=e[g],y=e[g+1],v=s*_+l*y+u,x=c*y+a*_+h;d=Math.min(d,v-n),f=Math.max(f,v+n),p=Math.min(p,x-o),m=Math.max(m,x+o)}this.minX=d,this.minY=p,this.maxX=f,this.maxY=m},t.prototype.addBounds=function(t){var e=this.minX,i=this.minY,r=this.maxX,n=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>r?t.maxX:r,this.maxY=t.maxY>n?t.maxY:n},t.prototype.addBoundsMask=function(t,e){var i=t.minX>e.minX?t.minX:e.minX,r=t.minY>e.minY?t.minY:e.minY,n=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(i<=n&&r<=o){var s=this.minX,a=this.minY,l=this.maxX,c=this.maxY;this.minX=i<s?i:s,this.minY=r<a?r:a,this.maxX=n>l?n:l,this.maxY=o>c?o:c}},t.prototype.addBoundsMatrix=function(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)},t.prototype.addBoundsArea=function(t,e){var i=t.minX>e.x?t.minX:e.x,r=t.minY>e.y?t.minY:e.y,n=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(i<=n&&r<=o){var s=this.minX,a=this.minY,l=this.maxX,c=this.maxY;this.minX=i<s?i:s,this.minY=r<a?r:a,this.maxX=n>l?n:l,this.maxY=o>c?o:c}},t.prototype.pad=function(t,e){void 0===t&&(t=0),void 0===e&&(e=t),this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)},t.prototype.addFramePad=function(t,e,i,r,n,o){t-=n,e-=o,i+=n,r+=o,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>r?this.maxY:r},t}(),hh=function(t,e){return(hh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function dh(t,e){function i(){this.constructor=t}hh(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var ph=function(t){function e(){var e=t.call(this)||this;return e.tempDisplayObjectParent=null,e.transform=new ch,e.alpha=1,e.visible=!0,e.renderable=!0,e.parent=null,e.worldAlpha=1,e._lastSortedIndex=0,e._zIndex=0,e.filterArea=null,e.filters=null,e._enabledFilters=null,e._bounds=new uh,e._localBounds=null,e._boundsID=0,e._boundsRect=null,e._localBoundsRect=null,e._mask=null,e._destroyed=!1,e.isSprite=!1,e.isMask=!1,e}return dh(e,t),e.mixin=function(t){for(var i=Object.keys(t),r=0;r<i.length;++r){var n=i[r];Object.defineProperty(e.prototype,n,Object.getOwnPropertyDescriptor(t,n))}},Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),e.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},e.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha},e.prototype.getBounds=function(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Wu),e=this._boundsRect),this._bounds.getRectangle(e)},e.prototype.getLocalBounds=function(t){t||(this._localBoundsRect||(this._localBoundsRect=new Wu),t=this._localBoundsRect),this._localBounds||(this._localBounds=new uh);var e=this.transform,i=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;var r=this._bounds,n=this._boundsID;this._bounds=this._localBounds;var o=this.getBounds(!1,t);return this.parent=i,this.transform=e,this._bounds=r,this._bounds.updateID+=this._boundsID-n,o},e.prototype.toGlobal=function(t,e,i){return void 0===i&&(i=!1),i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)},e.prototype.toLocal=function(t,e,i,r){return e&&(t=e.toGlobal(t,i,r)),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)},e.prototype.setParent=function(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t},e.prototype.setTransform=function(t,e,i,r,n,o,s,a,l){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=1),void 0===r&&(r=1),void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===l&&(l=0),this.position.x=t,this.position.y=e,this.scale.x=i||1,this.scale.y=r||1,this.rotation=n,this.skew.x=o,this.skew.y=s,this.pivot.x=a,this.pivot.y=l,this},e.prototype.destroy=function(t){this.parent&&this.parent.removeChild(this),this.emit("destroyed"),this.removeAllListeners(),this.transform=null,this.parent=null,this._bounds=null,this._mask=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this._destroyed=!0},Object.defineProperty(e.prototype,"_tempDisplayObjectParent",{get:function(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new fh),this.tempDisplayObjectParent},enumerable:!1,configurable:!0}),e.prototype.enableTempParent=function(){var t=this.parent;return this.parent=this._tempDisplayObjectParent,t},e.prototype.disableTempParent=function(t){this.parent=t},Object.defineProperty(e.prototype,"x",{get:function(){return this.position.x},set:function(t){this.transform.position.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.position.y},set:function(t){this.transform.position.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldTransform",{get:function(){return this.transform.worldTransform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localTransform",{get:function(){return this.transform.localTransform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.transform.position},set:function(t){this.transform.position.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this.transform.scale},set:function(t){this.transform.scale.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pivot",{get:function(){return this.transform.pivot},set:function(t){this.transform.pivot.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skew",{get:function(){return this.transform.skew},set:function(t){this.transform.skew.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(t){this.transform.rotation=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this.transform.rotation*Hu},set:function(t){this.transform.rotation=t*qu},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zIndex",{get:function(){return this._zIndex},set:function(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldVisible",{get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(t){var e;this._mask&&((e=this._mask.maskObject||this._mask).renderable=!0,e.isMask=!1);(this._mask=t,this._mask)&&((e=this._mask.maskObject||this._mask).renderable=!1,e.isMask=!0)},enumerable:!1,configurable:!0}),e}(du.a),fh=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sortDirty=null,e}return dh(e,t),e}(ph);function mh(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}ph.prototype.displayObjectUpdateTransform=ph.prototype.updateTransform;var gh=function(t){function e(){var e=t.call(this)||this;return e.children=[],e.sortableChildren=uu.SORTABLE_CHILDREN,e.sortDirty=!1,e}return dh(e,t),e.prototype.onChildrenChange=function(t){},e.prototype.addChild=function(){for(var t=arguments,e=[],i=0;i<arguments.length;i++)e[i]=t[i];if(e.length>1)for(var r=0;r<e.length;r++)this.addChild(e[r]);else{var n=e[0];n.parent&&n.parent.removeChild(n),n.parent=this,this.sortDirty=!0,n.transform._parentID=-1,this.children.push(n),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",n,this,this.children.length-1),n.emit("added",this)}return e[0]},e.prototype.addChildAt=function(t,e){if(e<0||e>this.children.length)throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t},e.prototype.swapChildren=function(t,e){if(t!==e){var i=this.getChildIndex(t),r=this.getChildIndex(e);this.children[i]=e,this.children[r]=t,this.onChildrenChange(i<r?i:r)}},e.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},e.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The index "+e+" supplied is out of bounds "+this.children.length);var i=this.getChildIndex(t);Ru(this.children,i,1),this.children.splice(e,0,t),this.onChildrenChange(e)},e.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Index ("+t+") does not exist.");return this.children[t]},e.prototype.removeChild=function(){for(var t=arguments,e=[],i=0;i<arguments.length;i++)e[i]=t[i];if(e.length>1)for(var r=0;r<e.length;r++)this.removeChild(e[r]);else{var n=e[0],o=this.children.indexOf(n);if(-1===o)return null;n.parent=null,n.transform._parentID=-1,Ru(this.children,o,1),this._boundsID++,this.onChildrenChange(o),n.emit("removed",this),this.emit("childRemoved",n,this,o)}return e[0]},e.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,Ru(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e},e.prototype.removeChildren=function(t,e){void 0===t&&(t=0),void 0===e&&(e=this.children.length);var i,r=t,n=e-r;if(n>0&&n<=e){i=this.children.splice(r,n);for(var o=0;o<i.length;++o)i[o].parent=null,i[o].transform&&(i[o].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(o=0;o<i.length;++o)i[o].emit("removed",this),this.emit("childRemoved",i[o],this,o);return i}if(0===n&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},e.prototype.sortChildren=function(){for(var t=!1,e=0,i=this.children.length;e<i;++e){var r=this.children[e];r._lastSortedIndex=e,t||0===r.zIndex||(t=!0)}t&&this.children.length>1&&this.children.sort(mh),this.sortDirty=!1},e.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var t=0,e=this.children.length;t<e;++t){var i=this.children[t];i.visible&&i.updateTransform()}},e.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){var i=e._mask.maskObject||e._mask;i.calculateBounds(),this._bounds.addBoundsMask(e._bounds,i._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID},e.prototype.getLocalBounds=function(e,i){void 0===i&&(i=!1);var r=t.prototype.getLocalBounds.call(this,e);if(!i)for(var n=0,o=this.children.length;n<o;++n){var s=this.children[n];s.visible&&s.updateTransform()}return r},e.prototype._calculateBounds=function(){},e.prototype.render=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(t);else{this._render(t);for(var e=0,i=this.children.length;e<i;++e)this.children[e].render(t)}},e.prototype.renderAdvanced=function(t){t.batch.flush();var e=this.filters,i=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var r=0;r<e.length;r++)e[r].enabled&&this._enabledFilters.push(e[r]);this._enabledFilters.length&&t.filter.push(this,this._enabledFilters)}i&&t.mask.push(this,this._mask),this._render(t);r=0;for(var n=this.children.length;r<n;r++)this.children[r].render(t);t.batch.flush(),i&&t.mask.pop(this),e&&this._enabledFilters&&this._enabledFilters.length&&t.filter.pop()},e.prototype._render=function(t){},e.prototype.destroy=function(e){t.prototype.destroy.call(this),this.sortDirty=!1;var i="boolean"==typeof e?e:e&&e.children,r=this.removeChildren(0,this.children.length);if(i)for(var n=0;n<r.length;++n)r[n].destroy(e)},Object.defineProperty(e.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t},enumerable:!1,configurable:!0}),e}(ph);gh.prototype.containerUpdateTransform=gh.prototype.updateTransform;ph.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1});var _h,yh=function(){function t(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(Xc.tablet||Xc.phone)&&this.createTouchHook();var e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2..toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),self.addEventListener("keydown",this._onKeyDown,!1)}return Object.defineProperty(t.prototype,"isActive",{get:function(){return this._isActive},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isMobileAccessibility",{get:function(){return this._isMobileAccessibility},enumerable:!1,configurable:!0}),t.prototype.createTouchHook=function(){var t=this,e=document.createElement("button");e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.style.zIndex=2..toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",(function(){t._isMobileAccessibility=!0,t.activate(),t.destroyTouchHook()})),document.body.appendChild(e),this._hookDiv=e},t.prototype.destroyTouchHook=function(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)},t.prototype.activate=function(){var t;this._isActive||(this._isActive=!0,self.document.addEventListener("mousemove",this._onMouseMove,!0),self.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),null===(t=this.renderer.view.parentNode)||void 0===t||t.appendChild(this.div))},t.prototype.deactivate=function(){var t;this._isActive&&!this._isMobileAccessibility&&(this._isActive=!1,self.document.removeEventListener("mousemove",this._onMouseMove,!0),self.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),null===(t=this.div.parentNode)||void 0===t||t.removeChild(this.div))},t.prototype.updateAccessibleObjects=function(t){if(t.visible&&t.accessibleChildren){t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);for(var e=t.children,i=0;i<e.length;i++)this.updateAccessibleObjects(e[i])}},t.prototype.update=function(){var t=performance.now();if(!(Xc.android.device&&t<this.androidUpdateCount)&&(this.androidUpdateCount=t+this.androidUpdateFrequency,this.renderer.renderingToScreen)){this.renderer._lastObjectRendered&&this.updateAccessibleObjects(this.renderer._lastObjectRendered);var e=this.renderer.view.getBoundingClientRect(),i=e.left,r=e.top,n=e.width,o=e.height,s=this.renderer,a=s.width,l=s.height,c=s.resolution,u=n/a*c,h=o/l*c,d=this.div;d.style.left=i+"px",d.style.top=r+"px",d.style.width=a+"px",d.style.height=l+"px";for(var p=0;p<this.children.length;p++){var f=this.children[p];if(f.renderId!==this.renderId)f._accessibleActive=!1,Ru(this.children,p,1),this.div.removeChild(f._accessibleDiv),this.pool.push(f._accessibleDiv),f._accessibleDiv=null,p--;else{d=f._accessibleDiv;var m=f.hitArea,g=f.worldTransform;f.hitArea?(d.style.left=(g.tx+m.x*g.a)*u+"px",d.style.top=(g.ty+m.y*g.d)*h+"px",d.style.width=m.width*g.a*u+"px",d.style.height=m.height*g.d*h+"px"):(m=f.getBounds(),this.capHitArea(m),d.style.left=m.x*u+"px",d.style.top=m.y*h+"px",d.style.width=m.width*u+"px",d.style.height=m.height*h+"px",d.title!==f.accessibleTitle&&null!==f.accessibleTitle&&(d.title=f.accessibleTitle),d.getAttribute("aria-label")!==f.accessibleHint&&null!==f.accessibleHint&&d.setAttribute("aria-label",f.accessibleHint)),f.accessibleTitle===d.title&&f.tabIndex===d.tabIndex||(d.title=f.accessibleTitle,d.tabIndex=f.tabIndex,this.debug&&this.updateDebugHTML(d))}}this.renderId++}},t.prototype.updateDebugHTML=function(t){t.innerHTML="type: "+t.type+"</br> title : "+t.title+"</br> tabIndex: "+t.tabIndex},t.prototype.capHitArea=function(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);var e=this.renderer,i=e.width,r=e.height;t.x+t.width>i&&(t.width=i-t.x),t.y+t.height>r&&(t.height=r-t.y)},t.prototype.addChild=function(t){var e=this.pool.pop();e||((e=document.createElement("button")).style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2..toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().indexOf("chrome")>-1?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleHint&&null!==t.accessibleHint||(e.title="displayObject "+t.tabIndex),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex},t.prototype._onClick=function(t){var e=this.renderer.plugins.interaction,i=t.target.displayObject,r=e.eventData;e.dispatchEvent(i,"click",r),e.dispatchEvent(i,"pointertap",r),e.dispatchEvent(i,"tap",r)},t.prototype._onFocus=function(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive");var e=this.renderer.plugins.interaction,i=t.target.displayObject,r=e.eventData;e.dispatchEvent(i,"mouseover",r)},t.prototype._onFocusOut=function(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite");var e=this.renderer.plugins.interaction,i=t.target.displayObject,r=e.eventData;e.dispatchEvent(i,"mouseout",r)},t.prototype._onKeyDown=function(t){9===t.keyCode&&this.activate()},t.prototype._onMouseMove=function(t){0===t.movementX&&0===t.movementY||this.deactivate()},t.prototype.destroy=function(){this.destroyTouchHook(),this.div=null,self.document.removeEventListener("mousemove",this._onMouseMove,!0),self.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},t}();uu.TARGET_FPMS=.06,function(t){t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY"}(_h||(_h={}));var vh=function(){function t(t,e,i,r){void 0===e&&(e=null),void 0===i&&(i=0),void 0===r&&(r=!1),this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=r}return t.prototype.match=function(t,e){return void 0===e&&(e=null),this.fn===t&&this.context===e},t.prototype.emit=function(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e},t.prototype.connect=function(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this},t.prototype.destroy=function(t){void 0===t&&(t=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var e=this.next;return this.next=t?null:e,this.previous=null,e},t}(),xh=function(){function t(){var t=this;this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new vh(null,null,1/0),this.deltaMS=1/uu.TARGET_FPMS,this.elapsedMS=1/uu.TARGET_FPMS,this._tick=function(e){t._requestId=null,t.started&&(t.update(e),t.started&&null===t._requestId&&t._head.next&&(t._requestId=requestAnimationFrame(t._tick)))}}return t.prototype._requestIfNeeded=function(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},t.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},t.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},t.prototype.add=function(t,e,i){return void 0===i&&(i=_h.NORMAL),this._addListener(new vh(t,e,i))},t.prototype.addOnce=function(t,e,i){return void 0===i&&(i=_h.NORMAL),this._addListener(new vh(t,e,i,!0))},t.prototype._addListener=function(t){var e=this._head.next,i=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}else t.connect(i);return this._startIfPossible(),this},t.prototype.remove=function(t,e){for(var i=this._head.next;i;)i=i.match(t,e)?i.destroy():i.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(t.prototype,"count",{get:function(){if(!this._head)return 0;for(var t=0,e=this._head;e=e.next;)t++;return t},enumerable:!1,configurable:!0}),t.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},t.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},t.prototype.destroy=function(){if(!this._protected){this.stop();for(var t=this._head.next;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}},t.prototype.update=function(t){var e;if(void 0===t&&(t=performance.now()),t>this.lastTime){if((e=this.elapsedMS=t-this.lastTime)>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){var i=t-this._lastFrame|0;if(i<this._minElapsedMS)return;this._lastFrame=t-i%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*uu.TARGET_FPMS;for(var r=this._head,n=r.next;n;)n=n.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t},Object.defineProperty(t.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(t){var e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,uu.TARGET_FPMS);this._maxElapsedMS=1/i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(t){if(0===t)this._minElapsedMS=0;else{var e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"shared",{get:function(){if(!t._shared){var e=t._shared=new t;e.autoStart=!0,e._protected=!0}return t._shared},enumerable:!1,configurable:!0}),Object.defineProperty(t,"system",{get:function(){if(!t._system){var e=t._system=new t;e.autoStart=!0,e._protected=!0}return t._system},enumerable:!1,configurable:!0}),t}(),bh=function(){function t(){}return t.init=function(t){var e=this;t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set:function(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,_h.LOW)},get:function(){return this._ticker}}),this.stop=function(){e._ticker.stop()},this.start=function(){e._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?xh.shared:new xh,t.autoStart&&this.start()},t.destroy=function(){if(this._ticker){var t=this._ticker;this.ticker=null,t.destroy()}},t}(),wh=function(){function t(){this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0,this.global=new Ju,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return Object.defineProperty(t.prototype,"pointerId",{get:function(){return this.identifier},enumerable:!1,configurable:!0}),t.prototype.getLocalPosition=function(t,e,i){return t.worldTransform.applyInverse(i||this.global,e)},t.prototype.copyEvent=function(t){"isPrimary"in t&&t.isPrimary&&(this.isPrimary=!0),this.button="button"in t&&t.button;var e="buttons"in t&&t.buttons;this.buttons=Number.isInteger(e)?e:"which"in t&&t.which,this.width="width"in t&&t.width,this.height="height"in t&&t.height,this.tiltX="tiltX"in t&&t.tiltX,this.tiltY="tiltY"in t&&t.tiltY,this.pointerType="pointerType"in t&&t.pointerType,this.pressure="pressure"in t&&t.pressure,this.rotationAngle="rotationAngle"in t&&t.rotationAngle,this.twist="twist"in t&&t.twist||0,this.tangentialPressure="tangentialPressure"in t&&t.tangentialPressure||0},t.prototype.reset=function(){this.isPrimary=!1},t}(),Th=function(t,e){return(Th=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};var Eh=function(){function t(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return t.prototype.stopPropagation=function(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},t.prototype.reset=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null},t}(),Sh=function(){function t(e){this._pointerId=e,this._flags=t.FLAGS.NONE}return t.prototype._doSet=function(t,e){this._flags=e?this._flags|t:this._flags&~t},Object.defineProperty(t.prototype,"pointerId",{get:function(){return this._pointerId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"flags",{get:function(){return this._flags},set:function(t){this._flags=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"none",{get:function(){return this._flags===t.FLAGS.NONE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"over",{get:function(){return 0!=(this._flags&t.FLAGS.OVER)},set:function(e){this._doSet(t.FLAGS.OVER,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightDown",{get:function(){return 0!=(this._flags&t.FLAGS.RIGHT_DOWN)},set:function(e){this._doSet(t.FLAGS.RIGHT_DOWN,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftDown",{get:function(){return 0!=(this._flags&t.FLAGS.LEFT_DOWN)},set:function(e){this._doSet(t.FLAGS.LEFT_DOWN,e)},enumerable:!1,configurable:!0}),t.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4}),t}(),Ah=function(){function t(){this._tempPoint=new Ju}return t.prototype.recursiveFindHit=function(t,e,i,r,n){if(!e||!e.visible)return!1;var o=t.data.global,s=!1,a=n=e.interactive||n,l=!0;if(e.hitArea?(r&&(e.worldTransform.applyInverse(o,this._tempPoint),e.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?s=!0:(r=!1,l=!1)),a=!1):e._mask&&r&&(e._mask.containsPoint&&e._mask.containsPoint(o)||(r=!1)),l&&e.interactiveChildren&&e.children)for(var c=e.children,u=c.length-1;u>=0;u--){var h=c[u],d=this.recursiveFindHit(t,h,i,r,a);if(d){if(!h.parent)continue;a=!1,d&&(t.target&&(r=!1),s=!0)}}return n&&(r&&!t.target&&!e.hitArea&&e.containsPoint&&e.containsPoint(o)&&(s=!0),e.interactive&&(s&&!t.target&&(t.target=e),i&&i(t,e,!!s))),s},t.prototype.findHit=function(t,e,i,r){this.recursiveFindHit(t,e,i,r,!1)},t}(),Mh={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return"pointer"===this.cursor},set buttonMode(t){t?this.cursor="pointer":"pointer"===this.cursor&&(this.cursor=null)},cursor:null,get trackedPointers(){return void 0===this._trackedPointers&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};ph.mixin(Mh);var Ih={target:null,data:{global:null}},Ch=function(t){function e(e,i){var r=t.call(this)||this;return i=i||{},r.renderer=e,r.autoPreventDefault=void 0===i.autoPreventDefault||i.autoPreventDefault,r.interactionFrequency=i.interactionFrequency||10,r.mouse=new wh,r.mouse.identifier=1,r.mouse.global.set(-999999),r.activeInteractionData={},r.activeInteractionData[1]=r.mouse,r.interactionDataPool=[],r.eventData=new Eh,r.interactionDOMElement=null,r.moveWhenInside=!1,r.eventsAdded=!1,r.tickerAdded=!1,r.mouseOverRenderer=!("PointerEvent"in self),r.supportsTouchEvents="ontouchstart"in self,r.supportsPointerEvents=!!self.PointerEvent,r.onPointerUp=r.onPointerUp.bind(r),r.processPointerUp=r.processPointerUp.bind(r),r.onPointerCancel=r.onPointerCancel.bind(r),r.processPointerCancel=r.processPointerCancel.bind(r),r.onPointerDown=r.onPointerDown.bind(r),r.processPointerDown=r.processPointerDown.bind(r),r.onPointerMove=r.onPointerMove.bind(r),r.processPointerMove=r.processPointerMove.bind(r),r.onPointerOut=r.onPointerOut.bind(r),r.processPointerOverOut=r.processPointerOverOut.bind(r),r.onPointerOver=r.onPointerOver.bind(r),r.cursorStyles={default:"inherit",pointer:"pointer"},r.currentCursorMode=null,r.cursor=null,r.resolution=1,r.delayedEvents=[],r.search=new Ah,r._tempDisplayObject=new fh,r._eventListenerOptions={capture:!0,passive:!1},r._useSystemTicker=void 0===i.useSystemTicker||i.useSystemTicker,r.setTargetElement(r.renderer.view,r.renderer.resolution),r}return function(t,e){function i(){this.constructor=t}Th(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),Object.defineProperty(e.prototype,"useSystemTicker",{get:function(){return this._useSystemTicker},set:function(t){this._useSystemTicker=t,t?this.addTickerListener():this.removeTickerListener()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastObjectRendered",{get:function(){return this.renderer._lastObjectRendered||this._tempDisplayObject},enumerable:!1,configurable:!0}),e.prototype.hitTest=function(t,e){return Ih.target=null,Ih.data.global=t,e||(e=this.lastObjectRendered),this.processInteractive(Ih,e,null,!0),Ih.target},e.prototype.setTargetElement=function(t,e){void 0===e&&(e=1),this.removeTickerListener(),this.removeEvents(),this.interactionDOMElement=t,this.resolution=e,this.addEvents(),this.addTickerListener()},e.prototype.addTickerListener=function(){!this.tickerAdded&&this.interactionDOMElement&&this._useSystemTicker&&(xh.system.add(this.tickerUpdate,this,_h.INTERACTION),this.tickerAdded=!0)},e.prototype.removeTickerListener=function(){this.tickerAdded&&(xh.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)},e.prototype.addEvents=function(){if(!this.eventsAdded&&this.interactionDOMElement){var t=this.interactionDOMElement.style;self.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none"),this.supportsPointerEvents?(self.document.addEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),self.addEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),self.addEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(self.document.addEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),self.addEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.eventsAdded=!0}},e.prototype.removeEvents=function(){if(this.eventsAdded&&this.interactionDOMElement){var t=this.interactionDOMElement.style;self.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(self.document.removeEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),self.removeEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),self.removeEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(self.document.removeEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),self.removeEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.interactionDOMElement=null,this.eventsAdded=!1}},e.prototype.tickerUpdate=function(t){this._deltaTime+=t,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this.update())},e.prototype.update=function(){if(this.interactionDOMElement)if(this._didMove)this._didMove=!1;else{for(var t in this.cursor=null,this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(t)){var e=this.activeInteractionData[t];if(e.originalEvent&&"touch"!==e.pointerType){var i=this.configureInteractionEventForDOMEvent(this.eventData,e.originalEvent,e);this.processInteractive(i,this.lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},e.prototype.setCursorMode=function(t){t=t||"default";var e=!0;if(self.OffscreenCanvas&&this.interactionDOMElement instanceof OffscreenCanvas&&(e=!1),this.currentCursorMode!==t){this.currentCursorMode=t;var i=this.cursorStyles[t];if(i)switch(typeof i){case"string":e&&(this.interactionDOMElement.style.cursor=i);break;case"function":i(t);break;case"object":e&&Object.assign(this.interactionDOMElement.style,i)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.interactionDOMElement.style.cursor=t)}},e.prototype.dispatchEvent=function(t,e,i){i.stopPropagationHint&&t!==i.stopsPropagatingAt||(i.currentTarget=t,i.type=e,t.emit(e,i),t[e]&&t[e](i))},e.prototype.delayDispatchEvent=function(t,e,i){this.delayedEvents.push({displayObject:t,eventString:e,eventData:i})},e.prototype.mapPositionToPoint=function(t,e,i){var r;r=this.interactionDOMElement.parentElement?this.interactionDOMElement.getBoundingClientRect():{x:0,y:0,width:this.interactionDOMElement.width,height:this.interactionDOMElement.height,left:0,top:0};var n=1/this.resolution;t.x=(e-r.left)*(this.interactionDOMElement.width/r.width)*n,t.y=(i-r.top)*(this.interactionDOMElement.height/r.height)*n},e.prototype.processInteractive=function(t,e,i,r){var n=this.search.findHit(t,e,i,r),o=this.delayedEvents;if(!o.length)return n;t.stopPropagationHint=!1;var s=o.length;this.delayedEvents=[];for(var a=0;a<s;a++){var l=o[a],c=l.displayObject,u=l.eventString,h=l.eventData;h.stopsPropagatingAt===c&&(h.stopPropagationHint=!0),this.dispatchEvent(c,u,h)}return n},e.prototype.onPointerDown=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);if(this.autoPreventDefault&&e[0].isNormalized)(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(var i=e.length,r=0;r<i;r++){var n=e[r],o=this.getInteractionDataForPointerId(n),s=this.configureInteractionEventForDOMEvent(this.eventData,n,o);if(s.data.originalEvent=t,this.processInteractive(s,this.lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",s),"touch"===n.pointerType)this.emit("touchstart",s);else if("mouse"===n.pointerType||"pen"===n.pointerType){var a=2===n.button;this.emit(a?"rightdown":"mousedown",this.eventData)}}}},e.prototype.processPointerDown=function(t,e,i){var r=t.data,n=t.data.identifier;if(i)if(e.trackedPointers[n]||(e.trackedPointers[n]=new Sh(n)),this.dispatchEvent(e,"pointerdown",t),"touch"===r.pointerType)this.dispatchEvent(e,"touchstart",t);else if("mouse"===r.pointerType||"pen"===r.pointerType){var o=2===r.button;o?e.trackedPointers[n].rightDown=!0:e.trackedPointers[n].leftDown=!0,this.dispatchEvent(e,o?"rightdown":"mousedown",t)}},e.prototype.onPointerComplete=function(t,e,i){for(var r=this.normalizeToPointerData(t),n=r.length,o=t.target!==this.interactionDOMElement?"outside":"",s=0;s<n;s++){var a=r[s],l=this.getInteractionDataForPointerId(a),c=this.configureInteractionEventForDOMEvent(this.eventData,a,l);if(c.data.originalEvent=t,this.processInteractive(c,this.lastObjectRendered,i,e||!o),this.emit(e?"pointercancel":"pointerup"+o,c),"mouse"===a.pointerType||"pen"===a.pointerType){var u=2===a.button;this.emit(u?"rightup"+o:"mouseup"+o,c)}else"touch"===a.pointerType&&(this.emit(e?"touchcancel":"touchend"+o,c),this.releaseInteractionDataForPointerId(a.pointerId))}},e.prototype.onPointerCancel=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!0,this.processPointerCancel)},e.prototype.processPointerCancel=function(t,e){var i=t.data,r=t.data.identifier;void 0!==e.trackedPointers[r]&&(delete e.trackedPointers[r],this.dispatchEvent(e,"pointercancel",t),"touch"===i.pointerType&&this.dispatchEvent(e,"touchcancel",t))},e.prototype.onPointerUp=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!1,this.processPointerUp)},e.prototype.processPointerUp=function(t,e,i){var r=t.data,n=t.data.identifier,o=e.trackedPointers[n],s="touch"===r.pointerType,a="mouse"===r.pointerType||"pen"===r.pointerType,l=!1;if(a){var c=2===r.button,u=Sh.FLAGS,h=c?u.RIGHT_DOWN:u.LEFT_DOWN,d=void 0!==o&&o.flags&h;i?(this.dispatchEvent(e,c?"rightup":"mouseup",t),d&&(this.dispatchEvent(e,c?"rightclick":"click",t),l=!0)):d&&this.dispatchEvent(e,c?"rightupoutside":"mouseupoutside",t),o&&(c?o.rightDown=!1:o.leftDown=!1)}i?(this.dispatchEvent(e,"pointerup",t),s&&this.dispatchEvent(e,"touchend",t),o&&(a&&!l||this.dispatchEvent(e,"pointertap",t),s&&(this.dispatchEvent(e,"tap",t),o.over=!1))):o&&(this.dispatchEvent(e,"pointerupoutside",t),s&&this.dispatchEvent(e,"touchendoutside",t)),o&&o.none&&delete e.trackedPointers[n]},e.prototype.onPointerMove=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);"mouse"!==e[0].pointerType&&"pen"!==e[0].pointerType||(this._didMove=!0,this.cursor=null);for(var i=e.length,r=0;r<i;r++){var n=e[r],o=this.getInteractionDataForPointerId(n),s=this.configureInteractionEventForDOMEvent(this.eventData,n,o);s.data.originalEvent=t,this.processInteractive(s,this.lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",s),"touch"===n.pointerType&&this.emit("touchmove",s),"mouse"!==n.pointerType&&"pen"!==n.pointerType||this.emit("mousemove",s)}"mouse"===e[0].pointerType&&this.setCursorMode(this.cursor)}},e.prototype.processPointerMove=function(t,e,i){var r=t.data,n="touch"===r.pointerType,o="mouse"===r.pointerType||"pen"===r.pointerType;o&&this.processPointerOverOut(t,e,i),this.moveWhenInside&&!i||(this.dispatchEvent(e,"pointermove",t),n&&this.dispatchEvent(e,"touchmove",t),o&&this.dispatchEvent(e,"mousemove",t))},e.prototype.onPointerOut=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t)[0];"mouse"===e.pointerType&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var i=this.getInteractionDataForPointerId(e),r=this.configureInteractionEventForDOMEvent(this.eventData,e,i);r.data.originalEvent=e,this.processInteractive(r,this.lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",r),"mouse"===e.pointerType||"pen"===e.pointerType?this.emit("mouseout",r):this.releaseInteractionDataForPointerId(i.identifier)}},e.prototype.processPointerOverOut=function(t,e,i){var r=t.data,n=t.data.identifier,o="mouse"===r.pointerType||"pen"===r.pointerType,s=e.trackedPointers[n];i&&!s&&(s=e.trackedPointers[n]=new Sh(n)),void 0!==s&&(i&&this.mouseOverRenderer?(s.over||(s.over=!0,this.delayDispatchEvent(e,"pointerover",t),o&&this.delayDispatchEvent(e,"mouseover",t)),o&&null===this.cursor&&(this.cursor=e.cursor)):s.over&&(s.over=!1,this.dispatchEvent(e,"pointerout",this.eventData),o&&this.dispatchEvent(e,"mouseout",t),s.none&&delete e.trackedPointers[n]))},e.prototype.onPointerOver=function(t){var e=this.normalizeToPointerData(t)[0],i=this.getInteractionDataForPointerId(e),r=this.configureInteractionEventForDOMEvent(this.eventData,e,i);r.data.originalEvent=e,"mouse"===e.pointerType&&(this.mouseOverRenderer=!0),this.emit("pointerover",r),"mouse"!==e.pointerType&&"pen"!==e.pointerType||this.emit("mouseover",r)},e.prototype.getInteractionDataForPointerId=function(t){var e,i=t.pointerId;return 1===i||"mouse"===t.pointerType?e=this.mouse:this.activeInteractionData[i]?e=this.activeInteractionData[i]:((e=this.interactionDataPool.pop()||new wh).identifier=i,this.activeInteractionData[i]=e),e.copyEvent(t),e},e.prototype.releaseInteractionDataForPointerId=function(t){var e=this.activeInteractionData[t];e&&(delete this.activeInteractionData[t],e.reset(),this.interactionDataPool.push(e))},e.prototype.configureInteractionEventForDOMEvent=function(t,e,i){return t.data=i,this.mapPositionToPoint(i.global,e.clientX,e.clientY),"touch"===e.pointerType&&(e.globalX=i.global.x,e.globalY=i.global.y),i.originalEvent=e,t.reset(),t},e.prototype.normalizeToPointerData=function(t){var e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(var i=0,r=t.changedTouches.length;i<r;i++){var n=t.changedTouches[i];void 0===n.button&&(n.button=t.touches.length?1:0),void 0===n.buttons&&(n.buttons=t.touches.length?1:0),void 0===n.isPrimary&&(n.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===n.width&&(n.width=n.radiusX||1),void 0===n.height&&(n.height=n.radiusY||1),void 0===n.tiltX&&(n.tiltX=0),void 0===n.tiltY&&(n.tiltY=0),void 0===n.pointerType&&(n.pointerType="touch"),void 0===n.pointerId&&(n.pointerId=n.identifier||0),void 0===n.pressure&&(n.pressure=n.force||.5),void 0===n.twist&&(n.twist=0),void 0===n.tangentialPressure&&(n.tangentialPressure=0),void 0===n.layerX&&(n.layerX=n.offsetX=n.clientX),void 0===n.layerY&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,e.push(n)}else if(self.MouseEvent&&(!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof self.PointerEvent))e.push(t);else{var o=t;void 0===o.isPrimary&&(o.isPrimary=!0),void 0===o.width&&(o.width=1),void 0===o.height&&(o.height=1),void 0===o.tiltX&&(o.tiltX=0),void 0===o.tiltY&&(o.tiltY=0),void 0===o.pointerType&&(o.pointerType="mouse"),void 0===o.pointerId&&(o.pointerId=1),void 0===o.pressure&&(o.pressure=.5),void 0===o.twist&&(o.twist=0),void 0===o.tangentialPressure&&(o.tangentialPressure=0),o.isNormalized=!0,e.push(o)}return e},e.prototype.destroy=function(){this.removeEvents(),this.removeTickerListener(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this.search=null},e}(du.a),Ph=function(){function t(t){this.items=[],this._name=t,this._aliasCount=0}return t.prototype.emit=function(t,e,i,r,n,o,s,a){if(arguments.length>8)throw new Error("max arguments reached");var l=this,c=l.name,u=l.items;this._aliasCount++;for(var h=0,d=u.length;h<d;h++)u[h][c](t,e,i,r,n,o,s,a);return u===this.items&&this._aliasCount--,this},t.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},t.prototype.add=function(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this},t.prototype.remove=function(t){var e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this},t.prototype.contains=function(t){return-1!==this.items.indexOf(t)},t.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},t.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.items.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),t}();Object.defineProperties(Ph.prototype,{dispatch:{value:Ph.prototype.emit},run:{value:Ph.prototype.emit}}),uu.PREFER_ENV=Xc.any?Hc.WEBGL:Hc.WEBGL2,uu.STRICT_TEXTURE_CACHE=!1;var Rh=[];function Oh(t,e){if(!t)return null;var i="";if("string"==typeof t){var r=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);r&&(i=r[1].toLowerCase())}for(var n=Rh.length-1;n>=0;--n){var o=Rh[n];if(o.test&&o.test(t,i))return new o(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}var Dh=function(t,e){return(Dh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function Lh(t,e){function i(){this.constructor=t}Dh(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var kh=function(){return(kh=Object.assign||function(t){for(var e,i=arguments,r=1,n=arguments.length;r<n;r++)for(var o in e=i[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};var Bh=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Ph("setRealSize"),this.onUpdate=new Ph("update"),this.onError=new Ph("onError")}return t.prototype.bind=function(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},t.prototype.unbind=function(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)},t.prototype.resize=function(t,e){t===this._width&&e===this._height||(this._width=t,this._height=e,this.onResize.emit(t,e))},Object.defineProperty(t.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),t.prototype.update=function(){this.destroyed||this.onUpdate.emit()},t.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),t.prototype.style=function(t,e,i){return!1},t.prototype.dispose=function(){},t.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},t.test=function(t,e){return!1},t}(),Fh=function(t){function e(e,i){var r=this,n=i||{},o=n.width,s=n.height;if(!o||!s)throw new Error("BufferResource width or height invalid");return(r=t.call(this,o,s)||this).data=e,r}return Lh(e,t),e.prototype.upload=function(t,e,i){var r=t.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===ru.UNPACK);var n=e.realWidth,o=e.realHeight;return i.width===n&&i.height===o?r.texSubImage2D(e.target,0,0,0,n,o,e.format,i.type,this.data):(i.width=n,i.height=o,r.texImage2D(e.target,0,i.internalFormat,n,o,0,e.format,i.type,this.data)),!0},e.prototype.dispose=function(){this.data=null},e.test=function(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array},e}(Bh),zh={scaleMode:tu.NEAREST,format:Zc.RGBA,alphaMode:ru.NPM},Nh=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null);var r=t.call(this)||this,n=(i=i||{}).alphaMode,o=i.mipmap,s=i.anisotropicLevel,a=i.scaleMode,l=i.width,c=i.height,u=i.wrapMode,h=i.format,d=i.type,p=i.target,f=i.resolution,m=i.resourceOptions;return!e||e instanceof Bh||((e=Oh(e,m)).internal=!0),r.resolution=f||uu.RESOLUTION,r.width=Math.round((l||0)*r.resolution)/r.resolution,r.height=Math.round((c||0)*r.resolution)/r.resolution,r._mipmap=void 0!==o?o:uu.MIPMAP_TEXTURES,r.anisotropicLevel=void 0!==s?s:uu.ANISOTROPIC_LEVEL,r._wrapMode=u||uu.WRAP_MODE,r._scaleMode=void 0!==a?a:uu.SCALE_MODE,r.format=h||Zc.RGBA,r.type=d||Jc.UNSIGNED_BYTE,r.target=p||Kc.TEXTURE_2D,r.alphaMode=void 0!==n?n:ru.UNPACK,r.uid=Lu(),r.touched=0,r.isPowerOfTwo=!1,r._refreshPOT(),r._glTextures={},r.dirtyId=0,r.dirtyStyleId=0,r.cacheId=null,r.valid=l>0&&c>0,r.textureCacheIds=[],r.destroyed=!1,r.resource=null,r._batchEnabled=0,r._batchLocation=0,r.parentTextureArray=null,r.setResource(e),r}return Lh(e,t),Object.defineProperty(e.prototype,"realWidth",{get:function(){return Math.round(this.width*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"realHeight",{get:function(){return Math.round(this.height*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mipmap",{get:function(){return this._mipmap},set:function(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wrapMode",{get:function(){return this._wrapMode},set:function(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),e.prototype.setStyle=function(t,e){var i;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,i=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,i=!0),i&&this.dirtyStyleId++,this},e.prototype.setSize=function(t,e,i){return i=i||this.resolution,this.setRealSize(t*i,e*i,i)},e.prototype.setRealSize=function(t,e,i){return this.resolution=i||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this},e.prototype._refreshPOT=function(){this.isPowerOfTwo=Cu(this.realWidth)&&Cu(this.realHeight)},e.prototype.setResolution=function(t){var e=this.resolution;return e===t||(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT()),this},e.prototype.setResource=function(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this},e.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},e.prototype.onError=function(t){this.emit("error",this,t)},e.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Nu[this.cacheId],delete zu[this.cacheId],this.cacheId=null),this.dispose(),e.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},e.prototype.dispose=function(){this.emit("dispose",this)},e.prototype.castToBaseTexture=function(){return this},e.from=function(t,i,r){void 0===r&&(r=uu.STRICT_TEXTURE_CACHE);var n="string"==typeof t,o=null;if(n)o=t;else{if(!t._pixiId){var s=i&&i.pixiIdPrefix||"pixiid";t._pixiId=s+"_"+Lu()}o=t._pixiId}var a=Nu[o];if(n&&r&&!a)throw new Error('The cacheId "'+o+'" does not exist in BaseTextureCache.');return a||((a=new e(t,i)).cacheId=o,e.addToCache(a,o)),a},e.fromBuffer=function(t,i,r,n){t=t||new Float32Array(i*r*4);var o=new Fh(t,{width:i,height:r}),s=t instanceof Float32Array?Jc.FLOAT:Jc.UNSIGNED_BYTE;return new e(o,Object.assign(zh,n||{width:i,height:r,type:s}))},e.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),Nu[e]&&console.warn("BaseTexture added to the cache with an id ["+e+"] that already had an entry"),Nu[e]=t)},e.removeFromCache=function(t){if("string"==typeof t){var e=Nu[t];if(e){var i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete Nu[t],e}}else if(t&&t.textureCacheIds){for(var r=0;r<t.textureCacheIds.length;++r)delete Nu[t.textureCacheIds[r]];return t.textureCacheIds.length=0,t}return null},e._globalBatch=0,e}(du.a),Uh=function(t){function e(e,i){var r=this,n=i||{},o=n.width,s=n.height;(r=t.call(this,o,s)||this).items=[],r.itemDirtyIds=[];for(var a=0;a<e;a++){var l=new Nh;r.items.push(l),r.itemDirtyIds.push(-2)}return r.length=e,r._load=null,r.baseTexture=null,r}return Lh(e,t),e.prototype.initFromArray=function(t,e){for(var i=0;i<this.length;i++)t[i]&&(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof Bh?this.addResourceAt(t[i],i):this.addResourceAt(Oh(t[i],e),i))},e.prototype.dispose=function(){for(var t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},e.prototype.addResourceAt=function(t,e){if(!this.items[e])throw new Error("Index "+e+" is out of bounds");return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this},e.prototype.bind=function(e){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");t.prototype.bind.call(this,e);for(var i=0;i<this.length;i++)this.items[i].parentTextureArray=e,this.items[i].on("update",e.update,e)},e.prototype.unbind=function(e){t.prototype.unbind.call(this,e);for(var i=0;i<this.length;i++)this.items[i].parentTextureArray=null,this.items[i].off("update",e.update,e)},e.prototype.load=function(){var t=this;if(this._load)return this._load;var e=this.items.map((function(t){return t.resource})).filter((function(t){return t})).map((function(t){return t.load()}));return this._load=Promise.all(e).then((function(){var e=t.items[0],i=e.realWidth,r=e.realHeight;return t.resize(i,r),Promise.resolve(t)})),this._load},e}(Bh),Gh=function(t){function e(e,i){var r,n,o=this,s=i||{},a=s.width,l=s.height;return Array.isArray(e)?(r=e,n=e.length):n=e,o=t.call(this,n,{width:a,height:l})||this,r&&o.initFromArray(r,i),o}return Lh(e,t),e.prototype.addBaseTextureAt=function(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this},e.prototype.bind=function(e){t.prototype.bind.call(this,e),e.target=Kc.TEXTURE_2D_ARRAY},e.prototype.upload=function(t,e,i){var r=this.length,n=this.itemDirtyIds,o=this.items,s=t.gl;i.dirtyId<0&&s.texImage3D(s.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,r,0,e.format,i.type,null);for(var a=0;a<r;a++){var l=o[a];n[a]<l.dirtyId&&(n[a]=l.dirtyId,l.valid&&s.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,a,l.resource.width,l.resource.height,1,e.format,i.type,l.resource.source))}return!0},e}(Uh),jh=function(t){function e(e){var i=this,r=e,n=r.naturalWidth||r.videoWidth||r.width,o=r.naturalHeight||r.videoHeight||r.height;return(i=t.call(this,n,o)||this).source=e,i.noSubImage=!1,i}return Lh(e,t),e.crossOrigin=function(t,e,i){void 0===i&&0!==e.indexOf("data:")?t.crossOrigin=function(t,e){if(void 0===e&&(e=self.location),0===t.indexOf("data:"))return"";e=e||self.location,Gu||(Gu=document.createElement("a")),Gu.href=t;var i=gu.parse(Gu.href),r=!i.port&&""===e.port||i.port===e.port;return i.hostname===e.hostname&&r&&i.protocol===e.protocol?"":"anonymous"}(e):!1!==i&&(t.crossOrigin="string"==typeof i?i:"anonymous")},e.prototype.upload=function(t,e,i,r){var n=t.gl,o=e.realWidth,s=e.realHeight;return r=r||this.source,n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===ru.UNPACK),this.noSubImage||e.target!==n.TEXTURE_2D||i.width!==o||i.height!==s?(i.width=o,i.height=s,n.texImage2D(e.target,0,i.internalFormat,e.format,i.type,r)):n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.format,i.type,r),!0},e.prototype.update=function(){if(!this.destroyed){var e=this.source,i=e.naturalWidth||e.videoWidth||e.width,r=e.naturalHeight||e.videoHeight||e.height;this.resize(i,r),t.prototype.update.call(this)}},e.prototype.dispose=function(){this.source=null},e}(Bh),Vh=function(t){function e(e){return t.call(this,e)||this}return Lh(e,t),e.test=function(t){var e=self.OffscreenCanvas;return!!(e&&t instanceof e)||self.HTMLCanvasElement&&t instanceof HTMLCanvasElement},e}(jh),Xh=function(t){function e(i,r){var n=this,o=r||{},s=o.width,a=o.height,l=o.autoLoad,c=o.linkBaseTexture;if(i&&i.length!==e.SIDES)throw new Error("Invalid length. Got "+i.length+", expected 6");n=t.call(this,6,{width:s,height:a})||this;for(var u=0;u<e.SIDES;u++)n.items[u].target=Kc.TEXTURE_CUBE_MAP_POSITIVE_X+u;return n.linkBaseTexture=!1!==c,i&&n.initFromArray(i,r),!1!==l&&n.load(),n}return Lh(e,t),e.prototype.bind=function(e){t.prototype.bind.call(this,e),e.target=Kc.TEXTURE_CUBE_MAP},e.prototype.addBaseTextureAt=function(t,e,i){if(void 0===i&&(i=this.linkBaseTexture),!this.items[e])throw new Error("Index "+e+" is out of bounds");if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0){if(!t.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(t.resource,e)}else t.target=Kc.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this},e.prototype.upload=function(t,i,r){for(var n=this.itemDirtyIds,o=0;o<e.SIDES;o++){var s=this.items[o];n[o]<s.dirtyId&&(s.valid&&s.resource?(s.resource.upload(t,s,r),n[o]=s.dirtyId):n[o]<-1&&(t.gl.texImage2D(s.target,0,r.internalFormat,i.realWidth,i.realHeight,0,i.format,r.type,null),n[o]=-1))}return!0},e.test=function(t){return Array.isArray(t)&&t.length===e.SIDES},e.SIDES=6,e}(Uh),Hh=function(t){function e(e,i){var r=this;if(i=i||{},!(e instanceof HTMLImageElement)){var n=new Image;jh.crossOrigin(n,e,i.crossorigin),n.src=e,e=n}return r=t.call(this,e)||this,!e.complete&&r._width&&r._height&&(r._width=0,r._height=0),r.url=e.src,r._process=null,r.preserveBitmap=!1,r.createBitmap=(void 0!==i.createBitmap?i.createBitmap:uu.CREATE_IMAGE_BITMAP)&&!!self.createImageBitmap,r.alphaMode="number"==typeof i.alphaMode?i.alphaMode:null,r.bitmap=null,r._load=null,!1!==i.autoLoad&&r.load(),r}return Lh(e,t),e.prototype.load=function(t){var e=this;return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise((function(t,i){var r=e.source;e.url=r.src;var n=function(){e.destroyed||(r.onload=null,r.onerror=null,e.resize(r.width,r.height),e._load=null,e.createBitmap?t(e.process()):t(e))};r.complete&&r.src?n():(r.onload=n,r.onerror=function(t){i(t),e.onError.emit(t)})}))),this._load},e.prototype.process=function(){var t=this,e=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!self.createImageBitmap)return Promise.resolve(this);var i=self.createImageBitmap,r=!e.crossOrigin||"anonymous"===e.crossOrigin;return this._process=fetch(e.src,{mode:r?"cors":"no-cors"}).then((function(t){return t.blob()})).then((function(r){return i(r,0,0,e.width,e.height,{premultiplyAlpha:t.alphaMode===ru.UNPACK?"premultiply":"none"})})).then((function(e){return t.destroyed?Promise.reject():(t.bitmap=e,t.update(),t._process=null,Promise.resolve(t))})),this._process},e.prototype.upload=function(e,i,r){if("number"==typeof this.alphaMode&&(i.alphaMode=this.alphaMode),!this.createBitmap)return t.prototype.upload.call(this,e,i,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(t.prototype.upload.call(this,e,i,r,this.bitmap),!this.preserveBitmap){var n=!0,o=i._glTextures;for(var s in o){var a=o[s];if(a!==r&&a.dirtyId!==i.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},e.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,t.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},e.test=function(t){return"string"==typeof t||t instanceof HTMLImageElement},e}(jh),qh=function(t){function e(e,i){var r=this;return i=i||{},(r=t.call(this,document.createElement("canvas"))||this)._width=0,r._height=0,r.svg=e,r.scale=i.scale||1,r._overrideWidth=i.width,r._overrideHeight=i.height,r._resolve=null,r._crossorigin=i.crossorigin,r._load=null,!1!==i.autoLoad&&r.load(),r}return Lh(e,t),e.prototype.load=function(){var t=this;return this._load||(this._load=new Promise((function(e){if(t._resolve=function(){t.resize(t.source.width,t.source.height),e(t)},/^\<svg/.test(t.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");t.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t.svg)))}t._loadSvg()}))),this._load},e.prototype._loadSvg=function(){var t=this,e=new Image;jh.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=function(i){t._resolve&&(e.onerror=null,t.onError.emit(i))},e.onload=function(){if(t._resolve){var i=e.width,r=e.height;if(!i||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var n=i*t.scale,o=r*t.scale;(t._overrideWidth||t._overrideHeight)&&(n=t._overrideWidth||t._overrideHeight/r*i,o=t._overrideHeight||t._overrideWidth/i*r),n=Math.round(n),o=Math.round(o);var s=t.source;s.width=n,s.height=o,s._pixiId="canvas_"+Lu(),s.getContext("2d").drawImage(e,0,0,i,r,0,0,n,o),t._resolve(),t._resolve=null}}},e.getSize=function(t){var i=e.SVG_SIZE.exec(t),r={};return i&&(r[i[1]]=Math.round(parseFloat(i[3])),r[i[5]]=Math.round(parseFloat(i[7]))),r},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},e.test=function(t,i){return"svg"===i||"string"==typeof t&&/^data:image\/svg\+xml(;(charset=utf8|utf8))?;base64/.test(t)||"string"==typeof t&&e.SVG_XML.test(t)},e.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,e.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,e}(jh),Wh=function(t){function e(i,r){var n=this;if(r=r||{},!(i instanceof HTMLVideoElement)){var o=document.createElement("video");o.setAttribute("preload","auto"),o.setAttribute("webkit-playsinline",""),o.setAttribute("playsinline",""),"string"==typeof i&&(i=[i]);var s=i[0].src||i[0];jh.crossOrigin(o,s,r.crossorigin);for(var a=0;a<i.length;++a){var l=document.createElement("source"),c=i[a],u=c.src,h=c.mime,d=(u=u||i[a]).split("?").shift().toLowerCase(),p=d.substr(d.lastIndexOf(".")+1);h=h||e.MIME_TYPES[p]||"video/"+p,l.src=u,l.type=h,o.appendChild(l)}i=o}return(n=t.call(this,i)||this).noSubImage=!0,n._autoUpdate=!0,n._isConnectedToTicker=!1,n._updateFPS=r.updateFPS||0,n._msToNextUpdate=0,n.autoPlay=!1!==r.autoPlay,n._load=null,n._resolve=null,n._onCanPlay=n._onCanPlay.bind(n),n._onError=n._onError.bind(n),!1!==r.autoLoad&&n.load(),n}return Lh(e,t),e.prototype.update=function(e){if(!this.destroyed){var i=xh.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-i),(!this._updateFPS||this._msToNextUpdate<=0)&&(t.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},e.prototype.load=function(){var t=this;if(this._load)return this._load;var e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart.bind(this)),e.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise((function(i){t.valid?i(t):(t._resolve=i,e.load())})),this._load},e.prototype._onError=function(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)},e.prototype._isSourcePlaying=function(){var t=this.source;return t.currentTime>0&&!1===t.paused&&!1===t.ended&&t.readyState>2},e.prototype._isSourceReady=function(){var t=this.source;return 3===t.readyState||4===t.readyState},e.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(xh.shared.add(this.update,this),this._isConnectedToTicker=!0)},e.prototype._onPlayStop=function(){this._isConnectedToTicker&&(xh.shared.remove(this.update,this),this._isConnectedToTicker=!1)},e.prototype._onCanPlay=function(){var t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);var e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()},e.prototype.dispose=function(){this._isConnectedToTicker&&(xh.shared.remove(this.update,this),this._isConnectedToTicker=!1);var e=this.source;e&&(e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),t.prototype.dispose.call(this)},Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(xh.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(xh.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(t){t!==this._updateFPS&&(this._updateFPS=t)},enumerable:!1,configurable:!0}),e.test=function(t,i){return self.HTMLVideoElement&&t instanceof HTMLVideoElement||e.TYPES.indexOf(i)>-1},e.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],e.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},e}(jh),$h=function(t){function e(e){return t.call(this,e)||this}return Lh(e,t),e.test=function(t){return!!self.createImageBitmap&&t instanceof ImageBitmap},e}(jh);Rh.push(Hh,$h,Vh,Wh,qh,Fh,Xh,Gh);var Yh={__proto__:null,Resource:Bh,BaseImageResource:jh,INSTALLED:Rh,autoDetectResource:Oh,AbstractMultiResource:Uh,ArrayResource:Gh,BufferResource:Fh,CanvasResource:Vh,CubeResource:Xh,ImageResource:Hh,SVGResource:qh,VideoResource:Wh,ImageBitmapResource:$h},Zh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Lh(e,t),e.prototype.upload=function(t,e,i){var r=t.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===ru.UNPACK);var n=e.realWidth,o=e.realHeight;return i.width===n&&i.height===o?r.texSubImage2D(e.target,0,0,0,n,o,e.format,i.type,this.data):(i.width=n,i.height=o,r.texImage2D(e.target,0,i.internalFormat,n,o,0,e.format,i.type,this.data)),!0},e}(Fh),Kh=function(){function t(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Ph("disposeFramebuffer"),this.multisample=lu.NONE}return Object.defineProperty(t.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),t.prototype.addColorTexture=function(t,e){return void 0===t&&(t=0),this.colorTextures[t]=e||new Nh(null,{scaleMode:tu.NEAREST,resolution:1,mipmap:iu.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},t.prototype.addDepthTexture=function(t){return this.depthTexture=t||new Nh(new Zh(null,{width:this.width,height:this.height}),{scaleMode:tu.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:iu.OFF,format:Zc.DEPTH_COMPONENT,type:Jc.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},t.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},t.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},t.prototype.resize=function(t,e){if(t=Math.round(t),e=Math.round(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(var i=0;i<this.colorTextures.length;i++){var r=this.colorTextures[i],n=r.resolution;r.setSize(t/n,e/n)}if(this.depthTexture){n=this.depthTexture.resolution;this.depthTexture.setSize(t/n,e/n)}}},t.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},t.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},t}(),Jh=function(t){function e(e){var i=this;if("number"==typeof e){var r=arguments[0],n=arguments[1],o=arguments[2],s=arguments[3];e={width:r,height:n,scaleMode:o,resolution:s}}return e.width=e.width||100,e.height=e.height||100,e.multisample=void 0!==e.multisample?e.multisample:lu.NONE,(i=t.call(this,null,e)||this).mipmap=iu.OFF,i.valid=!0,i.clearColor=[0,0,0,0],i.framebuffer=new Kh(i.realWidth,i.realHeight).addColorTexture(0,i),i.framebuffer.multisample=e.multisample,i.maskStack=[],i.filterStack=[{}],i}return Lh(e,t),e.prototype.resize=function(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)},e.prototype.dispose=function(){this.framebuffer.dispose(),t.prototype.dispose.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},e}(Nh),Qh=function(){function t(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}return t.prototype.set=function(t,e,i){var r=e.width,n=e.height;if(i){var o=t.width/2/r,s=t.height/2/n,a=t.x/r+o,l=t.y/n+s;i=lh.add(i,lh.NW),this.x0=a+o*lh.uX(i),this.y0=l+s*lh.uY(i),i=lh.add(i,2),this.x1=a+o*lh.uX(i),this.y1=l+s*lh.uY(i),i=lh.add(i,2),this.x2=a+o*lh.uX(i),this.y2=l+s*lh.uY(i),i=lh.add(i,2),this.x3=a+o*lh.uX(i),this.y3=l+s*lh.uY(i)}else this.x0=t.x/r,this.y0=t.y/n,this.x1=(t.x+t.width)/r,this.y1=t.y/n,this.x2=(t.x+t.width)/r,this.y2=(t.y+t.height)/n,this.x3=t.x/r,this.y3=(t.y+t.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},t.prototype.toString=function(){return"[@pixi/core:TextureUvs x0="+this.x0+" y0="+this.y0+" x1="+this.x1+" y1="+this.y1+" x2="+this.x2+" y2="+this.y2+" x3="+this.x3+" y3="+this.y3+"]"},t}(),td=new Qh,ed=function(t){function e(i,r,n,o,s,a){var l=t.call(this)||this;if(l.noFrame=!1,r||(l.noFrame=!0,r=new Wu(0,0,1,1)),i instanceof e&&(i=i.baseTexture),l.baseTexture=i,l._frame=r,l.trim=o,l.valid=!1,l._uvs=td,l.uvMatrix=null,l.orig=n||r,l._rotate=Number(s||0),!0===s)l._rotate=2;else if(l._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return l.defaultAnchor=a?new Ju(a.x,a.y):new Ju(0,0),l._updateID=0,l.textureCacheIds=[],i.valid?l.noFrame?i.valid&&l.onBaseTextureUpdated(i):l.frame=r:i.once("loaded",l.onBaseTextureUpdated,l),l.noFrame&&i.on("update",l.onBaseTextureUpdated,l),l}return Lh(e,t),e.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},e.prototype.onBaseTextureUpdated=function(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},e.prototype.destroy=function(t){if(this.baseTexture){if(t){var i=this.baseTexture.resource;i&&i.url&&zu[i.url]&&e.removeFromCache(i.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,e.removeFromCache(this),this.textureCacheIds=null},e.prototype.clone=function(){var t=this._frame.clone(),i=this._frame===this.orig?t:this.orig.clone(),r=new e(this.baseTexture,!this.noFrame&&t,i,this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(r._frame=t),r},e.prototype.updateUvs=function(){this._uvs===td&&(this._uvs=new Qh),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},e.from=function(t,i,r){void 0===i&&(i={}),void 0===r&&(r=uu.STRICT_TEXTURE_CACHE);var n="string"==typeof t,o=null;if(n)o=t;else{if(!t._pixiId){var s=i&&i.pixiIdPrefix||"pixiid";t._pixiId=s+"_"+Lu()}o=t._pixiId}var a=zu[o];if(n&&r&&!a)throw new Error('The cacheId "'+o+'" does not exist in TextureCache.');return a||(i.resolution||(i.resolution=ju(t)),(a=new e(new Nh(t,i))).baseTexture.cacheId=o,Nh.addToCache(a.baseTexture,o),e.addToCache(a,o)),a},e.fromURL=function(t,i){var r=Object.assign({autoLoad:!1},null==i?void 0:i.resourceOptions),n=e.from(t,Object.assign({resourceOptions:r},i),!1),o=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):o.load().then((function(){return Promise.resolve(n)}))},e.fromBuffer=function(t,i,r,n){return new e(Nh.fromBuffer(t,i,r,n))},e.fromLoader=function(t,i,r,n){var o=new Nh(t,Object.assign({scaleMode:uu.SCALE_MODE,resolution:ju(i)},n)),s=o.resource;s instanceof Hh&&(s.url=i);var a=new e(o);return r||(r=i),Nh.addToCache(a.baseTexture,r),e.addToCache(a,r),r!==i&&(Nh.addToCache(a.baseTexture,i),e.addToCache(a,i)),a.baseTexture.valid?Promise.resolve(a):new Promise((function(t){a.baseTexture.once("loaded",(function(){return t(a)}))}))},e.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),zu[e]&&console.warn("Texture added to the cache with an id ["+e+"] that already had an entry"),zu[e]=t)},e.removeFromCache=function(t){if("string"==typeof t){var e=zu[t];if(e){var i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete zu[t],e}}else if(t&&t.textureCacheIds){for(var r=0;r<t.textureCacheIds.length;++r)zu[t.textureCacheIds[r]]===t&&delete zu[t.textureCacheIds[r]];return t.textureCacheIds.length=0,t}return null},Object.defineProperty(e.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frame",{get:function(){return this._frame},set:function(t){this._frame=t,this.noFrame=!1;var e=t.x,i=t.y,r=t.width,n=t.height,o=e+r>this.baseTexture.width,s=i+n>this.baseTexture.height;if(o||s){var a=o&&s?"and":"or",l="X: "+e+" + "+r+" = "+(e+r)+" > "+this.baseTexture.width,c="Y: "+i+" + "+n+" = "+(i+n)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+l+" "+a+" "+c)}this.valid=r&&n&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=t),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotate",{get:function(){return this._rotate},set:function(t){this._rotate=t,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),e.prototype.castToBaseTexture=function(){return this.baseTexture},e}(du.a);function id(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}ed.EMPTY=new ed(new Nh),id(ed.EMPTY),id(ed.EMPTY.baseTexture),ed.WHITE=function(){var t=document.createElement("canvas");t.width=16,t.height=16;var e=t.getContext("2d");return e.fillStyle="white",e.fillRect(0,0,16,16),new ed(new Nh(new Vh(t)))}(),id(ed.WHITE),id(ed.WHITE.baseTexture);var rd=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.valid=!0,r.filterFrame=null,r.filterPoolKey=null,r.updateUvs(),r}return Lh(e,t),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"multisample",{get:function(){return this.framebuffer.multisample},set:function(t){this.framebuffer.multisample=t},enumerable:!1,configurable:!0}),e.prototype.resize=function(t,e,i){void 0===i&&(i=!0);var r=this.baseTexture.resolution,n=Math.round(t*r)/r,o=Math.round(e*r)/r;this.valid=n>0&&o>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=o,i&&this.baseTexture.resize(n,o),this.updateUvs()},e.prototype.setResolution=function(t){var e=this.baseTexture;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))},e.create=function(t){for(var i=arguments,r=[],n=1;n<arguments.length;n++)r[n-1]=i[n];return"number"==typeof t&&(Bu("6.0.0","Arguments (width, height, scaleMode, resolution) have been deprecated."),t={width:t,height:r[0],scaleMode:r[1],resolution:r[2]}),new e(new Jh(t))},e}(ed),nd=function(){function t(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}return t.prototype.createTexture=function(t,e,i){void 0===i&&(i=lu.NONE);var r=new Jh(Object.assign({width:t,height:e,resolution:1,multisample:i},this.textureOptions));return new rd(r)},t.prototype.getOptimalTexture=function(t,e,i,r){var n;void 0===i&&(i=1),void 0===r&&(r=lu.NONE),t=Math.ceil(t*i),e=Math.ceil(e*i),this.enableFullScreen&&t===this._pixelsWidth&&e===this._pixelsHeight?n=r>1?-r:-1:(n=((65535&(t=Iu(t)))<<16|65535&(e=Iu(e)))>>>0,r>1&&(n+=4294967296*r)),this.texturePool[n]||(this.texturePool[n]=[]);var o=this.texturePool[n].pop();return o||(o=this.createTexture(t,e,r)),o.filterPoolKey=n,o.setResolution(i),o},t.prototype.getFilterTexture=function(t,e,i){var r=this.getOptimalTexture(t.width,t.height,e||t.resolution,i||lu.NONE);return r.filterFrame=t.filterFrame,r},t.prototype.returnTexture=function(t){var e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)},t.prototype.returnFilterTexture=function(t){this.returnTexture(t)},t.prototype.clear=function(t){if(t=!1!==t)for(var e in this.texturePool){var i=this.texturePool[e];if(i)for(var r=0;r<i.length;r++)i[r].destroy(!0)}this.texturePool={}},t.prototype.setScreenSize=function(t){if(t.width!==this._pixelsWidth||t.height!==this._pixelsHeight){for(var e in this.enableFullScreen=t.width>0&&t.height>0,this.texturePool)if(Number(e)<0){var i=this.texturePool[e];if(i)for(var r=0;r<i.length;r++)i[r].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}},t.SCREEN_KEY=-1,t}(),od=function(){function t(t,e,i,r,n,o,s){void 0===e&&(e=0),void 0===i&&(i=!1),void 0===r&&(r=Jc.FLOAT),this.buffer=t,this.size=e,this.normalized=i,this.type=r,this.stride=n,this.start=o,this.instance=s}return t.prototype.destroy=function(){this.buffer=null},t.from=function(e,i,r,n,o){return new t(e,i,r,n,o)},t}(),sd=0,ad=function(){function t(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1),this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=sd++,this.disposeRunner=new Ph("disposeBuffer")}return t.prototype.update=function(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++},t.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},t.prototype.destroy=function(){this.dispose(),this.data=null},Object.defineProperty(t.prototype,"index",{get:function(){return this.type===cu.ELEMENT_ARRAY_BUFFER},set:function(t){this.type=t?cu.ELEMENT_ARRAY_BUFFER:cu.ARRAY_BUFFER},enumerable:!1,configurable:!0}),t.from=function(e){return e instanceof Array&&(e=new Float32Array(e)),new t(e)},t}(),ld={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};var cd={5126:4,5123:2,5121:1},ud=0,hd={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array},dd=function(){function t(t,e){void 0===t&&(t=[]),void 0===e&&(e={}),this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=ud++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Ph("disposeGeometry"),this.refCount=0}return t.prototype.addAttribute=function(t,e,i,r,n,o,s,a){if(void 0===i&&(i=0),void 0===r&&(r=!1),void 0===a&&(a=!1),!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof ad||(e instanceof Array&&(e=new Float32Array(e)),e=new ad(e));var l=t.split("|");if(l.length>1){for(var c=0;c<l.length;c++)this.addAttribute(l[c],e,i,r,n);return this}var u=this.buffers.indexOf(e);return-1===u&&(this.buffers.push(e),u=this.buffers.length-1),this.attributes[t]=new od(u,i,r,n,o,s,a),this.instanced=this.instanced||a,this},t.prototype.getAttribute=function(t){return this.attributes[t]},t.prototype.getBuffer=function(t){return this.buffers[this.getAttribute(t).buffer]},t.prototype.addIndex=function(t){return t instanceof ad||(t instanceof Array&&(t=new Uint16Array(t)),t=new ad(t)),t.type=cu.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,-1===this.buffers.indexOf(t)&&this.buffers.push(t),this},t.prototype.getIndex=function(){return this.indexBuffer},t.prototype.interleave=function(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;var t,e=[],i=[],r=new ad;for(t in this.attributes){var n=this.attributes[t],o=this.buffers[n.buffer];e.push(o.data),i.push(n.size*cd[n.type]/4),n.buffer=0}for(r.data=function(t,e){for(var i=0,r=0,n={},o=0;o<t.length;o++)r+=e[o],i+=t[o].length;var s=new ArrayBuffer(4*i),a=null,l=0;for(o=0;o<t.length;o++){var c=e[o],u=t[o],h=Mu(u);n[h]||(n[h]=new ld[h](s)),a=n[h];for(var d=0;d<u.length;d++){a[(d/c|0)*r+l+d%c]=u[d]}l+=c}return new Float32Array(s)}(e,i),t=0;t<this.buffers.length;t++)this.buffers[t]!==this.indexBuffer&&this.buffers[t].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},t.prototype.getSize=function(){for(var t in this.attributes){var e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0},t.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},t.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},t.prototype.clone=function(){for(var e=new t,i=0;i<this.buffers.length;i++)e.buffers[i]=new ad(this.buffers[i].data.slice(0));for(var i in this.attributes){var r=this.attributes[i];e.attributes[i]=new od(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=cu.ELEMENT_ARRAY_BUFFER),e},t.merge=function(e){for(var i,r=new t,n=[],o=[],s=[],a=0;a<e.length;a++){i=e[a];for(var l=0;l<i.buffers.length;l++)o[l]=o[l]||0,o[l]+=i.buffers[l].data.length,s[l]=0}for(a=0;a<i.buffers.length;a++)n[a]=new(hd[Mu(i.buffers[a].data)])(o[a]),r.buffers[a]=new ad(n[a]);for(a=0;a<e.length;a++){i=e[a];for(l=0;l<i.buffers.length;l++)n[l].set(i.buffers[l].data,s[l]),s[l]+=i.buffers[l].data.length}if(r.attributes=i.attributes,i.indexBuffer){r.indexBuffer=r.buffers[i.buffers.indexOf(i.indexBuffer)],r.indexBuffer.type=cu.ELEMENT_ARRAY_BUFFER;var c=0,u=0,h=0,d=0;for(a=0;a<i.buffers.length;a++)if(i.buffers[a]!==i.indexBuffer){d=a;break}for(var a in i.attributes){var p=i.attributes[a];(0|p.buffer)===d&&(u+=p.size*cd[p.type]/4)}for(a=0;a<e.length;a++){var f=e[a].indexBuffer.data;for(l=0;l<f.length;l++)r.indexBuffer.data[l+h]+=c;c+=e[a].buffers[d].data.length/u,h+=f.length}}return r},t}(),pd=function(t){function e(){var e=t.call(this)||this;return e.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),e}return Lh(e,t),e}(dd),fd=function(t){function e(){var e=t.call(this)||this;return e.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),e.uvs=new Float32Array([0,0,1,0,1,1,0,1]),e.vertexBuffer=new ad(e.vertices),e.uvBuffer=new ad(e.uvs),e.addAttribute("aVertexPosition",e.vertexBuffer).addAttribute("aTextureCoord",e.uvBuffer).addIndex([0,1,2,0,2,3]),e}return Lh(e,t),e.prototype.map=function(t,e){var i=0,r=0;return this.uvs[0]=i,this.uvs[1]=r,this.uvs[2]=i+e.width/t.width,this.uvs[3]=r,this.uvs[4]=i+e.width/t.width,this.uvs[5]=r+e.height/t.height,this.uvs[6]=i,this.uvs[7]=r+e.height/t.height,i=e.x,r=e.y,this.vertices[0]=i,this.vertices[1]=r,this.vertices[2]=i+e.width,this.vertices[3]=r,this.vertices[4]=i+e.width,this.vertices[5]=r+e.height,this.vertices[6]=i,this.vertices[7]=r+e.height,this.invalidate(),this},e.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},e}(dd),md=0,gd=function(){function t(t,e,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=md++,this.static=!!e,this.ubo=!!i,t instanceof ad?(this.buffer=t,this.buffer.type=cu.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new ad(new Float32Array(1)),this.buffer.type=cu.UNIFORM_BUFFER,this.autoManage=!0))}return t.prototype.update=function(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()},t.prototype.add=function(e,i,r){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[e]=new t(i,r)},t.from=function(e,i,r){return new t(e,i,r)},t.uboFrom=function(e,i){return new t(e,null==i||i,!0)},t}(),_d=function(){function t(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=lu.NONE,this.sourceFrame=new Wu,this.destinationFrame=new Wu,this.bindingSourceFrame=new Wu,this.bindingDestinationFrame=new Wu,this.filters=[],this.transform=null}return t.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},t}(),yd=[new Ju,new Ju,new Ju,new Ju],vd=new th,xd=function(){function t(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new nd,this.texturePool.setScreenSize(t.view),this.statePool=[],this.quad=new pd,this.quadUv=new fd,this.tempRect=new Wu,this.activeState={},this.globalUniforms=new gd({outputFrame:new Wu,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}return t.prototype.push=function(t,e){for(var i=this.renderer,r=this.defaultFilterStack,n=this.statePool.pop()||new _d,o=this.renderer.renderTexture,s=e[0].resolution,a=e[0].multisample,l=e[0].padding,c=e[0].autoFit,u=e[0].legacy,h=1;h<e.length;h++){var d=e[h];s=Math.min(s,d.resolution),a=Math.min(a,d.multisample),l=this.useMaxPadding?Math.max(l,d.padding):l+d.padding,c=c&&d.autoFit,u=u||d.legacy}if(1===r.length&&(this.defaultFilterStack[0].renderTexture=o.current),r.push(n),n.resolution=s,n.multisample=a,n.legacy=u,n.target=t,n.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),n.sourceFrame.pad(l),c){var p=this.tempRect.copyFrom(o.sourceFrame);i.projection.transform&&this.transformAABB(vd.copyFrom(i.projection.transform).invert(),p),n.sourceFrame.fit(p)}this.roundFrame(n.sourceFrame,o.current?o.current.resolution:i.resolution,o.sourceFrame,o.destinationFrame,i.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,s,a),n.filters=e,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;var f=this.tempRect;f.x=0,f.y=0,f.width=n.sourceFrame.width,f.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(o.sourceFrame),n.bindingDestinationFrame.copyFrom(o.destinationFrame),n.transform=i.projection.transform,i.projection.transform=null,o.bind(n.renderTexture,n.sourceFrame,f),i.framebuffer.clear(0,0,0,0)},t.prototype.pop=function(){var t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;var r=this.globalUniforms.uniforms;r.outputFrame=e.sourceFrame,r.resolution=e.resolution;var n=r.inputSize,o=r.inputPixel,s=r.inputClamp;if(n[0]=e.destinationFrame.width,n[1]=e.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],o[0]=Math.round(n[0]*e.resolution),o[1]=Math.round(n[1]*e.resolution),o[2]=1/o[0],o[3]=1/o[1],s[0]=.5*o[2],s[1]=.5*o[3],s[2]=e.sourceFrame.width*n[2]-.5*o[2],s[3]=e.sourceFrame.height*n[3]-.5*o[3],e.legacy){var a=r.filterArea;a[0]=e.destinationFrame.width,a[1]=e.destinationFrame.height,a[2]=e.sourceFrame.x,a[3]=e.sourceFrame.y,r.filterClamp=r.inputClamp}this.globalUniforms.update();var l=t[t.length-1];if(this.renderer.framebuffer.blit(),1===i.length)i[0].apply(this,e.renderTexture,l.renderTexture,nu.BLEND,e),this.returnFilterTexture(e.renderTexture);else{var c=e.renderTexture,u=this.getOptimalFilterTexture(c.width,c.height,e.resolution);u.filterFrame=c.filterFrame;var h=0;for(h=0;h<i.length-1;++h){1===h&&e.multisample>1&&((u=this.getOptimalFilterTexture(c.width,c.height,e.resolution)).filterFrame=c.filterFrame),i[h].apply(this,c,u,nu.CLEAR,e);var d=c;c=u,u=d}i[h].apply(this,c,l.renderTexture,nu.BLEND,e),h>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(c),this.returnFilterTexture(u)}e.clear(),this.statePool.push(e)},t.prototype.bindAndClear=function(t,e){void 0===e&&(e=nu.CLEAR);var i=this.renderer,r=i.renderTexture,n=i.state;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t&&t.filterFrame){var o=this.tempRect;o.x=0,o.y=0,o.width=t.filterFrame.width,o.height=t.filterFrame.height,r.bind(t,t.filterFrame,o)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);var s=1&n.stateId||this.forceClear;(e===nu.CLEAR||e===nu.BLIT&&s)&&this.renderer.framebuffer.clear(0,0,0,0)},t.prototype.applyFilter=function(t,e,i,r){var n=this.renderer;n.state.set(t.state),this.bindAndClear(i,r),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(Yc.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(Yc.TRIANGLE_STRIP))},t.prototype.calculateSpriteMatrix=function(t,e){var i=this.activeState,r=i.sourceFrame,n=i.destinationFrame,o=e._texture.orig,s=t.set(n.width,0,0,n.height,r.x,r.y),a=e.worldTransform.copyTo(th.TEMP_MATRIX);return a.invert(),s.prepend(a),s.scale(1/o.width,1/o.height),s.translate(e.anchor.x,e.anchor.y),s},t.prototype.destroy=function(){this.renderer=null,this.texturePool.clear(!1)},t.prototype.getOptimalFilterTexture=function(t,e,i,r){return void 0===i&&(i=1),void 0===r&&(r=lu.NONE),this.texturePool.getOptimalTexture(t,e,i,r)},t.prototype.getFilterTexture=function(t,e,i){if("number"==typeof t){var r=t;t=e,e=r}t=t||this.activeState.renderTexture;var n=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,i||lu.NONE);return n.filterFrame=t.filterFrame,n},t.prototype.returnFilterTexture=function(t){this.texturePool.returnTexture(t)},t.prototype.emptyPool=function(){this.texturePool.clear(!0)},t.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},t.prototype.transformAABB=function(t,e){var i=yd[0],r=yd[1],n=yd[2],o=yd[3];i.set(e.left,e.top),r.set(e.left,e.bottom),n.set(e.right,e.top),o.set(e.right,e.bottom),t.apply(i,i),t.apply(r,r),t.apply(n,n),t.apply(o,o);var s=Math.min(i.x,r.x,n.x,o.x),a=Math.min(i.y,r.y,n.y,o.y),l=Math.max(i.x,r.x,n.x,o.x),c=Math.max(i.y,r.y,n.y,o.y);e.x=s,e.y=a,e.width=l-s,e.height=c-a},t.prototype.roundFrame=function(t,e,i,r,n){if(n){var o=n.a,s=n.b,a=n.c,l=n.d;if((Math.abs(s)>1e-4||Math.abs(a)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(l)>1e-4))return}(n=n?vd.copyFrom(n):vd.identity()).translate(-i.x,-i.y).scale(r.width/i.width,r.height/i.height).translate(r.x,r.y),this.transformAABB(n,t),t.ceil(e),this.transformAABB(n.invert(),t)},t}(),bd=function(){function t(t){this.renderer=t}return t.prototype.flush=function(){},t.prototype.destroy=function(){this.renderer=null},t.prototype.start=function(){},t.prototype.stop=function(){this.flush()},t.prototype.render=function(t){},t}(),wd=function(){function t(t){this.renderer=t,this.emptyRenderer=new bd(t),this.currentRenderer=this.emptyRenderer}return t.prototype.setObjectRenderer=function(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())},t.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},t.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},t.prototype.copyBoundTextures=function(t,e){for(var i=this.renderer.texture.boundTextures,r=e-1;r>=0;--r)t[r]=i[r]||null,t[r]&&(t[r]._batchLocation=r)},t.prototype.boundArray=function(t,e,i,r){for(var n=t.elements,o=t.ids,s=t.count,a=0,l=0;l<s;l++){var c=n[l],u=c._batchLocation;if(u>=0&&u<r&&e[u]===c)o[l]=u;else for(;a<r;){var h=e[a];if(!h||h._batchEnabled!==i||h._batchLocation!==a){o[l]=a,c._batchLocation=a,e[a]=c;break}a++}}},t.prototype.destroy=function(){this.renderer=null},t}(),Td=0,Ed=function(){function t(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),t.view.addEventListener("webglcontextlost",this.handleContextLost,!1),t.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}return Object.defineProperty(t.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),t.prototype.contextChange=function(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Td++,t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext()},t.prototype.initFromContext=function(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Td++,this.renderer.runners.contextChange.emit(t)},t.prototype.initFromOptions=function(t){var e=this.createContext(this.renderer.view,t);this.initFromContext(e)},t.prototype.createContext=function(t,e){var i;if(uu.PREFER_ENV>=Hc.WEBGL2&&(i=t.getContext("webgl2",e)),i)this.webGLVersion=2;else if(this.webGLVersion=1,!(i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e)))throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl},t.prototype.getExtensions=function(){var t=this.gl,e={anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),loseContext:t.getExtension("WEBGL_lose_context"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})},t.prototype.handleContextLost=function(t){t.preventDefault()},t.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},t.prototype.destroy=function(){var t=this.renderer.view;this.renderer=null,t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},t.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},t.prototype.validateContext=function(t){var e=t.getContextAttributes(),i="WebGL2RenderingContext"in self&&t instanceof self.WebGL2RenderingContext;i&&(this.webGLVersion=2),e.stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");var r=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=r,r||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")},t}(),Sd=function(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=lu.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0},Ad=new Wu,Md=function(){function t(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Kh(10,10),this.msaaSamples=null}return t.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Wu,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),1===this.renderer.context.webGLVersion){var e=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;uu.PREFER_ENV===Hc.WEBGL_LEGACY&&(e=null,i=null),e?t.drawBuffers=function(t){return e.drawBuffersWEBGL(t)}:(this.hasMRT=!1,t.drawBuffers=function(){}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)},t.prototype.bind=function(t,e,i){void 0===i&&(i=0);var r=this.gl;if(t){var n=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,r.bindFramebuffer(r.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,n.mipLevel=i),n.dirtyId!==t.dirtyId&&(n.dirtyId=t.dirtyId,n.dirtyFormat!==t.dirtyFormat?(n.dirtyFormat=t.dirtyFormat,n.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):n.dirtySize!==t.dirtySize&&(n.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(var o=0;o<t.colorTextures.length;o++){var s=t.colorTextures[o];this.renderer.texture.unbind(s.parentTextureArray||s)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){var a=e.width>>i,l=e.height>>i,c=a/e.width;this.setViewport(e.x*c,e.y*c,a,l)}else{a=t.width>>i,l=t.height>>i;this.setViewport(0,0,a,l)}}else this.current&&(this.current=null,r.bindFramebuffer(r.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},t.prototype.setViewport=function(t,e,i,r){var n=this.viewport;t=Math.round(t),e=Math.round(e),i=Math.round(i),r=Math.round(r),n.width===i&&n.height===r&&n.x===t&&n.y===e||(n.x=t,n.y=e,n.width=i,n.height=r,this.gl.viewport(t,e,i,r))},Object.defineProperty(t.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),t.prototype.clear=function(t,e,i,r,n){void 0===n&&(n=Wc.COLOR|Wc.DEPTH);var o=this.gl;o.clearColor(t,e,i,r),o.clear(n)},t.prototype.initFramebuffer=function(t){var e=this.gl,i=new Sd(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i},t.prototype.resizeFramebuffer=function(t){var e=this.gl,i=t.glFramebuffers[this.CONTEXT_UID];i.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,e.RGBA8,t.width,t.height)),i.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,i.stencil),i.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));var r=t.colorTextures,n=r.length;e.drawBuffers||(n=Math.min(n,1));for(var o=0;o<n;o++){var s=r[o],a=s.parentTextureArray||s;this.renderer.texture.bind(a,0)}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)},t.prototype.updateFramebuffer=function(t,e){var i=this.gl,r=t.glFramebuffers[this.CONTEXT_UID],n=t.colorTextures,o=n.length;i.drawBuffers||(o=Math.min(o,1)),r.multisample>1&&this.canMultisampleFramebuffer(t)?(r.msaaBuffer=r.msaaBuffer||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,r.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,i.RGBA8,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,r.msaaBuffer)):r.msaaBuffer&&(i.deleteRenderbuffer(r.msaaBuffer),r.msaaBuffer=null,r.blitFramebuffer&&(r.blitFramebuffer.dispose(),r.blitFramebuffer=null));for(var s=[],a=0;a<o;a++){var l=n[a],c=l.parentTextureArray||l;this.renderer.texture.bind(c,0),0===a&&r.msaaBuffer||(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+a,l.target,c._glTextures[this.CONTEXT_UID].texture,e),s.push(i.COLOR_ATTACHMENT0+a))}if((s.length>1&&i.drawBuffers(s),t.depthTexture)&&this.writeDepthTexture){var u=t.depthTexture;this.renderer.texture.bind(u,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,u._glTextures[this.CONTEXT_UID].texture,e)}!t.stencil&&!t.depth||t.depthTexture&&this.writeDepthTexture?r.stencil&&(i.deleteRenderbuffer(r.stencil),r.stencil=null):(r.stencil=r.stencil||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,r.stencil),r.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,i.DEPTH24_STENCIL8,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,r.stencil))},t.prototype.canMultisampleFramebuffer=function(t){return 1!==this.renderer.context.webGLVersion&&t.colorTextures.length<=1&&!t.depthTexture},t.prototype.detectSamples=function(t){var e=this.msaaSamples,i=lu.NONE;if(t<=1||null===e)return i;for(var r=0;r<e.length;r++)if(e[r]<=t){i=e[r];break}return 1===i&&(i=lu.NONE),i},t.prototype.blit=function(t,e,i){var r=this.current,n=this.renderer,o=this.gl,s=this.CONTEXT_UID;if(2===n.context.webGLVersion&&r){var a=r.glFramebuffers[s];if(a){if(!t){if(!a.msaaBuffer)return;var l=r.colorTextures[0];if(!l)return;a.blitFramebuffer||(a.blitFramebuffer=new Kh(r.width,r.height),a.blitFramebuffer.addColorTexture(0,l)),(t=a.blitFramebuffer).colorTextures[0]!==l&&(t.colorTextures[0]=l,t.dirtyId++,t.dirtyFormat++),t.width===r.width&&t.height===r.height||(t.width=r.width,t.height=r.height,t.dirtyId++,t.dirtySize++)}e||((e=Ad).width=r.width,e.height=r.height),i||(i=e);var c=e.width===i.width&&e.height===i.height;this.bind(t),o.bindFramebuffer(o.READ_FRAMEBUFFER,a.framebuffer),o.blitFramebuffer(e.x,e.y,e.width,e.height,i.x,i.y,i.width,i.height,o.COLOR_BUFFER_BIT,c?o.NEAREST:o.LINEAR)}}},t.prototype.disposeFramebuffer=function(t,e){var i=t.glFramebuffers[this.CONTEXT_UID],r=this.gl;if(i){delete t.glFramebuffers[this.CONTEXT_UID];var n=this.managedFramebuffers.indexOf(t);n>=0&&this.managedFramebuffers.splice(n,1),t.disposeRunner.remove(this),e||(r.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&r.deleteRenderbuffer(i.msaaBuffer),i.stencil&&r.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&i.blitFramebuffer.dispose()}},t.prototype.disposeAll=function(t){var e=this.managedFramebuffers;this.managedFramebuffers=[];for(var i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)},t.prototype.forceStencil=function(){var t=this.current;if(t){var e=t.glFramebuffers[this.CONTEXT_UID];if(e&&!e.stencil){t.stencil=!0;var i=t.width,r=t.height,n=this.gl,o=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,o),e.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,e.multisample,n.DEPTH24_STENCIL8,i,r):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,i,r),e.stencil=o,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,o)}}},t.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new Wu},t.prototype.destroy=function(){this.renderer=null},t}(),Id={5126:4,5123:2,5121:1},Cd=function(){function t(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}return t.prototype.contextChange=function(){this.disposeAll(!0);var t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==e.webGLVersion){var i=this.renderer.context.extensions.vertexArrayObject;uu.PREFER_ENV===Hc.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=function(){return i.createVertexArrayOES()},t.bindVertexArray=function(t){return i.bindVertexArrayOES(t)},t.deleteVertexArray=function(t){return i.deleteVertexArrayOES(t)}):(this.hasVao=!1,t.createVertexArray=function(){return null},t.bindVertexArray=function(){return null},t.deleteVertexArray=function(){return null})}if(2!==e.webGLVersion){var r=t.getExtension("ANGLE_instanced_arrays");r?(t.vertexAttribDivisor=function(t,e){return r.vertexAttribDivisorANGLE(t,e)},t.drawElementsInstanced=function(t,e,i,n,o){return r.drawElementsInstancedANGLE(t,e,i,n,o)},t.drawArraysInstanced=function(t,e,i,n){return r.drawArraysInstancedANGLE(t,e,i,n)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===e.webGLVersion||!!e.extensions.uint32ElementIndex},t.prototype.bind=function(t,e){e=e||this.renderer.shader.shader;var i=this.gl,r=t.glVertexArrayObjects[this.CONTEXT_UID],n=!1;r||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=r={},n=!0);var o=r[e.program.id]||this.initGeometryVao(t,e,n);this._activeGeometry=t,this._activeVao!==o&&(this._activeVao=o,this.hasVao?i.bindVertexArray(o):this.activateVao(t,e.program)),this.updateBuffers()},t.prototype.reset=function(){this.unbind()},t.prototype.updateBuffers=function(){for(var t=this._activeGeometry,e=this.renderer.buffer,i=0;i<t.buffers.length;i++){var r=t.buffers[i];e.update(r)}},t.prototype.checkCompatibility=function(t,e){var i=t.attributes,r=e.attributeData;for(var n in r)if(!i[n])throw new Error('shader and geometry incompatible, geometry missing the "'+n+'" attribute')},t.prototype.getSignature=function(t,e){var i=t.attributes,r=e.attributeData,n=["g",t.id];for(var o in i)r[o]&&n.push(o);return n.join("-")},t.prototype.initGeometryVao=function(t,e,i){void 0===i&&(i=!0);var r=this.gl,n=this.CONTEXT_UID,o=this.renderer.buffer,s=e.program;s.glPrograms[n]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,s);var a=this.getSignature(t,s),l=t.glVertexArrayObjects[this.CONTEXT_UID],c=l[a];if(c)return l[s.id]=c,c;var u=t.buffers,h=t.attributes,d={},p={};for(var f in u)d[f]=0,p[f]=0;for(var f in h)!h[f].size&&s.attributeData[f]?h[f].size=s.attributeData[f].size:h[f].size||console.warn("PIXI Geometry attribute '"+f+"' size cannot be determined (likely the bound shader does not have the attribute)"),d[h[f].buffer]+=h[f].size*Id[h[f].type];for(var f in h){var m=h[f],g=m.size;void 0===m.stride&&(d[m.buffer]===g*Id[m.type]?m.stride=0:m.stride=d[m.buffer]),void 0===m.start&&(m.start=p[m.buffer],p[m.buffer]+=g*Id[m.type])}c=r.createVertexArray(),r.bindVertexArray(c);for(var _=0;_<u.length;_++){var y=u[_];o.bind(y),i&&y._glBuffers[n].refCount++}return this.activateVao(t,s),this._activeVao=c,l[s.id]=c,l[a]=c,c},t.prototype.disposeGeometry=function(t,e){var i;if(this.managedGeometries[t.id]){delete this.managedGeometries[t.id];var r=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,o=t.buffers,s=null===(i=this.renderer)||void 0===i?void 0:i.buffer;if(t.disposeRunner.remove(this),r){if(s)for(var a=0;a<o.length;a++){var l=o[a]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,0!==l.refCount||e||s.dispose(o[a],e))}if(!e)for(var c in r)if("g"===c[0]){var u=r[c];this._activeVao===u&&this.unbind(),n.deleteVertexArray(u)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}},t.prototype.disposeAll=function(t){for(var e=Object.keys(this.managedGeometries),i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t)},t.prototype.activateVao=function(t,e){var i=this.gl,r=this.CONTEXT_UID,n=this.renderer.buffer,o=t.buffers,s=t.attributes;t.indexBuffer&&n.bind(t.indexBuffer);var a=null;for(var l in s){var c=s[l],u=o[c.buffer],h=u._glBuffers[r];if(e.attributeData[l]){a!==h&&(n.bind(u),a=h);var d=e.attributeData[l].location;if(i.enableVertexAttribArray(d),i.vertexAttribPointer(d,c.size,c.type||i.FLOAT,c.normalized,c.stride,c.start),c.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");i.vertexAttribDivisor(d,1)}}}},t.prototype.draw=function(t,e,i,r){var n=this.gl,o=this._activeGeometry;if(o.indexBuffer){var s=o.indexBuffer.data.BYTES_PER_ELEMENT,a=2===s?n.UNSIGNED_SHORT:n.UNSIGNED_INT;2===s||4===s&&this.canUseUInt32ElementIndex?o.instanced?n.drawElementsInstanced(t,e||o.indexBuffer.data.length,a,(i||0)*s,r||1):n.drawElements(t,e||o.indexBuffer.data.length,a,(i||0)*s):console.warn("unsupported index buffer type: uint32")}else o.instanced?n.drawArraysInstanced(t,i,e||o.getSize(),r||1):n.drawArrays(t,i,e||o.getSize());return this},t.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},t.prototype.destroy=function(){this.renderer=null},t}(),Pd=function(){function t(t){void 0===t&&(t=null),this.type=au.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=uu.FILTER_MULTISAMPLE,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._target=null}return t.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=au.NONE,this.autoDetect=!0),this._target=null},t.prototype.copyCountersOrReset=function(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},t}();function Rd(t,e,i){var r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),r}function Od(t,e){var i=t.getShaderSource(e).split("\n").map((function(t,e){return e+": "+t})),r=t.getShaderInfoLog(e),n=r.split("\n"),o={},s=n.map((function(t){return parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))})).filter((function(t){return!(!t||o[t])&&(o[t]=!0,!0)})),a=[""];s.forEach((function(t){i[t-1]="%c"+i[t-1]+"%c",a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));var l=i.join("\n");a[0]=l,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn.apply(console,a),console.groupEnd()}function Dd(t){for(var e=new Array(t),i=0;i<e.length;i++)e[i]=!1;return e}function Ld(t,e){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return Dd(2*e);case"bvec3":return Dd(3*e);case"bvec4":return Dd(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var kd,Bd={},Fd=Bd;function zd(){if(!kd){kd=su.MEDIUM;var t=function(){if(Fd===Bd||Fd&&Fd.isContextLost()){var t=document.createElement("canvas"),e=void 0;uu.PREFER_ENV>=Hc.WEBGL2&&(e=t.getContext("webgl2",{})),e||((e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}))?e.getExtension("WEBGL_draw_buffers"):e=null),Fd=e}return Fd}();if(t&&t.getShaderPrecisionFormat){var e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);kd=e.precision?su.HIGH:su.MEDIUM}}return kd}function Nd(t,e,i){if("precision"!==t.substring(0,9)){var r=e;return e===su.HIGH&&i!==su.HIGH&&(r=su.MEDIUM),"precision "+r+" float;\n"+t}return i!==su.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}var Ud={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Gd(t){return Ud[t]}var jd=null,Vd={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Xd(t,e){if(!jd){var i=Object.keys(Vd);jd={};for(var r=0;r<i.length;++r){var n=i[r];jd[t[n]]=Vd[n]}}return jd[e]}var Hd=[{test:function(t){return"float"===t.type&&1===t.size},code:function(t){return'\n            if(uv["'+t+'"] !== ud["'+t+'"].value)\n            {\n                ud["'+t+'"].value = uv["'+t+'"]\n                gl.uniform1f(ud["'+t+'"].location, uv["'+t+'"])\n            }\n            '}},{test:function(t){return("sampler2D"===t.type||"samplerCube"===t.type||"sampler2DArray"===t.type)&&1===t.size&&!t.isArray},code:function(t){return't = syncData.textureCount++;\n\n            renderer.texture.bind(uv["'+t+'"], t);\n\n            if(ud["'+t+'"].value !== t)\n            {\n                ud["'+t+'"].value = t;\n                gl.uniform1i(ud["'+t+'"].location, t);\n; // eslint-disable-line max-len\n            }'}},{test:function(t,e){return"mat3"===t.type&&1===t.size&&void 0!==e.a},code:function(t){return'\n            gl.uniformMatrix3fv(ud["'+t+'"].location, false, uv["'+t+'"].toArray(true));\n            '},codeUbo:function(t){return"\n                var "+t+"_matrix = uv."+t+".toArray(true);\n\n                data[offset] = "+t+"_matrix[0];\n                data[offset+1] = "+t+"_matrix[1];\n                data[offset+2] = "+t+"_matrix[2];\n        \n                data[offset + 4] = "+t+"_matrix[3];\n                data[offset + 5] = "+t+"_matrix[4];\n                data[offset + 6] = "+t+"_matrix[5];\n        \n                data[offset + 8] = "+t+"_matrix[6];\n                data[offset + 9] = "+t+"_matrix[7];\n                data[offset + 10] = "+t+"_matrix[8];\n            "}},{test:function(t,e){return"vec2"===t.type&&1===t.size&&void 0!==e.x},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["'+t+'"].location, v.x, v.y);\n                }'},codeUbo:function(t){return"\n                v = uv."+t+";\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            "}},{test:function(t){return"vec2"===t.type&&1===t.size},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["'+t+'"].location, v[0], v[1]);\n                }\n            '}},{test:function(t,e){return"vec4"===t.type&&1===t.size&&void 0!==e.width},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["'+t+'"].location, v.x, v.y, v.width, v.height)\n                }'},codeUbo:function(t){return"\n                    v = uv."+t+";\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                "}},{test:function(t){return"vec4"===t.type&&1===t.size},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["'+t+'"].location, v[0], v[1], v[2], v[3])\n                }'}}],qd={float:"\n    if(cv !== v)\n    {\n        cv.v = v;\n        gl.uniform1f(location, v)\n    }",vec2:"\n    if(cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"gl.uniform4f(location, v[0], v[1], v[2], v[3])",int:"gl.uniform1i(location, v)",ivec2:"gl.uniform2i(location, v[0], v[1])",ivec3:"gl.uniform3i(location, v[0], v[1], v[2])",ivec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",uint:"gl.uniform1ui(location, v)",uvec2:"gl.uniform2ui(location, v[0], v[1])",uvec3:"gl.uniform3ui(location, v[0], v[1], v[2])",uvec4:"gl.uniform4ui(location, v[0], v[1], v[2], v[3])",bool:"\n    if(cv !== v)\n    {\n        cv.v = v;\n        gl.uniform1i(location, v)\n    }",bvec2:"gl.uniform2i(location, v[0], v[1])",bvec3:"gl.uniform3i(location, v[0], v[1], v[2])",bvec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"},Wd={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};var $d,Yd=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function Zd(t){for(var e="",i=0;i<t;++i)i>0&&(e+="\nelse "),i<t-1&&(e+="if(test == "+i+".0){}");return e}var Kd=0,Jd={},Qd=function(){function t(e,i,r){void 0===r&&(r="pixi-shader"),this.id=Kd++,this.vertexSrc=e||t.defaultVertexSrc,this.fragmentSrc=i||t.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),"#version"!==this.vertexSrc.substring(0,8)&&(r=r.replace(/\s+/g,"-"),Jd[r]?(Jd[r]++,r+="-"+Jd[r]):Jd[r]=1,this.vertexSrc="#define SHADER_NAME "+r+"\n"+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+r+"\n"+this.fragmentSrc,this.vertexSrc=Nd(this.vertexSrc,uu.PRECISION_VERTEX,su.HIGH),this.fragmentSrc=Nd(this.fragmentSrc,uu.PRECISION_FRAGMENT,zd())),this.glPrograms={},this.syncUniforms=null}return Object.defineProperty(t,"defaultVertexSrc",{get:function(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultFragmentSrc",{get:function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"},enumerable:!1,configurable:!0}),t.from=function(e,i,r){var n=e+i,o=Fu[n];return o||(Fu[n]=o=new t(e,i,r)),o},t}(),tp=function(){function t(t,e){this.uniformBindCount=0,this.program=t,this.uniformGroup=e?e instanceof gd?e:new gd(e):new gd({})}return t.prototype.checkUniformExists=function(t,e){if(e.uniforms[t])return!0;for(var i in e.uniforms){var r=e.uniforms[i];if(r.group&&this.checkUniformExists(t,r))return!0}return!1},t.prototype.destroy=function(){this.uniformGroup=null},Object.defineProperty(t.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),t.from=function(e,i,r){return new t(Qd.from(e,i),r)},t}(),ep=function(){function t(){this.data=0,this.blendMode=$c.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}return Object.defineProperty(t.prototype,"blend",{get:function(){return!!(1&this.data)},set:function(t){!!(1&this.data)!==t&&(this.data^=1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsets",{get:function(){return!!(2&this.data)},set:function(t){!!(2&this.data)!==t&&(this.data^=2)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"culling",{get:function(){return!!(4&this.data)},set:function(t){!!(4&this.data)!==t&&(this.data^=4)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthTest",{get:function(){return!!(8&this.data)},set:function(t){!!(8&this.data)!==t&&(this.data^=8)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthMask",{get:function(){return!!(32&this.data)},set:function(t){!!(32&this.data)!==t&&(this.data^=32)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clockwiseFrontFace",{get:function(){return!!(16&this.data)},set:function(t){!!(16&this.data)!==t&&(this.data^=16)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._blendMode},set:function(t){this.blend=t!==$c.NONE,this._blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(t){this.offsets=!!t,this._polygonOffset=t},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return"[@pixi/core:State blendMode="+this.blendMode+" clockwiseFrontFace="+this.clockwiseFrontFace+" culling="+this.culling+" depthMask="+this.depthMask+" polygonOffset="+this.polygonOffset+"]"},t.for2d=function(){var e=new t;return e.depthTest=!1,e.blend=!0,e},t}(),ip=function(t){function e(i,r,n){var o=this,s=Qd.from(i||e.defaultVertexSrc,r||e.defaultFragmentSrc);return(o=t.call(this,s,n)||this).padding=0,o.resolution=uu.FILTER_RESOLUTION,o.multisample=uu.FILTER_MULTISAMPLE,o.enabled=!0,o.autoFit=!0,o.state=new ep,o}return Lh(e,t),e.prototype.apply=function(t,e,i,r,n){t.applyFilter(this,e,i,r)},Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resolution",{get:function(){return this._resolution},set:function(t){this._resolution=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultVertexSrc",{get:function(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultFragmentSrc",{get:function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"},enumerable:!1,configurable:!0}),e}(tp),rp=new th,np=function(){function t(t,e){this._texture=t,this.mapCoord=new th,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===e?.5:e,this.isSimple=!1}return Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture=t,this._textureID=-1},enumerable:!1,configurable:!0}),t.prototype.multiplyUvs=function(t,e){void 0===e&&(e=t);for(var i=this.mapCoord,r=0;r<t.length;r+=2){var n=t[r],o=t[r+1];e[r]=n*i.a+o*i.c+i.tx,e[r+1]=n*i.b+o*i.d+i.ty}return e},t.prototype.update=function(t){var e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;var i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);var r=e.orig,n=e.trim;n&&(rp.set(r.width/n.width,0,0,r.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(rp));var o=e.baseTexture,s=this.uClampFrame,a=this.clampMargin/o.resolution,l=this.clampOffset;return s[0]=(e._frame.x+a+l)/o.width,s[1]=(e._frame.y+a+l)/o.height,s[2]=(e._frame.x+e._frame.width-a+l)/o.width,s[3]=(e._frame.y+e._frame.height-a+l)/o.height,this.uClampOffset[0]=l/o.realWidth,this.uClampOffset[1]=l/o.realHeight,this.isSimple=e._frame.width===o.width&&e._frame.height===o.height&&0===e.rotate,!0},t}(),op=function(t){function e(e){var i=this,r=new th;return i=t.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n")||this,e.renderable=!1,i.maskSprite=e,i.maskMatrix=r,i}return Lh(e,t),e.prototype.apply=function(t,e,i,r){var n=this.maskSprite,o=n._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new np(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,n).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,t.applyFilter(this,e,i,r))},e}(ip),sp=function(){function t(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}return t.prototype.setMaskStack=function(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)},t.prototype.push=function(t,e){var i=e;if(!i.isMaskData){var r=this.maskDataPool.pop()||new Pd;r.pooled=!0,r.maskObject=e,i=r}switch(i.autoDetect&&this.detect(i),i.copyCountersOrReset(this.maskStack[this.maskStack.length-1]),i._target=t,i.type){case au.SCISSOR:this.maskStack.push(i),this.renderer.scissor.push(i);break;case au.STENCIL:this.maskStack.push(i),this.renderer.stencil.push(i);break;case au.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i),this.maskStack.push(i)}},t.prototype.pop=function(t){var e=this.maskStack.pop();if(e&&e._target===t){switch(e.type){case au.SCISSOR:this.renderer.scissor.pop();break;case au.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case au.SPRITE:this.popSpriteMask()}e.reset(),e.pooled&&this.maskDataPool.push(e)}},t.prototype.detect=function(t){var e=t.maskObject;if(e.isSprite)t.type=au.SPRITE;else if(t.type=au.STENCIL,this.enableScissor&&e.isFastRect&&e.isFastRect()){var i=e.worldTransform,r=Math.atan2(i.b,i.a),n=Math.atan2(i.d,i.c);r=Math.round(r*(180/Math.PI)*100),n=((n=Math.round(n*(180/Math.PI)*100)-r)%18e3+18e3)%18e3,0===(r=(r%9e3+9e3)%9e3)&&9e3===n&&(t.type=au.SCISSOR)}},t.prototype.pushSpriteMask=function(t){var e,i,r=t.maskObject,n=t._target,o=this.alphaMaskPool[this.alphaMaskIndex];o||(o=this.alphaMaskPool[this.alphaMaskIndex]=[new op(r)]);var s,a,l=this.renderer,c=l.renderTexture;if(c.current){var u=c.current;s=t.resolution||u.resolution,a=null!==(e=t.multisample)&&void 0!==e?e:u.multisample}else s=t.resolution||l.resolution,a=null!==(i=t.multisample)&&void 0!==i?i:l.multisample;o[0].resolution=s,o[0].multisample=a,o[0].maskSprite=r;var h=n.filterArea;n.filterArea=r.getBounds(!0),l.filter.push(n,o),n.filterArea=h,this.alphaMaskIndex++},t.prototype.popSpriteMask=function(){this.renderer.filter.pop(),this.alphaMaskIndex--},t.prototype.destroy=function(){this.renderer=null},t}(),ap=function(){function t(t){this.renderer=t,this.maskStack=[],this.glConst=0}return t.prototype.getStackLength=function(){return this.maskStack.length},t.prototype.setMaskStack=function(t){var e=this.renderer.gl,i=this.getStackLength();this.maskStack=t;var r=this.getStackLength();r!==i&&(0===r?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))},t.prototype._useCurrent=function(){},t.prototype.destroy=function(){this.renderer=null,this.maskStack=null},t}(),lp=function(t){function e(e){var i=t.call(this,e)||this;return i.glConst=WebGLRenderingContext.SCISSOR_TEST,i}return Lh(e,t),e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0},e.prototype.push=function(t){var e=t.maskObject;e.renderable=!0;var i=t._scissorRect,r=e.getBounds(!0),n=this.renderer.gl;e.renderable=!1,i?r.fit(i):n.enable(n.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=r,this._useCurrent()},e.prototype.pop=function(){var t=this.renderer.gl;this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)},e.prototype._useCurrent=function(){var t=this.maskStack[this.maskStack.length-1]._scissorRect,e=this.renderer.renderTexture.current,i=this.renderer.projection,r=i.transform,n=i.sourceFrame,o=i.destinationFrame,s=e?e.resolution:this.renderer.resolution,a=o.width/n.width,l=o.height/n.height,c=((t.x-n.x)*a+o.x)*s,u=((t.y-n.y)*l+o.y)*s,h=t.width*a*s,d=t.height*l*s;r&&(c+=r.tx*s,u+=r.ty*s),e||(u=this.renderer.height-d-u),c=Math.round(c),u=Math.round(u),h=Math.round(h),d=Math.round(d),this.renderer.gl.scissor(c,u,h,d)},e}(ap),cp=function(t){function e(e){var i=t.call(this,e)||this;return i.glConst=WebGLRenderingContext.STENCIL_TEST,i}return Lh(e,t),e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0},e.prototype.push=function(t){var e=t.maskObject,i=this.renderer.gl,r=t._stencilCounter;0===r&&(this.renderer.framebuffer.forceStencil(),i.enable(i.STENCIL_TEST)),t._stencilCounter++,i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,r,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,this._useCurrent()},e.prototype.pop=function(t){var e=this.renderer.gl;0===this.getStackLength()?(e.disable(e.STENCIL_TEST),e.clearStencil(0),e.clear(e.STENCIL_BUFFER_BIT)):(e.colorMask(!1,!1,!1,!1),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,this._useCurrent())},e.prototype._useCurrent=function(){var t=this.renderer.gl;t.colorMask(!0,!0,!0,!0),t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},e}(ap),up=function(){function t(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new th,this.transform=null}return t.prototype.update=function(t,e,i,r){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,r),this.transform&&this.projectionMatrix.append(this.transform);var n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)},t.prototype.calculateProjection=function(t,e,i,r){var n=this.projectionMatrix,o=r?-1:1;n.identity(),n.a=1/e.width*2,n.d=o*(1/e.height*2),n.tx=-1-e.x*n.a,n.ty=-o-e.y*n.d},t.prototype.setTransform=function(t){},t.prototype.destroy=function(){this.renderer=null},t}(),hp=new Wu,dp=new Wu,pp=function(){function t(t){this.renderer=t,this.clearColor=t._backgroundColorRgba,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Wu,this.destinationFrame=new Wu,this.viewportFrame=new Wu}return t.prototype.bind=function(t,e,i){void 0===t&&(t=null);var r,n,o,s=this.renderer;this.current=t,t?(o=(r=t.baseTexture).resolution,e||(hp.width=t.frame.width,hp.height=t.frame.height,e=hp),i||(dp.x=t.frame.x,dp.y=t.frame.y,dp.width=e.width,dp.height=e.height,i=dp),n=r.framebuffer):(o=s.resolution,e||(hp.width=s.screen.width,hp.height=s.screen.height,e=hp),i||((i=hp).width=e.width,i.height=e.height));var a=this.viewportFrame;a.x=i.x*o,a.y=i.y*o,a.width=i.width*o,a.height=i.height*o,t||(a.y=s.view.height-(a.y+a.height)),a.ceil(),this.renderer.framebuffer.bind(n,a),this.renderer.projection.update(i,e,o,!n),t?this.renderer.mask.setMaskStack(r.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)},t.prototype.clear=function(t,e){t=this.current?t||this.current.baseTexture.clearColor:t||this.clearColor;var i=this.destinationFrame,r=this.current?this.current.baseTexture:this.renderer.screen,n=i.width!==r.width||i.height!==r.height;if(n){var o=this.viewportFrame,s=o.x,a=o.y,l=o.width,c=o.height;s=Math.round(s),a=Math.round(a),l=Math.round(l),c=Math.round(c),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(s,a,l,c)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],e),n&&this.renderer.scissor.pop()},t.prototype.resize=function(){this.bind(null)},t.prototype.reset=function(){this.bind(null)},t.prototype.destroy=function(){this.renderer=null},t}();function fp(t,e,i,r,n){i.buffer.update(n)}var mp={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},gp={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};function _p(t,e){if(!t.autoManage)return{size:0,syncFunc:fp};for(var i=function(t){for(var e=t.map((function(t){return{data:t,offset:0,dataLen:0,dirty:0}})),i=0,r=0,n=0,o=0;o<e.length;o++){var s=e[o];if(i=gp[s.data.type],s.data.size>1&&(i=Math.max(i,16)*s.data.size),s.dataLen=i,r%i!=0&&r<16){var a=r%i%16;r+=a,n+=a}r+i>16?(n=16*Math.ceil(n/16),s.offset=n,n+=i,r=i):(s.offset=n,r+=i,n+=i)}return{uboElements:e,size:n=16*Math.ceil(n/16)}}(function(t,e){var i=[];for(var r in t)e[r]&&i.push(e[r]);return i.sort((function(t,e){return t.index-e.index})),i}(t.uniforms,e)),r=i.uboElements,n=i.size,o=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "],s=0;s<r.length;s++){for(var a=r[s],l=t.uniforms[a.data.name],c=a.data.name,u=!1,h=0;h<Hd.length;h++){var d=Hd[h];if(d.codeUbo&&d.test(a.data,l)){o.push("offset = "+a.offset/4+";",Hd[h].codeUbo(a.data.name,l)),u=!0;break}}if(!u)if(a.data.size>1){var p=Gd(a.data.type),f=Math.max(gp[a.data.type]/16,1),m=p/f,g=(4-m%4)%4;o.push("\n                cv = ud."+c+".value;\n                v = uv."+c+";\n                offset = "+a.offset/4+";\n\n                t = 0;\n\n                for(var i=0; i < "+a.data.size*f+"; i++)\n                {\n                    for(var j = 0; j < "+m+"; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += "+g+";\n                }\n\n                ")}else{var _=mp[a.data.type];o.push("\n                cv = ud."+c+".value;\n                v = uv."+c+";\n                offset = "+a.offset/4+";\n                "+_+";\n                ")}}return o.push("\n       renderer.buffer.update(buffer);\n    "),{size:n,syncFunc:new Function("ud","uv","renderer","syncData","buffer",o.join("\n"))}}var yp=function(){function t(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}return t.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null},t}();function vp(t,e){var i=Rd(t,t.VERTEX_SHADER,e.vertexSrc),r=Rd(t,t.FRAGMENT_SHADER,e.fragmentSrc),n=t.createProgram();t.attachShader(n,i),t.attachShader(n,r),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS)||function(t,e,i,r){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(i,t.COMPILE_STATUS)||Od(t,i),t.getShaderParameter(r,t.COMPILE_STATUS)||Od(t,r),console.error("PixiJS Error: Could not initialize shader."),""!==t.getProgramInfoLog(e)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(e)))}(t,n,i,r),e.attributeData=function(t,e){for(var i={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),n=0;n<r;n++){var o=e.getActiveAttrib(t,n);if(0!==o.name.indexOf("gl_")){var s=Xd(e,o.type),a={type:s,name:o.name,size:Gd(s),location:n};i[o.name]=a}}return i}(n,t),e.uniformData=function(t,e){for(var i={},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),n=0;n<r;n++){var o=e.getActiveUniform(t,n),s=o.name.replace(/\[.*?\]$/,""),a=!!o.name.match(/\[.*?\]$/),l=Xd(e,o.type);i[s]={name:s,index:n,type:l,size:o.size,isArray:a,value:Ld(l,o.size)}}return i}(n,t);var o=Object.keys(e.attributeData);o.sort((function(t,e){return t>e?1:-1}));for(var s=0;s<o.length;s++)e.attributeData[o[s]].location=s,t.bindAttribLocation(n,s,o[s]);t.linkProgram(n),t.deleteShader(i),t.deleteShader(r);var a={};for(var s in e.uniformData){var l=e.uniformData[s];a[s]={location:t.getUniformLocation(n,s),value:Ld(l.type,l.size)}}return new yp(n,a)}var xp=0,bp={textureCount:0,uboCount:0},wp=function(){function t(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=xp++}return t.prototype.systemCheck=function(){if(!function(){if("boolean"==typeof $d)return $d;try{var t=new Function("param1","param2","param3","return param1[param2] === param3;");$d=!0===t({a:"b"},"a","b")}catch(t){$d=!1}return $d}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},t.prototype.contextChange=function(t){this.gl=t,this.reset()},t.prototype.bind=function(t,e){t.uniforms.globals=this.renderer.globalUniforms;var i=t.program,r=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(r.program)),e||(bp.textureCount=0,bp.uboCount=0,this.syncUniformGroup(t.uniformGroup,bp)),r},t.prototype.setUniforms=function(t){var e=this.shader.program,i=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(i.uniformData,t,this.renderer)},t.prototype.syncUniformGroup=function(t,e){var i=this.getGlProgram();t.static&&t.dirtyId===i.uniformDirtyGroups[t.id]||(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))},t.prototype.syncUniforms=function(t,e,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,i)},t.prototype.createSyncGroups=function(t){var e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=function(t,e){var i=["\n        var v = null;\n        var cv = null\n        var t = 0;\n        var gl = renderer.gl\n    "];for(var r in t.uniforms){var n=e[r];if(n){for(var o=t.uniforms[r],s=!1,a=0;a<Hd.length;a++)if(Hd[a].test(n,o)){i.push(Hd[a].code(r,o)),s=!0;break}if(!s){var l=(1===n.size?qd:Wd)[n.type].replace("location",'ud["'+r+'"].location');i.push('\n            cv = ud["'+r+'"].value;\n            v = uv["'+r+'"];\n            '+l+";")}}else t.uniforms[r].group&&(t.uniforms[r].ubo?i.push("\n                        renderer.shader.syncUniformBufferGroup(uv."+r+", '"+r+"');\n                    "):i.push("\n                        renderer.shader.syncUniformGroup(uv."+r+", syncData);\n                    "))}return new Function("ud","uv","renderer","syncData",i.join("\n"))}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]},t.prototype.syncUniformBufferGroup=function(t,e){var i=this.getGlProgram();if(!t.static||0!==t.dirtyId||!i.uniformGroups[t.id]){t.dirtyId=0;var r=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,e);t.buffer.update(),r(i.uniformData,t.uniforms,this.renderer,bp,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[e])},t.prototype.createSyncBufferGroup=function(t,e,i){var r=this.renderer.gl;this.renderer.buffer.bind(t.buffer);var n=this.gl.getUniformBlockIndex(e.program,i);e.uniformBufferBindings[i]=this.shader.uniformBindCount,r.uniformBlockBinding(e.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;var o=this.getSignature(t,this.shader.program.uniformData,"ubo"),s=this._uboCache[o];if(s||(s=this._uboCache[o]=_p(t,this.shader.program.uniformData)),t.autoManage){var a=new Float32Array(s.size/4);t.buffer.update(a)}return e.uniformGroups[t.id]=s.syncFunc,e.uniformGroups[t.id]},t.prototype.getSignature=function(t,e,i){var r=t.uniforms,n=[i+"-"];for(var o in r)n.push(o),e[o]&&n.push(e[o].type);return n.join("-")},t.prototype.getGlProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},t.prototype.generateProgram=function(t){var e=this.gl,i=t.program,r=vp(e,i);return i.glPrograms[this.renderer.CONTEXT_UID]=r,r},t.prototype.reset=function(){this.program=null,this.shader=null},t.prototype.destroy=function(){this.renderer=null,this.destroyed=!0},t}();var Tp=function(){function t(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=$c.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new ep,this.defaultState.blend=!0}return t.prototype.contextChange=function(t){this.gl=t,this.blendModes=function(t,e){return void 0===e&&(e=[]),e[$c.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[$c.ADD]=[t.ONE,t.ONE],e[$c.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[$c.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[$c.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[$c.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[$c.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[$c.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[$c.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[$c.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[$c.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[$c.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[$c.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[$c.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[$c.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[$c.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[$c.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[$c.NONE]=[0,0],e[$c.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[$c.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[$c.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[$c.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[$c.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[$c.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[$c.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[$c.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[$c.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[$c.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[$c.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[$c.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}(t),this.set(this.defaultState),this.reset()},t.prototype.set=function(t){if(t=t||this.defaultState,this.stateId!==t.data){for(var e=this.stateId^t.data,i=0;e;)1&e&&this.map[i].call(this,!!(t.data&1<<i)),e>>=1,i++;this.stateId=t.data}for(i=0;i<this.checks.length;i++)this.checks[i](this,t)},t.prototype.forceState=function(t){t=t||this.defaultState;for(var e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data},t.prototype.setBlend=function(e){this.updateCheck(t.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)},t.prototype.setOffset=function(e){this.updateCheck(t.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},t.prototype.setDepthTest=function(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)},t.prototype.setDepthMask=function(t){this.gl.depthMask(t)},t.prototype.setCullFace=function(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)},t.prototype.setFrontFace=function(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])},t.prototype.setBlendMode=function(t){if(t!==this.blendMode){this.blendMode=t;var e=this.blendModes[t],i=this.gl;2===e.length?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}},t.prototype.setPolygonOffset=function(t,e){this.gl.polygonOffset(t,e)},t.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},t.prototype.updateCheck=function(t,e){var i=this.checks.indexOf(t);e&&-1===i?this.checks.push(t):e||-1===i||this.checks.splice(i,1)},t.checkBlendMode=function(t,e){t.setBlendMode(e.blendMode)},t.checkPolygonOffset=function(t,e){t.setPolygonOffset(1,e.polygonOffset)},t.prototype.destroy=function(){this.gl=null},t}(),Ep=function(){function t(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=uu.GC_MAX_IDLE,this.checkCountMax=uu.GC_MAX_CHECK_COUNT,this.mode=uu.GC_MODE}return t.prototype.postrender=function(){this.renderer.renderingToScreen&&(this.count++,this.mode!==ou.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},t.prototype.run=function(){for(var t=this.renderer.texture,e=t.managedTextures,i=!1,r=0;r<e.length;r++){var n=e[r];!n.framebuffer&&this.count-n.touched>this.maxIdle&&(t.destroyTexture(n,!0),e[r]=null,i=!0)}if(i){var o=0;for(r=0;r<e.length;r++)null!==e[r]&&(e[o++]=e[r]);e.length=o}},t.prototype.unload=function(t){var e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(var r=t.children.length-1;r>=0;r--)this.unload(t.children[r])},t.prototype.destroy=function(){this.renderer=null},t}();var Sp=function(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=Jc.UNSIGNED_BYTE,this.internalFormat=Zc.RGBA,this.samplerType=0},Ap=function(){function t(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new Nh,this.hasIntegerTextures=!1}return t.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function(t){var e,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,x,b,w,T;return"WebGL2RenderingContext"in self&&t instanceof self.WebGL2RenderingContext?((e={})[Jc.UNSIGNED_BYTE]=((i={})[Zc.RGBA]=t.RGBA8,i[Zc.RGB]=t.RGB8,i[Zc.RG]=t.RG8,i[Zc.RED]=t.R8,i[Zc.RGBA_INTEGER]=t.RGBA8UI,i[Zc.RGB_INTEGER]=t.RGB8UI,i[Zc.RG_INTEGER]=t.RG8UI,i[Zc.RED_INTEGER]=t.R8UI,i[Zc.ALPHA]=t.ALPHA,i[Zc.LUMINANCE]=t.LUMINANCE,i[Zc.LUMINANCE_ALPHA]=t.LUMINANCE_ALPHA,i),e[Jc.BYTE]=((r={})[Zc.RGBA]=t.RGBA8_SNORM,r[Zc.RGB]=t.RGB8_SNORM,r[Zc.RG]=t.RG8_SNORM,r[Zc.RED]=t.R8_SNORM,r[Zc.RGBA_INTEGER]=t.RGBA8I,r[Zc.RGB_INTEGER]=t.RGB8I,r[Zc.RG_INTEGER]=t.RG8I,r[Zc.RED_INTEGER]=t.R8I,r),e[Jc.UNSIGNED_SHORT]=((n={})[Zc.RGBA_INTEGER]=t.RGBA16UI,n[Zc.RGB_INTEGER]=t.RGB16UI,n[Zc.RG_INTEGER]=t.RG16UI,n[Zc.RED_INTEGER]=t.R16UI,n[Zc.DEPTH_COMPONENT]=t.DEPTH_COMPONENT16,n),e[Jc.SHORT]=((o={})[Zc.RGBA_INTEGER]=t.RGBA16I,o[Zc.RGB_INTEGER]=t.RGB16I,o[Zc.RG_INTEGER]=t.RG16I,o[Zc.RED_INTEGER]=t.R16I,o),e[Jc.UNSIGNED_INT]=((s={})[Zc.RGBA_INTEGER]=t.RGBA32UI,s[Zc.RGB_INTEGER]=t.RGB32UI,s[Zc.RG_INTEGER]=t.RG32UI,s[Zc.RED_INTEGER]=t.R32UI,s[Zc.DEPTH_COMPONENT]=t.DEPTH_COMPONENT24,s),e[Jc.INT]=((a={})[Zc.RGBA_INTEGER]=t.RGBA32I,a[Zc.RGB_INTEGER]=t.RGB32I,a[Zc.RG_INTEGER]=t.RG32I,a[Zc.RED_INTEGER]=t.R32I,a),e[Jc.FLOAT]=((l={})[Zc.RGBA]=t.RGBA32F,l[Zc.RGB]=t.RGB32F,l[Zc.RG]=t.RG32F,l[Zc.RED]=t.R32F,l[Zc.DEPTH_COMPONENT]=t.DEPTH_COMPONENT32F,l),e[Jc.HALF_FLOAT]=((c={})[Zc.RGBA]=t.RGBA16F,c[Zc.RGB]=t.RGB16F,c[Zc.RG]=t.RG16F,c[Zc.RED]=t.R16F,c),e[Jc.UNSIGNED_SHORT_5_6_5]=((u={})[Zc.RGB]=t.RGB565,u),e[Jc.UNSIGNED_SHORT_4_4_4_4]=((h={})[Zc.RGBA]=t.RGBA4,h),e[Jc.UNSIGNED_SHORT_5_5_5_1]=((d={})[Zc.RGBA]=t.RGB5_A1,d),e[Jc.UNSIGNED_INT_2_10_10_10_REV]=((p={})[Zc.RGBA]=t.RGB10_A2,p[Zc.RGBA_INTEGER]=t.RGB10_A2UI,p),e[Jc.UNSIGNED_INT_10F_11F_11F_REV]=((f={})[Zc.RGB]=t.R11F_G11F_B10F,f),e[Jc.UNSIGNED_INT_5_9_9_9_REV]=((m={})[Zc.RGB]=t.RGB9_E5,m),e[Jc.UNSIGNED_INT_24_8]=((g={})[Zc.DEPTH_STENCIL]=t.DEPTH24_STENCIL8,g),e[Jc.FLOAT_32_UNSIGNED_INT_24_8_REV]=((_={})[Zc.DEPTH_STENCIL]=t.DEPTH32F_STENCIL8,_),T=e):((y={})[Jc.UNSIGNED_BYTE]=((v={})[Zc.RGBA]=t.RGBA,v[Zc.RGB]=t.RGB,v[Zc.ALPHA]=t.ALPHA,v[Zc.LUMINANCE]=t.LUMINANCE,v[Zc.LUMINANCE_ALPHA]=t.LUMINANCE_ALPHA,v),y[Jc.UNSIGNED_SHORT_5_6_5]=((x={})[Zc.RGB]=t.RGB,x),y[Jc.UNSIGNED_SHORT_4_4_4_4]=((b={})[Zc.RGBA]=t.RGBA,b),y[Jc.UNSIGNED_SHORT_5_5_5_1]=((w={})[Zc.RGBA]=t.RGBA,w),T=y),T}(t);var e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(var i=0;i<e;i++)this.boundTextures[i]=null;this.emptyTextures={};var r=new Sp(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Sp(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(i=0;i<6;i++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(i=0;i<this.boundTextures.length;i++)this.bind(null,i)},t.prototype.bind=function(t,e){void 0===e&&(e=0);var i=this.gl;if((t=null==t?void 0:t.castToBaseTexture())&&t.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;var r=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,r.texture)),r.dirtyId!==t.dirtyId&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null},t.prototype.reset=function(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(var t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture},t.prototype.unbind=function(t){var e=this.gl,i=this.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var r=0;r<i.length;r++)i[r]===this.unknownTexture&&this.bind(null,r)}for(r=0;r<i.length;r++)i[r]===t&&(this.currentLocation!==r&&(e.activeTexture(e.TEXTURE0+r),this.currentLocation=r),e.bindTexture(t.target,this.emptyTextures[t.target].texture),i[r]=null)},t.prototype.ensureSamplerType=function(t){var e=this.boundTextures,i=this.hasIntegerTextures,r=this.CONTEXT_UID;if(i)for(var n=t-1;n>=0;--n){var o=e[n];if(o)o._glTextures[r].samplerType!==Qc.FLOAT&&this.renderer.texture.unbind(o)}},t.prototype.initTexture=function(t){var e=new Sp(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e},t.prototype.initTextureType=function(t,e){var i,r;e.internalFormat=null!==(r=null===(i=this.internalFormats[t.type])||void 0===i?void 0:i[t.format])&&void 0!==r?r:t.format,2===this.webGLVersion&&t.type===Jc.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type},t.prototype.updateTexture=function(t){var e=t._glTextures[this.CONTEXT_UID];if(e){var i=this.renderer;if(this.initTextureType(t,e),t.resource&&t.resource.upload(i,t,e))e.samplerType!==Qc.FLOAT&&(this.hasIntegerTextures=!0);else{var r=t.realWidth,n=t.realHeight,o=i.gl;(e.width!==r||e.height!==n||e.dirtyId<0)&&(e.width=r,e.height=n,o.texImage2D(t.target,0,e.internalFormat,r,n,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}},t.prototype.destroyTexture=function(t,e){var i=this.gl;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){var r=this.managedTextures.indexOf(t);-1!==r&&Ru(this.managedTextures,r,1)}},t.prototype.updateTextureStyle=function(t){var e=t._glTextures[this.CONTEXT_UID];e&&(t.mipmap!==iu.POW2&&2===this.webGLVersion||t.isPowerOfTwo?e.mipmap=t.mipmap>=1:e.mipmap=!1,2===this.webGLVersion||t.isPowerOfTwo?e.wrapMode=t.wrapMode:e.wrapMode=eu.CLAMP,t.resource&&t.resource.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)},t.prototype.setStyle=function(t,e){var i=this.gl;if(e.mipmap&&t.mipmap!==iu.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===tu.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);var r=this.renderer.context.extensions.anisotropicFiltering;if(r&&t.anisotropicLevel>0&&t.scaleMode===tu.LINEAR){var n=Math.min(t.anisotropicLevel,i.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,r.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===tu.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===tu.LINEAR?i.LINEAR:i.NEAREST)},t.prototype.destroy=function(){this.renderer=null},t}(),Mp={__proto__:null,FilterSystem:xd,BatchSystem:wd,ContextSystem:Ed,FramebufferSystem:Md,GeometrySystem:Cd,MaskSystem:sp,ScissorSystem:lp,StencilSystem:cp,ProjectionSystem:up,RenderTextureSystem:pp,ShaderSystem:wp,StateSystem:Tp,TextureGCSystem:Ep,TextureSystem:Ap},Ip=new th,Cp=function(t){function e(e,i){void 0===e&&(e=qc.UNKNOWN);var r=t.call(this)||this;return i=Object.assign({},uu.RENDER_OPTIONS,i),r.options=i,r.type=e,r.screen=new Wu(0,0,i.width,i.height),r.view=i.view||document.createElement("canvas"),r.resolution=i.resolution||uu.RESOLUTION,r.useContextAlpha=i.useContextAlpha,r.autoDensity=!!i.autoDensity,r.preserveDrawingBuffer=i.preserveDrawingBuffer,r.clearBeforeRender=i.clearBeforeRender,r._backgroundColor=0,r._backgroundColorRgba=[0,0,0,1],r._backgroundColorString="#000000",r.backgroundColor=i.backgroundColor||r._backgroundColor,r.backgroundAlpha=i.backgroundAlpha,void 0!==i.transparent&&(Bu("6.0.0","Option transparent is deprecated, please use backgroundAlpha instead."),r.useContextAlpha=i.transparent,r.backgroundAlpha=i.transparent?0:1),r._lastObjectRendered=null,r.plugins={},r}return Lh(e,t),e.prototype.initPlugins=function(t){for(var e in t)this.plugins[e]=new t[e](this)},Object.defineProperty(e.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),e.prototype.resize=function(t,e){this.view.width=Math.round(t*this.resolution),this.view.height=Math.round(e*this.resolution);var i=this.view.width/this.resolution,r=this.view.height/this.resolution;this.screen.width=i,this.screen.height=r,this.autoDensity&&(this.view.style.width=i+"px",this.view.style.height=r+"px"),this.emit("resize",i,r)},e.prototype.generateTexture=function(t,e,i,r){void 0===e&&(e={}),"number"==typeof e&&(Bu("6.1.0","generateTexture options (scaleMode, resolution, region) are now object options."),e={scaleMode:e,resolution:i,region:r});var n=e.region,o=function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(t);n<r.length;n++)e.indexOf(r[n])<0&&(i[r[n]]=t[r[n]])}return i}(e,["region"]);0===(r=n||t.getLocalBounds(null,!0)).width&&(r.width=1),0===r.height&&(r.height=1);var s=rd.create(kh({width:r.width,height:r.height},o));return Ip.tx=-r.x,Ip.ty=-r.y,this.render(t,{renderTexture:s,clear:!1,transform:Ip,skipUpdateTransform:!!t.parent}),s},e.prototype.destroy=function(t){for(var e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null;t&&this.view.parentNode&&this.view.parentNode.removeChild(this.view);this.plugins=null,this.type=qc.UNKNOWN,this.view=null,this.screen=null,this._tempDisplayObjectParent=null,this.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(e.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this._backgroundColorString=bu(t),xu(t,this._backgroundColorRgba)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"backgroundAlpha",{get:function(){return this._backgroundColorRgba[3]},set:function(t){this._backgroundColorRgba[3]=t},enumerable:!1,configurable:!0}),e}(du.a),Pp=function(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0},Rp=function(){function t(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}return t.prototype.destroy=function(){this.renderer=null},t.prototype.contextChange=function(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID},t.prototype.bind=function(t){var e=this.gl,i=this.CONTEXT_UID,r=t._glBuffers[i]||this.createGLBuffer(t);e.bindBuffer(t.type,r.buffer)},t.prototype.bindBufferBase=function(t,e){var i=this.gl,r=this.CONTEXT_UID;if(this.boundBufferBases[e]!==t){var n=t._glBuffers[r]||this.createGLBuffer(t);this.boundBufferBases[e]=t,i.bindBufferBase(i.UNIFORM_BUFFER,e,n.buffer)}},t.prototype.bindBufferRange=function(t,e,i){var r=this.gl,n=this.CONTEXT_UID;i=i||0;var o=t._glBuffers[n]||this.createGLBuffer(t);r.bindBufferRange(r.UNIFORM_BUFFER,e||0,o.buffer,256*i,256)},t.prototype.update=function(t){var e=this.gl,i=this.CONTEXT_UID,r=t._glBuffers[i];if(t._updateID!==r.updateID)if(r.updateID=t._updateID,e.bindBuffer(t.type,r.buffer),r.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{var n=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;r.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,n)}},t.prototype.dispose=function(t,e){if(this.managedBuffers[t.id]){delete this.managedBuffers[t.id];var i=t._glBuffers[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this),i&&(e||r.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}},t.prototype.disposeAll=function(t){for(var e=Object.keys(this.managedBuffers),i=0;i<e.length;i++)this.dispose(this.managedBuffers[e[i]],t)},t.prototype.createGLBuffer=function(t){var e=this.CONTEXT_UID,i=this.gl;return t._glBuffers[e]=new Pp(i.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]},t}(),Op=function(t){function e(i){var r=t.call(this,qc.WEBGL,i)||this;return i=r.options,r.gl=null,r.CONTEXT_UID=0,r.runners={destroy:new Ph("destroy"),contextChange:new Ph("contextChange"),reset:new Ph("reset"),update:new Ph("update"),postrender:new Ph("postrender"),prerender:new Ph("prerender"),resize:new Ph("resize")},r.runners.contextChange.add(r),r.globalUniforms=new gd({projectionMatrix:new th},!0),r.addSystem(sp,"mask").addSystem(Ed,"context").addSystem(Tp,"state").addSystem(wp,"shader").addSystem(Ap,"texture").addSystem(Rp,"buffer").addSystem(Cd,"geometry").addSystem(Md,"framebuffer").addSystem(lp,"scissor").addSystem(cp,"stencil").addSystem(up,"projection").addSystem(Ep,"textureGC").addSystem(xd,"filter").addSystem(pp,"renderTexture").addSystem(wd,"batch"),r.initPlugins(e.__plugins),r.multisample=void 0,i.context?r.context.initFromContext(i.context):r.context.initFromOptions({alpha:!!r.useContextAlpha,antialias:i.antialias,premultipliedAlpha:r.useContextAlpha&&"notMultiplied"!==r.useContextAlpha,stencil:!0,preserveDrawingBuffer:i.preserveDrawingBuffer,powerPreference:r.options.powerPreference}),r.renderingToScreen=!0,function(t){var e;if(!yu){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var i=["\n %c %c %c PixiJS 6.1.3 -  "+t+"   %c  %c  http://www.pixijs.com/  %c %c %c%c \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(e=self.console).log.apply(e,i)}else self.console&&self.console.log("PixiJS 6.1.3 - "+t+" - http://www.pixijs.com/");yu=!0}}(2===r.context.webGLVersion?"WebGL 2":"WebGL 1"),r.resize(r.options.width,r.options.height),r}return Lh(e,t),e.create=function(t){if(void 0===_u&&(_u=function(){var t={stencil:!0,failIfMajorPerformanceCaveat:uu.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!self.WebGLRenderingContext)return!1;var e=document.createElement("canvas"),i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),r=!(!i||!i.getContextAttributes().stencil);if(i){var n=i.getExtension("WEBGL_lose_context");n&&n.loseContext()}return i=null,r}catch(t){return!1}}()),_u)return new e(t);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},e.prototype.contextChange=function(){var t,e=this.gl;if(1===this.context.webGLVersion){var i=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,i)}else{i=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,i)}t>=lu.HIGH?this.multisample=lu.HIGH:t>=lu.MEDIUM?this.multisample=lu.MEDIUM:t>=lu.LOW?this.multisample=lu.LOW:this.multisample=lu.NONE},e.prototype.addSystem=function(t,e){var i=new t(this);if(this[e])throw new Error('Whoops! The name "'+e+'" is already in use');for(var r in this[e]=i,this.runners)this.runners[r].add(i);return this},e.prototype.render=function(t,e){var i,r,n,o;if(e&&(e instanceof rd?(Bu("6.0.0","Renderer#render arguments changed, use options instead."),i=e,r=arguments[2],n=arguments[3],o=arguments[4]):(i=e.renderTexture,r=e.clear,n=e.transform,o=e.skipUpdateTransform)),this.renderingToScreen=!i,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=n,!this.context.isLost){if(i||(this._lastObjectRendered=t),!o){var s=t.enableTempParent();t.updateTransform(),t.disableTempParent(s)}this.renderTexture.bind(i),this.batch.currentRenderer.start(),(void 0!==r?r:this.clearBeforeRender)&&this.renderTexture.clear(),t.render(this),this.batch.currentRenderer.flush(),i&&i.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender")}},e.prototype.generateTexture=function(e,i,r,n){void 0===i&&(i={});var o=t.prototype.generateTexture.call(this,e,i,r,n);return this.framebuffer.blit(),o},e.prototype.resize=function(e,i){t.prototype.resize.call(this,e,i),this.runners.resize.emit(this.screen.height,this.screen.width)},e.prototype.reset=function(){return this.runners.reset.emit(),this},e.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},e.prototype.destroy=function(e){for(var i in this.runners.destroy.emit(),this.runners)this.runners[i].destroy();t.prototype.destroy.call(this,e),this.gl=null},Object.defineProperty(e.prototype,"extract",{get:function(){return Bu("6.0.0","Renderer#extract has been deprecated, please use Renderer#plugins.extract instead."),this.plugins.extract},enumerable:!1,configurable:!0}),e.registerPlugin=function(t,i){e.__plugins=e.__plugins||{},e.__plugins[t]=i},e}(Cp);var Dp="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n",Lp=(function(){function t(t){Bu("6.1.0","System class is deprecated, implemement ISystem interface instead."),this.renderer=t}t.prototype.destroy=function(){this.renderer=null}}(),function(){this.texArray=null,this.blend=0,this.type=Yc.TRIANGLES,this.start=0,this.size=0,this.data=null}),kp=function(){function t(){this.elements=[],this.ids=[],this.count=0}return t.prototype.clear=function(){for(var t=0;t<this.count;t++)this.elements[t]=null;this.count=0},t}(),Bp=function(){function t(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}return Object.defineProperty(t.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),t.prototype.view=function(t){return this[t+"View"]},t.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},t.sizeOf=function(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(t+" isn't a valid view type")}},t}(),Fp=function(t){function e(e){var i=t.call(this,e)||this;return i.shaderGenerator=null,i.geometryClass=null,i.vertexSize=null,i.state=ep.for2d(),i.size=4*uu.SPRITE_BATCH_SIZE,i._vertexCount=0,i._indexCount=0,i._bufferedElements=[],i._bufferedTextures=[],i._bufferSize=0,i._shader=null,i._packedGeometries=[],i._packedGeometryPoolSize=2,i._flushId=0,i._aBuffers={},i._iBuffers={},i.MAX_TEXTURES=1,i.renderer.on("prerender",i.onPrerender,i),e.runners.contextChange.add(i),i._dcIndex=0,i._aIndex=0,i._iIndex=0,i._attributeBuffer=null,i._indexBuffer=null,i._tempBoundTextures=[],i}return Lh(e,t),e.prototype.contextChange=function(){var t=this.renderer.gl;uu.PREFER_ENV===Hc.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),uu.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=function(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var i=e.createShader(e.FRAGMENT_SHADER);;){var r=Yd.replace(/%forloop%/gi,Zd(t));if(e.shaderSource(i,r),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS))break;t=t/2|0}return t}(this.MAX_TEXTURES,t)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()},e.prototype.initFlushBuffers=function(){for(var t=e._drawCallPool,i=e._textureArrayPool,r=this.size/4,n=Math.floor(r/this.MAX_TEXTURES)+1;t.length<r;)t.push(new Lp);for(;i.length<n;)i.push(new kp);for(var o=0;o<this.MAX_TEXTURES;o++)this._tempBoundTextures[o]=null},e.prototype.onPrerender=function(){this._flushId=0},e.prototype.render=function(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)},e.prototype.buildTexturesAndDrawCalls=function(){var t=this._bufferedTextures,i=this.MAX_TEXTURES,r=e._textureArrayPool,n=this.renderer.batch,o=this._tempBoundTextures,s=this.renderer.textureGC.count,a=++Nh._globalBatch,l=0,c=r[0],u=0;n.copyBoundTextures(o,i);for(var h=0;h<this._bufferSize;++h){var d=t[h];t[h]=null,d._batchEnabled!==a&&(c.count>=i&&(n.boundArray(c,o,a,i),this.buildDrawCalls(c,u,h),u=h,c=r[++l],++a),d._batchEnabled=a,d.touched=s,c.elements[c.count++]=d)}c.count>0&&(n.boundArray(c,o,a,i),this.buildDrawCalls(c,u,this._bufferSize),++l,++a);for(h=0;h<o.length;h++)o[h]=null;Nh._globalBatch=a},e.prototype.buildDrawCalls=function(t,i,r){var n=this._bufferedElements,o=this._attributeBuffer,s=this._indexBuffer,a=this.vertexSize,l=e._drawCallPool,c=this._dcIndex,u=this._aIndex,h=this._iIndex,d=l[c];d.start=this._iIndex,d.texArray=t;for(var p=i;p<r;++p){var f=n[p],m=f._texture.baseTexture,g=Tu[m.alphaMode?1:0][f.blendMode];n[p]=null,i<p&&d.blend!==g&&(d.size=h-d.start,i=p,(d=l[++c]).texArray=t,d.start=h),this.packInterleavedGeometry(f,o,s,u,h),u+=f.vertexData.length/2*a,h+=f.indices.length,d.blend=g}i<r&&(d.size=h-d.start,++c),this._dcIndex=c,this._aIndex=u,this._iIndex=h},e.prototype.bindAndClearTexArray=function(t){for(var e=this.renderer.texture,i=0;i<t.count;i++)e.bind(t.elements[i],t.ids[i]),t.elements[i]=null;t.count=0},e.prototype.updateGeometry=function(){var t=this._packedGeometries,e=this._attributeBuffer,i=this._indexBuffer;uu.CAN_UPLOAD_SAME_BUFFER?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},e.prototype.drawBatches=function(){for(var t=this._dcIndex,i=this.renderer,r=i.gl,n=i.state,o=e._drawCallPool,s=null,a=0;a<t;a++){var l=o[a],c=l.texArray,u=l.type,h=l.size,d=l.start,p=l.blend;s!==c&&(s=c,this.bindAndClearTexArray(c)),this.state.blendMode=p,n.set(this.state),r.drawElements(u,h,r.UNSIGNED_SHORT,2*d)}},e.prototype.flush=function(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},e.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),uu.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},e.prototype.stop=function(){this.flush()},e.prototype.destroy=function(){for(var e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),t.prototype.destroy.call(this)},e.prototype.getAttributeBuffer=function(t){var e=Iu(Math.ceil(t/8)),i=Pu(e),r=8*e;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);var n=this._aBuffers[r];return n||(this._aBuffers[r]=n=new Bp(r*this.vertexSize*4)),n},e.prototype.getIndexBuffer=function(t){var e=Iu(Math.ceil(t/12)),i=Pu(e),r=12*e;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);var n=this._iBuffers[i];return n||(this._iBuffers[i]=n=new Uint16Array(r)),n},e.prototype.packInterleavedGeometry=function(t,e,i,r,n){for(var o=e.uint32View,s=e.float32View,a=r/this.vertexSize,l=t.uvs,c=t.indices,u=t.vertexData,h=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),p=d<1&&t._texture.baseTexture.alphaMode?Su(t._tintRGB,d):t._tintRGB+(255*d<<24),f=0;f<u.length;f+=2)s[r++]=u[f],s[r++]=u[f+1],s[r++]=l[f],s[r++]=l[f+1],o[r++]=p,s[r++]=h;for(f=0;f<c.length;f++)i[n++]=a+c[f]},e._drawCallPool=[],e._textureArrayPool=[],e}(bd),zp=function(){function t(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},e.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(e.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}return t.prototype.generateShader=function(t){if(!this.programCache[t]){for(var e=new Int32Array(t),i=0;i<t;i++)e[i]=i;this.defaultGroupCache[t]=gd.from({uSamplers:e},!0);var r=this.fragTemplate;r=(r=r.replace(/%count%/gi,""+t)).replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Qd(this.vertexSrc,r)}var n={tint:new Float32Array([1,1,1,1]),translationMatrix:new th,default:this.defaultGroupCache[t]};return new tp(this.programCache[t],n)},t.prototype.generateSampleSrc=function(t){var e="";e+="\n",e+="\n";for(var i=0;i<t;i++)i>0&&(e+="\nelse "),i<t-1&&(e+="if(vTextureId < "+i+".5)"),e+="\n{",e+="\n\tcolor = texture2D(uSamplers["+i+"], vTextureCoord);",e+="\n}";return e+="\n",e+="\n"},t}(),Np=function(t){function e(e){void 0===e&&(e=!1);var i=t.call(this)||this;return i._buffer=new ad(null,e,!1),i._indexBuffer=new ad(null,e,!0),i.addAttribute("aVertexPosition",i._buffer,2,!1,Jc.FLOAT).addAttribute("aTextureCoord",i._buffer,2,!1,Jc.FLOAT).addAttribute("aColor",i._buffer,4,!0,Jc.UNSIGNED_BYTE).addAttribute("aTextureId",i._buffer,1,!0,Jc.FLOAT).addIndex(i._indexBuffer),i}return Lh(e,t),e}(dd),Up="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n",Gp="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n",jp=function(){function t(){}return t.create=function(t){var e=Object.assign({vertex:Up,fragment:Gp,geometryClass:Np,vertexSize:6},t),i=e.vertex,r=e.fragment,n=e.vertexSize,o=e.geometryClass;return function(t){function e(e){var s=t.call(this,e)||this;return s.shaderGenerator=new zp(i,r),s.geometryClass=o,s.vertexSize=n,s}return Lh(e,t),e}(Fp)},Object.defineProperty(t,"defaultVertexSrc",{get:function(){return Up},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultFragmentTemplate",{get:function(){return Gp},enumerable:!1,configurable:!0}),t}().create(),Vp={},Xp=function(t){Object.defineProperty(Vp,t,{get:function(){return Bu("6.0.0","PIXI.systems."+t+" has moved to PIXI."+t),Yh[t]}})};for(var Hp in Yh)Xp(Hp);var qp={},Wp=function(t){Object.defineProperty(qp,t,{get:function(){return Bu("6.0.0","PIXI.resources."+t+" has moved to PIXI."+t),Mp[t]}})};for(var Hp in Mp)Wp(Hp);var $p=function(){function t(e){var i=this;this.stage=new gh,e=Object.assign({forceCanvas:!1},e),this.renderer=function(t){return Op.create(t)}(e),t._plugins.forEach((function(t){t.init.call(i,e)}))}return t.registerPlugin=function(e){t._plugins.push(e)},t.prototype.render=function(){this.renderer.render(this.stage)},Object.defineProperty(t.prototype,"view",{get:function(){return this.renderer.view},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"screen",{get:function(){return this.renderer.screen},enumerable:!1,configurable:!0}),t.prototype.destroy=function(e,i){var r=this,n=t._plugins.slice(0);n.reverse(),n.forEach((function(t){t.destroy.call(r)})),this.stage.destroy(i),this.stage=null,this.renderer.destroy(e),this.renderer=null},t._plugins=[],t}(),Yp=function(){function t(){}return t.init=function(t){var e=this;Object.defineProperty(this,"resizeTo",{set:function(t){self.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(self.addEventListener("resize",this.queueResize),this.resize())},get:function(){return this._resizeTo}}),this.queueResize=function(){e._resizeTo&&(e.cancelResize(),e._resizeId=requestAnimationFrame((function(){return e.resize()})))},this.cancelResize=function(){e._resizeId&&(cancelAnimationFrame(e._resizeId),e._resizeId=null)},this.resize=function(){if(e._resizeTo){var t,i;if(e.cancelResize(),e._resizeTo===self)t=self.innerWidth,i=self.innerHeight;else{var r=e._resizeTo;t=r.clientWidth,i=r.clientHeight}e.renderer.resize(t,i)}},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null},t.destroy=function(){self.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null},t}();$p.registerPlugin(Yp);var Zp=new Wu,Kp=function(){function t(t){this.renderer=t}return t.prototype.image=function(t,e,i){var r=new Image;return r.src=this.base64(t,e,i),r},t.prototype.base64=function(t,e,i){return this.canvas(t).toDataURL(e,i)},t.prototype.canvas=function(e){var i,r,n,o=this.renderer,s=!1,a=!1;e&&(e instanceof rd?n=e:(n=this.renderer.generateTexture(e),a=!0)),n?(i=n.baseTexture.resolution,r=n.frame,s=!1,o.renderTexture.bind(n)):(i=this.renderer.resolution,s=!0,(r=Zp).width=this.renderer.width,r.height=this.renderer.height,o.renderTexture.bind(null));var l=Math.floor(r.width*i+1e-4),c=Math.floor(r.height*i+1e-4),u=new Uu(l,c,1),h=new Uint8Array(4*l*c),d=o.gl;d.readPixels(r.x*i,r.y*i,l,c,d.RGBA,d.UNSIGNED_BYTE,h);var p=u.context.getImageData(0,0,l,c);if(t.arrayPostDivide(h,p.data),u.context.putImageData(p,0,0),s){var f=new Uu(u.width,u.height,1);f.context.scale(1,-1),f.context.drawImage(u.canvas,0,-c),u.destroy(),u=f}return a&&n.destroy(!0),u.canvas},t.prototype.pixels=function(e){var i,r,n,o=this.renderer,s=!1;e&&(e instanceof rd?n=e:(n=this.renderer.generateTexture(e),s=!0)),n?(i=n.baseTexture.resolution,r=n.frame,o.renderTexture.bind(n)):(i=o.resolution,(r=Zp).width=o.width,r.height=o.height,o.renderTexture.bind(null));var a=r.width*i,l=r.height*i,c=new Uint8Array(4*a*l),u=o.gl;return u.readPixels(r.x*i,r.y*i,a,l,u.RGBA,u.UNSIGNED_BYTE,c),s&&n.destroy(!0),t.arrayPostDivide(c,c),c},t.prototype.destroy=function(){this.renderer=null},t.arrayPostDivide=function(t,e){for(var i=0;i<t.length;i+=4){var r=e[i+3]=t[i+3];0!==r?(e[i]=Math.round(Math.min(255*t[i]/r,255)),e[i+1]=Math.round(Math.min(255*t[i+1]/r,255)),e[i+2]=Math.round(Math.min(255*t[i+2]/r,255))):(e[i]=t[i],e[i+1]=t[i+1],e[i+2]=t[i+2])}},t}(),Jp=function(){function t(t,e,i){void 0===e&&(e=!1),this._fn=t,this._once=e,this._thisArg=i,this._next=this._prev=this._owner=null}return t.prototype.detach=function(){return null!==this._owner&&(this._owner.detach(this),!0)},t}();function Qp(t,e){return t._head?(t._tail._next=e,e._prev=t._tail,t._tail=e):(t._head=e,t._tail=e),e._owner=t,e}var tf=function(){function t(){this._head=this._tail=void 0}return t.prototype.handlers=function(t){void 0===t&&(t=!1);var e=this._head;if(t)return!!e;for(var i=[];e;)i.push(e),e=e._next;return i},t.prototype.has=function(t){if(!(t instanceof Jp))throw new Error("MiniSignal#has(): First arg must be a SignalBinding object.");return t._owner===this},t.prototype.dispatch=function(){for(var t=arguments,e=[],i=0;i<arguments.length;i++)e[i]=t[i];var r=this._head;if(!r)return!1;for(;r;)r._once&&this.detach(r),r._fn.apply(r._thisArg,e),r=r._next;return!0},t.prototype.add=function(t,e){if(void 0===e&&(e=null),"function"!=typeof t)throw new Error("MiniSignal#add(): First arg must be a Function.");return Qp(this,new Jp(t,!1,e))},t.prototype.once=function(t,e){if(void 0===e&&(e=null),"function"!=typeof t)throw new Error("MiniSignal#once(): First arg must be a Function.");return Qp(this,new Jp(t,!0,e))},t.prototype.detach=function(t){if(!(t instanceof Jp))throw new Error("MiniSignal#detach(): First arg must be a SignalBinding object.");return t._owner!==this||(t._prev&&(t._prev._next=t._next),t._next&&(t._next._prev=t._prev),t===this._head?(this._head=t._next,null===t._next&&(this._tail=null)):t===this._tail&&(this._tail=t._prev,this._tail._next=null),t._owner=null),this},t.prototype.detachAll=function(){var t=this._head;if(!t)return this;for(this._head=this._tail=null;t;)t._owner=null,t=t._next;return this},t}();function ef(t,e){e=e||{};for(var i={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},r=i.parser[e.strictMode?"strict":"loose"].exec(t),n={},o=14;o--;)n[i.key[o]]=r[o]||"";return n[i.q.name]={},n[i.key[12]].replace(i.q.parser,(function(t,e,r){e&&(n[i.q.name][e]=r)})),n}var rf=!(!self.XDomainRequest||"withCredentials"in new XMLHttpRequest),nf=null;function of(){}function sf(t,e,i){e&&0===e.indexOf(".")&&(e=e.substring(1)),e&&(t[e]=i)}function af(t){return t.toString().replace("object ","")}var lf=function(){function t(e,i,r){if(this._dequeue=of,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=null,this._boundOnError=null,this._boundOnProgress=null,this._boundOnTimeout=null,this._boundXhrOnError=null,this._boundXhrOnTimeout=null,this._boundXhrOnAbort=null,this._boundXhrOnLoad=null,"string"!=typeof e||"string"!=typeof i)throw new Error("Both name and url are required for constructing a resource.");r=r||{},this._flags=0,this._setFlag(t.STATUS_FLAGS.DATA_URL,0===i.indexOf("data:")),this.name=e,this.url=i,this.extension=this._getExtension(),this.data=null,this.crossOrigin=!0===r.crossOrigin?"anonymous":r.crossOrigin,this.timeout=r.timeout||0,this.loadType=r.loadType||this._determineLoadType(),this.xhrType=r.xhrType,this.metadata=r.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=t.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=of,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundOnTimeout=this._onTimeout.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this.onStart=new tf,this.onProgress=new tf,this.onComplete=new tf,this.onAfterMiddleware=new tf}return t.setExtensionLoadType=function(e,i){sf(t._loadTypeMap,e,i)},t.setExtensionXhrType=function(e,i){sf(t._xhrTypeMap,e,i)},Object.defineProperty(t.prototype,"isDataUrl",{get:function(){return this._hasFlag(t.STATUS_FLAGS.DATA_URL)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isComplete",{get:function(){return this._hasFlag(t.STATUS_FLAGS.COMPLETE)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLoading",{get:function(){return this._hasFlag(t.STATUS_FLAGS.LOADING)},enumerable:!1,configurable:!0}),t.prototype.complete=function(){this._clearEvents(),this._finish()},t.prototype.abort=function(e){if(!this.error){if(this.error=new Error(e),this._clearEvents(),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=t.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}},t.prototype.load=function(e){var i=this;if(!this.isLoading)if(this.isComplete)e&&setTimeout((function(){return e(i)}),1);else switch(e&&this.onComplete.once(e),this._setFlag(t.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),!1!==this.crossOrigin&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case t.LOAD_TYPE.IMAGE:this.type=t.TYPE.IMAGE,this._loadElement("image");break;case t.LOAD_TYPE.AUDIO:this.type=t.TYPE.AUDIO,this._loadSourceElement("audio");break;case t.LOAD_TYPE.VIDEO:this.type=t.TYPE.VIDEO,this._loadSourceElement("video");break;case t.LOAD_TYPE.XHR:default:rf&&this.crossOrigin?this._loadXdr():this._loadXhr()}},t.prototype._hasFlag=function(t){return 0!=(this._flags&t)},t.prototype._setFlag=function(t,e){this._flags=e?this._flags|t:this._flags&~t},t.prototype._clearEvents=function(){clearTimeout(this._elementTimer),this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))},t.prototype._finish=function(){if(this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(t.STATUS_FLAGS.COMPLETE,!0),this._setFlag(t.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},t.prototype._loadElement=function(t){this.metadata.loadElement?this.data=this.metadata.loadElement:"image"===t&&void 0!==self.Image?this.data=new Image:this.data=document.createElement(t),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},t.prototype._loadSourceElement=function(t){if(this.metadata.loadElement?this.data=this.metadata.loadElement:"audio"===t&&void 0!==self.Audio?this.data=new Audio:this.data=document.createElement(t),null!==this.data){if(this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var e=this.metadata.mimeType,i=0;i<this.url.length;++i)this.data.appendChild(this._createSource(t,this.url[i],Array.isArray(e)?e[i]:e));else{e=this.metadata.mimeType;this.data.appendChild(this._createSource(t,this.url,Array.isArray(e)?e[0]:e))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load(),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))}else this.abort("Unsupported element: "+t)},t.prototype._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var e=this.xhr=new XMLHttpRequest;e.open("GET",this.url,!0),e.timeout=this.timeout,this.xhrType===t.XHR_RESPONSE_TYPE.JSON||this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT?e.responseType=t.XHR_RESPONSE_TYPE.TEXT:e.responseType=this.xhrType,e.addEventListener("error",this._boundXhrOnError,!1),e.addEventListener("timeout",this._boundXhrOnTimeout,!1),e.addEventListener("abort",this._boundXhrOnAbort,!1),e.addEventListener("progress",this._boundOnProgress,!1),e.addEventListener("load",this._boundXhrOnLoad,!1),e.send()},t.prototype._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new self.XDomainRequest;t.timeout=this.timeout||5e3,t.onerror=this._boundXhrOnError,t.ontimeout=this._boundXhrOnTimeout,t.onprogress=this._boundOnProgress,t.onload=this._boundXhrOnLoad,t.open("GET",this.url,!0),setTimeout((function(){return t.send()}),1)},t.prototype._createSource=function(t,e,i){i||(i=t+"/"+this._getExtension(e));var r=document.createElement("source");return r.src=e,r.type=i,r},t.prototype._onError=function(t){this.abort("Failed to load element using: "+t.target.nodeName)},t.prototype._onProgress=function(t){t&&t.lengthComputable&&this.onProgress.dispatch(this,t.loaded/t.total)},t.prototype._onTimeout=function(){this.abort("Load timed out.")},t.prototype._xhrOnError=function(){var t=this.xhr;this.abort(af(t)+" Request failed. Status: "+t.status+', text: "'+t.statusText+'"')},t.prototype._xhrOnTimeout=function(){var t=this.xhr;this.abort(af(t)+" Request timed out.")},t.prototype._xhrOnAbort=function(){var t=this.xhr;this.abort(af(t)+" Request was aborted by the user.")},t.prototype._xhrOnLoad=function(){var e=this.xhr,i="",r=void 0===e.status?200:e.status;if(""!==e.responseType&&"text"!==e.responseType&&void 0!==e.responseType||(i=e.responseText),0===r&&(i.length>0||e.responseType===t.XHR_RESPONSE_TYPE.BUFFER)?r=200:1223===r&&(r=204),2===(r/100|0)){if(this.xhrType===t.XHR_RESPONSE_TYPE.TEXT)this.data=i,this.type=t.TYPE.TEXT;else if(this.xhrType===t.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(i),this.type=t.TYPE.JSON}catch(t){return void this.abort("Error trying to parse loaded json: "+t)}else if(this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT)try{if(self.DOMParser){var n=new DOMParser;this.data=n.parseFromString(i,"text/xml")}else{var o=document.createElement("div");o.innerHTML=i,this.data=o}this.type=t.TYPE.XML}catch(t){return void this.abort("Error trying to parse loaded xml: "+t)}else this.data=e.response||i;this.complete()}else this.abort("["+e.status+"] "+e.statusText+": "+e.responseURL)},t.prototype._determineCrossOrigin=function(t,e){if(0===t.indexOf("data:"))return"";if(self.origin!==self.location.origin)return"anonymous";e=e||self.location,nf||(nf=document.createElement("a")),nf.href=t;var i=ef(nf.href,{strictMode:!0}),r=!i.port&&""===e.port||i.port===e.port,n=i.protocol?i.protocol+":":"";return i.host===e.hostname&&r&&n===e.protocol?"":"anonymous"},t.prototype._determineXhrType=function(){return t._xhrTypeMap[this.extension]||t.XHR_RESPONSE_TYPE.TEXT},t.prototype._determineLoadType=function(){return t._loadTypeMap[this.extension]||t.LOAD_TYPE.XHR},t.prototype._getExtension=function(t){void 0===t&&(t=this.url);var e="";if(this.isDataUrl){var i=t.indexOf("/");e=t.substring(i+1,t.indexOf(";",i))}else{var r=t.indexOf("?"),n=t.indexOf("#"),o=Math.min(r>-1?r:t.length,n>-1?n:t.length);e=(t=t.substring(0,o)).substring(t.lastIndexOf(".")+1)}return e.toLowerCase()},t.prototype._getMimeFromXhrType=function(e){switch(e){case t.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case t.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case t.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case t.XHR_RESPONSE_TYPE.JSON:return"application/json";case t.XHR_RESPONSE_TYPE.DEFAULT:case t.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},t}();function cf(){}function uf(t){return function(){for(var e=arguments,i=[],r=0;r<arguments.length;r++)i[r]=e[r];if(null===t)throw new Error("Callback was already called.");var n=t;t=null,n.apply(this,i)}}!function(t){!function(t){t[t.NONE=0]="NONE",t[t.DATA_URL=1]="DATA_URL",t[t.COMPLETE=2]="COMPLETE",t[t.LOADING=4]="LOADING"}(t.STATUS_FLAGS||(t.STATUS_FLAGS={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.JSON=1]="JSON",t[t.XML=2]="XML",t[t.IMAGE=3]="IMAGE",t[t.AUDIO=4]="AUDIO",t[t.VIDEO=5]="VIDEO",t[t.TEXT=6]="TEXT"}(t.TYPE||(t.TYPE={})),function(t){t[t.XHR=1]="XHR",t[t.IMAGE=2]="IMAGE",t[t.AUDIO=3]="AUDIO",t[t.VIDEO=4]="VIDEO"}(t.LOAD_TYPE||(t.LOAD_TYPE={})),function(t){t.DEFAULT="text",t.BUFFER="arraybuffer",t.BLOB="blob",t.DOCUMENT="document",t.JSON="json",t.TEXT="text"}(t.XHR_RESPONSE_TYPE||(t.XHR_RESPONSE_TYPE={})),t._loadTypeMap={gif:t.LOAD_TYPE.IMAGE,png:t.LOAD_TYPE.IMAGE,bmp:t.LOAD_TYPE.IMAGE,jpg:t.LOAD_TYPE.IMAGE,jpeg:t.LOAD_TYPE.IMAGE,tif:t.LOAD_TYPE.IMAGE,tiff:t.LOAD_TYPE.IMAGE,webp:t.LOAD_TYPE.IMAGE,tga:t.LOAD_TYPE.IMAGE,svg:t.LOAD_TYPE.IMAGE,"svg+xml":t.LOAD_TYPE.IMAGE,mp3:t.LOAD_TYPE.AUDIO,ogg:t.LOAD_TYPE.AUDIO,wav:t.LOAD_TYPE.AUDIO,mp4:t.LOAD_TYPE.VIDEO,webm:t.LOAD_TYPE.VIDEO},t._xhrTypeMap={xhtml:t.XHR_RESPONSE_TYPE.DOCUMENT,html:t.XHR_RESPONSE_TYPE.DOCUMENT,htm:t.XHR_RESPONSE_TYPE.DOCUMENT,xml:t.XHR_RESPONSE_TYPE.DOCUMENT,tmx:t.XHR_RESPONSE_TYPE.DOCUMENT,svg:t.XHR_RESPONSE_TYPE.DOCUMENT,tsx:t.XHR_RESPONSE_TYPE.DOCUMENT,gif:t.XHR_RESPONSE_TYPE.BLOB,png:t.XHR_RESPONSE_TYPE.BLOB,bmp:t.XHR_RESPONSE_TYPE.BLOB,jpg:t.XHR_RESPONSE_TYPE.BLOB,jpeg:t.XHR_RESPONSE_TYPE.BLOB,tif:t.XHR_RESPONSE_TYPE.BLOB,tiff:t.XHR_RESPONSE_TYPE.BLOB,webp:t.XHR_RESPONSE_TYPE.BLOB,tga:t.XHR_RESPONSE_TYPE.BLOB,json:t.XHR_RESPONSE_TYPE.JSON,text:t.XHR_RESPONSE_TYPE.TEXT,txt:t.XHR_RESPONSE_TYPE.TEXT,ttf:t.XHR_RESPONSE_TYPE.BUFFER,otf:t.XHR_RESPONSE_TYPE.BUFFER},t.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="}(lf||(lf={}));var hf=function(t,e){this.data=t,this.callback=e},df=function(){function t(t,e){var i=this;if(void 0===e&&(e=1),this.workers=0,this.saturated=cf,this.unsaturated=cf,this.empty=cf,this.drain=cf,this.error=cf,this.started=!1,this.paused=!1,this._tasks=[],this._insert=function(t,e,r){if(r&&"function"!=typeof r)throw new Error("task callback must be a function");if(i.started=!0,null==t&&i.idle())setTimeout((function(){return i.drain()}),1);else{var n=new hf(t,"function"==typeof r?r:cf);e?i._tasks.unshift(n):i._tasks.push(n),setTimeout(i.process,1)}},this.process=function(){for(;!i.paused&&i.workers<i.concurrency&&i._tasks.length;){var t=i._tasks.shift();0===i._tasks.length&&i.empty(),i.workers+=1,i.workers===i.concurrency&&i.saturated(),i._worker(t.data,uf(i._next(t)))}},this._worker=t,0===e)throw new Error("Concurrency must not be zero");this.concurrency=e,this.buffer=e/4}return t.prototype._next=function(t){var e=this;return function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];e.workers-=1,t.callback.apply(t,r),null!=r[0]&&e.error(r[0],t.data),e.workers<=e.concurrency-e.buffer&&e.unsaturated(),e.idle()&&e.drain(),e.process()}},t.prototype.push=function(t,e){this._insert(t,!1,e)},t.prototype.kill=function(){this.workers=0,this.drain=cf,this.started=!1,this._tasks=[]},t.prototype.unshift=function(t,e){this._insert(t,!0,e)},t.prototype.length=function(){return this._tasks.length},t.prototype.running=function(){return this.workers},t.prototype.idle=function(){return this._tasks.length+this.workers===0},t.prototype.pause=function(){!0!==this.paused&&(this.paused=!0)},t.prototype.resume=function(){if(!1!==this.paused){this.paused=!1;for(var t=1;t<=this.concurrency;t++)this.process()}},t.eachSeries=function(t,e,i,r){var n=0,o=t.length;!function s(a){a||n===o?i&&i(a):r?setTimeout((function(){e(t[n++],s)}),1):e(t[n++],s)}()},t.queue=function(e,i){return new t(e,i)},t}(),pf=/(#[\w-]+)?$/,ff=function(){function t(e,i){var r=this;void 0===e&&(e=""),void 0===i&&(i=10),this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(t,e){return r._loadResource(t,e)},this.resources={},this.baseUrl=e,this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(t,e){return r._loadResource(t,e)},this._queue=df.queue(this._boundLoadResource,i),this._queue.pause(),this.resources={},this.onProgress=new tf,this.onError=new tf,this.onLoad=new tf,this.onStart=new tf,this.onComplete=new tf;for(var n=0;n<t._plugins.length;++n){var o=t._plugins[n],s=o.pre,a=o.use;s&&this.pre(s),a&&this.use(a)}this._protected=!1}return t.prototype._add=function(t,e,i,r){if(this.loading&&(!i||!i.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[t])throw new Error('Resource named "'+t+'" already exists.');if(e=this._prepareUrl(e),this.resources[t]=new lf(t,e,i),"function"==typeof r&&this.resources[t].onAfterMiddleware.once(r),this.loading){for(var n=i.parentResource,o=[],s=0;s<n.children.length;++s)n.children[s].isComplete||o.push(n.children[s]);var a=n.progressChunk*(o.length+1)/(o.length+2);n.children.push(this.resources[t]),n.progressChunk=a;for(s=0;s<o.length;++s)o[s].progressChunk=a;this.resources[t].progressChunk=a}return this._queue.push(this.resources[t]),this},t.prototype.pre=function(t){return this._beforeMiddleware.push(t),this},t.prototype.use=function(t){return this._afterMiddleware.push(t),this},t.prototype.reset=function(){for(var t in this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause(),this.resources){var e=this.resources[t];e._onLoadBinding&&e._onLoadBinding.detach(),e.isLoading&&e.abort("loader reset")}return this.resources={},this},t.prototype.load=function(t){if("function"==typeof t&&this.onComplete.once(t),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var e=100/this._queue._tasks.length,i=0;i<this._queue._tasks.length;++i)this._queue._tasks[i].data.progressChunk=e;this._onStart(),this._queue.resume()}return this},Object.defineProperty(t.prototype,"concurrency",{get:function(){return this._queue.concurrency},set:function(t){this._queue.concurrency=t},enumerable:!1,configurable:!0}),t.prototype._prepareUrl=function(t){var e,i=ef(t,{strictMode:!0});if(e=i.protocol||!i.path||0===t.indexOf("//")?t:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==t.charAt(0)?this.baseUrl+"/"+t:this.baseUrl+t,this.defaultQueryString){var r=pf.exec(e)[0];-1!==(e=e.substr(0,e.length-r.length)).indexOf("?")?e+="&"+this.defaultQueryString:e+="?"+this.defaultQueryString,e+=r}return e},t.prototype._loadResource=function(t,e){var i=this;t._dequeue=e,df.eachSeries(this._beforeMiddleware,(function(e,r){e.call(i,t,(function(){r(t.isComplete?{}:null)}))}),(function(){t.isComplete?i._onLoad(t):(t._onLoadBinding=t.onComplete.once(i._onLoad,i),t.load())}),!0)},t.prototype._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},t.prototype._onComplete=function(){this.progress=100,this.loading=!1,this.onComplete.dispatch(this,this.resources)},t.prototype._onLoad=function(t){var e=this;t._onLoadBinding=null,this._resourcesParsing.push(t),t._dequeue(),df.eachSeries(this._afterMiddleware,(function(i,r){i.call(e,t,r)}),(function(){t.onAfterMiddleware.dispatch(t),e.progress=Math.min(100,e.progress+t.progressChunk),e.onProgress.dispatch(e,t),t.error?e.onError.dispatch(t.error,e,t):e.onLoad.dispatch(e,t),e._resourcesParsing.splice(e._resourcesParsing.indexOf(t),1),e._queue.idle()&&0===e._resourcesParsing.length&&e._onComplete()}),!0)},t.prototype.destroy=function(){this._protected||this.reset()},Object.defineProperty(t,"shared",{get:function(){var e=t._shared;return e||((e=new t)._protected=!0,t._shared=e),e},enumerable:!1,configurable:!0}),t.registerPlugin=function(e){return t._plugins.push(e),e.add&&e.add(),t},t._plugins=[],t}();ff.prototype.add=function(t,e,i,r){if(Array.isArray(t)){for(var n=0;n<t.length;++n)this.add(t[n]);return this}if("object"==typeof t&&(i=t,r=e||i.callback||i.onComplete,e=i.url,t=i.name||i.key||i.url),"string"!=typeof e&&(r=i,i=e,e=t),"string"!=typeof e)throw new Error("No url passed to add resource to loader.");return"function"==typeof i&&(r=i,i=null),this._add(t,e,i,r)};var mf=function(){function t(){}return t.init=function(t){t=Object.assign({sharedLoader:!1},t),this.loader=t.sharedLoader?ff.shared:new ff},t.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},t}(),gf=function(){function t(){}return t.add=function(){lf.setExtensionLoadType("svg",lf.LOAD_TYPE.XHR),lf.setExtensionXhrType("svg",lf.XHR_RESPONSE_TYPE.TEXT)},t.use=function(t,e){if(!t.data||t.type!==lf.TYPE.IMAGE&&"svg"!==t.extension)e();else{var i=t.data,r=t.url,n=t.name,o=t.metadata;ed.fromLoader(i,r,n,o).then((function(i){t.texture=i,e()})).catch(e)}},t}();var _f,yf,vf=self.URL||self.webkitURL;ff.registerPlugin({use:function(t,e){if(t.data){if(t.xhr&&t.xhrType===lf.XHR_RESPONSE_TYPE.BLOB)if(self.Blob&&"string"!=typeof t.data){if(0===t.data.type.indexOf("image")){var i=vf.createObjectURL(t.data);return t.blob=t.data,t.data=new Image,t.data.src=i,t.type=lf.TYPE.IMAGE,void(t.data.onload=function(){vf.revokeObjectURL(i),t.data.onload=null,e()})}}else{var r=t.xhr.getResponseHeader("content-type");if(r&&0===r.indexOf("image"))return t.data=new Image,t.data.src="data:"+r+";base64,"+function(t){for(var e="",i=0;i<t.length;){for(var r=[0,0,0],n=[0,0,0,0],o=0;o<r.length;++o)i<t.length?r[o]=255&t.charCodeAt(i++):r[o]=0;switch(n[0]=r[0]>>2,n[1]=(3&r[0])<<4|r[1]>>4,n[2]=(15&r[1])<<2|r[2]>>6,n[3]=63&r[2],i-(t.length-1)){case 2:n[3]=64,n[2]=64;break;case 1:n[3]=64}for(o=0;o<n.length;++o)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(n[o])}return e}(t.xhr.responseText),t.type=lf.TYPE.IMAGE,void(t.data.onload=function(){t.data.onload=null,e()})}e()}else e()}}),ff.registerPlugin(gf),function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL"}(yf||(yf={}));var xf=((_f={})[yf.COMPRESSED_RGB_S3TC_DXT1_EXT]=.5,_f[yf.COMPRESSED_RGBA_S3TC_DXT1_EXT]=.5,_f[yf.COMPRESSED_RGBA_S3TC_DXT3_EXT]=1,_f[yf.COMPRESSED_RGBA_S3TC_DXT5_EXT]=1,_f[yf.COMPRESSED_SRGB_S3TC_DXT1_EXT]=.5,_f[yf.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]=.5,_f[yf.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]=1,_f[yf.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]=1,_f[yf.COMPRESSED_R11_EAC]=.5,_f[yf.COMPRESSED_SIGNED_R11_EAC]=.5,_f[yf.COMPRESSED_RG11_EAC]=1,_f[yf.COMPRESSED_SIGNED_RG11_EAC]=1,_f[yf.COMPRESSED_RGB8_ETC2]=.5,_f[yf.COMPRESSED_RGBA8_ETC2_EAC]=1,_f[yf.COMPRESSED_SRGB8_ETC2]=.5,_f[yf.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]=1,_f[yf.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,_f[yf.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,_f[yf.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]=.5,_f[yf.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]=.5,_f[yf.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]=.25,_f[yf.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]=.25,_f[yf.COMPRESSED_RGB_ETC1_WEBGL]=.5,_f[yf.COMPRESSED_RGB_ATC_WEBGL]=.5,_f[yf.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL]=1,_f[yf.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL]=1,_f),bf=function(t,e){return(bf=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function wf(t,e){function i(){this.constructor=t}bf(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}function Tf(t,e){var i,r,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(n=2&o[0]?r.return:o[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=s.trys,(n=n.length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{i=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var Ef,Sf,Af=function(t){function e(i,r){var n=t.call(this,i,r)||this;return n.format=r.format,n.levels=r.levels||1,n._width=r.width,n._height=r.height,n._extension=e._formatToExtension(n.format),(r.levelBuffers||n.buffer)&&(n._levelBuffers=r.levelBuffers||e._createLevelBuffers(i instanceof Uint8Array?i:n.buffer.uint8View,n.format,n.levels,4,4,n.width,n.height)),n}return wf(e,t),e.prototype.upload=function(t,e,i){var r=t.gl;if(!t.context.extensions[this._extension])throw new Error(this._extension+" textures are not supported on the current machine");if(!this._levelBuffers)return!1;for(var n=0,o=this.levels;n<o;n++){var s=this._levelBuffers[n],a=s.levelID,l=s.levelWidth,c=s.levelHeight,u=s.levelBuffer;r.compressedTexImage2D(r.TEXTURE_2D,a,this.format,l,c,0,u)}return!0},e.prototype.onBlobLoaded=function(){this._levelBuffers=e._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)},e._formatToExtension=function(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")},e._createLevelBuffers=function(t,e,i,r,n,o,s){for(var a=new Array(i),l=t.byteOffset,c=o,u=s,h=c+r-1&~(r-1),d=u+n-1&~(n-1),p=h*d*xf[e],f=0;f<i;f++)a[f]={levelID:f,levelWidth:i>1?c:h,levelHeight:i>1?u:d,levelBuffer:new Uint8Array(t.buffer,l,p)},l+=p,p=(h=(c=c>>1||1)+r-1&~(r-1))*(d=(u=u>>1||1)+n-1&~(n-1))*xf[e];return a},e}(function(t){function e(e,i){void 0===i&&(i={width:1,height:1,autoLoad:!0});var r,n,o=this;return"string"==typeof e?(r=e,n=new Uint8Array):(r=null,n=e),(o=t.call(this,n,i)||this).origin=r,o.buffer=n?new Bp(n):null,o.origin&&!1!==i.autoLoad&&o.load(),n&&n.length&&(o.loaded=!0,o.onBlobLoaded(o.buffer.rawBinaryData)),o}return wf(e,t),e.prototype.onBlobLoaded=function(t){},e.prototype.load=function(){return t=this,e=void 0,r=function(){var t;return Tf(this,(function(e){switch(e.label){case 0:return[4,fetch(this.origin)];case 1:return[4,e.sent().blob()];case 2:return[4,e.sent().arrayBuffer()];case 3:return t=e.sent(),this.data=new Uint32Array(t),this.buffer=new Bp(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),[2,this]}}))},new((i=Promise)||(i=Promise))((function(n,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function a(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){t.done?n(t.value):new i((function(e){e(t.value)})).then(s,a)}l((r=r.apply(t,e||[])).next())}));var t,e,i,r},e}(Fh)),Mf=function(){function t(){}return t.use=function(e,i){var r=e.data;if(e.type===lf.TYPE.JSON&&r&&r.cacheID&&r.textures){for(var n=r.textures,o=void 0,s=void 0,a=0,l=n.length;a<l;a++){var c=n[a],u=c.src,h=c.format;if(h||(s=u),t.textureFormats[h]){o=u;break}}if(!(o=o||s))return void i(new Error("Cannot load compressed-textures in "+e.url+", make sure you provide a fallback"));if(o===e.url)return void i(new Error("URL of compressed texture cannot be the same as the manifest's URL"));var d={crossOrigin:e.crossOrigin,metadata:e.metadata.imageMetadata,parentResource:e},p=gu.resolve(e.url.replace(this.baseUrl,""),o),f=r.cacheID;this.add(f,p,d,(function(t){if(t.error)i(t.error);else{var r=t.texture,n=void 0===r?null:r,o=t.textures,s=void 0===o?{}:o;Object.assign(e,{texture:n,textures:s}),i()}}))}else i()},t.add=function(){var e=document.createElement("canvas").getContext("webgl");if(e){var i={s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc")};for(var r in t.textureExtensions=i,t.textureFormats={},i){var n=i[r];n&&Object.assign(t.textureFormats,Object.getPrototypeOf(n))}}else console.warn("WebGL not available for compressed textures. Silently failing.")},t}();function If(t,e,i){var r={textures:{},texture:null};return e?(e.map((function(t){return new ed(new Nh(t,Object.assign({mipmap:iu.OFF,alphaMode:ru.NO_PREMULTIPLIED_ALPHA},i)))})).forEach((function(e,i){var n=e.baseTexture,o=t+"-"+(i+1);Nh.addToCache(n,o),ed.addToCache(e,o),0===i&&(Nh.addToCache(n,t),ed.addToCache(e,t),r.texture=e),r.textures[o]=e})),r):r}lf.setExtensionXhrType("dds",lf.XHR_RESPONSE_TYPE.BUFFER);var Cf,Pf,Rf=3,Of=4,Df=7,Lf=19,kf=2,Bf=0,Ff=1,zf=2,Nf=3;!function(t){t[t.DXGI_FORMAT_UNKNOWN=0]="DXGI_FORMAT_UNKNOWN",t[t.DXGI_FORMAT_R32G32B32A32_TYPELESS=1]="DXGI_FORMAT_R32G32B32A32_TYPELESS",t[t.DXGI_FORMAT_R32G32B32A32_FLOAT=2]="DXGI_FORMAT_R32G32B32A32_FLOAT",t[t.DXGI_FORMAT_R32G32B32A32_UINT=3]="DXGI_FORMAT_R32G32B32A32_UINT",t[t.DXGI_FORMAT_R32G32B32A32_SINT=4]="DXGI_FORMAT_R32G32B32A32_SINT",t[t.DXGI_FORMAT_R32G32B32_TYPELESS=5]="DXGI_FORMAT_R32G32B32_TYPELESS",t[t.DXGI_FORMAT_R32G32B32_FLOAT=6]="DXGI_FORMAT_R32G32B32_FLOAT",t[t.DXGI_FORMAT_R32G32B32_UINT=7]="DXGI_FORMAT_R32G32B32_UINT",t[t.DXGI_FORMAT_R32G32B32_SINT=8]="DXGI_FORMAT_R32G32B32_SINT",t[t.DXGI_FORMAT_R16G16B16A16_TYPELESS=9]="DXGI_FORMAT_R16G16B16A16_TYPELESS",t[t.DXGI_FORMAT_R16G16B16A16_FLOAT=10]="DXGI_FORMAT_R16G16B16A16_FLOAT",t[t.DXGI_FORMAT_R16G16B16A16_UNORM=11]="DXGI_FORMAT_R16G16B16A16_UNORM",t[t.DXGI_FORMAT_R16G16B16A16_UINT=12]="DXGI_FORMAT_R16G16B16A16_UINT",t[t.DXGI_FORMAT_R16G16B16A16_SNORM=13]="DXGI_FORMAT_R16G16B16A16_SNORM",t[t.DXGI_FORMAT_R16G16B16A16_SINT=14]="DXGI_FORMAT_R16G16B16A16_SINT",t[t.DXGI_FORMAT_R32G32_TYPELESS=15]="DXGI_FORMAT_R32G32_TYPELESS",t[t.DXGI_FORMAT_R32G32_FLOAT=16]="DXGI_FORMAT_R32G32_FLOAT",t[t.DXGI_FORMAT_R32G32_UINT=17]="DXGI_FORMAT_R32G32_UINT",t[t.DXGI_FORMAT_R32G32_SINT=18]="DXGI_FORMAT_R32G32_SINT",t[t.DXGI_FORMAT_R32G8X24_TYPELESS=19]="DXGI_FORMAT_R32G8X24_TYPELESS",t[t.DXGI_FORMAT_D32_FLOAT_S8X24_UINT=20]="DXGI_FORMAT_D32_FLOAT_S8X24_UINT",t[t.DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS=21]="DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS",t[t.DXGI_FORMAT_X32_TYPELESS_G8X24_UINT=22]="DXGI_FORMAT_X32_TYPELESS_G8X24_UINT",t[t.DXGI_FORMAT_R10G10B10A2_TYPELESS=23]="DXGI_FORMAT_R10G10B10A2_TYPELESS",t[t.DXGI_FORMAT_R10G10B10A2_UNORM=24]="DXGI_FORMAT_R10G10B10A2_UNORM",t[t.DXGI_FORMAT_R10G10B10A2_UINT=25]="DXGI_FORMAT_R10G10B10A2_UINT",t[t.DXGI_FORMAT_R11G11B10_FLOAT=26]="DXGI_FORMAT_R11G11B10_FLOAT",t[t.DXGI_FORMAT_R8G8B8A8_TYPELESS=27]="DXGI_FORMAT_R8G8B8A8_TYPELESS",t[t.DXGI_FORMAT_R8G8B8A8_UNORM=28]="DXGI_FORMAT_R8G8B8A8_UNORM",t[t.DXGI_FORMAT_R8G8B8A8_UNORM_SRGB=29]="DXGI_FORMAT_R8G8B8A8_UNORM_SRGB",t[t.DXGI_FORMAT_R8G8B8A8_UINT=30]="DXGI_FORMAT_R8G8B8A8_UINT",t[t.DXGI_FORMAT_R8G8B8A8_SNORM=31]="DXGI_FORMAT_R8G8B8A8_SNORM",t[t.DXGI_FORMAT_R8G8B8A8_SINT=32]="DXGI_FORMAT_R8G8B8A8_SINT",t[t.DXGI_FORMAT_R16G16_TYPELESS=33]="DXGI_FORMAT_R16G16_TYPELESS",t[t.DXGI_FORMAT_R16G16_FLOAT=34]="DXGI_FORMAT_R16G16_FLOAT",t[t.DXGI_FORMAT_R16G16_UNORM=35]="DXGI_FORMAT_R16G16_UNORM",t[t.DXGI_FORMAT_R16G16_UINT=36]="DXGI_FORMAT_R16G16_UINT",t[t.DXGI_FORMAT_R16G16_SNORM=37]="DXGI_FORMAT_R16G16_SNORM",t[t.DXGI_FORMAT_R16G16_SINT=38]="DXGI_FORMAT_R16G16_SINT",t[t.DXGI_FORMAT_R32_TYPELESS=39]="DXGI_FORMAT_R32_TYPELESS",t[t.DXGI_FORMAT_D32_FLOAT=40]="DXGI_FORMAT_D32_FLOAT",t[t.DXGI_FORMAT_R32_FLOAT=41]="DXGI_FORMAT_R32_FLOAT",t[t.DXGI_FORMAT_R32_UINT=42]="DXGI_FORMAT_R32_UINT",t[t.DXGI_FORMAT_R32_SINT=43]="DXGI_FORMAT_R32_SINT",t[t.DXGI_FORMAT_R24G8_TYPELESS=44]="DXGI_FORMAT_R24G8_TYPELESS",t[t.DXGI_FORMAT_D24_UNORM_S8_UINT=45]="DXGI_FORMAT_D24_UNORM_S8_UINT",t[t.DXGI_FORMAT_R24_UNORM_X8_TYPELESS=46]="DXGI_FORMAT_R24_UNORM_X8_TYPELESS",t[t.DXGI_FORMAT_X24_TYPELESS_G8_UINT=47]="DXGI_FORMAT_X24_TYPELESS_G8_UINT",t[t.DXGI_FORMAT_R8G8_TYPELESS=48]="DXGI_FORMAT_R8G8_TYPELESS",t[t.DXGI_FORMAT_R8G8_UNORM=49]="DXGI_FORMAT_R8G8_UNORM",t[t.DXGI_FORMAT_R8G8_UINT=50]="DXGI_FORMAT_R8G8_UINT",t[t.DXGI_FORMAT_R8G8_SNORM=51]="DXGI_FORMAT_R8G8_SNORM",t[t.DXGI_FORMAT_R8G8_SINT=52]="DXGI_FORMAT_R8G8_SINT",t[t.DXGI_FORMAT_R16_TYPELESS=53]="DXGI_FORMAT_R16_TYPELESS",t[t.DXGI_FORMAT_R16_FLOAT=54]="DXGI_FORMAT_R16_FLOAT",t[t.DXGI_FORMAT_D16_UNORM=55]="DXGI_FORMAT_D16_UNORM",t[t.DXGI_FORMAT_R16_UNORM=56]="DXGI_FORMAT_R16_UNORM",t[t.DXGI_FORMAT_R16_UINT=57]="DXGI_FORMAT_R16_UINT",t[t.DXGI_FORMAT_R16_SNORM=58]="DXGI_FORMAT_R16_SNORM",t[t.DXGI_FORMAT_R16_SINT=59]="DXGI_FORMAT_R16_SINT",t[t.DXGI_FORMAT_R8_TYPELESS=60]="DXGI_FORMAT_R8_TYPELESS",t[t.DXGI_FORMAT_R8_UNORM=61]="DXGI_FORMAT_R8_UNORM",t[t.DXGI_FORMAT_R8_UINT=62]="DXGI_FORMAT_R8_UINT",t[t.DXGI_FORMAT_R8_SNORM=63]="DXGI_FORMAT_R8_SNORM",t[t.DXGI_FORMAT_R8_SINT=64]="DXGI_FORMAT_R8_SINT",t[t.DXGI_FORMAT_A8_UNORM=65]="DXGI_FORMAT_A8_UNORM",t[t.DXGI_FORMAT_R1_UNORM=66]="DXGI_FORMAT_R1_UNORM",t[t.DXGI_FORMAT_R9G9B9E5_SHAREDEXP=67]="DXGI_FORMAT_R9G9B9E5_SHAREDEXP",t[t.DXGI_FORMAT_R8G8_B8G8_UNORM=68]="DXGI_FORMAT_R8G8_B8G8_UNORM",t[t.DXGI_FORMAT_G8R8_G8B8_UNORM=69]="DXGI_FORMAT_G8R8_G8B8_UNORM",t[t.DXGI_FORMAT_BC1_TYPELESS=70]="DXGI_FORMAT_BC1_TYPELESS",t[t.DXGI_FORMAT_BC1_UNORM=71]="DXGI_FORMAT_BC1_UNORM",t[t.DXGI_FORMAT_BC1_UNORM_SRGB=72]="DXGI_FORMAT_BC1_UNORM_SRGB",t[t.DXGI_FORMAT_BC2_TYPELESS=73]="DXGI_FORMAT_BC2_TYPELESS",t[t.DXGI_FORMAT_BC2_UNORM=74]="DXGI_FORMAT_BC2_UNORM",t[t.DXGI_FORMAT_BC2_UNORM_SRGB=75]="DXGI_FORMAT_BC2_UNORM_SRGB",t[t.DXGI_FORMAT_BC3_TYPELESS=76]="DXGI_FORMAT_BC3_TYPELESS",t[t.DXGI_FORMAT_BC3_UNORM=77]="DXGI_FORMAT_BC3_UNORM",t[t.DXGI_FORMAT_BC3_UNORM_SRGB=78]="DXGI_FORMAT_BC3_UNORM_SRGB",t[t.DXGI_FORMAT_BC4_TYPELESS=79]="DXGI_FORMAT_BC4_TYPELESS",t[t.DXGI_FORMAT_BC4_UNORM=80]="DXGI_FORMAT_BC4_UNORM",t[t.DXGI_FORMAT_BC4_SNORM=81]="DXGI_FORMAT_BC4_SNORM",t[t.DXGI_FORMAT_BC5_TYPELESS=82]="DXGI_FORMAT_BC5_TYPELESS",t[t.DXGI_FORMAT_BC5_UNORM=83]="DXGI_FORMAT_BC5_UNORM",t[t.DXGI_FORMAT_BC5_SNORM=84]="DXGI_FORMAT_BC5_SNORM",t[t.DXGI_FORMAT_B5G6R5_UNORM=85]="DXGI_FORMAT_B5G6R5_UNORM",t[t.DXGI_FORMAT_B5G5R5A1_UNORM=86]="DXGI_FORMAT_B5G5R5A1_UNORM",t[t.DXGI_FORMAT_B8G8R8A8_UNORM=87]="DXGI_FORMAT_B8G8R8A8_UNORM",t[t.DXGI_FORMAT_B8G8R8X8_UNORM=88]="DXGI_FORMAT_B8G8R8X8_UNORM",t[t.DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM=89]="DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM",t[t.DXGI_FORMAT_B8G8R8A8_TYPELESS=90]="DXGI_FORMAT_B8G8R8A8_TYPELESS",t[t.DXGI_FORMAT_B8G8R8A8_UNORM_SRGB=91]="DXGI_FORMAT_B8G8R8A8_UNORM_SRGB",t[t.DXGI_FORMAT_B8G8R8X8_TYPELESS=92]="DXGI_FORMAT_B8G8R8X8_TYPELESS",t[t.DXGI_FORMAT_B8G8R8X8_UNORM_SRGB=93]="DXGI_FORMAT_B8G8R8X8_UNORM_SRGB",t[t.DXGI_FORMAT_BC6H_TYPELESS=94]="DXGI_FORMAT_BC6H_TYPELESS",t[t.DXGI_FORMAT_BC6H_UF16=95]="DXGI_FORMAT_BC6H_UF16",t[t.DXGI_FORMAT_BC6H_SF16=96]="DXGI_FORMAT_BC6H_SF16",t[t.DXGI_FORMAT_BC7_TYPELESS=97]="DXGI_FORMAT_BC7_TYPELESS",t[t.DXGI_FORMAT_BC7_UNORM=98]="DXGI_FORMAT_BC7_UNORM",t[t.DXGI_FORMAT_BC7_UNORM_SRGB=99]="DXGI_FORMAT_BC7_UNORM_SRGB",t[t.DXGI_FORMAT_AYUV=100]="DXGI_FORMAT_AYUV",t[t.DXGI_FORMAT_Y410=101]="DXGI_FORMAT_Y410",t[t.DXGI_FORMAT_Y416=102]="DXGI_FORMAT_Y416",t[t.DXGI_FORMAT_NV12=103]="DXGI_FORMAT_NV12",t[t.DXGI_FORMAT_P010=104]="DXGI_FORMAT_P010",t[t.DXGI_FORMAT_P016=105]="DXGI_FORMAT_P016",t[t.DXGI_FORMAT_420_OPAQUE=106]="DXGI_FORMAT_420_OPAQUE",t[t.DXGI_FORMAT_YUY2=107]="DXGI_FORMAT_YUY2",t[t.DXGI_FORMAT_Y210=108]="DXGI_FORMAT_Y210",t[t.DXGI_FORMAT_Y216=109]="DXGI_FORMAT_Y216",t[t.DXGI_FORMAT_NV11=110]="DXGI_FORMAT_NV11",t[t.DXGI_FORMAT_AI44=111]="DXGI_FORMAT_AI44",t[t.DXGI_FORMAT_IA44=112]="DXGI_FORMAT_IA44",t[t.DXGI_FORMAT_P8=113]="DXGI_FORMAT_P8",t[t.DXGI_FORMAT_A8P8=114]="DXGI_FORMAT_A8P8",t[t.DXGI_FORMAT_B4G4R4A4_UNORM=115]="DXGI_FORMAT_B4G4R4A4_UNORM",t[t.DXGI_FORMAT_P208=116]="DXGI_FORMAT_P208",t[t.DXGI_FORMAT_V208=117]="DXGI_FORMAT_V208",t[t.DXGI_FORMAT_V408=118]="DXGI_FORMAT_V408",t[t.DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE=119]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE",t[t.DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE=120]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE",t[t.DXGI_FORMAT_FORCE_UINT=121]="DXGI_FORMAT_FORCE_UINT"}(Cf||(Cf={})),function(t){t[t.DDS_DIMENSION_TEXTURE1D=2]="DDS_DIMENSION_TEXTURE1D",t[t.DDS_DIMENSION_TEXTURE2D=3]="DDS_DIMENSION_TEXTURE2D",t[t.DDS_DIMENSION_TEXTURE3D=6]="DDS_DIMENSION_TEXTURE3D"}(Pf||(Pf={}));var Uf,Gf,jf,Vf=((Ef={})[827611204]=yf.COMPRESSED_RGBA_S3TC_DXT1_EXT,Ef[861165636]=yf.COMPRESSED_RGBA_S3TC_DXT3_EXT,Ef[894720068]=yf.COMPRESSED_RGBA_S3TC_DXT5_EXT,Ef),Xf=((Sf={})[Cf.DXGI_FORMAT_BC1_TYPELESS]=yf.COMPRESSED_RGBA_S3TC_DXT1_EXT,Sf[Cf.DXGI_FORMAT_BC1_UNORM]=yf.COMPRESSED_RGBA_S3TC_DXT1_EXT,Sf[Cf.DXGI_FORMAT_BC2_TYPELESS]=yf.COMPRESSED_RGBA_S3TC_DXT3_EXT,Sf[Cf.DXGI_FORMAT_BC2_UNORM]=yf.COMPRESSED_RGBA_S3TC_DXT3_EXT,Sf[Cf.DXGI_FORMAT_BC3_TYPELESS]=yf.COMPRESSED_RGBA_S3TC_DXT5_EXT,Sf[Cf.DXGI_FORMAT_BC3_UNORM]=yf.COMPRESSED_RGBA_S3TC_DXT5_EXT,Sf[Cf.DXGI_FORMAT_BC1_UNORM_SRGB]=yf.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,Sf[Cf.DXGI_FORMAT_BC2_UNORM_SRGB]=yf.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,Sf[Cf.DXGI_FORMAT_BC3_UNORM_SRGB]=yf.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,Sf),Hf=function(){function t(){}return t.use=function(e,i){if("dds"===e.extension&&e.data)try{Object.assign(e,If(e.name||e.url,t.parse(e.data),e.metadata))}catch(t){return void i(t)}i()},t.parse=function(t){var e=new Uint32Array(t);if(542327876!==e[0])throw new Error("Invalid DDS file magic word");var i=new Uint32Array(t,0,124/Uint32Array.BYTES_PER_ELEMENT),r=i[Rf],n=i[Of],o=i[Df],s=new Uint32Array(t,Lf*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),a=s[1];if(4&a){var l=s[kf];if(808540228!==l){var c=Vf[l],u=new Uint8Array(t,128);return[new Af(u,{format:c,width:n,height:r,levels:o})]}var h=new Uint32Array(e.buffer,128,20/Uint32Array.BYTES_PER_ELEMENT),d=h[Bf],p=h[Ff],f=h[zf],m=h[Nf],g=Xf[d];if(void 0===g)throw new Error("DDSLoader cannot parse texture data with DXGI format "+d);if(4===f)throw new Error("DDSLoader does not support cubemap textures");if(p===Pf.DDS_DIMENSION_TEXTURE3D)throw new Error("DDSLoader does not supported 3D texture data");var _=new Array;if(1===m)_.push(new Uint8Array(t,148));else{for(var y=xf[g],v=0,x=n,b=r,w=0;w<o;w++){v+=Math.max(1,x+3&-4)*Math.max(1,b+3&-4)*y,x>>>=1,b>>>=1}var T=148;for(w=0;w<m;w++)_.push(new Uint8Array(t,T,v)),T+=v}return _.map((function(t){return new Af(t,{format:g,width:n,height:r,levels:o})}))}if(64&a)throw new Error("DDSLoader does not support uncompressed texture data.");if(512&a)throw new Error("DDSLoader does not supported YUV uncompressed texture data.");if(131072&a)throw new Error("DDSLoader does not support single-channel (lumninance) texture data!");if(2&a)throw new Error("DDSLoader does not support single-channel (alpha) texture data!");throw new Error("DDSLoader failed to load a texture file due to an unknown reason!")},t}();lf.setExtensionXhrType("ktx",lf.XHR_RESPONSE_TYPE.BUFFER);var qf=[171,75,84,88,32,49,49,187,13,10,26,10],Wf=12,$f=16,Yf=24,Zf=28,Kf=36,Jf=40,Qf=44,tm=48,em=52,im=56,rm=60,nm=((Uf={})[Jc.UNSIGNED_BYTE]=1,Uf[Jc.UNSIGNED_SHORT]=2,Uf[Jc.FLOAT]=4,Uf[Jc.HALF_FLOAT]=8,Uf),om=((Gf={})[Zc.RGBA]=4,Gf[Zc.RGB]=3,Gf[Zc.LUMINANCE]=1,Gf[Zc.LUMINANCE_ALPHA]=2,Gf[Zc.ALPHA]=1,Gf),sm=((jf={})[Jc.UNSIGNED_SHORT_4_4_4_4]=2,jf[Jc.UNSIGNED_SHORT_5_5_5_1]=2,jf[Jc.UNSIGNED_SHORT_5_6_5]=2,jf),am=function(){function t(){}return t.use=function(e,i){if("ktx"===e.extension&&e.data)try{var r=e.name||e.url;Object.assign(e,If(r,t.parse(r,e.data),e.metadata))}catch(t){return void i(t)}i()},t.parse=function(e,i){var r=new DataView(i);if(!t.validate(e,r))return null;var n=67305985===r.getUint32(Wf,!0),o=r.getUint32($f,n),s=r.getUint32(Yf,n),a=r.getUint32(Zf,n),l=r.getUint32(Kf,n),c=r.getUint32(Jf,n)||1,u=r.getUint32(Qf,n)||1,h=r.getUint32(tm,n)||1,d=r.getUint32(em,n),p=r.getUint32(im,n),f=r.getUint32(rm,n);if(0===c||1!==u)throw new Error("Only 2D textures are supported");if(1!==d)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==h)throw new Error("WebGL does not support array textures");var m,g=l+3&-4,_=c+3&-4,y=new Array(h),v=l*c;if(0===o&&(v=g*_),void 0===(m=0!==o?nm[o]?nm[o]*om[s]:sm[o]:xf[a]))throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");for(var x=v*m,b=l,w=c,T=g,E=_,S=64+f,A=0;A<p;A++){for(var M=r.getUint32(S,n),I=S+4,C=0;C<h;C++){var P=y[C];P||(P=y[C]=new Array(p)),P[A]={levelID:A,levelWidth:p>1?b:T,levelHeight:p>1?w:E,levelBuffer:new Uint8Array(i,I,x)},I+=x}S=(S+=M+4)%4!=0?S+4-S%4:S,x=(T=(b=b>>1||1)+4-1&-4)*(E=(w=w>>1||1)+4-1&-4)*m}if(0!==o)throw new Error("TODO: Uncompressed");return y.map((function(t){return new Af(null,{format:a,width:l,height:c,levels:p,levelBuffers:t})}))},t.validate=function(t,e){for(var i=0;i<qf.length;i++)if(e.getUint8(i)!==qf[i])return console.error(t+" is not a valid *.ktx file!"),!1;return!0},t}(),lm=function(t,e){return(lm=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function cm(t,e){function i(){this.constructor=t}lm(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}!function(t){function e(e,i,r,n){void 0===e&&(e=1500),void 0===r&&(r=16384),void 0===n&&(n=!1);var o=t.call(this)||this;return r>16384&&(r=16384),o._properties=[!1,!0,!1,!1,!1],o._maxSize=e,o._batchSize=r,o._buffers=null,o._bufferUpdateIDs=[],o._updateID=0,o.interactiveChildren=!1,o.blendMode=$c.NORMAL,o.autoResize=n,o.roundPixels=!0,o.baseTexture=null,o.setProperties(i),o._tint=0,o.tintRgb=new Float32Array(4),o.tint=16777215,o}cm(e,t),e.prototype.setProperties=function(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])},e.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t,xu(t,this.tintRgb)},enumerable:!1,configurable:!0}),e.prototype.render=function(t){var e=this;this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",(function(){return e.onChildrenChange(0)}))),t.batch.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))},e.prototype.onChildrenChange=function(t){for(var e=Math.floor(t/this._batchSize);this._bufferUpdateIDs.length<e;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[e]=++this._updateID},e.prototype.dispose=function(){if(this._buffers){for(var t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._buffers=null}},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null}}(gh);var um,hm,dm=function(){function t(t,e,i){this.geometry=new dd,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(var r=0;r<t.length;++r){var n=t[r];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||Jc.FLOAT,offset:n.offset},e[r]?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}return t.prototype.initBuffers=function(){var t=this.geometry,e=0;this.indexBuffer=new ad(function(t,e){void 0===e&&(e=null);var i=6*t;if((e=e||new Uint16Array(i)).length!==i)throw new Error("Out buffer length is incorrect, got "+e.length+" and expected "+i);for(var r=0,n=0;r<i;r+=6,n+=4)e[r+0]=n+0,e[r+1]=n+1,e[r+2]=n+2,e[r+3]=n+0,e[r+4]=n+2,e[r+5]=n+3;return e}(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(var i=0;i<this.dynamicProperties.length;++i){(s=this.dynamicProperties[i]).offset=e,e+=s.size,this.dynamicStride+=s.size}var r=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new ad(this.dynamicData,!1,!1);var n=0;this.staticStride=0;for(i=0;i<this.staticProperties.length;++i){(s=this.staticProperties[i]).offset=n,n+=s.size,this.staticStride+=s.size}var o=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(o),this.staticDataUint32=new Uint32Array(o),this.staticBuffer=new ad(this.staticData,!0,!1);for(i=0;i<this.dynamicProperties.length;++i){var s=this.dynamicProperties[i];t.addAttribute(s.attributeName,this.dynamicBuffer,0,s.type===Jc.UNSIGNED_BYTE,s.type,4*this.dynamicStride,4*s.offset)}for(i=0;i<this.staticProperties.length;++i){s=this.staticProperties[i];t.addAttribute(s.attributeName,this.staticBuffer,0,s.type===Jc.UNSIGNED_BYTE,s.type,4*this.staticStride,4*s.offset)}},t.prototype.uploadDynamic=function(t,e,i){for(var r=0;r<this.dynamicProperties.length;r++){var n=this.dynamicProperties[r];n.uploadFunction(t,e,i,n.type===Jc.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,n.offset)}this.dynamicBuffer._updateID++},t.prototype.uploadStatic=function(t,e,i){for(var r=0;r<this.staticProperties.length;r++){var n=this.staticProperties[r];n.uploadFunction(t,e,i,n.type===Jc.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,n.offset)}this.staticBuffer._updateID++},t.prototype.destroy=function(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()},t}(),pm=function(t){function e(e){var i=t.call(this,e)||this;return i.shader=null,i.properties=null,i.tempMatrix=new th,i.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:i.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:i.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:i.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:i.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:Jc.UNSIGNED_BYTE,uploadFunction:i.uploadTint,offset:0}],i.shader=tp.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),i.state=ep.for2d(),i}return cm(e,t),e.prototype.render=function(t){var e=t.children,i=t._maxSize,r=t._batchSize,n=this.renderer,o=e.length;if(0!==o){o>i&&!t.autoResize&&(o=i);var s=t._buffers;s||(s=t._buffers=this.generateBuffers(t));var a=e[0]._texture.baseTexture;this.state.blendMode=Eu(t.blendMode,a.alphaMode),n.state.set(this.state);var l,c,u,h,d=n.gl,p=t.worldTransform.copyTo(this.tempMatrix);p.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=p.toArray(!0),this.shader.uniforms.uColor=(l=t.tintRgb,c=t.worldAlpha,u=this.shader.uniforms.uColor,h=a.alphaMode,u=u||new Float32Array(4),h||void 0===h?(u[0]=l[0]*c,u[1]=l[1]*c,u[2]=l[2]*c):(u[0]=l[0],u[1]=l[1],u[2]=l[2]),u[3]=c,u),this.shader.uniforms.uSampler=a,this.renderer.shader.bind(this.shader);for(var f=!1,m=0,g=0;m<o;m+=r,g+=1){var _=o-m;_>r&&(_=r),g>=s.length&&s.push(this._generateOneMoreBuffer(t));var y=s[g];y.uploadDynamic(e,m,_);var v=t._bufferUpdateIDs[g]||0;(f=f||y._updateID<v)&&(y._updateID=t._updateID,y.uploadStatic(e,m,_)),n.geometry.bind(y.geometry),d.drawElements(d.TRIANGLES,6*_,d.UNSIGNED_SHORT,0)}}},e.prototype.generateBuffers=function(t){for(var e=[],i=t._maxSize,r=t._batchSize,n=t._properties,o=0;o<i;o+=r)e.push(new dm(this.properties,n,r));return e},e.prototype._generateOneMoreBuffer=function(t){var e=t._batchSize,i=t._properties;return new dm(this.properties,i,e)},e.prototype.uploadVertices=function(t,e,i,r,n,o){for(var s=0,a=0,l=0,c=0,u=0;u<i;++u){var h=t[e+u],d=h._texture,p=h.scale.x,f=h.scale.y,m=d.trim,g=d.orig;m?(s=(a=m.x-h.anchor.x*g.width)+m.width,l=(c=m.y-h.anchor.y*g.height)+m.height):(s=g.width*(1-h.anchor.x),a=g.width*-h.anchor.x,l=g.height*(1-h.anchor.y),c=g.height*-h.anchor.y),r[o]=a*p,r[o+1]=c*f,r[o+n]=s*p,r[o+n+1]=c*f,r[o+2*n]=s*p,r[o+2*n+1]=l*f,r[o+3*n]=a*p,r[o+3*n+1]=l*f,o+=4*n}},e.prototype.uploadPosition=function(t,e,i,r,n,o){for(var s=0;s<i;s++){var a=t[e+s].position;r[o]=a.x,r[o+1]=a.y,r[o+n]=a.x,r[o+n+1]=a.y,r[o+2*n]=a.x,r[o+2*n+1]=a.y,r[o+3*n]=a.x,r[o+3*n+1]=a.y,o+=4*n}},e.prototype.uploadRotation=function(t,e,i,r,n,o){for(var s=0;s<i;s++){var a=t[e+s].rotation;r[o]=a,r[o+n]=a,r[o+2*n]=a,r[o+3*n]=a,o+=4*n}},e.prototype.uploadUvs=function(t,e,i,r,n,o){for(var s=0;s<i;++s){var a=t[e+s]._texture._uvs;a?(r[o]=a.x0,r[o+1]=a.y0,r[o+n]=a.x1,r[o+n+1]=a.y1,r[o+2*n]=a.x2,r[o+2*n+1]=a.y2,r[o+3*n]=a.x3,r[o+3*n+1]=a.y3,o+=4*n):(r[o]=0,r[o+1]=0,r[o+n]=0,r[o+n+1]=0,r[o+2*n]=0,r[o+2*n+1]=0,r[o+3*n]=0,r[o+3*n+1]=0,o+=4*n)}},e.prototype.uploadTint=function(t,e,i,r,n,o){for(var s=0;s<i;++s){var a=t[e+s],l=a._texture.baseTexture.alphaMode>0,c=a.alpha,u=c<1&&l?Su(a._tintRGB,c):a._tintRGB+(255*c<<24);r[o]=u,r[o+n]=u,r[o+2*n]=u,r[o+3*n]=u,o+=4*n}},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null},e}(bd);!function(t){t.MITER="miter",t.BEVEL="bevel",t.ROUND="round"}(um||(um={})),function(t){t.BUTT="butt",t.ROUND="round",t.SQUARE="square"}(hm||(hm={}));var fm={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount:function(t,e){if(void 0===e&&(e=20),!this.adaptive||!t||isNaN(t))return e;var i=Math.ceil(t/this.maxLength);return i<this.minSegments?i=this.minSegments:i>this.maxSegments&&(i=this.maxSegments),i}},mm=function(){function t(){this.color=16777215,this.alpha=1,this.texture=ed.WHITE,this.matrix=null,this.visible=!1,this.reset()}return t.prototype.clone=function(){var e=new t;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e},t.prototype.reset=function(){this.color=16777215,this.alpha=1,this.texture=ed.WHITE,this.matrix=null,this.visible=!1},t.prototype.destroy=function(){this.texture=null,this.matrix=null},t}(),gm=function(t,e){return(gm=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function _m(t,e){function i(){this.constructor=t}gm(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var ym={build:function(t){t.points=t.shape.points.slice()},triangulate:function(t,e){var i=t.points,r=t.holes,n=e.points,o=e.indices;if(i.length>=6){for(var s=[],a=0;a<r.length;a++){var l=r[a];s.push(i.length/2),i=i.concat(l.points)}var c=fu()(i,s,2);if(!c)return;var u=n.length/2;for(a=0;a<c.length;a+=3)o.push(c[a]+u),o.push(c[a+1]+u),o.push(c[a+2]+u);for(a=0;a<i.length;a++)n.push(i[a])}}},vm={build:function(t){var e,i,r=t.shape,n=t.points,o=r.x,s=r.y;if(n.length=0,t.type===Vu.CIRC)e=r.radius,i=r.radius;else{var a=t.shape;e=a.width,i=a.height}if(0!==e&&0!==i){var l=Math.floor(30*Math.sqrt(r.radius))||Math.floor(15*Math.sqrt(e+i));l/=2.3;for(var c=2*Math.PI/l,u=0;u<l-.5;u++)n.push(o+Math.sin(-c*u)*e,s+Math.cos(-c*u)*i);n.push(n[0],n[1])}},triangulate:function(t,e){var i=t.points,r=e.points,n=e.indices,o=r.length/2,s=o,a=t.shape,l=t.matrix,c=a.x,u=a.y;r.push(t.matrix?l.a*c+l.c*u+l.tx:c,t.matrix?l.b*c+l.d*u+l.ty:u);for(var h=0;h<i.length;h+=2)r.push(i[h],i[h+1]),n.push(o++,s,o)}},xm={build:function(t){var e=t.shape,i=e.x,r=e.y,n=e.width,o=e.height,s=t.points;s.length=0,s.push(i,r,i+n,r,i+n,r+o,i,r+o)},triangulate:function(t,e){var i=t.points,r=e.points,n=r.length/2;r.push(i[0],i[1],i[2],i[3],i[6],i[7],i[4],i[5]),e.indices.push(n,n+1,n+2,n+1,n+2,n+3)}};function bm(t,e,i){return t+(e-t)*i}function wm(t,e,i,r,n,o,s){void 0===s&&(s=[]);for(var a=s,l=0,c=0,u=0,h=0,d=0,p=0,f=0,m=0;f<=20;++f)l=bm(t,i,m=f/20),c=bm(e,r,m),u=bm(i,n,m),h=bm(r,o,m),d=bm(l,u,m),p=bm(c,h,m),0===f&&a[a.length-2]===d&&a[a.length-1]===p||a.push(d,p);return a}var Tm={build:function(t){var e=t.shape,i=t.points,r=e.x,n=e.y,o=e.width,s=e.height,a=Math.max(0,Math.min(e.radius,Math.min(o,s)/2));i.length=0,a?(wm(r,n+a,r,n,r+a,n,i),wm(r+o-a,n,r+o,n,r+o,n+a,i),wm(r+o,n+s-a,r+o,n+s,r+o-a,n+s,i),wm(r+a,n+s,r,n+s,r,n+s-a,i)):i.push(r,n,r+o,n,r+o,n+s,r,n+s)},triangulate:function(t,e){for(var i=t.points,r=e.points,n=e.indices,o=r.length/2,s=fu()(i,null,2),a=0,l=s.length;a<l;a+=3)n.push(s[a]+o),n.push(s[a+1]+o),n.push(s[a+2]+o);for(a=0,l=i.length;a<l;a++)r.push(i[a],i[++a])}};function Em(t,e,i,r,n,o,s,a){var l,c;s?(l=r,c=-i):(l=-r,c=i);var u=t-i*n+l,h=e-r*n+c,d=t+i*o+l,p=e+r*o+c;return a.push(u,h),a.push(d,p),2}function Sm(t,e,i,r,n,o,s,a){var l=i-t,c=r-e,u=Math.atan2(l,c),h=Math.atan2(n-t,o-e);a&&u<h?u+=2*Math.PI:!a&&u>h&&(h+=2*Math.PI);var d=u,p=h-u,f=Math.abs(p),m=Math.sqrt(l*l+c*c),g=1+(15*f*Math.sqrt(m)/Math.PI>>0),_=p/g;if(d+=_,a){s.push(t,e),s.push(i,r);for(var y=1,v=d;y<g;y++,v+=_)s.push(t,e),s.push(t+Math.sin(v)*m,e+Math.cos(v)*m);s.push(t,e),s.push(n,o)}else{s.push(i,r),s.push(t,e);for(y=1,v=d;y<g;y++,v+=_)s.push(t+Math.sin(v)*m,e+Math.cos(v)*m),s.push(t,e);s.push(n,o),s.push(t,e)}return 2*g}function Am(t,e){t.lineStyle.native?function(t,e){var i=0,r=t.shape,n=t.points||r.points,o=r.type!==Vu.POLY||r.closeStroke;if(0!==n.length){var s=e.points,a=e.indices,l=n.length/2,c=s.length/2,u=c;for(s.push(n[0],n[1]),i=1;i<l;i++)s.push(n[2*i],n[2*i+1]),a.push(u,u+1),u++;o&&a.push(u,c)}}(t,e):function(t,e){var i=t.shape,r=t.points||i.points.slice(),n=e.closePointEps;if(0!==r.length){var o=t.lineStyle,s=new Ju(r[0],r[1]),a=new Ju(r[r.length-2],r[r.length-1]),l=i.type!==Vu.POLY||i.closeStroke,c=Math.abs(s.x-a.x)<n&&Math.abs(s.y-a.y)<n;if(l){r=r.slice(),c&&(r.pop(),r.pop(),a.set(r[r.length-2],r[r.length-1]));var u=.5*(s.x+a.x),h=.5*(a.y+s.y);r.unshift(u,h),r.push(u,h)}var d=e.points,p=r.length/2,f=r.length,m=d.length/2,g=o.width/2,_=g*g,y=o.miterLimit*o.miterLimit,v=r[0],x=r[1],b=r[2],w=r[3],T=0,E=0,S=-(x-w),A=v-b,M=0,I=0,C=Math.sqrt(S*S+A*A);S/=C,A/=C,S*=g,A*=g;var P=o.alignment,R=2*(1-P),O=2*P;l||(o.cap===hm.ROUND?f+=Sm(v-S*(R-O)*.5,x-A*(R-O)*.5,v-S*R,x-A*R,v+S*O,x+A*O,d,!0)+2:o.cap===hm.SQUARE&&(f+=Em(v,x,S,A,R,O,!0,d))),d.push(v-S*R,x-A*R),d.push(v+S*O,x+A*O);for(var D=1;D<p-1;++D){v=r[2*(D-1)],x=r[2*(D-1)+1],b=r[2*D],w=r[2*D+1],T=r[2*(D+1)],E=r[2*(D+1)+1],S=-(x-w),A=v-b,S/=C=Math.sqrt(S*S+A*A),A/=C,S*=g,A*=g,M=-(w-E),I=b-T,M/=C=Math.sqrt(M*M+I*I),I/=C,M*=g,I*=g;var L=b-v,k=x-w,B=b-T,F=E-w,z=k*B-F*L,N=z<0;if(Math.abs(z)<.1)d.push(b-S*R,w-A*R),d.push(b+S*O,w+A*O);else{var U=(-S+v)*(-A+w)-(-S+b)*(-A+x),G=(-M+T)*(-I+w)-(-M+b)*(-I+E),j=(L*G-B*U)/z,V=(F*U-k*G)/z,X=(j-b)*(j-b)+(V-w)*(V-w),H=b+(j-b)*R,q=w+(V-w)*R,W=b-(j-b)*O,$=w-(V-w)*O,Y=N?R:O;X<=Math.min(L*L+k*k,B*B+F*F)+Y*Y*_?o.join===um.BEVEL||X/_>y?(N?(d.push(H,q),d.push(b+S*O,w+A*O),d.push(H,q),d.push(b+M*O,w+I*O)):(d.push(b-S*R,w-A*R),d.push(W,$),d.push(b-M*R,w-I*R),d.push(W,$)),f+=2):o.join===um.ROUND?N?(d.push(H,q),d.push(b+S*O,w+A*O),f+=Sm(b,w,b+S*O,w+A*O,b+M*O,w+I*O,d,!0)+4,d.push(H,q),d.push(b+M*O,w+I*O)):(d.push(b-S*R,w-A*R),d.push(W,$),f+=Sm(b,w,b-S*R,w-A*R,b-M*R,w-I*R,d,!1)+4,d.push(b-M*R,w-I*R),d.push(W,$)):(d.push(H,q),d.push(W,$)):(d.push(b-S*R,w-A*R),d.push(b+S*O,w+A*O),o.join===um.BEVEL||X/_>y||(o.join===um.ROUND?f+=N?Sm(b,w,b+S*O,w+A*O,b+M*O,w+I*O,d,!0)+2:Sm(b,w,b-S*R,w-A*R,b-M*R,w-I*R,d,!1)+2:(N?(d.push(W,$),d.push(W,$)):(d.push(H,q),d.push(H,q)),f+=2)),d.push(b-M*R,w-I*R),d.push(b+M*O,w+I*O),f+=2)}}v=r[2*(p-2)],x=r[2*(p-2)+1],b=r[2*(p-1)],S=-(x-(w=r[2*(p-1)+1])),A=v-b,S/=C=Math.sqrt(S*S+A*A),A/=C,S*=g,A*=g,d.push(b-S*R,w-A*R),d.push(b+S*O,w+A*O),l||(o.cap===hm.ROUND?f+=Sm(b-S*(R-O)*.5,w-A*(R-O)*.5,b-S*R,w-A*R,b+S*O,w+A*O,d,!1)+2:o.cap===hm.SQUARE&&(f+=Em(b,w,S,A,R,O,!1,d)));var Z=e.indices,K=fm.epsilon*fm.epsilon;for(D=m;D<f+m-2;++D)v=d[2*D],x=d[2*D+1],b=d[2*(D+1)],w=d[2*(D+1)+1],T=d[2*(D+2)],E=d[2*(D+2)+1],Math.abs(v*(w-E)+b*(E-x)+T*(x-w))<K||Z.push(D,D+1,D+2)}}(t,e)}var Mm,Im=function(){function t(){}return t.curveTo=function(t,e,i,r,n,o){var s=o[o.length-2],a=o[o.length-1]-e,l=s-t,c=r-e,u=i-t,h=Math.abs(a*u-l*c);if(h<1e-8||0===n)return o[o.length-2]===t&&o[o.length-1]===e||o.push(t,e),null;var d=a*a+l*l,p=c*c+u*u,f=a*c+l*u,m=n*Math.sqrt(d)/h,g=n*Math.sqrt(p)/h,_=m*f/d,y=g*f/p,v=m*u+g*l,x=m*c+g*a,b=l*(g+_),w=a*(g+_),T=u*(m+y),E=c*(m+y);return{cx:v+t,cy:x+e,radius:n,startAngle:Math.atan2(w-x,b-v),endAngle:Math.atan2(E-x,T-v),anticlockwise:l*c>u*a}},t.arc=function(t,e,i,r,n,o,s,a,l){for(var c=s-o,u=fm._segmentsCount(Math.abs(c)*n,40*Math.ceil(Math.abs(c)/Xu)),h=c/(2*u),d=2*h,p=Math.cos(h),f=Math.sin(h),m=u-1,g=m%1/m,_=0;_<=m;++_){var y=h+o+d*(_+g*_),v=Math.cos(y),x=-Math.sin(y);l.push((p*v+f*x)*n+i,(p*-x+f*v)*n+r)}},t}(),Cm=function(){function t(){}return t.curveLength=function(t,e,i,r,n,o,s,a){for(var l=0,c=0,u=0,h=0,d=0,p=0,f=0,m=0,g=0,_=0,y=0,v=t,x=e,b=1;b<=10;++b)_=v-(m=(f=(p=(d=1-(c=b/10))*d)*d)*t+3*p*c*i+3*d*(u=c*c)*n+(h=u*c)*s),y=x-(g=f*e+3*p*c*r+3*d*u*o+h*a),v=m,x=g,l+=Math.sqrt(_*_+y*y);return l},t.curveTo=function(e,i,r,n,o,s,a){var l=a[a.length-2],c=a[a.length-1];a.length-=2;var u=fm._segmentsCount(t.curveLength(l,c,e,i,r,n,o,s)),h=0,d=0,p=0,f=0,m=0;a.push(l,c);for(var g=1,_=0;g<=u;++g)p=(d=(h=1-(_=g/u))*h)*h,m=(f=_*_)*_,a.push(p*l+3*d*_*e+3*h*f*r+m*o,p*c+3*d*_*i+3*h*f*n+m*s)},t}(),Pm=function(){function t(){}return t.curveLength=function(t,e,i,r,n,o){var s=t-2*i+n,a=e-2*r+o,l=2*i-2*t,c=2*r-2*e,u=4*(s*s+a*a),h=4*(s*l+a*c),d=l*l+c*c,p=2*Math.sqrt(u+h+d),f=Math.sqrt(u),m=2*u*f,g=2*Math.sqrt(d),_=h/f;return(m*p+f*h*(p-g)+(4*d*u-h*h)*Math.log((2*f+_+p)/(_+g)))/(4*m)},t.curveTo=function(e,i,r,n,o){for(var s=o[o.length-2],a=o[o.length-1],l=fm._segmentsCount(t.curveLength(s,a,e,i,r,n)),c=0,u=0,h=1;h<=l;++h){var d=h/l;c=s+(e-s)*d,u=a+(i-a)*d,o.push(c+(e+(r-e)*d-c)*d,u+(i+(n-i)*d-u)*d)}},t}(),Rm=function(){function t(){this.reset()}return t.prototype.begin=function(t,e,i){this.reset(),this.style=t,this.start=e,this.attribStart=i},t.prototype.end=function(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start},t.prototype.reset=function(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0},t}(),Om=((Mm={})[Vu.POLY]=ym,Mm[Vu.CIRC]=vm,Mm[Vu.ELIP]=vm,Mm[Vu.RECT]=xm,Mm[Vu.RREC]=Tm,Mm),Dm=[],Lm=[];function km(t){for(var e=t.points,i=0,r=0;r<e.length-2;r+=2)i+=(e[r+2]-e[r])*(e[r+3]+e[r+1]);return i>0}var Bm=function(){function t(t,e,i,r){void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=null),this.points=[],this.holes=[],this.shape=t,this.lineStyle=i,this.fillStyle=e,this.matrix=r,this.type=t.type}return t.prototype.clone=function(){return new t(this.shape,this.fillStyle,this.lineStyle,this.matrix)},t.prototype.destroy=function(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null},t}(),Fm=new Ju,zm=new uh,Nm=function(t){function e(){var e=t.call(this)||this;return e.closePointEps=1e-4,e.boundsPadding=0,e.uvsFloat32=null,e.indicesUint16=null,e.batchable=!1,e.points=[],e.colors=[],e.uvs=[],e.indices=[],e.textureIds=[],e.graphicsData=[],e.drawCalls=[],e.batchDirty=-1,e.batches=[],e.dirty=0,e.cacheDirty=-1,e.clearDirty=0,e.shapeIndex=0,e._bounds=new uh,e.boundsDirty=-1,e}return _m(e,t),Object.defineProperty(e.prototype,"bounds",{get:function(){return this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds},enumerable:!1,configurable:!0}),e.prototype.invalidate=function(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(var t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Lm.push(this.drawCalls[t]);this.drawCalls.length=0;for(t=0;t<this.batches.length;t++){var e=this.batches[t];e.reset(),Dm.push(e)}this.batches.length=0},e.prototype.clear=function(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this},e.prototype.drawShape=function(t,e,i,r){void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=null);var n=new Bm(t,e,i,r);return this.graphicsData.push(n),this.dirty++,this},e.prototype.drawHole=function(t,e){if(void 0===e&&(e=null),!this.graphicsData.length)return null;var i=new Bm(t,null,null,e),r=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=r.lineStyle,r.holes.push(i),this.dirty++,this},e.prototype.destroy=function(){t.prototype.destroy.call(this);for(var e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null},e.prototype.containsPoint=function(t){for(var e=this.graphicsData,i=0;i<e.length;++i){var r=e[i];if(r.fillStyle.visible&&(r.shape&&(r.matrix?r.matrix.applyInverse(t,Fm):Fm.copyFrom(t),r.shape.contains(Fm.x,Fm.y)))){var n=!1;if(r.holes)for(var o=0;o<r.holes.length;o++){if(r.holes[o].shape.contains(Fm.x,Fm.y)){n=!0;break}}if(!n)return!0}}return!1},e.prototype.updateBatches=function(t){if(this.graphicsData.length){if(this.validateBatching()){this.cacheDirty=this.dirty;var e=this.uvs,i=this.graphicsData,r=null,n=null;this.batches.length>0&&(n=(r=this.batches[this.batches.length-1]).style);for(var o=this.shapeIndex;o<i.length;o++){this.shapeIndex++;var s=i[o],a=s.fillStyle,l=s.lineStyle;Om[s.type].build(s),s.matrix&&this.transformPoints(s.points,s.matrix);for(var c=0;c<2;c++){var u=0===c?a:l;if(u.visible){var h=u.texture.baseTexture,d=this.indices.length,p=this.points.length/2;h.wrapMode=eu.REPEAT,0===c?this.processFill(s):this.processLine(s);var f=this.points.length/2-p;0!==f&&(r&&!this._compareStyles(n,u)&&(r.end(d,p),r=null),r||((r=Dm.pop()||new Rm).begin(u,d,p),this.batches.push(r),n=u),this.addUvs(this.points,e,u.texture,p,f,u.matrix))}}}var m=this.indices.length,g=this.points.length/2;if(r&&r.end(m,g),0!==this.batches.length){if(this.indicesUint16&&this.indices.length===this.indicesUint16.length)this.indicesUint16.set(this.indices);else{var _=g>65535&&t;this.indicesUint16=_?new Uint32Array(this.indices):new Uint16Array(this.indices)}this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}else this.batchable=!0}}else this.batchable=!0},e.prototype._compareStyles=function(t,e){return!(!t||!e)&&(t.texture.baseTexture===e.texture.baseTexture&&(t.color+t.alpha===e.color+e.alpha&&!!t.native==!!e.native))},e.prototype.validateBatching=function(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(var t=0,e=this.graphicsData.length;t<e;t++){var i=this.graphicsData[t],r=i.fillStyle,n=i.lineStyle;if(r&&!r.texture.baseTexture.valid)return!1;if(n&&!n.texture.baseTexture.valid)return!1}return!0},e.prototype.packBatches=function(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);for(var t=this.batches,e=0,i=t.length;e<i;e++)for(var r=t[e],n=0;n<r.size;n++){var o=r.start+n;this.indicesUint16[o]=this.indicesUint16[o]-r.attribStart}},e.prototype.isBatchable=function(){if(this.points.length>131070)return!1;for(var t=this.batches,i=0;i<t.length;i++)if(t[i].style.native)return!1;return this.points.length<2*e.BATCHABLE_SIZE},e.prototype.buildDrawCalls=function(){for(var t=++Nh._globalBatch,e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),Lm.push(this.drawCalls[e]);this.drawCalls.length=0;var i=this.colors,r=this.textureIds,n=Lm.pop();n||((n=new Lp).texArray=new kp),n.texArray.count=0,n.start=0,n.size=0,n.type=Yc.TRIANGLES;var o=0,s=null,a=0,l=!1,c=Yc.TRIANGLES,u=0;this.drawCalls.push(n);for(e=0;e<this.batches.length;e++){var h=this.batches[e],d=h.style,p=d.texture.baseTexture;l!==!!d.native&&(c=(l=!!d.native)?Yc.LINES:Yc.TRIANGLES,s=null,o=8,t++),s!==p&&(s=p,p._batchEnabled!==t&&(8===o&&(t++,o=0,n.size>0&&((n=Lm.pop())||((n=new Lp).texArray=new kp),this.drawCalls.push(n)),n.start=u,n.size=0,n.texArray.count=0,n.type=c),p.touched=1,p._batchEnabled=t,p._batchLocation=o,p.wrapMode=eu.REPEAT,n.texArray.elements[n.texArray.count++]=p,o++)),n.size+=h.size,u+=h.size,a=p._batchLocation,this.addColors(i,d.color,d.alpha,h.attribSize,h.attribStart),this.addTextureIds(r,a,h.attribSize,h.attribStart)}Nh._globalBatch=t,this.packAttributes()},e.prototype.packAttributes=function(){for(var t=this.points,e=this.uvs,i=this.colors,r=this.textureIds,n=new ArrayBuffer(3*t.length*4),o=new Float32Array(n),s=new Uint32Array(n),a=0,l=0;l<t.length/2;l++)o[a++]=t[2*l],o[a++]=t[2*l+1],o[a++]=e[2*l],o[a++]=e[2*l+1],s[a++]=i[l],o[a++]=r[l];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)},e.prototype.processFill=function(t){t.holes.length?(this.processHoles(t.holes),ym.triangulate(t,this)):Om[t.type].triangulate(t,this)},e.prototype.processLine=function(t){Am(t,this);for(var e=0;e<t.holes.length;e++)Am(t.holes[e],this)},e.prototype.processHoles=function(t){for(var e=0;e<t.length;e++){var i=t[e];Om[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}},e.prototype.calculateBounds=function(){var t=this._bounds,e=zm,i=th.IDENTITY;this._bounds.clear(),e.clear();for(var r=0;r<this.graphicsData.length;r++){var n=this.graphicsData[r],o=n.shape,s=n.type,a=n.lineStyle,l=n.matrix||th.IDENTITY,c=0;if(a&&a.visible){var u=a.alignment;c=a.width,s===Vu.POLY?km(o)?c*=1-u:c*=u:c*=Math.max(0,u)}if(i!==l&&(e.isEmpty()||(t.addBoundsMatrix(e,i),e.clear()),i=l),s===Vu.RECT||s===Vu.RREC){var h=o;e.addFramePad(h.x,h.y,h.x+h.width,h.y+h.height,c,c)}else if(s===Vu.CIRC){var d=o;e.addFramePad(d.x,d.y,d.x,d.y,d.radius+c,d.radius+c)}else if(s===Vu.ELIP){var p=o;e.addFramePad(p.x,p.y,p.x,p.y,p.width+c,p.height+c)}else{var f=o;t.addVerticesMatrix(i,f.points,0,f.points.length,c,c)}}e.isEmpty()||t.addBoundsMatrix(e,i),t.pad(this.boundsPadding,this.boundsPadding)},e.prototype.transformPoints=function(t,e){for(var i=0;i<t.length/2;i++){var r=t[2*i],n=t[2*i+1];t[2*i]=e.a*r+e.c*n+e.tx,t[2*i+1]=e.b*r+e.d*n+e.ty}},e.prototype.addColors=function(t,e,i,r,n){void 0===n&&(n=0);var o=Su((e>>16)+(65280&e)+((255&e)<<16),i);t.length=Math.max(t.length,n+r);for(var s=0;s<r;s++)t[n+s]=o},e.prototype.addTextureIds=function(t,e,i,r){void 0===r&&(r=0),t.length=Math.max(t.length,r+i);for(var n=0;n<i;n++)t[r+n]=e},e.prototype.addUvs=function(t,e,i,r,n,o){void 0===o&&(o=null);for(var s=0,a=e.length,l=i.frame;s<n;){var c=t[2*(r+s)],u=t[2*(r+s)+1];if(o){var h=o.a*c+o.c*u+o.tx;u=o.b*c+o.d*u+o.ty,c=h}s++,e.push(c/l.width,u/l.height)}var d=i.baseTexture;(l.width<d.width||l.height<d.height)&&this.adjustUvs(e,i,a,n)},e.prototype.adjustUvs=function(t,e,i,r){for(var n=e.baseTexture,o=1e-6,s=i+2*r,a=e.frame,l=a.width/n.width,c=a.height/n.height,u=a.x/a.width,h=a.y/a.height,d=Math.floor(t[i]+o),p=Math.floor(t[i+1]+o),f=i+2;f<s;f+=2)d=Math.min(d,Math.floor(t[f]+o)),p=Math.min(p,Math.floor(t[f+1]+o));u-=d,h-=p;for(f=i;f<s;f+=2)t[f]=(t[f]+u)*l,t[f+1]=(t[f+1]+h)*c},e.BATCHABLE_SIZE=100,e}(Np),Um=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.width=0,e.alignment=.5,e.native=!1,e.cap=hm.BUTT,e.join=um.MITER,e.miterLimit=10,e}return _m(e,t),e.prototype.clone=function(){var t=new e;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t},e.prototype.reset=function(){t.prototype.reset.call(this),this.color=0,this.alignment=.5,this.width=0,this.native=!1},e}(mm),Gm=new Float32Array(3),jm={},Vm=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this)||this;return i.shader=null,i.pluginName="batch",i.currentPath=null,i.batches=[],i.batchTint=-1,i.batchDirty=-1,i.vertexData=null,i._fillStyle=new mm,i._lineStyle=new Um,i._matrix=null,i._holeMode=!1,i.state=ep.for2d(),i._geometry=e||new Nm,i._geometry.refCount++,i._transformID=-1,i.tint=16777215,i.blendMode=$c.NORMAL,i}return _m(e,t),Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),e.prototype.clone=function(){return this.finishPoly(),new e(this._geometry)},Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fill",{get:function(){return this._fillStyle},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"line",{get:function(){return this._lineStyle},enumerable:!1,configurable:!0}),e.prototype.lineStyle=function(t,e,i,r,n){return void 0===t&&(t=null),void 0===e&&(e=0),void 0===i&&(i=1),void 0===r&&(r=.5),void 0===n&&(n=!1),"number"==typeof t&&(t={width:t,color:e,alpha:i,alignment:r,native:n}),this.lineTextureStyle(t)},e.prototype.lineTextureStyle=function(t){t=Object.assign({width:0,texture:ed.WHITE,color:t&&t.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:hm.BUTT,join:um.MITER,miterLimit:10},t),this.currentPath&&this.startPoly();var e=t.width>0&&t.alpha>0;return e?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:e},t)):this._lineStyle.reset(),this},e.prototype.startPoly=function(){if(this.currentPath){var t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new Zu,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new Zu,this.currentPath.closeStroke=!1},e.prototype.finishPoly=function(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)},e.prototype.moveTo=function(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this},e.prototype.lineTo=function(t,e){this.currentPath||this.moveTo(0,0);var i=this.currentPath.points,r=i[i.length-2],n=i[i.length-1];return r===t&&n===e||i.push(t,e),this},e.prototype._initCurve=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)},e.prototype.quadraticCurveTo=function(t,e,i,r){this._initCurve();var n=this.currentPath.points;return 0===n.length&&this.moveTo(0,0),Pm.curveTo(t,e,i,r,n),this},e.prototype.bezierCurveTo=function(t,e,i,r,n,o){return this._initCurve(),Cm.curveTo(t,e,i,r,n,o,this.currentPath.points),this},e.prototype.arcTo=function(t,e,i,r,n){this._initCurve(t,e);var o=this.currentPath.points,s=Im.curveTo(t,e,i,r,n,o);if(s){var a=s.cx,l=s.cy,c=s.radius,u=s.startAngle,h=s.endAngle,d=s.anticlockwise;this.arc(a,l,c,u,h,d)}return this},e.prototype.arc=function(t,e,i,r,n,o){if(void 0===o&&(o=!1),r===n)return this;if(!o&&n<=r?n+=Xu:o&&r<=n&&(r+=Xu),0===n-r)return this;var s=t+Math.cos(r)*i,a=e+Math.sin(r)*i,l=this._geometry.closePointEps,c=this.currentPath?this.currentPath.points:null;if(c){var u=Math.abs(c[c.length-2]-s),h=Math.abs(c[c.length-1]-a);u<l&&h<l||c.push(s,a)}else this.moveTo(s,a),c=this.currentPath.points;return Im.arc(s,a,t,e,i,r,n,o,c),this},e.prototype.beginFill=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=1),this.beginTextureFill({texture:ed.WHITE,color:t,alpha:e})},e.prototype.beginTextureFill=function(t){t=Object.assign({texture:ed.WHITE,color:16777215,alpha:1,matrix:null},t),this.currentPath&&this.startPoly();var e=t.alpha>0;return e?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:e},t)):this._fillStyle.reset(),this},e.prototype.endFill=function(){return this.finishPoly(),this._fillStyle.reset(),this},e.prototype.drawRect=function(t,e,i,r){return this.drawShape(new Wu(t,e,i,r))},e.prototype.drawRoundedRect=function(t,e,i,r,n){return this.drawShape(new Ku(t,e,i,r,n))},e.prototype.drawCircle=function(t,e,i){return this.drawShape(new $u(t,e,i))},e.prototype.drawEllipse=function(t,e,i,r){return this.drawShape(new Yu(t,e,i,r))},e.prototype.drawPolygon=function(){for(var t,e=arguments,i=[],r=0;r<arguments.length;r++)i[r]=e[r];var n=!0,o=i[0];o.points?(n=o.closeStroke,t=o.points):t=Array.isArray(i[0])?i[0]:i;var s=new Zu(t);return s.closeStroke=n,this.drawShape(s),this},e.prototype.drawShape=function(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this},e.prototype.clear=function(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this},e.prototype.isFastRect=function(){var t=this._geometry.graphicsData;return!(1!==t.length||t[0].shape.type!==Vu.RECT||t[0].holes.length||t[0].lineStyle.visible&&t[0].lineStyle.width)},e.prototype._render=function(t){this.finishPoly();var e=this._geometry,i=t.context.supports.uint32Indices;e.updateBatches(i),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))},e.prototype._populateBatches=function(){var t=this._geometry,e=this.blendMode,i=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(t.points);for(var r=0;r<i;r++){var n=t.batches[r],o=n.style.color,s=new Float32Array(this.vertexData.buffer,4*n.attribStart*2,2*n.attribSize),a=new Float32Array(t.uvsFloat32.buffer,4*n.attribStart*2,2*n.attribSize),l={vertexData:s,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*n.start,n.size),uvs:a,_batchRGB:xu(o),_tintRGB:o,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[r]=l}},e.prototype._renderBatched=function(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(var e=0,i=this.batches.length;e<i;e++){var r=this.batches[e];r.worldAlpha=this.worldAlpha*r.alpha,t.plugins[this.pluginName].render(r)}}},e.prototype._renderDirect=function(t){var e=this._resolveDirectShader(t),i=this._geometry,r=this.tint,n=this.worldAlpha,o=e.uniforms,s=i.drawCalls;o.translationMatrix=this.transform.worldTransform,o.tint[0]=(r>>16&255)/255*n,o.tint[1]=(r>>8&255)/255*n,o.tint[2]=(255&r)/255*n,o.tint[3]=n,t.shader.bind(e),t.geometry.bind(i,e),t.state.set(this.state);for(var a=0,l=s.length;a<l;a++)this._renderDrawCallDirect(t,i.drawCalls[a])},e.prototype._renderDrawCallDirect=function(t,e){for(var i=e.texArray,r=e.type,n=e.size,o=e.start,s=i.count,a=0;a<s;a++)t.texture.bind(i.elements[a],a);t.geometry.draw(r,n,o)},e.prototype._resolveDirectShader=function(t){var e=this.shader,i=this.pluginName;if(!e){if(!jm[i]){for(var r=t.plugins.batch.MAX_TEXTURES,n=new Int32Array(r),o=0;o<r;o++)n[o]=o;var s={tint:new Float32Array([1,1,1,1]),translationMatrix:new th,default:gd.from({uSamplers:n},!0)},a=t.plugins[i]._shader.program;jm[i]=new tp(a,s)}e=jm[i]}return e},e.prototype._calculateBounds=function(){this.finishPoly();var t=this._geometry;if(t.graphicsData.length){var e=t.bounds,i=e.minX,r=e.minY,n=e.maxX,o=e.maxY;this._bounds.addFrame(this.transform,i,r,n,o)}},e.prototype.containsPoint=function(t){return this.worldTransform.applyInverse(t,e._TEMP_POINT),this._geometry.containsPoint(e._TEMP_POINT)},e.prototype.calculateTints=function(){if(this.batchTint!==this.tint){this.batchTint=this.tint;for(var t=xu(this.tint,Gm),e=0;e<this.batches.length;e++){var i=this.batches[e],r=i._batchRGB,n=(t[0]*r[0]*255<<16)+(t[1]*r[1]*255<<8)+(0|t[2]*r[2]*255);i._tintRGB=(n>>16)+(65280&n)+((255&n)<<16)}}},e.prototype.calculateVertices=function(){var t=this.transform._worldID;if(this._transformID!==t){this._transformID=t;for(var e=this.transform.worldTransform,i=e.a,r=e.b,n=e.c,o=e.d,s=e.tx,a=e.ty,l=this._geometry.points,c=this.vertexData,u=0,h=0;h<l.length;h+=2){var d=l[h],p=l[h+1];c[u++]=i*d+n*p+s,c[u++]=o*p+r*d+a}}},e.prototype.closePath=function(){var t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this},e.prototype.setMatrix=function(t){return this._matrix=t,this},e.prototype.beginHole=function(){return this.finishPoly(),this._holeMode=!0,this},e.prototype.endHole=function(){return this.finishPoly(),this._holeMode=!1,this},e.prototype.destroy=function(e){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,t.prototype.destroy.call(this,e)},e._TEMP_POINT=new Ju,e}(gh),Xm=function(t,e){return(Xm=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};var Hm,qm=new Ju,Wm=new Uint16Array([0,1,2,0,2,3]),$m=function(t){function e(e){var i=t.call(this)||this;return i._anchor=new Qu(i._onAnchorUpdate,i,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),i._texture=null,i._width=0,i._height=0,i._tint=null,i._tintRGB=null,i.tint=16777215,i.blendMode=$c.NORMAL,i._cachedTint=16777215,i.uvs=null,i.texture=e||ed.EMPTY,i.vertexData=new Float32Array(8),i.vertexTrimmedData=null,i._transformID=-1,i._textureID=-1,i._transformTrimmedID=-1,i._textureTrimmedID=-1,i.indices=Wm,i.pluginName="batch",i.isSprite=!0,i._roundPixels=uu.ROUND_PIXELS,i}return function(t,e){function i(){this.constructor=t}Xm(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),e.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Ou(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Ou(this.scale.y)*this._height/this._texture.orig.height)},e.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},e.prototype.calculateVertices=function(){var t=this._texture;if(this._transformID!==this.transform._worldID||this._textureID!==t._updateID){this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;var e=this.transform.worldTransform,i=e.a,r=e.b,n=e.c,o=e.d,s=e.tx,a=e.ty,l=this.vertexData,c=t.trim,u=t.orig,h=this._anchor,d=0,p=0,f=0,m=0;if(c?(d=(p=c.x-h._x*u.width)+c.width,f=(m=c.y-h._y*u.height)+c.height):(d=(p=-h._x*u.width)+u.width,f=(m=-h._y*u.height)+u.height),l[0]=i*p+n*m+s,l[1]=o*m+r*p+a,l[2]=i*d+n*m+s,l[3]=o*m+r*d+a,l[4]=i*d+n*f+s,l[5]=o*f+r*d+a,l[6]=i*p+n*f+s,l[7]=o*f+r*p+a,this._roundPixels)for(var g=uu.RESOLUTION,_=0;_<l.length;++_)l[_]=Math.round((l[_]*g|0)/g)}},e.prototype.calculateTrimmedVertices=function(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var t=this._texture,e=this.vertexTrimmedData,i=t.orig,r=this._anchor,n=this.transform.worldTransform,o=n.a,s=n.b,a=n.c,l=n.d,c=n.tx,u=n.ty,h=-r._x*i.width,d=h+i.width,p=-r._y*i.height,f=p+i.height;e[0]=o*h+a*p+c,e[1]=l*p+s*h+u,e[2]=o*d+a*p+c,e[3]=l*p+s*d+u,e[4]=o*d+a*f+c,e[5]=l*f+s*d+u,e[6]=o*h+a*f+c,e[7]=l*f+s*h+u},e.prototype._render=function(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)},e.prototype._calculateBounds=function(){var t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},e.prototype.getLocalBounds=function(e){return 0===this.children.length?(this._bounds.minX=this._texture.orig.width*-this._anchor._x,this._bounds.minY=this._texture.orig.height*-this._anchor._y,this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new Wu),e=this._localBoundsRect),this._bounds.getRectangle(e)):t.prototype.getLocalBounds.call(this,e)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,qm);var e=this._texture.orig.width,i=this._texture.orig.height,r=-e*this.anchor.x,n=0;return qm.x>=r&&qm.x<r+e&&(n=-i*this.anchor.y,qm.y>=n&&qm.y<n+i)},e.prototype.destroy=function(e){if(t.prototype.destroy.call(this,e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof e?e:e&&e.texture){var i="boolean"==typeof e?e:e&&e.baseTexture;this._texture.destroy(!!i)}this._texture=null},e.from=function(t,i){return new e(t instanceof ed?t:ed.from(t,i))},Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){var e=Ou(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){var e=Ou(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anchor",{get:function(){return this._anchor},set:function(t){this._anchor.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||ed.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))},enumerable:!1,configurable:!0}),e}(gh),Ym=function(t,e){return(Ym=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};!function(t){t[t.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",t[t.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL"}(Hm||(Hm={}));var Zm={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Hm.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},Km=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Jm=function(){function t(t){this.styleID=0,this.reset(),eg(this,t,t)}return t.prototype.clone=function(){var e={};return eg(e,this,Zm),new t(e)},t.prototype.reset=function(){eg(this,Zm,Zm)},Object.defineProperty(t.prototype,"align",{get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"breakWords",{get:function(){return this._breakWords},set:function(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadow",{get:function(){return this._dropShadow},set:function(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowAlpha",{get:function(){return this._dropShadowAlpha},set:function(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowAngle",{get:function(){return this._dropShadowAngle},set:function(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowBlur",{get:function(){return this._dropShadowBlur},set:function(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowColor",{get:function(){return this._dropShadowColor},set:function(t){var e=tg(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowDistance",{get:function(){return this._dropShadowDistance},set:function(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fill",{get:function(){return this._fill},set:function(t){var e=tg(t);this._fill!==e&&(this._fill=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fillGradientType",{get:function(){return this._fillGradientType},set:function(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fillGradientStops",{get:function(){return this._fillGradientStops},set:function(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(var i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontVariant",{get:function(){return this._fontVariant},set:function(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leading",{get:function(){return this._leading},set:function(t){this._leading!==t&&(this._leading=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineJoin",{get:function(){return this._lineJoin},set:function(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"miterLimit",{get:function(){return this._miterLimit},set:function(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding!==t&&(this._padding=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stroke",{get:function(){return this._stroke},set:function(t){var e=tg(t);this._stroke!==e&&(this._stroke=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"strokeThickness",{get:function(){return this._strokeThickness},set:function(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textBaseline",{get:function(){return this._textBaseline},set:function(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"trim",{get:function(){return this._trim},set:function(t){this._trim!==t&&(this._trim=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"whiteSpace",{get:function(){return this._whiteSpace},set:function(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wordWrap",{get:function(){return this._wordWrap},set:function(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wordWrapWidth",{get:function(){return this._wordWrapWidth},set:function(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)},enumerable:!1,configurable:!0}),t.prototype.toFontString=function(){var t="number"==typeof this.fontSize?this.fontSize+"px":this.fontSize,e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(var i=e.length-1;i>=0;i--){var r=e[i].trim();!/([\"\'])[^\'\"]+\1/.test(r)&&Km.indexOf(r)<0&&(r='"'+r+'"'),e[i]=r}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+t+" "+e.join(",")},t}();function Qm(t){return"number"==typeof t?bu(t):("string"==typeof t&&0===t.indexOf("0x")&&(t=t.replace("0x","#")),t)}function tg(t){if(Array.isArray(t)){for(var e=0;e<t.length;++e)t[e]=Qm(t[e]);return t}return Qm(t)}function eg(t,e,i){for(var r in i)Array.isArray(e[r])?t[r]=e[r].slice():t[r]=e[r]}var ig=function(){function t(t,e,i,r,n,o,s,a,l){this.text=t,this.style=e,this.width=i,this.height=r,this.lines=n,this.lineWidths=o,this.lineHeight=s,this.maxLineWidth=a,this.fontProperties=l}return t.measureText=function(e,i,r,n){void 0===n&&(n=t._canvas),r=null==r?i.wordWrap:r;var o=i.toFontString(),s=t.measureFont(o);0===s.fontSize&&(s.fontSize=i.fontSize,s.ascent=i.fontSize);var a=n.getContext("2d");a.font=o;for(var l=(r?t.wordWrap(e,i,n):e).split(/(?:\r\n|\r|\n)/),c=new Array(l.length),u=0,h=0;h<l.length;h++){var d=a.measureText(l[h]).width+(l[h].length-1)*i.letterSpacing;c[h]=d,u=Math.max(u,d)}var p=u+i.strokeThickness;i.dropShadow&&(p+=i.dropShadowDistance);var f=i.lineHeight||s.fontSize+i.strokeThickness,m=Math.max(f,s.fontSize+i.strokeThickness)+(l.length-1)*(f+i.leading);return i.dropShadow&&(m+=i.dropShadowDistance),new t(e,i,p,m,l,c,f+i.leading,u,s)},t.wordWrap=function(e,i,r){void 0===r&&(r=t._canvas);for(var n=r.getContext("2d"),o=0,s="",a="",l=Object.create(null),c=i.letterSpacing,u=i.whiteSpace,h=t.collapseSpaces(u),d=t.collapseNewlines(u),p=!h,f=i.wordWrapWidth+c,m=t.tokenize(e),g=0;g<m.length;g++){var _=m[g];if(t.isNewline(_)){if(!d){a+=t.addLine(s),p=!h,s="",o=0;continue}_=" "}if(h){var y=t.isBreakingSpace(_),v=t.isBreakingSpace(s[s.length-1]);if(y&&v)continue}var x=t.getFromCache(_,c,l,n);if(x>f)if(""!==s&&(a+=t.addLine(s),s="",o=0),t.canBreakWords(_,i.breakWords))for(var b=t.wordWrapSplit(_),w=0;w<b.length;w++){for(var T=b[w],E=1;b[w+E];){var S=b[w+E],A=T[T.length-1];if(t.canBreakChars(A,S,_,w,i.breakWords))break;T+=S,E++}w+=T.length-1;var M=t.getFromCache(T,c,l,n);M+o>f&&(a+=t.addLine(s),p=!1,s="",o=0),s+=T,o+=M}else{s.length>0&&(a+=t.addLine(s),s="",o=0);var I=g===m.length-1;a+=t.addLine(_,!I),p=!1,s="",o=0}else x+o>f&&(p=!1,a+=t.addLine(s),s="",o=0),(s.length>0||!t.isBreakingSpace(_)||p)&&(s+=_,o+=x)}return a+=t.addLine(s,!1)},t.addLine=function(e,i){return void 0===i&&(i=!0),e=t.trimRight(e),e=i?e+"\n":e},t.getFromCache=function(t,e,i,r){var n=i[t];if("number"!=typeof n){var o=t.length*e;n=r.measureText(t).width+o,i[t]=n}return n},t.collapseSpaces=function(t){return"normal"===t||"pre-line"===t},t.collapseNewlines=function(t){return"normal"===t},t.trimRight=function(e){if("string"!=typeof e)return"";for(var i=e.length-1;i>=0;i--){var r=e[i];if(!t.isBreakingSpace(r))break;e=e.slice(0,-1)}return e},t.isNewline=function(e){return"string"==typeof e&&t._newlines.indexOf(e.charCodeAt(0))>=0},t.isBreakingSpace=function(e,i){return"string"==typeof e&&t._breakingSpaces.indexOf(e.charCodeAt(0))>=0},t.tokenize=function(e){var i=[],r="";if("string"!=typeof e)return i;for(var n=0;n<e.length;n++){var o=e[n],s=e[n+1];t.isBreakingSpace(o,s)||t.isNewline(o)?(""!==r&&(i.push(r),r=""),i.push(o)):r+=o}return""!==r&&i.push(r),i},t.canBreakWords=function(t,e){return e},t.canBreakChars=function(t,e,i,r,n){return!0},t.wordWrapSplit=function(t){return t.split("")},t.measureFont=function(e){if(t._fonts[e])return t._fonts[e];var i={ascent:0,descent:0,fontSize:0},r=t._canvas,n=t._context;n.font=e;var o=t.METRICS_STRING+t.BASELINE_SYMBOL,s=Math.ceil(n.measureText(o).width),a=Math.ceil(n.measureText(t.BASELINE_SYMBOL).width),l=Math.ceil(t.HEIGHT_MULTIPLIER*a);a=a*t.BASELINE_MULTIPLIER|0,r.width=s,r.height=l,n.fillStyle="#f00",n.fillRect(0,0,s,l),n.font=e,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(o,0,a);var c=n.getImageData(0,0,s,l).data,u=c.length,h=4*s,d=0,p=0,f=!1;for(d=0;d<a;++d){for(var m=0;m<h;m+=4)if(255!==c[p+m]){f=!0;break}if(f)break;p+=h}for(i.ascent=a-d,p=u-h,f=!1,d=l;d>a;--d){for(m=0;m<h;m+=4)if(255!==c[p+m]){f=!0;break}if(f)break;p-=h}return i.descent=d-a,i.fontSize=i.ascent+i.descent,t._fonts[e]=i,i},t.clearMetrics=function(e){void 0===e&&(e=""),e?delete t._fonts[e]:t._fonts={}},t}(),rg=function(){try{var t=new OffscreenCanvas(0,0),e=t.getContext("2d");return e&&e.measureText?t:document.createElement("canvas")}catch(t){return document.createElement("canvas")}}();rg.width=rg.height=10,ig._canvas=rg,ig._context=rg.getContext("2d"),ig._fonts={},ig.METRICS_STRING="|q",ig.BASELINE_SYMBOL="M",ig.BASELINE_MULTIPLIER=1.4,ig.HEIGHT_MULTIPLIER=2,ig._newlines=[10,13],ig._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var ng={texture:!0,children:!1,baseTexture:!0},og=function(t){function e(e,i,r){var n=this,o=!1;r||(r=document.createElement("canvas"),o=!0),r.width=3,r.height=3;var s=ed.from(r);return s.orig=new Wu,s.trim=new Wu,(n=t.call(this,s)||this)._ownCanvas=o,n.canvas=r,n.context=n.canvas.getContext("2d"),n._resolution=uu.RESOLUTION,n._autoResolution=!0,n._text=null,n._style=null,n._styleListener=null,n._font="",n.text=e,n.style=i,n.localStyleID=-1,n}return function(t,e){function i(){this.constructor=t}Ym(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),e.prototype.updateText=function(t){var i=this._style;if(this.localStyleID!==i.styleID&&(this.dirty=!0,this.localStyleID=i.styleID),this.dirty||!t){this._font=this._style.toFontString();var r,n,o=this.context,s=ig.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),a=s.width,l=s.height,c=s.lines,u=s.lineHeight,h=s.lineWidths,d=s.maxLineWidth,p=s.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,a)+2*i.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,l)+2*i.padding)*this._resolution),o.scale(this._resolution,this._resolution),o.clearRect(0,0,this.canvas.width,this.canvas.height),o.font=this._font,o.lineWidth=i.strokeThickness,o.textBaseline=i.textBaseline,o.lineJoin=i.lineJoin,o.miterLimit=i.miterLimit;for(var f=i.dropShadow?2:1,m=0;m<f;++m){var g=i.dropShadow&&0===m,_=g?Math.ceil(Math.max(1,l)+2*i.padding):0,y=_*this._resolution;if(g){o.fillStyle="black",o.strokeStyle="black";var v=i.dropShadowColor,x=xu("number"==typeof v?v:wu(v));o.shadowColor="rgba("+255*x[0]+","+255*x[1]+","+255*x[2]+","+i.dropShadowAlpha+")",o.shadowBlur=i.dropShadowBlur,o.shadowOffsetX=Math.cos(i.dropShadowAngle)*i.dropShadowDistance,o.shadowOffsetY=Math.sin(i.dropShadowAngle)*i.dropShadowDistance+y}else o.fillStyle=this._generateFillStyle(i,c,s),o.strokeStyle=i.stroke,o.shadowColor="black",o.shadowBlur=0,o.shadowOffsetX=0,o.shadowOffsetY=0;var b=(u-p.fontSize)/2;(!e.nextLineHeightBehavior||u-p.fontSize<0)&&(b=0);for(var w=0;w<c.length;w++)r=i.strokeThickness/2,n=i.strokeThickness/2+w*u+p.ascent+b,"right"===i.align?r+=d-h[w]:"center"===i.align&&(r+=(d-h[w])/2),i.stroke&&i.strokeThickness&&this.drawLetterSpacing(c[w],r+i.padding,n+i.padding-_,!0),i.fill&&this.drawLetterSpacing(c[w],r+i.padding,n+i.padding-_)}this.updateTexture()}},e.prototype.drawLetterSpacing=function(t,e,i,r){void 0===r&&(r=!1);var n=this._style.letterSpacing;if(0!==n)for(var o=e,s=Array.from?Array.from(t):t.split(""),a=this.context.measureText(t).width,l=0,c=0;c<s.length;++c){var u=s[c];r?this.context.strokeText(u,o,i):this.context.fillText(u,o,i),o+=a-(l=this.context.measureText(t.substring(c+1)).width)+n,a=l}else r?this.context.strokeText(t,e,i):this.context.fillText(t,e,i)},e.prototype.updateTexture=function(){var t=this.canvas;if(this._style.trim){var e=function(t){var e,i,r,n=t.width,o=t.height,s=t.getContext("2d"),a=s.getImageData(0,0,n,o).data,l=a.length,c={top:null,left:null,right:null,bottom:null},u=null;for(e=0;e<l;e+=4)0!==a[e+3]&&(i=e/4%n,r=~~(e/4/n),null===c.top&&(c.top=r),(null===c.left||i<c.left)&&(c.left=i),(null===c.right||c.right<i)&&(c.right=i+1),(null===c.bottom||c.bottom<r)&&(c.bottom=r));return null!==c.top&&(n=c.right-c.left,o=c.bottom-c.top+1,u=s.getImageData(c.left,c.top,n,o)),{height:o,width:n,data:u}}(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}var i=this._texture,r=this._style,n=r.trim?0:r.padding,o=i.baseTexture;i.trim.width=i._frame.width=t.width/this._resolution,i.trim.height=i._frame.height=t.height/this._resolution,i.trim.x=-n,i.trim.y=-n,i.orig.width=i._frame.width-2*n,i.orig.height=i._frame.height-2*n,this._onTextureUpdate(),o.setRealSize(t.width,t.height,this._resolution),i.updateUvs(),this._recursivePostUpdateTransform(),this.dirty=!1},e.prototype._render=function(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),t.prototype._render.call(this,e)},e.prototype.getLocalBounds=function(e){return this.updateText(!0),t.prototype.getLocalBounds.call(this,e)},e.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},e.prototype._generateFillStyle=function(t,e,i){var r,n=t.fill;if(!Array.isArray(n))return n;if(1===n.length)return n[0];var o=t.dropShadow?t.dropShadowDistance:0,s=t.padding||0,a=this.canvas.width/this._resolution-o-2*s,l=this.canvas.height/this._resolution-o-2*s,c=n.slice(),u=t.fillGradientStops.slice();if(!u.length)for(var h=c.length+1,d=1;d<h;++d)u.push(d/h);if(c.unshift(n[0]),u.unshift(0),c.push(n[n.length-1]),u.push(1),t.fillGradientType===Hm.LINEAR_VERTICAL){r=this.context.createLinearGradient(a/2,s,a/2,l+s);var p=i.fontProperties.fontSize+t.strokeThickness;for(d=0;d<e.length;d++){var f=i.lineHeight*(d-1)+p,m=i.lineHeight*d,g=m;d>0&&f>m&&(g=(m+f)/2);var _=m+p,y=i.lineHeight*(d+1),v=_;d+1<e.length&&y<_&&(v=(_+y)/2);for(var x=(v-g)/l,b=0;b<c.length;b++){var w=0;w="number"==typeof u[b]?u[b]:b/c.length;var T=Math.min(1,Math.max(0,g/l+w*x));T=Number(T.toFixed(5)),r.addColorStop(T,c[b])}}}else{r=this.context.createLinearGradient(s,l/2,a+s,l/2);var E=c.length+1,S=1;for(d=0;d<c.length;d++){var A=void 0;A="number"==typeof u[d]?u[d]:S/E,r.addColorStop(A,c[d]),S++}}return r},e.prototype.destroy=function(e){"boolean"==typeof e&&(e={children:e}),e=Object.assign({},ng,e),t.prototype.destroy.call(this,e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null},Object.defineProperty(e.prototype,"width",{get:function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){this.updateText(!0);var e=Ou(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){this.updateText(!0);var e=Ou(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this._style},set:function(t){t=t||{},this._style=t instanceof Jm?t:new Jm(t),this.localStyleID=-1,this.dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resolution",{get:function(){return this._resolution},set:function(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)},enumerable:!1,configurable:!0}),e.nextLineHeightBehavior=!1,e}($m);uu.UPLOADS_PER_FRAME=4;var sg=function(t,e){return(sg=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};var ag=function(){function t(t){this.maxItemsPerFrame=t,this.itemsLeft=0}return t.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},t.prototype.allowedToUpload=function(){return this.itemsLeft-- >0},t}();function lg(t,e){var i=!1;if(t&&t._textures&&t._textures.length)for(var r=0;r<t._textures.length;r++)if(t._textures[r]instanceof ed){var n=t._textures[r].baseTexture;-1===e.indexOf(n)&&(e.push(n),i=!0)}return i}function cg(t,e){if(t.baseTexture instanceof Nh){var i=t.baseTexture;return-1===e.indexOf(i)&&e.push(i),!0}return!1}function ug(t,e){if(t._texture&&t._texture instanceof ed){var i=t._texture.baseTexture;return-1===e.indexOf(i)&&e.push(i),!0}return!1}function hg(t,e){return e instanceof og&&(e.updateText(!0),!0)}function dg(t,e){if(e instanceof Jm){var i=e.toFontString();return ig.measureFont(i),!0}return!1}function pg(t,e){if(t instanceof og){-1===e.indexOf(t.style)&&e.push(t.style),-1===e.indexOf(t)&&e.push(t);var i=t._texture.baseTexture;return-1===e.indexOf(i)&&e.push(i),!0}return!1}function fg(t,e){return t instanceof Jm&&(-1===e.indexOf(t)&&e.push(t),!0)}function mg(t,e){return e instanceof Nh&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function gg(t,e){if(!(e instanceof Vm))return!1;var i=e.geometry;e.finishPoly(),i.updateBatches();for(var r=i.batches,n=0;n<r.length;n++){var o=r[n].style.texture;o&&mg(t,o.baseTexture)}return i.batchable||t.geometry.bind(i,e._resolveDirectShader(t)),!0}function _g(t,e){return t instanceof Vm&&(e.push(t),!0)}var yg=function(t){function e(e){var i=t.call(this,e)||this;return i.uploadHookHelper=i.renderer,i.registerFindHook(_g),i.registerUploadHook(mg),i.registerUploadHook(gg),i}return function(t,e){function i(){this.constructor=t}sg(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),e}(function(){function t(t){var e=this;this.limiter=new ag(uu.UPLOADS_PER_FRAME),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){e.queue&&e.prepareItems()},this.registerFindHook(pg),this.registerFindHook(fg),this.registerFindHook(lg),this.registerFindHook(cg),this.registerFindHook(ug),this.registerUploadHook(hg),this.registerUploadHook(dg)}return t.prototype.upload=function(t,e){"function"==typeof t&&(e=t,t=null),t&&this.add(t),this.queue.length?(e&&this.completes.push(e),this.ticking||(this.ticking=!0,xh.system.addOnce(this.tick,this,_h.UTILITY))):e&&e()},t.prototype.tick=function(){setTimeout(this.delayedTick,0)},t.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var t=this.queue[0],e=!1;if(t&&!t._destroyed)for(var i=0,r=this.uploadHooks.length;i<r;i++)if(this.uploadHooks[i](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)xh.system.addOnce(this.tick,this,_h.UTILITY);else{this.ticking=!1;var n=this.completes.slice(0);this.completes.length=0;for(i=0,r=n.length;i<r;i++)n[i]()}},t.prototype.registerFindHook=function(t){return t&&this.addHooks.push(t),this},t.prototype.registerUploadHook=function(t){return t&&this.uploadHooks.push(t),this},t.prototype.add=function(t){for(var e=0,i=this.addHooks.length;e<i&&!this.addHooks[e](t,this.queue);e++);if(t instanceof gh)for(e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this},t.prototype.destroy=function(){this.ticking&&xh.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null},t}()),vg=(function(){function t(t){this.maxMilliseconds=t,this.frameStart=0}t.prototype.beginFrame=function(){this.frameStart=Date.now()},t.prototype.allowedToUpload=function(){return Date.now()-this.frameStart<this.maxMilliseconds}}(),function(){function t(t,e,i){void 0===i&&(i=null),this._texture=t instanceof ed?t:null,this.baseTexture=t instanceof Nh?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;var r=this.baseTexture.resource;this.resolution=this._updateResolution(i||(r?r.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}return t.prototype._updateResolution=function(t){void 0===t&&(t=null);var e=this.data.meta.scale,i=ju(t,null);return null===i&&(i=void 0!==e?parseFloat(e):1),1!==i&&this.baseTexture.setResolution(i),i},t.prototype.parse=function(e){this._batchIndex=0,this._callback=e,this._frameKeys.length<=t.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()},t.prototype._processFrames=function(e){for(var i=e,r=t.BATCH_SIZE;i-e<r&&i<this._frameKeys.length;){var n=this._frameKeys[i],o=this._frames[n],s=o.frame;if(s){var a=null,l=null,c=!1!==o.trimmed&&o.sourceSize?o.sourceSize:o.frame,u=new Wu(0,0,Math.floor(c.w)/this.resolution,Math.floor(c.h)/this.resolution);a=o.rotated?new Wu(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.h)/this.resolution,Math.floor(s.w)/this.resolution):new Wu(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution),!1!==o.trimmed&&o.spriteSourceSize&&(l=new Wu(Math.floor(o.spriteSourceSize.x)/this.resolution,Math.floor(o.spriteSourceSize.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution)),this.textures[n]=new ed(this.baseTexture,a,u,l,o.rotated?2:0,o.anchor),ed.addToCache(this.textures[n],n)}i++}},t.prototype._processAnimations=function(){var t=this.data.animations||{};for(var e in t){this.animations[e]=[];for(var i=0;i<t[e].length;i++){var r=t[e][i];this.animations[e].push(this.textures[r])}}},t.prototype._parseComplete=function(){var t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)},t.prototype._nextBatch=function(){var e=this;this._processFrames(this._batchIndex*t.BATCH_SIZE),this._batchIndex++,setTimeout((function(){e._batchIndex*t.BATCH_SIZE<e._frameKeys.length?e._nextBatch():(e._processAnimations(),e._parseComplete())}),0)},t.prototype.destroy=function(t){var e;for(var i in void 0===t&&(t=!1),this.textures)this.textures[i].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(null===(e=this._texture)||void 0===e||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null},t.BATCH_SIZE=1e3,t}()),xg=function(){function t(){}return t.use=function(e,i){var r,n,o=this,s=e.name+"_image";if(e.data&&e.type===lf.TYPE.JSON&&e.data.frames&&!o.resources[s]){var a=null===(n=null===(r=e.data)||void 0===r?void 0:r.meta)||void 0===n?void 0:n.related_multi_packs;if(Array.isArray(a))for(var l=function(t){if("string"!=typeof t)return"continue";var i=t.replace(".json",""),r=gu.resolve(e.url.replace(o.baseUrl,""),t);if(o.resources[i]||Object.values(o.resources).some((function(t){return gu.format(gu.parse(t.url))===r})))return"continue";var n={crossOrigin:e.crossOrigin,loadType:lf.LOAD_TYPE.XHR,xhrType:lf.XHR_RESPONSE_TYPE.JSON,parentResource:e,metadata:e.metadata};o.add(i,r,n)},c=0,u=a;c<u.length;c++){l(u[c])}var h={crossOrigin:e.crossOrigin,metadata:e.metadata.imageMetadata,parentResource:e},d=t.getResourcePath(e,o.baseUrl);o.add(s,d,h,(function(t){if(t.error)i(t.error);else{var r=new vg(t.texture,e.data,e.url);r.parse((function(){e.spritesheet=r,e.textures=r.textures,i()}))}}))}else i()},t.getResourcePath=function(t,e){return t.isDataUrl?t.data.meta.image:gu.resolve(t.url.replace(e,""),t.data.meta.image)},t}(),bg=function(t,e){return(bg=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function wg(t,e){function i(){this.constructor=t}bg(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var Tg=new Ju,Eg=(function(t){function e(e,i,r){void 0===i&&(i=100),void 0===r&&(r=100);var n=t.call(this,e)||this;return n.tileTransform=new ch,n._width=i,n._height=r,n.uvMatrix=n.texture.uvMatrix||new np(e),n.pluginName="tilingSprite",n.uvRespectAnchor=!1,n}wg(e,t),Object.defineProperty(e.prototype,"clampMargin",{get:function(){return this.uvMatrix.clampMargin},set:function(t){this.uvMatrix.clampMargin=t,this.uvMatrix.update(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileScale",{get:function(){return this.tileTransform.scale},set:function(t){this.tileTransform.scale.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tilePosition",{get:function(){return this.tileTransform.position},set:function(t){this.tileTransform.position.copyFrom(t)},enumerable:!1,configurable:!0}),e.prototype._onTextureUpdate=function(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215},e.prototype._render=function(t){var e=this._texture;e&&e.valid&&(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))},e.prototype._calculateBounds=function(){var t=this._width*-this._anchor._x,e=this._height*-this._anchor._y,i=this._width*(1-this._anchor._x),r=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,t,e,i,r)},e.prototype.getLocalBounds=function(e){return 0===this.children.length?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new Wu),e=this._localBoundsRect),this._bounds.getRectangle(e)):t.prototype.getLocalBounds.call(this,e)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,Tg);var e=this._width,i=this._height,r=-e*this.anchor._x;if(Tg.x>=r&&Tg.x<r+e){var n=-i*this.anchor._y;if(Tg.y>=n&&Tg.y<n+i)return!0}return!1},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.tileTransform=null,this.uvMatrix=null},e.from=function(t,i){return new e(t instanceof ed?t:ed.from(t,i),i.width,i.height)},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t},enumerable:!1,configurable:!0})}($m),"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n"),Sg=new th,Ag=function(t){function e(e){var i=t.call(this,e)||this,r={globals:i.renderer.globalUniforms};return i.shader=tp.from(Eg,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture2D(uSampler, coord);\n    gl_FragColor = texSample * uColor;\n}\n",r),i.simpleShader=tp.from(Eg,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 sample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = sample * uColor;\n}\n",r),i.quad=new fd,i.state=ep.for2d(),i}return wg(e,t),e.prototype.render=function(t){var e=this.renderer,i=this.quad,r=i.vertices;r[0]=r[6]=t._width*-t.anchor.x,r[1]=r[3]=t._height*-t.anchor.y,r[2]=r[4]=t._width*(1-t.anchor.x),r[5]=r[7]=t._height*(1-t.anchor.y);var n=t.uvRespectAnchor?t.anchor.x:0,o=t.uvRespectAnchor?t.anchor.y:0;(r=i.uvs)[0]=r[6]=-n,r[1]=r[3]=-o,r[2]=r[4]=1-n,r[5]=r[7]=1-o,i.invalidate();var s=t._texture,a=s.baseTexture,l=t.tileTransform.localTransform,c=t.uvMatrix,u=a.isPowerOfTwo&&s.frame.width===a.width&&s.frame.height===a.height;u&&(a._glTextures[e.CONTEXT_UID]?u=a.wrapMode!==eu.CLAMP:a.wrapMode===eu.CLAMP&&(a.wrapMode=eu.REPEAT));var h=u?this.simpleShader:this.shader,d=s.width,p=s.height,f=t._width,m=t._height;Sg.set(l.a*d/f,l.b*d/m,l.c*p/f,l.d*p/m,l.tx/f,l.ty/m),Sg.invert(),u?Sg.prepend(c.mapCoord):(h.uniforms.uMapCoord=c.mapCoord.toArray(!0),h.uniforms.uClampFrame=c.uClampFrame,h.uniforms.uClampOffset=c.uClampOffset),h.uniforms.uTransform=Sg.toArray(!0),h.uniforms.uColor=Au(t.tint,t.worldAlpha,h.uniforms.uColor,a.alphaMode),h.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),h.uniforms.uSampler=s,e.shader.bind(h),e.geometry.bind(i),this.state.blendMode=Eu(t.blendMode,a.alphaMode),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)},e}(bd),Mg=function(t,e){return(Mg=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function Ig(t,e){function i(){this.constructor=t}Mg(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var Cg=function(){function t(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}return t.prototype.update=function(t){if(t||this._bufferUpdateId!==this.uvBuffer._updateID||this._textureUpdateId!==this.uvMatrix._updateID){this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;var e=this.uvBuffer.data;this.data&&this.data.length===e.length||(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}},t}(),Pg=new Ju,Rg=new Zu,Og=function(t){function e(e,i,r,n){void 0===n&&(n=Yc.TRIANGLES);var o=t.call(this)||this;return o.geometry=e,e.refCount++,o.shader=i,o.state=r||ep.for2d(),o.drawMode=n,o.start=0,o.size=0,o.uvs=null,o.indices=null,o.vertexData=new Float32Array(1),o.vertexDirty=-1,o._transformID=-1,o._roundPixels=uu.ROUND_PIXELS,o.batchUvs=null,o}return Ig(e,t),Object.defineProperty(e.prototype,"uvBuffer",{get:function(){return this.geometry.buffers[1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"verticesBuffer",{get:function(){return this.geometry.buffers[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"material",{get:function(){return this.shader},set:function(t){this.shader=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return"tint"in this.shader?this.shader.tint:null},set:function(t){this.shader.tint=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return"texture"in this.shader?this.shader.texture:null},set:function(t){this.shader.texture=t},enumerable:!1,configurable:!0}),e.prototype._render=function(t){var i=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===Yc.TRIANGLES&&i.length<2*e.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)},e.prototype._renderDefault=function(t){var e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)},e.prototype._renderToBatch=function(t){var e=this.geometry,i=this.shader;i.uvMatrix&&(i.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=i._tintRGB,this._texture=i.texture;var r=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[r]),t.plugins[r].render(this)},e.prototype.calculateVertices=function(){var t=this.geometry.buffers[0],e=t.data,i=t._updateID;if(i!==this.vertexDirty||this._transformID!==this.transform._worldID){this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));for(var r=this.transform.worldTransform,n=r.a,o=r.b,s=r.c,a=r.d,l=r.tx,c=r.ty,u=this.vertexData,h=0;h<u.length/2;h++){var d=e[2*h],p=e[2*h+1];u[2*h]=n*d+s*p+l,u[2*h+1]=o*d+a*p+c}if(this._roundPixels){var f=uu.RESOLUTION;for(h=0;h<u.length;++h)u[h]=Math.round((u[h]*f|0)/f)}this.vertexDirty=i}},e.prototype.calculateUvs=function(){var t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new Cg(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)},e.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)},e.prototype.containsPoint=function(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,Pg);for(var e=this.geometry.getBuffer("aVertexPosition").data,i=Rg.points,r=this.geometry.getIndex().data,n=r.length,o=4===this.drawMode?3:1,s=0;s+2<n;s+=o){var a=2*r[s],l=2*r[s+1],c=2*r[s+2];if(i[0]=e[a],i[1]=e[a+1],i[2]=e[l],i[3]=e[l+1],i[4]=e[c],i[5]=e[c+1],Rg.contains(Pg.x,Pg.y))return!0}return!1},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.geometry.refCount--,0===this.geometry.refCount&&this.geometry.dispose(),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null},e.BATCHABLE_SIZE=100,e}(gh),Dg=function(t){function e(e,i){var r=this,n={uSampler:e,alpha:1,uTextureMatrix:th.IDENTITY,uColor:new Float32Array([1,1,1,1])};return(i=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},i)).uniforms&&Object.assign(n,i.uniforms),(r=t.call(this,i.program||Qd.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),n)||this)._colorDirty=!1,r.uvMatrix=new np(e),r.batchable=void 0===i.program,r.pluginName=i.pluginName,r.tint=i.tint,r.alpha=i.alpha,r}return Ig(e,t),Object.defineProperty(e.prototype,"texture",{get:function(){return this.uniforms.uSampler},set:function(t){this.uniforms.uSampler!==t&&(this.uniforms.uSampler=t,this.uvMatrix.texture=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16),this._colorDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.update=function(){if(this._colorDirty){this._colorDirty=!1;var t=this.texture.baseTexture;Au(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)},e}(tp),Lg=function(t){function e(e,i,r){var n=t.call(this)||this,o=new ad(e),s=new ad(i,!0),a=new ad(r,!0,!0);return n.addAttribute("aVertexPosition",o,2,!1,Jc.FLOAT).addAttribute("aTextureCoord",s,2,!1,Jc.FLOAT).addIndex(a),n._updateId=-1,n}return Ig(e,t),Object.defineProperty(e.prototype,"vertexDirtyId",{get:function(){return this.buffers[0]._updateID},enumerable:!1,configurable:!0}),e}(dd),kg=function(t,e){return(kg=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};var Bg=function(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[]},Fg=function(){function t(){}return t.test=function(t){return"string"==typeof t&&0===t.indexOf("info face=")},t.parse=function(t){var e=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[]};for(var r in e){var n=e[r].match(/^[a-z]+/gm)[0],o=e[r].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),s={};for(var a in o){var l=o[a].split("="),c=l[0],u=l[1].replace(/"/gm,""),h=parseFloat(u),d=isNaN(h)?u:h;s[c]=d}i[n].push(s)}var p=new Bg;return i.info.forEach((function(t){return p.info.push({face:t.face,size:parseInt(t.size,10)})})),i.common.forEach((function(t){return p.common.push({lineHeight:parseInt(t.lineHeight,10)})})),i.page.forEach((function(t){return p.page.push({id:parseInt(t.id,10),file:t.file})})),i.char.forEach((function(t){return p.char.push({id:parseInt(t.id,10),page:parseInt(t.page,10),x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xoffset:parseInt(t.xoffset,10),yoffset:parseInt(t.yoffset,10),xadvance:parseInt(t.xadvance,10)})})),i.kerning.forEach((function(t){return p.kerning.push({first:parseInt(t.first,10),second:parseInt(t.second,10),amount:parseInt(t.amount,10)})})),p},t}(),zg=function(){function t(){}return t.test=function(t){return t instanceof XMLDocument&&t.getElementsByTagName("page").length&&null!==t.getElementsByTagName("info")[0].getAttribute("face")},t.parse=function(t){for(var e=new Bg,i=t.getElementsByTagName("info"),r=t.getElementsByTagName("common"),n=t.getElementsByTagName("page"),o=t.getElementsByTagName("char"),s=t.getElementsByTagName("kerning"),a=0;a<i.length;a++)e.info.push({face:i[a].getAttribute("face"),size:parseInt(i[a].getAttribute("size"),10)});for(a=0;a<r.length;a++)e.common.push({lineHeight:parseInt(r[a].getAttribute("lineHeight"),10)});for(a=0;a<n.length;a++)e.page.push({id:parseInt(n[a].getAttribute("id"),10)||0,file:n[a].getAttribute("file")});for(a=0;a<o.length;a++){var l=o[a];e.char.push({id:parseInt(l.getAttribute("id"),10),page:parseInt(l.getAttribute("page"),10)||0,x:parseInt(l.getAttribute("x"),10),y:parseInt(l.getAttribute("y"),10),width:parseInt(l.getAttribute("width"),10),height:parseInt(l.getAttribute("height"),10),xoffset:parseInt(l.getAttribute("xoffset"),10),yoffset:parseInt(l.getAttribute("yoffset"),10),xadvance:parseInt(l.getAttribute("xadvance"),10)})}for(a=0;a<s.length;a++)e.kerning.push({first:parseInt(s[a].getAttribute("first"),10),second:parseInt(s[a].getAttribute("second"),10),amount:parseInt(s[a].getAttribute("amount"),10)});return e},t}(),Ng=function(){function t(){}return t.test=function(t){if("string"==typeof t&&t.indexOf("<font>")>-1){var e=(new self.DOMParser).parseFromString(t,"text/xml");return zg.test(e)}return!1},t.parse=function(t){var e=(new self.DOMParser).parseFromString(t,"text/xml");return zg.parse(e)},t}(),Ug=[Fg,zg,Ng];function Gg(t){for(var e=0;e<Ug.length;e++)if(Ug[e].test(t))return Ug[e];return null}function jg(t,e,i,r,n,o,s){var a=i.text,l=i.fontProperties;e.translate(r,n),e.scale(o,o);var c=s.strokeThickness/2,u=-s.strokeThickness/2;e.font=s.toFontString(),e.lineWidth=s.strokeThickness,e.textBaseline=s.textBaseline,e.lineJoin=s.lineJoin,e.miterLimit=s.miterLimit,e.fillStyle=function(t,e,i,r,n,o){var s,a=i.fill;if(!Array.isArray(a))return a;if(1===a.length)return a[0];var l=i.dropShadow?i.dropShadowDistance:0,c=i.padding||0,u=t.width/r-l-2*c,h=t.height/r-l-2*c,d=a.slice(),p=i.fillGradientStops.slice();if(!p.length)for(var f=d.length+1,m=1;m<f;++m)p.push(m/f);if(d.unshift(a[0]),p.unshift(0),d.push(a[a.length-1]),p.push(1),i.fillGradientType===Hm.LINEAR_VERTICAL){s=e.createLinearGradient(u/2,c,u/2,h+c);var g=0,_=(o.fontProperties.fontSize+i.strokeThickness)/h;for(m=0;m<n.length;m++)for(var y=o.lineHeight*m,v=0;v<d.length;v++){var x=y/h+("number"==typeof p[v]?p[v]:v/d.length)*_,b=Math.max(g,x);b=Math.min(b,1),s.addColorStop(b,d[v]),g=b}}else{s=e.createLinearGradient(c,h/2,u+c,h/2);var w=d.length+1,T=1;for(m=0;m<d.length;m++){var E=void 0;E="number"==typeof p[m]?p[m]:T/w,s.addColorStop(E,d[m]),T++}}return s}(t,e,s,o,[a],i),e.strokeStyle=s.stroke;var h=s.dropShadowColor,d=xu("number"==typeof h?h:wu(h));s.dropShadow?(e.shadowColor="rgba("+255*d[0]+","+255*d[1]+","+255*d[2]+","+s.dropShadowAlpha+")",e.shadowBlur=s.dropShadowBlur,e.shadowOffsetX=Math.cos(s.dropShadowAngle)*s.dropShadowDistance,e.shadowOffsetY=Math.sin(s.dropShadowAngle)*s.dropShadowDistance):(e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),s.stroke&&s.strokeThickness&&e.strokeText(a,c,u+i.lineHeight-l.descent),s.fill&&e.fillText(a,c,u+i.lineHeight-l.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}var Vg=function(){function t(t,e,i){var r=t.info[0],n=t.common[0],o=ju(t.page[0].file),s={};this._ownsTextures=i,this.font=r.face,this.size=r.size,this.lineHeight=n.lineHeight/o,this.chars={},this.pageTextures=s;for(var a=0;a<t.page.length;a++){var l=t.page[a],c=l.id,u=l.file;s[c]=e instanceof Array?e[a]:e[u]}for(a=0;a<t.char.length;a++){var h=t.char[a],d=(c=h.id,h.page),p=t.char[a],f=p.x,m=p.y,g=p.width,_=p.height,y=p.xoffset,v=p.yoffset,x=p.xadvance;m/=o,g/=o,_/=o,y/=o,v/=o,x/=o;var b=new Wu((f/=o)+s[d].frame.x/o,m+s[d].frame.y/o,g,_);this.chars[c]={xOffset:y,yOffset:v,xAdvance:x,kerning:{},texture:new ed(s[d].baseTexture,b),page:d}}for(a=0;a<t.kerning.length;a++){var w=t.kerning[a],T=w.first,E=w.second,S=w.amount;T/=o,E/=o,S/=o,this.chars[E]&&(this.chars[E].kerning[T]=S)}}return t.prototype.destroy=function(){for(var t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(var t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null},t.install=function(e,i,r){var n;if(e instanceof Bg)n=e;else{var o=Gg(e);if(!o)throw new Error("Unrecognized data format for font.");n=o.parse(e)}i instanceof ed&&(i=[i]);var s=new t(n,i,r);return t.available[s.font]=s,s},t.uninstall=function(e){var i=t.available[e];if(!i)throw new Error("No font found named '"+e+"'");i.destroy(),delete t.available[e]},t.from=function(e,i,r){if(!e)throw new Error("[BitmapFont] Property `name` is required.");var n=Object.assign({},t.defaultOptions,r),o=n.chars,s=n.padding,a=n.resolution,l=n.textureWidth,c=n.textureHeight,u=function(t){"string"==typeof t&&(t=[t]);for(var e=[],i=0,r=t.length;i<r;i++){var n=t[i];if(Array.isArray(n)){if(2!==n.length)throw new Error("[BitmapFont]: Invalid character range length, expecting 2 got "+n.length+".");var o=n[0].charCodeAt(0),s=n[1].charCodeAt(0);if(s<o)throw new Error("[BitmapFont]: Invalid character range.");for(var a=o,l=s;a<=l;a++)e.push(String.fromCharCode(a))}else e.push.apply(e,n.split(""))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}(o),h=i instanceof Jm?i:new Jm(i),d=l,p=new Bg;p.info[0]={face:h.fontFamily,size:h.fontSize},p.common[0]={lineHeight:h.fontSize};for(var f,m,g,_=0,y=0,v=0,x=[],b=0;b<u.length;b++){f||((f=document.createElement("canvas")).width=l,f.height=c,m=f.getContext("2d"),g=new Nh(f,{resolution:a}),x.push(new ed(g)),p.page.push({id:x.length-1,file:""}));var w=ig.measureText(u[b],h,!1,f),T=w.width,E=Math.ceil(w.height),S=Math.ceil(("italic"===h.fontStyle?2:1)*T);if(y>=c-E*a){if(0===y)throw new Error("[BitmapFont] textureHeight "+c+"px is too small for "+h.fontSize+"px fonts");--b,f=null,m=null,g=null,y=0,_=0,v=0}else if(v=Math.max(E+w.fontProperties.descent,v),S*a+_>=d)--b,y+=v*a,y=Math.ceil(y),_=0,v=0;else{jg(f,m,w,_,y,a,h);var A=w.text.charCodeAt(0);p.char.push({id:A,page:x.length-1,x:_/a,y:y/a,width:S,height:E,xoffset:0,yoffset:0,xadvance:Math.ceil(T-(h.dropShadow?h.dropShadowDistance:0)-(h.stroke?h.strokeThickness:0))}),_+=(S+2*s)*a,_=Math.ceil(_)}}b=0;for(var M=u.length;b<M;b++)for(var I=u[b],C=0;C<M;C++){var P=u[C],R=m.measureText(I).width,O=m.measureText(P).width,D=m.measureText(I+P).width-(R+O);D&&p.kerning.push({first:I.charCodeAt(0),second:P.charCodeAt(0),amount:D})}var L=new t(p,x,!0);return void 0!==t.available[e]&&t.uninstall(e),t.available[e]=L,L},t.ALPHA=[["a","z"],["A","Z"]," "],t.NUMERIC=[["0","9"]],t.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],t.ASCII=[[" ","~"]],t.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:t.ALPHANUMERIC},t.available={},t}(),Xg=[],Hg=[],qg=(function(t){function e(i,r){void 0===r&&(r={});var n=t.call(this)||this;n._tint=16777215;var o=Object.assign({},e.styleDefaults,r),s=o.align,a=o.tint,l=o.maxWidth,c=o.letterSpacing,u=o.fontName,h=o.fontSize;if(!Vg.available[u])throw new Error('Missing BitmapFont "'+u+'"');return n._activePagesMeshData=[],n._textWidth=0,n._textHeight=0,n._align=s,n._tint=a,n._fontName=u,n._fontSize=h||Vg.available[u].size,n._text=i,n._maxWidth=l,n._maxLineHeight=0,n._letterSpacing=c,n._anchor=new Qu((function(){n.dirty=!0}),n,0,0),n._roundPixels=uu.ROUND_PIXELS,n.dirty=!0,n._textureCache={},n}(function(t,e){function i(){this.constructor=t}kg(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)})(e,t),e.prototype.updateText=function(){for(var t,e=Vg.available[this._fontName],i=this._fontSize/e.size,r=new Ju,n=[],o=[],s=[],a=this._text.replace(/(?:\r\n|\r)/g,"\n")||" ",l=a.length,c=this._maxWidth*e.size/this._fontSize,u=null,h=0,d=0,p=0,f=-1,m=0,g=0,_=0,y=0,v=0;v<l;v++){var x=a.charCodeAt(v),b=a.charAt(v);if(/(?:\s)/.test(b)&&(f=v,m=h,y++),"\r"!==b&&"\n"!==b){var w=e.chars[x];if(w){u&&w.kerning[u]&&(r.x+=w.kerning[u]);var T=Hg.pop()||{texture:ed.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Ju};T.texture=w.texture,T.line=p,T.charCode=x,T.position.x=r.x+w.xOffset+this._letterSpacing/2,T.position.y=r.y+w.yOffset,T.prevSpaces=y,n.push(T),h=T.position.x+w.texture.orig.width,r.x+=w.xAdvance+this._letterSpacing,_=Math.max(_,w.yOffset+w.texture.height),u=x,-1!==f&&c>0&&r.x>c&&(Ru(n,1+f-++g,1+v-f),v=f,f=-1,o.push(m),s.push(n.length>0?n[n.length-1].prevSpaces:0),d=Math.max(d,m),p++,r.x=0,r.y+=e.lineHeight,u=null,y=0)}}else o.push(h),s.push(-1),d=Math.max(d,h),++p,++g,r.x=0,r.y+=e.lineHeight,u=null,y=0}var E=a.charAt(a.length-1);"\r"!==E&&"\n"!==E&&(/(?:\s)/.test(E)&&(h=m),o.push(h),d=Math.max(d,h),s.push(-1));var S=[];for(v=0;v<=p;v++){var A=0;"right"===this._align?A=d-o[v]:"center"===this._align?A=(d-o[v])/2:"justify"===this._align&&(A=s[v]<0?0:(d-o[v])/s[v]),S.push(A)}var M=n.length,I={},C=[],P=this._activePagesMeshData;for(v=0;v<P.length;v++)Xg.push(P[v]);for(v=0;v<M;v++){var R=(U=n[v].texture).baseTexture.uid;if(!I[R]){if(!(W=Xg.pop())){var O=new Lg,D=new Dg(ed.EMPTY);W={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:new Og(O,D),vertices:null,uvs:null,indices:null}}W.index=0,W.indexCount=0,W.vertexCount=0,W.uvsCount=0,W.total=0;var L=this._textureCache;L[R]=L[R]||new ed(U.baseTexture),W.mesh.texture=L[R],W.mesh.tint=this._tint,C.push(W),I[R]=W}I[R].total++}for(v=0;v<P.length;v++)-1===C.indexOf(P[v])&&this.removeChild(P[v].mesh);for(v=0;v<C.length;v++)C[v].mesh.parent!==this&&this.addChild(C[v].mesh);for(var v in this._activePagesMeshData=C,I){var k=(W=I[v]).total;if(!((null===(t=W.indices)||void 0===t?void 0:t.length)>6*k)||W.vertices.length<2*Og.BATCHABLE_SIZE)W.vertices=new Float32Array(8*k),W.uvs=new Float32Array(8*k),W.indices=new Uint16Array(6*k);else for(var B=W.total,F=W.vertices,z=4*B*2;z<F.length;z++)F[z]=0;W.mesh.size=6*k}for(v=0;v<M;v++){var N=(b=n[v]).position.x+S[b.line]*("justify"===this._align?b.prevSpaces:1);this._roundPixels&&(N=Math.round(N));var U,G=N*i,j=b.position.y*i,V=I[(U=b.texture).baseTexture.uid],X=U.frame,H=U._uvs,q=V.index++;V.indices[6*q+0]=0+4*q,V.indices[6*q+1]=1+4*q,V.indices[6*q+2]=2+4*q,V.indices[6*q+3]=0+4*q,V.indices[6*q+4]=2+4*q,V.indices[6*q+5]=3+4*q,V.vertices[8*q+0]=G,V.vertices[8*q+1]=j,V.vertices[8*q+2]=G+X.width*i,V.vertices[8*q+3]=j,V.vertices[8*q+4]=G+X.width*i,V.vertices[8*q+5]=j+X.height*i,V.vertices[8*q+6]=G,V.vertices[8*q+7]=j+X.height*i,V.uvs[8*q+0]=H.x0,V.uvs[8*q+1]=H.y0,V.uvs[8*q+2]=H.x1,V.uvs[8*q+3]=H.y1,V.uvs[8*q+4]=H.x2,V.uvs[8*q+5]=H.y2,V.uvs[8*q+6]=H.x3,V.uvs[8*q+7]=H.y3}for(var v in this._textWidth=d*i,this._textHeight=(r.y+e.lineHeight)*i,I){var W=I[v];if(0!==this.anchor.x||0!==this.anchor.y)for(var $=0,Y=this._textWidth*this.anchor.x,Z=this._textHeight*this.anchor.y,K=0;K<W.total;K++)W.vertices[$++]-=Y,W.vertices[$++]-=Z,W.vertices[$++]-=Y,W.vertices[$++]-=Z,W.vertices[$++]-=Y,W.vertices[$++]-=Z,W.vertices[$++]-=Y,W.vertices[$++]-=Z;this._maxLineHeight=_*i;var J=W.mesh.geometry.getBuffer("aVertexPosition"),Q=W.mesh.geometry.getBuffer("aTextureCoord"),tt=W.mesh.geometry.getIndex();J.data=W.vertices,Q.data=W.uvs,tt.data=W.indices,J.update(),Q.update(),tt.update()}for(v=0;v<n.length;v++)Hg.push(n[v])},e.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},e.prototype.getLocalBounds=function(){return this.validate(),t.prototype.getLocalBounds.call(this)},e.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){if(this._tint!==t){this._tint=t;for(var e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"align",{get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontName",{get:function(){return this._fontName},set:function(t){if(!Vg.available[t])throw new Error('Missing BitmapFont "'+t+'"');this._fontName!==t&&(this._fontName=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anchor",{get:function(){return this._anchor},set:function(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxLineHeight",{get:function(){return this.validate(),this._maxLineHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textWidth",{get:function(){return this.validate(),this._textWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textHeight",{get:function(){return this.validate(),this._textHeight},enumerable:!1,configurable:!0}),e.prototype.destroy=function(e){var i=this._textureCache;for(var r in i){i[r].destroy(),delete i[r]}this._textureCache=null,t.prototype.destroy.call(this,e)},e.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0}}(gh),function(){function t(){}return t.add=function(){lf.setExtensionXhrType("fnt",lf.XHR_RESPONSE_TYPE.TEXT)},t.use=function(e,i){var r=Gg(e.data);if(r)for(var n=t.getBaseUrl(this,e),o=r.parse(e.data),s={},a=function(t){s[t.metadata.pageFile]=t.texture,Object.keys(s).length===o.page.length&&(e.bitmapFont=Vg.install(o,s,!0),i())},l=0;l<o.page.length;++l){var c=o.page[l].file,u=n+c,h=!1;for(var d in this.resources){var p=this.resources[d];if(p.url===u){p.metadata.pageFile=c,p.texture?a(p):p.onAfterMiddleware.add(a),h=!0;break}}if(!h){var f={crossOrigin:e.crossOrigin,loadType:lf.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:c},e.metadata.imageMetadata),parentResource:e};this.add(u,f,a)}}else i()},t.getBaseUrl=function(e,i){var r=i.isDataUrl?"":t.dirname(i.url);return i.isDataUrl&&("."===r&&(r=""),e.baseUrl&&r&&"/"===e.baseUrl.charAt(e.baseUrl.length-1)&&(r+="/")),(r=r.replace(e.baseUrl,""))&&"/"!==r.charAt(r.length-1)&&(r+="/"),r},t.dirname=function(t){var e=t.replace(/\\/g,"/").replace(/\/$/,"").replace(/\/[^\/]*$/,"");return e===t?".":""===e?"/":e},t}()),Wg=function(t,e){return(Wg=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};!function(t){function e(e){void 0===e&&(e=1);var i=t.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1})||this;return i.alpha=e,i}(function(t,e){function i(){this.constructor=t}Wg(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)})(e,t),Object.defineProperty(e.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t},enumerable:!1,configurable:!0})}(ip);var $g=function(t,e){return($g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function Yg(t,e){function i(){this.constructor=t}$g(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var Zg,Kg,Jg,Qg,t_,e_,i_,r_,n_,o_,s_,a_,l_,c_,u_,h_,d_,p_,f_,m_={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},g_=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");!function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}(Zg||(Zg={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(Kg||(Kg={})),function(t){t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL"}(Jg||(Jg={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}(Qg||(Qg={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(t_||(t_={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(e_||(e_={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(i_||(i_={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(r_||(r_={})),function(t){t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT"}(n_||(n_={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(o_||(o_={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(s_||(s_={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL"}(a_||(a_={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}(l_||(l_={})),function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT"}(c_||(c_={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(u_||(u_={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(h_||(h_={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}(d_||(d_={})),function(t){t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH"}(p_||(p_={})),function(t){t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"}(f_||(f_={}));var __=function(t){function e(e,i,r,n,o){void 0===i&&(i=8),void 0===r&&(r=4),void 0===n&&(n=uu.FILTER_RESOLUTION),void 0===o&&(o=5);var s=this,a=function(t,e){var i,r=Math.ceil(t/2),n="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",o="";i=e?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(var s=0;s<t;s++){var a=i.replace("%index%",s.toString());o+=a=a.replace("%sampleIndex%",s-(r-1)+".0"),o+="\n"}return n=(n=n.replace("%blur%",o)).replace("%size%",t.toString())}(o,e),l=function(t){for(var e,i=m_[t],r=i.length,n=g_,o="",s=0;s<t;s++){var a="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",s.toString());e=s,s>=r&&(e=t-s-1),o+=a=a.replace("%value%",i[e].toString()),o+="\n"}return n=(n=n.replace("%blur%",o)).replace("%size%",t.toString())}(o);return(s=t.call(this,a,l)||this).horizontal=e,s.resolution=n,s._quality=0,s.quality=r,s.blur=i,s}return Yg(e,t),e.prototype.apply=function(t,e,i,r){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/e.width):this.uniforms.strength=1/i.height*(i.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,i,r);else{var n=t.getFilterTexture(),o=t.renderer,s=e,a=n;this.state.blend=!1,t.applyFilter(this,s,a,c_.CLEAR);for(var l=1;l<this.passes-1;l++){t.bindAndClear(s,c_.BLIT),this.uniforms.uSampler=a;var c=a;a=s,s=c,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,a,i,r),t.returnFilterTexture(n)}},Object.defineProperty(e.prototype,"blur",{get:function(){return this.strength},set:function(t){this.padding=1+2*Math.abs(t),this.strength=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this._quality},set:function(t){this._quality=t,this.passes=t},enumerable:!1,configurable:!0}),e}(ip),y_=(function(t){function e(e,i,r,n){void 0===e&&(e=8),void 0===i&&(i=4),void 0===r&&(r=uu.FILTER_RESOLUTION),void 0===n&&(n=5);var o=t.call(this)||this;return o.blurXFilter=new __(!0,e,i,r,n),o.blurYFilter=new __(!1,e,i,r,n),o.resolution=r,o.quality=i,o.blur=e,o.repeatEdgePixels=!1,o}Yg(e,t),e.prototype.apply=function(t,e,i,r){var n=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(n&&o){var s=t.getFilterTexture();this.blurXFilter.apply(t,e,s,c_.CLEAR),this.blurYFilter.apply(t,s,i,r),t.returnFilterTexture(s)}else o?this.blurYFilter.apply(t,e,i,r):this.blurXFilter.apply(t,e,i,r)},e.prototype.updatePadding=function(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))},Object.defineProperty(e.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this.blurXFilter.quality},set:function(t){this.blurXFilter.quality=this.blurYFilter.quality=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(t){this.blurYFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.blurYFilter.blendMode},set:function(t){this.blurYFilter.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"repeatEdgePixels",{get:function(){return this._repeatEdgePixels},set:function(t){this._repeatEdgePixels=t,this.updatePadding()},enumerable:!1,configurable:!0})}(ip),function(t,e){return(y_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)});var v_=function(t){function e(){var e=this,i={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};return(e=t.call(this,Dp,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",i)||this).alpha=1,e}return function(t,e){function i(){this.constructor=t}y_(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),e.prototype._loadMatrix=function(t,e){void 0===e&&(e=!1);var i=t;e&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i},e.prototype._multiply=function(t,e,i){return t[0]=e[0]*i[0]+e[1]*i[5]+e[2]*i[10]+e[3]*i[15],t[1]=e[0]*i[1]+e[1]*i[6]+e[2]*i[11]+e[3]*i[16],t[2]=e[0]*i[2]+e[1]*i[7]+e[2]*i[12]+e[3]*i[17],t[3]=e[0]*i[3]+e[1]*i[8]+e[2]*i[13]+e[3]*i[18],t[4]=e[0]*i[4]+e[1]*i[9]+e[2]*i[14]+e[3]*i[19]+e[4],t[5]=e[5]*i[0]+e[6]*i[5]+e[7]*i[10]+e[8]*i[15],t[6]=e[5]*i[1]+e[6]*i[6]+e[7]*i[11]+e[8]*i[16],t[7]=e[5]*i[2]+e[6]*i[7]+e[7]*i[12]+e[8]*i[17],t[8]=e[5]*i[3]+e[6]*i[8]+e[7]*i[13]+e[8]*i[18],t[9]=e[5]*i[4]+e[6]*i[9]+e[7]*i[14]+e[8]*i[19]+e[9],t[10]=e[10]*i[0]+e[11]*i[5]+e[12]*i[10]+e[13]*i[15],t[11]=e[10]*i[1]+e[11]*i[6]+e[12]*i[11]+e[13]*i[16],t[12]=e[10]*i[2]+e[11]*i[7]+e[12]*i[12]+e[13]*i[17],t[13]=e[10]*i[3]+e[11]*i[8]+e[12]*i[13]+e[13]*i[18],t[14]=e[10]*i[4]+e[11]*i[9]+e[12]*i[14]+e[13]*i[19]+e[14],t[15]=e[15]*i[0]+e[16]*i[5]+e[17]*i[10]+e[18]*i[15],t[16]=e[15]*i[1]+e[16]*i[6]+e[17]*i[11]+e[18]*i[16],t[17]=e[15]*i[2]+e[16]*i[7]+e[17]*i[12]+e[18]*i[17],t[18]=e[15]*i[3]+e[16]*i[8]+e[17]*i[13]+e[18]*i[18],t[19]=e[15]*i[4]+e[16]*i[9]+e[17]*i[14]+e[18]*i[19]+e[19],t},e.prototype._colorMatrix=function(t){var e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e},e.prototype.brightness=function(t,e){var i=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)},e.prototype.tint=function(t,e){var i=[(t>>16&255)/255,0,0,0,0,0,(t>>8&255)/255,0,0,0,0,0,(255&t)/255,0,0,0,0,0,1,0];this._loadMatrix(i,e)},e.prototype.greyscale=function(t,e){var i=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)},e.prototype.blackAndWhite=function(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)},e.prototype.hue=function(t,e){t=(t||0)/180*Math.PI;var i=Math.cos(t),r=Math.sin(t),n=1/3,o=(0,Math.sqrt)(n),s=[i+(1-i)*n,n*(1-i)-o*r,n*(1-i)+o*r,0,0,n*(1-i)+o*r,i+n*(1-i),n*(1-i)-o*r,0,0,n*(1-i)-o*r,n*(1-i)+o*r,i+n*(1-i),0,0,0,0,0,1,0];this._loadMatrix(s,e)},e.prototype.contrast=function(t,e){var i=(t||0)+1,r=-.5*(i-1),n=[i,0,0,0,r,0,i,0,0,r,0,0,i,0,r,0,0,0,1,0];this._loadMatrix(n,e)},e.prototype.saturate=function(t,e){void 0===t&&(t=0);var i=2*t/3+1,r=-.5*(i-1),n=[i,r,r,0,0,r,i,r,0,0,r,r,i,0,0,0,0,0,1,0];this._loadMatrix(n,e)},e.prototype.desaturate=function(){this.saturate(-1)},e.prototype.negative=function(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)},e.prototype.sepia=function(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)},e.prototype.technicolor=function(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)},e.prototype.polaroid=function(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)},e.prototype.toBGR=function(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)},e.prototype.kodachrome=function(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)},e.prototype.browni=function(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)},e.prototype.vintage=function(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)},e.prototype.colorTone=function(t,e,i,r,n){var o=((i=i||16770432)>>16&255)/255,s=(i>>8&255)/255,a=(255&i)/255,l=((r=r||3375104)>>16&255)/255,c=(r>>8&255)/255,u=(255&r)/255,h=[.3,.59,.11,0,0,o,s,a,t=t||.2,0,l,c,u,e=e||.15,0,o-l,s-c,a-u,0,0];this._loadMatrix(h,n)},e.prototype.night=function(t,e){var i=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(i,e)},e.prototype.predator=function(t,e){var i=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(i,e)},e.prototype.lsd=function(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)},e.prototype.reset=function(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)},Object.defineProperty(e.prototype,"matrix",{get:function(){return this.uniforms.m},set:function(t){this.uniforms.m=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t},enumerable:!1,configurable:!0}),e}(ip);v_.prototype.grayscale=v_.prototype.greyscale;var x_=function(t,e){return(x_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};!function(t){function e(e,i){var r=this,n=new th;return e.renderable=!1,(r=t.call(this,"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:e._texture,filterMatrix:n,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])})||this).maskSprite=e,r.maskMatrix=n,null==i&&(i=20),r.scale=new Ju(i,i),r}(function(t,e){function i(){this.constructor=t}x_(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)})(e,t),e.prototype.apply=function(t,e,i,r){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;var n=this.maskSprite.worldTransform,o=Math.sqrt(n.a*n.a+n.b*n.b),s=Math.sqrt(n.c*n.c+n.d*n.d);0!==o&&0!==s&&(this.uniforms.rotation[0]=n.a/o,this.uniforms.rotation[1]=n.b/o,this.uniforms.rotation[2]=n.c/s,this.uniforms.rotation[3]=n.d/s),t.applyFilter(this,e,i,r)},Object.defineProperty(e.prototype,"map",{get:function(){return this.uniforms.mapSampler},set:function(t){this.uniforms.mapSampler=t},enumerable:!1,configurable:!0})}(ip);var b_=function(t,e){return(b_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};!function(t){function e(){return t.call(this,"\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')||this}(function(t,e){function i(){this.constructor=t}b_(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)})(e,t)}(ip);var w_=function(t,e){return(w_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};var T_,E_,S_,A_,M_,I_,C_,P_,R_,O_,D_,L_,k_,B_,F_,z_,N_,U_,G_;!function(t){function e(e,i){void 0===e&&(e=.5),void 0===i&&(i=Math.random());var r=t.call(this,Dp,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0})||this;return r.noise=e,r.seed=i,r}(function(t,e){function i(){this.constructor=t}w_(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)})(e,t),Object.defineProperty(e.prototype,"noise",{get:function(){return this.uniforms.uNoise},set:function(t){this.uniforms.uNoise=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"seed",{get:function(){return this.uniforms.uSeed},set:function(t){this.uniforms.uSeed=t},enumerable:!1,configurable:!0})}(ip);!function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}(T_||(T_={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(E_||(E_={})),function(t){t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL"}(S_||(S_={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}(A_||(A_={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(M_||(M_={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(I_||(I_={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(C_||(C_={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(P_||(P_={})),function(t){t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT"}(R_||(R_={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(O_||(O_={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(D_||(D_={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL"}(L_||(L_={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}(k_||(k_={})),function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT"}(B_||(B_={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(F_||(F_={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(z_||(z_={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}(N_||(N_={})),function(t){t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH"}(U_||(U_={})),function(t){t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"}(G_||(G_={}));var j_=new th;ph.prototype._cacheAsBitmap=!1,ph.prototype._cacheData=null,ph.prototype._cacheAsBitmapResolution=null,ph.prototype._cacheAsBitmapMultisample=U_.NONE;var V_=function(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null};Object.defineProperties(ph.prototype,{cacheAsBitmapResolution:{get:function(){return this._cacheAsBitmapResolution},set:function(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get:function(){return this._cacheAsBitmapMultisample},set:function(t){t!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){var e;this._cacheAsBitmap!==t&&(this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new V_),(e=this._cacheData).originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):((e=this._cacheData).sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea))}}}),ph.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},ph.prototype._initCachedDisplayObject=function(t){var e;if(!this._cacheData||!this._cacheData.sprite){var i=this.alpha;this.alpha=1,t.batch.flush();var r=this.getLocalBounds(null,!0).clone();if(this.filters){var n=this.filters[0].padding;r.pad(n)}r.ceil(uu.RESOLUTION);var o=t.renderTexture.current,s=t.renderTexture.sourceFrame.clone(),a=t.renderTexture.destinationFrame.clone(),l=t.projection.transform,c=rd.create({width:r.width,height:r.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:null!==(e=this.cacheAsBitmapMultisample)&&void 0!==e?e:t.multisample}),u="cacheAsBitmap_"+Lu();this._cacheData.textureCacheId=u,Nh.addToCache(c.baseTexture,u),ed.addToCache(c,u);var h=this.transform.localTransform.copyTo(j_).invert().translate(-r.x,-r.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:c,clear:!0,transform:h,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=l,t.renderTexture.bind(o,s,a),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;var d=new $m(c);d.transform.worldTransform=this.transform.worldTransform,d.anchor.x=-r.x/r.width,d.anchor.y=-r.y/r.height,d.alpha=i,d._bounds=this._bounds,this._cacheData.sprite=d,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=d.containsPoint.bind(d)}},ph.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},ph.prototype._initCachedDisplayObjectCanvas=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.getLocalBounds(null,!0),i=this.alpha;this.alpha=1;var r=t.context,n=t._projTransform;e.ceil(uu.RESOLUTION);var o=rd.create({width:e.width,height:e.height}),s="cacheAsBitmap_"+Lu();this._cacheData.textureCacheId=s,Nh.addToCache(o.baseTexture,s),ed.addToCache(o,s);var a=j_;this.transform.localTransform.copyTo(a),a.invert(),a.tx-=e.x,a.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:o,clear:!0,transform:a,skipUpdateTransform:!1}),t.context=r,t._projTransform=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;var l=new $m(o);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-e.x/e.width,l.anchor.y=-e.y/e.height,l.alpha=i,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=l.containsPoint.bind(l)}},ph.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},ph.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},ph.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,Nh.removeFromCache(this._cacheData.textureCacheId),ed.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},ph.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},ph.prototype.name=null,gh.prototype.getChildByName=function(t,e){for(var i=0,r=this.children.length;i<r;i++)if(this.children[i].name===t)return this.children[i];if(e)for(i=0,r=this.children.length;i<r;i++){if(this.children[i].getChildByName){var n=this.children[i].getChildByName(t,!0);if(n)return n}}return null},ph.prototype.getGlobalPosition=function(t,e){return void 0===t&&(t=new Ju),void 0===e&&(e=!1),this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};var X_=function(t,e){return(X_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function H_(t,e){function i(){this.constructor=t}X_(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var q_=function(t){function e(e,i,r,n){void 0===e&&(e=100),void 0===i&&(i=100),void 0===r&&(r=10),void 0===n&&(n=10);var o=t.call(this)||this;return o.segWidth=r,o.segHeight=n,o.width=e,o.height=i,o.build(),o}return H_(e,t),e.prototype.build=function(){for(var t=this.segWidth*this.segHeight,e=[],i=[],r=[],n=this.segWidth-1,o=this.segHeight-1,s=this.width/n,a=this.height/o,l=0;l<t;l++){var c=l%this.segWidth,u=l/this.segWidth|0;e.push(c*s,u*a),i.push(c/n,u/o)}var h=n*o;for(l=0;l<h;l++){var d=l%n,p=l/n|0,f=p*this.segWidth+d,m=p*this.segWidth+d+1,g=(p+1)*this.segWidth+d,_=(p+1)*this.segWidth+d+1;r.push(f,m,g,m,_,g)}this.buffers[0].data=new Float32Array(e),this.buffers[1].data=new Float32Array(i),this.indexBuffer.data=new Uint16Array(r),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()},e}(Lg),W_=function(t){function e(e,i,r){void 0===e&&(e=200),void 0===r&&(r=0);var n=t.call(this,new Float32Array(4*i.length),new Float32Array(4*i.length),new Uint16Array(6*(i.length-1)))||this;return n.points=i,n._width=e,n.textureScale=r,n.build(),n}return H_(e,t),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),e.prototype.build=function(){var t=this.points;if(t){var e=this.getBuffer("aVertexPosition"),i=this.getBuffer("aTextureCoord"),r=this.getIndex();if(!(t.length<1)){e.data.length/4!==t.length&&(e.data=new Float32Array(4*t.length),i.data=new Float32Array(4*t.length),r.data=new Uint16Array(6*(t.length-1)));var n=i.data,o=r.data;n[0]=0,n[1]=0,n[2]=0,n[3]=1;for(var s=0,a=t[0],l=this._width*this.textureScale,c=t.length,u=0;u<c;u++){var h=4*u;if(this.textureScale>0){var d=a.x-t[u].x,p=a.y-t[u].y,f=Math.sqrt(d*d+p*p);a=t[u],s+=f/l}else s=u/(c-1);n[h]=s,n[h+1]=0,n[h+2]=s,n[h+3]=1}var m=0;for(u=0;u<c-1;u++){h=2*u;o[m++]=h,o[m++]=h+1,o[m++]=h+2,o[m++]=h+2,o[m++]=h+1,o[m++]=h+3}i.update(),r.update(),this.updateVertices()}}},e.prototype.updateVertices=function(){var t=this.points;if(!(t.length<1)){for(var e,i=t[0],r=0,n=0,o=this.buffers[0].data,s=t.length,a=0;a<s;a++){var l=t[a],c=4*a;n=-((e=a<t.length-1?t[a+1]:l).x-i.x),r=e.y-i.y;var u=Math.sqrt(r*r+n*n),h=this.textureScale>0?this.textureScale*this._width/2:this._width/2;r/=u,n/=u,r*=h,n*=h,o[c]=l.x+r,o[c+1]=l.y+n,o[c+2]=l.x-r,o[c+3]=l.y-n,i=l}this.buffers[0].update()}},e.prototype.update=function(){this.textureScale>0?this.build():this.updateVertices()},e}(Lg),$_=(function(t){function e(e,i,r){void 0===r&&(r=0);var n=this,o=new W_(e.height,i,r),s=new Dg(e);return r>0&&(e.baseTexture.wrapMode=eu.REPEAT),(n=t.call(this,o,s)||this).autoUpdate=!0,n}H_(e,t),e.prototype._render=function(e){var i=this.geometry;(this.autoUpdate||i._width!==this.shader.texture.height)&&(i._width=this.shader.texture.height,i.update()),t.prototype._render.call(this,e)}}(Og),function(t){function e(e,i,r){var n=this,o=new q_(e.width,e.height,i,r),s=new Dg(ed.WHITE);return(n=t.call(this,o,s)||this).texture=e,n.autoResize=!0,n}return H_(e,t),e.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID;var t=this.geometry,e=this.shader.texture,i=e.width,r=e.height;!this.autoResize||t.width===i&&t.height===r||(t.width=this.shader.texture.width,t.height=this.shader.texture.height,t.build())},Object.defineProperty(e.prototype,"texture",{get:function(){return this.shader.texture},set:function(t){this.shader.texture!==t&&(this.shader.texture=t,this._textureID=-1,t.baseTexture.valid?this.textureUpdated():t.once("update",this.textureUpdated,this))},enumerable:!1,configurable:!0}),e.prototype._render=function(e){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),t.prototype._render.call(this,e)},e.prototype.destroy=function(e){this.shader.texture.off("update",this.textureUpdated,this),t.prototype.destroy.call(this,e)},e}(Og)),Y_=(function(t){function e(e,i,r,n,o){void 0===e&&(e=ed.EMPTY);var s=this,a=new Lg(i,r,n);a.getBuffer("aVertexPosition").static=!1;var l=new Dg(e);return(s=t.call(this,a,l,null,o)||this).autoUpdate=!0,s}H_(e,t),Object.defineProperty(e.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(t){this.geometry.getBuffer("aVertexPosition").data=t},enumerable:!1,configurable:!0}),e.prototype._render=function(e){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),t.prototype._render.call(this,e)}}(Og),function(t){function e(e,i,r,n,o){void 0===i&&(i=10),void 0===r&&(r=10),void 0===n&&(n=10),void 0===o&&(o=10);var s=t.call(this,ed.WHITE,4,4)||this;return s._origWidth=e.orig.width,s._origHeight=e.orig.height,s._width=s._origWidth,s._height=s._origHeight,s._leftWidth=i,s._rightWidth=n,s._topHeight=r,s._bottomHeight=o,s.texture=e,s}H_(e,t),e.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID,this._refresh()},Object.defineProperty(e.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(t){this.geometry.getBuffer("aVertexPosition").data=t},enumerable:!1,configurable:!0}),e.prototype.updateHorizontalVertices=function(){var t=this.vertices,e=this._getMinScale();t[9]=t[11]=t[13]=t[15]=this._topHeight*e,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight*e,t[25]=t[27]=t[29]=t[31]=this._height},e.prototype.updateVerticalVertices=function(){var t=this.vertices,e=this._getMinScale();t[2]=t[10]=t[18]=t[26]=this._leftWidth*e,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth*e,t[6]=t[14]=t[22]=t[30]=this._width},e.prototype._getMinScale=function(){var t=this._leftWidth+this._rightWidth,e=this._width>t?1:this._width/t,i=this._topHeight+this._bottomHeight,r=this._height>i?1:this._height/i;return Math.min(e,r)},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftWidth",{get:function(){return this._leftWidth},set:function(t){this._leftWidth=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightWidth",{get:function(){return this._rightWidth},set:function(t){this._rightWidth=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"topHeight",{get:function(){return this._topHeight},set:function(t){this._topHeight=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bottomHeight",{get:function(){return this._bottomHeight},set:function(t){this._bottomHeight=t,this._refresh()},enumerable:!1,configurable:!0}),e.prototype._refresh=function(){var t=this.texture,e=this.geometry.buffers[1].data;this._origWidth=t.orig.width,this._origHeight=t.orig.height;var i=1/this._origWidth,r=1/this._origHeight;e[0]=e[8]=e[16]=e[24]=0,e[1]=e[3]=e[5]=e[7]=0,e[6]=e[14]=e[22]=e[30]=1,e[25]=e[27]=e[29]=e[31]=1,e[2]=e[10]=e[18]=e[26]=i*this._leftWidth,e[4]=e[12]=e[20]=e[28]=1-i*this._rightWidth,e[9]=e[11]=e[13]=e[15]=r*this._topHeight,e[17]=e[19]=e[21]=e[23]=1-r*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()}}($_),function(t,e){return(Y_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)});!function(t){function e(e,i){void 0===i&&(i=!0);var r=t.call(this,e[0]instanceof ed?e[0]:e[0].texture)||this;return r._textures=null,r._durations=null,r._autoUpdate=i,r._isConnectedToTicker=!1,r.animationSpeed=1,r.loop=!0,r.updateAnchor=!1,r.onComplete=null,r.onFrameChange=null,r.onLoop=null,r._currentTime=0,r._playing=!1,r._previousFrame=null,r.textures=e,r}(function(t,e){function i(){this.constructor=t}Y_(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)})(e,t),e.prototype.stop=function(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(xh.shared.remove(this.update,this),this._isConnectedToTicker=!1))},e.prototype.play=function(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(xh.shared.add(this.update,this,_h.HIGH),this._isConnectedToTicker=!0))},e.prototype.gotoAndStop=function(t){this.stop();var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()},e.prototype.gotoAndPlay=function(t){var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture(),this.play()},e.prototype.update=function(t){if(this._playing){var e=this.animationSpeed*t,i=this.currentFrame;if(null!==this._durations){var r=this._currentTime%1*this._durations[this.currentFrame];for(r+=e/60*1e3;r<0;)this._currentTime--,r+=this._durations[this.currentFrame];var n=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);r>=this._durations[this.currentFrame];)r-=this._durations[this.currentFrame]*n,this._currentTime+=n;this._currentTime+=r/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):i!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<i||this.animationSpeed<0&&this.currentFrame>i)&&this.onLoop(),this.updateTexture())}},e.prototype.updateTexture=function(){var t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))},e.prototype.destroy=function(e){this.stop(),t.prototype.destroy.call(this,e),this.onComplete=null,this.onFrameChange=null,this.onLoop=null},e.fromFrames=function(t){for(var i=[],r=0;r<t.length;++r)i.push(ed.from(t[r]));return new e(i)},e.fromImages=function(t){for(var i=[],r=0;r<t.length;++r)i.push(ed.from(t[r]));return new e(i)},Object.defineProperty(e.prototype,"totalFrames",{get:function(){return this._textures.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textures",{get:function(){return this._textures},set:function(t){if(t[0]instanceof ed)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(var e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentFrame",{get:function(){var t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playing",{get:function(){return this._playing},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(xh.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(xh.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0})}($m);Op.registerPlugin("accessibility",yh),Op.registerPlugin("extract",Kp),Op.registerPlugin("interaction",Ch),Op.registerPlugin("particle",pm),Op.registerPlugin("prepare",yg),Op.registerPlugin("batch",jp),Op.registerPlugin("tilingSprite",Ag),ff.registerPlugin(qg),ff.registerPlugin(Mf),ff.registerPlugin(Hf),ff.registerPlugin(am),ff.registerPlugin(xg),$p.registerPlugin(bh),$p.registerPlugin(mf);function Z_(t){return(Z_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function K_(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return J_(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return J_(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw o}}}}function J_(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function Q_(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ty(r.key),r)}}function ty(t){var e=function(t,e){if("object"!=Z_(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!=Z_(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Z_(e)?e:String(e)}var ey=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.el=e,this.dotsCountX=12,this.dotsCountY=5,this.dotRadius=3,this.needsUpdate=!1,this.screenWidthCurrent=window.innerWidth,this.setSizes(),this.init()}var e,i,r;return e=t,(i=[{key:"init",value:function(){var t=this;this.palette=[[7654384,11070836,13226113,10132735,16154263,13599568,8617314],[7914480,8581272,16377408,7711473,15763437,15824947,10257764],[7516113,8644811,13167199,10797234,12555007,16480602,12683614],[7249075,8708607,10153854,14145388,8954111,16023987,14187845],[7114395,8708607,8580521,15198283,15198283,14846974,16675878]],this.parent=this.el.parentElement,this.overlayDiv=this.parent.querySelector(".cta-txt"),this.app=new $p({width:this.width,height:this.height,transparent:!0,resolution:this.dpi,antialias:!0,autoDensity:!0}),this.el.appendChild(this.app.view),setTimeout((function(){t.el.classList.add("loaded")}),500),this.initScene()}},{key:"initScene",value:function(){this.dotsArray=this.createDots(),this.addMouseEventListener(),this.animate(),window.addEventListener("resize",xt(this.onResize.bind(this),100))}},{key:"addMouseEventListener",value:function(){var t=this;this.app.view.addEventListener("mousemove",(function(e){t.onMouseMove(e)})),this.overlayDiv.addEventListener("mousemove",(function(e){t.onOverlayMouseMove(e)}))}},{key:"onOverlayMouseMove",value:function(t){var e=this.app.view.getBoundingClientRect(),i=this.overlayDiv.getBoundingClientRect(),r=t.clientX-e.left+(i.left-e.left);this.updateDotColors(r)}},{key:"onMouseMove",value:function(t){var e=this.app.view.getBoundingClientRect(),i=t.clientX-e.left;this.updateDotColors(i)}},{key:"createDots",value:function(){for(var t=[],e=(this.width-2*this.dotRadius)/(this.dotsCountX-1),i=(this.height-2*this.dotRadius)/(this.dotsCountY-1),r=0;r<this.dotsCountY;r++){for(var n=[],o=0;o<this.dotsCountX;o++){var s=this.createDot();s.x=o*e+this.dotRadius,s.y=r*i+this.dotRadius,this.app.stage.addChild(s),n.push(s)}t.push(n)}return t}},{key:"createDot",value:function(){var t=new Vm;return t.currentColor=16777215,t.targetColor=16777215,t.alpha=0,t.targetAlpha=0,t.beginFill(t.currentColor),t.drawCircle(0,0,this.dotRadius),t.endFill(),t}},{key:"updateDotColors",value:function(t){for(var e=(this.width-2*this.dotRadius)/(this.dotsCountX-1),i=Math.round(t/e),r=0;r<this.dotsArray.length;r++)for(var n=0;n<this.dotsArray[r].length;n++){var o=n-i+3,s=void 0;s=o>=0&&o<this.palette[r].length?this.palette[r][o]:16777215,this.dotsArray[r][n].targetColor=s,this.dotsArray[r][n].targetAlpha=this.calculateAlpha(n,i)}}},{key:"calculateAlpha",value:function(t,e){var i=Math.abs(t-e);return i<=3?1:Math.max(.7-.3*(i-3),0)}},{key:"updateDotColorsTransition",value:function(){var t,e=!1,i=K_(this.dotsArray);try{for(i.s();!(t=i.n()).done;){var r,n=K_(t.value);try{for(n.s();!(r=n.n()).done;){var o=r.value;if(o.currentColor!==o.targetColor){var s=o.targetColor>>16&255,a=o.targetColor>>8&255,l=255&o.targetColor,c=o.currentColor>>16&255,u=o.currentColor>>8&255,h=255&o.currentColor,d=Math.round(bt(c,s,.025)),p=Math.round(bt(u,a,.025)),f=Math.round(bt(h,l,.025));o.currentColor=(d<<16)+(p<<8)+f,o.clear(),o.beginFill(o.currentColor),o.drawCircle(0,0,this.dotRadius),o.endFill(),o.alpha!==o.targetAlpha&&(Math.abs(o.alpha-o.targetAlpha)<.01?o.alpha=o.targetAlpha:o.alpha=bt(o.alpha,o.targetAlpha,.025)),(Math.abs(f-l)>10||Math.abs(p-a)>10||Math.abs(d-s)>10||Math.abs(o.alpha-o.targetAlpha)>.01)&&(e=!0)}}}catch(t){n.e(t)}finally{n.f()}}}catch(t){i.e(t)}finally{i.f()}this.needsUpdate=e}},{key:"animate",value:function(){requestAnimationFrame(this.animate.bind(this)),this.updateDotColorsTransition(),this.needsUpdate&&(this.app.renderer.render(this.app.stage),this.needsUpdate=!1)}},{key:"setSizes",value:function(){this.width=this.el.offsetWidth,this.height=this.el.offsetHeight,this.dpi=Math.min(window.devicePixelRatio||1,2);var t=(this.height-2*this.dotRadius)/(this.dotsCountY-1);this.dotsCountX=Math.ceil(this.width/t)+1}},{key:"onResize",value:function(){var t=window.innerWidth;t!==this.screenWidthCurrent&&(this.screenWidthCurrent=t,this.setSizes(),this.app.renderer.resize(this.width,this.height),this.app.stage.removeChildren(),this.initScene())}}])&&Q_(e.prototype,i),r&&Q_(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function iy(t){return(iy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ry(t){return function(t){if(Array.isArray(t))return ny(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return ny(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return ny(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ny(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function oy(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,sy(r.key),r)}}function sy(t){var e=function(t,e){if("object"!=iy(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!=iy(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==iy(e)?e:String(e)}var ay,ly,cy,uy,hy,dy,py,fy,my=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.el=e,this.currentWidth=window.innerWidth,this.init()}var e,i,r;return e=t,(i=[{key:"init",value:function(){this.initUI(),this.calcSizes(),this.initEvents(),this.setActiveDot(0),this.initNotInteracted(),this.initSteps()}},{key:"setInteracted",value:function(){this.interactedTimline&&(this.interactedTimline.kill(),this.interactedTimline=null)}},{key:"initUI",value:function(){this.thumb=this.el.querySelector(".time-slider--thumb"),this.thumbCaption=this.thumb.querySelector("em"),this.dots=this.el.querySelectorAll(".time-slider--dot"),this.line=this.el.querySelector(".time-slider--line"),this.overlap=this.el.querySelector(".time-slider--overlap"),this.steps=ry(this.el.querySelectorAll(".time-slider--step")),this.popups=ry(this.el.querySelectorAll(".time-slider--popup"))}},{key:"initSteps",value:function(){this.steps.forEach((function(t,e){var i=t.dataset.start,r=t.dataset.end;t.yearStart=i,t.yearEnd=r}))}},{key:"updateStep",value:function(t){var e=t.dataset.year;this.steps.forEach((function(t,i){t.yearStart<=e?t.classList.add("active"):t.classList.remove("active")})),this.popups.length>0&&this.popups.forEach((function(t,i){var r=t.dataset.start,n=t.dataset.end;r<=e&&n>=e?t.classList.add("active"):t.classList.remove("active")}))}},{key:"calcSizes",value:function(){this.thumbSize=this.thumb.getBoundingClientRect().width,this.thumbSizeHalf=this.thumbSize/2}},{key:"initEvents",value:function(){this.thumb.addEventListener("mousedown",this.onThumbMouseDown.bind(this)),this.thumb.addEventListener("touchstart",this.onThumbMouseDown.bind(this)),document.addEventListener("mousemove",this.onMouseMove.bind(this)),document.addEventListener("touchmove",this.onMouseMove.bind(this)),document.addEventListener("mouseup",this.onMouseUp.bind(this)),document.addEventListener("touchend",this.onMouseUp.bind(this)),this.initDotEvents(),window.addEventListener("resize",this.onResize.bind(this))}},{key:"onResize",value:function(){this.currentWidth!==window.innerWidth&&(this.currentWidth=window.innerWidth,this.calcSizes(),this.setActiveDot(Array.from(this.dots).indexOf(this.currentDot)))}},{key:"initNotInteracted",value:function(){this.interactedTimline=Zo.timeline({repeat:-1,delay:1,repeatDelay:2}).to(this.thumb,{duration:.5,x:40,force3D:!0,ease:"power4.out"}).to(this.thumb,{duration:.5,x:0,force3D:!0,ease:"power4.out"})}},{key:"initDotEvents",value:function(){var t=this;this.dots.forEach((function(e,i){e.addEventListener("click",(function(){t.setInteracted(),t.setActiveDot(i)}))}))}},{key:"onThumbMouseDown",value:function(t){this.setInteracted(),this.thumbDragged=!0}},{key:"onMouseMove",value:function(t){var e;this.thumbDragged&&(e=t.touches?t.touches[0].clientX:t.clientX,this.moveThumb(e))}},{key:"onMouseUp",value:function(t){this.thumbDragged&&(this.thumbDragged=!1,this.currentDot&&this.snapThumbToDot(this.currentDot))}},{key:"moveThumb",value:function(t){var e=this.line.getBoundingClientRect(),i=Math.min(Math.max(t-e.left-this.thumbSizeHalf,0),e.width-this.thumbSize-1);Zo.to(this.thumb,{duration:0,x:i,force3D:!0,ease:"none"}),this.updateDots(i)}},{key:"updateDots",value:function(t){this.closestDot=this.getClosestDot(t+this.thumbSizeHalf);var e=Array.from(this.dots).indexOf(this.closestDot);this.dots.forEach((function(t,i){i<=e?t.classList.add("active"):t.classList.remove("active")}));var i=this.closestDot.getBoundingClientRect(),r=this.line.getBoundingClientRect(),n=r.width-(i.left-r.left+i.width/2);this.overlap.style.width="".concat(n,"px"),this.thumbCaption.innerHTML=2023==this.closestDot.dataset.year?"Now":this.closestDot.dataset.year,this.currentDot=this.closestDot,this.closestDot=null,this.updateStep(this.currentDot)}},{key:"getClosestDot",value:function(t){var e=this.line.getBoundingClientRect(),i=null,r=1e6;return this.dots.forEach((function(n,o){var s=n.getBoundingClientRect(),a=s.left-e.left+s.width/2,l=Math.abs(a-t);l<r&&(r=l,i=n)})),i}},{key:"snapThumbToDot",value:function(t){var e=t.getBoundingClientRect(),i=this.line.getBoundingClientRect(),r=e.left-i.left+e.width/2-this.thumbSizeHalf;r=Math.min(Math.max(r,0),i.width-this.thumbSize-1),Zo.to(this.thumb,{duration:0,x:r,force3D:!0,ease:"none"})}},{key:"setActiveDot",value:function(t){var e=null;this.currentDot&&(e=this.currentDot.getBoundingClientRect().left-this.thumbSizeHalf),this.dots.forEach((function(e,i){i<=t?e.classList.add("active"):e.classList.remove("active")}));var i=this.dots[t].getBoundingClientRect(),r=this.line.getBoundingClientRect(),n=r.width-(i.left-r.left+i.width/2);Zo.to(this.overlap,{duration:.5,width:n,ease:"power4.out"}),this.thumbCaption.innerHTML=2023==this.dots[t].dataset.year?"Now":this.dots[t].dataset.year;var o=i.left-r.left+i.width/2-this.thumbSizeHalf;o=Math.min(Math.max(o,0),r.width-this.thumbSize),e?Zo.fromTo(this.thumb,{x:e},{duration:.5,x:o,force3D:!0,ease:"power4.out"}):Zo.to(this.thumb,{duration:.5,x:o,force3D:!0,ease:"power4.out"}),this.currentDot=this.dots[t],this.closestDot=null,this.updateStep(this.currentDot)}}])&&oy(e.prototype,i),r&&oy(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),gy=function(){return"undefined"!=typeof window},_y=function(){return ay||gy()&&(ay=window.gsap)&&ay.registerPlugin&&ay},yy=function(t){return"string"==typeof t},vy=function(t){return"function"==typeof t},xy=function(t,e){var i="x"===e?"Width":"Height",r="scroll"+i,n="client"+i;return t===cy||t===uy||t===hy?Math.max(uy[r],hy[r])-(cy["inner"+i]||uy[n]||hy[n]):t[r]-t["offset"+i]},by=function(t,e){var i="scroll"+("x"===e?"Left":"Top");return t===cy&&(null!=t.pageXOffset?i="page"+e.toUpperCase()+"Offset":t=null!=uy[i]?uy:hy),function(){return t[i]}},wy=function(t,e){if(!(t=dy(t)[0])||!t.getBoundingClientRect)return console.warn("scrollTo target doesn't exist. Using 0")||{x:0,y:0};var i=t.getBoundingClientRect(),r=!e||e===cy||e===hy,n=r?{top:uy.clientTop-(cy.pageYOffset||uy.scrollTop||hy.scrollTop||0),left:uy.clientLeft-(cy.pageXOffset||uy.scrollLeft||hy.scrollLeft||0)}:e.getBoundingClientRect(),o={x:i.left-n.left,y:i.top-n.top};return!r&&e&&(o.x+=by(e,"x")(),o.y+=by(e,"y")()),o},Ty=function(t,e,i,r,n){return isNaN(t)||"object"==typeof t?yy(t)&&"="===t.charAt(1)?parseFloat(t.substr(2))*("-"===t.charAt(0)?-1:1)+r-n:"max"===t?xy(e,i)-n:Math.min(xy(e,i),wy(t,e)[i]-n):parseFloat(t)-n},Ey=function(){ay=_y(),gy()&&ay&&"undefined"!=typeof document&&document.body&&(cy=window,hy=document.body,uy=document.documentElement,dy=ay.utils.toArray,ay.config({autoKillThreshold:7}),py=ay.config(),ly=1)},Sy={version:"3.12.5",name:"scrollTo",rawVars:1,register:function(t){ay=t,Ey()},init:function(t,e,i,r,n){ly||Ey();var o=ay.getProperty(t,"scrollSnapType");this.isWin=t===cy,this.target=t,this.tween=i,e=function(t,e,i,r){if(vy(t)&&(t=t(e,i,r)),"object"!=typeof t)return yy(t)&&"max"!==t&&"="!==t.charAt(1)?{x:t,y:t}:{y:t};if(t.nodeType)return{y:t,x:t};var n,o={};for(n in t)o[n]="onAutoKill"!==n&&vy(t[n])?t[n](e,i,r):t[n];return o}(e,r,t,n),this.vars=e,this.autoKill=!!e.autoKill,this.getX=by(t,"x"),this.getY=by(t,"y"),this.x=this.xPrev=this.getX(),this.y=this.yPrev=this.getY(),fy||(fy=ay.core.globals().ScrollTrigger),"smooth"===ay.getProperty(t,"scrollBehavior")&&ay.set(t,{scrollBehavior:"auto"}),o&&"none"!==o&&(this.snap=1,this.snapInline=t.style.scrollSnapType,t.style.scrollSnapType="none"),null!=e.x?(this.add(this,"x",this.x,Ty(e.x,t,"x",this.x,e.offsetX||0),r,n),this._props.push("scrollTo_x")):this.skipX=1,null!=e.y?(this.add(this,"y",this.y,Ty(e.y,t,"y",this.y,e.offsetY||0),r,n),this._props.push("scrollTo_y")):this.skipY=1},render:function(t,e){for(var i,r,n,o,s,a=e._pt,l=e.target,c=e.tween,u=e.autoKill,h=e.xPrev,d=e.yPrev,p=e.isWin,f=e.snap,m=e.snapInline;a;)a.r(t,a.d),a=a._next;i=p||!e.skipX?e.getX():h,n=(r=p||!e.skipY?e.getY():d)-d,o=i-h,s=py.autoKillThreshold,e.x<0&&(e.x=0),e.y<0&&(e.y=0),u&&(!e.skipX&&(o>s||o<-s)&&i<xy(l,"x")&&(e.skipX=1),!e.skipY&&(n>s||n<-s)&&r<xy(l,"y")&&(e.skipY=1),e.skipX&&e.skipY&&(c.kill(),e.vars.onAutoKill&&e.vars.onAutoKill.apply(c,e.vars.onAutoKillParams||[]))),p?cy.scrollTo(e.skipX?i:e.x,e.skipY?r:e.y):(e.skipY||(l.scrollTop=e.y),e.skipX||(l.scrollLeft=e.x)),!f||1!==t&&0!==t||(r=l.scrollTop,i=l.scrollLeft,m?l.style.scrollSnapType=m:l.style.removeProperty("scroll-snap-type"),l.scrollTop=r+1,l.scrollLeft=i+1,l.scrollTop=r,l.scrollLeft=i),e.xPrev=e.x,e.yPrev=e.y,fy&&fy.update()},kill:function(t){var e="scrollTo"===t,i=this._props.indexOf(t);return(e||"scrollTo_x"===t)&&(this.skipX=1),(e||"scrollTo_y"===t)&&(this.skipY=1),i>-1&&this._props.splice(i,1),!this._props.length}};function Ay(t){return(Ay="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function My(t){return function(t){if(Array.isArray(t))return Iy(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return Iy(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Iy(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Iy(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function Cy(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Py(r.key),r)}}function Py(t){var e=function(t,e){if("object"!=Ay(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!=Ay(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ay(e)?e:String(e)}Sy.max=xy,Sy.getOffset=wy,Sy.buildGetter=by,_y()&&ay.registerPlugin(Sy),Zo.registerPlugin(Gl),Zo.registerPlugin(Sy);var Ry=function(){return window.matchMedia("(max-width: 767px)").matches},Oy=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.el=e,this.currentWidth=window.innerWidth,this.onResize=this.onResize.bind(this),this.onScroll=this.onScroll.bind(this),this.init()}var e,i,r;return e=t,(i=[{key:"init",value:function(){this.steps=My(this.el.querySelectorAll(".timeline-section--step")),this.navigationSteps=this.steps.filter((function(t){return!t.classList.contains("timeline-section--first-step")})),this.medias=My(this.el.querySelectorAll(".timeline-section--background")),this.pointer=this.el.querySelector(".timeline-section--pointer"),this.nextStepEl=this.el.querySelector(".next-step"),this.nextStepColors=this.getNextStepColors(),this.lineFillerEl=this.el.querySelector(".line-filler"),this.lineColoredEl=this.el.querySelector(".line-colored"),this.lineTrackEl=this.el.querySelector(".line-track"),this.initMutationObserver(),this.calcLinePosition(),this.getSizes(),this.initEvents(),this.steps.length>0&&this.medias.length>0&&this.initTimeline()}},{key:"initMutationObserver",value:function(){var t=this;this.insideAccordion=this.el.closest(".js-slide"),this.insideAccordion&&(this.observer=new MutationObserver((function(e){e.forEach((function(e){""===e.target.style.display&&(t.mutationTimeout&&clearTimeout(t.mutationTimeout),t.mutationTimeout=setTimeout((function(){t.getSizes(),t.calcLinePosition(),t.scroller.refresh(),t.scroller.update(),Zo.to([t.lineColoredEl,t.lineTrackEl],{opacity:1,duration:.5,ease:"power2.inOut"})}),100))}))})),this.observer.observe(this.insideAccordion,{attributes:!0}))}},{key:"getSizes",value:function(){this.sizes={width:window.innerWidth,height:window.innerHeight,nextStepHeight:this.nextStepEl.getBoundingClientRect().height,headerHeight:document.getElementById("header").getBoundingClientRect().height},this.sizes.nextStepDelta=this.sizes.headerHeight-this.sizes.nextStepHeight/2+20}},{key:"calcLinePosition",value:function(){if(this.pointer){var t=this.pointer.getBoundingClientRect().top-this.el.getBoundingClientRect().top;this.el.setAttribute("style","--line-position: ".concat(t,"px"));var e=this.steps[this.steps.length-1].getBoundingClientRect().height+50;this.el.style.setProperty("--line-bottom","".concat(e,"px"))}}},{key:"initTimeline",value:function(){var t=this;this.scroller=new Gl({trigger:this.el,start:"top top",end:"bottom bottom",scrub:!0,invalidateOnRefresh:!0,onUpdate:function(e){t.updateStep(e.progress),t.updateNextStepColor(e.progress),t.updateNextStepDirection(e.progress)}})}},{key:"onScroll",value:function(){this.updateMobileStep()}},{key:"updateMobileStep",value:function(){if(Ry()){var t=this.nextStepEl.getBoundingClientRect().top,e=this.lineColoredEl.getBoundingClientRect().top-t;this.steps.forEach((function(e,i){e.getBoundingClientRect().top<t+15?e.classList.add("step-active"):e.classList.remove("step-active")})),this.lineFillerEl.style.top="".concat(-e,"px")}}},{key:"initEvents",value:function(){this.initNextStepEvent(),window.addEventListener("resize",xt(this.onResize,100)),window.addEventListener("scroll",this.onScroll)}},{key:"onResize",value:function(){this.currentWidth!==window.innerWidth&&(this.currentWidth=window.innerWidth,this.getSizes(),this.calcLinePosition())}},{key:"getNextStepColors",value:function(){var t=[],e=100/(this.steps.length-1);return this.steps.forEach((function(i,r){var n=i.style.getPropertyValue("--pointer-color"),o=i.style.getPropertyValue("--secondary-color"),s=r*e;if(o){var a=s-e/2;t.push({position:a,color:o})}n&&t.push({position:s,color:n})})),t}},{key:"getNextStep",value:function(){var t=this;if(Ry()){var e=window.scrollY+window.innerHeight/2,i=null,r=9999999999,n=null;return this.navigationSteps.forEach((function(t,o){var s=t.getBoundingClientRect(),a=window.scrollY+s.top-30-e;a>0&&a<r&&(i=t,r=a,n=o)})),i||(i=this.navigationSteps[0],n=0),{el:i,index:n}}var o=null,s=9999999999,a=null;return this.navigationSteps.forEach((function(e,i){var r=e.getBoundingClientRect().top-t.sizes.nextStepDelta;r>5&&r<s&&(o=e,s=r,a=i)})),o||(o=this.navigationSteps[0],a=0),{el:o,index:a}}},{key:"initNextStepEvent",value:function(){var t=this;this.nextStepEl.addEventListener("click",(function(e){var i=t.getNextStep().el.getBoundingClientRect();if(Ry()){var r=window.innerHeight,n=window.scrollY+i.top-r/2-10;Zo.to(window,{duration:1,scrollTo:{y:n,autoKill:!1},ease:"power2.inOut"})}else{var o=window.innerHeight,s=window.scrollY+i.top-o+i.height;Zo.to(window,{duration:1,scrollTo:{y:s,autoKill:!1},ease:"power2.inOut"})}}))}},{key:"updateNextStepColor",value:function(t){for(var e=this.nextStepColors[0],i=this.nextStepColors[this.nextStepColors.length-1],r=0;r<this.nextStepColors.length-1;r++)if(100*t>=this.nextStepColors[r].position&&100*t<this.nextStepColors[r+1].position){e=this.nextStepColors[r],i=this.nextStepColors[r+1];break}var n,o,s,a,l,c,u,h,d,p,f,m=(100*t-e.position)/(i.position-e.position),g=(n=e.color,o=i.color,s=m,a=parseInt(n.replace(/#/g,""),16),l=a>>16,c=a>>8&255,u=255&a,h=parseInt(o.replace(/#/g,""),16),d=h>>16,p=h>>8&255,f=255&h,"#"+((1<<24)+(Math.round(l+s*(d-l))<<16)+(Math.round(c+s*(p-c))<<8)+Math.round(u+s*(f-u))).toString(16).slice(1));this.nextStepEl.style.setProperty("--next-step-color",g)}},{key:"updateStep",value:function(t){var e=1/(this.steps.length-1);this.medias.forEach((function(i,r){if(0===r)Zo.to(i,{opacity:1,immediateRender:!1});else{var n=(r-1)*e,o=r*e,s=0;t>n&&(s=Math.min((t-n)/(o-n),1)),Zo.to(i,{opacity:s,immediateRender:!1})}}))}},{key:"updateNextStepDirection",value:function(t){t>.995?this.nextStepEl.classList.add("revert-direction"):this.nextStepEl.classList.remove("revert-direction")}}])&&Cy(e.prototype,i),r&&Cy(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Dy(t){return(Dy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ly(t){return function(t){if(Array.isArray(t))return ky(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return ky(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return ky(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ky(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function By(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Fy(r.key),r)}}function Fy(t){var e=function(t,e){if("object"!=Dy(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!=Dy(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Dy(e)?e:String(e)}var zy=function(){return window.matchMedia("(max-aspect-ratio: 3 / 4)").matches},Ny=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.el=e,this.sizes={width:this.el.offsetWidth,height:this.el.offsetHeight,screenWidth:window.innerWidth},this.isTouchDevice=!!(navigator.maxTouchPoints>0||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),this.sizes.heatmapSpotSize=this.sizes.height/6,this.sizes.heatmapSpotSizeInner=this.sizes.heatmapSpotSize/3*2,this.bindAll(),this.init()}var e,i,r;return e=t,(i=[{key:"bindAll",value:function(){var t=this;["resize","onResize","onMouseMove","checkIdleStatus"].forEach((function(e){return t[e]=t[e].bind(t)}))}},{key:"init",value:function(){var t=this.el.dataset.image,e=this.el.dataset.heatmap;t&&e&&(this.assets={backgroundImage:t,heatmapImage:e},this.initWaypoints(),this.loadAssets())}},{key:"initWaypoints",value:function(){var t=this;this.waypointEls=Ly(this.el.querySelectorAll(".hover-reveal-component--waypoint")),this.waypoints=[],this.waypointEls.forEach((function(e){var i=e.dataset.x,r=e.dataset.y,n=e.dataset.id,o=e.dataset.animation,s=e.dataset.text;t.waypoints.push({x:i,y:r,index:n,text:s,animation:o,el:e,isActivated:!1})})),this.currentWaypointIndex=-1,this.waypointRadius=10,this.idleTimeout=3e3,this.isIdle=!1,this.lastMouseMoveTime=Date.now()}},{key:"loadAssets",value:function(){var t=this;this.loader=new ff,this.loader.add("backgroundImage",this.assets.backgroundImage),this.loader.add("heatmapImage",this.assets.heatmapImage),this.loader.load((function(e,i){t.resources=i,t.initScene(),t.initEvents()}))}},{key:"initApp",value:function(){this.application=new $p({width:this.el.offsetWidth,height:this.el.offsetHeight,transparent:!0,resolution:Math.min(window.devicePixelRatio||1,2),autoDensity:!0}),this.application.renderer.plugins.interaction.autoPreventDefault=!1,this.application.renderer.view.style.touchAction="auto"}},{key:"initScene",value:function(){this.initApp(),this.initBackground(),this.initHeatmap(),this.drawWaypoints(),this.el.appendChild(this.application.view),this.initTicker()}},{key:"drawWaypoints",value:function(){var t=this;this.waypoints.forEach((function(e){var i=new Vm;i.beginFill(16777215),i.drawCircle(0,0,t.waypointRadius/100*t.application.screen.height),i.endFill(),i.x=e.x/100*t.application.screen.width,i.y=e.y/100*t.application.screen.height,i.alpha=.05,t.application.stage.addChild(i),e.circle=i;var r=e.x/100*t.application.screen.width,n=e.y/100*t.application.screen.height;r+e.el.offsetWidth/2>t.application.screen.width&&(r=t.application.screen.width-e.el.offsetWidth/2-10),r-e.el.offsetWidth/2<10&&(r=e.el.offsetWidth/2+10),n+e.el.offsetHeight/2>t.application.screen.height&&(n=t.application.screen.height-e.el.offsetHeight/2-10),n-e.el.offsetHeight/2<10&&(n=e.el.offsetHeight/2+10),e.el.style.left="".concat(r,"px"),e.el.style.top="".concat(n,"px")}))}},{key:"resizeBackground",value:function(){var t;zy()?(t=this.application.screen.width/this.application.screen.height>this.background.texture.width/this.background.texture.height?this.application.screen.width/this.background.texture.width:this.application.screen.height/this.background.texture.height,this.background.scale.set(t,t),this.background.anchor.set(.8,.5),this.background.x=.8*this.application.screen.width,this.background.y=this.application.screen.height/2):(this.background.width=this.application.screen.width,this.background.height=this.application.screen.height,this.background.anchor.set(.5,.5),this.background.x=this.application.screen.width/2,this.background.y=this.application.screen.height/2)}},{key:"initBackground",value:function(){this.background=new $m(this.resources.backgroundImage.texture),this.resizeBackground(),this.application.stage.addChild(this.background)}},{key:"resizeHeatmap",value:function(){var t;zy()?(t=this.application.screen.width/this.application.screen.height>this.heatmap.texture.width/this.heatmap.texture.height?this.application.screen.width/this.heatmap.texture.width:this.application.screen.height/this.heatmap.texture.height,this.heatmap.scale.set(t,t),this.heatmap.anchor.set(.8,.5),this.heatmap.x=.8*this.application.screen.width,this.heatmap.y=this.application.screen.height/2):(this.heatmap.width=this.application.screen.width,this.heatmap.height=this.application.screen.height,this.heatmap.anchor.set(.5,.5),this.heatmap.x=this.application.screen.width/2,this.heatmap.y=this.application.screen.height/2)}},{key:"initHeatmap",value:function(){this.heatmap=new $m(this.resources.heatmapImage.texture),this.resizeHeatmap(),this.application.stage.addChild(this.heatmap),this.initDisplacementFilter();var t=document.createElement("canvas");t.width=2*this.sizes.heatmapSpotSize,t.height=2*this.sizes.heatmapSpotSize;var e=t.getContext("2d"),i=e.createRadialGradient(t.width/2,t.height/2,this.sizes.heatmapSpotSizeInner,t.width/2,t.height/2,this.sizes.heatmapSpotSize);i.addColorStop(0,"rgba(255, 255, 255, 1)"),i.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=i,e.fillRect(0,0,t.width,t.height),this.heatmapMask=new $m(ed.from(t)),this.heatmapMask.anchor.set(.5),this.heatmap.mask=this.heatmapMask,this.application.stage.addChild(this.heatmapMask)}},{key:"initDisplacementFilter",value:function(){var t=this.createDisplacementFilter();this.heatmap.filters=[t]}},{key:"createDisplacementFilter",value:function(){return new ip(null,"\n        precision mediump float;\n        varying vec2 vTextureCoord;\n        uniform sampler2D uSampler;\n        uniform float time;\n\n        float random (vec2 st) {\n            return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);\n        }\n\n        // Perlin noise function\n        float noise(vec2 st) {\n            vec2 i = floor(st);\n            vec2 f = fract(st);\n\n            // Four corners in 2D of a tile\n            float a = random(i);\n            float b = random(i + vec2(1.0, 0.0));\n            float c = random(i + vec2(0.0, 1.0));\n            float d = random(i + vec2(1.0, 1.0));\n\n            // Smooth Interpolation\n\n            // Cubic Hermine Curve.  Same as SmoothStep()\n            vec2 u = f * f * (3.0 - 2.0 * f);\n            // u = smoothstep(0.,1.,f);\n\n            // Mix 4 coorners percentages\n            return mix(a, b, u.x) +\n                    (c - a) * u.y * (1.0 - u.x) +\n                    (d - b) * u.x * u.y;\n        }\n\n        void main(void) {\n            vec2 st = vTextureCoord * vec2(20.0, 20.0); // Scale the texture coordinates\n            vec4 color = texture2D(uSampler, vTextureCoord + vec2(noise(st), noise(st + vec2(time))) * 0.015);\n            gl_FragColor = color;\n        }",{time:0})}},{key:"initEvents",value:function(){window.addEventListener("resize",xt(this.resize,100)),this.application.view.addEventListener("mousemove",this.onMouseMove)}},{key:"checkIdleStatus",value:function(){Date.now()-this.lastMouseMoveTime>(this.isIdle,this.idleTimeout)&&(this.isIdle=!0,this.moveSpotlightToNextWaypoint(),this.lastMouseMoveTime=Date.now())}},{key:"moveSpotlightToNextWaypoint",value:function(){if(this.isIdle){var t=this.getNextWaypoint();Zo.to(this.heatmapMask,{x:t.x/100*this.application.screen.width,y:t.y/100*this.application.screen.height,duration:1.5})}}},{key:"getNextWaypoint",value:function(){return this.waypoints[(this.currentWaypointIndex+1)%this.waypoints.length]}},{key:"initTicker",value:function(){var t=this;this.application.ticker.add((function(e){t.heatmap.filters&&t.heatmap.filters[0]&&(t.heatmap.filters[0].uniforms.time+=e/300),t.checkIdleStatus(),t.checkWaypointProximity()}))}},{key:"checkWaypointProximity",value:function(){var t=this,e=this.waypointRadius/100*this.application.screen.height,i=this.heatmapMask.x,r=this.heatmapMask.y;this.waypoints.forEach((function(n,o){var s=n.x/100*t.application.screen.width,a=n.y/100*t.application.screen.height;Math.sqrt(Math.pow(s-i,2)+Math.pow(a-r,2))<=e?(t.onWaypointReached(o),n.isActivated=!0):(n.isActivated&&t.hideWaypointBox(n,o),n.isActivated=!1)}))}},{key:"onWaypointReached",value:function(t){var e=this.waypoints[t];e.isActivated||(this.currentWaypointIndex=t,this.showWaypointBox(e,t))}},{key:"animationSVG",value:function(t,e){var i=t.el.querySelector(".hover-reveal-component--waypoint--svg"),r=Zo.timeline();switch(t.animation){case"radial":var n=i.querySelector(".animation-radial-inner"),o=n.getTotalLength();return n.style.strokeDasharray=o,n.style.strokeDashoffset=o,r.fromTo(i,{duration:.5,opacity:0,scale:.1,transformOrigin:"0% 50%"},{opacity:1,scale:1}).to(n,{duration:.5,strokeDashoffset:.5*o},"-=0.2"),r;case"curve":var s=i.querySelector(".svg-curve-line"),a=i.querySelector(".svg-curve-bg"),l=s.getTotalLength();return s.style.strokeDasharray=l,s.style.strokeDashoffset=l,r.to(s,{duration:.5,strokeDashoffset:0}).fromTo(a,{duration:.5,opacity:0},{opacity:1},"-=0.2"),r;case"rings":var c=i.querySelector(".svg-rings-1"),u=i.querySelector(".svg-rings-2"),h=i.querySelector(".svg-rings-3"),d=c.getTotalLength(),p=u.getTotalLength(),f=h.getTotalLength();return c.style.strokeDasharray=d,c.style.strokeDashoffset=d,u.style.strokeDasharray=p,u.style.strokeDashoffset=p,h.style.strokeDasharray=f,h.style.strokeDashoffset=f,r.to(t.el,{duration:.4,opacity:1}).to(c,{duration:.5,strokeDashoffset:0},"-=0.3").to(u,{duration:.5,strokeDashoffset:0},"-=0.4").to(h,{duration:.5,strokeDashoffset:0},"-=0.4"),r;case"chart":return r.fromTo(i.querySelectorAll("path"),{duration:.5,opacity:0,scaleY:.1,transformOrigin:"50% 100%"},{opacity:1,scaleY:1,stagger:.15}),r;case"segment":var m=i.querySelectorAll(".svg-animation-segment");return r.fromTo(m,{rotate:-25,opacity:0,transformOrigin:"50% 50%"},{duration:.5,rotate:0,opacity:1,stagger:.15}),r}return!1}},{key:"showWaypointBox",value:function(t,e){t.timeline&&t.timeline.kill(),t.timeline=Zo.timeline(),t.timeline.to(t.el,{duration:.4,opacity:1},0).fromTo(t.el,{duration:.7,scale:.1},{scale:1},0).fromTo(t.el.querySelector("strong"),{duration:.7,y:10,opacity:0},{y:0,opacity:1},.3).fromTo(t.el.querySelector("span"),{duration:.7,y:10,opacity:0},{y:0,opacity:1},.4);var i=this.animationSVG(t,e);i&&t.timeline.add(i,.3)}},{key:"hideWaypointBox",value:function(t,e){t.timeline&&t.timeline.kill(),t.timeline=Zo.timeline(),t.timeline.to(t.el,{duration:.5,opacity:0})}},{key:"resize",value:function(){var t=window.innerWidth;t!==this.sizes.screenWidth&&(this.sizes.screenWidth=t,this.onResize())}},{key:"onResize",value:function(){var t=this;this.sizes.width=this.el.offsetWidth,this.sizes.height=this.el.offsetHeight,this.sizes.heatmapSpotSize=this.sizes.height/4,this.application.renderer.resize(this.sizes.width,this.sizes.height),this.resizeBackground(),this.resizeHeatmap(),this.heatmapMask.width=2*this.sizes.heatmapSpotSize,this.heatmapMask.height=2*this.sizes.heatmapSpotSize,this.heatmapMask.x=this.sizes.width/2,this.heatmapMask.y=this.sizes.height/2,this.waypoints.forEach((function(e){var i=e.circle;i.x=e.x/100*t.application.screen.width,i.y=e.y/100*t.application.screen.height,i.clear(),i.beginFill(16777215),i.drawCircle(0,0,t.waypointRadius/100*t.application.screen.height),i.endFill();var r=e.x/100*t.application.screen.width,n=e.y/100*t.application.screen.height;r+e.el.offsetWidth/2>t.application.screen.width&&(r=t.application.screen.width-e.el.offsetWidth/2-10),r-e.el.offsetWidth/2<10&&(r=e.el.offsetWidth/2+10),n+e.el.offsetHeight/2>t.application.screen.height&&(n=t.application.screen.height-e.el.offsetHeight/2-10),n-e.el.offsetHeight/2<10&&(n=e.el.offsetHeight/2+10),e.el.style.left="".concat(r,"px"),e.el.style.top="".concat(n,"px")}))}},{key:"onMouseMove",value:function(t){this.heatmapMask.x=t.clientX-this.el.offsetLeft+window.scrollX,this.heatmapMask.y=t.clientY-this.el.offsetTop+window.scrollY,this.lastMouseMoveTime=Date.now(),this.isIdle=!1}}])&&By(e.prototype,i),r&&By(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),Uy=i("4ZJM"),Gy=i.n(Uy);i("rG3h");function jy(t){return(jy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Vy(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Xy(r.key),r)}}function Xy(t){var e=function(t,e){if("object"!=jy(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!=jy(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==jy(e)?e:String(e)}var Hy=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.el=e,this.currentWidth=window.innerWidth;var i=this.parseUrlParams();this.init(i)}var e,i,r;return e=t,(i=[{key:"parseUrlParams",value:function(){var t=new URLSearchParams(window.location.search);return{lat:parseFloat(t.get("lat")),lng:parseFloat(t.get("lng")),hectares:parseInt(t.get("ha"),10)}}},{key:"initBindings",value:function(){this.onResize=this.onResize.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onThumbMouseDown=this.onThumbMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onBarClick=this.onBarClick.bind(this)}},{key:"init",value:function(t){this.roundingThreshold=.9,this.bigRoundStep=25,this.initBindings(),this.initTemplates(t),this.initMap(t),this.initUI(),this.calcUI(),this.initMap(),this.initEvents(),this.updateValues()}},{key:"initMap",value:function(t){var e=this;Gy.a.accessToken="pk.eyJ1IjoicGFjaGFtYSIsImEiOiJjam5xbWY4ZW8wOHhpM3FwaHN6azYzMXZzIn0.bGR3tnhiYFvPwVyU0WHjcA",this.map={latitude:t&&t.lat?t.lat:-1.7575,longitude:t&&t.lng?t.lng:-61.99},this.map.map=new Gy.a.Map({container:"credits-yield-calculator--map",style:"".concat("mapbox://styles/pachama/clme6ysll014d01r64u3ba0n2"),center:[this.map.longitude,this.map.latitude],zoom:3}),this.map.map.on("load",(function(){var t=e.map.map.getBounds(),i=t.getNorth()-t.getSouth(),r=e.map.latitude-i/3;e.map.map.setCenter([e.map.longitude,r]);var n=document.createElement("div");n.className="credits-yield-calculator--map-marker";var o=new Gy.a.Marker(n).setLngLat([e.map.longitude,e.map.latitude]).addTo(e.map.map);e.map.map.on("click",(function(t){e.map.longitude=t.lngLat.lng,e.map.latitude=t.lngLat.lat,o.setLngLat([e.map.longitude,e.map.latitude]),e.updateValues()}))}))}},{key:"initTemplates",value:function(t){this.templates={title:"%tons% tons of C02e",text:"from the atmosphere and make a total of %total% in 30 years",highlight:"%hectares% hectare project at %price% USD per hectare"},this.values={tons:0,total:0,hectares:t&&t.hectares?t.hectares:50,price:0}}},{key:"updateUI",value:function(){var t=this.values.tons.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),e=this.values.total.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),i=this.values.price.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");this.title.innerHTML=this.templates.title.replace("%tons%",t),this.text.innerHTML=this.templates.text.replace("%total%",e),this.highlight.innerHTML=this.templates.highlight.replace("%hectares%",this.values.hectares).replace("%price%",i)}},{key:"initUI",value:function(){this.title=this.el.querySelector(".credits-yield-calculator--title"),this.text=this.el.querySelector(".credits-yield-calculator--text"),this.slider=this.el.querySelector(".credits-yield-calculator--slider"),this.sliderInput=this.slider.querySelector(".credits-yield-calculator--input"),this.sliderValue=this.slider.querySelector(".credits-yield-calculator--slider-value"),this.bar=this.el.querySelector(".credits-yield-calculator--bar"),this.progress=this.el.querySelector(".credits-yield-calculator--bar-progress"),this.thumb=this.el.querySelector(".credits-yield-calculator--bar-thumb"),this.highlight=this.el.querySelector(".credits-yield-calculator--highlight"),this.mapEl=this.el.querySelector(".credits-yield-calculator--map"),this.rangeMin=parseInt(this.slider.dataset.rangeMin),this.rangeMax=parseInt(this.slider.dataset.rangeMax),this.isDragging=!1}},{key:"onThumbMouseDown",value:function(t){t.preventDefault(),this.isDragging=!0}},{key:"onMouseMove",value:function(t){this.isDragging&&this.updateThumbPosition(t)}},{key:"updateThumbPosition",value:function(t){var e=this.bar.getBoundingClientRect(),i=(t.clientX||t.touches[0].clientX)-e.left-this.thumbWidthHalf,r=Math.max(0,Math.min(i,this.barWidth-this.thumbWidth)),n=r/this.barWidth,o=r/(this.barWidth-this.thumbWidth);this.updateProgress(n,o)}},{key:"roundProgress",value:function(t){var e=Math.round(t/this.bigRoundStep)*this.bigRoundStep;return Math.abs(e-t)<=this.roundingThreshold?e:Math.round(t)}},{key:"updateProgress",value:function(t,e){var i=e*(this.rangeMax-this.rangeMin)+this.rangeMin;this.sliderInput.value=this.roundProgress(i),this.values.hectares=this.sliderInput.value,this.progress.style.width="".concat(100*(1-t),"%"),this.thumb.style.left="".concat(100*t,"%"),this.updateValues()}},{key:"updateValues",value:function(){var t=this;this.fetchTimeout&&clearTimeout(this.fetchTimeout),this.fetchTimeout=setTimeout((function(){t.fetchEstimate()}),100),this.updateUI()}},{key:"onBarClick",value:function(t){this.isDragging||this.updateThumbPosition(t)}},{key:"onMouseUp",value:function(t){this.isDragging&&(this.isDragging=!1)}},{key:"initEvents",value:function(){this.thumb.addEventListener("mousedown",this.onThumbMouseDown),this.thumb.addEventListener("touchstart",this.onThumbMouseDown),this.slider.addEventListener("click",this.onBarClick),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("touchmove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("touchend",this.onMouseUp),window.addEventListener("resize",this.onResize)}},{key:"onResize",value:function(){this.currentWidth!==window.innerWidth&&(this.currentWidth=window.innerWidth,this.calcUI())}},{key:"calcUI",value:function(){this.thumbWidth=this.thumb.offsetWidth,this.thumbWidthHalf=this.thumbWidth/2,this.barWidth=this.bar.offsetWidth}},{key:"updateUrlParams",value:function(){var t=new URLSearchParams;t.set("lat",this.map.latitude),t.set("lng",this.map.longitude),t.set("ha",this.values.hectares),history.pushState({},"","".concat(location.pathname,"?").concat(t.toString()))}},{key:"fetchEstimate",value:function(){var t=this;this.showLoader(),this.generateAPIRequest().then((function(e){if(t.hideLoader(),e.data&&e.data.qualifyStageYieldEstimate&&"QualifyStageYieldEstimateError"===e.data.qualifyStageYieldEstimate.__typename)e.data.qualifyStageYieldEstimate,t.showNotification("Pachama does not currently support this area");else if(e.data&&e.data.qualifyStageYieldEstimate){var i=e.data.qualifyStageYieldEstimate.expected,r=i[i.length-1],n=t.convertToRevenue(i),o=n[n.length-1],s=o/t.values.hectares;t.values.tons=Math.round(r),t.values.total=100*Math.round(Math.round(o)/100),t.values.price=Math.round(s),t.updateUI(),t.removeNotificationAll(),t.updateUrlParams()}else e.errors&&console.error("GraphQL Error:",e.errors)})).catch((function(e){t.hideLoader(),console.error("API Request Error:",e)}))}},{key:"generateAPIRequest",value:function(){var t={operationName:"GetLocationBasedQualifyStageYieldEstimate",query:"query GetLocationBasedQualifyStageYieldEstimate($input: LocationBasedQualifyStageYieldEstimateInput!) {\n  qualifyStageYieldEstimate(input: $input) {\n    ... on QualifyStageYieldEstimate {\n      conservative\n      expected\n      optimistic\n      __typename\n    }\n    ... on QualifyStageYieldEstimateError {\n      __typename\n      message\n      code\n    }\n    __typename\n  }\n}",variables:{input:{latitude:this.map.latitude,longitude:this.map.longitude,netAreaAvailableForPlantingHa:parseInt(this.values.hectares)}}};return fetch("https://backend.prod.pachama.com/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(t){return t.json()}))}},{key:"convertToRevenue",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,r=1+i/100,n=e;return t.map((function(t,e){return e>0&&(n*=r),t*n}))}},{key:"showNotification",value:function(t){var e=this;if(!document.querySelector(".pachama-error-notification")){var i=document.createElement("div");i.className="pachama-error-notification",i.innerHTML="\n            <strong>Error:</strong>\n            <span>".concat(t,'</span>\n            <button class="close-btn">&times;</button>\n        '),i.querySelector(".close-btn").onclick=function(){e.removeNotification(i)},document.body.appendChild(i),setTimeout((function(){e.removeNotification(i)}),5e3)}}},{key:"removeNotification",value:function(t){t&&t.parentNode&&t.parentNode.removeChild(t)}},{key:"removeNotificationAll",value:function(){document.querySelectorAll(".pachama-error-notification").forEach((function(t){t.parentNode.removeChild(t)}))}},{key:"showLoader",value:function(){this.el.classList.add("calculator-loading")}},{key:"hideLoader",value:function(){this.el.classList.remove("calculator-loading")}}])&&Vy(e.prototype,i),r&&Vy(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function qy(t){return(qy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Wy(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,$y(r.key),r)}}function $y(t){var e=function(t,e){if("object"!=qy(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!=qy(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==qy(e)?e:String(e)}var Yy=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.init()}var e,i,r;return e=t,(i=[{key:"init",value:function(){this.heroScrollAnimation(),this.backgroundDotsAnimation(),this.timeSliderComponent(),this.timelineComponent(),this.hoverRevealComponent(),this.creditsYieldCalculator()}},{key:"heroScrollAnimation",value:function(){var t=document.querySelectorAll(".hero-scroll-animation");t.length>0&&t.forEach((function(t){new tc(t)}))}},{key:"backgroundDotsAnimation",value:function(){var t=document.querySelectorAll(".cta-background-dots-animation");t.length>0&&t.forEach((function(t){new ey(t)}))}},{key:"timeSliderComponent",value:function(){var t=document.querySelectorAll(".time-slider--component");t.length>0&&t.forEach((function(t){new my(t)}))}},{key:"timelineComponent",value:function(){var t=document.querySelectorAll(".timeline-section--component");t.length>0&&t.forEach((function(t){new Oy(t)}))}},{key:"hoverRevealComponent",value:function(){var t=document.querySelectorAll(".hover-reveal-component");t.length>0&&t.forEach((function(t){new Ny(t)}))}},{key:"creditsYieldCalculator",value:function(){var t=document.querySelectorAll(".credits-yield-calculator");t.length>0&&t.forEach((function(t){new Hy(t)}))}}])&&Wy(e.prototype,i),r&&Wy(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),Zy=function(){$("[data-width-mb]").each((function(){var t=$(this),e=$(t).attr("width"),i=$(t).data("width-mb"),r=function(){$(window).width()<768?$(t).attr("width",i):$(t).attr("width",e)};r(),$(window).on("resize orientationchange",r)}))};function Ky(t){return(Ky="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Jy(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,tv(r.key),r)}}function Qy(t,e,i){return e&&Jy(t.prototype,e),i&&Jy(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function tv(t){var e=function(t,e){if("object"!=Ky(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!=Ky(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ky(e)?e:String(e)}var ev=i("lLqN");ev.init("6c03ef565545244e1670bc35ade9ca7d");var iv=Qy((function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var e=2,i=!0,r=!0,n="",o=new Set;function s(t){var e="polygon(0 0, "+t+"% 0, "+t+"% 100%, 0% 100%)";$(".header-progress span").css("clip-path",e)}function a(t){var i=$("#fullpage").html(),r=$("#fullpage").attr("data-page-id");$.ajax({type:"post",dataType:"json",url:wp_ajax.ajaxurl,data:{action:"branch_filter",selection:t,page_id:r},success:function(t){var r=""!==t.html?t.html:'<div class="no-result">No results</div>';$("#fullpage .initial-select").after(r);var n=setInterval((function(){$("#fullpage").html()!==i&&($.fn.fullpage.reBuild(),$.fn.fullpage.moveSectionDown(),Ct(),clearInterval(n),e=$("#fullpage .section").length,$("#option1").removeClass("loading"))}),200)},error:function(t){console.log(JSON.stringify(t))}})}function l(t,e){var i=$(".build-your-portfolio").html(),r=$("#fullpage").attr("data-page-id");$.ajax({type:"post",dataType:"json",url:wp_ajax.ajaxurl,data:{action:"selected_filter",selectedProjects:t,flow:e,page_id:r},success:function(t){var e=""!==t.html?t.html:'<div class="no-result">No results</div>',r=$(e);r.hide(),$(".header-progress").after(r);var n=setInterval((function(){$(".build-your-portfolio").html()!==i&&($("#fullpage").fadeOut(500,(function(){$(this).remove(),Ct(),$(".section").css("pointer-events","all"),$("#header").css("position","sticky"),$(".header-progress").css("position","sticky"),$(".header-progress").css("z-index","998"),r.fadeIn(500,(function(){$.fn.fullpage.destroy("all")})),$("#footer").fadeIn(500)})),clearInterval(n))}),100)},error:function(t){console.log(JSON.stringify(t))}})}$("#fullpage").hide(),$("#footer").hide(),$(document).ready((function(){var t=localStorage.getItem("selectedProjects");t?l(t=JSON.parse(t),"all"):($("#fullpage").show(),$("#footer").show())})),$("#fullpage").fullpage({licenseKey:"YOUR_LICENSE_KEY_HERE",navigation:!1,navigationPosition:"right",scrollOverflow:!0,afterLoad:function(t,e){if(r=$(".section.active input").filter((function(){return!$(this).prop("checked")})).length===$(".section.active input").length,$(".section.active").hasClass("submitt-section")?fullpage_api.setAllowScrolling(!1,"down"):$(".section.active").hasClass("initial-select")?i?fullpage_api.setAllowScrolling(!1,"down"):fullpage_api.setAllowScrolling(!0,"down"):e.index&&r?fullpage_api.setAllowScrolling(!1,"down"):fullpage_api.setAllowScrolling(!0,"down"),$(".section.active").hasClass("initial-select"))n="Scroll - When do you need carbon credits?";else if($(".section.active").hasClass("slider-form"))n="Scroll - Project Slider";else if($(".section.active").hasClass("basic-form")){var s=$(".section.active.basic-form .options-box .title").text();n="Scroll - "+s}else $(".section.active").hasClass("submitt-section")&&(n="Scroll - Submit Section");o.has(e.index)||(ev.track(n),o.add(e.index))},onLeave:function(t,i,r){($(".fp-watermark").hide(),e>2&&0!==i.index)?s(i.index/(e-1)*100):0==i.index?s(0):1==i.index?s(20):s(40)}}),$("#start").on("click",(function(t){t.preventDefault(),$.fn.fullpage.moveSectionDown(),$.fn.fullpage.setAllowScrolling(!0,"up")})),$("#option1").on("click",(function(t){t.preventDefault();var e=$('input[type="checkbox"]:checked'),r=$("#short-term").is(":checked"),n=$("#mid-term").is(":checked"),o=$("#long-term").is(":checked");1===e.length?($(this).addClass("loading"),r||n?a("short-term"):o&&a("mid-term"),i=!1):e.length>1&&($(this).addClass("loading"),r&&n&&!o?a("short-term"):(a("long-term"),i=!1))})),$(document).on("click",".btn-submit",(function(t){t.preventDefault(),$(this).closest(".btm-row").find(".swiper-wrapper").find('input[type="checkbox"]:checked').length>0&&$.fn.fullpage.moveSectionDown()})),$(document).on("click",".btn-next",(function(t){t.preventDefault();var e=$(this).closest(".inner").find(".options-box");e.find('input[type="checkbox"]:checked').length>0&&$.fn.fullpage.moveSectionDown(),e.find('input[type="radio"]:checked').length>0&&$.fn.fullpage.moveSectionDown()})),$(document).on("click",".submitt-btn",(function(t){t.preventDefault();var e=$(".input").val();if(/^[^\s@]+@[^\s@]+\.[a-zA-Z]{2,}$/.test(e)){$(this).addClass("loading");var i=[],r="";r=$(".swiper-container").hasClass("flow_1")?"flow_1":$(".swiper-container").hasClass("flow_2")?"flow_2":"flow_3",$('.swiper-slide input[type="checkbox"]:checked').each((function(){i.push($(this).attr("id"))})),localStorage.setItem("selectedProjects",JSON.stringify(i)),!function(t,e){var i=new FormData,r=function(e){t.hasOwnProperty(e)&&(Array.isArray(t[e])?t[e].forEach((function(t){i.append(e,t)})):i.append(e,t[e]))};for(var n in t)r(n);fetch("https://forms.hubspot.com/uploads/form/v2/21158180/ff8dd592-eb38-4006-aa09-7fe1d8b1a1a2",{method:"POST",body:i})}(function(){var t=[];$(".options-box").each((function(){var e=[],i=$(this),r=i.data("hubspot");i.find('> ul.check-list input[type="checkbox"]:checked').each((function(){e.push($(this).closest("label").find(".fake-label").text())})),i.find('> ul.check-list input[type="radio"]:checked').each((function(){e.push($(this).closest("label").find(".fake-label").text())})),e.length>0&&(t[r]=e)})),$(".btm-row").each((function(){var e=[],i=$(this).find(".card-project"),r=$(this).data("hubspot");i.find('input[type="checkbox"]:checked').each((function(){e.push($(this).closest(".card-project").find(".top h4").text())})),e.length>0&&(t[r]=e)}));var e=$('.options-box input[type="email"]').val();return t.recent_user_business_type="Enterprise",t.recent_user_intention="Buyer",t.recent_conversion_type="Information Request",t.email=e,t}()),l(i,r),ev.track("Project Design Landing Form Submitted")}else $(".mail-error").show()})),$(document).on("change",'.checkbox-label input[type="checkbox"], .check-label input[type="checkbox"]',(function(){(r=$(".section.active input").filter((function(){return!$(this).prop("checked")})).length===$(".section.active input").length)?$.fn.fullpage.setAllowScrolling(!1,"down"):$.fn.fullpage.setAllowScrolling(!0,"down")})),$(document).on("change",'.check-label input[type="radio"]',(function(){(r=$(".section.active input").filter((function(){return!$(this).prop("checked")})).length===$(".section.active input").length)?$.fn.fullpage.setAllowScrolling(!1,"down"):$.fn.fullpage.setAllowScrolling(!0,"down")})),$(document).on("change",'.check-list-initial input[type="checkbox"]',(function(){i=!0,$.fn.fullpage.setAllowScrolling(!1,"down"),$(".initial-select").nextAll(".selection-area").remove()})),$(document).keypress((function(t){var e=$(".section.active .btn-green");"Enter"!==t.key&&13!==t.keyCode||(t.preventDefault(),e.click())}))}));function rv(t){return(rv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function nv(){nv=function(){return e};var t,e={},i=Object.prototype,r=i.hasOwnProperty,n=Object.defineProperty||function(t,e,i){t[e]=i.value},o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,i){return t[e]=i}}function u(t,e,i,r){var o=e&&e.prototype instanceof g?e:g,s=Object.create(o.prototype),a=new C(r||[]);return n(s,"_invoke",{value:S(t,i,a)}),s}function h(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var d="suspendedStart",p="executing",f="completed",m={};function g(){}function _(){}function y(){}var v={};c(v,s,(function(){return this}));var x=Object.getPrototypeOf,b=x&&x(x(P([])));b&&b!==i&&r.call(b,s)&&(v=b);var w=y.prototype=g.prototype=Object.create(v);function T(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function i(n,o,s,a){var l=h(t[n],t,o);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==rv(u)&&r.call(u,"__await")?e.resolve(u.__await).then((function(t){i("next",t,s,a)}),(function(t){i("throw",t,s,a)})):e.resolve(u).then((function(t){c.value=t,s(c)}),(function(t){return i("throw",t,s,a)}))}a(l.arg)}var o;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){i(t,r,e,n)}))}return o=o?o.then(n,n):n()}})}function S(e,i,r){var n=d;return function(o,s){if(n===p)throw new Error("Generator is already running");if(n===f){if("throw"===o)throw s;return{value:t,done:!0}}for(r.method=o,r.arg=s;;){var a=r.delegate;if(a){var l=A(a,r);if(l){if(l===m)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===d)throw n=f,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=p;var c=h(e,i,r);if("normal"===c.type){if(n=r.done?f:"suspendedYield",c.arg===m)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=f,r.method="throw",r.arg=c.arg)}}}function A(e,i){var r=i.method,n=e.iterator[r];if(n===t)return i.delegate=null,"throw"===r&&e.iterator.return&&(i.method="return",i.arg=t,A(e,i),"throw"===i.method)||"return"!==r&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var o=h(n,e.iterator,i.arg);if("throw"===o.type)return i.method="throw",i.arg=o.arg,i.delegate=null,m;var s=o.arg;return s?s.done?(i[e.resultName]=s.value,i.next=e.nextLoc,"return"!==i.method&&(i.method="next",i.arg=t),i.delegate=null,m):s:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,m)}function M(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(M,this),this.reset(!0)}function P(e){if(e||""===e){var i=e[s];if(i)return i.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function i(){for(;++n<e.length;)if(r.call(e,n))return i.value=e[n],i.done=!1,i;return i.value=t,i.done=!0,i};return o.next=o}}throw new TypeError(rv(e)+" is not iterable")}return _.prototype=y,n(w,"constructor",{value:y,configurable:!0}),n(y,"constructor",{value:_,configurable:!0}),_.displayName=c(y,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,c(t,l,"GeneratorFunction")),t.prototype=Object.create(w),t},e.awrap=function(t){return{__await:t}},T(E.prototype),c(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,i,r,n,o){void 0===o&&(o=Promise);var s=new E(u(t,i,r,n),o);return e.isGeneratorFunction(i)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},T(w),c(w,l,"Generator"),c(w,s,(function(){return this})),c(w,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),i=[];for(var r in e)i.push(r);return i.reverse(),function t(){for(;i.length;){var r=i.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=P,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var i in this)"t"===i.charAt(0)&&r.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function n(r,n){return a.type="throw",a.arg=e,i.next=r,n&&(i.method="next",i.arg=t),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return n("end");if(s.tryLoc<=this.prev){var l=r.call(s,"catchLoc"),c=r.call(s,"finallyLoc");if(l&&c){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(l){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return n(s.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=e,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),I(i),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var r=i.completion;if("throw"===r.type){var n=r.arg;I(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,i,r){return this.delegate={iterator:P(e),resultName:i,nextLoc:r},"next"===this.method&&(this.arg=t),m}},e}function ov(t,e,i,r,n,o,s){try{var a=t[o](s),l=a.value}catch(t){return void i(t)}a.done?e(l):Promise.resolve(l).then(r,n)}function sv(t){return function(){var e=this,i=arguments;return new Promise((function(r,n){var o=t.apply(e,i);function s(t){ov(o,r,n,s,a,"next",t)}function a(t){ov(o,r,n,s,a,"throw",t)}s(void 0)}))}}function av(){var t=localStorage.getItem("zoominfo_expiration");if(!t)return!1;var e=new Date(parseInt(t));return new Date<e&&localStorage.getItem("zoominfo_data")}function lv(){return cv.apply(this,arguments)}function cv(){return(cv=sv(nv().mark((function t(){var e,i,r;return nv().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("/wp-json/api/v1/enrich",{method:"GET",headers:{"Content-Type":"application/json"}});case 3:if((e=t.sent).ok){t.next=6;break}throw new Error("HTTP error! status: ".concat(e.status));case 6:return t.next=8,e.json();case 8:return i=t.sent,localStorage.setItem("zoominfo_data",JSON.stringify(i)),r=(new Date).getTime()+12096e5,localStorage.setItem("zoominfo_expiration",r.toString()),t.abrupt("return",i);case 15:return t.prev=15,t.t0=t.catch(0),console.error("Error fetching ZoomInfo data:",t.t0),t.abrupt("return",null);case 19:case"end":return t.stop()}}),t,null,[[0,15]])})))).apply(this,arguments)}function uv(){return(uv=sv(nv().mark((function t(){return nv().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(av()){t.next=3;break}return t.next=3,lv();case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var hv=function(){!function(){uv.apply(this,arguments)}()};function dv(t){return(dv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function pv(){pv=function(){return e};var t,e={},i=Object.prototype,r=i.hasOwnProperty,n=Object.defineProperty||function(t,e,i){t[e]=i.value},o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,i){return t[e]=i}}function u(t,e,i,r){var o=e&&e.prototype instanceof g?e:g,s=Object.create(o.prototype),a=new C(r||[]);return n(s,"_invoke",{value:S(t,i,a)}),s}function h(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var d="suspendedStart",p="executing",f="completed",m={};function g(){}function _(){}function y(){}var v={};c(v,s,(function(){return this}));var x=Object.getPrototypeOf,b=x&&x(x(P([])));b&&b!==i&&r.call(b,s)&&(v=b);var w=y.prototype=g.prototype=Object.create(v);function T(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function i(n,o,s,a){var l=h(t[n],t,o);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==dv(u)&&r.call(u,"__await")?e.resolve(u.__await).then((function(t){i("next",t,s,a)}),(function(t){i("throw",t,s,a)})):e.resolve(u).then((function(t){c.value=t,s(c)}),(function(t){return i("throw",t,s,a)}))}a(l.arg)}var o;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){i(t,r,e,n)}))}return o=o?o.then(n,n):n()}})}function S(e,i,r){var n=d;return function(o,s){if(n===p)throw new Error("Generator is already running");if(n===f){if("throw"===o)throw s;return{value:t,done:!0}}for(r.method=o,r.arg=s;;){var a=r.delegate;if(a){var l=A(a,r);if(l){if(l===m)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===d)throw n=f,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=p;var c=h(e,i,r);if("normal"===c.type){if(n=r.done?f:"suspendedYield",c.arg===m)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=f,r.method="throw",r.arg=c.arg)}}}function A(e,i){var r=i.method,n=e.iterator[r];if(n===t)return i.delegate=null,"throw"===r&&e.iterator.return&&(i.method="return",i.arg=t,A(e,i),"throw"===i.method)||"return"!==r&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var o=h(n,e.iterator,i.arg);if("throw"===o.type)return i.method="throw",i.arg=o.arg,i.delegate=null,m;var s=o.arg;return s?s.done?(i[e.resultName]=s.value,i.next=e.nextLoc,"return"!==i.method&&(i.method="next",i.arg=t),i.delegate=null,m):s:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,m)}function M(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(M,this),this.reset(!0)}function P(e){if(e||""===e){var i=e[s];if(i)return i.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function i(){for(;++n<e.length;)if(r.call(e,n))return i.value=e[n],i.done=!1,i;return i.value=t,i.done=!0,i};return o.next=o}}throw new TypeError(dv(e)+" is not iterable")}return _.prototype=y,n(w,"constructor",{value:y,configurable:!0}),n(y,"constructor",{value:_,configurable:!0}),_.displayName=c(y,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,c(t,l,"GeneratorFunction")),t.prototype=Object.create(w),t},e.awrap=function(t){return{__await:t}},T(E.prototype),c(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,i,r,n,o){void 0===o&&(o=Promise);var s=new E(u(t,i,r,n),o);return e.isGeneratorFunction(i)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},T(w),c(w,l,"Generator"),c(w,s,(function(){return this})),c(w,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),i=[];for(var r in e)i.push(r);return i.reverse(),function t(){for(;i.length;){var r=i.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=P,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var i in this)"t"===i.charAt(0)&&r.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function n(r,n){return a.type="throw",a.arg=e,i.next=r,n&&(i.method="next",i.arg=t),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return n("end");if(s.tryLoc<=this.prev){var l=r.call(s,"catchLoc"),c=r.call(s,"finallyLoc");if(l&&c){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(l){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return n(s.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=e,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),I(i),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var r=i.completion;if("throw"===r.type){var n=r.arg;I(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,i,r){return this.delegate={iterator:P(e),resultName:i,nextLoc:r},"next"===this.method&&(this.arg=t),m}},e}function fv(t,e,i,r,n,o,s){try{var a=t[o](s),l=a.value}catch(t){return void i(t)}a.done?e(l):Promise.resolve(l).then(r,n)}function mv(t){return function(){var e=this,i=arguments;return new Promise((function(r,n){var o=t.apply(e,i);function s(t){fv(o,r,n,s,a,"next",t)}function a(t){fv(o,r,n,s,a,"throw",t)}s(void 0)}))}}var gv="hubspot_info",_v=864e5,yv="/wp-json/pachama/v1/hubspot-contact",vv=function(){for(var t=document.cookie.split(";"),e=0;e<t.length;e++){var i=t[e].trim();if(i.startsWith("hubspotutk="))return i.substring("hubspotutk=".length)}return null},xv=function(){var t=mv(pv().mark((function t(){var e,i,r;return pv().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=vv()){t.next=3;break}return t.abrupt("return",null);case 3:return t.prev=3,t.next=6,fetch(yv,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hubspotutk:e}),credentials:"same-origin"});case 6:if((i=t.sent).ok){t.next=9;break}return t.abrupt("return",null);case 9:return t.next=11,i.json();case 11:if(!(r=t.sent).error){t.next=14;break}return t.abrupt("return",null);case 14:return t.abrupt("return",r);case 17:return t.prev=17,t.t0=t.catch(3),t.abrupt("return",null);case 20:case"end":return t.stop()}}),t,null,[[3,17]])})));return function(){return t.apply(this,arguments)}}(),bv=function(t){if(t)try{var e={data:t,expiry:(new Date).getTime()+_v};localStorage.setItem(gv,JSON.stringify(e))}catch(t){}},wv=function(){try{var t=localStorage.getItem(gv);if(!t)return null;var e=JSON.parse(t),i=e.data,r=e.expiry;return(new Date).getTime()>r?(localStorage.removeItem(gv),null):i}catch(t){try{localStorage.removeItem(gv)}catch(t){}return null}},Tv=function(){var t=mv(pv().mark((function t(){var e,i;return pv().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e=wv())){t.next=3;break}return t.abrupt("return",e);case 3:return t.next=5,xv();case 5:return(i=t.sent)&&bv(i),t.abrupt("return",i);case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Ev=function(){var t=mv(pv().mark((function t(){var e,i;return pv().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Tv();case 2:if((e=t.sent)&&e.properties){t.next=5;break}return t.abrupt("return",null);case 5:return i=e.properties.sfdc_person_id_calculation||null,t.abrupt("return",{hubspot_contact_id:e.contact_id,salesforceAccountId:e.properties.salesforceaccountid||null,salesforce_contact_id:i,salesforce_lead_id:i});case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Sv=function(){var t=mv(pv().mark((function t(){return pv().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Ev();case 3:t.next=7;break;case 5:t.prev=5,t.t0=t.catch(0);case 7:case"end":return t.stop()}}),t,null,[[0,5]])})));return function(){return t.apply(this,arguments)}}();$(document).ready((function(t){var e;document.body.classList.add("no-scroll"),setTimeout((function(){var t=document.querySelector("#page-loader");t.style.transition="opacity 0.2s",t.style.opacity="0",setTimeout((function(){t.style.display="none",document.body.classList.remove("no-scroll")}),200)}),500),Bt(),Tt(),window.addEventListener("resize",(function(){var t=document.querySelector("body");t.classList.contains("resize-active")||t.classList.add("resize-active"),setTimeout((function(){t.classList.remove("resize-active")}),500)})),St(),Mt(),At(),It(),Ct(),Pt(),Rt(),Xt(),(e=document.querySelectorAll(".video-frame"))&&Array.from(e).forEach((function(t){var e=t.querySelector(".video");if(e){var i=t.querySelector(".video-control");i&&i.addEventListener("click",(function(t){t.preventDefault(),i.classList.toggle("playing"),i.classList.contains("playing")?(e.play(),e.classList.add("active")):(e.pause(),e.classList.remove("active"))})),e.addEventListener("ended",(function(){i.classList.remove("playing")}))}})),vt.init(),Ot(),Lt(),Dt(),Wt(),qt(),Ht(),ee(),kt(),new Yy,Ft(),Et(),zt(),Nt(),Zy(),jt(),hv(),t("#fullpage").length&&new iv,Vt(),Sv()}))},nmq7:function(t,e,i){"use strict";var r=i("0jNN"),n=Object.prototype.hasOwnProperty,o=Array.isArray,s={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:r.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(t){return t.replace(/&#(\d+);/g,(function(t,e){return String.fromCharCode(parseInt(e,10))}))},l=function(t,e){return t&&"string"==typeof t&&e.comma&&t.indexOf(",")>-1?t.split(","):t},c=function(t,e,i,r){if(t){var o=i.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,s=/(\[[^[\]]*])/g,a=i.depth>0&&/(\[[^[\]]*])/.exec(o),c=a?o.slice(0,a.index):o,u=[];if(c){if(!i.plainObjects&&n.call(Object.prototype,c)&&!i.allowPrototypes)return;u.push(c)}for(var h=0;i.depth>0&&null!==(a=s.exec(o))&&h<i.depth;){if(h+=1,!i.plainObjects&&n.call(Object.prototype,a[1].slice(1,-1))&&!i.allowPrototypes)return;u.push(a[1])}return a&&u.push("["+o.slice(a.index)+"]"),function(t,e,i,r){for(var n=r?e:l(e,i),o=t.length-1;o>=0;--o){var s,a=t[o];if("[]"===a&&i.parseArrays)s=[].concat(n);else{s=i.plainObjects?Object.create(null):{};var c="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,u=parseInt(c,10);i.parseArrays||""!==c?!isNaN(u)&&a!==c&&String(u)===c&&u>=0&&i.parseArrays&&u<=i.arrayLimit?(s=[])[u]=n:"__proto__"!==c&&(s[c]=n):s={0:n}}n=s}return n}(u,e,i,r)}};t.exports=function(t,e){var i=function(t){if(!t)return s;if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=void 0===t.charset?s.charset:t.charset;return{allowDots:void 0===t.allowDots?s.allowDots:!!t.allowDots,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:s.allowPrototypes,allowSparse:"boolean"==typeof t.allowSparse?t.allowSparse:s.allowSparse,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:s.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:s.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:s.comma,decoder:"function"==typeof t.decoder?t.decoder:s.decoder,delimiter:"string"==typeof t.delimiter||r.isRegExp(t.delimiter)?t.delimiter:s.delimiter,depth:"number"==typeof t.depth||!1===t.depth?+t.depth:s.depth,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:s.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:s.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:s.plainObjects,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:s.strictNullHandling}}(e);if(""===t||null==t)return i.plainObjects?Object.create(null):{};for(var u="string"==typeof t?function(t,e){var i,c={__proto__:null},u=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,h=e.parameterLimit===1/0?void 0:e.parameterLimit,d=u.split(e.delimiter,h),p=-1,f=e.charset;if(e.charsetSentinel)for(i=0;i<d.length;++i)0===d[i].indexOf("utf8=")&&("utf8=%E2%9C%93"===d[i]?f="utf-8":"utf8=%26%2310003%3B"===d[i]&&(f="iso-8859-1"),p=i,i=d.length);for(i=0;i<d.length;++i)if(i!==p){var m,g,_=d[i],y=_.indexOf("]="),v=-1===y?_.indexOf("="):y+1;-1===v?(m=e.decoder(_,s.decoder,f,"key"),g=e.strictNullHandling?null:""):(m=e.decoder(_.slice(0,v),s.decoder,f,"key"),g=r.maybeMap(l(_.slice(v+1),e),(function(t){return e.decoder(t,s.decoder,f,"value")}))),g&&e.interpretNumericEntities&&"iso-8859-1"===f&&(g=a(g)),_.indexOf("[]=")>-1&&(g=o(g)?[g]:g),n.call(c,m)?c[m]=r.combine(c[m],g):c[m]=g}return c}(t,i):t,h=i.plainObjects?Object.create(null):{},d=Object.keys(u),p=0;p<d.length;++p){var f=d[p],m=c(f,u[f],i,"string"==typeof t);h=r.merge(h,m,i)}return!0===i.allowSparse?h:r.compact(h)}},oh6g:function(t,e,i){"use strict";function r(t,e){this.name="AggregateError",this.errors=t,this.message=e||""}r.prototype=Error.prototype,e.a=function(t){var e=this;return new e((function(i,n){if(!t||void 0===t.length)return n(new TypeError("Promise.any accepts an array"));var o=Array.prototype.slice.call(t);if(0===o.length)return n();for(var s=[],a=0;a<o.length;a++)try{e.resolve(o[a]).then(i).catch((function(t){s.push(t),s.length===o.length&&n(new r(s,"All promises were rejected"))}))}catch(t){n(t)}}))}},rG3h:function(t,e,i){var r=i("w0Qo");"string"==typeof r&&(r=[[t.i,r,""]]);var n={hmr:!0,transform:void 0,insertInto:void 0};i("aET+")(r,n);r.locals&&(t.exports=r.locals)},sxOR:function(t,e,i){"use strict";var r=String.prototype.replace,n=/%20/g,o="RFC1738",s="RFC3986";t.exports={default:s,formatters:{RFC1738:function(t){return r.call(t,n,"+")},RFC3986:function(t){return String(t)}},RFC1738:o,RFC3986:s}},tQ2B:function(t,e,i){"use strict";var r=i("xTJ+"),n=i("Rn+g"),o=i("eqyj"),s=i("MLWZ"),a=i("g7np"),l=i("w0Vi"),c=i("OTTw"),u=i("LYNF");t.exports=function(t){return new Promise((function(e,i){var h=t.data,d=t.headers,p=t.responseType;r.isFormData(h)&&delete d["Content-Type"];var f=new XMLHttpRequest;if(t.auth){var m=t.auth.username||"",g=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";d.Authorization="Basic "+btoa(m+":"+g)}var _=a(t.baseURL,t.url);function y(){if(f){var r="getAllResponseHeaders"in f?l(f.getAllResponseHeaders()):null,o={data:p&&"text"!==p&&"json"!==p?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:r,config:t,request:f};n(e,i,o),f=null}}if(f.open(t.method.toUpperCase(),s(_,t.params,t.paramsSerializer),!0),f.timeout=t.timeout,"onloadend"in f?f.onloadend=y:f.onreadystatechange=function(){f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))&&setTimeout(y)},f.onabort=function(){f&&(i(u("Request aborted",t,"ECONNABORTED",f)),f=null)},f.onerror=function(){i(u("Network Error",t,null,f)),f=null},f.ontimeout=function(){var e="timeout of "+t.timeout+"ms exceeded";t.timeoutErrorMessage&&(e=t.timeoutErrorMessage),i(u(e,t,t.transitional&&t.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",f)),f=null},r.isStandardBrowserEnv()){var v=(t.withCredentials||c(_))&&t.xsrfCookieName?o.read(t.xsrfCookieName):void 0;v&&(d[t.xsrfHeaderName]=v)}"setRequestHeader"in f&&r.forEach(d,(function(t,e){void 0===h&&"content-type"===e.toLowerCase()?delete d[e]:f.setRequestHeader(e,t)})),r.isUndefined(t.withCredentials)||(f.withCredentials=!!t.withCredentials),p&&"json"!==p&&(f.responseType=t.responseType),"function"==typeof t.onDownloadProgress&&f.addEventListener("progress",t.onDownloadProgress),"function"==typeof t.onUploadProgress&&f.upload&&f.upload.addEventListener("progress",t.onUploadProgress),t.cancelToken&&t.cancelToken.promise.then((function(t){f&&(f.abort(),i(t),f=null)})),h||(h=null),f.send(h)}))}},"u+OR":function(t,e,i){var r=i("PMrG");"string"==typeof r&&(r=[[t.i,r,""]]);var n={hmr:!0,transform:void 0,insertInto:void 0};i("aET+")(r,n);r.locals&&(t.exports=r.locals)},vDqi:function(t,e,i){t.exports=i("zuR4")},w0Qo:function(t,e,i){(t.exports=i("I1BE")(!1)).push([t.i,".mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgb(0 0 0/0)}.mapboxgl-canvas{left:0;position:absolute;top:0}.mapboxgl-map:-webkit-full-screen{height:100%;width:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:grab;-webkit-user-select:none;-moz-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{pointer-events:none;position:absolute;z-index:2}.mapboxgl-ctrl-top-left{left:0;top:0}.mapboxgl-ctrl-top-right{right:0;top:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{bottom:0;right:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{float:left;margin:10px 0 0 10px}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{float:right;margin:10px 10px 0 0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{float:left;margin:0 0 10px 10px}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{float:right;margin:0 10px 10px 0}.mapboxgl-ctrl-group{background:#fff;border-radius:4px}.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{background-color:transparent;border:0;box-sizing:border-box;cursor:pointer;display:block;height:29px;outline:none;overflow:hidden;padding:0;width:29px}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{background-position:50%;background-repeat:no-repeat;display:block;height:100%;width:100%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl-group button:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:only-child{border-radius:inherit}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgb(0 0 0/5%)}.mapboxgl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath id='south' d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath id='south' d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 29 29'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath id='south' d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' fill='%23f00'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' fill='%23f00'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23000'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' fill='%23f00'/%3E%3C/svg%3E\")}}@keyframes mapboxgl-spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd' viewBox='0 0 88 23'%3E%3Cdefs%3E%3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='clip'%3E%3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/mask%3E%3Cg id='outline' opacity='0.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E%3C/g%3E%3Cg id='fill' opacity='0.9' fill='%23fff'%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/g%3E%3C/svg%3E\");background-repeat:no-repeat;cursor:pointer;display:block;height:23px;margin:0 0 -4px -4px;overflow:hidden;width:88px}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd' viewBox='0 0 88 23'%3E%3Cdefs%3E%3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='clip'%3E%3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/mask%3E%3Cg id='outline' opacity='1' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E%3C/g%3E%3Cg id='fill' opacity='1' fill='%23fff'%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/g%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd' viewBox='0 0 88 23'%3E%3Cdefs%3E%3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='clip'%3E%3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/mask%3E%3Cg id='outline' opacity='1' stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E%3C/g%3E%3Cg id='fill' opacity='1' fill='%23000'%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/g%3E%3C/svg%3E\")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{background-color:hsla(0,0%,100%,.5);margin:0;padding:0 5px}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{background-color:#fff;border-radius:12px;box-sizing:content-box;margin:10px;min-height:20px;padding:2px 24px 2px 0;position:relative}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{border-radius:12px;padding:2px 8px 2px 28px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{background-color:hsla(0,0%,100%,.5);background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E\");border:0;border-radius:12px;box-sizing:border-box;cursor:pointer;display:none;height:24px;outline:none;position:absolute;right:0;top:0;width:24px}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgb(0 0 0/5%)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{right:0;top:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{left:0;top:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E\")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);border:2px solid #333;border-top:#333;box-sizing:border-box;color:#333;font-size:10px;padding:0 5px;white-space:nowrap}.mapboxgl-popup{display:flex;left:0;pointer-events:none;position:absolute;top:0;will-change:transform}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{flex-direction:column-reverse}.mapboxgl-popup-anchor-left{flex-direction:row}.mapboxgl-popup-anchor-right{flex-direction:row-reverse}.mapboxgl-popup-tip{border:10px solid transparent;height:0;width:0;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{align-self:center;border-bottom-color:#fff;border-top:none}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{align-self:flex-start;border-bottom-color:#fff;border-left:none;border-top:none}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{align-self:flex-end;border-bottom-color:#fff;border-right:none;border-top:none}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{align-self:center;border-left-color:#fff;border-right:none}.mapboxgl-popup-close-button{background-color:transparent;border:0;border-radius:0 3px 0 0;cursor:pointer;position:absolute;right:0;top:0}.mapboxgl-popup-close-button:hover{background-color:rgb(0 0 0/5%)}.mapboxgl-popup-content{background:#fff;border-radius:3px;box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto;position:relative}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{left:0;opacity:1;position:absolute;top:0;transition:opacity .2s;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;border-radius:50%;height:15px;width:15px}.mapboxgl-user-location-dot:before{animation:mapboxgl-user-location-dot-pulse 2s infinite;content:\"\";position:absolute}.mapboxgl-user-location-dot:after{border:2px solid #fff;border-radius:50%;box-shadow:0 0 3px rgba(0,0,0,.35);box-sizing:border-box;content:\"\";height:19px;left:-2px;position:absolute;top:-2px;width:19px}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading{height:0;width:0}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:after,.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:before{border-bottom:7.5px solid #4aa1eb;content:\"\";position:absolute}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:before{border-left:7.5px solid transparent;transform:translateY(-28px) skewY(-20deg)}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:after{border-right:7.5px solid transparent;transform:translate(7.5px,-28px) skewY(20deg)}@keyframes mapboxgl-user-location-dot-pulse{0%{opacity:1;transform:scale(1)}70%{opacity:0;transform:scale(3)}to{opacity:0;transform:scale(1)}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:#1da1f233;border-radius:100%;height:1px;width:1px}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{background:#fff;border:2px dotted #202020;height:0;left:0;opacity:.5;position:absolute;top:0;width:0}@media print{.mapbox-improve-map{display:none}}.mapboxgl-scroll-zoom-blocker,.mapboxgl-touch-pan-blocker{align-items:center;background:rgba(0,0,0,.7);color:#fff;display:flex;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif;height:100%;justify-content:center;left:0;opacity:0;pointer-events:none;position:absolute;text-align:center;top:0;transition:opacity .75s ease-in-out;transition-delay:1s;width:100%}.mapboxgl-scroll-zoom-blocker-show,.mapboxgl-touch-pan-blocker-show{opacity:1;transition:opacity .1s ease-in-out}.mapboxgl-canvas-container.mapboxgl-touch-pan-blocker-override.mapboxgl-scrollable-page,.mapboxgl-canvas-container.mapboxgl-touch-pan-blocker-override.mapboxgl-scrollable-page .mapboxgl-canvas{touch-action:pan-x pan-y}",""])},w0Vi:function(t,e,i){"use strict";var r=i("xTJ+"),n=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];t.exports=function(t){var e,i,o,s={};return t?(r.forEach(t.split("\n"),(function(t){if(o=t.indexOf(":"),e=r.trim(t.substr(0,o)).toLowerCase(),i=r.trim(t.substr(o+1)),e){if(s[e]&&n.indexOf(e)>=0)return;s[e]="set-cookie"===e?(s[e]?s[e]:[]).concat([i]):s[e]?s[e]+", "+i:i}})),s):s}},xAGQ:function(t,e,i){"use strict";var r=i("xTJ+"),n=i("JEQr");t.exports=function(t,e,i){var o=this||n;return r.forEach(i,(function(i){t=i.call(o,t,e)})),t}},"xTJ+":function(t,e,i){"use strict";var r=i("HSsa"),n=Object.prototype.toString;function o(t){return"[object Array]"===n.call(t)}function s(t){return void 0===t}function a(t){return null!==t&&"object"==typeof t}function l(t){if("[object Object]"!==n.call(t))return!1;var e=Object.getPrototypeOf(t);return null===e||e===Object.prototype}function c(t){return"[object Function]"===n.call(t)}function u(t,e){if(null!=t)if("object"!=typeof t&&(t=[t]),o(t))for(var i=0,r=t.length;i<r;i++)e.call(null,t[i],i,t);else for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.call(null,t[n],n,t)}t.exports={isArray:o,isArrayBuffer:function(t){return"[object ArrayBuffer]"===n.call(t)},isBuffer:function(t){return null!==t&&!s(t)&&null!==t.constructor&&!s(t.constructor)&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)},isFormData:function(t){return"undefined"!=typeof FormData&&t instanceof FormData},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&t.buffer instanceof ArrayBuffer},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:a,isPlainObject:l,isUndefined:s,isDate:function(t){return"[object Date]"===n.call(t)},isFile:function(t){return"[object File]"===n.call(t)},isBlob:function(t){return"[object Blob]"===n.call(t)},isFunction:c,isStream:function(t){return a(t)&&c(t.pipe)},isURLSearchParams:function(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:u,merge:function t(){var e={};function i(i,r){l(e[r])&&l(i)?e[r]=t(e[r],i):l(i)?e[r]=t({},i):o(i)?e[r]=i.slice():e[r]=i}for(var r=0,n=arguments.length;r<n;r++)u(arguments[r],i);return e},extend:function(t,e,i){return u(e,(function(e,n){t[n]=i&&"function"==typeof e?r(e,i):e})),t},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},stripBOM:function(t){return 65279===t.charCodeAt(0)&&(t=t.slice(1)),t}}},yK9s:function(t,e,i){"use strict";var r=i("xTJ+");t.exports=function(t,e){r.forEach(t,(function(i,r){r!==e&&r.toUpperCase()===e.toUpperCase()&&(t[e]=i,delete t[r])}))}},yLpj:function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},zuR4:function(t,e,i){"use strict";var r=i("xTJ+"),n=i("HSsa"),o=i("CgaS"),s=i("SntB");function a(t){var e=new o(t),i=n(o.prototype.request,e);return r.extend(i,o.prototype,e),r.extend(i,e),i}var l=a(i("JEQr"));l.Axios=o,l.create=function(t){return a(s(l.defaults,t))},l.Cancel=i("endd"),l.CancelToken=i("jfS+"),l.isCancel=i("Lmem"),l.all=function(t){return Promise.all(t)},l.spread=i("DfZB"),l.isAxiosError=i("XwJu"),t.exports=l,t.exports.default=l}});